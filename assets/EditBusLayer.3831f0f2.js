import{ad as v,e as x,a as E,aX as w,X as r}from"./index.da161cf1.js";const m=new v.EventEmitter;function S(d,i,s=!1){const a=w();return s=i==null||s,m.emit("apply-edits",{serviceUrl:d,layerId:i,mayReceiveServiceEdits:s,result:a.promise}),a}const I="esri.layers.mixins.EditBusLayer",b=Symbol(I);function $(d){return d!=null&&typeof d=="object"&&b in d}const R=d=>{var i;let s=class extends d{constructor(...a){super(...a),this[i]=!0,this.when().then(()=>{this.own([m.on("apply-edits",p=>{const{serviceUrl:g,layerId:n,mayReceiveServiceEdits:y,result:f}=p,j=g===this.url,u=n!=null&&this.layerId!=null&&n===this.layerId;if(!j||!u&&!y)return;const A=f.then(e=>{if(u&&(e.addedFeatures.length||e.updatedFeatures.length||e.deletedFeatures.length||e.addedAttachments.length||e.updatedAttachments.length||e.deletedAttachments.length))return this.emit("edits",r(e)),e;const c=e.editedFeatures?.find(({layerId:l})=>l===this.layerId);if(c){const{adds:l,updates:o,deletes:h}=c.editedFeatures,F={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:l?l.map(({attributes:t})=>({objectId:this.objectIdField&&t[this.objectIdField],globalId:this.globalIdField&&t[this.globalIdField]})):[],deletedFeatures:h?h.map(({attributes:t})=>({objectId:this.objectIdField&&t[this.objectIdField],globalId:this.globalIdField&&t[this.globalIdField]})):[],updatedFeatures:o?o.map(({current:{attributes:t}})=>({objectId:this.objectIdField&&t[this.objectIdField],globalId:this.globalIdField&&t[this.globalIdField]})):[],editedFeatures:r(e.editedFeatures),exceededTransferLimit:!1};return this.emit("edits",F),F}return{edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:r(e.editedFeatures),exceededTransferLimit:!1}});this.emit("apply-edits",{result:A})})])},()=>{})}};return i=b,s=x([E(I)],s),s};export{R as c,S as l,$ as n};
