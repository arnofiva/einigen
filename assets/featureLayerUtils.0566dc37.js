import{W as q,a3 as o,cd as f,P,bG as F,eu as u,es as A}from"./index.da161cf1.js";import{e as E}from"./sql.414b1952.js";import{b as O}from"./jsonUtils.4745b876.js";import{A as R}from"./UniqueValueRenderer.0143139a.js";import{c as j}from"./AttachmentQuery.c430db32.js";import{b as c}from"./Query.e586665e.js";import m from"./RelationshipQuery.60e2b826.js";const V=new q({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function T(e,t,n,r){const a=await i(e);if(await p(e,t,r),!a.addAttachment)throw new o(r,"Layer source does not support addAttachment capability");return a.addAttachment(t,n)}function p(e,t,n){const{attributes:r}=t,{objectIdField:a}=e;return e.get("capabilities.data.supportsAttachment")?t?r?a&&r[a]?Promise.resolve():Promise.reject(new o(n,`feature is missing the identifying attribute ${a}`)):Promise.reject(new o(n,"'attributes' are required on a feature to query attachments")):Promise.reject(new o(n,"A feature is required to add/delete/update attachments")):Promise.reject(new o(n,"this layer doesn't support attachments"))}async function U(e,t,n,r,a){const s=await i(e);if(await p(e,t,a),!s.updateAttachment)throw new o(a,"Layer source does not support updateAttachment capability");return s.updateAttachment(t,n,r)}async function D(e,t,n){const{applyEdits:r}=await f(()=>import("./editingSupport.22fdf483.js"),["assets/editingSupport.22fdf483.js","assets/index.da161cf1.js","assets/index.8db76e31.css","assets/normalizeUtils.54c24a4d.js","assets/normalizeUtilsCommon.87227ae2.js","assets/EditBusLayer.3831f0f2.js"]),a=await e.load();return r(a,a.source,t,n)}async function Q(e,t,n){const{uploadAssets:r}=await f(()=>import("./editingSupport.22fdf483.js"),["assets/editingSupport.22fdf483.js","assets/index.da161cf1.js","assets/index.8db76e31.css","assets/normalizeUtils.54c24a4d.js","assets/normalizeUtilsCommon.87227ae2.js","assets/EditBusLayer.3831f0f2.js"]),a=await e.load();return r(a,a.source,t,n)}async function Z(e,t,n,r){const a=await i(e);if(await p(e,t,r),!a.deleteAttachments)throw new o(r,"Layer source does not support deleteAttachments capability");return a.deleteAttachments(t,n)}async function H(e,t,n){const r=(await e.load({signal:t?.signal})).source;if(!r.fetchRecomputedExtents)throw new o(n,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(t)}async function J(e,t,n,r){t=j.from(t),await e.load();const a=e.source,s=e.capabilities;if(!s?.data?.supportsAttachment)throw new o(r,"this layer doesn't support attachments");const{attachmentTypes:h,objectIds:w,globalIds:d,num:b,size:g,start:I,where:y}=t;if(!s?.operations?.supportsQueryAttachments&&(h?.length>0||d?.length>0||g?.length>0||b||I||y))throw new o(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",t);if(!(w?.length||d?.length||y))throw new o(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",t);if(!a.queryAttachments)throw new o(r,"Layer source does not support queryAttachments capability",t);return a.queryAttachments(t)}async function N(e,t,n,r){const a=await i(e);if(!a.queryObjectIds)throw new o(r,"Layer source does not support queryObjectIds capability");return a.queryObjectIds(c.from(t)??e.createQuery(),n)}async function k(e,t,n,r){const a=await i(e);if(!a.queryFeatureCount)throw new o(r,"Layer source does not support queryFeatureCount capability");return a.queryFeatureCount(c.from(t)??e.createQuery(),n)}async function z(e,t,n,r){const a=await i(e);if(!a.queryExtent)throw new o(r,"Layer source does not support queryExtent capability");return a.queryExtent(c.from(t)??e.createQuery(),n)}async function W(e,t,n,r){const a=await i(e);if(!a.queryRelatedFeatures)throw new o(r,"Layer source does not support queryRelatedFeatures capability");return a.queryRelatedFeatures(m.from(t),n)}async function B(e,t,n,r){const a=await i(e);if(!a.queryRelatedFeaturesCount)throw new o(r,"Layer source does not support queryRelatedFeaturesCount capability");return a.queryRelatedFeaturesCount(m.from(t),n)}async function K(e){const t=e.source;if(t?.refresh)try{const{dataChanged:n,updates:r}=await t.refresh();if(r!=null&&(e.sourceJSON={...e.sourceJSON,...r},e.read(r,{origin:"service",url:e.parsedUrl})),n)return!0}catch{}if(e.definitionExpression)try{return(await E(e.definitionExpression,e.fieldsIndex)).hasDateFunctions}catch{}return!1}function X(e){const t=new c,n=e.get("capabilities.data"),r=e.get("capabilities.query");t.historicMoment=e.historicMoment,t.gdbVersion=e.gdbVersion,t.returnGeometry=!0,r&&(t.compactGeometryEnabled=r.supportsCompactGeometry,t.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),n&&(n.supportsZ&&e.returnZ!=null&&(t.returnZ=e.returnZ),n.supportsM&&e.returnM!=null&&(t.returnM=e.returnM)),t.outFields=["*"];const{timeOffset:a,timeExtent:s}=e;return t.timeExtent=a!=null&&s!=null?s.offset(-a.value,a.unit):s||null,t.multipatchOption=e.geometryType==="multipatch"?"xyFootprint":null,t}function Y(e){const{globalIdField:t,fields:n}=e;if(t)return t;if(n){for(const r of n)if(r.type==="esriFieldTypeGlobalID")return r.name}}function ee(e){const{objectIdField:t,fields:n}=e;if(t)return t;if(n){for(const r of n)if(r.type==="esriFieldTypeOID")return r.name}}function te(e){return e.currentVersion?e.currentVersion:e.hasOwnProperty("capabilities")||e.hasOwnProperty("drawingInfo")||e.hasOwnProperty("hasAttachments")||e.hasOwnProperty("htmlPopupType")||e.hasOwnProperty("relationships")||e.hasOwnProperty("timeInfo")||e.hasOwnProperty("typeIdField")||e.hasOwnProperty("types")?10:9.3}async function i(e){return(await e.load()).source}async function x(e,t){if(!u||u.findCredential(e))return;let n;try{const r=await A(e,t);r&&(n=await u.checkSignInStatus(`${r}/sharing`))}catch{}if(n)try{const r=t!=null?t.signal:null;await u.getCredential(e,{signal:r})}catch{}}async function re(e,t){const n=e.parsedUrl?.path;n&&L(e)&&await x(n,t)}function L(e){const t=e.editFieldsInfo;return!(!t?.creatorField&&!t?.editorField)||(e.userHasUpdateItemPrivileges?e.hasUpdateItemRestrictions:!!e.userHasFullEditingPrivileges&&e.hasFullEditingRestrictions)}function ne(e){return!e.sourceJSON?.isMultiServicesView&&(e.userHasUpdateItemPrivileges||e.editingEnabled)}const l=P({types:F});function ae(e,t){if(e.defaultSymbol)return e.types&&e.types.length?new R({defaultSymbol:l(e.defaultSymbol,e,t),field:e.typeIdField,uniqueValueInfos:e.types.map(n=>({id:n.id,symbol:l(n.symbol,n,t)}))}):new O({symbol:l(e.defaultSymbol,e,t)})}export{B as A,X as E,k as F,z as I,re as M,K as O,W as P,ne as Q,ee as R,Y as S,Z as b,V as d,H as g,D as h,J as j,U as m,N as q,ae as v,Q as w,te as x,T as y};
