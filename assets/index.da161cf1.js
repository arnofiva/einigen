const Sbe=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=r(s);fetch(s.href,n)}};Sbe();const qI={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function yne(e){return!!qI[e]||!!qI[e.toLowerCase()]}function TV(e){return qI[e]??qI[e.toLowerCase()]}function Ebe(e){return[...TV(e)]}function M5(e,t,r){r<0&&++r,r>1&&--r;const i=6*r;return i<1?e+(t-e)*i:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}function _ne(e,t,r,i=1){const s=(e%360+360)%360/360,n=r<=.5?r*(t+1):r+t-r*t,o=2*r-n;return[Math.round(255*M5(o,n,s+1/3)),Math.round(255*M5(o,n,s)),Math.round(255*M5(o,n,s-1/3)),i]}function Cbe(e){const t=e.length>5,r=t?8:4,i=(1<<r)-1,s=t?1:17,n=t?e.length===9:e.length===5;let o=Number("0x"+e.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&i,o>>=r,a[3]=s*l/255),l=o&i,o>>=r,a[2]=s*l,l=o&i,o>>=r,a[1]=s*l,l=o&i,o>>=r,a[0]=s*l,a}function C(){return[0,0,0]}function Ts(e){return[e[0],e[1],e[2]]}function Ce(e,t,r){return[e,t,r]}function fa(e){const t=C(),r=Math.min(3,e.length);for(let i=0;i<r;++i)t[i]=e[i];return t}function SV(e,t){return new Float64Array(e,t,3)}function vne(){return C()}function bne(){return Ce(1,1,1)}function wne(){return Ce(1,0,0)}function xne(){return Ce(0,1,0)}function EV(){return Ce(0,0,1)}const wa=vne(),cm=bne(),Tne=wne(),Sne=xne(),CV=EV();Object.freeze(Object.defineProperty({__proto__:null,ONES:cm,UNIT_X:Tne,UNIT_Y:Sne,UNIT_Z:CV,ZEROS:wa,clone:Ts,create:C,createView:SV,fromArray:fa,fromValues:Ce,ones:bne,unitX:wne,unitY:xne,unitZ:EV,zeros:vne},Symbol.toStringTag,{value:"Module"}));let AV=1e-6;function Ta(){return AV}function Abe(e){AV=e}const y3=Math.random,Obe=Math.PI/180,Rbe=180/Math.PI;function TD(e){return e*Obe}function Pbe(e){return e*Rbe}function Mbe(e,t){return Math.abs(e-t)<=AV*Math.max(1,Math.abs(e),Math.abs(t))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:y3,equals:Mbe,getEpsilon:Ta,setEpsilon:Abe,toDegree:Pbe,toRadian:TD},Symbol.toStringTag,{value:"Module"}));function Se(e){const t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)}function re(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function se(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function oe(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function ce(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function SD(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function XI(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function Ibe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function Ene(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function ZI(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e}function Cne(e,t){return e[0]=Math.sign(t[0]),e[1]=Math.sign(t[1]),e[2]=Math.sign(t[2]),e}function OV(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function $be(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function Lbe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function te(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function Ev(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}function ni(e,t){const r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(r*r+i*i+s*s)}function gn(e,t){const r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2];return r*r+i*i+s*s}function Bo(e){const t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function Wo(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Dbe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function pe(e,t){const r=t[0],i=t[1],s=t[2];let n=r*r+i*i+s*s;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n),e}function de(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function rt(e,t,r){const i=t[0],s=t[1],n=t[2],o=r[0],a=r[1],l=r[2];return e[0]=s*l-n*a,e[1]=n*o-i*l,e[2]=i*a-s*o,e}function Lr(e,t,r,i){const s=t[0],n=t[1],o=t[2];return e[0]=s+i*(r[0]-s),e[1]=n+i*(r[1]-n),e[2]=o+i*(r[2]-o),e}function Nbe(e,t,r,i,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),u=o*(3-2*n);return e[0]=t[0]*a+r[0]*l+i[0]*c+s[0]*u,e[1]=t[1]*a+r[1]*l+i[1]*c+s[1]*u,e[2]=t[2]*a+r[2]*l+i[2]*c+s[2]*u,e}function Fbe(e,t,r,i,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,u=3*n*a,d=3*l*o,p=l*n;return e[0]=t[0]*c+r[0]*u+i[0]*d+s[0]*p,e[1]=t[1]*c+r[1]*u+i[1]*d+s[1]*p,e[2]=t[2]*c+r[2]*u+i[2]*d+s[2]*p,e}function Ube(e,t){t=t||1;const r=y3,i=2*r()*Math.PI,s=2*r()-1,n=Math.sqrt(1-s*s)*t;return e[0]=Math.cos(i)*n,e[1]=Math.sin(i)*n,e[2]=s*t,e}function Ue(e,t,r){const i=t[0],s=t[1],n=t[2];return e[0]=r[0]*i+r[4]*s+r[8]*n+r[12],e[1]=r[1]*i+r[5]*s+r[9]*n+r[13],e[2]=r[2]*i+r[6]*s+r[10]*n+r[14],e}function Il(e,t,r){const i=t[0],s=t[1],n=t[2];return e[0]=i*r[0]+s*r[3]+n*r[6],e[1]=i*r[1]+s*r[4]+n*r[7],e[2]=i*r[2]+s*r[5]+n*r[8],e}function Uu(e,t,r){const i=r[0],s=r[1],n=r[2],o=r[3],a=t[0],l=t[1],c=t[2];let u=s*c-n*l,d=n*a-i*c,p=i*l-s*a,g=s*p-n*d,y=n*u-i*p,_=i*d-s*u;const v=2*o;return u*=v,d*=v,p*=v,g*=2,y*=2,_*=2,e[0]=a+u+g,e[1]=l+d+y,e[2]=c+p+_,e}function kbe(e,t,r,i){const s=[],n=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],n[0]=s[0],n[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),n[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e}function zbe(e,t,r,i){const s=[],n=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],n[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),n[1]=s[1],n[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e}function Bbe(e,t,r,i){const s=[],n=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],n[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),n[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),n[2]=s[2],e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e}function Ane(e,t){re(gO,e),re(yO,t),pe(gO,gO),pe(yO,yO);const r=de(gO,yO);return r>1?0:r<-1?Math.PI:Math.acos(r)}const gO=C(),yO=C();function Vbe(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Go(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function ly(e,t){if(e===t)return!0;const r=e[0],i=e[1],s=e[2],n=t[0],o=t[1],a=t[2],l=Ta();return Math.abs(r-n)<=l*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-o)<=l*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(s-a)<=l*Math.max(1,Math.abs(s),Math.abs(a))}function Hm(e,t,r){const i=r[0]-t[0],s=r[1]-t[1],n=r[2]-t[2];let o=i*i+s*s+n*n;return o>0?(o=1/Math.sqrt(o),e[0]=i*o,e[1]=s*o,e[2]=n*o,e):(e[0]=0,e[1]=0,e[2]=0,e)}const Ln=ce,Gbe=SD,jbe=XI,_3=ni,ED=gn,bl=Se,c8=Bo,eq=Object.freeze(Object.defineProperty({__proto__:null,abs:ZI,add:oe,angle:Ane,bezier:Fbe,ceil:Ibe,copy:re,cross:rt,direction:Hm,dist:_3,distance:ni,div:jbe,divide:XI,dot:de,equals:ly,exactEquals:Go,floor:Ene,hermite:Nbe,inverse:Dbe,len:bl,length:Se,lerp:Lr,max:$be,min:OV,mul:Gbe,multiply:SD,negate:Wo,normalize:pe,random:Ube,rotateX:kbe,rotateY:zbe,rotateZ:Bbe,round:Lbe,scale:te,scaleAndAdd:Ev,set:se,sign:Cne,sqrDist:ED,sqrLen:c8,squaredDistance:gn,squaredLength:Bo,str:Vbe,sub:Ln,subtract:ce,transformMat3:Il,transformMat4:Ue,transformQuat:Uu},Symbol.toStringTag,{value:"Module"}));function $u(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function pi(e,t,r,i,s){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e}function RV(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function One(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function Rne(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function Pne(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function Hbe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function Wbe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function qbe(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function Xbe(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function Zbe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function t1(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function Ybe(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}function Mne(e,t){const r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return Math.sqrt(r*r+i*i+s*s+n*n)}function YI(e,t){const r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return r*r+i*i+s*s+n*n}function PV(e){const t=e[0],r=e[1],i=e[2],s=e[3];return Math.sqrt(t*t+r*r+i*i+s*s)}function MV(e){const t=e[0],r=e[1],i=e[2],s=e[3];return t*t+r*r+i*i+s*s}function Jbe(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function Kbe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function Ine(e,t){const r=t[0],i=t[1],s=t[2],n=t[3];let o=r*r+i*i+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),e[0]=r*o,e[1]=i*o,e[2]=s*o,e[3]=n*o),e}function $ne(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function IV(e,t,r,i){const s=t[0],n=t[1],o=t[2],a=t[3];return e[0]=s+i*(r[0]-s),e[1]=n+i*(r[1]-n),e[2]=o+i*(r[2]-o),e[3]=a+i*(r[3]-a),e}function Qbe(e,t){const r=y3;let i,s,n,o,a,l;t=t||1;do i=2*r()-1,s=2*r()-1,a=i*i+s*s;while(a>=1);do n=2*r()-1,o=2*r()-1,l=n*n+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return e[0]=t*i,e[1]=t*s,e[2]=t*n*c,e[3]=t*o*c,e}function xc(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3];return e[0]=r[0]*i+r[4]*s+r[8]*n+r[12]*o,e[1]=r[1]*i+r[5]*s+r[9]*n+r[13]*o,e[2]=r[2]*i+r[6]*s+r[10]*n+r[14]*o,e[3]=r[3]*i+r[7]*s+r[11]*n+r[15]*o,e}function ewe(e,t,r){const i=t[0],s=t[1],n=t[2],o=r[0],a=r[1],l=r[2],c=r[3],u=c*i+a*n-l*s,d=c*s+l*i-o*n,p=c*n+o*s-a*i,g=-o*i-a*s-l*n;return e[0]=u*c+g*-o+d*-l-p*-a,e[1]=d*c+g*-a+p*-o-u*-l,e[2]=p*c+g*-l+u*-a-d*-o,e[3]=t[3],e}function twe(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Tx(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function JI(e,t){const r=e[0],i=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],c=t[3],u=Ta();return Math.abs(r-o)<=u*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=u*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=u*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=u*Math.max(1,Math.abs(n),Math.abs(c))}const rwe=One,iwe=Rne,swe=Pne,nwe=Mne,owe=YI,awe=PV,lwe=MV,Lne=Object.freeze(Object.defineProperty({__proto__:null,add:RV,ceil:Hbe,copy:$u,dist:nwe,distance:Mne,div:swe,divide:Pne,dot:$ne,equals:JI,exactEquals:Tx,floor:Wbe,inverse:Kbe,len:awe,length:PV,lerp:IV,max:Xbe,min:qbe,mul:iwe,multiply:Rne,negate:Jbe,normalize:Ine,random:Qbe,round:Zbe,scale:t1,scaleAndAdd:Ybe,set:pi,sqrDist:owe,sqrLen:lwe,squaredDistance:YI,squaredLength:MV,str:twe,sub:rwe,subtract:One,transformMat4:xc,transformQuat:ewe},Symbol.toStringTag,{value:"Module"})),tq=new Float32Array(1);function cwe(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}function fe(e,t,r){return Math.min(Math.max(e,t),r)}function r1(e){return(e&e-1)==0}function eht(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function tht(e){return 10**Math.ceil(Math.LOG10E*Math.log(e))}function yt(e,t,r){return e+(t-e)*r}function Ot(e){return e*Math.PI/180}function xa(e){return 180*e/Math.PI}function u8(e,t=1e-6){return(e<0?-1:1)/Math.max(Math.abs(e),t)}function _n(e){return Math.acos(fe(e,-1,1))}function Hu(e){return Math.asin(fe(e,-1,1))}function Sx(e,t,r=1e-6){return e===t?!0:!Number.isFinite(e)||!Number.isFinite(t)?!1:(e>t?e-t:t-e)<=r}const KI=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function h8(e){return KI.setFloat64(0,e),KI.getBigInt64(0)}function uwe(e){return KI.setBigInt64(0,e),KI.getFloat64(0)}const uM=BigInt("1000000"),hwe=Dne(1);function Dne(e){const t=h8(e=Math.abs(e)),r=uwe(t<=uM?uM:t-uM);return Math.abs(e-r)}function rht(e,t,r=hwe){if(e===t)return!0;if(!Number.isFinite(e)||!Number.isFinite(t))return!1;if(r!=null&&Dne(Math.min(Math.abs(e),Math.abs(t)))<r)return Math.abs(e-t)<=r;const i=h8(e),s=h8(t);return i<0!=s<0?!1:!((i<s?s-i:i-s)>uM)}function dwe(e,t,r=1e-6){if(e===t)return!0;if(!Number.isFinite(e)||!Number.isFinite(t))return!1;const i=Math.abs(e-t),s=Math.abs(e),n=Math.abs(t);if(e===0||t===0||s<1e-12&&n<1e-12){if(i>.01*r)return!1}else if(i/(s+n)>r)return!1;return!0}function pwe(e){return Nne(Math.max(-d8,Math.min(e,d8)))}function Nne(e){return tq[0]=e,tq[0]}function QC(e,t,r){const i=fe((r-e)/(t-e),0,1);return i*i*(3-2*i)}function rq(e,t){const r=Se(e),i=Hu(e[2]/r),s=Math.atan2(e[1]/r,e[0]/r);return se(t,r,i,s),t}function iht(e,t,r){return pi(e,t[0],t[1],t[2],t[3]*r)}function sht(e){const t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[3]*e[3]+e[4]*e[4]+e[5]*e[5],i=e[6]*e[6]+e[7]*e[7]+e[8]*e[8];return!(Sx(t,1)&&Sx(r,1)&&Sx(i,1))}const d8=Nne(34028234663852886e22);let L0;function ne(e){return typeof L0[e]=="function"?L0[e]=L0[e](globalThis):L0[e]}L0=globalThis.dojoConfig?.has||globalThis.esriConfig?.has?{...globalThis.dojoConfig?.has,...globalThis.esriConfig?.has}:{},ne.add=(e,t,r,i)=>((i||L0[e]===void 0)&&(L0[e]=t),r&&ne(e)),ne.cache=L0,ne.add("esri-deprecation-warnings",!0),ne.add("esri-force-fullscreen-debug",!1),(()=>{ne.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const e=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(ne.add("host-browser",e),ne.add("host-node",typeof globalThis.process=="object"&&globalThis.process.versions?.node&&globalThis.process.versions.v8),ne.add("dom",e),ne("host-browser")){const t=navigator,r=t.userAgent,i=t.appVersion,s=parseFloat(i);if(ne.add("wp",parseFloat(r.split("Windows Phone")[1])||void 0),ne.add("msapp",parseFloat(r.split("MSAppHost/")[1])||void 0),ne.add("khtml",i.includes("Konqueror")?s:void 0),ne.add("edge",parseFloat(r.split("Edge/")[1])||void 0),ne.add("opr",parseFloat(r.split("OPR/")[1])||void 0),ne.add("webkit",!ne("wp")&&!ne("edge")&&parseFloat(r.split("WebKit/")[1])||void 0),ne.add("chrome",!ne("edge")&&!ne("opr")&&parseFloat(r.split("Chrome/")[1])||void 0),ne.add("android",!ne("wp")&&parseFloat(r.split("Android ")[1])||void 0),ne.add("safari",!i.includes("Safari")||ne("wp")||ne("chrome")||ne("android")||ne("edge")||ne("opr")?void 0:parseFloat(i.split("Version/")[1])),ne.add("mac",i.includes("Macintosh")),!ne("wp")&&/(iPhone|iPod|iPad)/.test(r)){const n=RegExp.$1.replace(/P/,"p"),o=/OS ([\d_]+)/.test(r)?RegExp.$1:"1",a=parseFloat(o.replace(/_/,".").replaceAll("_",""));ne.add(n,a),ne.add("ios",a)}ne("webkit")||(!r.includes("Gecko")||ne("wp")||ne("khtml")||ne("edge")||ne.add("mozilla",s),ne("mozilla")&&ne.add("ff",parseFloat(r.split("Firefox/")[1]||r.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const e=navigator.userAgent,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(e),r=/iPhone/i.test(e);t&&ne.add("esri-mobile",t),r&&ne.add("esri-iPhone",r),ne.add("esri-geolocation",!!navigator.geolocation)}ne.add("esri-wasm","WebAssembly"in globalThis),ne.add("esri-shared-array-buffer",()=>{const e="SharedArrayBuffer"in globalThis,t=globalThis.crossOriginIsolated===!1;return e&&!t}),ne.add("wasm-simd",()=>{const e=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(e))}),ne.add("esri-atomics","Atomics"in globalThis),ne.add("esri-workers","Worker"in globalThis),ne.add("web-feat:cache","caches"in globalThis),ne.add("esri-workers-arraybuffer-transfer",!ne("safari")||Number(ne("safari"))>=12),ne.add("workers-pool-size",8),ne.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),ne.add("featurelayer-simplify-payload-size-factors",[1,1,4]),ne.add("featurelayer-animation-enabled",!0),ne.add("featurelayer-snapshot-enabled",!0),ne.add("featurelayer-snapshot-point-min-threshold",8e4),ne.add("featurelayer-snapshot-point-max-threshold",4e5),ne.add("featurelayer-snapshot-point-coverage",.1),ne.add("featurelayer-advanced-symbols",!1),ne.add("featurelayer-pbf",!0),ne.add("featurelayer-pbf-statistics",!1),ne.add("feature-layers-workers",!0),ne.add("feature-polyline-generalization-factor",1),ne.add("mapview-transitions-duration",200),ne.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),ne.add("mapserver-pbf-version-support",10.81),ne.add("mapservice-popup-identify-max-tolerance",20),ne.add("heatmap-allow-raster-fallback",!1),ne.add("heatmap-force-raster",!1),ne("host-webworker")||ne("host-browser")&&(ne.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),ne.add("esri-image-decode",()=>{if("decode"in new Image){const e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void e.decode().then(()=>{ne.add("esri-image-decode",!0,!0,!0)}).catch(()=>{ne.add("esri-image-decode",!1,!0,!0)})}return!1}),ne.add("esri-url-encodes-apostrophe",()=>{const e=window.document.createElement("a");return e.href="?'",e.href.includes("?%27")}))})();class xu{constructor(t=1){this._seed=t}set seed(t){this._seed=t??Math.random()*xu._m}getInt(){return this._seed=(xu._a*this._seed+xu._c)%xu._m,this._seed}getFloat(){return this.getInt()/(xu._m-1)}getIntRange(t,r){return Math.round(this.getFloatRange(t,r))}getFloatRange(t,r){const i=r-t;return t+this.getInt()/xu._m*i}}xu._m=2147483647,xu._a=48271,xu._c=0;const CD=1.5,fwe=1/CD,mwe=.5;function AD(e,t){return t?e.filter((r,i,s)=>s.findIndex(t.bind(null,r))===i):e.filter((r,i,s)=>s.indexOf(r)===i)}function Om(e,t,r){if(e==null&&t==null)return!0;if(e==null||t==null||e.length!==t.length)return!1;if(r){for(let i=0;i<e.length;i++)if(!r(e[i],t[i]))return!1}else for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function $V(e,t){let r=e.length!==t.length;r&&(e.length=t.length);for(let i=0;i<t.length;++i)e[i]!==t[i]&&(e[i]=t[i],r=!0);return r}function gwe(e,t,r){let i,s;return r?(i=t.filter(n=>!e.some(o=>r(o,n))),s=e.filter(n=>!t.some(o=>r(o,n)))):(i=t.filter(n=>!e.includes(n)),s=e.filter(n=>!t.includes(n))),{added:i,removed:s}}function ywe(e){return e&&typeof e.length=="number"}function nht(e,t){const r=e.length;if(r===0)return[];const i=[];for(let s=0;s<r;s+=t)i.push(e.slice(s,s+t));return i}const _we=!!Array.prototype.fill;function oht(e,t){if(_we)return new Array(e).fill(t);const r=new Array(e);for(let i=0;i<e;i++)r[i]=t;return r}function vwe(e,t){t===void 0&&(t=e,e=0);const r=new Array(t-e);for(let i=e;i<t;i++)r[i-e]=i;return r}function bwe(e,t,r){const i=e.length;let s=0,n=i-1;for(;s<n;){const a=s+Math.floor((n-s)/2);t>e[a]?s=a+1:n=a}const o=e[s];return r?t>=e[i-1]?-1:o===t?s:s-1:o===t?s:-1}class Fne{constructor(){this.last=0}}const Une=new Fne;function p8(e,t,r,i){i=i||Une;const s=Math.max(0,i.last-10);for(let o=s;o<r;++o)if(e[o]===t)return i.last=o,o;const n=Math.min(s,r);for(let o=0;o<n;++o)if(e[o]===t)return i.last=o,o;return-1}function eA(e,t,r,i){const s=r??e.length,n=p8(e,t,s,i);if(n!==-1)return e[n]=e[s-1],r==null&&e.pop(),t}const ch=new Set;function wwe(e,t,r=e.length,i=t.length,s,n){if(i===0||r===0)return r;ch.clear();for(let a=0;a<i;++a)ch.add(t[a]);s=s||Une;const o=Math.max(0,s.last-10);for(let a=o;a<r;++a)if(ch.has(e[a])&&(n&&n.push(e[a]),ch.delete(e[a]),e[a]=e[r-1],--r,--a,ch.size===0||r===0))return ch.clear(),r;for(let a=0;a<o;++a)if(ch.has(e[a])&&(n&&n.push(e[a]),ch.delete(e[a]),e[a]=e[r-1],--r,--a,ch.size===0||r===0))return ch.clear(),r;return ch.clear(),r}function xwe(e,t){let r=0;for(let i=0;i<e.length;++i){const s=e[i];t(s,i)&&(e[r]=s,r++)}e.length=r}function Twe(e){return e?(iq.seed=e,()=>iq.getFloat()):Math.random}function aht(e,t){const r=Twe(t);for(let i=e.length-1;i>0;i--){const s=Math.floor(r()*(i+1)),n=e[i];e[i]=e[s],e[s]=n}return e}const iq=new xu;function LV(e,t){const r=e.indexOf(t);return r!==-1?(e.splice(r,1),t):null}function lht(e,t){const r=new Map,i=e.length;for(let s=0;s<i;s++){const n=e[s],o=t(n,s,e),a=r.get(o);a?a.push(n):r.set(o,[n])}return r}function v3(e,t){return e!=null}const Swe=[];function BS(e){return e instanceof ArrayBuffer}function DV(e){return e?.constructor?.name==="Int8Array"}function D0(e){return e?.constructor?.name==="Uint8Array"}function kne(e){return e?.constructor?.name==="Uint8ClampedArray"}function NV(e){return e?.constructor?.name==="Int16Array"}function OD(e){return e?.constructor?.name==="Uint16Array"}function FV(e){return e?.constructor?.name==="Int32Array"}function RD(e){return e?.constructor?.name==="Uint32Array"}function t2(e){return e?.constructor?.name==="Float32Array"}function r2(e){return e?.constructor?.name==="Float64Array"}function md(e){return!("buffer"in e)}function N0(e){return e!=null?md(e)?8*e.length+12:e.byteLength+zne:0}const zne=145,Ic=1024;function Ewe(e){return r2(e)||t2(e)||FV(e)||NV(e)||DV(e)}function Cwe(e){return r2(e)||t2(e)}function Awe(e){return r2(e)?179769e303:t2(e)?3402823e32:RD(e)?4294967295:OD(e)?65535:D0(e)||kne(e)?255:FV(e)?2147483647:NV(e)?32767:DV(e)?127:256}function PD(e,t){let r;if(t)for(r in e)e.hasOwnProperty(r)&&(e[r]===void 0?delete e[r]:e[r]instanceof Object&&PD(e[r],!0));else for(r in e)e.hasOwnProperty(r)&&e[r]===void 0&&delete e[r];return e}function ye(e){if(!e||typeof e!="object"||typeof e=="function")return e;const t=Gne(e);if(t!=null)return t;if(QI(e))return e.clone();if(Bne(e))return e.map(ye);if(Vne(e))return e.clone();const r={};for(const i of Object.getOwnPropertyNames(e))r[i]=ye(e[i]);return r}function f8(e){if(!e||typeof e!="object"||typeof e=="function"||"HTMLElement"in globalThis&&e instanceof HTMLElement)return e;const t=Gne(e);if(t!=null)return t;if(Bne(e)){let r=!0;const i=e.map(s=>{const n=f8(s);return s!=null&&n==null&&(r=!1),n});return r?i:null}if(QI(e))return e.clone();if(e instanceof File||e instanceof Blob)return e;if(!Vne(e)){const r=new(Object.getPrototypeOf(e)).constructor;for(const i of Object.getOwnPropertyNames(e)){const s=e[i],n=f8(s);if(s!=null&&n==null)return null;r[i]=n}return r}return null}function QI(e){return typeof e.clone=="function"}function Bne(e){return typeof e.map=="function"&&typeof e.forEach=="function"}function Vne(e){return typeof e.notifyChange=="function"&&typeof e.watch=="function"}function sq(e){if(Object.prototype.toString.call(e)!=="[object Object]")return!1;const t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}function Gne(e){if(DV(e)||D0(e)||kne(e)||NV(e)||OD(e)||FV(e)||RD(e)||t2(e)||r2(e))return e.slice();if(e instanceof Date)return new Date(e.getTime());if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if(e instanceof Map){const t=new Map;for(const[r,i]of e)t.set(r,ye(i));return t}if(e instanceof Set){const t=new Set;for(const r of e)t.add(ye(r));return t}return null}function UV(e,t){return e===t||typeof e=="number"&&isNaN(e)&&typeof t=="number"&&isNaN(t)||typeof(e||{}).getTime=="function"&&typeof(t||{}).getTime=="function"&&e.getTime()===t.getTime()||!1}function jne(e,t){return e===t||(e==null||typeof e=="string"?e===t:typeof e=="number"?e===t||typeof t=="number"&&isNaN(e)&&isNaN(t):e instanceof Date?t instanceof Date&&e.getTime()===t.getTime():Array.isArray(e)?Array.isArray(t)&&Om(e,t):e instanceof Set?t instanceof Set&&Rwe(e,t):e instanceof Map?t instanceof Map&&Pwe(e,t):!!sq(e)&&sq(t)&&Owe(e,t))}function Owe(e,t){if(e===null||t===null)return!1;const r=Object.keys(e);if(t===null||Object.keys(t).length!==r.length)return!1;for(const i of r)if(e[i]!==t[i]||!Object.prototype.hasOwnProperty.call(t,i))return!1;return!0}function Rwe(e,t){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}function Pwe(e,t){if(e.size!==t.size)return!1;for(const[r,i]of e){const s=t.get(r);if(s!==i||s===void 0&&!t.has(r))return!1}return!0}function Mwe(e,t,r=!1){return Wne(e,t,r)}function um(e,t){if(t!=null)return t[e]||Hne(e.split("."),!1,t)}function i2(e,t,r){const i=e.split("."),s=i.pop(),n=Hne(i,!0,r);n&&s&&(n[s]=t)}function Hne(e,t,r){let i=r;for(const s of e){if(i==null)return;if(!(s in i)){if(!t)return;i[s]={}}i=i[s]}return i}function Wne(e,t,r){return t?Object.keys(t).reduce((i,s)=>{let n=i[s],o=t[s];return n===o?i:n===void 0?(i[s]=ye(o),i):(Array.isArray(o)||Array.isArray(i)?(n=n?Array.isArray(n)?i[s]=n.concat():i[s]=[n]:i[s]=[],o&&(Array.isArray(o)||(o=[o]),r?o.forEach(a=>{n.includes(a)||n.push(a)}):i[s]=o.concat())):o&&typeof o=="object"?i[s]=Wne(n,o,r):i.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(i[s]=o),i)},e||{}):e}const Or={analysisTheme:{accentColor:[255,127,0],textColor:"white"},apiKey:void 0,applicationName:"",applicationUrl:globalThis.location?.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!1,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(Mwe(Or,globalThis.esriConfig,!0),delete Or.has),!Or.assetsPath){{const e="4.27";Or.assetsPath=`https://js.arcgis.com/${e}/@arcgis/core/assets`}Or.defaultAssetsPath=Or.assetsPath}const Iwe=/\{([^\}]+)\}/g;function nq(e){return e??""}function MD(e,t){return e.replaceAll(Iwe,typeof t=="object"?(r,i)=>nq(um(i,t)):(r,i)=>nq(t(i)))}function cht(e,t){return e.replaceAll(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,r=>t&&t.includes(r)?r:`\\${r}`)}function qne(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t}function uht(e){return new DOMParser().parseFromString(e||"","text/html").body.innerText||""}function hht(e,t){return new RegExp(`{${t}}`,"ig").test(e)}const oq={info:0,warn:1,error:2,none:3};class K{constructor(t){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},t.level!=null&&(this.level=t.level),t.writer!=null&&(this.writer=t.writer),this._module=t.module,K._loggers.set(this.module,this);const r=this.module.lastIndexOf(".");r!==-1&&(this._parent=K.getLogger(this.module.slice(0,r)))}get module(){return this._module}get parent(){return this._parent}error(...t){this._log("error","always",...t)}warn(...t){this._log("warn","always",...t)}info(...t){this._log("info","always",...t)}errorOnce(...t){this._log("error","once",...t)}warnOnce(...t){this._log("warn","once",...t)}infoOnce(...t){this._log("info","once",...t)}errorOncePerTick(...t){this._log("error","oncePerTick",...t)}warnOncePerTick(...t){this._log("warn","oncePerTick",...t)}infoOncePerTick(...t){this._log("info","oncePerTick",...t)}get test(){const t=this;return{loggedMessages:t._loggedMessages,clearLoggedWarnings:()=>t._loggedMessages.warn.clear()}}static get test(){return{resetLoggers(t=new Map){const r=K._loggers;return K._loggers=t,r},set throttlingDisabled(t){K._throttlingDisabled=t}}}static getLogger(t){return t=typeof t!="string"?t.declaredClass:t,K._loggers.get(t)||new K({module:t})}_log(t,r,...i){if(!!this._matchLevel(t)){if(r!=="always"&&!K._throttlingDisabled){const s=this._argsToKey(i),n=this._loggedMessages[t].get(s);if(r==="once"&&n!=null||r==="oncePerTick"&&n&&n>=K._tickCounter)return;this._loggedMessages[t].set(s,K._tickCounter),K._scheduleTickCounterIncrement()}for(const s of Or.log.interceptors)if(s(t,this.module,...i))return;this._inheritedWriter()(t,this.module,...i)}}_parentWithMember(t,r){let i=this;for(;i!=null;){const s=i[t];if(s!=null)return s;i=i.parent}return r}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(t,r,...i){console[t](`[${r}]`,...i)}_matchLevel(t){const r=Or.log.level||"warn";return oq[this._parentWithMember("level",r)]<=oq[t]}_argsToKey(...t){const r=(i,s)=>typeof s!="object"||Array.isArray(s)?s:"[Object]";return qne(JSON.stringify(t,r))}static _scheduleTickCounterIncrement(){K._tickCounterScheduled||(K._tickCounterScheduled=!0,Promise.resolve().then(()=>{K._tickCounter++,K._tickCounterScheduled=!1}))}}K._loggers=new Map,K._tickCounter=0,K._tickCounterScheduled=!1,K._throttlingDisabled=!1;function _o(e,t){for(const[r,i]of e)if(t(i,r))return!0;return!1}function dht(e,t){for(const[r,i]of e)if(t(i,r))return i;return null}function Xne(e,t,r){const i=e.get(t);if(i!==void 0)return i;const s=r();return e.set(t,s),s}const Ex=K.getLogger("esri.core.accessorSupport.ensureTypes");function $we(e){return e==null?e:new Date(e)}function Lwe(e){return e==null?e:!!e}function Dwe(e){return e==null?e:e.toString()}function Xh(e){return e==null?e:(e=parseFloat(e),isNaN(e)?0:e)}function kV(e){return e==null?e:Math.round(parseFloat(e))}function Zne(e){return e&&e.constructor&&e.constructor.__accessorMetadata__!==void 0}function e$(e,t){return t!=null&&e&&!(t instanceof e)}function Yne(e){return e&&"isCollection"in e}function aq(e){return e&&e.Type?typeof e.Type=="function"?e.Type:e.Type.base:null}function Nwe(e,t){if(!t||!t.constructor||!Yne(t.constructor))return m8(e,t)?t:new e(t);const r=aq(e.prototype.itemType),i=aq(t.constructor.prototype.itemType);return r?i?r===i?t:r.prototype.isPrototypeOf(i.prototype)?new e(t):(m8(e,t),t):new e(t):t}function m8(e,t){return!!Zne(t)&&(Ex.error("Accessor#set","Assigning an instance of '"+(t.declaredClass||"unknown")+"' which is not a subclass of '"+ID(e)+"'"),!0)}function Yx(e,t){return t==null?t:Yne(e)?Nwe(e,t):e$(e,t)?m8(e,t)?t:new e(t):t}function ID(e){return e&&e.prototype&&e.prototype.declaredClass||"unknown"}const Fwe=new WeakMap;function Uwe(e){switch(e){case Number:return Xh;case Ps:return kV;case Boolean:return Lwe;case String:return Dwe;case Date:return $we;default:return Xne(Fwe,e,()=>Yx.bind(null,e))}}function ro(e,t){const r=Uwe(e);return arguments.length===1?r:r(t)}function tA(e,t,r){return arguments.length===1?tA.bind(null,e):t&&(Array.isArray(t)?t.map(i=>e(i,r)):[e(t,r)])}function kwe(e,t){return arguments.length===1?tA(r=>ro(e,r)):tA(r=>ro(e,r),t)}function Jne(e,t,r){return t!==0&&Array.isArray(r)?r.map(i=>Jne(e,t-1,i)):e(r)}function t$(e,t,r){if(arguments.length===2)return n=>t$(e,t,n);if(!r)return r;r=Jne(e,t,r);let i=t,s=r;for(;i>0&&Array.isArray(s);)i--,s=s[0];if(s!==void 0)for(let n=0;n<i;n++)r=[r];return r}function zwe(e,t,r){return arguments.length===2?t$(i=>ro(e,i),t):t$(i=>ro(e,i),t,r)}function Kne(e){return!!Array.isArray(e)&&!e.some(t=>{const r=typeof t;return!(r==="string"||r==="number"||r==="function"&&e.length>1)})}function g8(e,t){if(arguments.length===2)return g8(e).call(null,t);const r=new Set,i=e.filter(a=>typeof a!="function"),s=e.filter(a=>typeof a=="function");for(const a of e)typeof a!="string"&&typeof a!="number"||r.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,u=c==="string"||c==="number";return u&&(r.has(a)||s.some(d=>c==="string"&&d===String||c==="number"&&d===Number))||c==="object"&&s.some(d=>!e$(a,d))?a:(u&&i.length?(n||(n=i.map(d=>typeof d=="string"?`'${d}'`:`${d}`).join(", ")),Ex.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(d=>ID(d)).join(", ")),Ex.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):Ex.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function cy(e,t){if(arguments.length===2)return cy(e).call(null,t);const r={},i=[],s=[];for(const l in e.typeMap){const c=e.typeMap[l];r[l]=ro(c),i.push(ID(c)),s.push(l)}const n=()=>`'${i.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof e.key=="string"?l=>l[e.key]:e.key;return l=>{if(e.base&&!e$(e.base,l)||l==null)return l;const c=a(l)||e.defaultKeyValue,u=r[c];if(!u)return Ex.error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!e$(e.typeMap[c],l))return l;if(typeof e.key=="string"&&!Zne(l)){const d={};for(const p in l)p!==e.key&&(d[p]=l[p]);return u(d)}return u(l)}}class Ps{}const pht={native:e=>({type:"native",value:e}),array:e=>({type:"array",value:e}),oneOf:e=>({type:"one-of",values:e})};function Bwe(e){if(!e||!("type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0}return!1}function Qne(e){switch(e.type){case"native":return ro(e.value);case"array":return tA(Qne(e.value));case"one-of":return Vwe(e);default:return null}}function Vwe(e){let t=null;return(r,i)=>_8(r,e)?r:(t==null&&(t=y8(e)),Ex.error("Accessor#set",`Invalid property value, value needs to be of type ${t}`),i&&(i.valid=!1),null)}function y8(e){switch(e.type){case"native":switch(e.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Ps:return"integer";case Date:return"date";default:return ID(e.value)}case"array":return`array of ${y8(e.value)}`;case"one-of":{const t=e.values.map(r=>y8(r));return`one of ${t.slice(0,t.length-1)} or ${t[t.length-1]}`}}return"unknown"}function _8(e,t){if(e==null)return!0;switch(t.type){case"native":switch(t.value){case Number:case Ps:return typeof e=="number";case Boolean:return typeof e=="boolean";case String:return typeof e=="string"}return e instanceof t.value;case"array":return!!Array.isArray(e)&&!e.some(r=>!_8(r,t.value));case"one-of":return t.values.some(r=>_8(e,r))}}function _O(e){return fe(kV(e),0,255)}function vO(e,t,r){return e=Number(e),isNaN(e)?r:e<t?t:e>r?r:e}class an{static blendColors(t,r,i,s=new an){return s.r=Math.round(t.r+(r.r-t.r)*i),s.g=Math.round(t.g+(r.g-t.g)*i),s.b=Math.round(t.b+(r.b-t.b)*i),s.a=t.a+(r.a-t.a)*i,s._sanitize()}static fromRgb(t,r){const i=t.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(i){const s=i[2].split(/\s*,\s*/),n=i[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),an.fromArray(a,r)}return an.fromArray(s.map(a=>parseFloat(a)),r)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return an.fromArray(_ne(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),r)}return null}static fromHex(t,r=new an){if(t.length!==4&&t.length!==7||t[0]!=="#")return null;const i=t.length===4?4:8,s=(1<<i)-1;let n=Number("0x"+t.substr(1));return isNaN(n)?null:(["b","g","r"].forEach(o=>{const a=n&s;n>>=i,r[o]=i===4?17*a:a}),r.a=1,r)}static fromArray(t,r=new an){return r._set(Number(t[0]),Number(t[1]),Number(t[2]),Number(t[3])),isNaN(r.a)&&(r.a=1),r._sanitize()}static fromString(t,r){const i=yne(t)?TV(t):null;return i&&an.fromArray(i,r)||an.fromRgb(t,r)||an.fromHex(t,r)}static fromJSON(t){return t&&new an([t[0],t[1],t[2],t[3]/255])}static toUnitRGB(t){return t!=null?[t.r/255,t.g/255,t.b/255]:null}static toUnitRGBA(t){return t!=null?[t.r/255,t.g/255,t.b/255,t.a!=null?t.a:1]:null}constructor(t){this.r=255,this.g=255,this.b=255,this.a=1,t&&this.setColor(t)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(t){return typeof t=="string"?an.fromString(t,this):Array.isArray(t)?an.fromArray(t,this):(this._set(t.r??0,t.g??0,t.b??0,t.a??1),t instanceof an||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const t=this.r.toString(16),r=this.g.toString(16),i=this.b.toString(16);return`#${t.length<2?"0"+t:t}${r.length<2?"0"+r:r}${i.length<2?"0"+i:i}`}toCss(t=!1){const r=this.r+", "+this.g+", "+this.b;return t?`rgba(${r}, ${this.a})`:`rgb(${r})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(t=an.AlphaMode.ALWAYS){const r=_O(this.r),i=_O(this.g),s=_O(this.b);return t===an.AlphaMode.ALWAYS||this.a!==1?[r,i,s,_O(255*this.a)]:[r,i,s]}clone(){return new an(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(t){return t!=null&&t.r===this.r&&t.g===this.g&&t.b===this.b&&t.a===this.a}_sanitize(){return this.r=Math.round(vO(this.r,0,255)),this.g=Math.round(vO(this.g,0,255)),this.b=Math.round(vO(this.b,0,255)),this.a=vO(this.a,0,1),this}_set(t,r,i,s){this.r=t,this.g=r,this.b=i,this.a=s}}an.prototype.declaredClass="esri.Color",function(e){var t;(t=e.AlphaMode||(e.AlphaMode={}))[t.ALWAYS=0]="ALWAYS",t[t.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(an||(an={}));const ot=an;function $D(e){return e&&(typeof e.on=="function"||typeof e.addEventListener=="function")}function ey(e,t,r){if(!$D(e))throw new TypeError("target is not a Evented or EventTarget object");if("on"in e)return e.on(t,r);if(Array.isArray(t)){const i=t.slice();for(const s of i)e.addEventListener(s,r);return{remove(){for(const s of i)e.removeEventListener(s,r)}}}return e.addEventListener(t,r),{remove(){e.removeEventListener(t,r)}}}function eoe(e,t,r){if(!$D(e))throw new TypeError("target is not a Evented or EventTarget object");if("once"in e)return e.once(t,r);const i=ey(e,t,s=>{i.remove(),r.call(e,s)});return{remove(){i.remove()}}}const Gwe={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function jwe({key:e}){return Gwe[e]||e}function Jx(e){return Xo(()=>e.forEach(t=>t!=null&&t.remove()))}function Xo(e){return{remove:()=>{e&&(e(),e=void 0)}}}function fht(e){return Xo(e!=null?()=>e.destroy():void 0)}function Lu(e,t){return e!=null?t(e):null}function Sl(e,t){return LD(e,t),e}function LD(e,t){if(e==null)throw new Error(t??"value is None")}function Re(e){return e?.destroy(),null}function De(e){return e?.dispose(),null}function xi(e){return e?.remove(),null}function $c(e){return e?.abort(),null}function Mi(e){return e?.release(),null}function Hwe(e,t,r){return e!=null&&t!=null?r!=null?r(e,t):e.equals(t):e===t}function s2(e){return null}function mht(e,t){const r=new Array;for(const i of e)r.push(i!=null?t(i):null);return r}function ght(e,t){for(const r of e)Lu(r,t)}function yht(e){return e}function Wwe(e){return{setTimeout:(t,r)=>{const i=e.setTimeout(t,r);return{remove:()=>e.clearTimeout(i)}}}}const b3=Wwe(globalThis);function qwe(e,t){return e.replaceAll(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(r,i)=>i===""?"$":(um(i,t)??"").toString())}class toe{constructor(t,r,i){this.name=t,this.details=i,this.message=(r&&qwe(r,i))??""}toString(){return"["+this.name+"]: "+this.message}}class G extends toe{constructor(t,r,i){super(t,r,i)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(t,r)=>{if(r&&typeof r=="object"&&typeof r.toJSON=="function")return r;try{return ye(r)}catch{return"[object]"}}))}}catch(t){throw K.getLogger("esri.core.Error").error(t),t}return{name:this.name,message:this.message,details:this.details}}static fromJSON(t){return new G(t.name,t.message,t.details)}}G.prototype.type="error";function Cr(e="Aborted"){return new G("AbortError",e)}function Jt(e,t="Aborted"){if(Hs(e))throw Cr(t)}function DD(e){return e!=null?"aborted"in e?e:e.signal:e}function Hs(e){const t=DD(e);return t!=null&&t.aborted}function W1(e){if($s(e))throw e}function lq(e){if(!$s(e))throw e}function Ws(e,t){const r=DD(e);if(r!=null){if(!r.aborted)return eoe(r,"abort",()=>t());t()}}function ND(e,t){const r=DD(e);if(r!=null)return Jt(r),eoe(r,"abort",()=>t(Cr()))}function Xwe(e,t){return DD(t)==null?e:new Promise((r,i)=>{let s=Ws(t,()=>i(Cr()));const n=()=>s=xi(s);e.then(n,n),e.then(r,i)})}function $s(e){return e?.name==="AbortError"}async function v8(e){try{return await e}catch(t){if(!$s(t))throw t;return}}async function _ht(e,t=K.getLogger("esri")){try{return await e}catch(r){$s(r)||t.error(r)}}async function Sc(e){if(!e)return;if(typeof e.forEach!="function"){const r=Object.keys(e),i=r.map(o=>e[o]),s=await Sc(i),n={};return r.map((o,a)=>n[o]=s[a]),n}const t=e;return Promise.allSettled(t).then(r=>Array.from(t,(i,s)=>{const n=r[s];return n.status==="fulfilled"?{promise:i,value:n.value}:{promise:i,error:n.reason}}))}async function b8(e){return(await Sc(e)).filter(t=>!!t.value).map(t=>t.value)}function rA(e,t=void 0,r){const i=new AbortController;return Ws(r,()=>i.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(t)},e);Ws(i,()=>{o&&(clearTimeout(o),n(Cr()))})})}function zc(e){return e&&typeof e.then=="function"}function w8(e){return zc(e)?e:Promise.resolve(e)}function zV(e,t=-1){let r,i,s,n,o=null;const a=(...l)=>{if(r){i=l,n&&n.reject(Cr()),n=Ys();const p=n.promise;if(o){const g=o;o=null,g.abort()}return p}if(s=n||Ys(),n=null,t>0){const p=new AbortController;r=w8(e(...l,p.signal));const g=r;rA(t).then(()=>{r===g&&(n?p.abort():o=p)})}else r=1,r=w8(e(...l));const c=()=>{const p=i;i=s=r=o=null,p!=null&&a(...p)},u=r,d=s;return u.then(c,c),u.then(d.resolve,d.reject),d.promise};return a}function Ys(){let e,t;const r=new Promise((s,n)=>{e=s,t=n}),i=s=>{e(s)};return i.resolve=s=>e(s),i.reject=s=>t(s),i.timeout=(s,n)=>b3.setTimeout(()=>i.reject(n),s),i.promise=r,i}function vht(e,t){return e.then(t,t)}async function cq(e){await Promise.resolve(),Jt(e)}function Zwe(e){return e&&e.release&&typeof e.release=="function"}function Ywe(e){return e&&e.acquire&&typeof e.acquire=="function"}class fn{constructor(t,r,i,s=1,n=0){if(this._ctor=t,this._acquireFunction=r,this._releaseFunction=i,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this._ctor)for(let o=0;o<n;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...t){let r;if(fn.test.disabled)r=new this._ctor;else{if(this._pool.length===0){const i=this.allocationSize;for(let s=0;s<i;s++)this._pool[s]=new this._ctor}r=this._pool.pop()}return this._acquireFunction?this._acquireFunction(r,...t):Ywe(r)&&r.acquire(...t),r}release(t){t&&!fn.test.disabled&&(this._releaseFunction?this._releaseFunction(t):Zwe(t)&&t.release(),this._pool.push(t))}prune(t=this._initialSize){if(!(t>=this._pool.length)){for(let r=t;r<this._pool.length;++r){const i=this._pool[r];this._dispose(i)}this._pool.length=t}}_dispose(t){t.dispose&&typeof t.dispose=="function"&&t.dispose()}}fn.test={disabled:!1};function Jwe(e){e.length=0}class Ol{constructor(t=50,r=50){this._pool=new fn(Array,void 0,Jwe,r,t)}acquire(){return this._pool.acquire()}release(t){this._pool.release(t)}prune(){this._pool.prune(0)}static acquire(){return I5.acquire()}static release(t){return I5.release(t)}static prune(){I5.prune()}}const I5=new Ol(100);class roe extends fn{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=s2(this._set)}acquire(...t){const r=super.acquire(...t);return this._set.delete(r),r}release(t){t&&!this._set.has(t)&&(super.release(t),this._set.add(t))}_dispose(t){this._set.delete(t),super._dispose(t)}}const bO=[];function Kx(e){bO.push(e),bO.length===1&&queueMicrotask(()=>{const t=bO.slice();bO.length=0;for(const r of t)r()})}class hm{constructor(t,r=30){this.name=t,this._counter=0,this._samples=new Array(r)}record(t){t!=null&&(this._samples[++this._counter%this._samples.length]=t)}get median(){return this._samples.slice().sort((t,r)=>t-r)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((t,r)=>t+r,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}}var x8;(function(e){const t=(n,o,a,l)=>{let c=o,u=o;const d=a>>>1,p=n[c-1];for(;u<=d;){u=c<<1,u<a&&l(n[u-1],n[u])<0&&++u;const g=n[u-1];if(l(g,p)<=0)break;n[c-1]=g,c=u}n[c-1]=p},r=(n,o)=>n<o?-1:n>o?1:0;function i(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let u=a>>>1;u>o;u--)t(n,u,a,l);const c=o+1;for(let u=a-1;u>o;u--){const d=n[o];n[o]=n[u],n[u]=d,t(n,c,u,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let u=a>>>1;u>o;u--)t(n,u,a,l),yield;const c=o+1;for(let u=a-1;u>o;u--){const d=n[o];n[o]=n[u],n[u]=d,t(n,c,u,l),yield}}e.sort=i,e.iterableSort=s})(x8||(x8={}));const uq=x8,Kwe=1.5,Qwe=1.1;class Mt{constructor(t){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new Fne,t&&(t.initialSize&&(this.data=new Array(t.initialSize)),t.allocator&&(this._allocator=t.allocator),t.deallocator!==void 0&&(this._deallocator=t.deallocator),t.shrink&&(this._shrink=()=>hq(this)))}toArray(){return this.data.slice(0,this.length)}filter(t){const r=new Array;for(let i=0;i<this._length;i++){const s=this.data[i];t(s)&&r.push(s)}return r}at(t){if((t=Math.trunc(t)||0)<0&&(t+=this._length),!(t<0||t>=this._length))return this.data[t]}includes(t,r){const i=this.data.indexOf(t,r);return i!==-1&&i<this.length}get length(){return this._length}set length(t){if(t>this._length){if(this._allocator){for(;this._length<t;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=t}else{if(this._deallocator)for(let r=t;r<this._length;++r)this.data[r]=this._deallocator(this.data[r]);this._length=t,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(t){this.data[this._length++]=t}pushArray(t,r=t.length){for(let i=0;i<r;i++)this.data[this._length++]=t[i]}fill(t,r){for(let i=0;i<r;i++)this.data[this._length++]=t}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const t=this.data[this._length];return++this._length,t}unshift(t){this.data.unshift(t),this._length++,hq(this)}pop(){if(this.length===0)return;const t=this.data[this.length-1];return this.length=this.length-1,this._shrink(),t}remove(t){const r=p8(this.data,t,this.length,this._hint);if(r!==-1)return this.data.splice(r,1),this.length=this.length-1,t}removeUnordered(t){return this.removeUnorderedIndex(p8(this.data,t,this.length,this._hint))}removeUnorderedIndex(t){if(!(t>=this.length||t<0))return this.swapElements(t,this.length-1),this.pop()}removeUnorderedMany(t,r=t.length,i){this.length=wwe(this.data,t,this.length,r,this._hint,i),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(t,r){if(t>=this.length||r>=this.length||t===r)return;const i=this.data[t];this.data[t]=this.data[r],this.data[r]=i}sort(t){uq.sort(this.data,0,this.length,t)}iterableSort(t){return uq.iterableSort(this.data,0,this.length,t)}some(t,r){for(let i=0;i<this.length;++i)if(t.call(r,this.data[i],i,this.data))return!0;return!1}find(t,r){for(let i=0;i<this.length;++i){const s=this.data[i];if(t.call(r,s,i))return s}}filterInPlace(t,r){let i=0;for(let s=0;s<this._length;++s){const n=this.data[s];t.call(r,n,s,this.data)&&(this.data[s]=this.data[i],this.data[i]=n,i++)}if(this._deallocator)for(let s=i;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=i,this._shrink(),this}forAll(t,r){const i=this.length,s=this.data;for(let n=0;n<i;++n)t.call(r,s[n],n,s)}forEach(t,r){for(let i=0;i<this.length;++i)t.call(r,this.data[i],i,this.data)}map(t,r){const i=new Array(this.length);for(let s=0;s<this.length;++s)i[s]=t.call(r,this.data[s],s,this.data);return i}reduce(t,r){let i=r;for(let s=0;s<this.length;++s)i=t(i,this.data[s],s,this.data);return i}has(t){const r=this.length,i=this.data;for(let s=0;s<r;++s)if(i[s]===t)return!0;return!1}}function hq(e){e.data.length>Kwe*e.length&&(e.data.length=Math.floor(e.length*Qwe))}function bht(e){return e}function ioe(e){return 1e3*e}function BV(e){return .001*e}function exe(){return performance.now()}class txe{constructor(t){this.phases=t,this.paused=!1,this.ticks=-1,this.removed=!1}}class rxe{constructor(t){this.callback=t,this.isActive=!0}remove(){this.isActive=!1}}let T8=0,S8=0;const D2={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},E8=["prepare","preRender","render","postRender","update","finish"],C8=[],i1=new Mt;class ixe{constructor(t){this._task=t}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}}const r$={frameTasks:i1,willDispatch:!1,clearFrameTasks:sxe,dispatch:ooe,executeFrameTasks:oxe};function w3(e){const t=new rxe(e);return C8.push(t),r$.willDispatch||(r$.willDispatch=!0,Kx(ooe)),t}function Qx(e){const t=new txe(e);return i1.push(t),i$==null&&(T8=performance.now(),i$=requestAnimationFrame(soe)),new ixe(t)}let i$=null;function sxe(e=!1){i1.forAll(t=>{t.removed=!0}),e&&noe()}function nxe(e){S8=Math.max(0,e)}function soe(){const e=performance.now();i$=null,i$=i1.length>0?requestAnimationFrame(soe):null,r$.executeFrameTasks(e)}function oxe(e){const t=e-T8;T8=e;const r=S8>0?S8:1e3/60,i=Math.max(0,t-r);D2.time=e,D2.frameDuration=r-i;for(let s=0;s<E8.length;s++){const n=performance.now(),o=E8[s];i1.forAll(a=>{a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(D2.elapsedFrameTime=performance.now()-e,D2.deltaTime=a.ticks===0?0:t,a.phases[o]?.call(a,D2)))}),axe[s].record(performance.now()-n)}noe(),lxe.record(performance.now()-e)}const wO=new Mt;function noe(){i1.forAll(e=>{e.removed&&wO.push(e)}),i1.removeUnorderedMany(wO.data,wO.length),wO.clear()}function ooe(){for(;C8.length;){const e=C8.shift();e.isActive&&e.callback()}r$.willDispatch=!1}function wht(e=1,t){const r=Ys(),i=()=>{Hs(t)?r.reject(Cr()):e===0?r():(--e,Kx(()=>i()))};return i(),r.promise}const axe=E8.map(e=>new hm(e)),lxe=new hm("total");function hM(e,t){for(const r of e.entries())if(t(r[0]))return!0;return!1}let cxe=0;const uxe=0;function Nl(){return++cxe}function Lc(e){return e.__accessor__??null}function hxe(e,t){return e!=null&&e.metadatas&&e.metadatas[t]!=null}function dM(e,t,r){return r?s$(e,t,{policy:r,path:""}):s$(e,t,null)}function s$(e,t,r){return t?Object.keys(t).reduce((i,s)=>{const n=s;let o=null,a="merge";if(r&&(o=r.path?`${r.path}.${s}`:s,a=r.policy(o)),a==="replace"||a==="replace-arrays"&&Array.isArray(i[n]))return i[n]=t[n],i;if(i[n]===void 0)return i[n]=ye(t[n]),i;let l=i[n],c=t[n];if(l===c)return i;if(Array.isArray(c)||Array.isArray(i))l=l?Array.isArray(l)?i[n]=l.concat():i[n]=[l]:i[n]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach(u=>{l.includes(u)||l.push(u)}));else if(c&&typeof c=="object")if(r){const u=r.path;r.path=o,i[n]=s$(l,c,r),r.path=u}else i[n]=s$(l,c,null);else i.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(i[n]=c);return i},e||{}):e}function aoe(e){return Array.isArray(e)?e:e.split(".")}function dq(e){return e.includes(",")?e.split(",").map(t=>t.trim()):[e.trim()]}function dxe(e){if(Array.isArray(e)){const t=[];for(const r of e)t.push(...dq(r));return t}return dq(e)}function loe(e,t,r,i){const s=dxe(t);if(s.length!==1){const n=s.map(o=>i(e,o,r));return Jx(n)}return i(e,s[0],r)}function VV(e){let t=!1;return()=>{t||(t=!0,e())}}function coe(e,t){const r=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const s=parseInt(r,10);if(!isNaN(s))return Array.isArray(t)?t[s]:t.at(s)}const i=Lc(t);return hxe(i,r)?i.get(r):t[r]}function uoe(e,t,r){if(e==null)return e;const i=coe(t[r],e);return!i&&r<t.length-1?void 0:r===t.length-1?i:uoe(i,t,r+1)}function x3(e,t,r=0){return typeof t!="string"||t.includes(".")?uoe(e,aoe(t),r):coe(t,e)}function n$(e,t){return x3(e,t)}function pq(e,t){return x3(t,e)!==void 0}var bi;(function(e){e[e.Dirty=1]="Dirty",e[e.Overriden=2]="Overriden",e[e.Computing=4]="Computing",e[e.NonNullable=8]="NonNullable",e[e.HasDefaultValue=16]="HasDefaultValue",e[e.DepTrackingInitialized=32]="DepTrackingInitialized",e[e.AutoTracked=64]="AutoTracked",e[e.ExplicitlyTracking=128]="ExplicitlyTracking"})(bi||(bi={}));const o$={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},VS=[];let rC=o$;function Ft(e){rC.onObservableAccessed(e)}let pM=!1,fM=!1;function Rm(e,t,r){if(pM)return GV(e,t,r);hoe(e);const i=t.call(r);return doe(),i}function pxe(e,t){return Rm(o$,e,t)}function GV(e,t,r){const i=pM;pM=!0,hoe(e);let s=null;try{s=t.call(r)}catch(n){fM&&K.getLogger("esri.core.accessorSupport.tracking").error(n)}return doe(),pM=i,s}function hoe(e){rC=e,VS.push(e)}function doe(){const e=VS.length;if(e>1){const t=VS.pop();rC=VS[e-2],t.onTrackingEnd()}else if(e===1){const t=VS.pop();rC=o$,t.onTrackingEnd()}else rC=o$}function poe(e,t){const r=t.observerObject;if(r.flags&bi.DepTrackingInitialized)return;const i=fM;fM=!1,r.flags&bi.AutoTracked?GV(t,t.metadata.get,e):foe(e,t),fM=i}const fxe=[];function foe(e,t){const r=t.observerObject;r.flags&bi.ExplicitlyTracking||(r.flags|=bi.ExplicitlyTracking,GV(t,()=>{const i=t.metadata.dependsOn||fxe;for(const s of i)if(typeof s!="string"||s.includes(".")){const n=aoe(s);for(let o=0,a=e;o<n.length&&a!=null&&typeof a=="object";++o)a=fq(a,n[o],o!==n.length-1)}else fq(e,s,!1)}),r.flags&=~bi.ExplicitlyTracking)}function fq(e,t,r){const i=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const n=parseInt(i,10);if(!isNaN(n))return Array.isArray(e)?e[n]:e.at(n)}const s=Lc(e);if(s){const n=s.propertiesByName.get(i);n&&(Ft(n.observerObject),poe(e,n))}return r?e[i]:void 0}class FD{constructor(t){this._accessed=[],this._handles=[],this._observerObject=new mxe(t),mq.register(this,new WeakRef(this._observerObject),this)}destroy(){mq.unregister(this._observerObject),this._accessed.length=0,this._observerObject?.destroy(),this.clear()}onObservableAccessed(t){const r=this._accessed;r.includes(t)||r.push(t)}onTrackingEnd(){const t=this._handles,r=this._accessed,i=this._observerObject;for(let s=0;s<r.length;++s)t.push(r[s].observe(i));r.length=0}clear(){const t=this._handles;for(let r=0;r<t.length;++r)t[r].remove();t.length=0}}class mxe{constructor(t){this._notify=t,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const t=this._invalidCount;if(t===1)return this._invalidCount=0,void this._notify();this._invalidCount=t>0?t-1:0}destroy(){this.destroyed=!0,this._notify=gxe}}const mq=new FinalizationRegistry(e=>{e.deref()?.destroy()});function gxe(){}let Cx=!1;const a$=[];function moe(e,t){let r=new FD(n),i=null,s=!1;function n(){if(!r||s)return;if(Cx)return void _oe(n);const a=i;r.clear(),Cx=!0,s=!0,i=Rm(r,e),s=!1,Cx=!1,t(i,a),voe()}function o(){r&&(r.destroy(),r=null,i=null)}return s=!0,i=Rm(r,e),s=!1,{remove:o}}function goe(e,t){let r=new FD(s),i=null;function s(){t(i,o)}function n(){r&&(r.destroy(),r=null),i=null}function o(){return r?(r.clear(),i=Rm(r,e),i):null}return o(),{remove:n}}function yoe(e){let t=new FD(i),r=!1;function i(){t&&!r&&(Cx?_oe(i):(t.clear(),Cx=!0,r=!0,Rm(t,e),r=!1,Cx=!1,voe()))}function s(){t&&(t.destroy(),t=null)}return r=!0,Rm(t,e),r=!1,{remove:s}}function _oe(e){a$.includes(e)||a$.unshift(e)}function voe(){for(;a$.length;)a$.pop()()}var iC;(function(e){e[e.Untracked=0]="Untracked",e[e.Tracked=1]="Tracked"})(iC||(iC={}));class iA{constructor(){this.uid=Nl(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(t,r,i,s,n){return this.pool.acquire(iC.Untracked,t,r,i,s,n,UV)}static acquireTracked(t,r,i,s){return this.pool.acquire(iC.Tracked,t,r,i,null,null,s)}notify(t,r){this.type===iC.Untracked?this.callback.call(this.target,t,r,this.path,this.target):this.callback.call(null,t,r,void 0,void 0)}acquire(t,r,i,s,n,o,a){this.uid=Nl(),this.removed=!1,this.type=t,this.oldValue=r,this.callback=i,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=Nl(),this.removed=!0}}iA.pool=new roe(iA);const mM=new Ol,gm=new Set;let l$;function c$(e){gm.delete(e),gm.add(e),l$||(l$=w3(vxe))}function yxe(e){if(e.removed)return;const t=e.oldValue,r=e.getValue();e.equals(t,r)||(e.oldValue=r,e.notify(r,t))}function _xe(e){for(const t of gm.values())t.target===e&&(t.removed=!0)}function vxe(){let e=10;for(;l$&&e--;){l$=null;const t=bxe(),r=mM.acquire();for(const i of t){const s=i.uid;yxe(i),s===i.uid&&i.removed&&r.push(i)}for(const i of gm)i.removed&&(r.push(i),gm.delete(i));for(const i of r)iA.pool.release(i);mM.release(r),mM.release(t),A8.forEach(i=>i())}}function bxe(){const e=mM.acquire();e.length=gm.size;let t=0;for(const r of gm)e[t]=r,++t;return gm.clear(),e}const A8=new Set;function boe(e){return A8.add(e),{remove(){A8.delete(e)}}}function wxe(e,t,r){let i=loe(e,t,r,(s,n,o)=>{let a,l,c=goe(()=>x3(s,n),(u,d)=>{s.__accessor__.destroyed||a&&a.uid!==l?i.remove():(a||(a=iA.acquireUntracked(u,o,d,s,n),l=a.uid),c$(a))});return{remove:VV(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,c$(a)),a=null),i=c=null})}});return i}function xxe(e,t,r){const i=loe(e,t,r,(s,n,o)=>{let a=!1;return moe(()=>x3(s,n),(l,c)=>{s.__accessor__.destroyed?i.remove():a||(a=!0,UV(c,l)||o.call(s,l,c,n,s),a=!1)})});return i}function Txe(e,t,r,i=!1){return!e.__accessor__||e.__accessor__.destroyed?{remove(){}}:i?xxe(e,t,r):wxe(e,t,r)}function Sxe(e,t,r){let i,s,n=goe(e,(o,a)=>{i&&i.uid!==s?n.remove():(i||(i=iA.acquireTracked(o,t,a,r),s=i.uid),c$(i))});return{remove:VV(()=>{n.remove(),i&&(i.uid!==s||i.removed||(i.removed=!0,c$(i)),i=null),n=null})}}function Exe(e,t,r){let i=!1;return moe(e,(s,n)=>{i||(i=!0,r(n,s)||t(s,n),i=!1)})}function Cxe(e,t,r=!1,i=jne){return r?Exe(e,t,i):Sxe(e,t,i)}function gq(e){return hM(gm,t=>t.oldValue===e)}function le(e,t,r={}){return jV(e,t,r,woe)}function Dc(e,t,r={}){return jV(e,t,r,xoe)}function jV(e,t,r={},i){let s=null;const n=r.once?(o,a)=>{i(o)&&(xi(s),t(o,a))}:(o,a)=>{i(o)&&t(o,a)};if(s=Cxe(e,n,r.sync,r.equals),r.initial){const o=e();n(o,o)}return s}function qo(e,t,r,i={}){let s=null,n=null,o=null;function a(){s&&n&&(n.remove(),i.onListenerRemove?.(s),s=null,n=null)}function l(u){i.once&&i.once&&xi(o),r(u)}const c=le(e,(u,d)=>{a(),$D(u)&&(s=u,n=ey(u,t,l),i.onListenerAdd?.(u))},{sync:i.sync,initial:!0});return o=Xo(()=>{c.remove(),a()}),o}function eT(e,t){return Axe(e,xoe,t)}function Axe(e,t,r){if(Hs(r))return Promise.reject(Cr());const i=e();if(t?.(i))return Promise.resolve(i);let s=null;function n(){s=xi(s)}return new Promise((o,a)=>{s=Jx([Ws(r,()=>{n(),a(Cr())}),jV(e,l=>{n(),o(l)},{sync:!1,once:!0},t??woe)])})}function woe(e){return!0}function xoe(e){return!!e}const Vr={sync:!0},Rr={initial:!0},_s={sync:!0,initial:!0},Oxe="modulepreload",yq={},Rxe="./",ue=function(t,r){return!r||r.length===0?t():Promise.all(r.map(i=>{if(i=`${Rxe}${i}`,i in yq)return;yq[i]=!0;const s=i.endsWith(".css"),n=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${n}`))return;const o=document.createElement("link");if(o.rel=s?"stylesheet":Oxe,s||(o.as="script",o.crossOrigin=""),o.href=i,document.head.appendChild(o),s)return new Promise((a,l)=>{o.addEventListener("load",a),o.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>t())},Pxe=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,Mxe={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function _q(e){const t=e?.match(Pxe);if(!t)return null;const[,r,i,s]=t;if(!r)return null;let n=null,o=null,a=null;const{devext:l,qaext:c,www:u}=Mxe;if(i)if(n=r,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=u);else switch(r.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=u);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:n}}function Toe(e){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(e)}function Ixe(e){const t=atob(e),r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r.buffer}const $xe=K.getLogger("esri.core.urlUtils"),n2=Or.request,vq="esri/config: esriConfig.request.proxyUrl is not set.",Soe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,Eoe=/^\s*http:/i,Lxe=/^\s*https:/i,Dxe=/^\s*file:/i,Nxe=/:\d+$/,Fxe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,Uxe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),kxe=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");class vc{constructor(t=""){this.uri=t,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let r=this.uri.match(Uxe);this.scheme=r[2]||(r[1]?"":null),this.authority=r[4]||(r[3]?"":null),this.path=r[5],this.query=r[7]||(r[6]?"":null),this.fragment=r[9]||(r[8]?"":null),this.authority!=null&&(r=this.authority.match(kxe),this.user=r[3]||null,this.password=r[4]||null,this.host=r[6]||r[7],this.port=r[9]||null)}toString(){return this.uri}}const xO={},zxe=new vc(Or.applicationUrl);let ga=zxe;const Bxe=Vxe();let HV=Bxe;const WV=()=>ga,xht=()=>HV;function Vxe(){const e=ga.path,t=e.substring(0,e.lastIndexOf(e.split("/")[e.split("/").length-1]));return`${`${ga.scheme}://${ga.host}${ga.port!=null?`:${ga.port}`:""}`}${t}`}function Us(e){if(!e)return null;const t={path:null,query:null},r=new vc(e),i=e.indexOf("?");return r.query===null?t.path=e:(t.path=e.substring(0,i),t.query=Cv(r.query)),r.fragment&&(t.hash=r.fragment,r.query===null&&(t.path=t.path.substring(0,t.path.length-(r.fragment.length+1)))),t}function Cv(e){const t=e.split("&"),r={};for(const i of t){if(!i)continue;const s=i.indexOf("=");let n,o;s<0?(n=decodeURIComponent(i),o=""):(n=decodeURIComponent(i.slice(0,s)),o=decodeURIComponent(i.slice(s+1)));let a=r[n];typeof a=="string"&&(a=r[n]=[a]),Array.isArray(a)?a.push(o):r[n]=o}return r}function bq(e){return e&&typeof e=="object"&&"toJSON"in e&&typeof e.toJSON=="function"}function s1(e,t){return e?t&&typeof t=="function"?Object.keys(e).map(r=>encodeURIComponent(r)+"="+encodeURIComponent(t(r,e[r]))).join("&"):Object.keys(e).map(r=>{const i=e[r];if(i==null)return"";const s=encodeURIComponent(r)+"=",n=t&&t[r];return n?s+encodeURIComponent(n(i)):Array.isArray(i)?i.map(o=>bq(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):bq(i)?s+encodeURIComponent(JSON.stringify(i)):s+encodeURIComponent(i)}).filter(r=>r).join("&"):""}function Gxe(e=!1){let t,r=n2.proxyUrl;if(typeof e=="string"){t=Zxe(e);const i=T3(e);i&&(r=i.proxyUrl)}else t=!!e;if(!r)throw $xe.warn(vq),new G("urlutils:proxy-not-set",vq);return t&&O8()&&(r=KV(r)),Us(r)}function Tht(e){const t=T3(e);let r,i;if(t){const s=qV(t.proxyUrl);r=s.path,i=s.query?Cv(s.query):null}if(r){const s=Us(e);e=r+"?"+s.path;const n=s1({...i,...s.query});n&&(e=`${e}?${n}`)}return e}const N2={path:"",query:""};function qV(e){const t=e.indexOf("?");return t!==-1?(N2.path=e.slice(0,t),N2.query=e.slice(t+1)):(N2.path=e,N2.query=null),N2}function Coe(e){return e=(e=h$(e=eTe(e=qV(e).path),!0)).toLowerCase()}function jxe(e){const t={proxyUrl:e.proxyUrl,urlPrefix:Coe(e.urlPrefix)},r=n2.proxyRules,i=t.urlPrefix;let s=r.length;for(let n=0;n<r.length;n++){const o=r[n].urlPrefix;if(i.indexOf(o)===0){if(i.length===o.length)return-1;s=n;break}o.indexOf(i)===0&&(s=n+1)}return r.splice(s,0,t),s}function T3(e){const t=n2.proxyRules,r=Coe(e);for(let i=0;i<t.length;i++)if(r.indexOf(t[i].urlPrefix)===0)return t[i]}function Sht(e,t){if(!e||!t)return!1;e=u$(e),t=u$(t);const r=_q(e),i=_q(t);return r!=null&&i!=null?r.portalHostname===i.portalHostname:r==null&&i==null&&wl(e,t,!0)}function Hxe(e,t){return e=u$(e),t=u$(t),h$(e)===h$(t)}function u$(e){const t=(e=ld(e)).indexOf("/sharing");return t>0?e.substring(0,t):e.replace(/\/+$/,"")}function Aoe(e){const t=i=>i==null||i instanceof RegExp&&i.test(e)||typeof i=="string"&&e.startsWith(i),r=n2.interceptors;if(r){for(const i of r)if(Array.isArray(i.urls)){if(i.urls.some(t))return i}else if(t(i.urls))return i}return null}function wl(e,t,r=!1){if(!e||!t)return!1;const i=P8(e),s=P8(t);return!(!r&&i.scheme!==s.scheme)&&i.host!=null&&s.host!=null&&i.host.toLowerCase()===s.host.toLowerCase()&&i.port===s.port}function XV(e){if(typeof e=="string"){if(!Ec(e))return!0;e=P8(e)}if(wl(e,ga))return!0;const t=n2.trustedServers||[];for(let r=0;r<t.length;r++){const i=Wxe(t[r]);for(let s=0;s<i.length;s++)if(wl(e,i[s]))return!0}return!1}function Wxe(e){return xO[e]||(JV(e)||qp(e)?xO[e]=[new vc(ja(e))]:xO[e]=[new vc(`http://${e}`),new vc(`https://${e}`)]),xO[e]}function ja(e,t=HV,r){return qp(e)?r&&r.preserveProtocolRelative?e:ga.scheme==="http"&&ga.authority===cd(e).slice(2)?`http:${e}`:`https:${e}`:JV(e)?e:sf(e[0]==="/"?Qxe(t):t,e)}function ZV(e,t=HV,r){if(e==null||!Ec(e))return e;const i=ld(e),s=i.toLowerCase(),n=ld(t).toLowerCase().replace(/\/+$/,""),o=r?ld(r).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return e;const a=(d,p,g)=>(g=d.indexOf(p,g))===-1?d.length:g;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return e;e=i.slice(c);const u=n.slice(c-1).replaceAll(/[^/]+/g,"").length;if(u>0)for(let d=0;d<u;d++)e=`../${e}`;else e=`./${e}`;return e}function ld(e){return e=iTe(e=rTe(e=tTe(e=ja(e=e.trim()))))}function sf(...e){const t=e.filter(v3);if(!t||!t.length)return;const r=[];if(Ec(t[0])){const s=t[0],n=s.indexOf("//");n!==-1&&(r.push(s.slice(0,n+1)),Jxe(t[0])&&(r[0]+="/"),t[0]=s.slice(n+2))}else t[0][0]==="/"&&r.push("");const i=t.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<i.length;s++){const n=i[s];n===".."&&r.length>0&&r[r.length-1]!==".."?r.pop():(!n&&s===i.length-1||n&&(n!=="."||r.length===0))&&r.push(n)}return r.join("/")}function cd(e,t=!1){if(e==null||tT(e)||nf(e))return null;let r=e.indexOf("://");if(r===-1&&qp(e))r=2;else{if(r===-1)return null;r+=3}const i=e.indexOf("/",r);return i!==-1&&(e=e.slice(0,i)),t&&(e=h$(e,!0)),e}function Ec(e){return qp(e)||JV(e)}function tT(e){return e!=null&&e.slice(0,5)==="blob:"}function nf(e){return e!=null&&e.slice(0,5)==="data:"}function YV(e){const t=n1(e);return t&&t.isBase64?Ixe(t.data):null}function $5(e){return btoa(String.fromCharCode.apply(null,e)).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const qxe=/^data:(.*?)(;base64)?,(.*)$/;function n1(e){const t=e.match(qxe);if(!t)return null;const[,r,i,s]=t;return{mediaType:r,isBase64:!!i,data:s}}function Ooe(e){return e.isBase64?`data:${e.mediaType};base64,${e.data}`:`data:${e.mediaType},${e.data}`}function Eht(e){const t=YV(e);if(!t)return null;const r=n1(e);return new Blob([t],{type:r.mediaType})}function Cht(e,t){Xxe(e,t)}function Xxe(e,t){if(!e)return!1;const r=document.createElement("a");if(!("download"in r))return!1;const i=URL.createObjectURL(e);return r.download=t,r.href=i,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),!0}function qp(e){return e!=null&&e[0]==="/"&&e[1]==="/"}function JV(e){return e!=null&&Soe.test(e)}function Zxe(e){return e!=null&&Lxe.test(e)||ga.scheme==="https"&&qp(e)}function Yxe(e){return e!=null&&Eoe.test(e)||ga.scheme==="http"&&qp(e)}function Jxe(e){return e!=null&&Dxe.test(e)}function KV(e){return qp(e)?`https:${e}`:e.replace(Eoe,"https:")}function Kxe(){return ga.scheme==="http"}function O8(){return ga.scheme==="https"}function h$(e,t=!1){return qp(e)?e.slice(2):(e=e.replace(Soe,""),t&&e.length>1&&e[0]==="/"&&e[1]==="/"&&(e=e.slice(2)),e)}function Qxe(e){const t=e.indexOf("//"),r=e.indexOf("/",t+2);return r===-1?e:e.slice(0,r)}function QV(e){let t=0;if(Ec(e)){const i=e.indexOf("//");i!==-1&&(t=i+2)}const r=e.lastIndexOf("/");return r<t?e:e.slice(0,r+1)}function Aht(e,t){if(!e)return"";const r=Us(e).path.replace(/\/+$/,""),i=r.substring(r.lastIndexOf("/")+1);if(!t?.length)return i;const s=new RegExp(`.(${t.join("|")})$`,"ig");return i.replace(s,"")}function eTe(e){return e&&e[e.length-1]==="/"?e:`${e}/`}function Roe(e){return e.replace(/\/+$/,"")}function tTe(e){if(/^https?:\/\//i.test(e)){const t=qV(e);e=(e=t.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),t.query&&(e+=`?${t.query}`)}return e}function rTe(e){return e.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function iTe(e){const t=n2.httpsDomains;if(!Yxe(e))return e;const r=e.indexOf("/",7);let i;if(i=r===-1?e:e.slice(0,r),i=i.toLowerCase().slice(7),Nxe.test(i)){if(!i.endsWith(":80"))return e;i=i.slice(0,-3),e=e.replace(":80","")}return Kxe()&&i===ga.authority&&!Fxe.test(e)||(O8()&&i===ga.authority||t&&t.some(s=>i===s||i.endsWith(`.${s}`))||O8()&&!T3(e))&&(e=KV(e)),e}function R8(e,t,r){if(!(t&&r&&e&&Ec(e)))return e;const i=e.indexOf("//"),s=e.indexOf("/",i+2),n=e.indexOf(":",i+2),o=Math.min(s<0?e.length:s,n<0?e.length:n);return e.slice(i+2,o).toLowerCase()!==t.toLowerCase()?e:`${e.slice(0,i+2)}${r}${e.slice(o)}`}function P8(e){return typeof e=="string"?new vc(ja(e)):(e.scheme||(e.scheme=ga.scheme),e)}function Poe(e){return nTe.test(e)}function Moe(e,t){const r=Us(e),i=Object.keys(r.query||{});return i.length>0&&t&&t.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${i.join(", ")}.`),r.path}function e7(e,t,r){const i=Us(e),s=i.query||{};return s[t]=String(r),`${i.path}?${s1(s)}`}function gM(e,t){const r=Us(e),i=r.query||{};for(const n in t)i[n]=t[n];const s=s1(i);return s?`${r.path}?${s}`:r.path}function sTe(e){if(e==null)return null;const t=e.match(Ioe);return t?t[2]:null}function wq(e){if(e==null)return null;const t=e.match(Ioe);return t?{path:t[1],extension:t[2]}:{path:e,extension:null}}async function Oht(e){return typeof e=="string"?n1(e)??{data:e}:new Promise((t,r)=>{const i=new FileReader;i.readAsDataURL(e),i.onload=()=>t(n1(i.result)),i.onerror=s=>r(s)})}const Ioe=/([^.]*)\.([^\/]*)$/,nTe=/(^data:image\/svg|\.svg$)/i,$oe="20230615",Loe="1f5db620f7f53ad9484d45c023aeb6d5fbf0f873",Doe="4.27";let t7=Doe;t7="4.27.1";const oTe={async request(e,t){const{default:r}=await ue(()=>Promise.resolve().then(function(){return STe}),void 0),i=e.options,s=i.responseType;i.signal=t?.signal,i.responseType=s==="native"||s==="native-request-init"?"native-request-init":s&&["blob","json","text"].includes(s)&&Aoe(e.url)?.after?s:"array-buffer";const n=await r(e.url,i),o={data:n.data,httpStatus:n.httpStatus,ssl:n.ssl};switch(n.requestOptions?.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let ar;function aTe(e){ar=e}function Rht(e){const t=ar?.findCredential(e);return t?.token?e7(e,"token",t.token):e}ne("host-webworker");function h(e,t,r,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,r,o):s(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o}function Pht(e,t,r,i){function s(n){return n instanceof r?n:new r(function(o){o(n)})}return new(r||(r=Promise))(function(n,o){function a(u){try{c(i.next(u))}catch(d){o(d)}}function l(u){try{c(i.throw(u))}catch(d){o(d)}}function c(u){u.done?n(u.value):s(u.value).then(a,l)}c((i=i.apply(e,t||[])).next())})}const lTe=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function Noe(e){const t=cd(e,!0);return!!t&&t.endsWith(".arcgis.com")&&!lTe.includes(t)&&!e.endsWith("/sharing/rest/generateToken")}function Foe(e,t,r=!1,i){return new Promise((s,n)=>{if(Hs(i))return void n(xq());let o=()=>{c(),n(new Error(`Unable to load ${t}`))},a=()=>{const u=e;c(),s(u)},l=()=>{if(!e)return;const u=e;c(),u.src="",n(xq())};const c=()=>{ne("esri-image-decode")||(e.removeEventListener("error",o),e.removeEventListener("load",a)),o=null,a=null,e=null,i?.removeEventListener("abort",l),l=null,r&&URL.revokeObjectURL(t)};i?.addEventListener("abort",l),ne("esri-image-decode")?e.decode().then(a,o):(e.addEventListener("error",o),e.addEventListener("load",a))})}function xq(){try{return new DOMException("Aborted","AbortError")}catch{const e=new Error;return e.name="AbortError",e}}const Uoe="Timeout exceeded";function cTe(){return new Error(Uoe)}function Mht(e){return typeof e=="object"&&!!e&&"message"in e&&e.message===Uoe}function uTe(e){Or.request.crossOriginNoCorsDomains||(Or.request.crossOriginNoCorsDomains={});const t=Or.request.crossOriginNoCorsDomains;for(let r of e)r=r.toLowerCase(),/^https?:\/\//.test(r)?t[cd(r)??""]=0:(t[cd("http://"+r)??""]=0,t[cd("https://"+r)??""]=0)}function hTe(e){const t=Or.request.crossOriginNoCorsDomains;if(t){let r=cd(e);if(r)return r=r.toLowerCase(),!wl(r,WV())&&t[r]<Date.now()-36e5}return!1}async function dTe(e){const t=Or.request.crossOriginNoCorsDomains,r=cd(e);t&&r&&(t[r.toLowerCase()]=Date.now());const i=Us(e);e=i.path,i.query?.f==="json"&&(e+="?f=json");try{await fetch(e,{mode:"no-cors",credentials:"include"})}catch{}}async function ii(e,t){e instanceof URL&&(e=e.toString()),t?.query instanceof URLSearchParams&&(t.query=Cv(t.query.toString().replaceAll("+"," ")));const r=nf(e),i=tT(e);i||r||(e=ld(e));const s={url:e,requestOptions:{...t}};let n=Aoe(e);if(n){const c=await bTe(n,s);if(c!=null)return{data:c,getHeader:r7,httpStatus:200,requestOptions:s.requestOptions,url:s.url};n.after||n.error||(n=null)}if(e=s.url,(t=s.requestOptions).responseType==="image"&&(ne("host-webworker")||ne("host-node")))throw Dp("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s);if(t.method==="head"){if(t.body)throw Dp("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(r||i)throw Dp("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await yTe(),d$)return d$.execute(e,t);const o=new AbortController;Ws(t,()=>o.abort());const a={controller:o,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:n,params:s,redoRequest:!1,useIdentity:jh.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await xTe(a);return n?.after?.(l),l}let d$;const jh=Or.request,koe="FormData"in globalThis,pTe=[499,498,403,401],fTe=["COM_0056","COM_0057","SB_0008"],mTe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],r7=()=>null,p$=Symbol();function gTe(e){const t=cd(e);t&&!ii._corsServers.includes(t)&&ii._corsServers.push(t)}function Tq(e){const t=cd(e);return!t||t.endsWith(".arcgis.com")||ii._corsServers.includes(t)||XV(t)}function Dp(e,t,r,i){let s="Error";const n={url:r.url,requestOptions:r.requestOptions,getHeader:r7,ssl:!1};if(t instanceof G)return t.details?(t.details=ye(t.details),t.details.url=r.url,t.details.requestOptions=r.requestOptions):t.details=n,t;if(t){const o=i&&(c=>i.headers.get(c)),a=i?.status,l=t.message;l&&(s=l),o&&(n.getHeader=o),n.httpStatus=(t.httpCode!=null?t.httpCode:t.code)||a||0,n.subCode=t.subcode,n.messageCode=t.messageCode,typeof t.details=="string"?n.messages=[t.details]:n.messages=t.details,n.raw=p$ in t?t[p$]:t}return $s(t)?Cr():new G(e,s,n)}async function yTe(){ne("host-webworker")?d$||(d$=await ue(()=>import("./request.01ef9741.js"),[])):ii._abortableFetch||(ii._abortableFetch=globalThis.fetch.bind(globalThis))}async function M8(){ar||await ue(()=>Promise.resolve().then(function(){return OOe}),void 0)}async function _Te(e){const t=e.params.url,r=e.params.requestOptions,i=e.controller.signal,s=r.body;let n=null,o=null;if(koe&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),e.fetchOptions={cache:r.cacheBust&&!("polyfill"in ii._abortableFetch)?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:r.method==="head"?"HEAD":"GET",mode:"cors",priority:jh.priority,redirect:"follow",signal:i},(n||o)&&(e.fetchOptions.body=n||o),r.authMode==="anonymous"&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(t)||r.query?.token||n?.get("token")),!e.hasToken&&Or.apiKey&&Noe(t)&&(r.query||(r.query={}),r.query.token=Or.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!zoe(t)&&!Hs(i)){let a;r.authMode==="immediate"?(await M8(),a=await ar.getCredential(t,{signal:i}),e.credential=a):r.authMode==="no-prompt"?(await M8(),a=await ar.getCredential(t,{prompt:!1,signal:i}).catch(()=>{}),e.credential=a):ar&&(a=ar.findCredential(t)),a&&(e.credentialToken=a.token,e.useSSL=!!a.ssl)}}function zoe(e){return mTe.some(t=>t.test(e))}async function vTe(e){let t=e.params.url;const r=e.params.requestOptions,i=e.fetchOptions??{},s=tT(t)||nf(t),n=r.responseType||"json",o=s?0:r.timeout!=null?r.timeout:jh.timeout;let a=!1;if(!s){e.useSSL&&(t=KV(t)),r.cacheBust&&i.cache==="default"&&(t=e7(t,"request.preventCache",Date.now()));let p={...r.query};e.credentialToken&&(p.token=e.credentialToken);let g=s1(p);ne("esri-url-encodes-apostrophe")&&(g=g.replaceAll("'","%27"));const y=t.length+1+g.length;let _;a=r.method==="delete"||r.method==="post"||r.method==="put"||!!r.body||y>jh.maxUrlLength;const v=r.useProxy||!!T3(t);if(v){const w=Gxe(t);_=w.path,!a&&_.length+1+y>jh.maxUrlLength&&(a=!0),w.query&&(p={...w.query,...p})}if(i.method==="HEAD"&&(a||v)){if(a)throw y>jh.maxUrlLength?Dp("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params):Dp("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params);if(v)throw Dp("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}a?(i.method=r.method==="delete"?"DELETE":r.method==="put"?"PUT":"POST",r.body?t=gM(t,p):(i.body=s1(p),i.headers||(i.headers={}),i.headers["Content-Type"]="application/x-www-form-urlencoded")):t=gM(t,p),v&&(e.useProxy=!0,t=`${_}?${t}`),p.token&&koe&&i.body instanceof FormData&&!Toe(t)&&i.body.set("token",p.token),r.hasOwnProperty("withCredentials")?e.withCredentials=r.withCredentials:wl(t,WV())||(XV(t)||ar&&ar.findServerInfo(t)?.webTierAuth)&&(e.withCredentials=!0),e.withCredentials&&(i.credentials="include",hTe(t)&&await dTe(a?gM(t,p):t))}let l,c,u=0,d=!1;o>0&&(u=setTimeout(()=>{d=!0,e.controller.abort()},o));try{if(r.responseType==="native-request-init")c=i,c.url=t;else if(r.responseType!=="image"||i.cache!=="default"||i.method!=="GET"||a||wTe(r.headers)||!s&&!e.useProxy&&jh.proxyUrl&&!Tq(t)){if(l=await ii._abortableFetch(t,i),e.useProxy||gTe(t),r.responseType==="native")c=l;else if(i.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(u&&(clearTimeout(u),u=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=Sq(c,"application/xml");break;case"document":c=Sq(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const p=l.headers.get("Content-Type");if(p&&/application\/json|text\/plain/i.test(p)&&c[n==="blob"?"size":"byteLength"]<=750)try{const g=await new Response(c).json();g.error&&(c=g)}catch{}}n==="image"&&c instanceof Blob&&(c=await Eq(URL.createObjectURL(c),e,!0))}}else{c=await l.text();try{c=JSON.parse(c)}catch{}}}else c=await Eq(t,e)}catch(p){if(p.name==="AbortError")throw d?cTe():Cr("Request canceled");if(!(!l&&p instanceof TypeError&&jh.proxyUrl)||r.body||r.method==="delete"||r.method==="head"||r.method==="post"||r.method==="put"||e.useProxy||Tq(t))throw p;e.redoRequest=!0,jxe({proxyUrl:jh.proxyUrl,urlPrefix:cd(t)??""})}finally{u&&clearTimeout(u)}return[l,c]}async function bTe(e,t){if(e.responseData!=null)return e.responseData;if(e.headers&&(t.requestOptions.headers={...t.requestOptions.headers,...e.headers}),e.query&&(t.requestOptions.query={...t.requestOptions.query,...e.query}),e.before){let r,i;try{i=await e.before(t)}catch(s){r=Dp("request:interceptor",s,t)}if((i instanceof Error||i instanceof G)&&(r=Dp("request:interceptor",i,t)),r)throw e.error&&e.error(r),r;return i}}function wTe(e){if(e){for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0}return!1}function Sq(e,t){let r;try{r=new DOMParser().parseFromString(e,t)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}async function xTe(e){let t,r;await _Te(e);try{do[t,r]=await vTe(e);while(!await TTe(e,t,r))}catch(n){const o=Dp("request:server",n,e.params,t);throw o.details.ssl=e.useSSL,e.interceptor?.error&&e.interceptor.error(o),o}const i=e.params.url;if(r&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(i)){if(!e.hasToken&&!e.credentialToken&&r.user?.username&&!XV(i)){const n=cd(i,!0);n&&jh.trustedServers.push(n)}Array.isArray(r.authorizedCrossOriginNoCorsDomains)&&uTe(r.authorizedCrossOriginNoCorsDomains)}const s=e.credential;if(s&&ar){let o=ar.findServerInfo(s.server)?.owningSystemUrl;if(o){o=o.replace(/\/?$/,"/sharing");const a=ar.findCredential(o,s.userId);a&&ar._getIdenticalSvcIdx(o,a)===-1&&a.resources.unshift(o)}}return{data:r,getHeader:t?n=>t?.headers.get(n):r7,httpStatus:t?.status??200,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}async function TTe(e,t,r){if(e.redoRequest)return e.redoRequest=!1,!1;const i=e.params.requestOptions;if(!t||i.responseType==="native"||i.responseType==="native-request-init")return!0;let s,n;if(r&&(r.error?s=r.error:r.status==="error"&&Array.isArray(r.messages)&&(s={...r},s[p$]=r,s.details=r.messages)),!s&&!t.ok)throw s=new Error(`Unable to load ${t.url} status: ${t.status}`),s[p$]=r,s;let o,a=null;s&&(n=Number(s.code),a=s.hasOwnProperty("subcode")?Number(s.subcode):null,o=s.messageCode,o=o?.toUpperCase());const l=i.authMode;if(n===403&&(a===4||s.message?.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&(l!=="no-prompt"||n===498)&&n!==void 0&&pTe.includes(n)&&!zoe(e.params.url)&&(n!==403||o&&!fTe.includes(o)&&(a==null||a===2&&e.credentialToken))){await M8();try{const c=await ar.getCredential(e.params.url,{error:Dp("request:server",s,e.params),prompt:l!=="no-prompt",signal:e.controller.signal,token:e.credentialToken});return e.credential=c,e.credentialToken=c.token,e.useSSL=e.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return e.credential=void 0,e.credentialToken=void 0,!1;s=c}}if(s)throw s;return!0}function Eq(e,t,r=!1){const i=t.controller.signal,s=new Image;return t.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=jh.priority,s.src=e,Foe(s,e,r,i)}ii._abortableFetch=null,ii._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];var STe=Object.freeze(Object.defineProperty({__proto__:null,default:ii},Symbol.toStringTag,{value:"Module"}));function Iht(e){const t=[];return function*(){yield*t;for(const r of e)t.push(r),yield r}}function ETe(e,t){for(const r of e)if(r!=null&&t(r))return r}function I8(e){return e!=null&&typeof e[Symbol.iterator]=="function"}class gi{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let t=0;return this._groups.forEach(r=>{t+=r.length}),t}add(t,r){if(I8(t)){const i=this._getOrCreateGroup(r);for(const s of t)this._isHandle(s)&&i.push(s)}else this._isHandle(t)&&this._getOrCreateGroup(r).push(t);return this}forEach(t,r){if(typeof t=="function")this._groups.forEach(i=>i.forEach(t));else{const i=this._getGroup(t);i&&r&&i.forEach(r)}}has(t){return this._groups.has(this._ensureGroupKey(t))}remove(t){if(typeof t!="string"&&I8(t)){for(const r of t)this.remove(r);return this}return this.has(t)?(this._removeAllFromGroup(this._getGroup(t)),this._groups.delete(this._ensureGroupKey(t)),this):this}removeAll(){return this._groups.forEach(t=>this._removeAllFromGroup(t)),this._groups.clear(),this}_isHandle(t){return t&&(!!t.remove||t instanceof gi)}_getOrCreateGroup(t){if(this.has(t))return this._getGroup(t);const r=[];return this._groups.set(this._ensureGroupKey(t),r),r}_getGroup(t){return this._groups.get(this._ensureGroupKey(t))}_ensureGroupKey(t){return t||"_default_"}_removeAllFromGroup(t){for(const r of t)r instanceof gi?r.removeAll():r.remove()}}const Boe=Symbol("Accessor-beforeDestroy");function S3(e){let t=e.constructor.__accessorMetadata__;const r=Object.prototype.hasOwnProperty.call(e.constructor,"__accessorMetadata__");if(t){if(!r){t=Object.create(t);for(const i in t)t[i]=ye(t[i]);Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0})}}else t={},Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0});return e.constructor.__accessorMetadata__}function UD(e,t){const r=S3(e);let i=r[t];return i||(i=r[t]={}),i}function CTe(e,t){return dM(e,t,OTe)}const ATe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function OTe(e){return ATe.test(e)?"replace":"merge"}var om;(function(e){e[e.INITIALIZING=0]="INITIALIZING",e[e.CONSTRUCTING=1]="CONSTRUCTING",e[e.CONSTRUCTED=2]="CONSTRUCTED"})(om||(om={}));class RTe{constructor(t,r){this._observers=t,this._observer=r}remove(){LV(this._observers,this._observer)}}class Voe{constructor(){this._observers=null,this.destroyed=!1}observe(t){if(this.destroyed||t.destroyed)return PTe;this._observers==null&&(this._observers=[]);const r=this._observers;let i=!1,s=!1;const n=r.length;for(let o=0;o<n;++o){const a=r[o];if(a.destroyed)s=!0;else if(a===t){i=!0;break}}return i||(r.push(t),s&&this._removeDestroyedObservers()),new RTe(r,t)}_removeDestroyedObservers(){const t=this._observers;if(!t||t.length===0)return;const r=t.length;let i=0;for(let s=0;s<r;++s){for(;s+i<r&&t[s+i].destroyed;)++i;if(i>0){if(!(s+i<r))break;t[s]=t[s+i]}}t.length=r-i}destroy(){if(this.destroyed)return;this.destroyed=!0;const t=this._observers;if(t!=null){for(const r of t)r.onCommitted();this._observers=null}}}const PTe=Xo();var mr;(function(e){e[e.DEFAULTS=0]="DEFAULTS",e[e.COMPUTED=1]="COMPUTED",e[e.SERVICE=2]="SERVICE",e[e.PORTAL_ITEM=3]="PORTAL_ITEM",e[e.WEB_SCENE=4]="WEB_SCENE",e[e.WEB_MAP=5]="WEB_MAP",e[e.LINK_CHART=6]="LINK_CHART",e[e.USER=7]="USER"})(mr||(mr={}));const $8=mr.USER+1;function F0(e){switch(e){case"defaults":return mr.DEFAULTS;case"service":return mr.SERVICE;case"portal-item":return mr.PORTAL_ITEM;case"web-scene":return mr.WEB_SCENE;case"web-map":return mr.WEB_MAP;case"link-chart":return mr.LINK_CHART;case"user":return mr.USER;default:return null}}function f$(e){switch(e){case mr.DEFAULTS:return"defaults";case mr.SERVICE:return"service";case mr.PORTAL_ITEM:return"portal-item";case mr.WEB_SCENE:return"web-scene";case mr.WEB_MAP:return"web-map";case mr.LINK_CHART:return"link-chart";case mr.USER:return"user"}return void 0}function MTe(e){return f$(e)}class Cq{constructor(t,r){this.propertyName=t,this.metadata=r,this.observerObject=new ITe,this._accessed=null,this._handles=null,this.observerObject.flags=bi.Dirty|(r.nonNullable?bi.NonNullable:0)|(r.hasOwnProperty("value")?bi.HasDefaultValue:0)|(r.get===void 0?bi.DepTrackingInitialized:0)|(r.dependsOn===void 0?bi.AutoTracked:0)}destroy(){this.observerObject.destroy(),this._accessed=null,this._clearObservationHandles()}getComputed(t){const r=this.observerObject;Ft(r);const i=t.store,s=this.propertyName,n=r.flags,o=i.get(s);if(n&bi.Computing||~n&bi.Dirty&&i.has(s))return o;r.flags|=bi.Computing;const a=t.host;let l;n&bi.AutoTracked?l=Rm(this,this.metadata.get,a):(foe(a,this),l=this.metadata.get.call(a)),i.set(s,l,mr.COMPUTED);const c=i.get(s);return c===o?r.flags&=~bi.Dirty:pxe(this.commit,this),r.flags&=~bi.Computing,c}onObservableAccessed(t){if(t===this.observerObject)return;let r=this._accessed;if(r==null)r=[],this._accessed=r;else if(r.includes(t))return;r.push(t)}onTrackingEnd(){this._clearObservationHandles();const t=this.observerObject;t.flags|=bi.DepTrackingInitialized;const r=this._accessed;if(r==null||r.length===0)return;let i=this._handles;i==null&&(i=[],this._handles=i);for(let s=0;s<r.length;++s)i.push(r[s].observe(t));r.length=0}notifyChange(){const t=this.observerObject;t.onInvalidated(),t.onCommitted()}invalidate(){this.observerObject.onInvalidated()}commit(){const t=this.observerObject;t.flags&=~bi.Dirty,t.onCommitted()}_clearObservationHandles(){const t=this._handles;if(t!==null){for(let r=0;r<t.length;++r)t[r].remove();t.length=0}}}class ITe extends Voe{constructor(){super(...arguments),this.flags=0}onInvalidated(){~this.flags&bi.Overriden&&(this.flags|=bi.Dirty);const t=this._observers;if(t&&t.length>0)for(const r of t)r.onInvalidated()}onCommitted(){const t=this._observers;if(t&&t.length>0){const r=t.slice();for(const i of r)i.onCommitted()}}destroy(){this.flags&bi.Dirty&&this.onCommitted(),super.destroy()}}class i7{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const r=new i7;return this._values.forEach((i,s)=>{t&&t.has(s)||r.set(s,ye(i))}),r}get(t){return this._values.get(t)}originOf(){return mr.USER}keys(){return[...this._values.keys()]}set(t,r){this._values.set(t,r)}delete(t){this._values.delete(t)}has(t){return this._values.has(t)}forEach(t){this._values.forEach(t)}}function TO(e,t,r){return e!==void 0}function Aq(e,t,r,i){return e!==void 0&&(!(r==null&&e.observerObject.flags&bi.NonNullable)||(i.lifecycle,om.INITIALIZING,!1))}function $Te(e){return e&&typeof e.destroy=="function"}K.getLogger("esri.core.accessorSupport.Properties");class LTe{constructor(t){this.host=t,this.propertiesByName=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=om.INITIALIZING,this.store=new i7,this._origin=mr.USER;const r=this.host.constructor.__accessorMetadata__;for(const i in r){const s=new Cq(i,r[i]);this.propertiesByName.set(i,s)}this.metadatas=r}initialize(){this.lifecycle=om.CONSTRUCTING}constructed(){this.lifecycle=om.CONSTRUCTED}destroy(){this.destroyed=!0;for(const[t,r]of this.propertiesByName){if(r.metadata.autoDestroy){const i=this.internalGet(t);i&&$Te(i)&&(i.destroy(),~r.observerObject.flags&bi.NonNullable&&this._internalSet(r,null))}r.destroy()}}get initialized(){return this.lifecycle!==om.INITIALIZING}get(t){const r=this.propertiesByName.get(t);if(r.metadata.get)return r.getComputed(this);Ft(r.observerObject);const i=this.store;return i.has(t)?i.get(t):r.metadata.value}originOf(t){const r=this.store.originOf(t);if(r===void 0){const i=this.propertiesByName.get(t);if(i!==void 0&&i.observerObject.flags&bi.HasDefaultValue)return"defaults"}return f$(r)}has(t){return!!this.propertiesByName.has(t)&&this.store.has(t)}keys(){return[...this.propertiesByName.keys()]}internalGet(t){const r=this.propertiesByName.get(t);if(TO(r))return this.store.has(t)?this.store.get(t):r.metadata.value}internalSet(t,r){const i=this.propertiesByName.get(t);TO(i)&&this._internalSet(i,r)}getDependsInfo(t,r,i){const s=this.propertiesByName.get(r);if(!TO(s))return"";const n=new Set,o=Rm({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>s.metadata.get?.call(t));let a=`${i}${t.declaredClass.split(".").pop()}.${r}: ${o}
`;if(n.size===0)return a;i+="  ";for(const l of n)l instanceof Cq&&(a+=`${i}${l.propertyName}: undefined
`);return a}setAtOrigin(t,r,i){const s=this.propertiesByName.get(t);if(TO(s))return this._setAtOrigin(s,r,i)}isOverridden(t){const r=this.propertiesByName.get(t);return r!==void 0&&!!(r.observerObject.flags&bi.Overriden)}clearOverride(t){const r=this.propertiesByName.get(t),i=r?.observerObject;i&&i.flags&bi.Overriden&&(i.flags&=~bi.Overriden,r.notifyChange())}override(t,r){const i=this.propertiesByName.get(t);if(!Aq(i,t,r,this))return;const s=i.metadata.cast;if(s){const n=this._cast(s,r),{valid:o,value:a}=n;if(L5.release(n),!o)return;r=a}i.observerObject.flags|=bi.Overriden,this._internalSet(i,r)}set(t,r){const i=this.propertiesByName.get(t);if(!Aq(i,t,r,this))return;const s=i.metadata.cast;if(s){const o=this._cast(s,r),{valid:a,value:l}=o;if(L5.release(o),!a)return;r=l}const n=i.metadata.set;n?n.call(this.host,r):this._internalSet(i,r)}setDefaultOrigin(t){this._origin=F0(t)}getDefaultOrigin(){return f$(this._origin)}notifyChange(t){const r=this.propertiesByName.get(t);r!==void 0&&r.notifyChange()}invalidate(t){const r=this.propertiesByName.get(t);r!==void 0&&r.invalidate()}commit(t){const r=this.propertiesByName.get(t);r!==void 0&&r.commit()}_internalSet(t,r){const i=this.lifecycle!==om.INITIALIZING?this._origin:mr.DEFAULTS;this._setAtOrigin(t,r,i)}_setAtOrigin(t,r,i){const s=this.store,n=t.propertyName;s.has(n,i)&&UV(r,s.get(n))&&~t.observerObject.flags&bi.Overriden&&i===s.originOf(n)||(t.invalidate(),s.set(n,r,i),t.commit(),poe(this.host,t))}_cast(t,r){const i=L5.acquire();return i.valid=!0,i.value=r,t&&(i.value=t.call(this.host,r,i)),i}}class DTe{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}}const L5=new fn(DTe);function m$(e,t,r){if(e&&t)if(typeof t=="object")for(const i of Object.getOwnPropertyNames(t))m$(e,i,t[i]);else{if(t.includes(".")){const s=t.split("."),n=s.splice(s.length-1,1)[0];return void m$(n$(e,s),n,r)}const i=e.__accessor__;i!=null&&NTe(t,i),e[t]=r}}function NTe(e,t){if(ne("esri-unknown-property-errors")&&!FTe(e,t))throw new G("set:unknown-property",UTe(e,t))}function FTe(e,t){return t.metadatas[e]!=null}function UTe(e,t){return"setting unknown property '"+e+"' on instance of "+t.host.declaredClass}let kTe;function Oq(){return kTe}function f(e={}){return(t,r)=>{if(t===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${t.name}.${r}. Accessor does not support static properties.`);const i=Object.getOwnPropertyDescriptor(t,r),s=UD(t,r);i&&(i.get||i.set?(s.get=i.get||s.get,s.set=i.set||s.set):"value"in i&&("value"in e&&K.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${r}" on "${t.constructor.name}" already defined in the metadata`,e),s.value=e.value=i.value)),e.readOnly!=null&&(s.readOnly=e.readOnly);const n=e.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let u;s.dependsOn=[l],s.get=function(){let d=n$(this,l);if(typeof d=="function"){u||(u=l.split(".").slice(0,-1).join("."));const p=n$(this,u);p&&(d=d.bind(p))}return d},s.readOnly||(s.set=c?function(d){this._override(r,d)}:function(d){m$(this,l,d)})}const o=e.type,a=e.types;s.cast||(o?s.cast=zTe(o):a&&(Array.isArray(a)?s.cast=tA(cy(a[0])):s.cast=cy(a))),CTe(s,e),e.range&&(s.cast=BTe(s.cast,e.range))}}function Goe(e,t,r){const i=UD(e,r);i.json||(i.json={});let s=i.json;return t!==void 0&&(s.origins||(s.origins={}),s.origins[t]||(s.origins[t]={}),s=s.origins[t]),s}function zTe(e){let t=0,r=e;if(Bwe(e))return Qne(e);for(;Array.isArray(r)&&r.length===1&&typeof r[0]!="string"&&typeof r[0]!="number";)r=r[0],t++;const i=r;if(Kne(i))return t===0?g8(i):t$(g8(i),t);if(t===1)return kwe(i);if(t>1)return zwe(i,t);const s=e;return s.from?s.from:ro(s)}function BTe(e,t){return r=>{let i=+e(r);return t.step!=null&&(i=Math.round(i/t.step)*t.step),t.min!=null&&(i=Math.max(t.min,i)),t.max!=null&&(i=Math.min(t.max,i)),i}}function VTe(e){if(e.json&&e.json.origins){const t=e.json.origins,r={"web-document":["web-scene","web-map"]};for(const i in r)if(t[i]){const s=t[i];r[i].forEach(n=>{t[n]=s}),delete t[i]}}}class o1 extends toe{constructor(t,r,i){super(t,r,i)}}o1.prototype.type="warning";function joe(e){return!!e&&e.prototype&&e.prototype.declaredClass&&e.prototype.declaredClass.indexOf("esri.core.Collection")===0}const L8=K.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function Rq(e,t,r){e&&(!r&&!t.read||t.read?.reader||t.read?.enabled===!1||HTe(e)&&i2("read.reader",Hoe(e),t))}function Hoe(e){const t=e.ndimArray??0;if(t>1)return jTe(e);if(t===1)return Pq(e);if("type"in e&&qoe(e.type)){const r=e.type.prototype?.itemType?.Type,i=Pq(typeof r=="function"?{type:r}:{types:r});return(s,n,o)=>{const a=i(s,n,o);return a&&new e.type(a)}}return s7(e)}function s7(e){return"type"in e?GTe(e.type):WTe(e.types)}function GTe(e){return e.prototype.read?(t,r,i)=>{if(t==null)return t;const s=typeof t;if(s!=="object")return void L8.error(`Expected JSON value of type 'object' to deserialize type '${e.prototype.declaredClass}', but got '${s}'`);const n=new e;return n.read(t,i),n}:e.fromJSON}function Woe(e,t,r,i){return i!==0&&Array.isArray(t)?t.map(s=>Woe(e,s,r,i-1)):e(t,void 0,r)}function jTe(e){const t=s7(e),r=Woe.bind(null,t),i=e.ndimArray??0;return(s,n,o)=>{if(s==null)return s;s=r(s,o,i);let a=i,l=s;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)s=[s];return s}}function Pq(e){const t=s7(e);return(r,i,s)=>{if(r==null)return r;if(Array.isArray(r)){const o=[];for(const a of r){const l=t(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=t(r,void 0,s);return n!==void 0?[n]:void 0}}function qoe(e){if(!joe(e))return!1;const t=e.prototype.itemType;return!(!t||!t.Type)&&(typeof t.Type=="function"?n7(t.Type):Xoe(t.Type))}function HTe(e){return"types"in e?Xoe(e.types):n7(e.type)}function n7(e){return!Array.isArray(e)&&!!e&&e.prototype&&("read"in e.prototype||"fromJSON"in e||qoe(e))}function Xoe(e){for(const t in e.typeMap)if(!n7(e.typeMap[t]))return!1;return!0}function WTe(e){let t=null;const r=e.errorContext??"type";return(i,s,n)=>{if(i==null)return i;const o=typeof i;if(o!=="object")return void L8.error(`Expected JSON value of type 'object' to deserialize, but got '${o}'`);t||(t=qTe(e));const a=e.key;if(typeof a!="string")return;const l=i[a],c=l?t[l]:e.defaultKeyValue?e.typeMap[e.defaultKeyValue]:void 0;if(!c){const d=`Type '${l||"unknown"}' is not supported`;return n&&n.messages&&i&&n.messages.push(new o1(`${r}:unsupported`,d,{definition:i,context:n})),void L8.error(d)}const u=new c;return u.read(i,n),u}}function qTe(e){const t={};for(const r in e.typeMap){const i=e.typeMap[r],s=S3(i.prototype);if(typeof e.key=="function")continue;const n=s[e.key];if(!n)continue;n.json?.type&&Array.isArray(n.json.type)&&n.json.type.length===1&&typeof n.json.type[0]=="string"&&(t[n.json.type[0]]=i);const o=n.json?.write;if(!o||!o.writer){t[r]=i;continue}const a=o.target,l=typeof a=="string"?a:e.key,c={};o.writer(r,c,l),c[l]&&(t[c[l]]=i)}return t}function XTe(e){if(e.json||(e.json={}),Iq(e.json),$q(e.json),Mq(e.json),e.json.origins)for(const t in e.json.origins)Iq(e.json.origins[t]),$q(e.json.origins[t]),Mq(e.json.origins[t]);return!0}function Mq(e){e.name&&(e.read&&typeof e.read=="object"?e.read.source===void 0&&(e.read.source=e.name):e.read={source:e.name},e.write&&typeof e.write=="object"?e.write.target===void 0&&(e.write.target=e.name):e.write={target:e.name})}function Iq(e){typeof e.read=="boolean"?e.read={enabled:e.read}:typeof e.read=="function"?e.read={enabled:!0,reader:e.read}:e.read&&typeof e.read=="object"&&e.read.enabled===void 0&&(e.read.enabled=!0)}function $q(e){typeof e.write=="boolean"?e.write={enabled:e.write}:typeof e.write=="function"?e.write={enabled:!0,writer:e.write}:e.write&&typeof e.write=="object"&&e.write.enabled===void 0&&(e.write.enabled=!0)}function Lq(e,t){if(!t.write||t.write.writer||t.write.enabled===!1&&!t.write.overridePolicy)return;const r=e?.ndimArray??0;e&&(r===1||"type"in e&&joe(e.type))?t.write.writer=JTe:r>1?t.write.writer=KTe(r):t.types?Array.isArray(t.types)?t.write.writer=YTe(t.types[0]):t.write.writer=ZTe(t.types):t.write.writer=sA}function ZTe(e){return(t,r,i,s)=>t?Zoe(t,e,s)?sA(t,r,i,s):void 0:sA(t,r,i,s)}function Zoe(e,t,r){for(const i in t.typeMap)if(e instanceof t.typeMap[i])return!0;if(r?.messages){const i=t.errorContext??"type",s=`Values of type '${(typeof t.key!="function"?e[t.key]:e.declaredClass)??"Unknown"}' cannot be written`;r&&r.messages&&e&&r.messages.push(new G(`${i}:unsupported`,s,{definition:e,context:r})),K.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(s)}return!1}function YTe(e){return(t,r,i,s)=>!t||!Array.isArray(t)?sA(t,r,i,s):sA(t.filter(n=>Zoe(n,e,s)),r,i,s)}function sA(e,t,r,i){i2(r,g$(e,i),t)}function g$(e,t){return e&&typeof e.write=="function"?e.write({},t):e&&typeof e.toJSON=="function"?e.toJSON():typeof e=="number"?y$(e):e}function y$(e){return e===-1/0?-Number.MAX_VALUE:e===1/0?Number.MAX_VALUE:isNaN(e)?null:e}function JTe(e,t,r,i){let s;e===null?s=null:e&&typeof e.map=="function"?(s=e.map(n=>g$(n,i)),typeof s.toArray=="function"&&(s=s.toArray())):s=[g$(e,i)],i2(r,s,t)}function Yoe(e,t,r){return r!==0&&Array.isArray(e)?e.map(i=>Yoe(i,t,r-1)):g$(e,t)}function KTe(e){return(t,r,i,s)=>{let n;if(t===null)n=null;else{n=Yoe(t,s,e);let o=e,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}i2(i,n,r)}}function QTe(e,t){return o7(e,"any",t?.origin)}function D8(e,t){return o7(e,"read",t?.origin)}function Joe(e,t){return o7(e,"write",t?.origin)}function o7(e,t,r){let i=e?.json;if(i?.origins&&r){let s;s=r==="link-chart"?i.origins[r]&&(t==="any"||t in i.origins[r])?i.origins[r]:i.origins["web-map"]:i.origins[r],s&&(t==="any"||t in s)&&(i=s)}return i}function e2e(e){const t=t2e(e);if(e.json.origins)for(const r in e.json.origins){const i=e.json.origins[r],s=i.types?r2e(i):t;Rq(s,i,!1),i.types&&!i.write&&e.json.write&&e.json.write.enabled&&(i.write={...e.json.write}),Lq(s,i)}Rq(t,e.json,!0),Lq(t,e.json)}function t2e(e){return e.json.types?N8(e.json):e.type?Koe(e):N8(e)}function r2e(e){return e.type?Koe(e):N8(e)}function Koe(e){if(!e.type)return;let t=0,r=e.type;for(;Array.isArray(r)&&!Kne(r);)r=r[0],t++;return{type:r,ndimArray:t}}function N8(e){if(!e.types)return;let t=0,r=e.types;for(;Array.isArray(r);)r=r[0],t++;return{types:r,ndimArray:t}}function i2e(e){XTe(e)&&(VTe(e),e2e(e))}const D5=new Set,N5=new Set;function F(e){return t=>{t.prototype.declaredClass=e,n2e(t);const r=[],i=[];let s=t.prototype;for(;s;)s.hasOwnProperty("initialize")&&!D5.has(s.initialize)&&(D5.add(s.initialize),r.push(s.initialize)),s.hasOwnProperty("destroy")&&!N5.has(s.destroy)&&(N5.add(s.destroy),i.push(s.destroy)),s=Object.getPrototypeOf(s);D5.clear(),N5.clear();class n extends t{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(r.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=r.length-1;l>=0;l--)r[l].call(this)}}),i.length){let l=!1;const c=this[Boe];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let u=0;u<i.length;u++)i[u].call(this)}}})}this.postscript(...a)}}}return n.__accessorMetadata__=S3(t.prototype),n.prototype.declaredClass=e,n}}function s2e(e,t){return t.get==null?function(){const r=this.__accessor__,i=r.propertiesByName.get(e);if(i===void 0)return;Ft(i.observerObject);const s=r.store;return s.has(e)?s.get(e):i.metadata.value}:function(){const r=this.__accessor__,i=r.propertiesByName.get(e);if(i!==void 0)return i.getComputed(r)}}function n2e(e){const t=e.prototype,r=S3(t),i={};for(const s of Object.getOwnPropertyNames(r)){const n=r[s];i2e(n),i[s]={enumerable:!0,configurable:!0,get:s2e(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&n.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${s}' of ${this.declaredClass}`);if(a.lifecycle===om.CONSTRUCTED&&n.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${s}' of ${this.declaredClass}`);a.set(s,o)}}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(e.prototype,i)}var Qoe,eae;function o2e(e){if(e==null)return{value:e};if(Array.isArray(e))return{type:[e[0]],value:null};switch(typeof e){case"object":return e.constructor?.__accessorMetadata__||e instanceof Date?{type:e.constructor,value:e}:e;case"boolean":return{type:Boolean,value:e};case"string":return{type:String,value:e};case"number":return{type:Number,value:e};case"function":return{type:e,value:null};default:return}}const Hg=Symbol("Accessor-Handles"),F8=Symbol("Accessor-Initialized");class xe{static createSubclass(t={}){if(Array.isArray(t))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:r,declaredClass:i,constructor:s}=t;delete t.declaredClass,delete t.properties,delete t.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}S3(o.prototype);for(const a in t){const l=t[a];o.prototype[a]=typeof l=="function"?function(...c){const u=this.inherited;let d;this.inherited=function(...p){if(n.prototype[a])return n.prototype[a].apply(this,p)};try{d=l.apply(this,c)}catch(p){throw this.inherited=u,p}return this.inherited=u,d}:t[a]}for(const a in r){const l=o2e(r[a]);f(l)(o.prototype,a)}return F(i)(o)}constructor(...t){if(this[Qoe]=null,this[eae]=!1,this.constructor===xe)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const r=new LTe(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:r}),t.length>0&&this.normalizeCtorArgs&&(r.ctorArgs=this.normalizeCtorArgs.apply(this,t)),Oq()?.onInstanceConstruct(this),Dq.register(this,r.propertiesByName,this)}postscript(t){const r=this.__accessor__,i=r.ctorArgs||t;r.initialize(),i&&(this.set(i),r.ctorArgs=null),r.constructed(),this.initialize(),this[F8]=!0}initialize(){}[Boe](){this[Hg]=Re(this[Hg])}destroy(){this.destroyed||(Dq.unregister(this),_xe(this),this.__accessor__.destroy(),Oq()?.onInstanceDestroy(this))}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[F8]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(t){this.get(t)}get(t){return n$(this,t)}hasOwnProperty(t){return this.__accessor__?this.__accessor__.has(t):Object.prototype.hasOwnProperty.call(this,t)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(t,r){return m$(this,t,r),this}watch(t,r,i){return Txe(this,t,r,i)}own(t){this.addHandles(t)}addHandles(t,r){if(this.destroyed){const s=Array.isArray(t)?t:[t];for(const n of s)n.remove();return}let i=this[Hg];i==null&&(i=this[Hg]=new gi),i.add(t,r)}removeHandles(t){const r=this[Hg];r?.remove(t)}removeAllHandles(){const t=this[Hg];t?.removeAll()}hasHandles(t){const r=this[Hg];return r!=null&&r.has(t)}_override(t,r){r===void 0?this.__accessor__.clearOverride(t):this.__accessor__.override(t,r)}_clearOverride(t){return this.__accessor__.clearOverride(t)}_overrideIfSome(t,r){r==null?this.__accessor__.clearOverride(t):this.__accessor__.override(t,r)}_isOverridden(t){return this.__accessor__.isOverridden(t)}notifyChange(t){this.__accessor__.notifyChange(t)}_get(t){return this.__accessor__.internalGet(t)}_set(t,r){return this.__accessor__.internalSet(t,r),this}}Qoe=Hg,eae=F8;const Dq=new FinalizationRegistry(e=>{for(const t of e.values())t.destroy()});class Ax{constructor(){this._emitter=new Ax.EventEmitter(this)}emit(t,r){return this._emitter.emit(t,r)}on(t,r){return this._emitter.on(t,r)}once(t,r){return this._emitter.once(t,r)}hasEventListener(t){return this._emitter.hasEventListener(t)}}(function(e){class t{constructor(s=null){this._target=s,this._listenersMap=null}clear(){this._listenersMap?.clear(),this._listenersMap=null}destroy(){this.clear()}emit(s,n){const o=this._listenersMap&&this._listenersMap.get(s);if(!o)return!1;const a=this._target||this;return[...o].forEach(l=>{l.call(a,n)}),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return Jx(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(s)||[],l=a.indexOf(n);l>=0&&a.splice(l,1)}}}once(s,n){const o=this.on(s,a=>{o.remove(),n.call(null,a)});return o}hasEventListener(s){const n=this._listenersMap&&this._listenersMap.get(s);return n!=null&&n.length>0}}e.EventEmitter=t,e.EventedMixin=i=>{let s=class extends i{constructor(){super(...arguments),this._emitter=new t}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=h([F("esri.core.Evented")],s),s};let r=class extends xe{constructor(){super(...arguments),this._emitter=new Ax.EventEmitter(this)}destroy(){this._emitter.clear()}emit(i,s){return this._emitter.emit(i,s)}on(i,s){return this._emitter.on(i,s)}once(i,s){return this._emitter.once(i,s)}hasEventListener(i){return this._emitter.hasEventListener(i)}};r=h([F("esri.core.Evented")],r),e.EventedAccessor=r})(Ax||(Ax={}));const cs=Ax;class kl{constructor(t,r={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=t,this._options=r,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(t),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=i=>this.fromJSON(i),this.write=(i,s,n)=>{const o=this.toJSON(i);o!==void 0&&i2(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(t){if(t==null)return null;if(this._apiToJSON.hasOwnProperty(t)){const r=this._apiToJSON[t];return this._options.useNumericKeys?+r:r}return this._options.ignoreUnknown?void 0:t}fromJSON(t){return t!=null&&this._jsonToAPI.hasOwnProperty(t)?this._jsonToAPI[t]:this._options.ignoreUnknown?void 0:t}_invertMap(t){const r={};for(const i in t)r[t[i]]=i;return r}_getKeysSorted(t){const r=[];for(const i in t)r.push(i);return r.sort(),r}}function jl(){return function(e,t){return new kl(e,{ignoreUnknown:!0,...t})}}let sC;const a2e=globalThis.esriConfig?.locale??globalThis.dojoConfig?.locale;function tae(){return a2e??globalThis.navigator?.language??"en"}function ud(){return sC===void 0&&(sC=tae()),sC}const nC=[];function rae(e){return nC.push(e),{remove(){nC.splice(nC.indexOf(e),1)}}}const U8=[];function a7(e){return U8.push(e),{remove(){nC.splice(U8.indexOf(e),1)}}}function l2e(){const e=tae();sC!==e&&(sC=e,[...U8].forEach(t=>{t.call(null,e)}),[...nC].forEach(t=>{t.call(null,e)}))}globalThis.addEventListener?.("languagechange",l2e);class q1 extends Error{}class c2e extends q1{constructor(t){super(`Invalid DateTime: ${t.toMessage()}`)}}class u2e extends q1{constructor(t){super(`Invalid Interval: ${t.toMessage()}`)}}class h2e extends q1{constructor(t){super(`Invalid Duration: ${t.toMessage()}`)}}class GS extends q1{}class iae extends q1{constructor(t){super(`Invalid unit ${t}`)}}class Tu extends q1{}class ug extends q1{constructor(){super("Zone is an abstract class")}}const Be="numeric",gd="short",Cc="long",_$={year:Be,month:Be,day:Be},sae={year:Be,month:gd,day:Be},d2e={year:Be,month:gd,day:Be,weekday:gd},nae={year:Be,month:Cc,day:Be},oae={year:Be,month:Cc,day:Be,weekday:Cc},aae={hour:Be,minute:Be},lae={hour:Be,minute:Be,second:Be},cae={hour:Be,minute:Be,second:Be,timeZoneName:gd},uae={hour:Be,minute:Be,second:Be,timeZoneName:Cc},hae={hour:Be,minute:Be,hourCycle:"h23"},dae={hour:Be,minute:Be,second:Be,hourCycle:"h23"},pae={hour:Be,minute:Be,second:Be,hourCycle:"h23",timeZoneName:gd},fae={hour:Be,minute:Be,second:Be,hourCycle:"h23",timeZoneName:Cc},mae={year:Be,month:Be,day:Be,hour:Be,minute:Be},gae={year:Be,month:Be,day:Be,hour:Be,minute:Be,second:Be},yae={year:Be,month:gd,day:Be,hour:Be,minute:Be},_ae={year:Be,month:gd,day:Be,hour:Be,minute:Be,second:Be},p2e={year:Be,month:gd,day:Be,weekday:gd,hour:Be,minute:Be},vae={year:Be,month:Cc,day:Be,hour:Be,minute:Be,timeZoneName:gd},bae={year:Be,month:Cc,day:Be,hour:Be,minute:Be,second:Be,timeZoneName:gd},wae={year:Be,month:Cc,day:Be,weekday:Cc,hour:Be,minute:Be,timeZoneName:Cc},xae={year:Be,month:Cc,day:Be,weekday:Cc,hour:Be,minute:Be,second:Be,timeZoneName:Cc};class E3{get type(){throw new ug}get name(){throw new ug}get ianaName(){return this.name}get isUniversal(){throw new ug}offsetName(t,r){throw new ug}formatOffset(t,r){throw new ug}offset(t){throw new ug}equals(t){throw new ug}get isValid(){throw new ug}}let F5=null;class kD extends E3{static get instance(){return F5===null&&(F5=new kD),F5}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(t,{format:r,locale:i}){return Sae(t,r,i)}formatOffset(t,r){return aC(this.offset(t),r)}offset(t){return-new Date(t).getTimezoneOffset()}equals(t){return t.type==="system"}get isValid(){return!0}}let yM={};function f2e(e){return yM[e]||(yM[e]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),yM[e]}const m2e={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function g2e(e,t){const r=e.format(t).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(r),[,s,n,o,a,l,c,u]=i;return[o,s,n,a,l,c,u]}function y2e(e,t){const r=e.formatToParts(t),i=[];for(let s=0;s<r.length;s++){const{type:n,value:o}=r[s],a=m2e[n];n==="era"?i[a]=o:Yr(a)||(i[a]=parseInt(o,10))}return i}let SO={};class Pm extends E3{static create(t){return SO[t]||(SO[t]=new Pm(t)),SO[t]}static resetCache(){SO={},yM={}}static isValidSpecifier(t){return this.isValidZone(t)}static isValidZone(t){if(!t)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:t}).format(),!0}catch{return!1}}constructor(t){super(),this.zoneName=t,this.valid=Pm.isValidZone(t)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(t,{format:r,locale:i}){return Sae(t,r,i,this.name)}formatOffset(t,r){return aC(this.offset(t),r)}offset(t){const r=new Date(t);if(isNaN(r))return NaN;const i=f2e(this.name);let[s,n,o,a,l,c,u]=i.formatToParts?y2e(i,r):g2e(i,r);a==="BC"&&(s=-Math.abs(s)+1);const p=u7({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:u,millisecond:0});let g=+r;const y=g%1e3;return g-=y>=0?y:1e3+y,(p-g)/(60*1e3)}equals(t){return t.type==="iana"&&t.name===this.name}get isValid(){return this.valid}}let Nq={};function _2e(e,t={}){const r=JSON.stringify([e,t]);let i=Nq[r];return i||(i=new Intl.ListFormat(e,t),Nq[r]=i),i}let k8={};function z8(e,t={}){const r=JSON.stringify([e,t]);let i=k8[r];return i||(i=new Intl.DateTimeFormat(e,t),k8[r]=i),i}let B8={};function v2e(e,t={}){const r=JSON.stringify([e,t]);let i=B8[r];return i||(i=new Intl.NumberFormat(e,t),B8[r]=i),i}let V8={};function b2e(e,t={}){const{base:r,...i}=t,s=JSON.stringify([e,i]);let n=V8[s];return n||(n=new Intl.RelativeTimeFormat(e,t),V8[s]=n),n}let jS=null;function w2e(){return jS||(jS=new Intl.DateTimeFormat().resolvedOptions().locale,jS)}function x2e(e){const t=e.indexOf("-x-");t!==-1&&(e=e.substring(0,t));const r=e.indexOf("-u-");if(r===-1)return[e];{let i,s;try{i=z8(e).resolvedOptions(),s=e}catch{const l=e.substring(0,r);i=z8(l).resolvedOptions(),s=l}const{numberingSystem:n,calendar:o}=i;return[s,n,o]}}function T2e(e,t,r){return(r||t)&&(e.includes("-u-")||(e+="-u"),r&&(e+=`-ca-${r}`),t&&(e+=`-nu-${t}`)),e}function S2e(e){const t=[];for(let r=1;r<=12;r++){const i=ur.utc(2016,r,1);t.push(e(i))}return t}function E2e(e){const t=[];for(let r=1;r<=7;r++){const i=ur.utc(2016,11,13+r);t.push(e(i))}return t}function EO(e,t,r,i,s){const n=e.listingMode(r);return n==="error"?null:n==="en"?i(t):s(t)}function C2e(e){return e.numberingSystem&&e.numberingSystem!=="latn"?!1:e.numberingSystem==="latn"||!e.locale||e.locale.startsWith("en")||new Intl.DateTimeFormat(e.intl).resolvedOptions().numberingSystem==="latn"}class A2e{constructor(t,r,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:s,floor:n,...o}=i;if(!r||Object.keys(o).length>0){const a={useGrouping:!1,...i};i.padTo>0&&(a.minimumIntegerDigits=i.padTo),this.inf=v2e(t,a)}}format(t){if(this.inf){const r=this.floor?Math.floor(t):t;return this.inf.format(r)}else{const r=this.floor?Math.floor(t):c7(t,3);return In(r,this.padTo)}}}class O2e{constructor(t,r,i){this.opts=i,this.originalZone=void 0;let s;if(this.opts.timeZone)this.dt=t;else if(t.zone.type==="fixed"){const o=-1*(t.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;t.offset!==0&&Pm.create(a).valid?(s=a,this.dt=t):(s="UTC",this.dt=t.offset===0?t:t.setZone("UTC").plus({minutes:t.offset}),this.originalZone=t.zone)}else t.zone.type==="system"?this.dt=t:t.zone.type==="iana"?(this.dt=t,s=t.zone.name):(s="UTC",this.dt=t.setZone("UTC").plus({minutes:t.offset}),this.originalZone=t.zone);const n={...this.opts};n.timeZone=n.timeZone||s,this.dtf=z8(r,n)}format(){return this.originalZone?this.formatToParts().map(({value:t})=>t).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const t=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?t.map(r=>{if(r.type==="timeZoneName"){const i=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...r,value:i}}else return r}):t}resolvedOptions(){return this.dtf.resolvedOptions()}}class R2e{constructor(t,r,i){this.opts={style:"long",...i},!r&&Tae()&&(this.rtf=b2e(t,i))}format(t,r){return this.rtf?this.rtf.format(t,r):W2e(r,t,this.opts.numeric,this.opts.style!=="long")}formatToParts(t,r){return this.rtf?this.rtf.formatToParts(t,r):[]}}class gs{static fromOpts(t){return gs.create(t.locale,t.numberingSystem,t.outputCalendar,t.defaultToEN)}static create(t,r,i,s=!1){const n=t||Pn.defaultLocale,o=n||(s?"en-US":w2e()),a=r||Pn.defaultNumberingSystem,l=i||Pn.defaultOutputCalendar;return new gs(o,a,l,n)}static resetCache(){jS=null,k8={},B8={},V8={}}static fromObject({locale:t,numberingSystem:r,outputCalendar:i}={}){return gs.create(t,r,i)}constructor(t,r,i,s){const[n,o,a]=x2e(t);this.locale=n,this.numberingSystem=r||o||null,this.outputCalendar=i||a||null,this.intl=T2e(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=C2e(this)),this.fastNumbersCached}listingMode(){const t=this.isEnglish(),r=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return t&&r?"en":"intl"}clone(t){return!t||Object.getOwnPropertyNames(t).length===0?this:gs.create(t.locale||this.specifiedLocale,t.numberingSystem||this.numberingSystem,t.outputCalendar||this.outputCalendar,t.defaultToEN||!1)}redefaultToEN(t={}){return this.clone({...t,defaultToEN:!0})}redefaultToSystem(t={}){return this.clone({...t,defaultToEN:!1})}months(t,r=!1,i=!0){return EO(this,t,i,Aae,()=>{const s=r?{month:t,day:"numeric"}:{month:t},n=r?"format":"standalone";return this.monthsCache[n][t]||(this.monthsCache[n][t]=S2e(o=>this.extract(o,s,"month"))),this.monthsCache[n][t]})}weekdays(t,r=!1,i=!0){return EO(this,t,i,Pae,()=>{const s=r?{weekday:t,year:"numeric",month:"long",day:"numeric"}:{weekday:t},n=r?"format":"standalone";return this.weekdaysCache[n][t]||(this.weekdaysCache[n][t]=E2e(o=>this.extract(o,s,"weekday"))),this.weekdaysCache[n][t]})}meridiems(t=!0){return EO(this,void 0,t,()=>Mae,()=>{if(!this.meridiemCache){const r={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[ur.utc(2016,11,13,9),ur.utc(2016,11,13,19)].map(i=>this.extract(i,r,"dayperiod"))}return this.meridiemCache})}eras(t,r=!0){return EO(this,t,r,Iae,()=>{const i={era:t};return this.eraCache[t]||(this.eraCache[t]=[ur.utc(-40,1,1),ur.utc(2017,1,1)].map(s=>this.extract(s,i,"era"))),this.eraCache[t]})}extract(t,r,i){const s=this.dtFormatter(t,r),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===i);return o?o.value:null}numberFormatter(t={}){return new A2e(this.intl,t.forceSimple||this.fastNumbers,t)}dtFormatter(t,r={}){return new O2e(t,this.intl,r)}relFormatter(t={}){return new R2e(this.intl,this.isEnglish(),t)}listFormatter(t={}){return _2e(this.intl,t)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(t){return this.locale===t.locale&&this.numberingSystem===t.numberingSystem&&this.outputCalendar===t.outputCalendar}}let U5=null;class va extends E3{static get utcInstance(){return U5===null&&(U5=new va(0)),U5}static instance(t){return t===0?va.utcInstance:new va(t)}static parseSpecifier(t){if(t){const r=t.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(r)return new va(BD(r[1],r[2]))}return null}constructor(t){super(),this.fixed=t}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${aC(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${aC(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(t,r){return aC(this.fixed,r)}get isUniversal(){return!0}offset(){return this.fixed}equals(t){return t.type==="fixed"&&t.fixed===this.fixed}get isValid(){return!0}}class P2e extends E3{constructor(t){super(),this.zoneName=t}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function C0(e,t){if(Yr(e)||e===null)return t;if(e instanceof E3)return e;if(M2e(e)){const r=e.toLowerCase();return r==="default"?t:r==="local"||r==="system"?kD.instance:r==="utc"||r==="gmt"?va.utcInstance:va.parseSpecifier(r)||Pm.create(e)}else return Nv(e)?va.instance(e):typeof e=="object"&&e.offset&&typeof e.offset=="number"?e:new P2e(e)}let Fq=()=>Date.now(),Uq="system",kq=null,zq=null,Bq=null,Vq=60,Gq;class Pn{static get now(){return Fq}static set now(t){Fq=t}static set defaultZone(t){Uq=t}static get defaultZone(){return C0(Uq,kD.instance)}static get defaultLocale(){return kq}static set defaultLocale(t){kq=t}static get defaultNumberingSystem(){return zq}static set defaultNumberingSystem(t){zq=t}static get defaultOutputCalendar(){return Bq}static set defaultOutputCalendar(t){Bq=t}static get twoDigitCutoffYear(){return Vq}static set twoDigitCutoffYear(t){Vq=t%100}static get throwOnInvalid(){return Gq}static set throwOnInvalid(t){Gq=t}static resetCaches(){gs.resetCache(),Pm.resetCache()}}function Yr(e){return typeof e>"u"}function Nv(e){return typeof e=="number"}function zD(e){return typeof e=="number"&&e%1===0}function M2e(e){return typeof e=="string"}function I2e(e){return Object.prototype.toString.call(e)==="[object Date]"}function Tae(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function $2e(e){return Array.isArray(e)?e:[e]}function jq(e,t,r){if(e.length!==0)return e.reduce((i,s)=>{const n=[t(s),s];return i&&r(i[0],n[0])===i[0]?i:n},null)[1]}function L2e(e,t){return t.reduce((r,i)=>(r[i]=e[i],r),{})}function rT(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function dm(e,t,r){return zD(e)&&e>=t&&e<=r}function D2e(e,t){return e-t*Math.floor(e/t)}function In(e,t=2){const r=e<0;let i;return r?i="-"+(""+-e).padStart(t,"0"):i=(""+e).padStart(t,"0"),i}function y0(e){if(!(Yr(e)||e===null||e===""))return parseInt(e,10)}function qy(e){if(!(Yr(e)||e===null||e===""))return parseFloat(e)}function l7(e){if(!(Yr(e)||e===null||e==="")){const t=parseFloat("0."+e)*1e3;return Math.floor(t)}}function c7(e,t,r=!1){const i=10**t;return(r?Math.trunc:Math.round)(e*i)/i}function C3(e){return e%4===0&&(e%100!==0||e%400===0)}function oC(e){return C3(e)?366:365}function v$(e,t){const r=D2e(t-1,12)+1,i=e+(t-r)/12;return r===2?C3(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function u7(e){let t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t),t.setUTCFullYear(e.year,e.month-1,e.day)),+t}function b$(e){const t=(e+Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400))%7,r=e-1,i=(r+Math.floor(r/4)-Math.floor(r/100)+Math.floor(r/400))%7;return t===4||i===3?53:52}function G8(e){return e>99?e:e>Pn.twoDigitCutoffYear?1900+e:2e3+e}function Sae(e,t,r,i=null){const s=new Date(e),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(n.timeZone=i);const o={timeZoneName:t,...n},a=new Intl.DateTimeFormat(r,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function BD(e,t){let r=parseInt(e,10);Number.isNaN(r)&&(r=0);const i=parseInt(t,10)||0,s=r<0||Object.is(r,-0)?-i:i;return r*60+s}function Eae(e){const t=Number(e);if(typeof e=="boolean"||e===""||Number.isNaN(t))throw new Tu(`Invalid unit value ${e}`);return t}function w$(e,t){const r={};for(const i in e)if(rT(e,i)){const s=e[i];if(s==null)continue;r[t(i)]=Eae(s)}return r}function aC(e,t){const r=Math.trunc(Math.abs(e/60)),i=Math.trunc(Math.abs(e%60)),s=e>=0?"+":"-";switch(t){case"short":return`${s}${In(r,2)}:${In(i,2)}`;case"narrow":return`${s}${r}${i>0?`:${i}`:""}`;case"techie":return`${s}${In(r,2)}${In(i,2)}`;default:throw new RangeError(`Value format ${t} is out of range for property format`)}}function VD(e){return L2e(e,["hour","minute","second","millisecond"])}const N2e=["January","February","March","April","May","June","July","August","September","October","November","December"],Cae=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],F2e=["J","F","M","A","M","J","J","A","S","O","N","D"];function Aae(e){switch(e){case"narrow":return[...F2e];case"short":return[...Cae];case"long":return[...N2e];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const Oae=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Rae=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],U2e=["M","T","W","T","F","S","S"];function Pae(e){switch(e){case"narrow":return[...U2e];case"short":return[...Rae];case"long":return[...Oae];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const Mae=["AM","PM"],k2e=["Before Christ","Anno Domini"],z2e=["BC","AD"],B2e=["B","A"];function Iae(e){switch(e){case"narrow":return[...B2e];case"short":return[...z2e];case"long":return[...k2e];default:return null}}function V2e(e){return Mae[e.hour<12?0:1]}function G2e(e,t){return Pae(t)[e.weekday-1]}function j2e(e,t){return Aae(t)[e.month-1]}function H2e(e,t){return Iae(t)[e.year<0?0:1]}function W2e(e,t,r="always",i=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(e)===-1;if(r==="auto"&&n){const d=e==="days";switch(t){case 1:return d?"tomorrow":`next ${s[e][0]}`;case-1:return d?"yesterday":`last ${s[e][0]}`;case 0:return d?"today":`this ${s[e][0]}`}}const o=Object.is(t,-0)||t<0,a=Math.abs(t),l=a===1,c=s[e],u=i?l?c[1]:c[2]||c[1]:l?s[e][0]:e;return o?`${a} ${u} ago`:`in ${a} ${u}`}function Hq(e,t){let r="";for(const i of e)i.literal?r+=i.val:r+=t(i.val);return r}const q2e={D:_$,DD:sae,DDD:nae,DDDD:oae,t:aae,tt:lae,ttt:cae,tttt:uae,T:hae,TT:dae,TTT:pae,TTTT:fae,f:mae,ff:yae,fff:vae,ffff:wae,F:gae,FF:_ae,FFF:bae,FFFF:xae};class ya{static create(t,r={}){return new ya(t,r)}static parseFormat(t){let r=null,i="",s=!1;const n=[];for(let o=0;o<t.length;o++){const a=t.charAt(o);a==="'"?(i.length>0&&n.push({literal:s||/^\s+$/.test(i),val:i}),r=null,i="",s=!s):s||a===r?i+=a:(i.length>0&&n.push({literal:/^\s+$/.test(i),val:i}),i=a,r=a)}return i.length>0&&n.push({literal:s||/^\s+$/.test(i),val:i}),n}static macroTokenToFormatOpts(t){return q2e[t]}constructor(t,r){this.opts=r,this.loc=t,this.systemLoc=null}formatWithSystemDefault(t,r){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(t,{...this.opts,...r}).format()}formatDateTime(t,r={}){return this.loc.dtFormatter(t,{...this.opts,...r}).format()}formatDateTimeParts(t,r={}){return this.loc.dtFormatter(t,{...this.opts,...r}).formatToParts()}formatInterval(t,r={}){return this.loc.dtFormatter(t.start,{...this.opts,...r}).dtf.formatRange(t.start.toJSDate(),t.end.toJSDate())}resolvedOptions(t,r={}){return this.loc.dtFormatter(t,{...this.opts,...r}).resolvedOptions()}num(t,r=0){if(this.opts.forceSimple)return In(t,r);const i={...this.opts};return r>0&&(i.padTo=r),this.loc.numberFormatter(i).format(t)}formatDateTimeFromString(t,r){const i=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(g,y)=>this.loc.extract(t,g,y),o=g=>t.isOffsetFixed&&t.offset===0&&g.allowZ?"Z":t.isValid?t.zone.formatOffset(t.ts,g.format):"",a=()=>i?V2e(t):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(g,y)=>i?j2e(t,g):n(y?{month:g}:{month:g,day:"numeric"},"month"),c=(g,y)=>i?G2e(t,g):n(y?{weekday:g}:{weekday:g,month:"long",day:"numeric"},"weekday"),u=g=>{const y=ya.macroTokenToFormatOpts(g);return y?this.formatWithSystemDefault(t,y):g},d=g=>i?H2e(t,g):n({era:g},"era"),p=g=>{switch(g){case"S":return this.num(t.millisecond);case"u":case"SSS":return this.num(t.millisecond,3);case"s":return this.num(t.second);case"ss":return this.num(t.second,2);case"uu":return this.num(Math.floor(t.millisecond/10),2);case"uuu":return this.num(Math.floor(t.millisecond/100));case"m":return this.num(t.minute);case"mm":return this.num(t.minute,2);case"h":return this.num(t.hour%12===0?12:t.hour%12);case"hh":return this.num(t.hour%12===0?12:t.hour%12,2);case"H":return this.num(t.hour);case"HH":return this.num(t.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return t.zone.offsetName(t.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return t.zone.offsetName(t.ts,{format:"long",locale:this.loc.locale});case"z":return t.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(t.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(t.day,2);case"c":return this.num(t.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(t.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(t.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(t.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(t.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(t.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(t.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(t.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(t.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(t.year,6);case"G":return d("short");case"GG":return d("long");case"GGGGG":return d("narrow");case"kk":return this.num(t.weekYear.toString().slice(-2),2);case"kkkk":return this.num(t.weekYear,4);case"W":return this.num(t.weekNumber);case"WW":return this.num(t.weekNumber,2);case"o":return this.num(t.ordinal);case"ooo":return this.num(t.ordinal,3);case"q":return this.num(t.quarter);case"qq":return this.num(t.quarter,2);case"X":return this.num(Math.floor(t.ts/1e3));case"x":return this.num(t.ts);default:return u(g)}};return Hq(ya.parseFormat(r),p)}formatDurationFromString(t,r){const i=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const u=i(c);return u?this.num(l.get(u),c.length):c},n=ya.parseFormat(r),o=n.reduce((l,{literal:c,val:u})=>c?l:l.concat(u),[]),a=t.shiftTo(...o.map(i).filter(l=>l));return Hq(n,s(a))}}class ed{constructor(t,r){this.reason=t,this.explanation=r}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const $ae=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function o2(...e){const t=e.reduce((r,i)=>r+i.source,"");return RegExp(`^${t}$`)}function a2(...e){return t=>e.reduce(([r,i,s],n)=>{const[o,a,l]=n(t,s);return[{...r,...o},a||i,l]},[{},null,1]).slice(0,2)}function l2(e,...t){if(e==null)return[null,null];for(const[r,i]of t){const s=r.exec(e);if(s)return i(s)}return[null,null]}function Lae(...e){return(t,r)=>{const i={};let s;for(s=0;s<e.length;s++)i[e[s]]=y0(t[r+s]);return[i,null,r+s]}}const Dae=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,X2e=`(?:${Dae.source}?(?:\\[(${$ae.source})\\])?)?`,h7=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,Nae=RegExp(`${h7.source}${X2e}`),d7=RegExp(`(?:T${Nae.source})?`),Z2e=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,Y2e=/(\d{4})-?W(\d\d)(?:-?(\d))?/,J2e=/(\d{4})-?(\d{3})/,K2e=Lae("weekYear","weekNumber","weekDay"),Q2e=Lae("year","ordinal"),eSe=/(\d{4})-(\d\d)-(\d\d)/,Fae=RegExp(`${h7.source} ?(?:${Dae.source}|(${$ae.source}))?`),tSe=RegExp(`(?: ${Fae.source})?`);function Ox(e,t,r){const i=e[t];return Yr(i)?r:y0(i)}function rSe(e,t){return[{year:Ox(e,t),month:Ox(e,t+1,1),day:Ox(e,t+2,1)},null,t+3]}function c2(e,t){return[{hours:Ox(e,t,0),minutes:Ox(e,t+1,0),seconds:Ox(e,t+2,0),milliseconds:l7(e[t+3])},null,t+4]}function A3(e,t){const r=!e[t]&&!e[t+1],i=BD(e[t+1],e[t+2]),s=r?null:va.instance(i);return[{},s,t+3]}function O3(e,t){const r=e[t]?Pm.create(e[t]):null;return[{},r,t+1]}const iSe=RegExp(`^T?${h7.source}$`),sSe=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function nSe(e){const[t,r,i,s,n,o,a,l,c]=e,u=t[0]==="-",d=l&&l[0]==="-",p=(g,y=!1)=>g!==void 0&&(y||g&&u)?-g:g;return[{years:p(qy(r)),months:p(qy(i)),weeks:p(qy(s)),days:p(qy(n)),hours:p(qy(o)),minutes:p(qy(a)),seconds:p(qy(l),l==="-0"),milliseconds:p(l7(c),d)}]}const oSe={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function p7(e,t,r,i,s,n,o){const a={year:t.length===2?G8(y0(t)):y0(t),month:Cae.indexOf(r)+1,day:y0(i),hour:y0(s),minute:y0(n)};return o&&(a.second=y0(o)),e&&(a.weekday=e.length>3?Oae.indexOf(e)+1:Rae.indexOf(e)+1),a}const aSe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function lSe(e){const[,t,r,i,s,n,o,a,l,c,u,d]=e,p=p7(t,s,i,r,n,o,a);let g;return l?g=oSe[l]:c?g=0:g=BD(u,d),[p,new va(g)]}function cSe(e){return e.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const uSe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,hSe=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,dSe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Wq(e){const[,t,r,i,s,n,o,a]=e;return[p7(t,s,i,r,n,o,a),va.utcInstance]}function pSe(e){const[,t,r,i,s,n,o,a]=e;return[p7(t,a,r,i,s,n,o),va.utcInstance]}const fSe=o2(Z2e,d7),mSe=o2(Y2e,d7),gSe=o2(J2e,d7),ySe=o2(Nae),Uae=a2(rSe,c2,A3,O3),_Se=a2(K2e,c2,A3,O3),vSe=a2(Q2e,c2,A3,O3),bSe=a2(c2,A3,O3);function wSe(e){return l2(e,[fSe,Uae],[mSe,_Se],[gSe,vSe],[ySe,bSe])}function xSe(e){return l2(cSe(e),[aSe,lSe])}function TSe(e){return l2(e,[uSe,Wq],[hSe,Wq],[dSe,pSe])}function SSe(e){return l2(e,[sSe,nSe])}const ESe=a2(c2);function CSe(e){return l2(e,[iSe,ESe])}const ASe=o2(eSe,tSe),OSe=o2(Fae),RSe=a2(c2,A3,O3);function PSe(e){return l2(e,[ASe,Uae],[OSe,RSe])}const MSe="Invalid Duration",kae={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},ISe={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...kae},Gc=146097/400,db=146097/4800,$Se={years:{quarters:4,months:12,weeks:Gc/7,days:Gc,hours:Gc*24,minutes:Gc*24*60,seconds:Gc*24*60*60,milliseconds:Gc*24*60*60*1e3},quarters:{months:3,weeks:Gc/28,days:Gc/4,hours:Gc*24/4,minutes:Gc*24*60/4,seconds:Gc*24*60*60/4,milliseconds:Gc*24*60*60*1e3/4},months:{weeks:db/7,days:db,hours:db*24,minutes:db*24*60,seconds:db*24*60*60,milliseconds:db*24*60*60*1e3},...kae},A_=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],LSe=A_.slice(0).reverse();function hg(e,t,r=!1){const i={values:r?t.values:{...e.values,...t.values||{}},loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy,matrix:t.matrix||e.matrix};return new ei(i)}function DSe(e){return e<0?Math.floor(e):Math.ceil(e)}function zae(e,t,r,i,s){const n=e[s][r],o=t[r]/n,a=Math.sign(o)===Math.sign(i[s]),l=!a&&i[s]!==0&&Math.abs(o)<=1?DSe(o):Math.trunc(o);i[s]+=l,t[r]-=l*n}function NSe(e,t){LSe.reduce((r,i)=>Yr(t[i])?r:(r&&zae(e,t,r,t,i),i),null)}function FSe(e){const t={};for(const[r,i]of Object.entries(e))i!==0&&(t[r]=i);return t}class ei{constructor(t){const r=t.conversionAccuracy==="longterm"||!1;let i=r?$Se:ISe;t.matrix&&(i=t.matrix),this.values=t.values,this.loc=t.loc||gs.create(),this.conversionAccuracy=r?"longterm":"casual",this.invalid=t.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(t,r){return ei.fromObject({milliseconds:t},r)}static fromObject(t,r={}){if(t==null||typeof t!="object")throw new Tu(`Duration.fromObject: argument expected to be an object, got ${t===null?"null":typeof t}`);return new ei({values:w$(t,ei.normalizeUnit),loc:gs.fromObject(r),conversionAccuracy:r.conversionAccuracy,matrix:r.matrix})}static fromDurationLike(t){if(Nv(t))return ei.fromMillis(t);if(ei.isDuration(t))return t;if(typeof t=="object")return ei.fromObject(t);throw new Tu(`Unknown duration argument ${t} of type ${typeof t}`)}static fromISO(t,r){const[i]=SSe(t);return i?ei.fromObject(i,r):ei.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static fromISOTime(t,r){const[i]=CSe(t);return i?ei.fromObject(i,r):ei.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static invalid(t,r=null){if(!t)throw new Tu("need to specify a reason the Duration is invalid");const i=t instanceof ed?t:new ed(t,r);if(Pn.throwOnInvalid)throw new h2e(i);return new ei({invalid:i})}static normalizeUnit(t){const r={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[t&&t.toLowerCase()];if(!r)throw new iae(t);return r}static isDuration(t){return t&&t.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(t,r={}){const i={...r,floor:r.round!==!1&&r.floor!==!1};return this.isValid?ya.create(this.loc,i).formatDurationFromString(this,t):MSe}toHuman(t={}){const r=A_.map(i=>{const s=this.values[i];return Yr(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...t,unit:i.slice(0,-1)}).format(s)}).filter(i=>i);return this.loc.listFormatter({type:"conjunction",style:t.listStyle||"narrow",...t}).format(r)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let t="P";return this.years!==0&&(t+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(t+=this.months+this.quarters*3+"M"),this.weeks!==0&&(t+=this.weeks+"W"),this.days!==0&&(t+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(t+="T"),this.hours!==0&&(t+=this.hours+"H"),this.minutes!==0&&(t+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(t+=c7(this.seconds+this.milliseconds/1e3,3)+"S"),t==="P"&&(t+="T0S"),t}toISOTime(t={}){if(!this.isValid)return null;const r=this.toMillis();if(r<0||r>=864e5)return null;t={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...t};const i=this.shiftTo("hours","minutes","seconds","milliseconds");let s=t.format==="basic"?"hhmm":"hh:mm";(!t.suppressSeconds||i.seconds!==0||i.milliseconds!==0)&&(s+=t.format==="basic"?"ss":":ss",(!t.suppressMilliseconds||i.milliseconds!==0)&&(s+=".SSS"));let n=i.toFormat(s);return t.includePrefix&&(n="T"+n),n}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(t){if(!this.isValid)return this;const r=ei.fromDurationLike(t),i={};for(const s of A_)(rT(r.values,s)||rT(this.values,s))&&(i[s]=r.get(s)+this.get(s));return hg(this,{values:i},!0)}minus(t){if(!this.isValid)return this;const r=ei.fromDurationLike(t);return this.plus(r.negate())}mapUnits(t){if(!this.isValid)return this;const r={};for(const i of Object.keys(this.values))r[i]=Eae(t(this.values[i],i));return hg(this,{values:r},!0)}get(t){return this[ei.normalizeUnit(t)]}set(t){if(!this.isValid)return this;const r={...this.values,...w$(t,ei.normalizeUnit)};return hg(this,{values:r})}reconfigure({locale:t,numberingSystem:r,conversionAccuracy:i,matrix:s}={}){const o={loc:this.loc.clone({locale:t,numberingSystem:r}),matrix:s,conversionAccuracy:i};return hg(this,o)}as(t){return this.isValid?this.shiftTo(t).get(t):NaN}normalize(){if(!this.isValid)return this;const t=this.toObject();return NSe(this.matrix,t),hg(this,{values:t},!0)}rescale(){if(!this.isValid)return this;const t=FSe(this.normalize().shiftToAll().toObject());return hg(this,{values:t},!0)}shiftTo(...t){if(!this.isValid)return this;if(t.length===0)return this;t=t.map(o=>ei.normalizeUnit(o));const r={},i={},s=this.toObject();let n;for(const o of A_)if(t.indexOf(o)>=0){n=o;let a=0;for(const c in i)a+=this.matrix[c][o]*i[c],i[c]=0;Nv(s[o])&&(a+=s[o]);const l=Math.trunc(a);r[o]=l,i[o]=(a*1e3-l*1e3)/1e3;for(const c in s)A_.indexOf(c)>A_.indexOf(o)&&zae(this.matrix,s,c,r,o)}else Nv(s[o])&&(i[o]=s[o]);for(const o in i)i[o]!==0&&(r[n]+=o===n?i[o]:i[o]/this.matrix[n][o]);return hg(this,{values:r},!0).normalize()}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const t={};for(const r of Object.keys(this.values))t[r]=this.values[r]===0?0:-this.values[r];return hg(this,{values:t},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(t){if(!this.isValid||!t.isValid||!this.loc.equals(t.loc))return!1;function r(i,s){return i===void 0||i===0?s===void 0||s===0:i===s}for(const i of A_)if(!r(this.values[i],t.values[i]))return!1;return!0}}const pb="Invalid Interval";function USe(e,t){return!e||!e.isValid?zs.invalid("missing or invalid start"):!t||!t.isValid?zs.invalid("missing or invalid end"):t<e?zs.invalid("end before start",`The end of an interval must be after its start, but you had start=${e.toISO()} and end=${t.toISO()}`):null}class zs{constructor(t){this.s=t.start,this.e=t.end,this.invalid=t.invalid||null,this.isLuxonInterval=!0}static invalid(t,r=null){if(!t)throw new Tu("need to specify a reason the Interval is invalid");const i=t instanceof ed?t:new ed(t,r);if(Pn.throwOnInvalid)throw new u2e(i);return new zs({invalid:i})}static fromDateTimes(t,r){const i=k2(t),s=k2(r),n=USe(i,s);return n??new zs({start:i,end:s})}static after(t,r){const i=ei.fromDurationLike(r),s=k2(t);return zs.fromDateTimes(s,s.plus(i))}static before(t,r){const i=ei.fromDurationLike(r),s=k2(t);return zs.fromDateTimes(s.minus(i),s)}static fromISO(t,r){const[i,s]=(t||"").split("/",2);if(i&&s){let n,o;try{n=ur.fromISO(i,r),o=n.isValid}catch{o=!1}let a,l;try{a=ur.fromISO(s,r),l=a.isValid}catch{l=!1}if(o&&l)return zs.fromDateTimes(n,a);if(o){const c=ei.fromISO(s,r);if(c.isValid)return zs.after(n,c)}else if(l){const c=ei.fromISO(i,r);if(c.isValid)return zs.before(a,c)}}return zs.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static isInterval(t){return t&&t.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(t="milliseconds"){return this.isValid?this.toDuration(t).get(t):NaN}count(t="milliseconds"){if(!this.isValid)return NaN;const r=this.start.startOf(t),i=this.end.startOf(t);return Math.floor(i.diff(r,t).get(t))+(i.valueOf()!==this.end.valueOf())}hasSame(t){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,t):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(t){return this.isValid?this.s>t:!1}isBefore(t){return this.isValid?this.e<=t:!1}contains(t){return this.isValid?this.s<=t&&this.e>t:!1}set({start:t,end:r}={}){return this.isValid?zs.fromDateTimes(t||this.s,r||this.e):this}splitAt(...t){if(!this.isValid)return[];const r=t.map(k2).filter(o=>this.contains(o)).sort(),i=[];let{s}=this,n=0;for(;s<this.e;){const o=r[n]||this.e,a=+o>+this.e?this.e:o;i.push(zs.fromDateTimes(s,a)),s=a,n+=1}return i}splitBy(t){const r=ei.fromDurationLike(t);if(!this.isValid||!r.isValid||r.as("milliseconds")===0)return[];let{s:i}=this,s=1,n;const o=[];for(;i<this.e;){const a=this.start.plus(r.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(zs.fromDateTimes(i,n)),i=n,s+=1}return o}divideEqually(t){return this.isValid?this.splitBy(this.length()/t).slice(0,t):[]}overlaps(t){return this.e>t.s&&this.s<t.e}abutsStart(t){return this.isValid?+this.e==+t.s:!1}abutsEnd(t){return this.isValid?+t.e==+this.s:!1}engulfs(t){return this.isValid?this.s<=t.s&&this.e>=t.e:!1}equals(t){return!this.isValid||!t.isValid?!1:this.s.equals(t.s)&&this.e.equals(t.e)}intersection(t){if(!this.isValid)return this;const r=this.s>t.s?this.s:t.s,i=this.e<t.e?this.e:t.e;return r>=i?null:zs.fromDateTimes(r,i)}union(t){if(!this.isValid)return this;const r=this.s<t.s?this.s:t.s,i=this.e>t.e?this.e:t.e;return zs.fromDateTimes(r,i)}static merge(t){const[r,i]=t.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return i&&r.push(i),r}static xor(t){let r=null,i=0;const s=[],n=t.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)i+=l.type==="s"?1:-1,i===1?r=l.time:(r&&+r!=+l.time&&s.push(zs.fromDateTimes(r,l.time)),r=null);return zs.merge(s)}difference(...t){return zs.xor([this].concat(t)).map(r=>this.intersection(r)).filter(r=>r&&!r.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:pb}toLocaleString(t=_$,r={}){return this.isValid?ya.create(this.s.loc.clone(r),t).formatInterval(this):pb}toISO(t){return this.isValid?`${this.s.toISO(t)}/${this.e.toISO(t)}`:pb}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:pb}toISOTime(t){return this.isValid?`${this.s.toISOTime(t)}/${this.e.toISOTime(t)}`:pb}toFormat(t,{separator:r=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(t)}${r}${this.e.toFormat(t)}`:pb}toDuration(t,r){return this.isValid?this.e.diff(this.s,t,r):ei.invalid(this.invalidReason)}mapEndpoints(t){return zs.fromDateTimes(t(this.s),t(this.e))}}class CO{static hasDST(t=Pn.defaultZone){const r=ur.now().setZone(t).set({month:12});return!t.isUniversal&&r.offset!==r.set({month:6}).offset}static isValidIANAZone(t){return Pm.isValidZone(t)}static normalizeZone(t){return C0(t,Pn.defaultZone)}static months(t="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||gs.create(r,i,n)).months(t)}static monthsFormat(t="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||gs.create(r,i,n)).months(t,!0)}static weekdays(t="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||gs.create(r,i,null)).weekdays(t)}static weekdaysFormat(t="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||gs.create(r,i,null)).weekdays(t,!0)}static meridiems({locale:t=null}={}){return gs.create(t).meridiems()}static eras(t="short",{locale:r=null}={}){return gs.create(r,null,"gregory").eras(t)}static features(){return{relative:Tae()}}}function qq(e,t){const r=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=r(t)-r(e);return Math.floor(ei.fromMillis(i).as("days"))}function kSe(e,t,r){const i=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const u=qq(l,c);return(u-u%7)/7}],["days",qq]],s={},n=e;let o,a;for(const[l,c]of i)r.indexOf(l)>=0&&(o=l,s[l]=c(e,t),a=n.plus(s),a>t?(s[l]--,e=n.plus(s)):e=a);return[e,s,a,o]}function zSe(e,t,r,i){let[s,n,o,a]=kSe(e,t,r);const l=t-s,c=r.filter(d=>["hours","minutes","seconds","milliseconds"].indexOf(d)>=0);c.length===0&&(o<t&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const u=ei.fromObject(n,i);return c.length>0?ei.fromMillis(l,i).shiftTo(...c).plus(u):u}const f7={arab:"[\u0660-\u0669]",arabext:"[\u06F0-\u06F9]",bali:"[\u1B50-\u1B59]",beng:"[\u09E6-\u09EF]",deva:"[\u0966-\u096F]",fullwide:"[\uFF10-\uFF19]",gujr:"[\u0AE6-\u0AEF]",hanidec:"[\u3007|\u4E00|\u4E8C|\u4E09|\u56DB|\u4E94|\u516D|\u4E03|\u516B|\u4E5D]",khmr:"[\u17E0-\u17E9]",knda:"[\u0CE6-\u0CEF]",laoo:"[\u0ED0-\u0ED9]",limb:"[\u1946-\u194F]",mlym:"[\u0D66-\u0D6F]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0B66-\u0B6F]",tamldec:"[\u0BE6-\u0BEF]",telu:"[\u0C66-\u0C6F]",thai:"[\u0E50-\u0E59]",tibt:"[\u0F20-\u0F29]",latn:"\\d"},Xq={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},BSe=f7.hanidec.replace(/[\[|\]]/g,"").split("");function VSe(e){let t=parseInt(e,10);if(isNaN(t)){t="";for(let r=0;r<e.length;r++){const i=e.charCodeAt(r);if(e[r].search(f7.hanidec)!==-1)t+=BSe.indexOf(e[r]);else for(const s in Xq){const[n,o]=Xq[s];i>=n&&i<=o&&(t+=i-n)}}return parseInt(t,10)}else return t}function uh({numberingSystem:e},t=""){return new RegExp(`${f7[e||"latn"]}${t}`)}const GSe="missing Intl.DateTimeFormat.formatToParts support";function _i(e,t=r=>r){return{regex:e,deser:([r])=>t(VSe(r))}}const jSe=String.fromCharCode(160),Bae=`[ ${jSe}]`,Vae=new RegExp(Bae,"g");function HSe(e){return e.replace(/\./g,"\\.?").replace(Vae,Bae)}function Zq(e){return e.replace(/\./g,"").replace(Vae," ").toLowerCase()}function hh(e,t){return e===null?null:{regex:RegExp(e.map(HSe).join("|")),deser:([r])=>e.findIndex(i=>Zq(r)===Zq(i))+t}}function Yq(e,t){return{regex:e,deser:([,r,i])=>BD(r,i),groups:t}}function AO(e){return{regex:e,deser:([t])=>t}}function WSe(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function qSe(e,t){const r=uh(t),i=uh(t,"{2}"),s=uh(t,"{3}"),n=uh(t,"{4}"),o=uh(t,"{6}"),a=uh(t,"{1,2}"),l=uh(t,"{1,3}"),c=uh(t,"{1,6}"),u=uh(t,"{1,9}"),d=uh(t,"{2,4}"),p=uh(t,"{4,6}"),g=v=>({regex:RegExp(WSe(v.val)),deser:([w])=>w,literal:!0}),_=(v=>{if(e.literal)return g(v);switch(v.val){case"G":return hh(t.eras("short",!1),0);case"GG":return hh(t.eras("long",!1),0);case"y":return _i(c);case"yy":return _i(d,G8);case"yyyy":return _i(n);case"yyyyy":return _i(p);case"yyyyyy":return _i(o);case"M":return _i(a);case"MM":return _i(i);case"MMM":return hh(t.months("short",!0,!1),1);case"MMMM":return hh(t.months("long",!0,!1),1);case"L":return _i(a);case"LL":return _i(i);case"LLL":return hh(t.months("short",!1,!1),1);case"LLLL":return hh(t.months("long",!1,!1),1);case"d":return _i(a);case"dd":return _i(i);case"o":return _i(l);case"ooo":return _i(s);case"HH":return _i(i);case"H":return _i(a);case"hh":return _i(i);case"h":return _i(a);case"mm":return _i(i);case"m":return _i(a);case"q":return _i(a);case"qq":return _i(i);case"s":return _i(a);case"ss":return _i(i);case"S":return _i(l);case"SSS":return _i(s);case"u":return AO(u);case"uu":return AO(a);case"uuu":return _i(r);case"a":return hh(t.meridiems(),0);case"kkkk":return _i(n);case"kk":return _i(d,G8);case"W":return _i(a);case"WW":return _i(i);case"E":case"c":return _i(r);case"EEE":return hh(t.weekdays("short",!1,!1),1);case"EEEE":return hh(t.weekdays("long",!1,!1),1);case"ccc":return hh(t.weekdays("short",!0,!1),1);case"cccc":return hh(t.weekdays("long",!0,!1),1);case"Z":case"ZZ":return Yq(new RegExp(`([+-]${a.source})(?::(${i.source}))?`),2);case"ZZZ":return Yq(new RegExp(`([+-]${a.source})(${i.source})?`),2);case"z":return AO(/[a-z_+-/]{1,256}?/i);case" ":return AO(/[^\S\n\r]/);default:return g(v)}})(e)||{invalidReason:GSe};return _.token=e,_}const XSe={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function ZSe(e,t){const{type:r,value:i}=e;if(r==="literal"){const o=/^\s+$/.test(i);return{literal:!o,val:o?" ":i}}const s=t[r];let n=XSe[r];if(typeof n=="object"&&(n=n[s]),n)return{literal:!1,val:n}}function YSe(e){return[`^${e.map(r=>r.regex).reduce((r,i)=>`${r}(${i.source})`,"")}$`,e]}function JSe(e,t,r){const i=e.match(t);if(i){const s={};let n=1;for(const o in r)if(rT(r,o)){const a=r[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(i.slice(n,n+l))),n+=l}return[i,s]}else return[i,{}]}function KSe(e){const t=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let r=null,i;return Yr(e.z)||(r=Pm.create(e.z)),Yr(e.Z)||(r||(r=new va(e.Z)),i=e.Z),Yr(e.q)||(e.M=(e.q-1)*3+1),Yr(e.h)||(e.h<12&&e.a===1?e.h+=12:e.h===12&&e.a===0&&(e.h=0)),e.G===0&&e.y&&(e.y=-e.y),Yr(e.u)||(e.S=l7(e.u)),[Object.keys(e).reduce((n,o)=>{const a=t(o);return a&&(n[a]=e[o]),n},{}),r,i]}let k5=null;function QSe(){return k5||(k5=ur.fromMillis(1555555555555)),k5}function eEe(e,t){if(e.literal)return e;const r=ya.macroTokenToFormatOpts(e.val),i=Hae(r,t);return i==null||i.includes(void 0)?e:i}function Gae(e,t){return Array.prototype.concat(...e.map(r=>eEe(r,t)))}function jae(e,t,r){const i=Gae(ya.parseFormat(r),e),s=i.map(o=>qSe(o,e)),n=s.find(o=>o.invalidReason);if(n)return{input:t,tokens:i,invalidReason:n.invalidReason};{const[o,a]=YSe(s),l=RegExp(o,"i"),[c,u]=JSe(t,l,a),[d,p,g]=u?KSe(u):[null,null,void 0];if(rT(u,"a")&&rT(u,"H"))throw new GS("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:i,regex:l,rawMatches:c,matches:u,result:d,zone:p,specificOffset:g}}}function tEe(e,t,r){const{result:i,zone:s,specificOffset:n,invalidReason:o}=jae(e,t,r);return[i,s,n,o]}function Hae(e,t){return e?ya.create(t,e).formatDateTimeParts(QSe()).map(s=>ZSe(s,e)):null}const Wae=[0,31,59,90,120,151,181,212,243,273,304,334],qae=[0,31,60,91,121,152,182,213,244,274,305,335];function Du(e,t){return new ed("unit out of range",`you specified ${t} (of type ${typeof t}) as a ${e}, which is invalid`)}function Xae(e,t,r){const i=new Date(Date.UTC(e,t-1,r));e<100&&e>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const s=i.getUTCDay();return s===0?7:s}function Zae(e,t,r){return r+(C3(e)?qae:Wae)[t-1]}function Yae(e,t){const r=C3(e)?qae:Wae,i=r.findIndex(n=>n<t),s=t-r[i];return{month:i+1,day:s}}function j8(e){const{year:t,month:r,day:i}=e,s=Zae(t,r,i),n=Xae(t,r,i);let o=Math.floor((s-n+10)/7),a;return o<1?(a=t-1,o=b$(a)):o>b$(t)?(a=t+1,o=1):a=t,{weekYear:a,weekNumber:o,weekday:n,...VD(e)}}function Jq(e){const{weekYear:t,weekNumber:r,weekday:i}=e,s=Xae(t,1,4),n=oC(t);let o=r*7+i-s-3,a;o<1?(a=t-1,o+=oC(a)):o>n?(a=t+1,o-=oC(t)):a=t;const{month:l,day:c}=Yae(a,o);return{year:a,month:l,day:c,...VD(e)}}function z5(e){const{year:t,month:r,day:i}=e,s=Zae(t,r,i);return{year:t,ordinal:s,...VD(e)}}function Kq(e){const{year:t,ordinal:r}=e,{month:i,day:s}=Yae(t,r);return{year:t,month:i,day:s,...VD(e)}}function rEe(e){const t=zD(e.weekYear),r=dm(e.weekNumber,1,b$(e.weekYear)),i=dm(e.weekday,1,7);return t?r?i?!1:Du("weekday",e.weekday):Du("week",e.week):Du("weekYear",e.weekYear)}function iEe(e){const t=zD(e.year),r=dm(e.ordinal,1,oC(e.year));return t?r?!1:Du("ordinal",e.ordinal):Du("year",e.year)}function Jae(e){const t=zD(e.year),r=dm(e.month,1,12),i=dm(e.day,1,v$(e.year,e.month));return t?r?i?!1:Du("day",e.day):Du("month",e.month):Du("year",e.year)}function Kae(e){const{hour:t,minute:r,second:i,millisecond:s}=e,n=dm(t,0,23)||t===24&&r===0&&i===0&&s===0,o=dm(r,0,59),a=dm(i,0,59),l=dm(s,0,999);return n?o?a?l?!1:Du("millisecond",s):Du("second",i):Du("minute",r):Du("hour",t)}const B5="Invalid DateTime",Qq=864e13;function OO(e){return new ed("unsupported zone",`the zone "${e.name}" is not supported`)}function V5(e){return e.weekData===null&&(e.weekData=j8(e.c)),e.weekData}function F2(e,t){const r={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new ur({...r,...t,old:r})}function Qae(e,t,r){let i=e-t*60*1e3;const s=r.offset(i);if(t===s)return[i,t];i-=(s-t)*60*1e3;const n=r.offset(i);return s===n?[i,s]:[e-Math.min(s,n)*60*1e3,Math.max(s,n)]}function eX(e,t){e+=t*60*1e3;const r=new Date(e);return{year:r.getUTCFullYear(),month:r.getUTCMonth()+1,day:r.getUTCDate(),hour:r.getUTCHours(),minute:r.getUTCMinutes(),second:r.getUTCSeconds(),millisecond:r.getUTCMilliseconds()}}function _M(e,t,r){return Qae(u7(e),t,r)}function tX(e,t){const r=e.o,i=e.c.year+Math.trunc(t.years),s=e.c.month+Math.trunc(t.months)+Math.trunc(t.quarters)*3,n={...e.c,year:i,month:s,day:Math.min(e.c.day,v$(i,s))+Math.trunc(t.days)+Math.trunc(t.weeks)*7},o=ei.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),a=u7(n);let[l,c]=Qae(a,r,e.zone);return o!==0&&(l+=o,c=e.zone.offset(l)),{ts:l,o:c}}function U2(e,t,r,i,s,n){const{setZone:o,zone:a}=r;if(e&&Object.keys(e).length!==0||t){const l=t||a,c=ur.fromObject(e,{...r,zone:l,specificOffset:n});return o?c:c.setZone(a)}else return ur.invalid(new ed("unparsable",`the input "${s}" can't be parsed as ${i}`))}function RO(e,t,r=!0){return e.isValid?ya.create(gs.create("en-US"),{allowZ:r,forceSimple:!0}).formatDateTimeFromString(e,t):null}function G5(e,t){const r=e.c.year>9999||e.c.year<0;let i="";return r&&e.c.year>=0&&(i+="+"),i+=In(e.c.year,r?6:4),t?(i+="-",i+=In(e.c.month),i+="-",i+=In(e.c.day)):(i+=In(e.c.month),i+=In(e.c.day)),i}function rX(e,t,r,i,s,n){let o=In(e.c.hour);return t?(o+=":",o+=In(e.c.minute),(e.c.second!==0||!r)&&(o+=":")):o+=In(e.c.minute),(e.c.second!==0||!r)&&(o+=In(e.c.second),(e.c.millisecond!==0||!i)&&(o+=".",o+=In(e.c.millisecond,3))),s&&(e.isOffsetFixed&&e.offset===0&&!n?o+="Z":e.o<0?(o+="-",o+=In(Math.trunc(-e.o/60)),o+=":",o+=In(Math.trunc(-e.o%60))):(o+="+",o+=In(Math.trunc(e.o/60)),o+=":",o+=In(Math.trunc(e.o%60)))),n&&(o+="["+e.zone.ianaName+"]"),o}const ele={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},sEe={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},nEe={ordinal:1,hour:0,minute:0,second:0,millisecond:0},tle=["year","month","day","hour","minute","second","millisecond"],oEe=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],aEe=["year","ordinal","hour","minute","second","millisecond"];function iX(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new iae(e);return t}function sX(e,t){const r=C0(t.zone,Pn.defaultZone),i=gs.fromObject(t),s=Pn.now();let n,o;if(Yr(e.year))n=s;else{for(const c of tle)Yr(e[c])&&(e[c]=ele[c]);const a=Jae(e)||Kae(e);if(a)return ur.invalid(a);const l=r.offset(s);[n,o]=_M(e,l,r)}return new ur({ts:n,zone:r,loc:i,o})}function nX(e,t,r){const i=Yr(r.round)?!0:r.round,s=(o,a)=>(o=c7(o,i||r.calendary?0:2,!0),t.loc.clone(r).relFormatter(r).format(o,a)),n=o=>r.calendary?t.hasSame(e,o)?0:t.startOf(o).diff(e.startOf(o),o).get(o):t.diff(e,o).get(o);if(r.unit)return s(n(r.unit),r.unit);for(const o of r.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(e>t?-0:0,r.units[r.units.length-1])}function oX(e){let t={},r;return e.length>0&&typeof e[e.length-1]=="object"?(t=e[e.length-1],r=Array.from(e).slice(0,e.length-1)):r=Array.from(e),[t,r]}class ur{constructor(t){const r=t.zone||Pn.defaultZone;let i=t.invalid||(Number.isNaN(t.ts)?new ed("invalid input"):null)||(r.isValid?null:OO(r));this.ts=Yr(t.ts)?Pn.now():t.ts;let s=null,n=null;if(!i)if(t.old&&t.old.ts===this.ts&&t.old.zone.equals(r))[s,n]=[t.old.c,t.old.o];else{const a=r.offset(this.ts);s=eX(this.ts,a),i=Number.isNaN(s.year)?new ed("invalid input"):null,s=i?null:s,n=i?null:a}this._zone=r,this.loc=t.loc||gs.create(),this.invalid=i,this.weekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new ur({})}static local(){const[t,r]=oX(arguments),[i,s,n,o,a,l,c]=r;return sX({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)}static utc(){const[t,r]=oX(arguments),[i,s,n,o,a,l,c]=r;return t.zone=va.utcInstance,sX({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)}static fromJSDate(t,r={}){const i=I2e(t)?t.valueOf():NaN;if(Number.isNaN(i))return ur.invalid("invalid input");const s=C0(r.zone,Pn.defaultZone);return s.isValid?new ur({ts:i,zone:s,loc:gs.fromObject(r)}):ur.invalid(OO(s))}static fromMillis(t,r={}){if(Nv(t))return t<-Qq||t>Qq?ur.invalid("Timestamp out of range"):new ur({ts:t,zone:C0(r.zone,Pn.defaultZone),loc:gs.fromObject(r)});throw new Tu(`fromMillis requires a numerical input, but received a ${typeof t} with value ${t}`)}static fromSeconds(t,r={}){if(Nv(t))return new ur({ts:t*1e3,zone:C0(r.zone,Pn.defaultZone),loc:gs.fromObject(r)});throw new Tu("fromSeconds requires a numerical input")}static fromObject(t,r={}){t=t||{};const i=C0(r.zone,Pn.defaultZone);if(!i.isValid)return ur.invalid(OO(i));const s=Pn.now(),n=Yr(r.specificOffset)?i.offset(s):r.specificOffset,o=w$(t,iX),a=!Yr(o.ordinal),l=!Yr(o.year),c=!Yr(o.month)||!Yr(o.day),u=l||c,d=o.weekYear||o.weekNumber,p=gs.fromObject(r);if((u||a)&&d)throw new GS("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new GS("Can't mix ordinal dates with month/day");const g=d||o.weekday&&!u;let y,_,v=eX(s,n);g?(y=oEe,_=sEe,v=j8(v)):a?(y=aEe,_=nEe,v=z5(v)):(y=tle,_=ele);let w=!1;for(const P of y){const U=o[P];Yr(U)?w?o[P]=_[P]:o[P]=v[P]:w=!0}const T=g?rEe(o):a?iEe(o):Jae(o),x=T||Kae(o);if(x)return ur.invalid(x);const S=g?Jq(o):a?Kq(o):o,[O,A]=_M(S,n,i),$=new ur({ts:O,zone:i,o:A,loc:p});return o.weekday&&u&&t.weekday!==$.weekday?ur.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${$.toISO()}`):$}static fromISO(t,r={}){const[i,s]=wSe(t);return U2(i,s,r,"ISO 8601",t)}static fromRFC2822(t,r={}){const[i,s]=xSe(t);return U2(i,s,r,"RFC 2822",t)}static fromHTTP(t,r={}){const[i,s]=TSe(t);return U2(i,s,r,"HTTP",r)}static fromFormat(t,r,i={}){if(Yr(t)||Yr(r))throw new Tu("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=i,o=gs.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,u]=tEe(o,t,r);return u?ur.invalid(u):U2(a,l,i,`format ${r}`,t,c)}static fromString(t,r,i={}){return ur.fromFormat(t,r,i)}static fromSQL(t,r={}){const[i,s]=PSe(t);return U2(i,s,r,"SQL",t)}static invalid(t,r=null){if(!t)throw new Tu("need to specify a reason the DateTime is invalid");const i=t instanceof ed?t:new ed(t,r);if(Pn.throwOnInvalid)throw new c2e(i);return new ur({invalid:i})}static isDateTime(t){return t&&t.isLuxonDateTime||!1}static parseFormatForOpts(t,r={}){const i=Hae(t,gs.fromObject(r));return i?i.map(s=>s?s.val:null).join(""):null}static expandFormat(t,r={}){return Gae(ya.parseFormat(t),gs.fromObject(r)).map(s=>s.val).join("")}get(t){return this[t]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?V5(this).weekYear:NaN}get weekNumber(){return this.isValid?V5(this).weekNumber:NaN}get weekday(){return this.isValid?V5(this).weekday:NaN}get ordinal(){return this.isValid?z5(this.c).ordinal:NaN}get monthShort(){return this.isValid?CO.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?CO.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?CO.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?CO.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return C3(this.year)}get daysInMonth(){return v$(this.year,this.month)}get daysInYear(){return this.isValid?oC(this.year):NaN}get weeksInWeekYear(){return this.isValid?b$(this.weekYear):NaN}resolvedLocaleOptions(t={}){const{locale:r,numberingSystem:i,calendar:s}=ya.create(this.loc.clone(t),t).resolvedOptions(this);return{locale:r,numberingSystem:i,outputCalendar:s}}toUTC(t=0,r={}){return this.setZone(va.instance(t),r)}toLocal(){return this.setZone(Pn.defaultZone)}setZone(t,{keepLocalTime:r=!1,keepCalendarTime:i=!1}={}){if(t=C0(t,Pn.defaultZone),t.equals(this.zone))return this;if(t.isValid){let s=this.ts;if(r||i){const n=t.offset(this.ts),o=this.toObject();[s]=_M(o,n,t)}return F2(this,{ts:s,zone:t})}else return ur.invalid(OO(t))}reconfigure({locale:t,numberingSystem:r,outputCalendar:i}={}){const s=this.loc.clone({locale:t,numberingSystem:r,outputCalendar:i});return F2(this,{loc:s})}setLocale(t){return this.reconfigure({locale:t})}set(t){if(!this.isValid)return this;const r=w$(t,iX),i=!Yr(r.weekYear)||!Yr(r.weekNumber)||!Yr(r.weekday),s=!Yr(r.ordinal),n=!Yr(r.year),o=!Yr(r.month)||!Yr(r.day),a=n||o,l=r.weekYear||r.weekNumber;if((a||s)&&l)throw new GS("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&s)throw new GS("Can't mix ordinal dates with month/day");let c;i?c=Jq({...j8(this.c),...r}):Yr(r.ordinal)?(c={...this.toObject(),...r},Yr(r.day)&&(c.day=Math.min(v$(c.year,c.month),c.day))):c=Kq({...z5(this.c),...r});const[u,d]=_M(c,this.o,this.zone);return F2(this,{ts:u,o:d})}plus(t){if(!this.isValid)return this;const r=ei.fromDurationLike(t);return F2(this,tX(this,r))}minus(t){if(!this.isValid)return this;const r=ei.fromDurationLike(t).negate();return F2(this,tX(this,r))}startOf(t){if(!this.isValid)return this;const r={},i=ei.normalizeUnit(t);switch(i){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(i==="weeks"&&(r.weekday=1),i==="quarters"){const s=Math.ceil(this.month/3);r.month=(s-1)*3+1}return this.set(r)}endOf(t){return this.isValid?this.plus({[t]:1}).startOf(t).minus(1):this}toFormat(t,r={}){return this.isValid?ya.create(this.loc.redefaultToEN(r)).formatDateTimeFromString(this,t):B5}toLocaleString(t=_$,r={}){return this.isValid?ya.create(this.loc.clone(r),t).formatDateTime(this):B5}toLocaleParts(t={}){return this.isValid?ya.create(this.loc.clone(t),t).formatDateTimeParts(this):[]}toISO({format:t="extended",suppressSeconds:r=!1,suppressMilliseconds:i=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=t==="extended";let a=G5(this,o);return a+="T",a+=rX(this,o,r,i,s,n),a}toISODate({format:t="extended"}={}){return this.isValid?G5(this,t==="extended"):null}toISOWeekDate(){return RO(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:t=!1,suppressSeconds:r=!1,includeOffset:i=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+rX(this,o==="extended",r,t,i,n):null}toRFC2822(){return RO(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return RO(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?G5(this,!0):null}toSQLTime({includeOffset:t=!0,includeZone:r=!1,includeOffsetSpace:i=!0}={}){let s="HH:mm:ss.SSS";return(r||t)&&(i&&(s+=" "),r?s+="z":t&&(s+="ZZ")),RO(this,s,!0)}toSQL(t={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(t)}`:null}toString(){return this.isValid?this.toISO():B5}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(t={}){if(!this.isValid)return{};const r={...this.c};return t.includeConfig&&(r.outputCalendar=this.outputCalendar,r.numberingSystem=this.loc.numberingSystem,r.locale=this.loc.locale),r}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(t,r="milliseconds",i={}){if(!this.isValid||!t.isValid)return ei.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...i},n=$2e(r).map(ei.normalizeUnit),o=t.valueOf()>this.valueOf(),a=o?this:t,l=o?t:this,c=zSe(a,l,n,s);return o?c.negate():c}diffNow(t="milliseconds",r={}){return this.diff(ur.now(),t,r)}until(t){return this.isValid?zs.fromDateTimes(this,t):this}hasSame(t,r){if(!this.isValid)return!1;const i=t.valueOf(),s=this.setZone(t.zone,{keepLocalTime:!0});return s.startOf(r)<=i&&i<=s.endOf(r)}equals(t){return this.isValid&&t.isValid&&this.valueOf()===t.valueOf()&&this.zone.equals(t.zone)&&this.loc.equals(t.loc)}toRelative(t={}){if(!this.isValid)return null;const r=t.base||ur.fromObject({},{zone:this.zone}),i=t.padding?this<r?-t.padding:t.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=t.unit;return Array.isArray(t.unit)&&(s=t.unit,n=void 0),nX(r,this.plus(i),{...t,numeric:"always",units:s,unit:n})}toRelativeCalendar(t={}){return this.isValid?nX(t.base||ur.fromObject({},{zone:this.zone}),this,{...t,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...t){if(!t.every(ur.isDateTime))throw new Tu("min requires all arguments be DateTimes");return jq(t,r=>r.valueOf(),Math.min)}static max(...t){if(!t.every(ur.isDateTime))throw new Tu("max requires all arguments be DateTimes");return jq(t,r=>r.valueOf(),Math.max)}static fromFormatExplain(t,r,i={}){const{locale:s=null,numberingSystem:n=null}=i,o=gs.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return jae(o,t,r)}static fromStringExplain(t,r,i={}){return ur.fromFormatExplain(t,r,i)}static get DATE_SHORT(){return _$}static get DATE_MED(){return sae}static get DATE_MED_WITH_WEEKDAY(){return d2e}static get DATE_FULL(){return nae}static get DATE_HUGE(){return oae}static get TIME_SIMPLE(){return aae}static get TIME_WITH_SECONDS(){return lae}static get TIME_WITH_SHORT_OFFSET(){return cae}static get TIME_WITH_LONG_OFFSET(){return uae}static get TIME_24_SIMPLE(){return hae}static get TIME_24_WITH_SECONDS(){return dae}static get TIME_24_WITH_SHORT_OFFSET(){return pae}static get TIME_24_WITH_LONG_OFFSET(){return fae}static get DATETIME_SHORT(){return mae}static get DATETIME_SHORT_WITH_SECONDS(){return gae}static get DATETIME_MED(){return yae}static get DATETIME_MED_WITH_SECONDS(){return _ae}static get DATETIME_MED_WITH_WEEKDAY(){return p2e}static get DATETIME_FULL(){return vae}static get DATETIME_FULL_WITH_SECONDS(){return bae}static get DATETIME_HUGE(){return wae}static get DATETIME_HUGE_WITH_SECONDS(){return xae}}function k2(e){if(ur.isDateTime(e))return e;if(e&&e.valueOf&&Nv(e.valueOf()))return ur.fromJSDate(e);if(e&&typeof e=="object")return ur.fromObject(e);throw new Tu(`Unknown datetime argument: ${e}, of type ${typeof e}`)}const lEe={year:void 0,month:void 0,day:void 0,weekday:void 0},cEe={hour:void 0,minute:void 0,second:void 0},uEe={timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone},m7={timeZone:"Etc/UTC"},Rd={year:"numeric",month:"numeric",day:"numeric"},z2={year:"numeric",month:"long",day:"numeric"},B2={year:"numeric",month:"short",day:"numeric"},V2={year:"numeric",month:"long",weekday:"long",day:"numeric"},tu={hour:"numeric",minute:"numeric"},dh={...tu,second:"numeric"},u2={"short-date":Rd,"short-date-short-time":{...Rd,...tu},"short-date-short-time-24":{...Rd,...tu,hour12:!1},"short-date-long-time":{...Rd,...dh},"short-date-long-time-24":{...Rd,...dh,hour12:!1},"short-date-le":Rd,"short-date-le-short-time":{...Rd,...tu},"short-date-le-short-time-24":{...Rd,...tu,hour12:!1},"short-date-le-long-time":{...Rd,...dh},"short-date-le-long-time-24":{...Rd,...dh,hour12:!1},"long-month-day-year":z2,"long-month-day-year-short-time":{...z2,...tu},"long-month-day-year-short-time-24":{...z2,...tu,hour12:!1},"long-month-day-year-long-time":{...z2,...dh},"long-month-day-year-long-time-24":{...z2,...dh,hour12:!1},"day-short-month-year":B2,"day-short-month-year-short-time":{...B2,...tu},"day-short-month-year-short-time-24":{...B2,...tu,hour12:!1},"day-short-month-year-long-time":{...B2,...dh},"day-short-month-year-long-time-24":{...B2,...dh,hour12:!1},"long-date":V2,"long-date-short-time":{...V2,...tu},"long-date-short-time-24":{...V2,...tu,hour12:!1},"long-date-long-time":{...V2,...dh},"long-date-long-time-24":{...V2,...dh,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":tu,"long-time":dh},hEe=jl()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),rle={ar:"ar-u-nu-latn-ca-gregory"};let H8=new WeakMap,ile=u2["short-date-short-time"];function dEe(e){const t=e||ile;let r=H8.get(t);if(!r){const i=ud(),s=rle[i]||i;r=new Intl.DateTimeFormat(s,t),H8.set(t,r)}return r}function HS(e){return u2[e]}function uy(e,t){return dEe(t).format(e)}function pEe(e,t=u2["short-date"]){return uy(new Date(e),{...t,...m7,...cEe})}function fEe(e,t=u2["short-time"]){return uy(new Date(`1970-01-01T${e}Z`),{...t,...m7,...lEe})}function mEe(e,t=u2["short-date-short-time"]){const r=ur.fromISO(e,{setZone:!0}),i=ud(),s=rle[i]??i;return r.toLocaleString({...uEe,...t},{locale:s})}a7(()=>{H8=new WeakMap,ile=u2["short-date-short-time"]});const gEe={ar:"ar-u-nu-latn"};let vM=new WeakMap,sle={};function yEe(e){const t=e||sle;if(!vM.has(t)){const r=ud(),i=gEe[ud()]||r;vM.set(t,new Intl.NumberFormat(i,e))}return vM.get(t)}function _Ee(e={}){const t={};return e.digitSeparator!=null&&(t.useGrouping=e.digitSeparator),e.places!=null&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t}function iT(e,t){return Object.is(e,-0)&&(e=0),yEe(t).format(e)}a7(()=>{vM=new WeakMap,sle={}});const nle=K.getLogger("esri.intl.substitute");function vEe(e,t,r={}){const{format:i={}}=r;return MD(e,s=>bEe(s,t,i))}function bEe(e,t,r){let i,s;const n=e.indexOf(":");if(n===-1?i=e.trim():(i=e.slice(0,n).trim(),s=e.slice(n+1).trim()),!i)return"";const o=um(i,t);if(o==null)return"";const a=(s?r?.[s]:null)??r?.[i];return a?wEe(o,a):s?xEe(o,s):g7(o)}function wEe(e,t){switch(t.type){case"date":return uy(e,t.intlOptions);case"number":return iT(e,t.intlOptions);default:return nle.warn("missing format descriptor for key {key}"),g7(e)}}function xEe(e,t){switch(t.toLowerCase()){case"dateformat":return uy(e);case"numberformat":return iT(e);default:return nle.warn(`inline format is unsupported since 4.12: ${t}`),/^(dateformat|datestring)/i.test(t)?uy(e):/^numberformat/i.test(t)?iT(e):g7(e)}}function g7(e){switch(typeof e){case"string":return e;case"number":return iT(e);case"boolean":return""+e;default:return e instanceof Date?uy(e):""}}const aX=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,TEe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function lX(e){return e in TEe}const WS=[],Rx=new Map;function cX(e){for(const t of Rx.keys())ale(e.pattern,t)&&Rx.delete(t)}function SEe(e){return WS.includes(e)||(cX(e),WS.unshift(e)),{remove(){const t=WS.indexOf(e);t>-1&&(WS.splice(t,1),cX(e))}}}async function ole(e){const t=ud();Rx.has(e)||Rx.set(e,CEe(e,t));const r=Rx.get(e);return r&&await AEe.add(r),r}function EEe(e){if(!aX.test(e))return null;const t=aX.exec(e);if(t===null)return null;const[,r,i]=t,s=r+(i?"-"+i.toUpperCase():"");return lX(s)?s:lX(r)?r:null}async function CEe(e,t){const r=[];for(const i of WS)if(ale(i.pattern,e))try{return await i.fetchMessageBundle(e,t)}catch(s){r.push(s)}throw r.length?new G("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:r}):new G("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}function ale(e,t){return typeof e=="string"?t.startsWith(e):e.test(t)}a7(()=>{Rx.clear()});const AEe=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=Ys())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function OEe(e,t,r,i){const s=t.exec(r);if(!s)throw new G("esri-intl:invalid-bundle",`Bundle id "${r}" is not compatible with the pattern "${t}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=EEe(i),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let u;try{u=await uX(e(c))}catch(d){if(c===l)throw new G("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:d});try{u=await uX(e(l))}catch(p){throw new G("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:p})}}return u}async function uX(e){if(hX.fetchBundleAsset!=null)return hX.fetchBundleAsset(e);const t=await ii(e,{responseType:"text"});return JSON.parse(t.data)}class REe{constructor({base:t="",pattern:r,location:i=new URL(window.location.href)}){let s;s=typeof i=="string"?n=>new URL(n,new URL(i,window.location.href)).href:i instanceof URL?n=>new URL(n,i).href:i,this.pattern=typeof r=="string"?new RegExp(`^${r}`):r,this.getAssetUrl=s,t=t?t.endsWith("/")?t:t+"/":"",this.matcher=new RegExp(`^${t}(?:(.*)/)?(.*)$`)}fetchMessageBundle(t,r){return OEe(this.getAssetUrl,this.matcher,t,r)}}function PEe(e){return new REe(e)}const hX={},MEe=K.getLogger("esri.assets");function IEe(e,t){return ii($r(e),t)}function $r(e){if(!Or.assetsPath)throw MEe.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new G("assets:path-not-set","config.assetsPath is not set");return sf(Or.assetsPath,e)}SEe(PEe({pattern:"esri/",location:$r}));function GD(e){return typeof e=="string"?document.getElementById(e):e??null}function lle(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}function dX(e,t){const r=t.parentNode;r&&r.insertBefore(e,t)}function pX(e,t){for(;;){const r=e.firstChild;if(!r)break;t.appendChild(r)}}var _0;(function(e){e[e.PENDING=0]="PENDING",e[e.RESOLVED=1]="RESOLVED",e[e.REJECTED=2]="REJECTED"})(_0||(_0={}));class $Ee{constructor(){this._resolver=Ys(),this._status=_0.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=_0.RESOLVED,this._cleanUp()},()=>{this._status=_0.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(t){this._resolvingPromises.push(t),this._tryResolve()}isResolved(){return this._status===_0.RESOLVED}isRejected(){return this._status===_0.REJECTED}isFulfilled(){return this._status!==_0.PENDING}abort(){this._resolver.reject(Cr())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const t=Ys(),r=[...this._resolvingPromises,t.promise],i=this._allPromise=Promise.all(r);i.then(()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve()},s=>{this.isFulfilled()||this._allPromise!==i||$s(s)||this._resolver.reject(s)}),t.resolve()}}const jD=e=>{let t=class extends e{constructor(...r){super(...r),this._promiseProps=new $Ee,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps?.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(r,i){return this._promiseProps.promise.then(()=>this).then(r,i)}catch(r){return this.when(null,r)}addResolvingPromise(r){r&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in r?r.when():r)}};return t=h([F("esri.core.Promise")],t),t};let x$=class extends jD(xe){};x$=h([F("esri.core.Promise")],x$);const LEe="randomUUID"in crypto;function y7(){if(LEe)return crypto.randomUUID();const e=crypto.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const t=r=>e[r].toString(16).padStart(4,"0");return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)}function $ht(){return`{${y7()}}`}const DEe=Object.prototype.toString;function NEe(e){const t="__accessorMetadata__"in e?ro(e):e;return function(...r){if(r.push(t),typeof r[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return FEe.apply(this,r)}}function FEe(e,t,r,i){UD(e,t).cast=i}function UEe(e){return(t,r)=>{UD(t,e).cast=t[r]}}function si(...e){if(e.length!==3||typeof e[1]!="string")return e.length===1&&DEe.call(e[0])==="[object Function]"?NEe(e[0]):e.length===1&&typeof e[0]=="string"?UEe(e[0]):void 0}/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var kEe=function(e){if(typeof e!="object"||e===null||Object.prototype.toString.call(e)!=="[object Object]")return!1;var t=Object.getPrototypeOf(e);if(t===null)return!0;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t},uv={exports:{}},ks={},nA={exports:{}},X1={};function cle(){var e={};return e["align-content"]=!1,e["align-items"]=!1,e["align-self"]=!1,e["alignment-adjust"]=!1,e["alignment-baseline"]=!1,e.all=!1,e["anchor-point"]=!1,e.animation=!1,e["animation-delay"]=!1,e["animation-direction"]=!1,e["animation-duration"]=!1,e["animation-fill-mode"]=!1,e["animation-iteration-count"]=!1,e["animation-name"]=!1,e["animation-play-state"]=!1,e["animation-timing-function"]=!1,e.azimuth=!1,e["backface-visibility"]=!1,e.background=!0,e["background-attachment"]=!0,e["background-clip"]=!0,e["background-color"]=!0,e["background-image"]=!0,e["background-origin"]=!0,e["background-position"]=!0,e["background-repeat"]=!0,e["background-size"]=!0,e["baseline-shift"]=!1,e.binding=!1,e.bleed=!1,e["bookmark-label"]=!1,e["bookmark-level"]=!1,e["bookmark-state"]=!1,e.border=!0,e["border-bottom"]=!0,e["border-bottom-color"]=!0,e["border-bottom-left-radius"]=!0,e["border-bottom-right-radius"]=!0,e["border-bottom-style"]=!0,e["border-bottom-width"]=!0,e["border-collapse"]=!0,e["border-color"]=!0,e["border-image"]=!0,e["border-image-outset"]=!0,e["border-image-repeat"]=!0,e["border-image-slice"]=!0,e["border-image-source"]=!0,e["border-image-width"]=!0,e["border-left"]=!0,e["border-left-color"]=!0,e["border-left-style"]=!0,e["border-left-width"]=!0,e["border-radius"]=!0,e["border-right"]=!0,e["border-right-color"]=!0,e["border-right-style"]=!0,e["border-right-width"]=!0,e["border-spacing"]=!0,e["border-style"]=!0,e["border-top"]=!0,e["border-top-color"]=!0,e["border-top-left-radius"]=!0,e["border-top-right-radius"]=!0,e["border-top-style"]=!0,e["border-top-width"]=!0,e["border-width"]=!0,e.bottom=!1,e["box-decoration-break"]=!0,e["box-shadow"]=!0,e["box-sizing"]=!0,e["box-snap"]=!0,e["box-suppress"]=!0,e["break-after"]=!0,e["break-before"]=!0,e["break-inside"]=!0,e["caption-side"]=!1,e.chains=!1,e.clear=!0,e.clip=!1,e["clip-path"]=!1,e["clip-rule"]=!1,e.color=!0,e["color-interpolation-filters"]=!0,e["column-count"]=!1,e["column-fill"]=!1,e["column-gap"]=!1,e["column-rule"]=!1,e["column-rule-color"]=!1,e["column-rule-style"]=!1,e["column-rule-width"]=!1,e["column-span"]=!1,e["column-width"]=!1,e.columns=!1,e.contain=!1,e.content=!1,e["counter-increment"]=!1,e["counter-reset"]=!1,e["counter-set"]=!1,e.crop=!1,e.cue=!1,e["cue-after"]=!1,e["cue-before"]=!1,e.cursor=!1,e.direction=!1,e.display=!0,e["display-inside"]=!0,e["display-list"]=!0,e["display-outside"]=!0,e["dominant-baseline"]=!1,e.elevation=!1,e["empty-cells"]=!1,e.filter=!1,e.flex=!1,e["flex-basis"]=!1,e["flex-direction"]=!1,e["flex-flow"]=!1,e["flex-grow"]=!1,e["flex-shrink"]=!1,e["flex-wrap"]=!1,e.float=!1,e["float-offset"]=!1,e["flood-color"]=!1,e["flood-opacity"]=!1,e["flow-from"]=!1,e["flow-into"]=!1,e.font=!0,e["font-family"]=!0,e["font-feature-settings"]=!0,e["font-kerning"]=!0,e["font-language-override"]=!0,e["font-size"]=!0,e["font-size-adjust"]=!0,e["font-stretch"]=!0,e["font-style"]=!0,e["font-synthesis"]=!0,e["font-variant"]=!0,e["font-variant-alternates"]=!0,e["font-variant-caps"]=!0,e["font-variant-east-asian"]=!0,e["font-variant-ligatures"]=!0,e["font-variant-numeric"]=!0,e["font-variant-position"]=!0,e["font-weight"]=!0,e.grid=!1,e["grid-area"]=!1,e["grid-auto-columns"]=!1,e["grid-auto-flow"]=!1,e["grid-auto-rows"]=!1,e["grid-column"]=!1,e["grid-column-end"]=!1,e["grid-column-start"]=!1,e["grid-row"]=!1,e["grid-row-end"]=!1,e["grid-row-start"]=!1,e["grid-template"]=!1,e["grid-template-areas"]=!1,e["grid-template-columns"]=!1,e["grid-template-rows"]=!1,e["hanging-punctuation"]=!1,e.height=!0,e.hyphens=!1,e.icon=!1,e["image-orientation"]=!1,e["image-resolution"]=!1,e["ime-mode"]=!1,e["initial-letters"]=!1,e["inline-box-align"]=!1,e["justify-content"]=!1,e["justify-items"]=!1,e["justify-self"]=!1,e.left=!1,e["letter-spacing"]=!0,e["lighting-color"]=!0,e["line-box-contain"]=!1,e["line-break"]=!1,e["line-grid"]=!1,e["line-height"]=!1,e["line-snap"]=!1,e["line-stacking"]=!1,e["line-stacking-ruby"]=!1,e["line-stacking-shift"]=!1,e["line-stacking-strategy"]=!1,e["list-style"]=!0,e["list-style-image"]=!0,e["list-style-position"]=!0,e["list-style-type"]=!0,e.margin=!0,e["margin-bottom"]=!0,e["margin-left"]=!0,e["margin-right"]=!0,e["margin-top"]=!0,e["marker-offset"]=!1,e["marker-side"]=!1,e.marks=!1,e.mask=!1,e["mask-box"]=!1,e["mask-box-outset"]=!1,e["mask-box-repeat"]=!1,e["mask-box-slice"]=!1,e["mask-box-source"]=!1,e["mask-box-width"]=!1,e["mask-clip"]=!1,e["mask-image"]=!1,e["mask-origin"]=!1,e["mask-position"]=!1,e["mask-repeat"]=!1,e["mask-size"]=!1,e["mask-source-type"]=!1,e["mask-type"]=!1,e["max-height"]=!0,e["max-lines"]=!1,e["max-width"]=!0,e["min-height"]=!0,e["min-width"]=!0,e["move-to"]=!1,e["nav-down"]=!1,e["nav-index"]=!1,e["nav-left"]=!1,e["nav-right"]=!1,e["nav-up"]=!1,e["object-fit"]=!1,e["object-position"]=!1,e.opacity=!1,e.order=!1,e.orphans=!1,e.outline=!1,e["outline-color"]=!1,e["outline-offset"]=!1,e["outline-style"]=!1,e["outline-width"]=!1,e.overflow=!1,e["overflow-wrap"]=!1,e["overflow-x"]=!1,e["overflow-y"]=!1,e.padding=!0,e["padding-bottom"]=!0,e["padding-left"]=!0,e["padding-right"]=!0,e["padding-top"]=!0,e.page=!1,e["page-break-after"]=!1,e["page-break-before"]=!1,e["page-break-inside"]=!1,e["page-policy"]=!1,e.pause=!1,e["pause-after"]=!1,e["pause-before"]=!1,e.perspective=!1,e["perspective-origin"]=!1,e.pitch=!1,e["pitch-range"]=!1,e["play-during"]=!1,e.position=!1,e["presentation-level"]=!1,e.quotes=!1,e["region-fragment"]=!1,e.resize=!1,e.rest=!1,e["rest-after"]=!1,e["rest-before"]=!1,e.richness=!1,e.right=!1,e.rotation=!1,e["rotation-point"]=!1,e["ruby-align"]=!1,e["ruby-merge"]=!1,e["ruby-position"]=!1,e["shape-image-threshold"]=!1,e["shape-outside"]=!1,e["shape-margin"]=!1,e.size=!1,e.speak=!1,e["speak-as"]=!1,e["speak-header"]=!1,e["speak-numeral"]=!1,e["speak-punctuation"]=!1,e["speech-rate"]=!1,e.stress=!1,e["string-set"]=!1,e["tab-size"]=!1,e["table-layout"]=!1,e["text-align"]=!0,e["text-align-last"]=!0,e["text-combine-upright"]=!0,e["text-decoration"]=!0,e["text-decoration-color"]=!0,e["text-decoration-line"]=!0,e["text-decoration-skip"]=!0,e["text-decoration-style"]=!0,e["text-emphasis"]=!0,e["text-emphasis-color"]=!0,e["text-emphasis-position"]=!0,e["text-emphasis-style"]=!0,e["text-height"]=!0,e["text-indent"]=!0,e["text-justify"]=!0,e["text-orientation"]=!0,e["text-overflow"]=!0,e["text-shadow"]=!0,e["text-space-collapse"]=!0,e["text-transform"]=!0,e["text-underline-position"]=!0,e["text-wrap"]=!0,e.top=!1,e.transform=!1,e["transform-origin"]=!1,e["transform-style"]=!1,e.transition=!1,e["transition-delay"]=!1,e["transition-duration"]=!1,e["transition-property"]=!1,e["transition-timing-function"]=!1,e["unicode-bidi"]=!1,e["vertical-align"]=!1,e.visibility=!1,e["voice-balance"]=!1,e["voice-duration"]=!1,e["voice-family"]=!1,e["voice-pitch"]=!1,e["voice-range"]=!1,e["voice-rate"]=!1,e["voice-stress"]=!1,e["voice-volume"]=!1,e.volume=!1,e["white-space"]=!1,e.widows=!1,e.width=!0,e["will-change"]=!1,e["word-break"]=!0,e["word-spacing"]=!0,e["word-wrap"]=!0,e["wrap-flow"]=!1,e["wrap-through"]=!1,e["writing-mode"]=!1,e["z-index"]=!1,e}function zEe(e,t,r){}function BEe(e,t,r){}var VEe=/javascript\s*\:/img;function GEe(e,t){return VEe.test(t)?"":t}X1.whiteList=cle();X1.getDefaultWhiteList=cle;X1.onAttr=zEe;X1.onIgnoreAttr=BEe;X1.safeAttrValue=GEe;var jEe={indexOf:function(e,t){var r,i;if(Array.prototype.indexOf)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1},forEach:function(e,t,r){var i,s;if(Array.prototype.forEach)return e.forEach(t,r);for(i=0,s=e.length;i<s;i++)t.call(r,e[i],i,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}},G2=jEe;function HEe(e,t){e=G2.trimRight(e),e[e.length-1]!==";"&&(e+=";");var r=e.length,i=!1,s=0,n=0,o="";function a(){if(!i){var u=G2.trim(e.slice(s,n)),d=u.indexOf(":");if(d!==-1){var p=G2.trim(u.slice(0,d)),g=G2.trim(u.slice(d+1));if(p){var y=t(s,o.length,p,g,u);y&&(o+=y+"; ")}}}s=n+1}for(;n<r;n++){var l=e[n];if(l==="/"&&e[n+1]==="*"){var c=e.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,i=!1}else l==="("?i=!0:l===")"?i=!1:l===";"?i||a():l===`
`&&a()}return G2.trim(o)}var WEe=HEe,PO=X1,qEe=WEe;function fX(e){return e==null}function XEe(e){var t={};for(var r in e)t[r]=e[r];return t}function ule(e){e=XEe(e||{}),e.whiteList=e.whiteList||PO.whiteList,e.onAttr=e.onAttr||PO.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||PO.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||PO.safeAttrValue,this.options=e}ule.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,r=t.options,i=r.whiteList,s=r.onAttr,n=r.onIgnoreAttr,o=r.safeAttrValue,a=qEe(e,function(l,c,u,d,p){var g=i[u],y=!1;if(g===!0?y=g:typeof g=="function"?y=g(d):g instanceof RegExp&&(y=g.test(d)),y!==!0&&(y=!1),d=o(u,d),!!d){var _={position:c,sourcePosition:l,source:p,isWhite:y};if(y){var v=s(u,d,_);return fX(v)?u+":"+d:v}else{var v=n(u,d,_);if(!fX(v))return v}}});return a};var ZEe=ule;(function(e,t){var r=X1,i=ZEe;function s(o,a){var l=new i(a);return l.process(o)}t=e.exports=s,t.FilterCSS=i;for(var n in r)t[n]=r[n]})(nA,nA.exports);var _7={indexOf:function(e,t){var r,i;if(Array.prototype.indexOf)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1},forEach:function(e,t,r){var i,s;if(Array.prototype.forEach)return e.forEach(t,r);for(i=0,s=e.length;i<s;i++)t.call(r,e[i],i,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/,r=t.exec(e);return r?r.index:-1}},YEe=nA.exports.FilterCSS,JEe=nA.exports.getDefaultWhiteList,T$=_7;function hle(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var dle=new YEe;function KEe(e,t,r){}function QEe(e,t,r){}function eCe(e,t,r){}function tCe(e,t,r){}function ple(e){return e.replace(iCe,"&lt;").replace(sCe,"&gt;")}function rCe(e,t,r,i){if(r=vle(r),t==="href"||t==="src"){if(r=T$.trim(r),r==="#")return"#";if(!(r.substr(0,7)==="http://"||r.substr(0,8)==="https://"||r.substr(0,7)==="mailto:"||r.substr(0,4)==="tel:"||r.substr(0,11)==="data:image/"||r.substr(0,6)==="ftp://"||r.substr(0,2)==="./"||r.substr(0,3)==="../"||r[0]==="#"||r[0]==="/"))return""}else if(t==="background"){if(MO.lastIndex=0,MO.test(r))return""}else if(t==="style"){if(mX.lastIndex=0,mX.test(r)||(gX.lastIndex=0,gX.test(r)&&(MO.lastIndex=0,MO.test(r))))return"";i!==!1&&(i=i||dle,r=i.process(r))}return r=ble(r),r}var iCe=/</g,sCe=/>/g,nCe=/"/g,oCe=/&quot;/g,aCe=/&#([a-zA-Z0-9]*);?/gim,lCe=/&colon;?/gim,cCe=/&newline;?/gim,MO=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,mX=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,gX=/u\s*r\s*l\s*\(.*/gi;function fle(e){return e.replace(nCe,"&quot;")}function mle(e){return e.replace(oCe,'"')}function gle(e){return e.replace(aCe,function(r,i){return i[0]==="x"||i[0]==="X"?String.fromCharCode(parseInt(i.substr(1),16)):String.fromCharCode(parseInt(i,10))})}function yle(e){return e.replace(lCe,":").replace(cCe," ")}function _le(e){for(var t="",r=0,i=e.length;r<i;r++)t+=e.charCodeAt(r)<32?" ":e.charAt(r);return T$.trim(t)}function vle(e){return e=mle(e),e=gle(e),e=yle(e),e=_le(e),e}function ble(e){return e=fle(e),e=ple(e),e}function uCe(){return""}function hCe(e,t){typeof t!="function"&&(t=function(){});var r=!Array.isArray(e);function i(o){return r?!0:T$.indexOf(e,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(i(o))if(l.isClosing){var c="[/removed]",u=l.position+c.length;return s.push([n!==!1?n:l.position,u]),n=!1,c}else return n||(n=l.position),"[removed]";else return t(o,a,l)},remove:function(o){var a="",l=0;return T$.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function dCe(e){for(var t="",r=0;r<e.length;){var i=e.indexOf("<!--",r);if(i===-1){t+=e.slice(r);break}t+=e.slice(r,i);var s=e.indexOf("-->",i);if(s===-1)break;r=s+3}return t}function pCe(e){var t=e.split("");return t=t.filter(function(r){var i=r.charCodeAt(0);return i===127?!1:i<=31?i===10||i===13:!0}),t.join("")}ks.whiteList=hle();ks.getDefaultWhiteList=hle;ks.onTag=KEe;ks.onIgnoreTag=QEe;ks.onTagAttr=eCe;ks.onIgnoreTagAttr=tCe;ks.safeAttrValue=rCe;ks.escapeHtml=ple;ks.escapeQuote=fle;ks.unescapeQuote=mle;ks.escapeHtmlEntities=gle;ks.escapeDangerHtml5Entities=yle;ks.clearNonPrintableCharacter=_le;ks.friendlyAttrValue=vle;ks.escapeAttrValue=ble;ks.onIgnoreTagStripAll=uCe;ks.StripTagBody=hCe;ks.stripCommentTag=dCe;ks.stripBlankChar=pCe;ks.cssFilter=dle;ks.getDefaultCSSWhiteList=JEe;var HD={},v0=_7;function fCe(e){var t=v0.spaceIndex(e),r;return t===-1?r=e.slice(1,-1):r=e.slice(1,t+1),r=v0.trim(r).toLowerCase(),r.slice(0,1)==="/"&&(r=r.slice(1)),r.slice(-1)==="/"&&(r=r.slice(0,-1)),r}function mCe(e){return e.slice(0,2)==="</"}function gCe(e,t,r){var i="",s=0,n=!1,o=!1,a=0,l=e.length,c="",u="";e:for(a=0;a<l;a++){var d=e.charAt(a);if(n===!1){if(d==="<"){n=a;continue}}else if(o===!1){if(d==="<"){i+=r(e.slice(s,a)),n=a,s=a;continue}if(d===">"){i+=r(e.slice(s,n)),u=e.slice(n,a+1),c=fCe(u),i+=t(n,i.length,c,u,mCe(u)),s=a+1,n=!1;continue}if(d==='"'||d==="'")for(var p=1,g=e.charAt(a-p);g.trim()===""||g==="=";){if(g==="="){o=d;continue e}g=e.charAt(a-++p)}}else if(d===o){o=!1;continue}}return s<e.length&&(i+=r(e.substr(s))),i}var yCe=/[^a-zA-Z0-9\\_:.-]/gim;function _Ce(e,t){var r=0,i=0,s=[],n=!1,o=e.length;function a(p,g){if(p=v0.trim(p),p=p.replace(yCe,"").toLowerCase(),!(p.length<1)){var y=t(p,g||"");y&&s.push(y)}}for(var l=0;l<o;l++){var c=e.charAt(l),u,d;if(n===!1&&c==="="){n=e.slice(r,l),r=l+1,i=e.charAt(r)==='"'||e.charAt(r)==="'"?r:bCe(e,l+1);continue}if(n!==!1&&l===i){if(d=e.indexOf(c,l+1),d===-1)break;u=v0.trim(e.slice(i+1,d)),a(n,u),n=!1,l=d,r=l+1;continue}if(/\s|\n|\t/.test(c))if(e=e.replace(/\s|\n|\t/g," "),n===!1)if(d=vCe(e,l),d===-1){u=v0.trim(e.slice(r,l)),a(u),n=!1,r=l+1;continue}else{l=d-1;continue}else if(d=wCe(e,l-1),d===-1){u=v0.trim(e.slice(r,l)),u=yX(u),a(n,u),n=!1,r=l+1;continue}else continue}return r<e.length&&(n===!1?a(e.slice(r)):a(n,yX(v0.trim(e.slice(r))))),v0.trim(s.join(" "))}function vCe(e,t){for(;t<e.length;t++){var r=e[t];if(r!==" ")return r==="="?t:-1}}function bCe(e,t){for(;t<e.length;t++){var r=e[t];if(r!==" ")return r==="'"||r==='"'?t:-1}}function wCe(e,t){for(;t>0;t--){var r=e[t];if(r!==" ")return r==="="?t:-1}}function xCe(e){return e[0]==='"'&&e[e.length-1]==='"'||e[0]==="'"&&e[e.length-1]==="'"}function yX(e){return xCe(e)?e.substr(1,e.length-2):e}HD.parseTag=gCe;HD.parseAttr=_Ce;var TCe=nA.exports.FilterCSS,Vh=ks,wle=HD,SCe=wle.parseTag,ECe=wle.parseAttr,bM=_7;function IO(e){return e==null}function CCe(e){var t=bM.spaceIndex(e);if(t===-1)return{html:"",closing:e[e.length-2]==="/"};e=bM.trim(e.slice(t+1,-1));var r=e[e.length-1]==="/";return r&&(e=bM.trim(e.slice(0,-1))),{html:e,closing:r}}function ACe(e){var t={};for(var r in e)t[r]=e[r];return t}function OCe(e){var t={};for(var r in e)Array.isArray(e[r])?t[r.toLowerCase()]=e[r].map(function(i){return i.toLowerCase()}):t[r.toLowerCase()]=e[r];return t}function xle(e){e=ACe(e||{}),e.stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=Vh.onIgnoreTagStripAll),e.whiteList||e.allowList?e.whiteList=OCe(e.whiteList||e.allowList):e.whiteList=Vh.whiteList,e.onTag=e.onTag||Vh.onTag,e.onTagAttr=e.onTagAttr||Vh.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||Vh.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||Vh.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||Vh.safeAttrValue,e.escapeHtml=e.escapeHtml||Vh.escapeHtml,this.options=e,e.css===!1?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new TCe(e.css))}xle.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,r=t.options,i=r.whiteList,s=r.onTag,n=r.onIgnoreTag,o=r.onTagAttr,a=r.onIgnoreTagAttr,l=r.safeAttrValue,c=r.escapeHtml,u=t.cssFilter;r.stripBlankChar&&(e=Vh.stripBlankChar(e)),r.allowCommentTag||(e=Vh.stripCommentTag(e));var d=!1;r.stripIgnoreTagBody&&(d=Vh.StripTagBody(r.stripIgnoreTagBody,n),n=d.onIgnoreTag);var p=SCe(e,function(g,y,_,v,w){var T={sourcePosition:g,position:y,isClosing:w,isWhite:Object.prototype.hasOwnProperty.call(i,_)},x=s(_,v,T);if(!IO(x))return x;if(T.isWhite){if(T.isClosing)return"</"+_+">";var S=CCe(v),O=i[_],A=ECe(S.html,function($,P){var U=bM.indexOf(O,$)!==-1,I=o(_,$,P,U);return IO(I)?U?(P=l(_,$,P,u),P?$+'="'+P+'"':$):(I=a(_,$,P,U),IO(I)?void 0:I):I});return v="<"+_,A&&(v+=" "+A),S.closing&&(v+=" /"),v+=">",v}else return x=n(_,v,T),IO(x)?c(v):x},c);return d&&(p=d.remove(p)),p};var RCe=xle;(function(e,t){var r=ks,i=HD,s=RCe;function n(a,l){var c=new s(l);return c.process(a)}t=e.exports=n,t.filterXSS=n,t.FilterXSS=s,function(){for(var a in r)t[a]=r[a];for(var l in i)t[l]=i[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=e.exports)})(uv,uv.exports);var PCe=function(){function e(t,r){var i=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?i.sanitizeUrl(a):uv.exports.safeAttrValue(n,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var s;t&&!r?s=t:t&&r?(s=Object.create(this.arcgisFilterOptions),Object.keys(t).forEach(function(n){n==="whiteList"?s.whiteList=i._extendObjectOfArrays([i.arcgisWhiteList,t.whiteList||{}]):s[n]=t[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList),this.xssFilterOptions=s,this._xssFilter=new uv.exports.FilterXSS(s)}return e.prototype.sanitize=function(t,r){switch(r===void 0&&(r={}),typeof t){case"number":return isNaN(t)||!isFinite(t)?null:t;case"boolean":return t;case"string":return this._xssFilter.process(t);case"object":return this._iterateOverObject(t,r);default:return r.allowUndefined&&typeof t>"u"?void 0:null}},e.prototype.sanitizeUrl=function(t,r){var i=(r??{}).isProtocolRequired,s=i===void 0?!0:i,n=this._trim(t.substring(0,t.indexOf(":"))),o=t==="/",a=/^#/.test(t),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?uv.exports.escapeAttrValue(t):!n&&!s?uv.exports.escapeAttrValue("https://".concat(t)):""},e.prototype.sanitizeHTMLAttribute=function(t,r,i,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(t,r,i,s):uv.exports.safeAttrValue(t,r,i,s)},e.prototype.validate=function(t,r){r===void 0&&(r={});var i=this.sanitize(t,r);return{isValid:t===i,sanitized:i}},e.prototype.encodeHTML=function(t){var r=this;return String(t).replace(/[&<>"'\/]/g,function(i){return r._entityMap[i]})},e.prototype.encodeAttrValue=function(t){var r=/^[a-zA-Z0-9]$/;return String(t).replace(/[\x00-\xFF]/g,function(i,s){return r.test(i)?i:"&#x".concat(Number(t.charCodeAt(s)).toString(16),";")})},e.prototype._extendObjectOfArrays=function(t){var r={};return t.forEach(function(i){Object.keys(i).forEach(function(s){Array.isArray(i[s])&&Array.isArray(r[s])?r[s]=r[s].concat(i[s]):r[s]=i[s]})}),r},e.prototype._iterateOverObject=function(t,r){var i=this;r===void 0&&(r={});try{var s=!1,n=void 0;if(Array.isArray(t))n=t.reduce(function(a,l){var c=i.validate(l,r);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(kEe(t)){var o=Object.keys(t);n=o.reduce(function(a,l){var c=t[l],u=i.validate(c,r);return u.isValid?a[l]=c:(s=!0,a[l]=u.sanitized),a},{})}else return r.allowUndefined&&typeof t>"u"?void 0:null;return s?n:t}catch{return null}},e.prototype._trim=function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},e}();const WD=new Map;function Tle(){WD.clear()}function MCe(e){return WD.get(e)}function ICe(e,t){WD.set(e,t)}function j5(e){WD.delete(e)}var a1,sT,$Ce=function(e){if("WebkitTransition"in e.style)a1="webkitTransitionEnd",sT="webkitAnimationEnd";else{if(!("transition"in e.style))throw new Error("Your browser is not supported!");a1="transitionend",sT="animationend"}},Sle=function(e){a1||$Ce(e)},LCe=function(e,t){return t===void 0&&(t=e+"-active"),function(r){Sle(r);var i=!1,s=function(n){i||(i=!0,r.removeEventListener(a1,s),r.removeEventListener(sT,s),r.classList.remove(e),r.classList.remove(t))};r.classList.add(e),r.addEventListener(a1,s),r.addEventListener(sT,s),requestAnimationFrame(function(){r.classList.add(t)})}},DCe=function(e,t){return t===void 0&&(t=e+"-active"),function(r,i){Sle(r);var s=!1,n=function(o){s||(s=!0,r.removeEventListener(a1,n),r.removeEventListener(sT,n),i())};r.classList.add(e),r.addEventListener(a1,n),r.addEventListener(sT,n),requestAnimationFrame(function(){r.classList.add(t)})}};const NCe=K.getLogger("esri.widgets.support.widgetUtils");function FCe(e){const t=Ol.acquire();for(let i=0;i<arguments.length;i++){const s=arguments[i],n=typeof s;if(n==="string")t.push(s);else if(Array.isArray(s))t.push.apply(t,s);else if(n==="object")for(const o in s)s[o]&&t.push(o)}const r=t.join(" ");return Ol.release(t),r}(()=>{const e=new Map,t=new ResizeObserver(i=>{Tle();for(const s of i)e.get(s.target)?.(s)}),r=(i,s,n)=>(e.has(i)&&NCe.error("Already observing element",i),e.set(i,s),t.observe(i,n),Xo(()=>{t.unobserve(i),e.delete(i)}));return(i,s,n)=>{let o=null;return le(()=>typeof i=="function"?i():i,a=>{o?.remove(),a&&(o=r(a,s,n))},_s)}})();function UCe(e){const t=e?.closest("[dir]");return t!==null&&t instanceof HTMLElement&&t.dir==="rtl"||document.dir==="rtl"}function Lht(e){const t="data-node-ref";this[e.getAttribute(t)]=null}function _X(e){const t="data-node-ref";this[e.getAttribute(t)]=e}function Dht(e,t){return(e==="enter"?LCe:DCe)(t)}const kCe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],zCe=kCe.reduce((e,t)=>(e[t]=[],e),{}),BCe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],Ele=new PCe({whiteList:zCe,onTagAttr:(e,t,r)=>{const i=`${t}="${r}"`;if(BCe.includes(t))return i},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function VCe(e){return e==="Enter"||e===" "}const Cle="http://www.w3.org/",qD=`${Cle}2000/svg`,Ale=`${Cle}1999/xlink`;let vX=[],v7=(e,t)=>{let r={};return Object.keys(e).forEach(i=>{r[i]=e[i]}),t&&Object.keys(t).forEach(i=>{r[i]=t[i]}),r},b7=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),Ole=e=>{if(typeof e!="string")throw new Error("Style values must be strings")},GCe=(e,t,r)=>{if(t.vnodeSelector!==""){for(let i=r;i<e.length;i++)if(b7(e[i],t))return i}return-1},H5=(e,t,r,i)=>{let s=e[t];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<e.length;o++)if(o!==t){let a=e[o];if(b7(a,s))throw new Error(`${r.vnodeSelector} had a ${s.vnodeSelector} child ${i==="added"?i:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},jCe=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},W8=[],q8=!1,Rle=e=>{(e.children||[]).forEach(Rle),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},bX=()=>{q8=!1,W8.forEach(Rle),W8.length=0},wX=e=>{W8.push(e),q8||(q8=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(bX,{timeout:16}):setTimeout(bX,16))},xX=e=>{let t=e.domNode;if(e.properties){let r=e.properties.exitAnimation;if(r)return t.style.pointerEvents="none",void r(t,()=>{t.parentNode&&(t.parentNode.removeChild(t),wX(e))},e.properties)}t.parentNode&&(t.parentNode.removeChild(t),wX(e))},HCe=(e,t,r)=>{if(!t)return;let i=r.eventHandlerInterceptor,s=Object.keys(t),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=t[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")X8(e,l,!0);else if(a==="classes"){let c=Object.keys(l),u=c.length;for(let d=0;d<u;d++){let p=c[d];l[p]&&e.classList.add(p)}}else if(a==="styles"){let c=Object.keys(l),u=c.length;for(let d=0;d<u;d++){let p=c[d],g=l[p];g&&(Ole(g),r.styleApplyer(e,p,g))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(i&&(l=i(a,l,e,t)),a==="oninput"&&function(){let u=l;l=function(d){u.apply(this,[d]),d.target["oninput-value"]=d.target.value}}()),e[a]=l):r.namespace===qD?a==="href"?e.setAttributeNS(Ale,a,l):e.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?e[a]=Ele.sanitize(l):Ple(e)&&a in e?e[a]=l:e.setAttribute(a,l):e[a]=l}}};function Ple(e){if(!(e instanceof Element&&e.tagName.includes("-")))return!1;const t=window.customElements.get(e.tagName.toLowerCase());return!!t&&e instanceof t}let S$,WCe=(e,t,r)=>{if(t)for(let i of t)rx(i,e,void 0,r)},Mle=(e,t,r)=>{WCe(e,t.children,r),t.text&&(e.textContent=t.text),HCe(e,t.properties,r),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,r,t.vnodeSelector,t.properties,t.children])},rx=(e,t,r,i)=>{let s,n=0,o=e.vnodeSelector,a=t.ownerDocument;if(o==="")s=e.domNode=a.createTextNode(e.text),r!==void 0?t.insertBefore(s,r):t.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let u=o.charAt(n-1),d=o.slice(n,l);u==="."?s.classList.add(d):u==="#"?s.id=d:(d==="svg"&&(i=v7(i,{namespace:qD})),i.namespace!==void 0?s=e.domNode=a.createElementNS(i.namespace,d):(s=e.domNode=e.domNode||a.createElement(d),d==="input"&&e.properties&&e.properties.type!==void 0&&s.setAttribute("type",e.properties.type)),r!==void 0?t.insertBefore(s,r):s.parentNode!==t&&t.appendChild(s)),n=l+1}}Mle(s,e,i)}},X8=(e,t,r)=>{t&&t.split(" ").forEach(i=>{i&&e.classList.toggle(i,r)})},qCe=(e,t,r,i)=>{if(!r)return;let s=!1,n=Object.keys(r),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=r[l],u=t[l];if(l==="class")u!==c&&(X8(e,u,!1),X8(e,c,!0));else if(l==="classes"){let d=e.classList,p=Object.keys(c),g=p.length;for(let y=0;y<g;y++){let _=p[y],v=!!c[_];v!==!!u[_]&&(s=!0,v?d.add(_):d.remove(_))}}else if(l==="styles"){let d=Object.keys(c),p=d.length;for(let g=0;g<p;g++){let y=d[g],_=c[y];_!==u[y]&&(s=!0,_?(Ole(_),i.styleApplyer(e,y,_)):i.styleApplyer(e,y,""))}}else if(c||typeof u!="string"||(c=""),l==="value"){let d=e[l];d!==c&&(e["oninput-value"]?d===e["oninput-value"]:c!==u)&&(e[l]=c,e["oninput-value"]=void 0),c!==u&&(s=!0)}else if(c!==u){let d=typeof c;d==="function"&&i.eventHandlerInterceptor||(i.namespace===qD?l==="href"?e.setAttributeNS(Ale,l,c):e.setAttribute(l,c):d==="string"?l==="innerHTML"?e[l]=Ele.sanitize(c):l==="role"&&c===""?e.removeAttribute(l):Ple(e)&&l in e?e[l]=c:e.setAttribute(l,c):e[l]!==c&&(e[l]=c),s=!0)}}return s},XCe=(e,t,r,i,s)=>{if(r===i)return!1;i=i||vX;let n,o=(r=r||vX).length,a=i.length,l=0,c=0,u=!1;for(;c<a;){let d=l<o?r[l]:void 0,p=i[c];if(d!==void 0&&b7(d,p))u=S$(d,p,s)||u,l++;else{let g=GCe(r,p,l+1);if(g>=0){for(n=l;n<g;n++)xX(r[n]),H5(r,n,e,"removed");u=S$(r[g],p,s)||u,l=g+1}else rx(p,t,l<o?r[l].domNode:void 0,s),jCe(p),H5(i,c,e,"added")}c++}if(o>l)for(n=l;n<o;n++)xX(r[n]),H5(r,n,e,"removed");return u};S$=(e,t,r)=>{let i=e.domNode,s=!1;if(e===t)return!1;let n=!1;if(t.vnodeSelector===""){if(t.text!==e.text){let o=i.ownerDocument.createTextNode(t.text);return i.parentNode.replaceChild(o,i),t.domNode=o,s=!0,s}t.domNode=i}else t.vnodeSelector.lastIndexOf("svg",0)===0&&(r=v7(r,{namespace:qD})),e.text!==t.text&&(n=!0,t.text===void 0?i.removeChild(i.firstChild):i.textContent=t.text),t.domNode=i,n=XCe(t,i,e.children,t.children,r)||n,n=qCe(i,e.properties,t.properties,r)||n,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[i,r,t.vnodeSelector,t.properties,t.children]);return n&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(i,t.properties,e.properties),s};let j2=(e,t)=>({getLastRender:()=>e,update:r=>{if(e.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let i=e;e=r,S$(i,r,t)},domNode:e.domNode});const ZCe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,r)=>{t.charAt(0)==="-"?e.style.setProperty(t,r):e.style[t]=r}};let bw=e=>v7(ZCe,e),U0={create:(e,t)=>(t=bw(t),rx(e,document.createElement("div"),void 0,t),j2(e,t)),append:(e,t,r)=>(r=bw(r),rx(t,e,void 0,r),j2(t,r)),insertBefore:(e,t,r)=>(r=bw(r),rx(t,e.parentNode,e,r),j2(t,r)),merge:(e,t,r)=>(r=bw(r),t.domNode=e,Mle(e,t,r),j2(t,r)),replace:(e,t,r)=>(r=bw(r),rx(t,e.parentNode,e,r),e.parentNode.removeChild(e),j2(t,r))},Ile,YCe=(e,t)=>{let r=[];for(;e&&e!==t;)r.push(e),e=e.parentNode;return r};Ile=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];let JCe=(e,t)=>{let r=e;return t.forEach(i=>{r=r&&r.children?Ile(r.children,s=>s.domNode===i):void 0}),r},KCe=(e,t,r)=>{let i=function(s){r("domEvent",s);let n=t(),o=YCe(s.currentTarget,n.domNode);o.reverse();let a,l=JCe(n.getLastRender(),o);return e.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),r("domEventProcessed",s),a};return(s,n,o,a)=>i},TX=e=>{let t,r,i=bw(e),s=i.performanceLogger,n=!0,o=!1,a=[],l=[],c=(d,p,g)=>{let y,_=()=>y;i.eventHandlerInterceptor=KCe(t,_,s),y=d(p,g(),i),a.push(y),l.push(g)},u=()=>{if(r=void 0,n){n=!1,s("renderStart",void 0);for(let d=0;d<a.length;d++){let p=l[d]();s("rendered",void 0),a[d].update(p),s("patched",void 0)}s("renderDone",void 0),n=!0}};return t={renderNow:u,scheduleRender:()=>{r||o||(r=requestAnimationFrame(u))},stop:()=>{r&&(cancelAnimationFrame(r),r=void 0),o=!0},resume:()=>{o=!1,n=!0,t.scheduleRender()},append:(d,p)=>{c(U0.append,d,p)},insertBefore:(d,p)=>{c(U0.insertBefore,d,p)},merge:(d,p)=>{c(U0.merge,d,p)},replace:(d,p)=>{c(U0.replace,d,p)},detach:d=>{for(let p=0;p<l.length;p++)if(l[p]===d)return l.splice(p,1),a.splice(p,1)[0];throw new Error("renderFunction was not found")}},t};const QCe={handleInterceptedEvent:(e,t,r,i)=>(e.scheduleRender(),t.properties[`on${i.type}`].apply(t.properties.bind||r,[i]))},eAe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,r)=>{e.style[t]=r}},tAe=e=>({...eAe,...e}),rAe=(e,t)=>{const r=[];for(;e&&e!==t;)r.push(e),e=e.parentNode;return r},iAe=(e,t)=>e.find(t),SX=(e,t,r=!1)=>{let i=e;return t.forEach((s,n)=>{const o=i?.children?iAe(i.children,a=>a.domNode===s):void 0;r&&!o&&n!==t.length-1||(i=o)}),i},sAe=e=>{let t;const r={...QCe,...e},i=tAe(r),s=i.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],u=(p,g,y)=>{let _;i.eventHandlerInterceptor=(w,T,x,S)=>function(O){let A;s("domEvent",O);const $=rAe(O.currentTarget,_.domNode),P=$.some(I=>customElements.get(I?.tagName?.toLowerCase()));if(O.eventPhase===Event.CAPTURING_PHASE||!P)$.reverse(),A=SX(_.getLastRender(),$);else{const I=O.composedPath(),L=I.slice(I.indexOf(O.currentTarget),I.indexOf(_.domNode)).filter(N=>N.getRootNode()===N.ownerDocument).reverse();A=SX(_.getLastRender(),L,!0)}let U;return A&&(U=r.handleInterceptedEvent(t,A,this,O)),s("domEventProcessed",O),U},r.postProcessProjectionOptions?.(i);const v=y();_=p(g,v,i),l.push(_),c.push(y),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(_,v)};let d=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let p=0;p<l.length;p++){const g=c[p]();s("rendered",void 0),l[p].update(g),s("patched",void 0)}s("renderDone",void 0),o=!0}};return r.modifyDoRenderImplementation&&(d=r.modifyDoRenderImplementation(d,l,c)),t={renderNow:d,scheduleRender:()=>{n||a||(n=requestAnimationFrame(d))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,t.scheduleRender()},append:(p,g)=>{u(U0.append,p,g)},insertBefore:(p,g)=>{u(U0.insertBefore,p,g)},merge:(p,g)=>{u(U0.merge,p,g)},replace:(p,g)=>{u(U0.replace,p,g)},detach:p=>{for(let g=0;g<c.length;g++)if(c[g]===p)return c.splice(g,1),l.splice(g,1)[0];throw new Error("renderFunction was not found")}},t},Nr={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let ww,$le,XD,Lle=!1,E$=!1,w7=!1,uc=!1,EX=null,Z8=!1;Nr.isDev,Nr.isTesting;const nAe=e=>{const t=new URL(e,Co.$resourcesUrl$);return t.origin!==h2.location.origin?t.href:t.pathname},oAe=e=>Co.$resourcesUrl$=e,l1=(e,t="")=>()=>{},CX="http://www.w3.org/1999/xlink",AX={},aAe="http://www.w3.org/2000/svg",lAe="http://www.w3.org/1999/xhtml",cAe=e=>e!=null,x7=e=>(e=typeof e,e==="object"||e==="function");function uAe(e){var t,r,i;return(i=(r=(t=e.head)===null||t===void 0?void 0:t.querySelector('meta[name="csp-nonce"]'))===null||r===void 0?void 0:r.getAttribute("content"))!==null&&i!==void 0?i:void 0}const pu=(e,t,...r)=>{let i=null,s=null,n=null,o=!1,a=!1;const l=[],c=d=>{for(let p=0;p<d.length;p++)i=d[p],Array.isArray(i)?c(i):i!=null&&typeof i!="boolean"&&((o=typeof e!="function"&&!x7(i))&&(i=String(i)),o&&a?l[l.length-1].$text$+=i:l.push(o?C$(null,i):i),a=o)};if(c(r),t&&(Nr.isDev&&e==="input"&&pAe(t),Nr.vdomKey&&t.key&&(s=t.key),Nr.slotRelocation&&t.name&&(n=t.name),Nr.vdomClass)){const d=t.className||t.class;d&&(t.class=typeof d!="object"?d:Object.keys(d).filter(p=>d[p]).join(" "))}if(Nr.isDev&&l.some(Nle)&&VAe(`The <Host> must be the single root component. Make sure:
- You are NOT using hostData() and <Host> in the same component.
- <Host> is used once, and it's the single root component of the render() function.`),Nr.vdomFunctional&&typeof e=="function")return e(t===null?{}:t,l,hAe);const u=C$(e,null);return u.$attrs$=t,l.length>0&&(u.$children$=l),Nr.vdomKey&&(u.$key$=s),Nr.slotRelocation&&(u.$name$=n),u},C$=(e,t)=>{const r={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null};return Nr.vdomAttribute&&(r.$attrs$=null),Nr.vdomKey&&(r.$key$=null),Nr.slotRelocation&&(r.$name$=null),r},Dle={},Nle=e=>e&&e.$tag$===Dle,hAe={forEach:(e,t)=>e.map(OX).forEach(t),map:(e,t)=>e.map(OX).map(t).map(dAe)},OX=e=>({vattrs:e.$attrs$,vchildren:e.$children$,vkey:e.$key$,vname:e.$name$,vtag:e.$tag$,vtext:e.$text$}),dAe=e=>{if(typeof e.vtag=="function"){const r=Object.assign({},e.vattrs);return e.vkey&&(r.key=e.vkey),e.vname&&(r.name=e.vname),pu(e.vtag,r,...e.vchildren||[])}const t=C$(e.vtag,e.vtext);return t.$attrs$=e.vattrs,t.$children$=e.vchildren,t.$key$=e.vkey,t.$name$=e.vname,t},pAe=e=>{const t=Object.keys(e),r=t.indexOf("value");if(r===-1)return;const i=t.indexOf("type"),s=t.indexOf("min"),n=t.indexOf("max"),o=t.indexOf("step");(r<i||r<s||r<n||r<o)&&GAe('The "value" prop of <input> should be set after "min", "max", "type" and "step"')},fAe=e=>jAe.map(t=>t(e)).find(t=>!!t),mAe=(e,t)=>e!=null&&!x7(e)?t&4?e==="false"?!1:e===""||!!e:t&2?parseFloat(e):t&1?String(e):e:e,gAe=e=>e,Nht=(e,t,r)=>{const i=gAe(e);return{emit:s=>yAe(i,t,{bubbles:!!(r&4),composed:!!(r&2),cancelable:!!(r&1),detail:s})}},yAe=(e,t,r)=>{const i=Co.ce(t,r);return e.dispatchEvent(i),i},RX=new WeakMap,_Ae=(e,t,r)=>{let i=O$.get(e);XAe&&r?(i=i||new CSSStyleSheet,typeof i=="string"?i=t:i.replaceSync(t)):i=t,O$.set(e,i)},vAe=(e,t,r,i)=>{var s;let n=Fle(t,r);const o=O$.get(n);if(e=e.nodeType===11?e:ku,o)if(typeof o=="string"){e=e.head||e;let a=RX.get(e),l;if(a||RX.set(e,a=new Set),!a.has(n)){{l=ku.createElement("style"),l.innerHTML=o;const c=(s=Co.$nonce$)!==null&&s!==void 0?s:uAe(ku);c!=null&&l.setAttribute("nonce",c),e.insertBefore(l,e.querySelector("link"))}a&&a.add(n)}}else e.adoptedStyleSheets.includes(o)||(e.adoptedStyleSheets=[...e.adoptedStyleSheets,o]);return n},bAe=e=>{const t=e.$cmpMeta$,r=e.$hostElement$,i=t.$flags$,s=l1("attachStyles",t.$tagName$),n=vAe(R$&&r.shadowRoot?r.shadowRoot:r.getRootNode(),t,e.$modeName$);i&10&&(r["s-sc"]=n,r.classList.add(n+"-h"),i&2&&r.classList.add(n+"-s")),s()},Fle=(e,t)=>"sc-"+(t&&e.$flags$&32?e.$tagName$+"-"+t:e.$tagName$),PX=(e,t,r,i,s,n)=>{if(r!==i){let o=LX(e,t),a=t.toLowerCase();if(t==="class"){const l=e.classList,c=MX(r),u=MX(i);l.remove(...c.filter(d=>d&&!u.includes(d))),l.add(...u.filter(d=>d&&!c.includes(d)))}else if(t==="style"){for(const l in r)(!i||i[l]==null)&&(l.includes("-")?e.style.removeProperty(l):e.style[l]="");for(const l in i)(!r||i[l]!==r[l])&&(l.includes("-")?e.style.setProperty(l,i[l]):e.style[l]=i[l])}else if(t!=="key")if(t==="ref")i&&i(e);else if(!e.__lookupSetter__(t)&&t[0]==="o"&&t[1]==="n")t[2]==="-"?t=t.slice(3):LX(h2,a)?t=a.slice(2):t=a[2]+t.slice(3),r&&Co.rel(e,t,r,!1),i&&Co.ael(e,t,i,!1);else{const l=x7(i);if((o||l&&i!==null)&&!s)try{if(e.tagName.includes("-"))e[t]=i;else{const u=i??"";t==="list"?o=!1:(r==null||e[t]!=u)&&(e[t]=u)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(t=a,c=!0),i==null||i===!1?(i!==!1||e.getAttribute(t)==="")&&(c?e.removeAttributeNS(CX,t):e.removeAttribute(t)):(!o||n&4||s)&&!l&&(i=i===!0?"":i,c?e.setAttributeNS(CX,t,i):e.setAttribute(t,i))}}},wAe=/\s/,MX=e=>e?e.split(wAe):[],Ule=(e,t,r,i)=>{const s=t.$elm$.nodeType===11&&t.$elm$.host?t.$elm$.host:t.$elm$,n=e&&e.$attrs$||AX,o=t.$attrs$||AX;for(i in n)i in o||PX(s,i,n[i],void 0,r,t.$flags$);for(i in o)PX(s,i,n[i],o[i],r,t.$flags$)},A$=(e,t,r,i)=>{const s=t.$children$[r];let n=0,o,a,l;if(Lle||(w7=!0,s.$tag$==="slot"&&(ww&&i.classList.add(ww+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=ku.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=ku.createTextNode("");else{if(uc||(uc=s.$tag$==="svg"),o=s.$elm$=ku.createElementNS(uc?aAe:lAe,s.$flags$&2?"slot-fb":s.$tag$),uc&&s.$tag$==="foreignObject"&&(uc=!1),Ule(null,s,uc),cAe(ww)&&o["s-si"]!==ww&&o.classList.add(o["s-si"]=ww),s.$children$)for(n=0;n<s.$children$.length;++n)a=A$(e,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?uc=!1:o.tagName==="foreignObject"&&(uc=!0)}return o["s-hn"]=XD,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=$le,o["s-sn"]=s.$name$||"",l=e&&e.$children$&&e.$children$[r],l&&l.$tag$===s.$tag$&&e.$elm$&&oA(e.$elm$,!1)),o},oA=(e,t)=>{Co.$flags$|=1;const r=e.childNodes;for(let i=r.length-1;i>=0;i--){const s=r[i];s["s-hn"]!==XD&&s["s-ol"]&&(Ble(s).insertBefore(s,T7(s)),s["s-ol"].remove(),s["s-ol"]=void 0,w7=!0),t&&oA(s,t)}Co.$flags$&=-2},kle=(e,t,r,i,s,n)=>{let o=e["s-cr"]&&e["s-cr"].parentNode||e,a;for(o.shadowRoot&&o.tagName===XD&&(o=o.shadowRoot);s<=n;++s)i[s]&&(a=A$(null,r,s,e),a&&(i[s].$elm$=a,o.insertBefore(a,T7(t))))},zle=(e,t,r,i,s)=>{for(;t<=r;++t)(i=e[t])&&(s=i.$elm$,jle(i),E$=!0,s["s-ol"]?s["s-ol"].remove():oA(s,!0),s.remove())},xAe=(e,t,r,i)=>{let s=0,n=0,o=0,a=0,l=t.length-1,c=t[0],u=t[l],d=i.length-1,p=i[0],g=i[d],y,_;for(;s<=l&&n<=d;)if(c==null)c=t[++s];else if(u==null)u=t[--l];else if(p==null)p=i[++n];else if(g==null)g=i[--d];else if($O(c,p))xw(c,p),c=t[++s],p=i[++n];else if($O(u,g))xw(u,g),u=t[--l],g=i[--d];else if($O(c,g))(c.$tag$==="slot"||g.$tag$==="slot")&&oA(c.$elm$.parentNode,!1),xw(c,g),e.insertBefore(c.$elm$,u.$elm$.nextSibling),c=t[++s],g=i[--d];else if($O(u,p))(c.$tag$==="slot"||g.$tag$==="slot")&&oA(u.$elm$.parentNode,!1),xw(u,p),e.insertBefore(u.$elm$,c.$elm$),u=t[--l],p=i[++n];else{for(o=-1,a=s;a<=l;++a)if(t[a]&&t[a].$key$!==null&&t[a].$key$===p.$key$){o=a;break}o>=0?(_=t[o],_.$tag$!==p.$tag$?y=A$(t&&t[n],r,o,e):(xw(_,p),t[o]=void 0,y=_.$elm$),p=i[++n]):(y=A$(t&&t[n],r,n,e),p=i[++n]),y&&Ble(c.$elm$).insertBefore(y,T7(c.$elm$))}s>l?kle(e,i[d+1]==null?null:i[d+1].$elm$,r,i,n,d):n>d&&zle(t,s,l)},$O=(e,t)=>e.$tag$===t.$tag$?e.$tag$==="slot"?e.$name$===t.$name$:e.$key$===t.$key$:!1,T7=e=>e&&e["s-ol"]||e,Ble=e=>(e["s-ol"]?e["s-ol"]:e).parentNode,xw=(e,t)=>{const r=t.$elm$=e.$elm$,i=e.$children$,s=t.$children$,n=t.$tag$,o=t.$text$;let a;o===null?(uc=n==="svg"?!0:n==="foreignObject"?!1:uc,n==="slot"||Ule(e,t,uc),i!==null&&s!==null?xAe(r,i,t,s):s!==null?(e.$text$!==null&&(r.textContent=""),kle(r,null,t,s,0,s.length-1)):i!==null&&zle(i,0,i.length-1),uc&&n==="svg"&&(uc=!1)):(a=r["s-cr"])?a.parentNode.textContent=o:e.$text$!==o&&(r.data=o)},Vle=e=>{const t=e.childNodes;let r,i,s,n,o,a;for(i=0,s=t.length;i<s;i++)if(r=t[i],r.nodeType===1){if(r["s-sr"]){for(o=r["s-sn"],r.hidden=!1,n=0;n<s;n++)if(a=t[n].nodeType,t[n]["s-hn"]!==r["s-hn"]||o!==""){if(a===1&&o===t[n].getAttribute("slot")){r.hidden=!0;break}}else if(a===1||a===3&&t[n].textContent.trim()!==""){r.hidden=!0;break}}Vle(r)}},Zh=[],Gle=e=>{let t,r,i,s,n,o,a=0;const l=e.childNodes,c=l.length;for(;a<c;a++){if(t=l[a],t["s-sr"]&&(r=t["s-cr"])&&r.parentNode)for(i=r.parentNode.childNodes,s=t["s-sn"],o=i.length-1;o>=0;o--)r=i[o],!r["s-cn"]&&!r["s-nr"]&&r["s-hn"]!==t["s-hn"]&&(IX(r,s)?(n=Zh.find(u=>u.$nodeToRelocate$===r),E$=!0,r["s-sn"]=r["s-sn"]||s,n?n.$slotRefNode$=t:Zh.push({$slotRefNode$:t,$nodeToRelocate$:r}),r["s-sr"]&&Zh.map(u=>{IX(u.$nodeToRelocate$,r["s-sn"])&&(n=Zh.find(d=>d.$nodeToRelocate$===r),n&&!u.$slotRefNode$&&(u.$slotRefNode$=n.$slotRefNode$))})):Zh.some(u=>u.$nodeToRelocate$===r)||Zh.push({$nodeToRelocate$:r}));t.nodeType===1&&Gle(t)}},IX=(e,t)=>e.nodeType===1?e.getAttribute("slot")===null&&t===""||e.getAttribute("slot")===t:e["s-sn"]===t?!0:t==="",jle=e=>{e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(jle)},TAe=(e,t)=>{const r=e.$hostElement$,i=e.$cmpMeta$,s=e.$vnode$||C$(null,null),n=Nle(t)?t:pu(null,null,t);XD=r.tagName,i.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},i.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=r[o])),n.$tag$=null,n.$flags$|=4,e.$vnode$=n,n.$elm$=s.$elm$=r.shadowRoot||r,ww=r["s-sc"],$le=r["s-cr"],Lle=R$&&(i.$flags$&1)!==0,E$=!1,xw(s,n);{if(Co.$flags$|=1,w7){Gle(n.$elm$);let o,a,l,c,u,d,p=0;for(;p<Zh.length;p++)o=Zh[p],a=o.$nodeToRelocate$,a["s-ol"]||(l=ku.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(p=0;p<Zh.length;p++)if(o=Zh[p],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,u=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(d=l["s-nr"],d&&d["s-sn"]===a["s-sn"]&&c===d.parentNode&&(d=d.nextSibling,!d||!d["s-nr"])){u=d;break}(!u&&c!==a.parentNode||a.nextSibling!==u)&&a!==u&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,u))}else a.nodeType===1&&(a.hidden=!0)}E$&&Vle(n.$elm$),Co.$flags$&=-2,Zh.length=0}},SAe=(e,t)=>{},S7=(e,t)=>(e.$flags$|=16,SAe(e,e.$ancestorComponent$),JAe(()=>EAe(e,t))),EAe=(e,t)=>{const r=e.$hostElement$,i=l1("scheduleUpdate",e.$cmpMeta$.$tagName$),s=r;let n;return t?n=Px(s,"componentWillLoad"):n=Px(s,"componentWillUpdate"),n=$X(n,()=>Px(s,"componentWillRender")),i(),$X(n,()=>CAe(e,s,t))},CAe=async(e,t,r)=>{const i=e.$hostElement$,s=l1("update",e.$cmpMeta$.$tagName$);i["s-rc"],r&&bAe(e);const n=l1("render",e.$cmpMeta$.$tagName$);AAe(e,t,i),n(),s(),OAe(e)},AAe=(e,t,r)=>{try{EX=t,t=t.render&&t.render(),e.$flags$&=-17,e.$flags$|=2,(Nr.hasRenderFn||Nr.reflect)&&(Nr.vdomRender||Nr.reflect)&&(Nr.hydrateServerSide||TAe(e,t))}catch(a){P3(a,e.$hostElement$)}return EX=null,null},OAe=e=>{const t=e.$cmpMeta$.$tagName$,r=e.$hostElement$,i=l1("postUpdate",t),s=r;e.$ancestorComponent$,Px(s,"componentDidRender"),e.$flags$&64?(Px(s,"componentDidUpdate"),i()):(e.$flags$|=64,Px(s,"componentDidLoad"),i())},Fht=e=>{{const t=R3(e),r=t.$hostElement$.isConnected;return r&&(t.$flags$&18)===2&&S7(t,!1),r}},Px=(e,t,r)=>{if(e&&e[t])try{return e[t](r)}catch(i){P3(i)}},$X=(e,t)=>e&&e.then?e.then(t):t(),RAe=(e,t)=>R3(e).$instanceValues$.get(t),PAe=(e,t,r,i)=>{const s=R3(e),n=e,o=s.$instanceValues$.get(t),a=s.$flags$,l=n;r=mAe(r,i.$members$[t][0]);const c=Number.isNaN(o)&&Number.isNaN(r);if(r!==o&&!c){s.$instanceValues$.set(t,r);{if(i.$watchers$&&a&128){const d=i.$watchers$[t];d&&d.map(p=>{try{l[p](r,o,t)}catch(g){P3(g,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(r,o,t)===!1)return;S7(s,!1)}}}},MAe=(e,t,r)=>{if(t.$members$){e.watchers&&(t.$watchers$=e.watchers);const i=Object.entries(t.$members$),s=e.prototype;i.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return RAe(this,n)},set(a){PAe(this,n,a,t)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){Co.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},e.observedAttributes=i.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&t.$attrsToReflect$.push([o,l]),l})}}return e},IAe=async(e,t,r,i,s)=>{if((t.$flags$&32)===0&&(s=e.constructor,t.$flags$|=32,customElements.whenDefined(r.$tagName$).then(()=>t.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[t.$modeName$=fAe(e)]);const a=Fle(r,t.$modeName$);if(!O$.has(a)){const l=l1("registerStyles",r.$tagName$);_Ae(a,o,!!(r.$flags$&1)),l()}}t.$ancestorComponent$,(()=>S7(t,!0))()},$Ae=e=>{},LAe=e=>{if((Co.$flags$&1)===0){const t=R3(e),r=t.$cmpMeta$,i=l1("connectedCallback",r.$tagName$);t.$flags$&1?(Hle(e,t,r.$listeners$),$Ae(t.$lazyInstance$)):(t.$flags$|=1,r.$flags$&12&&DAe(e),r.$members$&&Object.entries(r.$members$).map(([s,[n]])=>{if(n&31&&e.hasOwnProperty(s)){const o=e[s];delete e[s],e[s]=o}}),IAe(e,t,r)),i()}},DAe=e=>{const t=e["s-cr"]=ku.createComment("");t["s-cn"]=!0,e.insertBefore(t,e.firstChild)},NAe=e=>{if((Co.$flags$&1)===0){const t=R3(e);t.$rmListeners$&&(t.$rmListeners$.map(r=>r()),t.$rmListeners$=void 0)}},FAe=(e,t)=>{const r={$flags$:t[0],$tagName$:t[1]};Nr.member&&(r.$members$=t[2]),Nr.hostListener&&(r.$listeners$=t[3]),Nr.watchCallback&&(r.$watchers$=e.$watchers$),Nr.reflect&&(r.$attrsToReflect$=[]),Nr.shadowDom&&!R$&&r.$flags$&1&&(r.$flags$|=8);const i=e.prototype.connectedCallback,s=e.prototype.disconnectedCallback;return Object.assign(e.prototype,{__registerHost(){BAe(this,r)},connectedCallback(){LAe(this),Nr.connectedCallback&&i&&i.call(this)},disconnectedCallback(){NAe(this),Nr.disconnectedCallback&&s&&s.call(this)},__attachShadow(){R$?Nr.shadowDelegatesFocus?this.attachShadow({mode:"open",delegatesFocus:!!(r.$flags$&16)}):this.attachShadow({mode:"open"}):this.shadowRoot=this}}),e.is=r.$tagName$,MAe(e,r)},Uht=(e,t)=>t,Hle=(e,t,r,i)=>{r&&r.map(([s,n,o])=>{const a=kAe(e,s),l=UAe(t,o),c=zAe(s);Co.ael(a,n,l,c),(t.$rmListeners$=t.$rmListeners$||[]).push(()=>Co.rel(a,n,l,c))})},UAe=(e,t)=>r=>{try{Nr.lazyLoad||e.$hostElement$[t](r)}catch(i){P3(i)}},kAe=(e,t)=>t&4?ku:t&8?h2:t&16?ku.body:e,zAe=e=>WAe?{passive:(e&1)!==0,capture:(e&2)!==0}:(e&2)!==0,Wle=new WeakMap,R3=e=>Wle.get(e),BAe=(e,t)=>{const r={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};return Nr.isDev&&(r.$renderCount$=0),Nr.method&&Nr.lazyLoad&&(r.$onInstancePromise$=new Promise(i=>r.$onInstanceResolve$=i)),Nr.asyncLoading&&(r.$onReadyPromise$=new Promise(i=>r.$onReadyResolve$=i),e["s-p"]=[],e["s-rc"]=[]),Hle(e,r,t.$listeners$),Wle.set(e,r)},LX=(e,t)=>t in e,P3=(e,t)=>(0,console.error)(e,t),qle=Nr.isTesting?["STENCIL:"]:["%cstencil","color: white;background:#4c47ff;font-weight: bold; font-size:10px; padding:2px 6px; border-radius: 5px"],VAe=(...e)=>console.error(...qle,...e),GAe=(...e)=>console.warn(...qle,...e),O$=new Map,jAe=[],h2=typeof window<"u"?window:{};Nr.cssVarShim&&h2.CSS;const ku=h2.document||{head:{}},HAe=h2.HTMLElement||class{},Co={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,r,i)=>e.addEventListener(t,r,i),rel:(e,t,r,i)=>e.removeEventListener(t,r,i),ce:(e,t)=>new CustomEvent(e,t)},R$=Nr.shadowDomShim&&Nr.shadowDom?(()=>(ku.head.attachShadow+"").indexOf("[native")>-1)():!0,WAe=(()=>{let e=!1;try{ku.addEventListener("e",null,Object.defineProperty({},"passive",{get(){e=!0}}))}catch{}return e})(),qAe=e=>Promise.resolve(e),XAe=Nr.constructableCSS?(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})():!1,DX=[],Xle=[],ZAe=(e,t)=>r=>{e.push(r),Z8||(Z8=!0,t&&Co.$flags$&4?YAe(Y8):Co.raf(Y8))},NX=e=>{for(let t=0;t<e.length;t++)try{e[t](performance.now())}catch(r){P3(r)}e.length=0},Y8=()=>{NX(DX),NX(Xle),(Z8=DX.length>0)&&Co.raf(Y8)},YAe=e=>qAe().then(e),JAe=ZAe(Xle,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.4.2
 */function KAe(e){return e.map(t=>{let r="";for(let i=0;i<t;i++)r+=((1+Math.random())*65536|0).toString(16).substring(1);return r}).join("-")}const QAe=()=>KAe([2,1,1,1,3]);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.4.2
 */const Zle="calcite-mode-auto",Yle="calcite-mode-dark",e3e="calcite-mode-light",kht={autoMode:Zle,darkMode:Yle,lightMode:e3e,rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"};/*!
* tabbable 6.1.2
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var Jle=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],P$=Jle.join(","),Kle=typeof Element>"u",c1=Kle?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,M$=!Kle&&Element.prototype.getRootNode?function(e){var t;return e==null||(t=e.getRootNode)===null||t===void 0?void 0:t.call(e)}:function(e){return e?.ownerDocument},I$=function e(t,r){var i;r===void 0&&(r=!0);var s=t==null||(i=t.getAttribute)===null||i===void 0?void 0:i.call(t,"inert"),n=s===""||s==="true",o=n||r&&t&&e(t.parentNode);return o},t3e=function(t){var r,i=t==null||(r=t.getAttribute)===null||r===void 0?void 0:r.call(t,"contenteditable");return i===""||i==="true"},Qle=function(t,r,i){if(I$(t))return[];var s=Array.prototype.slice.apply(t.querySelectorAll(P$));return r&&c1.call(t,P$)&&s.unshift(t),s=s.filter(i),s},ece=function e(t,r,i){for(var s=[],n=Array.from(t);n.length;){var o=n.shift();if(!I$(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=e(l,!0,i);i.flatten?s.push.apply(s,c):s.push({scopeParent:o,candidates:c})}else{var u=c1.call(o,P$);u&&i.filter(o)&&(r||!t.includes(o))&&s.push(o);var d=o.shadowRoot||typeof i.getShadowRoot=="function"&&i.getShadowRoot(o),p=!I$(d,!1)&&(!i.shadowRootFilter||i.shadowRootFilter(o));if(d&&p){var g=e(d===!0?o.children:d.children,!0,i);i.flatten?s.push.apply(s,g):s.push({scopeParent:o,candidates:g})}else n.unshift.apply(n,o.children)}}return s},tce=function(t,r){return t.tabIndex<0&&(r||/^(AUDIO|VIDEO|DETAILS)$/.test(t.tagName)||t3e(t))&&isNaN(parseInt(t.getAttribute("tabindex"),10))?0:t.tabIndex},r3e=function(t,r){return t.tabIndex===r.tabIndex?t.documentOrder-r.documentOrder:t.tabIndex-r.tabIndex},rce=function(t){return t.tagName==="INPUT"},i3e=function(t){return rce(t)&&t.type==="hidden"},s3e=function(t){var r=t.tagName==="DETAILS"&&Array.prototype.slice.apply(t.children).some(function(i){return i.tagName==="SUMMARY"});return r},n3e=function(t,r){for(var i=0;i<t.length;i++)if(t[i].checked&&t[i].form===r)return t[i]},o3e=function(t){if(!t.name)return!0;var r=t.form||M$(t),i=function(a){return r.querySelectorAll('input[type="radio"][name="'+a+'"]')},s;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")s=i(window.CSS.escape(t.name));else try{s=i(t.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var n=n3e(s,t.form);return!n||n===t},a3e=function(t){return rce(t)&&t.type==="radio"},l3e=function(t){return a3e(t)&&!o3e(t)},c3e=function(t){var r,i=t&&M$(t),s=(r=i)===null||r===void 0?void 0:r.host,n=!1;if(i&&i!==t){var o,a,l;for(n=!!((o=s)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(s)||t!=null&&(l=t.ownerDocument)!==null&&l!==void 0&&l.contains(t));!n&&s;){var c,u,d;i=M$(s),s=(c=i)===null||c===void 0?void 0:c.host,n=!!((u=s)!==null&&u!==void 0&&(d=u.ownerDocument)!==null&&d!==void 0&&d.contains(s))}}return n},FX=function(t){var r=t.getBoundingClientRect(),i=r.width,s=r.height;return i===0&&s===0},u3e=function(t,r){var i=r.displayCheck,s=r.getShadowRoot;if(getComputedStyle(t).visibility==="hidden")return!0;var n=c1.call(t,"details>summary:first-of-type"),o=n?t.parentElement:t;if(c1.call(o,"details:not([open]) *"))return!0;if(!i||i==="full"||i==="legacy-full"){if(typeof s=="function"){for(var a=t;t;){var l=t.parentElement,c=M$(t);if(l&&!l.shadowRoot&&s(l)===!0)return FX(t);t.assignedSlot?t=t.assignedSlot:!l&&c!==t.ownerDocument?t=c.host:t=l}t=a}if(c3e(t))return!t.getClientRects().length;if(i!=="legacy-full")return!0}else if(i==="non-zero-area")return FX(t);return!1},h3e=function(t){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(t.tagName))for(var r=t.parentElement;r;){if(r.tagName==="FIELDSET"&&r.disabled){for(var i=0;i<r.children.length;i++){var s=r.children.item(i);if(s.tagName==="LEGEND")return c1.call(r,"fieldset[disabled] *")?!0:!s.contains(t)}return!0}r=r.parentElement}return!1},$$=function(t,r){return!(r.disabled||I$(r)||i3e(r)||u3e(r,t)||s3e(r)||h3e(r))},J8=function(t,r){return!(l3e(r)||tce(r)<0||!$$(t,r))},d3e=function(t){var r=parseInt(t.getAttribute("tabindex"),10);return!!(isNaN(r)||r>=0)},p3e=function e(t){var r=[],i=[];return t.forEach(function(s,n){var o=!!s.scopeParent,a=o?s.scopeParent:s,l=tce(a,o),c=o?e(s.candidates):a;l===0?o?r.push.apply(r,c):r.push(a):i.push({documentOrder:n,tabIndex:l,item:s,isScope:o,content:c})}),i.sort(r3e).reduce(function(s,n){return n.isScope?s.push.apply(s,n.content):s.push(n.content),s},[]).concat(r)},f3e=function(t,r){r=r||{};var i;return r.getShadowRoot?i=ece([t],r.includeContainer,{filter:J8.bind(null,r),flatten:!1,getShadowRoot:r.getShadowRoot,shadowRootFilter:d3e}):i=Qle(t,r.includeContainer,J8.bind(null,r)),p3e(i)},zht=function(t,r){r=r||{};var i;return r.getShadowRoot?i=ece([t],r.includeContainer,{filter:$$.bind(null,r),flatten:!0,getShadowRoot:r.getShadowRoot}):i=Qle(t,r.includeContainer,$$.bind(null,r)),i},Bht=function(t,r){if(r=r||{},!t)throw new Error("No node provided");return c1.call(t,P$)===!1?!1:J8(r,t)},m3e=Jle.concat("iframe").join(","),Vht=function(t,r){if(r=r||{},!t)throw new Error("No node provided");return c1.call(t,m3e)===!1?!1:$$(r,t)};const g3e={getShadowRoot:!0};function Ght(e){const t="dir",r=`[${t}]`,i=y3e(e,r);return i?i.getAttribute(t):"ltr"}function E7(e){return e.getRootNode()}function jht(e){const t=E7(e);return"host"in t?t:null}function ice(e){return e.host||null}function Hht(e,{selector:t,id:r}){function i(s){if(!s)return null;s.assignedSlot&&(s=s.assignedSlot);const n=E7(s),o=r?"getElementById"in n?n.getElementById(r):null:t?n.querySelector(t):null,a=ice(n);return o||(a?i(a):null)}return i(e)}function y3e(e,t){function r(i){return i?i.closest(t)||r(ice(E7(i))):null}return r(e)}function _3e(e,t){return sce(e,t)}function sce(e,t){if(!e)return;const r=t(e);if(r!==void 0)return r;const{parentNode:i}=e;return sce(i instanceof ShadowRoot?i.host:i,t)}function Wht(e,t){return!!_3e(t,r=>r===e?!0:void 0)}function v3e(e){return typeof e?.setFocus=="function"}async function qht(e){if(!!e)return v3e(e)?e.setFocus():e.focus()}function Xht(e){!e||(f3e(e,g3e)[0]||e).focus()}const aA=":not([slot])";function Zht(e,t,r){t&&!Array.isArray(t)&&typeof t!="string"&&(r=t,t=null);const i=t?Array.isArray(t)?t.map(s=>`[slot="${s}"]`).join(","):`[slot="${t}"]`:aA;return r?.all?b3e(e,i,r):w3e(e,i,r)}function nce(e,t){return e?Array.from(e.children||[]).filter(r=>r?.matches(t)):[]}function b3e(e,t,r){let i=t===aA?nce(e,aA):Array.from(e.querySelectorAll(t));i=r&&r.direct===!1?i:i.filter(n=>n.parentElement===e),i=r?.matches?i.filter(n=>n?.matches(r.matches)):i;const s=r?.selector;return s?i.map(n=>Array.from(n.querySelectorAll(s))).reduce((n,o)=>[...n,...o],[]).filter(n=>!!n):i}function w3e(e,t,r){let i=t===aA?nce(e,aA)[0]||null:e.querySelector(t);i=r&&r.direct===!1||i?.parentElement===e?i:null,i=r?.matches?i?.matches(r.matches)?i:null:i;const s=r?.selector;return s?i?.querySelector(s):i}function Yht(e,t,r){if(typeof t=="string"&&t!=="")return t;if(t==="")return e[r]}function Jht(e){return Boolean(e).toString()}function Kht(e){return!!x3e(e).length}function x3e(e){return e.target.assignedElements({flatten:!0})}function Qht(e){return!!(e.isPrimary&&e.button===0)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.4.2
 */function UX(){const{classList:e}=document.body,t=window.matchMedia("(prefers-color-scheme: dark)").matches,r=()=>e.contains(Yle)||e.contains(Zle)&&t?"dark":"light",i=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),s=o=>{n!==o&&i(o),n=o};let n=r();i(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>s(o.matches?"dark":"light")),new MutationObserver(()=>s(r())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function T3e(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?UX():document.addEventListener("DOMContentLoaded",()=>UX(),{once:!0}))}const S3e=T3e;S3e();let oce;function E3e(){try{nAe(".")}catch{oAe(ja($r(oce)))}}function edt(e){const t=[];for(const r of Object.keys(e))customElements.get(`calcite-${r}`)||t.push(e[r]?.());return Promise.all(t)}oce="components/assets";const ace=Symbol("widget"),C3e=Symbol("widget-test-data"),A3e=[],O3e={},L$=new WeakMap;function lce(e,t){let r=t.children;if(r&&r.length)for(let s=0;s<r.length;++s)r[s]=lce(e,r[s]);else r=A3e;const i=t.vnodeSelector;if(C7(i)){const s=t.properties||O3e,n=s.key||i;return{vnodeSelector:"div",properties:{key:n,afterCreate:R3e,afterUpdate:P3e,afterRemoved:cce,parentWidget:e,widgetConstructor:i,widgetProperties:{...s,key:n,children:r}},children:void 0,text:void 0,domNode:null}}return t}function R3e(e,t,r,{parentWidget:i,widgetConstructor:s,widgetProperties:n}){const o=new s(n);o.container=e,L$.set(e,o),o.afterCreate?.(o,e),i._internalHandles.add(Xo(()=>cce(e)))}function P3e(e,t,r,{widgetProperties:i}){const s=L$.get(e);s&&(s.set(i),s.afterUpdate?.(s,e))}function cce(e){const t=L$.get(e);t&&(t.afterRemoved?.(t,e),t.destroy(),L$.delete(e))}function C7(e){return typeof e=="function"&&e[ace]}const kX=new Set;function M3e(e){kX.add(e),e.finally(()=>kX.delete(e))}var uce;const I3e="esri.widgets.Widget";let $3e=0;const L3e={widgetIcon:"esri-icon-checkbox-unchecked"};function hce(e,t){for(const r in t)e[r]!=null&&(typeof e[r]=="object"&&typeof t[r]=="object"?hce(e[r],t?.[r]):e[r]=t[r]);return e}const D3e=sAe({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,r=/capture$/i;e.eventHandlerInterceptor=(i,s,n,o)=>{const a=t?.(i,s,n,o),l=r.test(i);if(!((i=i.replace(r,"")).toLowerCase()in n)||l){const c=i[2].toLowerCase()+i.slice(3),u=g=>a?.call(n,g);n.addEventListener(c,u,l);const d=()=>n.removeEventListener(c,u,l),p=o.afterRemoved;o.afterRemoved=g=>{p?.(g),d()}}return a}},handleInterceptedEvent(e,t,r,i){const{eventPhase:s,type:n}=i,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=t.properties;(l&&a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,l&&a in l))&&(Tle(),e.scheduleRender(),l[a].call(l.bind||r,i))}});let W5=!1,Tn=class extends jD(cs.EventedAccessor){constructor(e,t){super(e,t),this._attached=!1,this._internalHandles=new gi,this._projector=D3e,this._readyForTrueRender=!1,this.iconClass=L3e.widgetIcon,this.icon=null,this.key=this,this._loadLocale=zV(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const n=await Sc(this._messageBundleProps.map(async({bundlePath:o,propertyName:a})=>{if(this.destroyed)return;let l=await ole(o);this.uiStrings&&Object.keys(this.uiStrings)&&(l=hce(ye(l),this.uiStrings)),this[a]=l}));if(this.destroyed)return;for(const o of n)o.error&&K.getLogger(this).error("widget-intl:locale-error",this.declaredClass,o.error)}await this.loadLocale()}),E3e();const r="esri-widget-uid-"+y7(),i=this.render.bind(this);this._trackingTarget=new FD(()=>this.scheduleRender());const s=()=>{if(!this._readyForTrueRender||this.destroyed)return null;const n=i();let{properties:o}=n;o||(n.properties=o={});const{key:a}=o;a||(o.key=r),this.visible?o.styles||(o.styles={}):(o.class="",o.styles={display:"none"}),o.styles.display||(o.styles.display="");let l=0;return n.children?.forEach(c=>{if(C7(c.vnodeSelector))return;let{properties:u}=c;u||(c.properties=u={}),u.key||(u.key=`${this.id}--${l++}`)}),lce(this,n)};this.render=()=>{if(W5)return s();let n=MCe(this)??null;if(n)return n;this._trackingTarget.clear(),W5=!0;try{n=Rm(this._trackingTarget,s)}catch(o){throw console.error(o),o}finally{W5=!1}return n&&ICe(this,n),n},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),M3e(this._resourcesFetch)}normalizeCtorArgs(e,t){const r={...e};return t&&(r.container=t),r}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(lq)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(Re(this._trackingTarget),Re(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,j5(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return GD(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+$3e++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(uce=ace,C3e)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(j5(this),this._projector.scheduleRender())}classes(...e){return FCe.apply(this,e)}renderNow(){j5(this),this._projector.renderNow()}_postInitialize(){if(this.destroyed)return;this.scheduleRender(),this._delegatedEventNames?.length&&this._internalHandles.add(le(()=>this.viewModel,(t,r)=>{r&&this._internalHandles.remove("delegated-events"),t&&$D(t)&&this._internalHandles.add(this._delegatedEventNames.map(i=>ey(t,i,s=>{this.emit(i,s)})),"delegated-events")},Rr)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(lq),this.scheduleRender()};this._internalHandles.add([rae(e),le(()=>this.uiStrings,e),Dc(()=>this.container,t=>{this.destroyed||this._attach(t)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){this._attached&&(this._projector.detach(this.render),this._attached=!1),e?.parentNode?.removeChild(e)}};Tn[uce]=!0,h([f()],Tn.prototype,"_readyForTrueRender",void 0),h([f({value:null})],Tn.prototype,"container",null),h([si("container")],Tn.prototype,"castContainer",null),h([f()],Tn.prototype,"iconClass",void 0),h([f()],Tn.prototype,"icon",void 0),h([f()],Tn.prototype,"id",null),h([f()],Tn.prototype,"label",null),h([f()],Tn.prototype,"renderable",null),h([f()],Tn.prototype,"uiStrings",void 0),h([f()],Tn.prototype,"viewModel",void 0),h([f({value:!0})],Tn.prototype,"visible",null),h([f()],Tn.prototype,"key",void 0),h([f()],Tn.prototype,"children",void 0),h([f()],Tn.prototype,"afterCreate",void 0),h([f()],Tn.prototype,"afterUpdate",void 0),h([f()],Tn.prototype,"afterRemoved",void 0),Tn=h([F(I3e)],Tn);const Z1=Tn;function d2(e){return(t,r)=>{t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:r})}}var N3e=function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}},dce=function(e,t){for(var r=0,i=e.length;r<i;r++){var s=e[r];Array.isArray(s)?dce(s,t):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=N3e(s)),t.push(s))}},F3e=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(r.length===1&&typeof r[0]=="string")return{vnodeSelector:e,properties:t||void 0,children:void 0,text:r[0],domNode:null};var s=[];return dce(r,s),{vnodeSelector:e,properties:t||void 0,children:s,text:void 0,domNode:null}};function Dr(e,t,...r){return typeof e!="function"||C7(e)?F3e(e,t,...r):e(t,...r)}const LO="esri-identity-form",ql={base:LO,group:`${LO}__group`,label:`${LO}__label`,footer:`${LO}__footer`,esriInput:"esri-input",esriButton:"esri-button",esriButtonSecondary:"esri-button--secondary"},U3e="ArcGIS Online";let Lf=class extends Z1{constructor(e,t){super(e,t),this._usernameInputNode=null,this._passwordInputNode=null,this.signingIn=!1,this.server=null,this.resource=null,this.error=null,this.oAuthPrompt=!1}render(){const{error:e,server:t,resource:r,signingIn:i,oAuthPrompt:s,messages:n}=this,o=Dr("div",{class:ql.group},vEe(s?n.oAuthInfo:n.info,{server:t&&/\.arcgis\.com/i.test(t)?U3e:t,resource:`(${r||n.lblItem})`})),a=s?null:Dr("div",{class:ql.group,key:"username"},Dr("label",{class:ql.label},n.lblUser,Dr("input",{value:"",required:!0,autocomplete:"off",spellcheck:!1,type:"text",bind:this,afterCreate:_X,"data-node-ref":"_usernameInputNode",class:ql.esriInput}))),l=s?null:Dr("div",{class:ql.group,key:"password"},Dr("label",{class:ql.label},n.lblPwd,Dr("input",{value:"",required:!0,type:"password",bind:this,afterCreate:_X,"data-node-ref":"_passwordInputNode",class:ql.esriInput}))),c=Dr("div",{class:this.classes(ql.group,ql.footer)},Dr("input",{type:"submit",disabled:!!i,value:i?n.lblSigning:n.lblOk,class:ql.esriButton}),Dr("input",{type:"button",value:n.lblCancel,bind:this,onclick:this._cancel,class:this.classes(ql.esriButton,ql.esriButtonSecondary)})),u=e?Dr("div",null,e.details&&e.details.httpStatus?n.invalidUser:n.noAuthService):null;return Dr("form",{class:ql.base,bind:this,onsubmit:this._submit},o,u,a,l,c)}_cancel(){this._set("signingIn",!1),this._usernameInputNode&&(this._usernameInputNode.value=""),this._passwordInputNode&&(this._passwordInputNode.value=""),this.emit("cancel")}_submit(e){e.preventDefault(),this._set("signingIn",!0);const t=this.oAuthPrompt?{}:{username:this._usernameInputNode&&this._usernameInputNode.value,password:this._passwordInputNode&&this._passwordInputNode.value};this.emit("submit",t)}};h([f(),d2("esri/identity/t9n/identity")],Lf.prototype,"messages",void 0),h([f()],Lf.prototype,"signingIn",void 0),h([f()],Lf.prototype,"server",void 0),h([f()],Lf.prototype,"resource",void 0),h([f()],Lf.prototype,"error",void 0),h([f()],Lf.prototype,"oAuthPrompt",void 0),Lf=h([F("esri.identity.IdentityForm")],Lf);const k3e=Lf;function ZD(){return function(e,t){if(!e[t])throw new TypeError(`Cannot auto bind undefined function '${String(t)}'`);return{value:B3e(e[t])}}}function z3e(e){const t=e?.type;return e instanceof KeyboardEvent||t==="keyup"||t==="keydown"||t==="keypress"}function B3e(e){return function(t,...r){z3e(t)?VCe(t.key)&&(t.preventDefault(),t.stopPropagation(),t.target.click()):e.call(this,t,...r)}}const pce="calcite-mode-";function V3e(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function G3e(){return V3e().startsWith("dark")}function j3e(){return`${pce}${G3e()?"dark":"light"}`}function H3e(e){W3e(e),e.classList.add(j3e())}function W3e(e){Array.from(e.classList).forEach(t=>{t.startsWith(pce)&&e.classList.remove(t)})}function q3e(e){return e&&typeof e.render=="function"}function tdt(e){return e&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}/*!
* tabbable 6.1.2
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var fce=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],D$=fce.join(","),mce=typeof Element>"u",u1=mce?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,N$=!mce&&Element.prototype.getRootNode?function(e){var t;return e==null||(t=e.getRootNode)===null||t===void 0?void 0:t.call(e)}:function(e){return e?.ownerDocument},F$=function e(t,r){var i;r===void 0&&(r=!0);var s=t==null||(i=t.getAttribute)===null||i===void 0?void 0:i.call(t,"inert"),n=s===""||s==="true",o=n||r&&t&&e(t.parentNode);return o},X3e=function(t){var r,i=t==null||(r=t.getAttribute)===null||r===void 0?void 0:r.call(t,"contenteditable");return i===""||i==="true"},gce=function(t,r,i){if(F$(t))return[];var s=Array.prototype.slice.apply(t.querySelectorAll(D$));return r&&u1.call(t,D$)&&s.unshift(t),s=s.filter(i),s},yce=function e(t,r,i){for(var s=[],n=Array.from(t);n.length;){var o=n.shift();if(!F$(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=e(l,!0,i);i.flatten?s.push.apply(s,c):s.push({scopeParent:o,candidates:c})}else{var u=u1.call(o,D$);u&&i.filter(o)&&(r||!t.includes(o))&&s.push(o);var d=o.shadowRoot||typeof i.getShadowRoot=="function"&&i.getShadowRoot(o),p=!F$(d,!1)&&(!i.shadowRootFilter||i.shadowRootFilter(o));if(d&&p){var g=e(d===!0?o.children:d.children,!0,i);i.flatten?s.push.apply(s,g):s.push({scopeParent:o,candidates:g})}else n.unshift.apply(n,o.children)}}return s},_ce=function(t,r){return t.tabIndex<0&&(r||/^(AUDIO|VIDEO|DETAILS)$/.test(t.tagName)||X3e(t))&&isNaN(parseInt(t.getAttribute("tabindex"),10))?0:t.tabIndex},Z3e=function(t,r){return t.tabIndex===r.tabIndex?t.documentOrder-r.documentOrder:t.tabIndex-r.tabIndex},vce=function(t){return t.tagName==="INPUT"},Y3e=function(t){return vce(t)&&t.type==="hidden"},J3e=function(t){var r=t.tagName==="DETAILS"&&Array.prototype.slice.apply(t.children).some(function(i){return i.tagName==="SUMMARY"});return r},K3e=function(t,r){for(var i=0;i<t.length;i++)if(t[i].checked&&t[i].form===r)return t[i]},Q3e=function(t){if(!t.name)return!0;var r=t.form||N$(t),i=function(a){return r.querySelectorAll('input[type="radio"][name="'+a+'"]')},s;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")s=i(window.CSS.escape(t.name));else try{s=i(t.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var n=K3e(s,t.form);return!n||n===t},eOe=function(t){return vce(t)&&t.type==="radio"},tOe=function(t){return eOe(t)&&!Q3e(t)},rOe=function(t){var r,i=t&&N$(t),s=(r=i)===null||r===void 0?void 0:r.host,n=!1;if(i&&i!==t){var o,a,l;for(n=!!((o=s)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(s)||t!=null&&(l=t.ownerDocument)!==null&&l!==void 0&&l.contains(t));!n&&s;){var c,u,d;i=N$(s),s=(c=i)===null||c===void 0?void 0:c.host,n=!!((u=s)!==null&&u!==void 0&&(d=u.ownerDocument)!==null&&d!==void 0&&d.contains(s))}}return n},zX=function(t){var r=t.getBoundingClientRect(),i=r.width,s=r.height;return i===0&&s===0},iOe=function(t,r){var i=r.displayCheck,s=r.getShadowRoot;if(getComputedStyle(t).visibility==="hidden")return!0;var n=u1.call(t,"details>summary:first-of-type"),o=n?t.parentElement:t;if(u1.call(o,"details:not([open]) *"))return!0;if(!i||i==="full"||i==="legacy-full"){if(typeof s=="function"){for(var a=t;t;){var l=t.parentElement,c=N$(t);if(l&&!l.shadowRoot&&s(l)===!0)return zX(t);t.assignedSlot?t=t.assignedSlot:!l&&c!==t.ownerDocument?t=c.host:t=l}t=a}if(rOe(t))return!t.getClientRects().length;if(i!=="legacy-full")return!0}else if(i==="non-zero-area")return zX(t);return!1},sOe=function(t){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(t.tagName))for(var r=t.parentElement;r;){if(r.tagName==="FIELDSET"&&r.disabled){for(var i=0;i<r.children.length;i++){var s=r.children.item(i);if(s.tagName==="LEGEND")return u1.call(r,"fieldset[disabled] *")?!0:!s.contains(t)}return!0}r=r.parentElement}return!1},U$=function(t,r){return!(r.disabled||F$(r)||Y3e(r)||iOe(r,t)||J3e(r)||sOe(r))},K8=function(t,r){return!(tOe(r)||_ce(r)<0||!U$(t,r))},nOe=function(t){var r=parseInt(t.getAttribute("tabindex"),10);return!!(isNaN(r)||r>=0)},oOe=function e(t){var r=[],i=[];return t.forEach(function(s,n){var o=!!s.scopeParent,a=o?s.scopeParent:s,l=_ce(a,o),c=o?e(s.candidates):a;l===0?o?r.push.apply(r,c):r.push(a):i.push({documentOrder:n,tabIndex:l,item:s,isScope:o,content:c})}),i.sort(Z3e).reduce(function(s,n){return n.isScope?s.push.apply(s,n.content):s.push(n.content),s},[]).concat(r)},aOe=function(t,r){r=r||{};var i;return r.getShadowRoot?i=yce([t],r.includeContainer,{filter:K8.bind(null,r),flatten:!1,getShadowRoot:r.getShadowRoot,shadowRootFilter:nOe}):i=gce(t,r.includeContainer,K8.bind(null,r)),oOe(i)},lOe=function(t,r){r=r||{};var i;return r.getShadowRoot?i=yce([t],r.includeContainer,{filter:U$.bind(null,r),flatten:!0,getShadowRoot:r.getShadowRoot}):i=gce(t,r.includeContainer,U$.bind(null,r)),i},DO=function(t,r){if(r=r||{},!t)throw new Error("No node provided");return u1.call(t,D$)===!1?!1:K8(r,t)},cOe=fce.concat("iframe").join(","),q5=function(t,r){if(r=r||{},!t)throw new Error("No node provided");return u1.call(t,cOe)===!1?!1:U$(r,t)};/*!
* focus-trap 7.4.3
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/function BX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function VX(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?BX(Object(r),!0).forEach(function(i){uOe(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):BX(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function uOe(e,t,r){return t=dOe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hOe(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function dOe(e){var t=hOe(e,"string");return typeof t=="symbol"?t:String(t)}var GX={activateTrap:function(t,r){if(t.length>0){var i=t[t.length-1];i!==r&&i.pause()}var s=t.indexOf(r);s===-1||t.splice(s,1),t.push(r)},deactivateTrap:function(t,r){var i=t.indexOf(r);i!==-1&&t.splice(i,1),t.length>0&&t[t.length-1].unpause()}},pOe=function(t){return t.tagName&&t.tagName.toLowerCase()==="input"&&typeof t.select=="function"},fOe=function(t){return t.key==="Escape"||t.key==="Esc"||t.keyCode===27},lC=function(t){return t.key==="Tab"||t.keyCode===9},mOe=function(t){return lC(t)&&!t.shiftKey},gOe=function(t){return lC(t)&&t.shiftKey},jX=function(t){return setTimeout(t,0)},HX=function(t,r){var i=-1;return t.every(function(s,n){return r(s)?(i=n,!1):!0}),i},H2=function(t){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return typeof t=="function"?t.apply(void 0,i):t},NO=function(t){return t.target.shadowRoot&&typeof t.composedPath=="function"?t.composedPath()[0]:t.target},yOe=[],_Oe=function(t,r){var i=r?.document||document,s=r?.trapStack||yOe,n=VX({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isKeyForward:mOe,isKeyBackward:gOe},r),o={containers:[],containerGroups:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0},a,l=function(I,L,N){return I&&I[L]!==void 0?I[L]:n[N||L]},c=function(I,L){var N=typeof L?.composedPath=="function"?L.composedPath():void 0;return o.containerGroups.findIndex(function(Z){var W=Z.container,V=Z.tabbableNodes;return W.contains(I)||N?.includes(W)||V.find(function(J){return J===I})})},u=function(I){var L=n[I];if(typeof L=="function"){for(var N=arguments.length,Z=new Array(N>1?N-1:0),W=1;W<N;W++)Z[W-1]=arguments[W];L=L.apply(void 0,Z)}if(L===!0&&(L=void 0),!L){if(L===void 0||L===!1)return L;throw new Error("`".concat(I,"` was specified but was not a node, or did not return a node"))}var V=L;if(typeof L=="string"&&(V=i.querySelector(L),!V))throw new Error("`".concat(I,"` as selector refers to no known node"));return V},d=function(){var I=u("initialFocus");if(I===!1)return!1;if(I===void 0||!q5(I,n.tabbableOptions))if(c(i.activeElement)>=0)I=i.activeElement;else{var L=o.tabbableGroups[0],N=L&&L.firstTabbableNode;I=N||u("fallbackFocus")}if(!I)throw new Error("Your focus-trap needs to have at least one focusable element");return I},p=function(){if(o.containerGroups=o.containers.map(function(I){var L=aOe(I,n.tabbableOptions),N=lOe(I,n.tabbableOptions);return{container:I,tabbableNodes:L,focusableNodes:N,firstTabbableNode:L.length>0?L[0]:null,lastTabbableNode:L.length>0?L[L.length-1]:null,nextTabbableNode:function(W){var V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,J=N.findIndex(function(R){return R===W});if(!(J<0))return V?N.slice(J+1).find(function(R){return DO(R,n.tabbableOptions)}):N.slice(0,J).reverse().find(function(R){return DO(R,n.tabbableOptions)})}}}),o.tabbableGroups=o.containerGroups.filter(function(I){return I.tabbableNodes.length>0}),o.tabbableGroups.length<=0&&!u("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times")},g=function U(I){if(I!==!1&&I!==i.activeElement){if(!I||!I.focus){U(d());return}I.focus({preventScroll:!!n.preventScroll}),o.mostRecentlyFocusedNode=I,pOe(I)&&I.select()}},y=function(I){var L=u("setReturnFocus",I);return L||(L===!1?!1:I)},_=function(I){var L=NO(I);if(!(c(L,I)>=0)){if(H2(n.clickOutsideDeactivates,I)){a.deactivate({returnFocus:n.returnFocusOnDeactivate});return}H2(n.allowOutsideClick,I)||I.preventDefault()}},v=function(I){var L=NO(I),N=c(L,I)>=0;N||L instanceof Document?N&&(o.mostRecentlyFocusedNode=L):(I.stopImmediatePropagation(),g(o.mostRecentlyFocusedNode||d()))},w=function(I){var L=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,N=NO(I);p();var Z=null;if(o.tabbableGroups.length>0){var W=c(N,I),V=W>=0?o.containerGroups[W]:void 0;if(W<0)L?Z=o.tabbableGroups[o.tabbableGroups.length-1].lastTabbableNode:Z=o.tabbableGroups[0].firstTabbableNode;else if(L){var J=HX(o.tabbableGroups,function(Y){var ee=Y.firstTabbableNode;return N===ee});if(J<0&&(V.container===N||q5(N,n.tabbableOptions)&&!DO(N,n.tabbableOptions)&&!V.nextTabbableNode(N,!1))&&(J=W),J>=0){var R=J===0?o.tabbableGroups.length-1:J-1,k=o.tabbableGroups[R];Z=k.lastTabbableNode}else lC(I)||(Z=V.nextTabbableNode(N,!1))}else{var z=HX(o.tabbableGroups,function(Y){var ee=Y.lastTabbableNode;return N===ee});if(z<0&&(V.container===N||q5(N,n.tabbableOptions)&&!DO(N,n.tabbableOptions)&&!V.nextTabbableNode(N))&&(z=W),z>=0){var H=z===o.tabbableGroups.length-1?0:z+1,X=o.tabbableGroups[H];Z=X.firstTabbableNode}else lC(I)||(Z=V.nextTabbableNode(N))}}else Z=u("fallbackFocus");Z&&(lC(I)&&I.preventDefault(),g(Z))},T=function(I){if(fOe(I)&&H2(n.escapeDeactivates,I)!==!1){I.preventDefault(),a.deactivate();return}(n.isKeyForward(I)||n.isKeyBackward(I))&&w(I,n.isKeyBackward(I))},x=function(I){var L=NO(I);c(L,I)>=0||H2(n.clickOutsideDeactivates,I)||H2(n.allowOutsideClick,I)||(I.preventDefault(),I.stopImmediatePropagation())},S=function(){if(!!o.active)return GX.activateTrap(s,a),o.delayInitialFocusTimer=n.delayInitialFocus?jX(function(){g(d())}):g(d()),i.addEventListener("focusin",v,!0),i.addEventListener("mousedown",_,{capture:!0,passive:!1}),i.addEventListener("touchstart",_,{capture:!0,passive:!1}),i.addEventListener("click",x,{capture:!0,passive:!1}),i.addEventListener("keydown",T,{capture:!0,passive:!1}),a},O=function(){if(!!o.active)return i.removeEventListener("focusin",v,!0),i.removeEventListener("mousedown",_,!0),i.removeEventListener("touchstart",_,!0),i.removeEventListener("click",x,!0),i.removeEventListener("keydown",T,!0),a},A=function(I){var L=I.some(function(N){var Z=Array.from(N.removedNodes);return Z.some(function(W){return W===o.mostRecentlyFocusedNode})});L&&g(d())},$=typeof window<"u"&&"MutationObserver"in window?new MutationObserver(A):void 0,P=function(){!$||($.disconnect(),o.active&&!o.paused&&o.containers.map(function(I){$.observe(I,{subtree:!0,childList:!0})}))};return a={get active(){return o.active},get paused(){return o.paused},activate:function(I){if(o.active)return this;var L=l(I,"onActivate"),N=l(I,"onPostActivate"),Z=l(I,"checkCanFocusTrap");Z||p(),o.active=!0,o.paused=!1,o.nodeFocusedBeforeActivation=i.activeElement,L?.();var W=function(){Z&&p(),S(),P(),N?.()};return Z?(Z(o.containers.concat()).then(W,W),this):(W(),this)},deactivate:function(I){if(!o.active)return this;var L=VX({onDeactivate:n.onDeactivate,onPostDeactivate:n.onPostDeactivate,checkCanReturnFocus:n.checkCanReturnFocus},I);clearTimeout(o.delayInitialFocusTimer),o.delayInitialFocusTimer=void 0,O(),o.active=!1,o.paused=!1,P(),GX.deactivateTrap(s,a);var N=l(L,"onDeactivate"),Z=l(L,"onPostDeactivate"),W=l(L,"checkCanReturnFocus"),V=l(L,"returnFocus","returnFocusOnDeactivate");N?.();var J=function(){jX(function(){V&&g(y(o.nodeFocusedBeforeActivation)),Z?.()})};return V&&W?(W(y(o.nodeFocusedBeforeActivation)).then(J,J),this):(J(),this)},pause:function(I){if(o.paused||!o.active)return this;var L=l(I,"onPause"),N=l(I,"onPostPause");return o.paused=!0,L?.(),O(),P(),N?.(),this},unpause:function(I){if(!o.paused||!o.active)return this;var L=l(I,"onUnpause"),N=l(I,"onPostUnpause");return o.paused=!1,L?.(),p(),S(),P(),N?.(),this},updateContainerElements:function(I){var L=[].concat(I).filter(Boolean);return o.containers=L.map(function(N){return typeof N=="string"?i.querySelector(N):N}),o.active&&p(),P(),this}},a.updateContainerElements(t),a};const Xy="esri-identity-modal",Pd={base:Xy,open:`${Xy}--open`,closed:`${Xy}--closed`,title:`${Xy}__title`,dialog:`${Xy}__dialog`,content:`${Xy}__content`,closeButton:`${Xy}__close-button`,iconClose:"esri-icon-close"};let Wg=class extends Z1{constructor(e,t){super(e,t),this.container=document.createElement("div"),this.content=null,this.open=!1,this._focusTrap=null,this._close=()=>{this.open=!1},document.body.appendChild(this.container),this.addHandles(le(()=>this.open,()=>this._toggleFocusTrap()))}destroy(){this._destroyFocusTrap()}get title(){return this.messages?.auth.signIn}render(){const e=this.id,{open:t,content:r,title:i,messages:s}=this,n=t&&!!r,o={[Pd.open]:n,[Pd.closed]:!n},a=Dr("button",{class:Pd.closeButton,"aria-label":s.close,title:s.close,bind:this,onclick:this._close,type:"button"},Dr("span",{"aria-hidden":"true",class:Pd.iconClose})),l=`${e}_title`,c=`${e}_content`,u=i?Dr("h1",{id:l,class:Pd.title},i):null,d=n?Dr("div",{bind:this,class:Pd.dialog,role:"dialog","aria-labelledby":l,"aria-describedby":c,afterCreate:this._createFocusTrap},a,u,this._renderContent(c)):null;return Dr("div",{tabIndex:-1,class:this.classes(Pd.base,o)},d)}_destroyFocusTrap(){this._focusTrap?.deactivate({onDeactivate:()=>{}}),this._focusTrap=null}_toggleFocusTrap(){const{_focusTrap:e,open:t}=this;e&&(t?e.activate():e.deactivate())}_createFocusTrap(e){this._destroyFocusTrap();const t=requestAnimationFrame(()=>{this._focusTrap=_Oe(e,{initialFocus:"input",onDeactivate:this._close}),this._toggleFocusTrap()});this.addHandles(Xo(()=>cancelAnimationFrame(t)))}_renderContent(e){const t=this.content;return typeof t=="string"?Dr("div",{class:Pd.content,id:e,innerHTML:t}):q3e(t)?Dr("div",{class:Pd.content,id:e},t.render()):t instanceof HTMLElement?Dr("div",{class:Pd.content,id:e,bind:t,afterCreate:this._attachToNode}):null}_attachToNode(e){const t=this;e.appendChild(t)}};h([f({readOnly:!0})],Wg.prototype,"container",void 0),h([f()],Wg.prototype,"content",void 0),h([f()],Wg.prototype,"open",void 0),h([f(),d2("esri/t9n/common")],Wg.prototype,"messages",void 0),h([f()],Wg.prototype,"title",null),Wg=h([F("esri.identity.IdentityModal")],Wg);const WX=Wg,X5="esriJSAPIOAuth";class Q8{constructor(t,r){this.oAuthInfo=null,this.storage=null,this.appId=null,this.codeVerifier=null,this.expires=null,this.refreshToken=null,this.ssl=null,this.stateUID=null,this.token=null,this.userId=null,this.oAuthInfo=t,this.storage=r,this._init()}isValid(){let t=!1;if(this.oAuthInfo&&this.userId&&(this.refreshToken||this.token)){if(this.expires==null&&this.refreshToken)t=!0;else if(this.expires){const r=Date.now();this.expires>r&&(this.expires-r)/1e3>60*this.oAuthInfo.minTimeUntilExpiration&&(t=!0)}}return t}save(){if(!this.storage)return!1;const t=this._load(),r=this.oAuthInfo;if(r&&r.authNamespace&&r.portalUrl){let i=t[r.authNamespace];i||(i=t[r.authNamespace]={}),this.appId||(this.appId=r.appId),i[r.portalUrl]={appId:this.appId,codeVerifier:this.codeVerifier,expires:this.expires,refreshToken:this.refreshToken,ssl:this.ssl,stateUID:this.stateUID,token:this.token,userId:this.userId};try{this.storage.setItem(X5,JSON.stringify(t))}catch(s){return console.warn(s),!1}return!0}return!1}destroy(){const t=this._load(),r=this.oAuthInfo;if(r&&r.appId&&r.portalUrl&&(this.expires==null||this.expires>Date.now())&&(this.refreshToken||this.token)){const i=r.portalUrl.replace(/^http:/i,"https:")+"/sharing/rest/oauth2/revokeToken",s=new FormData;if(s.append("f","json"),s.append("auth_token",this.refreshToken||this.token),s.append("client_id",r.appId),s.append("token_type_hint",this.refreshToken?"refresh_token":"access_token"),typeof navigator.sendBeacon=="function")navigator.sendBeacon(i,s);else{const n=new XMLHttpRequest;n.open("POST",i),n.send(s)}}if(r&&r.authNamespace&&r.portalUrl&&this.storage){const i=t[r.authNamespace];if(i){delete i[r.portalUrl];try{this.storage.setItem(X5,JSON.stringify(t))}catch(s){console.log(s)}}}r&&(r._oAuthCred=null,this.oAuthInfo=null)}_init(){const t=this._load(),r=this.oAuthInfo;if(r&&r.authNamespace&&r.portalUrl){let i=t[r.authNamespace];i&&(i=i[r.portalUrl],i&&(this.appId=i.appId,this.codeVerifier=i.codeVerifier,this.expires=i.expires,this.refreshToken=i.refreshToken,this.ssl=i.ssl,this.stateUID=i.stateUID,this.token=i.token,this.userId=i.userId))}}_load(){let t={};if(this.storage){const r=this.storage.getItem(X5);if(r)try{t=JSON.parse(r)}catch(i){console.warn(i)}}return t}}Q8.prototype.declaredClass="esri.identity.OAuthCredential";class A7{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const r=new A7;return this._values.forEach((i,s)=>{t&&t.has(s)||r.set(s,ye(i.value),i.origin)}),r}get(t,r){r=this._normalizeOrigin(r);const i=this._values.get(t);return r==null||i?.origin===r?i?.value:void 0}originOf(t){return this._values.get(t)?.origin??mr.USER}keys(t){t=this._normalizeOrigin(t);const r=[...this._values.keys()];return t==null?r:r.filter(i=>this._values.get(i)?.origin===t)}set(t,r,i){if((i=this._normalizeOrigin(i))===mr.DEFAULTS){const s=this._values.get(t);if(s&&s.origin!=null&&s.origin>i)return}this._values.set(t,new vOe(r,i))}delete(t,r){(r=this._normalizeOrigin(r))!=null&&this._values.get(t)?.origin!==r||this._values.delete(t)}has(t,r){return(r=this._normalizeOrigin(r))!=null?this._values.get(t)?.origin===r:this._values.has(t)}forEach(t){this._values.forEach(({value:r},i)=>t(r,i))}_normalizeOrigin(t){if(t!=null)return t===mr.DEFAULTS?t:mr.USER}}class vOe{constructor(t,r){this.value=t,this.origin=r}}function bce(e,t,r){t.keys().forEach(s=>{r.set(s,t.get(s),mr.DEFAULTS)});const i=e.metadatas;Object.keys(i).forEach(s=>{e.internalGet(s)&&r.set(s,e.internalGet(s),mr.DEFAULTS)})}function bOe(e,t,r){if(!e||!e.read||e.read.enabled===!1||!e.read.source)return!1;const i=e.read.source;if(typeof i=="string"){if(i===t||i.includes(".")&&i.indexOf(t)===0&&pq(i,r))return!0}else for(const s of i)if(s===t||s.includes(".")&&s.indexOf(t)===0&&pq(s,r))return!0;return!1}function wOe(e){return e&&(!e.read||e.read.enabled!==!1&&!e.read.source)}function xOe(e,t,r,i,s){let n=D8(t[r],s);wOe(n)&&(e[r]=!0);for(const o of Object.getOwnPropertyNames(t))n=D8(t[o],s),bOe(n,r,i)&&(e[o]=!0)}function TOe(e,t,r,i){const s=r.metadatas,n=QTe(s[t],i),o=n?.default;if(o===void 0)return;const a=typeof o=="function"?o.call(e,t,i):o;a!==void 0&&r.set(t,a)}const wce={origin:"service"};function xce(e,t,r=wce){if(!t||typeof t!="object")return;const i=Lc(e),s=i.metadatas,n={};for(const o of Object.getOwnPropertyNames(t))xOe(n,s,o,t,r);i.setDefaultOrigin(r.origin);for(const o of Object.getOwnPropertyNames(n)){const a=D8(s[o],r).read,l=a&&a.source;let c;c=l&&typeof l=="string"?x3(t,l):t[o],a&&a.reader&&(c=a.reader.call(e,c,t,r)),c!==void 0&&i.set(o,c)}if(!r||!r.ignoreDefaults){i.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||TOe(e,o,i,r)}i.setDefaultOrigin("user")}function Tce(e,t,r,i=wce){const s={...i,messages:[]};r(s),s.messages?.forEach(n=>{n.type!=="warning"||e.loaded?i&&i.messages&&i.messages.push(n):e.loadWarnings.push(n)})}function SOe(e,t,r,i,s){const n={};return t.write?.writer?.call(e,i,n,r,s),n}function Sce(e,t,r,i,s,n){if(!i||!i.write)return!1;const o=e.get(r);if(!s&&i.write.overridePolicy){const a=i.write.overridePolicy.call(e,o,r,n??void 0);a!==void 0&&(s=a)}if(s||(s=i.write),!s||s.enabled===!1)return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new G("web-document-write:property-required",`Missing value for required property '${r}' on '${e.declaredClass}'`,{propertyName:r,target:e});return a&&n&&n.messages?n.messages.push(a):a&&!n&&K.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||!s.alwaysWriteDefaults&&(!t.store.multipleOriginsSupported||t.store.originOf(r)===mr.DEFAULTS)&&EOe(e,r,n,i,o)||!s.ignoreOrigin&&n&&n.origin&&t.store.multipleOriginsSupported&&t.store.originOf(r)<F0(n.origin))}function EOe(e,t,r,i,s){const n=i.default;if(n===void 0)return!1;if(i.defaultEquals!=null)return i.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(e,t,r??void 0);return Om(o,s)}return!1}return n===s}function COe(e,t,r,i){const s=Lc(e),n=s.metadatas,o=Joe(n[t],i);return!!o&&Sce(e,s,t,o,r,i)}function Ece(e,t,r){if(e&&typeof e.toJSON=="function"&&(!e.toJSON.isDefaultToJSON||!e.write))return dM(t,e.toJSON(r));const i=Lc(e),s=i.metadatas;for(const n in s){const o=Joe(s[n],r);if(!Sce(e,i,n,o,void 0,r))continue;const a=e.get(n),l=SOe(e,o,o.write&&typeof o.write.target=="string"?o.write.target:n,a,r);Object.keys(l).length>0&&(t=dM(t,l),r?.resources?.pendingOperations?.length&&r.resources.pendingOperations.push(Promise.all(r.resources.pendingOperations).then(()=>dM(t,l,()=>"replace-arrays"))),r&&r.writtenProperties&&r.writtenProperties.push({target:e,propName:n,oldOrigin:MTe(i.store.originOf(n)),newOrigin:r.origin}))}return t}const M3=e=>{let t=class extends e{constructor(...r){super(...r);const i=Lc(this),s=i.store,n=new A7;i.store=n,bce(i,s,n)}read(r,i){xce(this,r,i)}write(r,i){return Ece(this,r??{},i)}toJSON(r){return this.write({},r)}static fromJSON(r,i){return AOe.call(this,r,i)}};return t=h([F("esri.core.JSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function AOe(e,t){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const r=new this;return r.read(e,t),r}let Pe=class extends M3(xe){};Pe=h([F("esri.core.JSONSupport")],Pe);var e9;let Mo=e9=class extends Pe{constructor(e){super(e),this._oAuthCred=null,this.appId=null,this.authNamespace="/",this.expiration=20160,this.flowType="auto",this.forceLogin=!1,this.forceUserId=!1,this.locale=null,this.minTimeUntilExpiration=30,this.popup=!1,this.popupCallbackUrl="oauth-callback.html",this.popupWindowFeatures="height=490,width=800,resizable,scrollbars,status",this.portalUrl="https://www.arcgis.com",this.preserveUrlHash=!1,this.userId=null}clone(){return e9.fromJSON(this.toJSON())}};h([f({json:{write:!0}})],Mo.prototype,"appId",void 0),h([f({json:{write:!0}})],Mo.prototype,"authNamespace",void 0),h([f({json:{write:!0}})],Mo.prototype,"expiration",void 0),h([f({json:{write:!0}})],Mo.prototype,"flowType",void 0),h([f({json:{write:!0}})],Mo.prototype,"forceLogin",void 0),h([f({json:{write:!0}})],Mo.prototype,"forceUserId",void 0),h([f({json:{write:!0}})],Mo.prototype,"locale",void 0),h([f({json:{write:!0}})],Mo.prototype,"minTimeUntilExpiration",void 0),h([f({json:{write:!0}})],Mo.prototype,"popup",void 0),h([f({json:{write:!0}})],Mo.prototype,"popupCallbackUrl",void 0),h([f({json:{write:!0}})],Mo.prototype,"popupWindowFeatures",void 0),h([f({json:{write:!0}})],Mo.prototype,"portalUrl",void 0),h([f({json:{write:!0}})],Mo.prototype,"preserveUrlHash",void 0),h([f({json:{write:!0}})],Mo.prototype,"userId",void 0),Mo=e9=h([F("esri.identity.OAuthInfo")],Mo);const t9=Mo;let rc=class extends Pe{constructor(e){super(e),this.adminTokenServiceUrl=null,this.currentVersion=null,this.hasPortal=null,this.hasServer=null,this.owningSystemUrl=null,this.owningTenant=null,this.server=null,this.shortLivedTokenValidity=null,this.tokenServiceUrl=null,this.webTierAuth=null}};h([f({json:{write:!0}})],rc.prototype,"adminTokenServiceUrl",void 0),h([f({json:{write:!0}})],rc.prototype,"currentVersion",void 0),h([f({json:{write:!0}})],rc.prototype,"hasPortal",void 0),h([f({json:{write:!0}})],rc.prototype,"hasServer",void 0),h([f({json:{write:!0}})],rc.prototype,"owningSystemUrl",void 0),h([f({json:{write:!0}})],rc.prototype,"owningTenant",void 0),h([f({json:{write:!0}})],rc.prototype,"server",void 0),h([f({json:{write:!0}})],rc.prototype,"shortLivedTokenValidity",void 0),h([f({json:{write:!0}})],rc.prototype,"tokenServiceUrl",void 0),h([f({json:{write:!0}})],rc.prototype,"webTierAuth",void 0),rc=h([F("esri.identity.ServerInfo")],rc);const Z5=rc,wM={},Cce=e=>{const t=new vc(e.owningSystemUrl).host,r=new vc(e.server).host,i=/.+\.arcgis\.com$/i;return i.test(t)&&i.test(r)},r9=(e,t)=>!!(Cce(e)&&t&&t.some(r=>r.test(e.server)));let xM=null,TM=null;try{xM=window.localStorage,TM=window.sessionStorage}catch{}class Ace extends cs{constructor(){super(),this._portalConfig=globalThis.esriGeowConfig,this.serverInfos=[],this.oAuthInfos=[],this.credentials=[],this._soReqs=[],this._xoReqs=[],this._portals=[],this._defaultOAuthInfo=null,this._defaultTokenValidity=60,this.dialog=null,this.formConstructor=k3e,this.tokenValidity=null,this.normalizeWebTierAuth=!1,this._appOrigin=window.origin!=="null"?window.origin:window.location.origin,this._appUrlObj=Us(window.location.href),this._busy=null,this._rejectOnPersistedPageShow=!1,this._oAuthLocationParams=null,this._gwTokenUrl="/sharing/rest/generateToken",this._agsRest="/rest/services",this._agsPortal=/\/sharing(\/|$)/i,this._agsAdmin=/(https?:\/\/[^\/]+\/[^\/]+)\/admin\/?(\/.*)?$/i,this._adminSvcs=/\/rest\/admin\/services(\/|$)/i,this._gwDomains=[{regex:/^https?:\/\/www\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:dev|[a-z\d-]+\.mapsdev)\.arcgis\.com/i,customBaseUrl:"mapsdev.arcgis.com",tokenServiceUrl:"https://dev.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:devext|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,customBaseUrl:"mapsdevext.arcgis.com",tokenServiceUrl:"https://devext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:qaext|[a-z\d-]+\.mapsqa)\.arcgis\.com/i,customBaseUrl:"mapsqa.arcgis.com",tokenServiceUrl:"https://qaext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/[a-z\d-]+\.maps\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"}],this._legacyFed=[],this._regexSDirUrl=/http.+\/rest\/services\/?/gi,this._regexServerType=/(\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|KnowledgeGraphServer|MapServer|MissionServer|MobileServer|NAServer|NetworkDiagramServer|OGCFeatureServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer|VideoServer)).*/gi,this._gwUser=/http.+\/users\/([^\/]+)\/?.*/i,this._gwItem=/http.+\/items\/([^\/]+)\/?.*/i,this._gwGroup=/http.+\/groups\/([^\/]+)\/?.*/i,this._rePortalTokenSvc=/\/sharing(\/rest)?\/generatetoken/i,this._createDefaultOAuthInfo=!0,this._hasTestedIfAppIsOnPortal=!1,this._getOAuthLocationParams(),window.addEventListener("pageshow",t=>{this._pageShowHandler(t)})}registerServers(t){const r=this.serverInfos;r?(t=t.filter(i=>!this.findServerInfo(i.server)),this.serverInfos=r.concat(t)):this.serverInfos=t,t.forEach(i=>{i.owningSystemUrl&&this._portals.push(i.owningSystemUrl),i.hasPortal&&this._portals.push(i.server)})}registerOAuthInfos(t){const r=this.oAuthInfos;if(r){for(const i of t){const s=this.findOAuthInfo(i.portalUrl);s&&r.splice(r.indexOf(s),1)}this.oAuthInfos=r.concat(t)}else this.oAuthInfos=t}registerToken(t){t={...t};const r=this._sanitizeUrl(t.server),i=this._isServerRsrc(r);let s,n=this.findServerInfo(r),o=!0;n||(n=new Z5,n.server=this._getServerInstanceRoot(r),i?n.hasServer=!0:(n.tokenServiceUrl=this._getTokenSvcUrl(r),n.hasPortal=!0),this.registerServers([n])),s=this._findCredential(r),s?(delete t.server,Object.assign(s,t),o=!1):(s=new fs({userId:t.userId,server:n.server,token:t.token,expires:t.expires,ssl:t.ssl,scope:i?"server":"portal"}),s.resources=[r],this.credentials.push(s)),s.emitTokenChange(!1),o||s.refreshServerTokens()}toJSON(){return PD({serverInfos:this.serverInfos.map(t=>t.toJSON()),oAuthInfos:this.oAuthInfos.map(t=>t.toJSON()),credentials:this.credentials.map(t=>t.toJSON())})}initialize(t){if(!t)return;typeof t=="string"&&(t=JSON.parse(t));const r=t.serverInfos,i=t.oAuthInfos,s=t.credentials;if(r){const n=[];r.forEach(o=>{o.server&&o.tokenServiceUrl&&n.push(o.declaredClass?o:new Z5(o))}),n.length&&this.registerServers(n)}if(i){const n=[];i.forEach(o=>{o.appId&&n.push(o.declaredClass?o:new t9(o))}),n.length&&this.registerOAuthInfos(n)}s&&s.forEach(n=>{n.server&&n.token&&n.expires&&n.expires>Date.now()&&((n=n.declaredClass?n:new fs(n)).emitTokenChange(),this.credentials.push(n))})}findServerInfo(t){let r;t=this._sanitizeUrl(t);for(const i of this.serverInfos)if(this._hasSameServerInstance(i.server,t)){r=i;break}return r}findOAuthInfo(t){let r;t=this._sanitizeUrl(t);for(const i of this.oAuthInfos)if(this._hasSameServerInstance(i.portalUrl,t)){r=i;break}return r}findCredential(t,r){if(!t)return;let i;t=this._sanitizeUrl(t);const s=this._isServerRsrc(t)?"server":"portal";if(r){for(const n of this.credentials)if(this._hasSameServerInstance(n.server,t)&&r===n.userId&&n.scope===s){i=n;break}}else for(const n of this.credentials)if(this._hasSameServerInstance(n.server,t)&&this._getIdenticalSvcIdx(t,n)!==-1&&n.scope===s){i=n;break}return i}getCredential(t,r){let i,s,n=!0;r&&(i=!!r.token,s=r.error,n=r.prompt!==!1),r={...r},t=this._sanitizeUrl(t);const o=new AbortController,a=Ys();if(r.signal&&Ws(r.signal,()=>{o.abort()}),Ws(o,()=>{a.reject(new G("identity-manager:user-aborted","ABORTED"))}),Hs(o))return a.promise;r.signal=o.signal;const l=this._isAdminResource(t),c=i?this.findCredential(t):null;let u;if(c&&s&&s.details&&s.details.httpStatus===498)c.destroy();else if(c)return u=new G("identity-manager:not-authorized","You are currently signed in as: '"+c.userId+"'. You do not have access to this resource: "+t,{error:s}),a.reject(u),a.promise;const d=this._findCredential(t,r);if(d)return a.resolve(d),a.promise;let p=this.findServerInfo(t);if(p)!p.hasServer&&this._isServerRsrc(t)&&(p._restInfoPms=this._getTokenSvcUrl(t),p.hasServer=!0);else{const g=this._getTokenSvcUrl(t);if(!g)return u=new G("identity-manager:unknown-resource","Unknown resource - could not find token service endpoint."),a.reject(u),a.promise;p=new Z5,p.server=this._getServerInstanceRoot(t),typeof g=="string"?(p.tokenServiceUrl=g,p.hasPortal=!0):(p._restInfoPms=g,p.hasServer=!0),this.registerServers([p])}return p.hasPortal&&p._selfReq===void 0&&(n||wl(p.tokenServiceUrl,this._appOrigin)||this._gwDomains.some(g=>g.tokenServiceUrl===p.tokenServiceUrl))&&(p._selfReq={owningTenant:r&&r.owningTenant,selfDfd:this._getPortalSelf(p.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),t)}),this._enqueue(t,p,r,a,l)}getResourceName(t){return this._isRESTService(t)?t.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(t)&&t.replace(this._gwUser,"$1")||this._gwItem.test(t)&&t.replace(this._gwItem,"$1")||this._gwGroup.test(t)&&t.replace(this._gwGroup,"$1")||""}generateToken(t,r,i){const s=this._rePortalTokenSvc.test(t.tokenServiceUrl),n=new vc(this._appOrigin),o=t.shortLivedTokenValidity;let a,l,c,u,d,p,g,y;r&&(y=this.tokenValidity||o||this._defaultTokenValidity,y>o&&o>0&&(y=o)),i&&(a=i.isAdmin,l=i.serverUrl,c=i.token,p=i.signal,g=i.ssl,t.customParameters=i.customParameters),a?u=t.adminTokenServiceUrl:(u=t.tokenServiceUrl,d=new vc(u.toLowerCase()),t.webTierAuth&&i?.serverUrl&&!g&&n.scheme==="http"&&(wl(n.uri,u,!0)||d.scheme==="https"&&n.host===d.host&&n.port==="7080"&&d.port==="7443")&&(u=u.replace(/^https:/i,"http:").replace(/:7443/i,":7080")));const _={query:{request:"getToken",username:r?.username,password:r?.password,serverUrl:l,token:c,expiration:y,referer:a||s?this._appOrigin:null,client:a?"referer":null,f:"json",...t.customParameters},method:"post",authMode:"anonymous",useProxy:this._useProxy(t,i),signal:p,...i?.ioArgs};return s||(_.withCredentials=!1),ii(u,_).then(v=>{const w=v.data;if(!w||!w.token)return new G("identity-manager:authentication-failed","Unable to generate token");const T=t.server;return wM[T]||(wM[T]={}),r&&(wM[T][r.username]=r.password),w.validity=y,w})}isBusy(){return!!this._busy}checkSignInStatus(t){return this.checkAppAccess(t,"").then(r=>r.credential)}checkAppAccess(t,r,i){let s=!1;return this.getCredential(t,{prompt:!1}).then(n=>{let o;const a={f:"json"};if(n.scope==="portal")if(r&&(this._doPortalSignIn(t)||i&&i.force))o=n.server+"/sharing/rest/oauth2/validateAppAccess",a.client_id=r;else{if(!n.token)return{credential:n};o=n.server+"/sharing/rest"}else{if(!n.token)return{credential:n};o=n.server+"/rest/services"}return n.token&&(a.token=n.token),ii(o,{query:a,authMode:"anonymous"}).then(l=>{if(l.data.valid===!1)throw new G("identity-manager:not-authorized",`You are currently signed in as: '${n.userId}'.`,l.data);return s=!!l.data.viewOnlyUserTypeApp,{credential:n}}).catch(l=>{if(l.name==="identity-manager:not-authorized")throw l;const c=l.details&&l.details.httpStatus;if(c===498)throw n.destroy(),new G("identity-manager:not-authenticated","User is not signed in.");if(c===400)throw new G("identity-manager:invalid-request");return{credential:n}})}).then(n=>({credential:n.credential,viewOnly:s}))}setOAuthResponseHash(t){t&&(t.charAt(0)==="#"&&(t=t.substring(1)),this._processOAuthPopupParams(Cv(t)))}setOAuthRedirectionHandler(t){this._oAuthRedirectFunc=t}setProtocolErrorHandler(t){this._protocolFunc=t}signIn(t,r,i={}){const s=Ys(),n=()=>{l?.remove(),c?.remove(),u?.remove(),a?.destroy(),this.dialog?.destroy(),this.dialog=a=l=c=u=null},o=()=>{n(),this._oAuthDfd=null,s.reject(new G("identity-manager:user-aborted","ABORTED"))};i.signal&&Ws(i.signal,()=>{o()});let a=new this.formConstructor;a.resource=this.getResourceName(t),a.server=r.server,this.dialog=new WX,this.dialog.content=a,this.dialog.open=!0,this.emit("dialog-create");let l=a.on("cancel",o),c=le(()=>this.dialog.open,o),u=a.on("submit",d=>{this.generateToken(r,d,{isAdmin:i.isAdmin,signal:i.signal}).then(p=>{n();const g=new fs({userId:d.username,server:r.server,token:p.token,expires:p.expires!=null?Number(p.expires):null,ssl:!!p.ssl,isAdmin:i.isAdmin,validity:p.validity});s.resolve(g)}).catch(p=>{a.error=p,a.signingIn=!1})});return s.promise}oAuthSignIn(t,r,i,s){this._oAuthDfd=Ys();const n=this._oAuthDfd;let o;s?.signal&&Ws(s.signal,()=>{const y=this._oAuthDfd&&this._oAuthDfd.oAuthWin_;y&&!y.closed?y.close():this.dialog&&p()}),n.resUrl_=t,n.sinfo_=r,n.oinfo_=i;const a=i._oAuthCred;if(a.storage&&(i.flowType==="authorization-code"||i.flowType==="auto"&&!i.popup&&r.currentVersion>=8.4)){let y=crypto.getRandomValues(new Uint8Array(32));o=$5(y),a.codeVerifier=o,y=crypto.getRandomValues(new Uint8Array(32)),a.stateUID=$5(y),a.save()||(a.codeVerifier=o=null)}else a.codeVerifier=null;let l,c,u,d;this._getCodeChallenge(o).then(y=>{const _=!s||s.oAuthPopupConfirmation!==!1;i.popup&&_?(l=new this.formConstructor,l.oAuthPrompt=!0,l.server=r.server,this.dialog=new WX,this.dialog.content=l,this.dialog.open=!0,this.emit("dialog-create"),c=l.on("cancel",p),u=le(()=>this.dialog.open,p),d=l.on("submit",()=>{g(),this._doOAuthSignIn(t,r,i,y)})):this._doOAuthSignIn(t,r,i,y)});const p=()=>{g(),this._oAuthDfd=null,n.reject(new G("identity-manager:user-aborted","ABORTED"))},g=()=>{c?.remove(),u?.remove(),d?.remove(),l?.destroy(),this.dialog?.destroy(),this.dialog=null};return n.promise}destroyCredentials(){this.credentials&&this.credentials.slice().forEach(t=>{t.destroy()}),this.emit("credentials-destroy")}enablePostMessageAuth(t="https://www.arcgis.com/sharing/rest"){this._postMessageAuthHandle&&this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=ey(window,"message",r=>{if((r.origin===this._appOrigin||r.origin.endsWith(".arcgis.com"))&&r.data?.type==="arcgis:auth:requestCredential"){const i=r.source;this.getCredential(t).then(s=>{i.postMessage({type:"arcgis:auth:credential",credential:{expires:s.expires,server:s.server,ssl:s.ssl,token:s.token,userId:s.userId}},r.origin)}).catch(s=>{i.postMessage({type:"arcgis:auth:error",error:{name:s.name,message:s.message}},r.origin)})}})}disablePostMessageAuth(){this._postMessageAuthHandle&&(this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=null)}_getOAuthLocationParams(){let t=window.location.hash;if(t){t.charAt(0)==="#"&&(t=t.substring(1));const i=Cv(t);let s=!1;if(i.access_token&&i.expires_in&&i.state&&i.hasOwnProperty("username"))try{i.state=JSON.parse(i.state),i.state.portalUrl&&(this._oAuthLocationParams=i,s=!0)}catch{}else if(i.error&&i.error_description&&(console.log("IdentityManager OAuth Error: ",i.error," - ",i.error_description),i.error==="access_denied"&&(s=!0,i.state)))try{i.state=JSON.parse(i.state)}catch{}s&&(window.location.hash=i.state?.hash||"")}let r=window.location.search;if(r){r.charAt(0)==="?"&&(r=r.substring(1));const i=Cv(r);let s=!1;if(i.code&&i.state)try{i.state=JSON.parse(i.state),i.state.portalUrl&&i.state.uid&&(this._oAuthLocationParams=i,s=!0)}catch{}else if(i.error&&i.error_description&&(console.log("IdentityManager OAuth Error: ",i.error," - ",i.error_description),i.error==="access_denied"&&(s=!0,i.state)))try{i.state=JSON.parse(i.state)}catch{}if(s){const n={...i};["code","error","error_description","message_code","persist","state"].forEach(l=>{delete n[l]});const o=s1(n),a=window.location.pathname+(o?`?${o}`:"")+(i.state?.hash||"");window.history.replaceState(window.history.state,"",a)}}}_getOAuthToken(t,r,i,s,n){return t=t.replace(/^http:/i,"https:"),ii(`${t}/sharing/rest/oauth2/token`,{authMode:"anonymous",method:"post",query:s&&n?{grant_type:"authorization_code",code:r,redirect_uri:s,client_id:i,code_verifier:n}:{grant_type:"refresh_token",refresh_token:r,client_id:i}}).then(o=>o.data)}_getCodeChallenge(t){if(t&&globalThis.isSecureContext){const r=new TextEncoder().encode(t);return crypto.subtle.digest("SHA-256",r).then(i=>$5(new Uint8Array(i)))}return Promise.resolve(null)}_pageShowHandler(t){if(t.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow){const r=new G("identity-manager:user-aborted","ABORTED");this._errbackFunc(r)}}_findCredential(t,r){let i,s,n,o,a=-1;const l=r&&r.token,c=r&&r.resource,u=this._isServerRsrc(t)?"server":"portal",d=this.credentials.filter(p=>this._hasSameServerInstance(p.server,t)&&p.scope===u);if(t=c||t,d.length)if(d.length===1){if(i=d[0],n=this.findServerInfo(i.server),s=n&&n.owningSystemUrl,o=s?this.findCredential(s,i.userId):void 0,a=this._getIdenticalSvcIdx(t,i),!l)return a===-1&&i.resources.push(t),this._addResource(t,o),i;a!==-1&&(i.resources.splice(a,1),this._removeResource(t,o))}else{let p,g;if(d.some(y=>(g=this._getIdenticalSvcIdx(t,y),g!==-1&&(p=y,n=this.findServerInfo(p.server),s=n&&n.owningSystemUrl,o=s?this.findCredential(s,p.userId):void 0,a=g,!0))),l)p&&(p.resources.splice(a,1),this._removeResource(t,o));else if(p)return this._addResource(t,o),p}}_findOAuthInfo(t){let r=this.findOAuthInfo(t);if(!r){for(const i of this.oAuthInfos)if(this._isIdProvider(i.portalUrl,t)){r=i;break}}return r}_addResource(t,r){r&&this._getIdenticalSvcIdx(t,r)===-1&&r.resources.push(t)}_removeResource(t,r){let i=-1;r&&(i=this._getIdenticalSvcIdx(t,r),i>-1&&r.resources.splice(i,1))}_useProxy(t,r){return r&&r.isAdmin&&!wl(t.adminTokenServiceUrl,this._appOrigin)||!this._isPortalDomain(t.tokenServiceUrl)&&String(t.currentVersion)==="10.1"&&!wl(t.tokenServiceUrl,this._appOrigin)}_getOrigin(t){const r=new vc(t);return r.scheme+"://"+r.host+(r.port!=null?":"+r.port:"")}_getServerInstanceRoot(t){const r=t.toLowerCase();let i=r.indexOf(this._agsRest);return i===-1&&this._isAdminResource(t)&&(i=this._agsAdmin.test(t)?t.replace(this._agsAdmin,"$1").length:t.search(this._adminSvcs)),i!==-1||Toe(r)||(i=r.indexOf("/sharing")),i===-1&&r.substr(-1)==="/"&&(i=r.length-1),i>-1?t.substring(0,i):t}_hasSameServerInstance(t,r){return t.substr(-1)==="/"&&(t=t.slice(0,-1)),t=t.toLowerCase(),r=this._getServerInstanceRoot(r).toLowerCase(),t=this._normalizeAGOLorgDomain(t),r=this._normalizeAGOLorgDomain(r),(t=t.substr(t.indexOf(":")))===(r=r.substr(r.indexOf(":")))}_normalizeAGOLorgDomain(t){const r=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,i=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,s=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;return r.test(t)?t=t.replace(r,"https://www.arcgis.com"):i.test(t)?t=t.replace(i,"https://devext.arcgis.com"):s.test(t)&&(t=t.replace(s,"https://qaext.arcgis.com")),t}_sanitizeUrl(t){const r=(Or.request.proxyUrl||"").toLowerCase(),i=r?t.toLowerCase().indexOf(r+"?"):-1;return i!==-1&&(t=t.substring(i+r.length+1)),t=ld(t),Us(t).path}_isRESTService(t){return t.includes(this._agsRest)}_isAdminResource(t){return this._agsAdmin.test(t)||this._adminSvcs.test(t)}_isServerRsrc(t){return this._isRESTService(t)||this._isAdminResource(t)}_isIdenticalService(t,r){let i=!1;if(this._isRESTService(t)&&this._isRESTService(r)){const s=this._getSuffix(t).toLowerCase(),n=this._getSuffix(r).toLowerCase();if(i=s===n,!i){const o=/(.*)\/(MapServer|FeatureServer|UtilityNetworkServer).*/gi;i=s.replaceAll(o,"$1")===n.replaceAll(o,"$1")}}else this._isAdminResource(t)&&this._isAdminResource(r)?i=!0:this._isServerRsrc(t)||this._isServerRsrc(r)||!this._isPortalDomain(t)||(i=!0);return i}_isPortalDomain(t){const r=new vc(t.toLowerCase()),i=this._portalConfig;let s=this._gwDomains.some(n=>n.regex.test(r.uri));return!s&&i&&(s=this._hasSameServerInstance(this._getServerInstanceRoot(i.restBaseUrl),r.uri)),s||Or.portalUrl&&(s=wl(r,Or.portalUrl,!0)),s||(s=this._portals.some(n=>this._hasSameServerInstance(n,r.uri))),s=s||this._agsPortal.test(r.path),s}_isIdProvider(t,r){let i=-1,s=-1;this._gwDomains.forEach((o,a)=>{i===-1&&o.regex.test(t)&&(i=a),s===-1&&o.regex.test(r)&&(s=a)});let n=!1;if(i>-1&&s>-1&&(i===0||i===4?s!==0&&s!==4||(n=!0):i===1?s!==1&&s!==2||(n=!0):i===2?s===2&&(n=!0):i===3&&s===3&&(n=!0)),!n){const o=this.findServerInfo(r),a=o&&o.owningSystemUrl;a&&Cce(o)&&this._isPortalDomain(a)&&this._isIdProvider(t,a)&&(n=!0)}return n}_getIdenticalSvcIdx(t,r){let i=-1;for(let s=0;s<r.resources.length;s++){const n=r.resources[s];if(this._isIdenticalService(t,n)){i=s;break}}return i}_getSuffix(t){return t.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")}_getTokenSvcUrl(t){let r,i,s;if(this._isRESTService(t)||this._isAdminResource(t)){const n=this._getServerInstanceRoot(t);return r=n+"/admin/generateToken",i=ii(t=n+"/rest/info",{query:{f:"json"}}).then(o=>o.data),{adminUrl:r,promise:i}}if(this._isPortalDomain(t)){let n="";if(this._gwDomains.some(o=>(o.regex.test(t)&&(n=o.tokenServiceUrl),!!n)),n||this._portals.some(o=>(this._hasSameServerInstance(o,t)&&(n=o+this._gwTokenUrl),!!n)),n||(s=t.toLowerCase().indexOf("/sharing"),s!==-1&&(n=t.substring(0,s)+this._gwTokenUrl)),n||(n=this._getOrigin(t)+this._gwTokenUrl),n){const o=new vc(t).port;/^http:\/\//i.test(t)&&o==="7080"&&(n=n.replace(/:7080/i,":7443")),n=n.replace(/http:/i,"https:")}return n}if(t.toLowerCase().includes("premium.arcgisonline.com"))return"https://premium.arcgisonline.com/server/tokens"}_processOAuthResponseParams(t,r,i){const s=r._oAuthCred;if(t.code){const o=s.codeVerifier;return s.codeVerifier=null,s.stateUID=null,s.save(),this._getOAuthToken(i.server,t.code,r.appId,this._getRedirectURI(r,!0),o).then(a=>{const l=new fs({userId:a.username,server:i.server,token:a.access_token,expires:Date.now()+1e3*a.expires_in,ssl:a.ssl,oAuthState:t.state,_oAuthCred:s});return r.userId=l.userId,s.storage=a.persist?xM:TM,s.refreshToken=a.refresh_token,s.token=null,s.expires=a.refresh_token_expires_in?Date.now()+1e3*a.refresh_token_expires_in:null,s.userId=l.userId,s.ssl=l.ssl,s.save(),l})}const n=new fs({userId:t.username,server:i.server,token:t.access_token,expires:Date.now()+1e3*Number(t.expires_in),ssl:t.ssl==="true",oAuthState:t.state,_oAuthCred:s});return r.userId=n.userId,s.storage=t.persist?xM:TM,s.refreshToken=null,s.token=n.token,s.expires=n.expires,s.userId=n.userId,s.ssl=n.ssl,s.save(),Promise.resolve(n)}_processOAuthPopupParams(t){const r=this._oAuthDfd;if(this._oAuthDfd=null,r)if(clearInterval(this._oAuthIntervalId),this._oAuthOnPopupHandle?.remove(),t.error){const i=t.error==="access_denied",s=new G(i?"identity-manager:user-aborted":"identity-manager:authentication-failed",i?"ABORTED":"OAuth: "+t.error+" - "+t.error_description);r.reject(s)}else this._processOAuthResponseParams(t,r.oinfo_,r.sinfo_).then(i=>{r.resolve(i)}).catch(i=>{r.reject(i)})}_setOAuthResponseQueryString(t){t&&(t.charAt(0)==="?"&&(t=t.substring(1)),this._processOAuthPopupParams(Cv(t)))}_exchangeToken(t,r,i){return ii(`${t}/sharing/rest/oauth2/exchangeToken`,{authMode:"anonymous",method:"post",query:{f:"json",client_id:r,token:i}}).then(s=>s.data.token)}_getPlatformSelf(t,r){return t=t.replace(/^http:/i,"https:"),ii(`${t}/sharing/rest/oauth2/platformSelf`,{authMode:"anonymous",headers:{"X-Esri-Auth-Client-Id":r,"X-Esri-Auth-Redirect-Uri":window.location.href.replace(/#.*$/,"")},method:"post",query:{f:"json",expiration:30},withCredentials:!0}).then(i=>i.data)}_getPortalSelf(t,r){let i;return this._gwDomains.some(s=>(s.regex.test(t)&&(i=s.customBaseUrl),!!i)),i?Promise.resolve({allSSL:!0,currentVersion:"8.4",customBaseUrl:i,portalMode:"multitenant",supportsOAuth:!0}):(this._appOrigin.startsWith("https:")?t=t.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(r)&&(t=t.replace(/^https:/i,"http:").replace(/:7443/i,":7080")),ii(t,{query:{f:"json"},authMode:"anonymous",withCredentials:!0}).then(s=>s.data))}_doPortalSignIn(t){const r=this._portalConfig,i=window.location.href,s=this.findServerInfo(t);return!(!r&&!this._isPortalDomain(i)||!(s?s.hasPortal||s.owningSystemUrl&&this._isPortalDomain(s.owningSystemUrl):this._isPortalDomain(t))||!(this._isIdProvider(i,t)||r&&(this._hasSameServerInstance(this._getServerInstanceRoot(r.restBaseUrl),t)||this._isIdProvider(r.restBaseUrl,t))||wl(i,t,!0)))}_checkProtocol(t,r,i,s){let n=!0;const o=s?r.adminTokenServiceUrl:r.tokenServiceUrl;return o.trim().toLowerCase().startsWith("https:")&&!this._appOrigin.startsWith("https:")&&T3(o)&&(n=!!this._protocolFunc&&!!this._protocolFunc({resourceUrl:t,serverInfo:r}),!n)&&i(new G("identity-manager:aborted","Aborted the Sign-In process to avoid sending password over insecure connection.")),n}_enqueue(t,r,i,s,n,o){return s||(s=Ys()),s.resUrl_=t,s.sinfo_=r,s.options_=i,s.admin_=n,s.refresh_=o,this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(t),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(s)):this._xoReqs.push(s):this._doSignIn(s),s.promise}_doSignIn(t){this._busy=t,this._rejectOnPersistedPageShow=!1;const r=c=>{const u=t.options_&&t.options_.resource,d=t.resUrl_,p=t.refresh_;let g=!1;this.credentials.includes(c)||(p&&this.credentials.includes(p)?(p.userId=c.userId,p.token=c.token,p.expires=c.expires,p.validity=c.validity,p.ssl=c.ssl,p.creationTime=c.creationTime,g=!0,c=p):this.credentials.push(c)),c.resources||(c.resources=[]),c.resources.includes(u||d)||c.resources.push(u||d),c.scope=this._isServerRsrc(d)?"server":"portal",c.emitTokenChange();const y=this._soReqs,_={};this._soReqs=[],y.forEach(v=>{if(!this._isIdenticalService(d,v.resUrl_)){const w=this._getSuffix(v.resUrl_);_[w]||(_[w]=!0,c.resources.push(v.resUrl_))}}),t.resolve(c),y.forEach(v=>{this._hasSameServerInstance(this._getServerInstanceRoot(d),v.resUrl_)?v.resolve(c):this._soReqs.push(v)}),this._busy=t.resUrl_=t.sinfo_=t.refresh_=null,g||this.emit("credential-create",{credential:c}),this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},i=c=>{t.reject(c),this._busy=t.resUrl_=t.sinfo_=t.refresh_=null,this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},s=(c,u,d,p)=>{const g=t.sinfo_,y=!t.options_||t.options_.prompt!==!1,_=g.hasPortal&&this._findOAuthInfo(t.resUrl_);let v,w;if(c)r(new fs({userId:c,server:g.server,token:d||null,expires:p!=null?Number(p):null,ssl:!!u}));else if(window!==window.parent&&this._appUrlObj.query?.["arcgis-auth-origin"]&&this._appUrlObj.query?.["arcgis-auth-portal"]&&this._hasSameServerInstance(this._getServerInstanceRoot(this._appUrlObj.query["arcgis-auth-portal"]),t.resUrl_)){window.parent.postMessage({type:"arcgis:auth:requestCredential"},this._appUrlObj.query["arcgis-auth-origin"]);const T=ey(window,"message",x=>{x.source===window.parent&&x.data&&(x.data.type==="arcgis:auth:credential"?(T.remove(),x.data.credential.expires<Date.now()?i(new G("identity-manager:credential-request-failed","Parent application's token has expired.")):r(new fs(x.data.credential))):x.data.type==="arcgis:auth:error"&&(T.remove(),x.data.error.name==="tokenExpiredError"?i(new G("identity-manager:credential-request-failed","Parent application's token has expired.")):i(G.fromJSON(x.data.error))))});Ws(t.options_?.signal,()=>{T.remove()})}else if(_){let T=_._oAuthCred;if(!T){const x=new Q8(_,xM),S=new Q8(_,TM);x.isValid()&&S.isValid()?x.expires>S.expires?(T=x,S.destroy()):(T=S,x.destroy()):T=x.isValid()?x:S,_._oAuthCred=T}if(T.isValid()){v=new fs({userId:T.userId,server:g.server,token:T.token,expires:T.expires,ssl:T.ssl,_oAuthCred:T});const x=_.appId!==T.appId&&this._doPortalSignIn(t.resUrl_);x||T.refreshToken?(t._pendingDfd=T.refreshToken?this._getOAuthToken(g.server,T.refreshToken,T.appId).then(S=>(v.expires=Date.now()+1e3*S.expires_in,v.token=S.access_token,v)):Promise.resolve(v),t._pendingDfd.then(S=>x?this._exchangeToken(S.server,_.appId,S.token).then(O=>(S.token=O,S)).catch(()=>S):S).then(S=>{r(S)}).catch(()=>{T?.destroy(),s()})):r(v)}else if(this._oAuthLocationParams&&this._hasSameServerInstance(_.portalUrl,this._oAuthLocationParams.state.portalUrl)&&(this._oAuthLocationParams.access_token||this._oAuthLocationParams.code&&this._oAuthLocationParams.state.uid===T.stateUID&&T.codeVerifier)){const x=this._oAuthLocationParams;this._oAuthLocationParams=null,t._pendingDfd=this._processOAuthResponseParams(x,_,g).then(S=>{r(S)}).catch(i)}else{const x=()=>{y?t._pendingDfd=this.oAuthSignIn(t.resUrl_,g,_,t.options_).then(r,i):(w=new G("identity-manager:not-authenticated","User is not signed in."),i(w))};this._doPortalSignIn(t.resUrl_)?t._pendingDfd=this._getPlatformSelf(g.server,_.appId).then(S=>{wl(S.portalUrl,this._appOrigin,!0)?(v=new fs({userId:S.username,server:g.server,expires:Date.now()+1e3*S.expires_in,token:S.token}),r(v)):x()}).catch(x):x()}}else if(y){if(this._checkProtocol(t.resUrl_,g,i,t.admin_)){let T=t.options_;t.admin_&&(T=T||{},T.isAdmin=!0),t._pendingDfd=this.signIn(t.resUrl_,g,T).then(r,i)}}else w=new G("identity-manager:not-authenticated","User is not signed in."),i(w)},n=()=>{const c=t.sinfo_,u=c.owningSystemUrl,d=t.options_;let p,g,y,_;if(d&&(p=d.token,g=d.error,y=d.prompt),_=this._findCredential(u,{token:p,resource:t.resUrl_}),!_){for(const v of this.credentials)if(this._isIdProvider(u,v.server)){_=v;break}}if(_){const v=this.findCredential(t.resUrl_,_.userId);if(v)r(v);else if(r9(c,this._legacyFed)){const w=_.toJSON();w.server=c.server,w.resources=null,r(new fs(w))}else(t._pendingDfd=this.generateToken(this.findServerInfo(_.server),null,{serverUrl:t.resUrl_,token:_.token,signal:t.options_.signal,ssl:_.ssl})).then(w=>{r(new fs({userId:_?.userId,server:c.server,token:w.token,expires:w.expires!=null?Number(w.expires):null,ssl:!!w.ssl,isAdmin:t.admin_,validity:w.validity}))},i)}else this._busy=null,p&&(t.options_.token=null),(t._pendingDfd=this.getCredential(u.replace(/\/?$/,"/sharing"),{resource:t.resUrl_,owningTenant:c.owningTenant,signal:t.options_.signal,token:p,error:g,prompt:y})).then(()=>{this._enqueue(t.resUrl_,t.sinfo_,t.options_,t,t.admin_)},v=>{t.resUrl_=t.sinfo_=t.refresh_=null,t.reject(v)})};this._errbackFunc=i;const o=t.sinfo_.owningSystemUrl,a=this._isServerRsrc(t.resUrl_),l=t.sinfo_._restInfoPms;l?l.promise.then(c=>{const u=t.sinfo_;if(u._restInfoPms){u.adminTokenServiceUrl=u._restInfoPms.adminUrl,u._restInfoPms=null,u.tokenServiceUrl=(um("authInfo.tokenServicesUrl",c)||um("authInfo.tokenServiceUrl",c)||um("tokenServiceUrl",c))??null,u.shortLivedTokenValidity=um("authInfo.shortLivedTokenValidity",c)??null,u.currentVersion=c.currentVersion,u.owningTenant=c.owningTenant;const d=u.owningSystemUrl=c.owningSystemUrl;d&&this._portals.push(d)}a&&u.owningSystemUrl?n():s()},()=>{t.sinfo_._restInfoPms=null;const c=new G("identity-manager:server-identification-failed","Unknown resource - could not find token service endpoint.");i(c)}):a&&o?n():t.sinfo_._selfReq?t.sinfo_._selfReq.selfDfd.then(c=>{const u={};let d,p,g,y;return c&&(d=c.user&&c.user.username,u.username=d,u.allSSL=c.allSSL,p=c.supportsOAuth,y=parseFloat(c.currentVersion),c.portalMode==="multitenant"&&(g=c.customBaseUrl),t.sinfo_.currentVersion=y),t.sinfo_.webTierAuth=!!d,d&&this.normalizeWebTierAuth?this.generateToken(t.sinfo_,null,{ssl:u.allSSL}).catch(()=>null).then(_=>(u.portalToken=_&&_.token,u.tokenExpiration=_&&_.expires,u)):!d&&p&&y>=4.4&&!this._findOAuthInfo(t.resUrl_)?this._generateOAuthInfo({portalUrl:t.sinfo_.server,customBaseUrl:g,owningTenant:t.sinfo_._selfReq.owningTenant}).catch(()=>null).then(()=>u):u}).catch(()=>null).then(c=>{t.sinfo_._selfReq=null,c?s(c.username,c.allSSL,c.portalToken,c.tokenExpiration):s()}):s()}_generateOAuthInfo(t){let r,i=null,s=t.portalUrl;const n=t.customBaseUrl,o=t.owningTenant,a=!this._defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal;if(a){i=window.location.href;let l=i.indexOf("?");l>-1&&(i=i.slice(0,l)),l=i.search(/\/(apps|home)\//),i=l>-1?i.slice(0,l):null}return a&&i?(this._hasTestedIfAppIsOnPortal=!0,r=ii(i+"/sharing/rest",{query:{f:"json"}}).then(()=>{this._defaultOAuthInfo=new t9({appId:"arcgisonline",popupCallbackUrl:i+"/home/oauth-callback.html"})})):r=Promise.resolve(),r.then(()=>{if(this._defaultOAuthInfo)return s=s.replace(/^http:/i,"https:"),ii(s+"/sharing/rest/oauth2/validateRedirectUri",{query:{accountId:o,client_id:this._defaultOAuthInfo.appId,redirect_uri:ja(this._defaultOAuthInfo.popupCallbackUrl),f:"json"}}).then(l=>{if(l.data.valid){const c=this._defaultOAuthInfo.clone();l.data.urlKey&&n?c.portalUrl="https://"+l.data.urlKey.toLowerCase()+"."+n:c.portalUrl=s,c.popup=window!==window.top||!(wl(s,this._appOrigin)||this._gwDomains.some(u=>u.regex.test(s)&&u.regex.test(this._appOrigin))),this.oAuthInfos.push(c)}})})}_doOAuthSignIn(t,r,i,s){const n=i._oAuthCred,o={portalUrl:i.portalUrl};!i.popup&&i.preserveUrlHash&&window.location.hash&&(o.hash=window.location.hash),n.stateUID&&(o.uid=n.stateUID);const a={client_id:i.appId,response_type:n.codeVerifier?"code":"token",state:JSON.stringify(o),expiration:i.expiration,locale:i.locale,redirect_uri:this._getRedirectURI(i,!!n.codeVerifier)};i.forceLogin&&(a.force_login=!0),i.forceUserId&&i.userId&&(a.prepopulatedusername=i.userId),!i.popup&&this._doPortalSignIn(t)&&(a.redirectToUserOrgUrl=!0),n.codeVerifier&&(a.code_challenge=s||n.codeVerifier,a.code_challenge_method=s?"S256":"plain");const l=i.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize",c=l+"?"+s1(a);if(i.popup){const u=window.open(c,"esriJSAPIOAuth",i.popupWindowFeatures);if(u)u.focus(),this._oAuthDfd.oAuthWin_=u,this._oAuthIntervalId=setInterval(()=>{if(u.closed){clearInterval(this._oAuthIntervalId),this._oAuthOnPopupHandle.remove();const d=this._oAuthDfd;if(d){const p=new G("identity-manager:user-aborted","ABORTED");d.reject(p)}}},500),this._oAuthOnPopupHandle=ey(window,["arcgis:auth:hash","arcgis:auth:location:search"],d=>{d.type==="arcgis:auth:hash"?this.setOAuthResponseHash(d.detail):this._setOAuthResponseQueryString(d.detail)});else{const d=new G("identity-manager:popup-blocked","ABORTED");this._oAuthDfd.reject(d)}}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:a,authorizeUrl:l,resourceUrl:t,serverInfo:r,oAuthInfo:i}):window.location.href=c}_getRedirectURI(t,r){const i=window.location.href.replace(/#.*$/,"");if(t.popup)return ja(t.popupCallbackUrl);if(r){const s=Us(i);return s.query&&["code","error","error_description","message_code","persist","state"].forEach(n=>{delete s.query[n]}),gM(s.path,s.query)}return i}}Ace.prototype.declaredClass="esri.identity.IdentityManagerBase";let fs=class extends cs.EventedAccessor{constructor(e){super(e),this._oAuthCred=null,this.tokenRefreshBuffer=2,e&&e._oAuthCred&&(this._oAuthCred=e._oAuthCred)}initialize(){this.resources=this.resources||[],this.creationTime==null&&(this.creationTime=Date.now())}refreshToken(){const e=ar.findServerInfo(this.server),t=e&&e.owningSystemUrl,r=!!t&&this.scope==="server",i=r&&r9(e,ar._legacyFed),s=e.webTierAuth,n=s&&ar.normalizeWebTierAuth,o=wM[this.server],a=o&&o[this.userId];let l,c=this.resources&&this.resources[0],u=r?ar.findServerInfo(t):null,d={username:this.userId,password:a};if(s&&!n)return;r&&!u&&ar.serverInfos.some(g=>(ar._isIdProvider(t,g.server)&&(u=g),!!u));const p=u?ar.findCredential(u.server,this.userId):null;if(!r||p){if(!i){if(r)l={serverUrl:c,token:p&&p.token,ssl:p&&p.ssl};else if(n)d=null,l={ssl:this.ssl};else{if(!a){let g;return c&&(c=ar._sanitizeUrl(c),this._enqueued=1,g=ar._enqueue(c,e,null,null,this.isAdmin,this),g.then(()=>{this._enqueued=0,this.refreshServerTokens()}).catch(()=>{this._enqueued=0})),g}this.isAdmin&&(l={isAdmin:!0})}return ar.generateToken(r?u:e,r?null:d,l).then(g=>{this.token=g.token,this.expires=g.expires!=null?Number(g.expires):null,this.creationTime=Date.now(),this.validity=g.validity,this.emitTokenChange(),this.refreshServerTokens()}).catch(()=>{})}p?.refreshToken()}}refreshServerTokens(){this.scope==="portal"&&ar.credentials.forEach(e=>{const t=ar.findServerInfo(e.server),r=t&&t.owningSystemUrl;e!==this&&e.userId===this.userId&&r&&e.scope==="server"&&(ar._hasSameServerInstance(this.server,r)||ar._isIdProvider(r,this.server))&&(r9(t,ar._legacyFed)?(e.token=this.token,e.expires=this.expires,e.creationTime=this.creationTime,e.validity=this.validity,e.emitTokenChange()):e.refreshToken())})}emitTokenChange(e){clearTimeout(this._refreshTimer);const t=this.server&&ar.findServerInfo(this.server),r=t&&t.owningSystemUrl,i=r&&ar.findServerInfo(r);e===!1||r&&this.scope!=="portal"&&(!i||!i.webTierAuth||ar.normalizeWebTierAuth)||this.expires==null&&this.validity==null||this._startRefreshTimer(),this.emit("token-change")}destroy(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null,this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);const e=ar.credentials.indexOf(this);e>-1&&ar.credentials.splice(e,1),this.emitTokenChange(),this.emit("destroy")}toJSON(){const e=PD({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),t=this.resources;return t&&t.length>0&&(e.resources=t.slice()),e}_startRefreshTimer(){clearTimeout(this._refreshTimer);const e=6e4*this.tokenRefreshBuffer,t=2**31-1;let r=(this.validity?this.creationTime+6e4*this.validity:this.expires)-Date.now();r<0?r=0:r>t&&(r=t),this._refreshTimer=setTimeout(this.refreshToken.bind(this),r>e?r-e:r)}};h([f()],fs.prototype,"creationTime",void 0),h([f()],fs.prototype,"expires",void 0),h([f()],fs.prototype,"isAdmin",void 0),h([f()],fs.prototype,"oAuthState",void 0),h([f()],fs.prototype,"resources",void 0),h([f()],fs.prototype,"scope",void 0),h([f()],fs.prototype,"server",void 0),h([f()],fs.prototype,"ssl",void 0),h([f()],fs.prototype,"token",void 0),h([f()],fs.prototype,"tokenRefreshBuffer",void 0),h([f()],fs.prototype,"userId",void 0),h([f()],fs.prototype,"validity",void 0),fs=h([F("esri.identity.Credential")],fs);class Oce extends Ace{}Oce.prototype.declaredClass="esri.identity.IdentityManager";const YD=new Oce;aTe(YD);var OOe=Object.freeze(Object.defineProperty({__proto__:null,default:YD},Symbol.toStringTag,{value:"Module"}));const of=e=>{let t=class extends e{clone(){const r=Sl(Lc(this),"unable to clone instance of non-accessor class"),i=r.metadatas,s=r.store,n={},o=new Map;for(const l in i){const c=i[l],u=s?.originOf(l),d=c.clonable;if(c.readOnly||d===!1||u!==mr.USER&&u!==mr.DEFAULTS&&u!==mr.WEB_MAP&&u!==mr.WEB_SCENE)continue;const p=this[l];let g=null;g=typeof d=="function"?d(p):d==="reference"?p:f8(p),p!=null&&g==null||(u===mr.DEFAULTS?o.set(l,g):n[l]=g)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const l=Lc(a)?.store;if(l)for(const[c,u]of o)l.set(c,u,mr.DEFAULTS)}return a}};return t=h([F("esri.core.Clonable")],t),t};let qX=class extends of(xe){};qX=h([F("esri.core.Clonable")],qX);class hy{constructor(t,r){this.min=t,this.max=r,this.range=r-t}ndiff(t,r=0){return Math.ceil((t-r)/this.range)*this.range+r}_normalize(t,r,i,s=0,n=!1){return(i-=s)<t?i+=this.ndiff(t-i):i>r&&(i-=this.ndiff(i-r)),n&&i===r&&(i=t),i+s}normalize(t,r=0,i=!1){return this._normalize(this.min,this.max,t,r,i)}clamp(t,r=0){return fe(t-r,this.min,this.max)+r}monotonic(t,r,i){return t<r?r:r+this.ndiff(t-r,i)}minimalMonotonic(t,r,i){return this._normalize(t,t+this.range,r,i)}center(t,r,i){return r=this.monotonic(t,r,i),this.normalize((t+r)/2,i)}diff(t,r,i){return this.monotonic(t,r,i)-t}shortestSignedDiff(t,r){t=this.normalize(t);const i=(r=this.normalize(r))-t,s=r<t?this.minimalMonotonic(t,r)-t:r-this.minimalMonotonic(r,t);return Math.abs(i)<Math.abs(s)?i:s}contains(t,r,i){return r=this.minimalMonotonic(t,r),(i=this.minimalMonotonic(t,i))>t&&i<r}}function O7(e){for(const t in e){const r=e[t];r instanceof Function&&(e[t]=r.bind(e))}return e}const ROe=O7(new hy(0,2*Math.PI)),dy=O7(new hy(-Math.PI,Math.PI)),R7=O7(new hy(0,360));function br(e,t,r){let i,s;return t===void 0||Array.isArray(t)?(s=e,r=t,i=[void 0]):(s=t,i=Array.isArray(e)?e:[e]),(n,o)=>{const a=n.constructor.prototype;i.forEach(l=>{const c=Goe(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],r&&(c.read.source=(c.read.source||[]).concat(r))})}}function Yt(e,t,r){let i,s;return t===void 0?(s=e,i=[void 0]):typeof t!="string"?(s=e,i=[void 0],r=t):(s=t,i=Array.isArray(e)?e:[e]),(n,o)=>{const a=n.constructor.prototype;for(const l of i){const c=Goe(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),r&&(c.write.target=r),c.write.writer=a[o]}}}class P7{constructor(t,r,i,s){this.semiMajorAxis=t,this.flattening=r,this.outerAtmosphereRimWidth=i;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}}const Kt=new P7(6378137,1/298.257223563,3e5,.006694379990137799),Np=new P7(3396190,1/169.8944472236118,23e4),Mm=new P7(1737400,0,0);var Pu;(function(e){e[e.CGCS2000=4490]="CGCS2000",e[e.GCSMARS2000=104971]="GCSMARS2000",e[e.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",e[e.GCSMOON2000=104903]="GCSMOON2000"})(Pu||(Pu={}));let m;const M={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(m=2e3;m<=2045;m++)M[m]=0;for(m=2056;m<=2065;m++)M[m]=0;for(m=2067;m<=2135;m++)M[m]=0;for(m=2137;m<=2154;m++)M[m]=0;for(m=2161;m<=2170;m++)M[m]=0;for(m=2172;m<=2193;m++)M[m]=0;for(m=2195;m<=2198;m++)M[m]=0;for(m=2200;m<=2203;m++)M[m]=0;for(m=2205;m<=2217;m++)M[m]=0;for(m=2222;m<=2224;m++)M[m]=1;for(m=2225;m<=2250;m++)M[m]=2;for(m=2251;m<=2253;m++)M[m]=1;for(m=2257;m<=2264;m++)M[m]=2;for(m=2274;m<=2279;m++)M[m]=2;for(m=2280;m<=2282;m++)M[m]=1;for(m=2283;m<=2289;m++)M[m]=2;for(m=2290;m<=2292;m++)M[m]=0;for(m=2308;m<=2313;m++)M[m]=0;for(m=2315;m<=2491;m++)M[m]=0;for(m=2494;m<=2866;m++)M[m]=0;for(m=2867;m<=2869;m++)M[m]=1;for(m=2870;m<=2888;m++)M[m]=2;for(m=2891;m<=2895;m++)M[m]=2;for(m=2896;m<=2898;m++)M[m]=1;for(m=2902;m<=2908;m++)M[m]=2;for(m=2915;m<=2920;m++)M[m]=2;for(m=2921;m<=2923;m++)M[m]=1;for(m=2924;m<=2930;m++)M[m]=2;for(m=2931;m<=2962;m++)M[m]=0;for(m=2964;m<=2968;m++)M[m]=2;for(m=2969;m<=2973;m++)M[m]=0;for(m=2975;m<=2991;m++)M[m]=0;for(m=2995;m<=3051;m++)M[m]=0;for(m=3054;m<=3079;m++)M[m]=0;for(m=3081;m<=3088;m++)M[m]=0;for(m=3092;m<=3101;m++)M[m]=0;for(m=3106;m<=3138;m++)M[m]=0;for(m=3146;m<=3151;m++)M[m]=0;for(m=3153;m<=3166;m++)M[m]=0;for(m=3168;m<=3172;m++)M[m]=0;for(m=3174;m<=3203;m++)M[m]=0;for(m=3294;m<=3358;m++)M[m]=0;for(m=3367;m<=3403;m++)M[m]=0;for(m=3408;m<=3416;m++)M[m]=0;for(m=3417;m<=3438;m++)M[m]=2;for(m=3441;m<=3446;m++)M[m]=2;for(m=3447;m<=3450;m++)M[m]=0;for(m=3451;m<=3459;m++)M[m]=2;for(m=3460;m<=3478;m++)M[m]=0;for(m=3554;m<=3559;m++)M[m]=0;for(m=3560;m<=3570;m++)M[m]=2;for(m=3571;m<=3581;m++)M[m]=0;for(m=3594;m<=3597;m++)M[m]=0;for(m=3601;m<=3604;m++)M[m]=0;for(m=3637;m<=3639;m++)M[m]=0;for(m=3665;m<=3667;m++)M[m]=0;for(m=3693;m<=3695;m++)M[m]=0;for(m=3701;m<=3727;m++)M[m]=0;for(m=3728;m<=3739;m++)M[m]=2;for(m=3740;m<=3751;m++)M[m]=0;for(m=3753;m<=3760;m++)M[m]=2;for(m=3761;m<=3773;m++)M[m]=0;for(m=3775;m<=3777;m++)M[m]=0;for(m=3779;m<=3781;m++)M[m]=0;for(m=3783;m<=3785;m++)M[m]=0;for(m=3788;m<=3791;m++)M[m]=0;for(m=3797;m<=3802;m++)M[m]=0;for(m=3814;m<=3816;m++)M[m]=0;for(m=3825;m<=3829;m++)M[m]=0;for(m=3832;m<=3841;m++)M[m]=0;for(m=3844;m<=3852;m++)M[m]=0;for(m=3873;m<=3885;m++)M[m]=0;for(m=3890;m<=3893;m++)M[m]=0;for(m=3907;m<=3912;m++)M[m]=0;for(m=3942;m<=3950;m++)M[m]=0;for(m=3968;m<=3970;m++)M[m]=0;for(m=3973;m<=3976;m++)M[m]=0;for(m=3986;m<=3989;m++)M[m]=0;for(m=3994;m<=3997;m++)M[m]=0;for(m=4048;m<=4051;m++)M[m]=0;for(m=4056;m<=4063;m++)M[m]=0;for(m=4093;m<=4096;m++)M[m]=0;for(m=4390;m<=4398;m++)M[m]=0;for(m=4399;m<=4413;m++)M[m]=2;for(m=4418;m<=4433;m++)M[m]=2;for(m=4455;m<=4457;m++)M[m]=2;for(m=4484;m<=4489;m++)M[m]=0;for(m=4491;m<=4554;m++)M[m]=0;for(m=4568;m<=4589;m++)M[m]=0;for(m=4652;m<=4656;m++)M[m]=0;for(m=4766;m<=4800;m++)M[m]=0;for(m=5014;m<=5016;m++)M[m]=0;for(m=5069;m<=5072;m++)M[m]=0;for(m=5105;m<=5130;m++)M[m]=0;for(m=5173;m<=5188;m++)M[m]=0;for(m=5253;m<=5259;m++)M[m]=0;for(m=5269;m<=5275;m++)M[m]=0;for(m=5292;m<=5311;m++)M[m]=0;for(m=5329;m<=5331;m++)M[m]=0;for(m=5343;m<=5349;m++)M[m]=0;for(m=5355;m<=5357;m++)M[m]=0;for(m=5387;m<=5389;m++)M[m]=0;for(m=5459;m<=5463;m++)M[m]=0;for(m=5479;m<=5482;m++)M[m]=0;for(m=5518;m<=5520;m++)M[m]=0;for(m=5530;m<=5539;m++)M[m]=0;for(m=5550;m<=5552;m++)M[m]=0;for(m=5562;m<=5583;m++)M[m]=0;for(m=5623;m<=5625;m++)M[m]=2;for(m=5631;m<=5639;m++)M[m]=0;for(m=5649;m<=5653;m++)M[m]=0;for(m=5663;m<=5680;m++)M[m]=0;for(m=5682;m<=5685;m++)M[m]=0;for(m=5875;m<=5877;m++)M[m]=0;for(m=5896;m<=5899;m++)M[m]=0;for(m=5921;m<=5940;m++)M[m]=0;for(m=6050;m<=6125;m++)M[m]=0;for(m=6244;m<=6275;m++)M[m]=0;for(m=6328;m<=6348;m++)M[m]=0;for(m=6350;m<=6356;m++)M[m]=0;for(m=6366;m<=6372;m++)M[m]=0;for(m=6381;m<=6387;m++)M[m]=0;for(m=6393;m<=6404;m++)M[m]=0;for(m=6480;m<=6483;m++)M[m]=0;for(m=6511;m<=6514;m++)M[m]=0;for(m=6579;m<=6581;m++)M[m]=0;for(m=6619;m<=6624;m++)M[m]=0;for(m=6625;m<=6627;m++)M[m]=2;for(m=6628;m<=6632;m++)M[m]=0;for(m=6634;m<=6637;m++)M[m]=0;for(m=6669;m<=6692;m++)M[m]=0;for(m=6707;m<=6709;m++)M[m]=0;for(m=6720;m<=6723;m++)M[m]=0;for(m=6732;m<=6738;m++)M[m]=0;for(m=6931;m<=6933;m++)M[m]=0;for(m=6956;m<=6959;m++)M[m]=0;for(m=7005;m<=7007;m++)M[m]=0;for(m=7057;m<=7070;m++)M[m]=2;for(m=7074;m<=7082;m++)M[m]=0;for(m=7109;m<=7118;m++)M[m]=0;for(m=7119;m<=7127;m++)M[m]=1;for(m=7374;m<=7376;m++)M[m]=0;for(m=7528;m<=7586;m++)M[m]=0;for(m=7587;m<=7645;m++)M[m]=2;for(m=7692;m<=7696;m++)M[m]=0;for(m=7755;m<=7787;m++)M[m]=0;for(m=7791;m<=7795;m++)M[m]=0;for(m=7799;m<=7801;m++)M[m]=0;for(m=7803;m<=7805;m++)M[m]=0;for(m=7825;m<=7831;m++)M[m]=0;for(m=7845;m<=7859;m++)M[m]=0;for(m=8013;m<=8032;m++)M[m]=0;for(m=8065;m<=8068;m++)M[m]=1;for(m=8518;m<=8529;m++)M[m]=2;for(m=8533;m<=8536;m++)M[m]=2;for(m=8538;m<=8540;m++)M[m]=2;for(m=8677;m<=8679;m++)M[m]=0;for(m=8836;m<=8840;m++)M[m]=0;for(m=8857;m<=8859;m++)M[m]=0;for(m=8908;m<=8910;m++)M[m]=0;for(m=9154;m<=9159;m++)M[m]=0;for(m=9205;m<=9218;m++)M[m]=0;for(m=9271;m<=9273;m++)M[m]=0;for(m=9295;m<=9297;m++)M[m]=0;for(m=9356;m<=9360;m++)M[m]=0;for(m=9404;m<=9407;m++)M[m]=0;for(m=9476;m<=9482;m++)M[m]=0;for(m=9487;m<=9494;m++)M[m]=0;for(m=9697;m<=9699;m++)M[m]=0;for(m=9821;m<=9865;m++)M[m]=0;for(m=20002;m<=20032;m++)M[m]=0;for(m=20047;m<=20049;m++)M[m]=0;for(m=20062;m<=20092;m++)M[m]=0;for(m=20135;m<=20138;m++)M[m]=0;for(m=20248;m<=20258;m++)M[m]=0;for(m=20348;m<=20358;m++)M[m]=0;for(m=20436;m<=20440;m++)M[m]=0;for(m=20822;m<=20824;m++)M[m]=0;for(m=20904;m<=20932;m++)M[m]=0;for(m=20934;m<=20936;m++)M[m]=0;for(m=21004;m<=21032;m++)M[m]=0;for(m=21035;m<=21037;m++)M[m]=0;for(m=21095;m<=21097;m++)M[m]=0;for(m=21148;m<=21150;m++)M[m]=0;for(m=21207;m<=21264;m++)M[m]=0;for(m=21307;m<=21364;m++)M[m]=0;for(m=21413;m<=21423;m++)M[m]=0;for(m=21453;m<=21463;m++)M[m]=0;for(m=21473;m<=21483;m++)M[m]=0;for(m=21780;m<=21782;m++)M[m]=0;for(m=21891;m<=21894;m++)M[m]=0;for(m=21896;m<=21899;m++)M[m]=0;for(m=22171;m<=22177;m++)M[m]=0;for(m=22181;m<=22187;m++)M[m]=0;for(m=22191;m<=22197;m++)M[m]=0;for(m=22207;m<=22222;m++)M[m]=0;for(m=22234;m<=22236;m++)M[m]=0;for(m=22243;m<=22250;m++)M[m]=0;for(m=22262;m<=22265;m++)M[m]=0;for(m=22307;m<=22322;m++)M[m]=0;for(m=22348;m<=22357;m++)M[m]=0;for(m=22407;m<=22422;m++)M[m]=0;for(m=22462;m<=22465;m++)M[m]=0;for(m=22521;m<=22525;m++)M[m]=0;for(m=22607;m<=22622;m++)M[m]=0;for(m=22641;m<=22646;m++)M[m]=0;for(m=22648;m<=22657;m++)M[m]=0;for(m=22707;m<=22722;m++)M[m]=0;for(m=22762;m<=22765;m++)M[m]=0;for(m=22991;m<=22994;m++)M[m]=0;for(m=23028;m<=23038;m++)M[m]=0;for(m=23830;m<=23853;m++)M[m]=0;for(m=23866;m<=23872;m++)M[m]=0;for(m=23877;m<=23884;m++)M[m]=0;for(m=23886;m<=23894;m++)M[m]=0;for(m=23946;m<=23948;m++)M[m]=0;for(m=24311;m<=24313;m++)M[m]=0;for(m=24342;m<=24347;m++)M[m]=0;for(m=24370;m<=24374;m++)M[m]=10;for(m=24375;m<=24381;m++)M[m]=0;for(m=24718;m<=24721;m++)M[m]=0;for(m=24817;m<=24821;m++)M[m]=0;for(m=24877;m<=24882;m++)M[m]=0;for(m=24891;m<=24893;m++)M[m]=0;for(m=25391;m<=25395;m++)M[m]=0;for(m=25828;m<=25838;m++)M[m]=0;for(m=26191;m<=26195;m++)M[m]=0;for(m=26391;m<=26393;m++)M[m]=0;for(m=26701;m<=26722;m++)M[m]=0;for(m=26729;m<=26799;m++)M[m]=2;for(m=26801;m<=26803;m++)M[m]=2;for(m=26811;m<=26813;m++)M[m]=2;for(m=26847;m<=26870;m++)M[m]=2;for(m=26891;m<=26899;m++)M[m]=0;for(m=26901;m<=26923;m++)M[m]=0;for(m=26929;m<=26946;m++)M[m]=0;for(m=26948;m<=26998;m++)M[m]=0;for(m=27037;m<=27040;m++)M[m]=0;for(m=27205;m<=27232;m++)M[m]=0;for(m=27258;m<=27260;m++)M[m]=0;for(m=27391;m<=27398;m++)M[m]=0;for(m=27561;m<=27564;m++)M[m]=0;for(m=27571;m<=27574;m++)M[m]=0;for(m=27581;m<=27584;m++)M[m]=0;for(m=27591;m<=27594;m++)M[m]=0;for(m=28191;m<=28193;m++)M[m]=0;for(m=28348;m<=28358;m++)M[m]=0;for(m=28402;m<=28432;m++)M[m]=0;for(m=28462;m<=28492;m++)M[m]=0;for(m=29118;m<=29122;m++)M[m]=0;for(m=29168;m<=29172;m++)M[m]=0;for(m=29177;m<=29185;m++)M[m]=0;for(m=29187;m<=29195;m++)M[m]=0;for(m=29900;m<=29903;m++)M[m]=0;for(m=30161;m<=30179;m++)M[m]=0;for(m=30491;m<=30494;m++)M[m]=0;for(m=30729;m<=30732;m++)M[m]=0;for(m=31251;m<=31259;m++)M[m]=0;for(m=31265;m<=31268;m++)M[m]=0;for(m=31275;m<=31279;m++)M[m]=0;for(m=31281;m<=31297;m++)M[m]=0;for(m=31461;m<=31469;m++)M[m]=0;for(m=31491;m<=31495;m++)M[m]=0;for(m=31917;m<=31922;m++)M[m]=0;for(m=31965;m<=32e3;m++)M[m]=0;for(m=32001;m<=32003;m++)M[m]=2;for(m=32005;m<=32031;m++)M[m]=2;for(m=32033;m<=32060;m++)M[m]=2;for(m=32064;m<=32067;m++)M[m]=2;for(m=32074;m<=32077;m++)M[m]=2;for(m=32081;m<=32086;m++)M[m]=0;for(m=32107;m<=32130;m++)M[m]=0;for(m=32133;m<=32159;m++)M[m]=0;for(m=32164;m<=32167;m++)M[m]=2;for(m=32180;m<=32199;m++)M[m]=0;for(m=32201;m<=32260;m++)M[m]=0;for(m=32301;m<=32360;m++)M[m]=0;for(m=32601;m<=32662;m++)M[m]=0;for(m=32664;m<=32667;m++)M[m]=2;for(m=32701;m<=32761;m++)M[m]=0;for(m=53001;m<=53004;m++)M[m]=0;for(m=53008;m<=53019;m++)M[m]=0;for(m=53021;m<=53032;m++)M[m]=0;for(m=53034;m<=53037;m++)M[m]=0;for(m=53042;m<=53046;m++)M[m]=0;for(m=53074;m<=53080;m++)M[m]=0;for(m=54001;m<=54004;m++)M[m]=0;for(m=54008;m<=54019;m++)M[m]=0;for(m=54021;m<=54032;m++)M[m]=0;for(m=54034;m<=54037;m++)M[m]=0;for(m=54042;m<=54046;m++)M[m]=0;for(m=54048;m<=54053;m++)M[m]=0;for(m=54074;m<=54080;m++)M[m]=0;for(m=54098;m<=54101;m++)M[m]=0;for(m=102001;m<=102040;m++)M[m]=0;for(m=102042;m<=102063;m++)M[m]=0;for(m=102065;m<=102067;m++)M[m]=0;for(m=102070;m<=102117;m++)M[m]=0;for(m=102122;m<=102216;m++)M[m]=0;for(m=102221;m<=102377;m++)M[m]=0;for(m=102382;m<=102388;m++)M[m]=0;for(m=102389;m<=102398;m++)M[m]=2;for(m=102399;m<=102444;m++)M[m]=0;for(m=102445;m<=102447;m++)M[m]=2;for(m=102448;m<=102458;m++)M[m]=0;for(m=102459;m<=102468;m++)M[m]=2;for(m=102469;m<=102499;m++)M[m]=0;for(m=102500;m<=102519;m++)M[m]=1;for(m=102520;m<=102524;m++)M[m]=0;for(m=102525;m<=102529;m++)M[m]=2;for(m=102530;m<=102588;m++)M[m]=0;for(m=102590;m<=102598;m++)M[m]=0;for(m=102601;m<=102603;m++)M[m]=0;for(m=102605;m<=102628;m++)M[m]=0;for(m=102629;m<=102646;m++)M[m]=2;for(m=102648;m<=102700;m++)M[m]=2;for(m=102701;m<=102703;m++)M[m]=0;for(m=102707;m<=102730;m++)M[m]=2;for(m=102733;m<=102758;m++)M[m]=2;for(m=102767;m<=102900;m++)M[m]=0;for(m=102901;m<=102933;m++)M[m]=2;for(m=102934;m<=102950;m++)M[m]=13;for(m=102951;m<=102955;m++)M[m]=0;for(m=102961;m<=102963;m++)M[m]=0;for(m=102965;m<=102969;m++)M[m]=0;for(m=102971;m<=102973;m++)M[m]=0;for(m=102975;m<=102989;m++)M[m]=0;for(m=102990;m<=102992;m++)M[m]=1;for(m=102997;m<=103002;m++)M[m]=0;for(m=103003;m<=103008;m++)M[m]=2;for(m=103009;m<=103011;m++)M[m]=0;for(m=103012;m<=103014;m++)M[m]=2;for(m=103019;m<=103021;m++)M[m]=0;for(m=103022;m<=103024;m++)M[m]=2;for(m=103029;m<=103031;m++)M[m]=0;for(m=103032;m<=103034;m++)M[m]=2;for(m=103065;m<=103068;m++)M[m]=0;for(m=103074;m<=103076;m++)M[m]=0;for(m=103077;m<=103079;m++)M[m]=1;for(m=103080;m<=103082;m++)M[m]=0;for(m=103083;m<=103085;m++)M[m]=2;for(m=103090;m<=103093;m++)M[m]=0;for(m=103097;m<=103099;m++)M[m]=0;for(m=103100;m<=103102;m++)M[m]=2;for(m=103107;m<=103109;m++)M[m]=0;for(m=103110;m<=103112;m++)M[m]=2;for(m=103113;m<=103116;m++)M[m]=0;for(m=103117;m<=103120;m++)M[m]=2;for(m=103153;m<=103157;m++)M[m]=0;for(m=103158;m<=103162;m++)M[m]=2;for(m=103163;m<=103165;m++)M[m]=0;for(m=103166;m<=103168;m++)M[m]=1;for(m=103169;m<=103171;m++)M[m]=2;for(m=103186;m<=103188;m++)M[m]=0;for(m=103189;m<=103191;m++)M[m]=2;for(m=103192;m<=103195;m++)M[m]=0;for(m=103196;m<=103199;m++)M[m]=2;for(m=103200;m<=103224;m++)M[m]=0;for(m=103225;m<=103227;m++)M[m]=1;for(m=103232;m<=103237;m++)M[m]=0;for(m=103238;m<=103243;m++)M[m]=2;for(m=103244;m<=103246;m++)M[m]=0;for(m=103247;m<=103249;m++)M[m]=2;for(m=103254;m<=103256;m++)M[m]=0;for(m=103257;m<=103259;m++)M[m]=2;for(m=103264;m<=103266;m++)M[m]=0;for(m=103267;m<=103269;m++)M[m]=2;for(m=103300;m<=103375;m++)M[m]=0;for(m=103381;m<=103383;m++)M[m]=0;for(m=103384;m<=103386;m++)M[m]=1;for(m=103387;m<=103389;m++)M[m]=0;for(m=103390;m<=103392;m++)M[m]=2;for(m=103397;m<=103399;m++)M[m]=0;for(m=103400;m<=103471;m++)M[m]=2;for(m=103476;m<=103478;m++)M[m]=0;for(m=103479;m<=103481;m++)M[m]=2;for(m=103486;m<=103488;m++)M[m]=0;for(m=103489;m<=103491;m++)M[m]=2;for(m=103492;m<=103495;m++)M[m]=0;for(m=103496;m<=103499;m++)M[m]=2;for(m=103528;m<=103543;m++)M[m]=0;for(m=103544;m<=103548;m++)M[m]=2;for(m=103549;m<=103551;m++)M[m]=0;for(m=103552;m<=103554;m++)M[m]=1;for(m=103555;m<=103557;m++)M[m]=2;for(m=103558;m<=103560;m++)M[m]=0;for(m=103571;m<=103573;m++)M[m]=0;for(m=103574;m<=103576;m++)M[m]=2;for(m=103577;m<=103580;m++)M[m]=0;for(m=103581;m<=103583;m++)M[m]=2;for(m=103595;m<=103694;m++)M[m]=0;for(m=103696;m<=103699;m++)M[m]=0;for(m=103700;m<=103793;m++)M[m]=2;for(m=103794;m<=103890;m++)M[m]=0;for(m=103891;m<=103896;m++)M[m]=2;for(m=103900;m<=103971;m++)M[m]=2;for(m=103972;m<=103977;m++)M[m]=0;for(m=112e3;m<=112101;m++)M[m]=0;const POe={102113:!0,102100:!0,3857:!0,3785:!0},MOe={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},XX='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',FO=[-20037508342788905e-9,20037508342788905e-9],UO=[-20037508342787e-6,20037508342787e-6],Rce={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:FO,origin:UO,dx:1e-5},102100:{wkTemplate:XX,valid:FO,origin:UO,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:FO,origin:UO,dx:1e-5},3857:{wkTemplate:XX,valid:FO,origin:UO,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function kn(e,t){return e===t||e!=null&&t!=null&&(e.wkid!=null||t.wkid!=null?e.wkid===t.wkid||h1(e)&&h1(t)||t.latestWkid!=null&&e.wkid===t.latestWkid||e.latestWkid!=null&&t.wkid===e.latestWkid:!(!e.wkt||!t.wkt)&&e.wkt.toUpperCase()===t.wkt.toUpperCase())}function Fv(e){return jo(e)&&e.wkid&&Rce[e.wkid]||null}function Pce(e){return!!jo(e)&&(e.wkid?M[e.wkid]==null:!!e.wkt&&!!/^\s*GEOGCS/i.test(e.wkt))}function nT(e){return!(af(e)||lf(e))}function lA(e){return jo(e)&&e.wkid===4326}function Mce(e){return jo(e)&&e.wkid===Pu.CGCS2000}function h1(e){return jo(e)&&e.wkid!=null&&POe[e.wkid]===!0}function M7(e){return jo(e)&&e.wkid===32662}function I7(e){return e===Pu.GCSMARS2000||e===Pu.GCSMARS2000_SPHERE}function af(e){return jo(e)&&e.wkid!=null&&I7(e.wkid)}function $7(e){return e===Pu.GCSMOON2000}function lf(e){return jo(e)&&e.wkid!=null&&$7(e.wkid)}function IOe(e){return jo(e)&&e.wkid!=null&&MOe[e.wkid]===!0}function jo(e){return e!=null&&(e.wkid!=null&&e.wkid>=2e3||e.wkt!=null)}const $Oe={wkid:4326,wkt:MD(Rce[4326].wkTemplate,{Central_Meridian:"0.0"})},LOe={wkid:102100,latestWkid:3857},DOe={wkid:32662};function L7(e){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${e.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const Ice=L7(Kt),D7=L7(Np),N7=L7(Mm),$ce={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${Kt.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`};function Mr(e){return e!=null&&(af(e)||kn(e,D7))?Np:e!=null&&(lf(e)||kn(e,N7))?Mm:Kt}function rdt(e){return I7(e)?Np:$7(e)?Mm:Kt}const F7=39.37,NOe=Kt.radius*Math.PI/200,Lce=/UNIT\[([^\]]+)\]\]$/i,Uv=M,Dce=/UNIT\[([^\]]+)\]/i,FOe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),UOe=jl()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),Md=e=>e*e,dg=e=>e*e*e,cA={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Md(.001)},"square-centimeters":{inBaseUnits:Md(.01)},"square-decimeters":{inBaseUnits:Md(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Md(1e3)},"square-inches":{inBaseUnits:Md(.0254)},"square-feet":{inBaseUnits:Md(.3048)},"square-yards":{inBaseUnits:Md(.9144)},"square-miles":{inBaseUnits:Md(1609.344)},"square-us-feet":{inBaseUnits:Md(1200/3937)},acres:{inBaseUnits:.0015625*Md(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*dg(.001)},"cubic-centimeters":{inBaseUnits:1e3*dg(.01)},"cubic-decimeters":{inBaseUnits:1e3*dg(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*dg(1e3)},"cubic-inches":{inBaseUnits:1e3*dg(.0254)},"cubic-feet":{inBaseUnits:1e3*dg(.3048)},"cubic-yards":{inBaseUnits:1e3*dg(.9144)},"cubic-miles":{inBaseUnits:1e3*dg(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},kOe=(()=>{const e={};for(const t in cA)for(const r in cA[t].units)e[r]=t;return e})();function zOe(e,t,r){return e*cA[r].units[t].inBaseUnits}function BOe(e,t,r){return e/cA[r].units[t].inBaseUnits}const VOe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function i9(e){const t=kOe[e];if(!t)throw new Error("unknown type");return t}function ZX(e,t=null){return t=t||i9(e),cA[t].baseUnit===e}function mo(e,t,r){if(t===r)return e;const i=i9(t);if(i!==i9(r))throw new Error("incompatible units");const s=ZX(t,i)?e:zOe(e,t,i);return ZX(r,i)?s:BOe(s,r,i)}function idt(e,t,r){switch(r){case"metric":return GOe(e,t);case"imperial":return HOe(e,t);default:return r}}function sdt(e,t,r){switch(r){case"metric":return jOe(e,t);case"imperial":return WOe(e,t);default:return r}}function GOe(e,t){const r=mo(e,t,"meters");return Math.abs(r)<3e3?"meters":"kilometers"}function jOe(e,t){const r=mo(e,t,"meters");return Math.abs(r)<1e5?"meters":"kilometers"}function HOe(e,t){const r=mo(e,t,"feet");return Math.abs(r)<1e3?"feet":"miles"}function WOe(e,t){const r=mo(e,t,"feet");return Math.abs(r)<1e5?"feet":"miles"}function ndt(e,t){const r=mo(e,t,"square-meters");return Math.abs(r)<3e6?"square-meters":"square-kilometers"}function odt(e,t){const r=mo(e,t,"square-feet");return Math.abs(r)<1e6?"square-feet":"square-miles"}function qOe(e,t,r){return mo(e,t,"meters")/(r*Math.PI/180)}function Nce(e){return UOe.fromJSON(e.toLowerCase())||null}function s9(e){if(e!=null&&!nT(e))return 1;const t=Sa(e);return t>1e5?1:t}function XOe(e){return Sa(e)>=Mr(e).metersPerDegree?"meters":JD(e)}function Sa(e,t=Kt.metersPerDegree){return ZOe(e,!0)??t}function ZOe(e,t=!1){const r=e!=null?e.wkid:null,i=e!=null?e.wkt:null;let s=null;if(r){if(I7(r))return Np.metersPerDegree;if($7(r))return Mm.metersPerDegree;s=Uv.values[Uv[r]],!s&&t&&FOe.has(r)&&(s=NOe)}else i&&(kce(i)?s=JX(Lce.exec(i),s):Uce(i)&&(s=JX(Dce.exec(i),s)));return s}function YX(e){return e.isGeographic?1:Sa(e)}function JX(e,t){return e&&e[1]?Fce(e[1]):t}function Fce(e){return parseFloat(e.split(",")[1])}function JD(e){const t=e!=null?e.wkid:null,r=e!=null?e.wkt:null;let i=null;if(t)i=Uv.units[Uv[t]];else if(r){const s=kce(r)?Lce:Uce(r)?Dce:null;if(s){const n=s.exec(r);n&&n[1]&&(i=JOe(n[1]))}}return i!=null?Nce(i):null}function adt(e){const t=JD(e);return t!=null&&VOe.includes(t)?t:null}function Uce(e){return/^GEOCCS/i.test(e)}function kce(e){return/^PROJCS/i.test(e)}const YOe=1e-7;function JOe(e){const t=/[\\"\\']{1}([^\\"\\']+)/.exec(e);let r=t&&t[1];if(!r||!Uv.units.includes(r)){const i=Fce(e);r=null;const s=Uv.values;for(let n=0;n<s.length;++n)if(Math.abs(i-s[n])<YOe){r=Uv.units[n];break}}return r}function ldt(e){const t=JD(e);if(t==null)return null;switch(t){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const KOe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},QOe={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},eRe={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},cdt=jl()(KOe),udt=jl()(QOe),hdt=jl()(eRe);var Yd;let hi=Yd=class extends Pe{static fromJSON(e){if(!e)return null;if(e.wkid){if(e.wkid===102100)return Yd.WebMercator;if(e.wkid===4326)return Yd.WGS84}const t=new Yd;return t.read(e),t}constructor(e){super(e),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(e){return e&&typeof e=="object"?e:{[typeof e=="string"?"wkt":"wkid"]:e}}get isWGS84(){return lA(this)}get isWebMercator(){return h1(this)}get isGeographic(){return Pce(this)}get isWrappable(){return IOe(this)}get metersPerUnit(){return Sa(this)}get unit(){return JD(this)||(this.isGeographic?"degrees":null)}writeWkt(e,t){this.wkid||(t.wkt=e)}clone(){if(this===Yd.WGS84)return Yd.WGS84;if(this===Yd.WebMercator)return Yd.WebMercator;const e=new Yd;return this.wkid!=null?(e.wkid=this.wkid,this.latestWkid!=null&&(e.latestWkid=this.latestWkid),this.vcsWkid!=null&&(e.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(e.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(e.wkt=this.wkt),this.imageCoordinateSystem&&(e.imageCoordinateSystem=ye(this.imageCoordinateSystem)),e}equals(e){if(e==null)return!1;if(this.imageCoordinateSystem||e.imageCoordinateSystem){if(this.imageCoordinateSystem==null||e.imageCoordinateSystem==null)return!1;const{id:t,referenceServiceName:r}=e.imageCoordinateSystem,{geodataXform:i}=e.imageCoordinateSystem,s=this.imageCoordinateSystem;return t==null||i?JSON.stringify(s)===JSON.stringify(e.imageCoordinateSystem):r?s.id===t&&s.referenceServiceName===r:s.id===t}return kn(this,e)}toJSON(e){return this.write(void 0,e)}};hi.GCS_NAD_1927=null,hi.WGS84=null,hi.WebMercator=null,hi.PlateCarree=null,h([f({readOnly:!0})],hi.prototype,"isWGS84",null),h([f({readOnly:!0})],hi.prototype,"isWebMercator",null),h([f({readOnly:!0})],hi.prototype,"isGeographic",null),h([f({readOnly:!0})],hi.prototype,"isWrappable",null),h([f({type:Ps,json:{write:!0}})],hi.prototype,"latestWkid",void 0),h([f({readOnly:!0})],hi.prototype,"metersPerUnit",null),h([f({readOnly:!0})],hi.prototype,"unit",null),h([f({type:Ps,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],hi.prototype,"wkid",void 0),h([f({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],hi.prototype,"wkt",void 0),h([Yt("wkt"),Yt("web-scene","wkt")],hi.prototype,"writeWkt",null),h([f({type:Ps,json:{write:!0}})],hi.prototype,"vcsWkid",void 0),h([f({type:Ps,json:{write:!0}})],hi.prototype,"latestVcsWkid",void 0),h([f()],hi.prototype,"imageCoordinateSystem",void 0),hi=Yd=h([F("esri.geometry.SpatialReference")],hi),hi.prototype.toJSON.isDefaultToJSON=!0,hi.GCS_NAD_1927=new hi({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),hi.WGS84=new hi($Oe),hi.WebMercator=new hi(LOe),hi.PlateCarree=new hi(DOe),Object.freeze&&(Object.freeze(hi.GCS_NAD_1927),Object.freeze(hi.WGS84),Object.freeze(hi.WebMercator));const st=hi;let Jd=class extends Pe{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=st.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,t){if(e instanceof st)return e;if(e!=null){const r=new st;return r.read(e,t),r}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,t){this.cache[e]=t}};h([f()],Jd.prototype,"type",void 0),h([f({readOnly:!0})],Jd.prototype,"cache",null),h([f({readOnly:!0})],Jd.prototype,"extent",null),h([f({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Jd.prototype,"hasM",void 0),h([f({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Jd.prototype,"hasZ",void 0),h([f({type:st,json:{write:!0},value:st.WGS84})],Jd.prototype,"spatialReference",void 0),h([br("spatialReference")],Jd.prototype,"readSpatialReference",null),Jd=h([F("esri.geometry.Geometry")],Jd);const Iy=Jd;function tRe(e,t){const r=e.x-t.x,i=e.y-t.y,s=e.hasZ&&t.hasZ?e.z-t.z:0;return Math.sqrt(r*r+i*i+s*s)}const rRe=57.29577951308232,iRe=.017453292519943;function KX(e){return e*rRe}function QX(e){return e*iRe}function eZ(e){return e/Kt.radius}function k$(e){return Math.PI/2-2*Math.atan(Math.exp(-e/Kt.radius))}function n9(e){return e.wkid!=null||e.wkt!=null}const Y5=[0,0];function z$(e,t,r,i,s){const n=e,o=s;if(o.spatialReference=r,"x"in n&&"x"in o)[o.x,o.y]=t(n.x,n.y,Y5,i);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=t(n.xmin,n.ymin,Y5,i),[o.xmax,o.ymax]=t(n.xmax,n.ymax,Y5,i);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let u=0;u<a.length;u++){const d=a[u];c=[],l.push(c);for(let p=0;p<d.length;p++)c.push(t(d[p][0],d[p][1],[0,0],i)),d[p].length>2&&c[p].push(d[p][2]),d[p].length>3&&c[p].push(d[p][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=t(a[c][0],a[c][1],[0,0],i),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function ty(e,t){const r=e&&(n9(e)?e:e.spatialReference),i=t&&(n9(t)?t:t.spatialReference);return!(e&&"type"in e&&e.type==="mesh"||t&&"type"in t&&t.type==="mesh"||!r||!i)&&(!!kn(i,r)||h1(i)&&lA(r)||h1(r)&&lA(i))}function Y1(e,t){if(e==null)return null;const r=e.spatialReference,i=t&&(n9(t)?t:t.spatialReference);return ty(r,i)?kn(r,i)?ye(e):h1(i)?z$(e,ix,st.WebMercator,!1,ye(e)):lA(i)?z$(e,cC,st.WGS84,!1,ye(e)):null:null}function ix(e,t,r=[0,0]){t>89.99999?t=89.99999:t<-89.99999&&(t=-89.99999);const i=QX(t);return r[0]=QX(e)*Kt.radius,r[1]=Kt.halfSemiMajorAxis*Math.log((1+Math.sin(i))/(1-Math.sin(i))),r}function cC(e,t,r=[0,0],i=!1){const s=KX(e/Kt.radius);return r[0]=i?s:s-360*Math.floor((s+180)/360),r[1]=KX(Math.PI/2-2*Math.atan(Math.exp(-t/Kt.radius))),r}function uC(e,t=!1,r=ye(e)){return z$(e,ix,st.WebMercator,t,r)}function kO(e,t=!1,r=ye(e)){return z$(e,cC,st.WGS84,t,r)}var SM;const W2=[0,0];function tZ(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}let La=SM=class extends Iy{static copy(e,t){t._set("x",e._get("x")),t._set("y",e._get("y")),t._set("z",e._get("z")),t._set("m",e._get("m"));const r=e._get("spatialReference");t._set("spatialReference",Object.isFrozen(r)?r:r.clone())}constructor(...e){super(...e),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(e,t,r,i,s){let n;if(Array.isArray(e))n=e,s=t,e=n[0],t=n[1],r=n[2],i=n[3];else if(e&&typeof e=="object"){if(n=e,e=n.x!=null?n.x:n.longitude,t=n.y!=null?n.y:n.latitude,r=n.z,i=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new st(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)K.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)K.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const a=ix(n.longitude,n.latitude,W2);e=a[0],t=a[1]}}}else tZ(r)?(s=r,r=null):tZ(i)&&(s=i,i=null);const o={x:e,y:t};return o.x==null&&o.y!=null?K.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&K.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),r!=null&&(o.z=r),i!=null&&(o.m=i),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(e){e!==(this._get("m")!==void 0)&&(this._set("m",e?0:void 0),this._set("hasM",e))}get hasZ(){return this.z!==void 0}set hasZ(e){e!==(this._get("z")!==void 0)&&(this._set("z",e?0:void 0),this._set("hasZ",e))}get latitude(){const{spatialReference:e,x:t,y:r}=this;if(e){if(e.isWebMercator)return cC(t,r,W2)[1];if(e.isGeographic)return r}return null}set latitude(e){const{spatialReference:t,x:r}=this;e!=null&&t&&(t.isWebMercator?this._set("y",ix(r,e,W2)[1]):t.isGeographic&&this._set("y",e),this._set("latitude",e))}get longitude(){const{x:e,y:t,spatialReference:r}=this;if(r){if(r.isWebMercator)return cC(e,t,W2)[0];if(r.isGeographic)return e}return null}set longitude(e){const{y:t,spatialReference:r}=this;e!=null&&r&&(r.isWebMercator?this._set("x",ix(e,t,W2)[0]):r.isGeographic&&this._set("x",e),this._set("longitude",e))}writeX(e,t,r){t[r]=isNaN(e)?"NaN":e}readX(e){return typeof e=="string"?NaN:e}clone(){const e=new SM;return e.x=this.x,e.y=this.y,e.z=this.z,e.m=this.m,e.spatialReference=this.spatialReference,e}copy(e){return SM.copy(e,this),this}equals(e){if(e==null)return!1;const{x:t,y:r,z:i,m:s,spatialReference:n}=this,{z:o,m:a}=e;let{x:l,y:c,spatialReference:u}=e;if(!n.equals(u))if(n.isWebMercator&&u.isWGS84)[l,c]=ix(l,c),u=n;else{if(!n.isWGS84||!u.isWebMercator)return!1;[l,c]=cC(l,c),u=n}return t===l&&r===c&&i===o&&s===a&&n.wkid===u.wkid}offset(e,t,r){return this.x+=e,this.y+=t,r!=null&&(this.z=(this.z??0)+r),this}normalize(){if(!this.spatialReference)return this;const e=Fv(this.spatialReference);if(!e)return this;let t=this.x;const[r,i]=e.valid,s=2*i;let n;return t>i?(n=Math.ceil(Math.abs(t-i)/s),t-=n*s):t<r&&(n=Math.ceil(Math.abs(t-r)/s),t+=n*s),this._set("x",t),this}distance(e){return tRe(this,e)}toArray(){const e=this.hasZ,t=this.hasM;return e&&t?[this.x,this.y,this.z,this.m]:e?[this.x,this.y,this.z]:t?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(e){return this.write({},e)}};h([f({readOnly:!0})],La.prototype,"cache",null),h([f({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],La.prototype,"hasM",null),h([f({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],La.prototype,"hasZ",null),h([f({type:Number})],La.prototype,"latitude",null),h([f({type:Number})],La.prototype,"longitude",null),h([f({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),si(e=>isNaN(e)?e:Xh(e))],La.prototype,"x",void 0),h([Yt("x")],La.prototype,"writeX",null),h([br("x")],La.prototype,"readX",null),h([f({type:Number,json:{write:!0}})],La.prototype,"y",void 0),h([f({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],La.prototype,"z",void 0),h([f({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],La.prototype,"m",void 0),La=SM=h([F("esri.geometry.Point")],La),La.prototype.toJSON.isDefaultToJSON=!0;const ut=La;let Df=class extends of(Pe){constructor(...e){super(...e),this.position=new ut([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,t,r,i){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return t!=null&&(s.heading=t),r!=null&&(s.tilt=r),i!=null&&(s.fov=i),s}return e}writePosition(e,t,r,i){const s=e.clone();s.x=Xh(e.x||0),s.y=Xh(e.y||0),s.z=e.hasZ?Xh(e.z||0):e.z,t[r]=s.write({},i)}readPosition(e,t){const r=new ut;return r.read(e,t),r.x=Xh(r.x||0),r.y=Xh(r.y||0),r.z=r.hasZ?Xh(r.z||0):r.z,r}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};h([f({type:ut,json:{write:{isRequired:!0}}})],Df.prototype,"position",void 0),h([Yt("position")],Df.prototype,"writePosition",null),h([br("position")],Df.prototype,"readPosition",null),h([f({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),si(e=>R7.normalize(Xh(e)))],Df.prototype,"heading",void 0),h([f({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),si(e=>fe(Xh(e),-180,180))],Df.prototype,"tilt",void 0),h([f({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Df.prototype,"fov",void 0),Df=h([F("esri.Camera")],Df);const Wu=Df,J5=[0,0];function U7(e,t){return t!=null&&ua(e,t.x,t.y,t.z)}function ddt(e,t){if(!t.points||t.points.length)return!1;for(const r of t.points)if(!oT(e,r))return!1;return!0}function sRe(e,t){const{xmin:r,ymin:i,zmin:s,xmax:n,ymax:o,zmax:a}=t;return e.hasZ&&t.hasZ?ua(e,r,i,s)&&ua(e,r,o,s)&&ua(e,n,o,s)&&ua(e,n,i,s)&&ua(e,r,i,a)&&ua(e,r,o,a)&&ua(e,n,o,a)&&ua(e,n,i,a):ua(e,r,i)&&ua(e,r,o)&&ua(e,n,o)&&ua(e,n,i)}function oT(e,t){return ua(e,t[0],t[1])}function nRe(e,t){return ua(e,t[0],t[1],t[2])}function ua(e,t,r,i){return t>=e.xmin&&t<=e.xmax&&r>=e.ymin&&r<=e.ymax&&(i==null||!e.hasZ||i>=e.zmin&&i<=e.zmax)}function oRe(e,t){return J5[1]=t.y,J5[0]=t.x,aRe(e,J5)}function aRe(e,t){return zce(e.rings,t)}function zce(e,t){if(!e)return!1;if(lRe(e))return rZ(!1,e,t);let r=!1;for(let i=0,s=e.length;i<s;i++)r=rZ(r,e[i],t);return r}function lRe(e){return!Array.isArray(e[0][0])}function rZ(e,t,r){const[i,s]=r;let n=e,o=0;for(let a=0,l=t.length;a<l;a++){o++,o===l&&(o=0);const[c,u]=t[a],[d,p]=t[o];(u<s&&p>=s||p<s&&u>=s)&&c+(s-u)/(p-u)*(d-c)<i&&(n=!n)}return n}function cRe(e,t){return U7(e,t)}function uRe(e,t){const r=e.hasZ&&t.hasZ;let i,s,n;if(e.xmin<=t.xmin){if(i=t.xmin,e.xmax<i)return!1}else if(i=e.xmin,t.xmax<i)return!1;if(e.ymin<=t.ymin){if(s=t.ymin,e.ymax<s)return!1}else if(s=e.ymin,t.ymax<s)return!1;if(r&&t.hasZ){if(e.zmin<=t.zmin){if(n=t.zmin,e.zmax<n)return!1}else if(n=e.zmin,t.zmax<n)return!1}return!0}function hRe(e,t){const{points:r,hasZ:i}=t,s=i?nRe:oT;for(const n of r)if(s(e,n))return!0;return!1}const d1=[0,0],p1=[0,0],f1=[0,0],m1=[0,0],dRe=[d1,p1,f1,m1],Bce=[[f1,d1],[d1,p1],[p1,m1],[m1,f1]];function pRe(e,t){return fRe(e,t.rings)}function fRe(e,t){d1[0]=e.xmin,d1[1]=e.ymax,p1[0]=e.xmax,p1[1]=e.ymax,f1[0]=e.xmin,f1[1]=e.ymin,m1[0]=e.xmax,m1[1]=e.ymin;for(const r of dRe)if(zce(t,r))return!0;for(const r of t){if(!r.length)continue;let i=r[0];if(oT(e,i))return!0;for(let s=1;s<r.length;s++){const n=r[s];if(oT(e,n)||Vce(i,n,Bce))return!0;i=n}}return!1}function mRe(e,t){d1[0]=e.xmin,d1[1]=e.ymax,p1[0]=e.xmax,p1[1]=e.ymax,f1[0]=e.xmin,f1[1]=e.ymin,m1[0]=e.xmax,m1[1]=e.ymin;const r=t.paths;for(const i of r){if(!r.length)continue;let s=i[0];if(oT(e,s))return!0;for(let n=1;n<i.length;n++){const o=i[n];if(oT(e,o)||Vce(s,o,Bce))return!0;s=o}}return!1}const co=[0,0];function gRe(e){for(let t=0;t<e.length;t++){const r=e[t];for(let s=0;s<r.length-1;s++){const n=r[s],o=r[s+1];for(let a=t+1;a<e.length;a++)for(let l=0;l<e[a].length-1;l++){const c=e[a][l],u=e[a][l+1];if(o9(n,o,c,u,co)&&!(co[0]===n[0]&&co[1]===n[1]||co[0]===c[0]&&co[1]===c[1]||co[0]===o[0]&&co[1]===o[1]||co[0]===u[0]&&co[1]===u[1]))return!0}}const i=r.length;if(!(i<=4))for(let s=0;s<i-3;s++){let n=i-1;s===0&&(n=i-2);const o=r[s],a=r[s+1];for(let l=s+2;l<n;l++){const c=r[l],u=r[l+1];if(o9(o,a,c,u,co)&&!(co[0]===o[0]&&co[1]===o[1]||co[0]===c[0]&&co[1]===c[1]||co[0]===a[0]&&co[1]===a[1]||co[0]===u[0]&&co[1]===u[1]))return!0}}}return!1}function Vce(e,t,r){for(let i=0;i<r.length;i++)if(o9(e,t,r[i][0],r[i][1]))return!0;return!1}function o9(e,t,r,i,s){const[n,o]=e,[a,l]=t,[c,u]=r,[d,p]=i,g=d-c,y=n-c,_=a-n,v=p-u,w=o-u,T=l-o,x=v*_-g*T;if(x===0)return!1;const S=(g*w-v*y)/x,O=(_*w-T*y)/x;return S>=0&&S<=1&&O>=0&&O<=1&&(s&&(s[0]=n+S*(a-n),s[1]=o+S*(l-o)),!0)}function yRe(e){switch(e){case"esriGeometryEnvelope":case"extent":return uRe;case"esriGeometryMultipoint":case"multipoint":return hRe;case"esriGeometryPoint":case"point":return cRe;case"esriGeometryPolygon":case"polygon":return pRe;case"esriGeometryPolyline":case"polyline":return mRe}}var ru;function _Re(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}function pg(e,t,r){return t==null?r:r==null?t:e(t,r)}let Wn=ru=class extends Iy{constructor(...e){super(...e),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(e,t,r,i,s){return _Re(e)?{spatialReference:e,xmin:0,ymin:0,xmax:0,ymax:0}:typeof e=="object"?(e.spatialReference=e.spatialReference==null?st.WGS84:e.spatialReference,e):{xmin:e,ymin:t,xmax:r,ymax:i,spatialReference:s??st.WGS84}}static fromBounds(e,t){return new ru({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}static fromPoint(e){return new ru({xmin:e.x,ymin:e.y,zmin:e.z,xmax:e.x,ymax:e.y,zmax:e.z,spatialReference:e.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const e=new ut({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(e.z=.5*(this.zmin+this.zmax)),this.hasM&&(e.m=.5*(this.mmin+this.mmax)),e}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(e){const t=this.center;return e.z!=null&&this.hasZ?this.offset(e.x-t.x,e.y-t.y,e.z-t.z):this.offset(e.x-t.x,e.y-t.y)}clone(){const e=new ru;return e.xmin=this.xmin,e.ymin=this.ymin,e.xmax=this.xmax,e.ymax=this.ymax,e.spatialReference=this.spatialReference,this.zmin!=null&&(e.zmin=this.zmin,e.zmax=this.zmax),this.mmin!=null&&(e.mmin=this.mmin,e.mmax=this.mmax),e}contains(e){if(!e)return!1;const t=this.spatialReference,r=e.spatialReference;return t&&r&&!t.equals(r)&&ty(t,r)&&(e=t.isWebMercator?uC(e):kO(e,!0)),e.type==="point"?U7(this,e):e.type==="extent"&&sRe(this,e)}equals(e){if(this===e)return!0;if(e==null)return!1;const t=this.spatialReference,r=e.spatialReference;return t&&r&&!t.equals(r)&&ty(t,r)&&(e=t.isWebMercator?uC(e):kO(e,!0)),this.xmin===e.xmin&&this.ymin===e.ymin&&this.zmin===e.zmin&&this.mmin===e.mmin&&this.xmax===e.xmax&&this.ymax===e.ymax&&this.zmax===e.zmax&&this.mmax===e.mmax}expand(e){const t=.5*(1-e),r=this.width*t,i=this.height*t;if(this.xmin+=r,this.ymin+=i,this.xmax-=r,this.ymax-=i,this.hasZ){const s=(this.zmax-this.zmin)*t;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*t;this.mmin+=s,this.mmax-=s}return this}intersects(e){if(e==null)return!1;e.type==="mesh"&&(e=e.extent);const t=this.spatialReference,r=e.spatialReference;return t&&r&&!kn(t,r)&&ty(t,r)&&(e=t.isWebMercator?uC(e):kO(e,!0)),yRe(e.type)(this,e)}normalize(){const e=this._normalize(!1,!0);return Array.isArray(e)?e:[e]}offset(e,t,r){return this.xmin+=e,this.ymin+=t,this.xmax+=e,this.ymax+=t,r!=null&&(this.zmin+=r,this.zmax+=r),this}shiftCentralMeridian(){return this._normalize(!0)}union(e){return this===e||(this.xmin=Math.min(this.xmin,e.xmin),this.ymin=Math.min(this.ymin,e.ymin),this.xmax=Math.max(this.xmax,e.xmax),this.ymax=Math.max(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=pg(Math.min,this.zmin,e.zmin),this.zmax=pg(Math.max,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=pg(Math.min,this.mmin,e.mmin),this.mmax=pg(Math.max,this.mmax,e.mmax))),this}intersection(e){return this===e?this:e!=null&&this.intersects(e)?(this.xmin=Math.max(this.xmin,e.xmin),this.ymin=Math.max(this.ymin,e.ymin),this.xmax=Math.min(this.xmax,e.xmax),this.ymax=Math.min(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=pg(Math.max,this.zmin,e.zmin),this.zmax=pg(Math.min,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=pg(Math.max,this.mmin,e.mmin),this.mmax=pg(Math.min,this.mmax,e.mmax)),this):null}toJSON(e){return this.write({},e)}_shiftCM(e=Fv(this.spatialReference)){if(!e||!this.spatialReference)return this;const t=this.spatialReference,r=this._getCM(e);if(r){const i=t.isWebMercator?kO(r):r;this.xmin-=r.x,this.xmax-=r.x,t.isWebMercator||(i.x=this._normalizeX(i.x,e).x),this.spatialReference=new st(MD((t.isWGS84?e.altTemplate:null)??e.wkTemplate,{Central_Meridian:i.x}))}return this}_getCM(e){let t=null;const[r,i]=e.valid,s=this.xmin,n=this.xmax;return s>=r&&s<=i&&n>=r&&n<=i||(t=this.center),t}_normalize(e,t,r){const i=this.spatialReference;if(!i)return this;const s=r??Fv(i);if(s==null)return this;const n=this._getParts(s).map(l=>l.extent);if(n.length<2)return n[0]||this;if(n.length>2)return e?this._shiftCM(s):this.set({xmin:s.valid[0],xmax:s.valid[1]});if(e)return this._shiftCM(s);if(t)return n;let o=!0,a=!0;return n.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:n.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const u=(l.zmax-l.zmin)/2;for(let d=0;d<c.length;d++)c[d].push(u)}if(a){const u=(l.mmax-l.mmin)/2;for(let d=0;d<c.length;d++)c[d].push(u)}return c}),hasZ:o,hasM:a,spatialReference:i}}_getParts(e){let t=this.cache._parts;if(!t){t=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let u;e=e||Fv(o);const[d,p]=e.valid;u=this._normalizeX(this.xmin,e);const g=u.x,y=u.frameId;u=this._normalizeX(this.xmax,e);const _=u.x,v=u.frameId,w=g===_&&a>0;if(a>2*p){const T=new ru(l<c?g:_,s,p,n,o),x=new ru(d,s,l<c?_:g,n,o),S=new ru(0,s,p,n,o),O=new ru(d,s,0,n,o),A=[],$=[];T.contains(S)&&A.push(y),T.contains(O)&&$.push(y),x.contains(S)&&A.push(v),x.contains(O)&&$.push(v);for(let P=y+1;P<v;P++)A.push(P),$.push(P);t.push({extent:T,frameIds:[y]},{extent:x,frameIds:[v]},{extent:S,frameIds:A},{extent:O,frameIds:$})}else g>_||w?t.push({extent:new ru(g,s,p,n,o),frameIds:[y]},{extent:new ru(d,s,_,n,o),frameIds:[v]}):t.push({extent:new ru(g,s,_,n,o),frameIds:[y]});this.cache._parts=t}const r=this.hasZ,i=this.hasM;if(r||i){const s={};r&&(s.zmin=this.zmin,s.zmax=this.zmax),i&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<t.length;n++)t[n].extent.set(s)}return t}_normalizeX(e,t){const[r,i]=t.valid,s=2*i;let n,o=0;return e>i?(n=Math.ceil(Math.abs(e-i)/s),e-=n*s,o=n):e<r&&(n=Math.ceil(Math.abs(e-r)/s),e+=n*s,o=-n),{x:e,frameId:o}}};h([f({readOnly:!0})],Wn.prototype,"cache",null),h([f({readOnly:!0})],Wn.prototype,"center",null),h([f({readOnly:!0})],Wn.prototype,"extent",null),h([f({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Wn.prototype,"hasM",null),h([f({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Wn.prototype,"hasZ",null),h([f({readOnly:!0})],Wn.prototype,"height",null),h([f({readOnly:!0})],Wn.prototype,"width",null),h([f({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Wn.prototype,"xmin",void 0),h([f({type:Number,json:{write:!0}})],Wn.prototype,"ymin",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Wn.prototype,"mmin",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Wn.prototype,"zmin",void 0),h([f({type:Number,json:{write:!0}})],Wn.prototype,"xmax",void 0),h([f({type:Number,json:{write:!0}})],Wn.prototype,"ymax",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Wn.prototype,"mmax",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Wn.prototype,"zmax",void 0),Wn=ru=h([F("esri.geometry.Extent")],Wn),Wn.prototype.toJSON.isDefaultToJSON=!0;const Pr=Wn;function aT(e,t,r=!1){let{hasM:i,hasZ:s}=e;Array.isArray(t)?t.length!==4||i||s?t.length===3&&r&&!i?(s=!0,i=!1):t.length===3&&i&&s&&(i=!1,s=!1):(i=!0,s=!0):(s=!s&&t.hasZ&&(!i||t.hasM),i=!i&&t.hasM&&(!s||t.hasZ)),e.hasZ=s,e.hasM=i}var a9;function iZ(e){return(t,r)=>t==null?r:r==null?t:e(t,r)}function vRe(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}let qg=a9=class extends Iy{constructor(...e){super(...e),this.points=[],this.type="multipoint"}normalizeCtorArgs(e,t){if(!e&&!t)return{};const r={};Array.isArray(e)?(r.points=e,r.spatialReference=t):vRe(e)?r.spatialReference=e:(e.points&&(r.points=e.points),e.spatialReference&&(r.spatialReference=e.spatialReference),e.hasZ&&(r.hasZ=e.hasZ),e.hasM&&(r.hasM=e.hasM));const i=r.points&&r.points[0];return i&&(r.hasZ===void 0&&r.hasM===void 0?(r.hasZ=i.length>2,r.hasM=!1):r.hasZ===void 0?r.hasZ=i.length>3:r.hasM===void 0&&(r.hasM=i.length>3)),r}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const e=this.points;if(!e.length)return null;const t=new Pr,r=this.hasZ,i=this.hasM,s=r?3:2,n=e[0],o=iZ(Math.min),a=iZ(Math.max);let l,c,u,d,[p,g]=n,[y,_]=n;for(let v=0,w=e.length;v<w;v++){const T=e[v],[x,S]=T;if(p=o(p,x),g=o(g,S),y=a(y,x),_=a(_,S),r&&T.length>2){const O=T[2];l=o(l,O),u=a(u,O)}if(i&&T.length>s){const O=T[s];c=o(c,O),d=a(d,O)}}return t.xmin=p,t.ymin=g,t.xmax=y,t.ymax=_,t.spatialReference=this.spatialReference,r?(t.zmin=l,t.zmax=u):(t.zmin=void 0,t.zmax=void 0),i?(t.mmin=c,t.mmax=d):(t.mmin=void 0,t.mmax=void 0),t}writePoints(e,t){t.points=ye(this.points)}addPoint(e){return aT(this,e),Array.isArray(e)?this.points.push(e):this.points.push(e.toArray()),this.notifyChange("points"),this}clone(){const e={points:ye(this.points),spatialReference:this.spatialReference};return this.hasZ&&(e.hasZ=!0),this.hasM&&(e.hasM=!0),new a9(e)}getPoint(e){if(!this._validateInputs(e))return null;const t=this.points[e],r={x:t[0],y:t[1],spatialReference:this.spatialReference};let i=2;return this.hasZ&&(r.z=t[2],i=3),this.hasM&&(r.m=t[i]),new ut(r)}removePoint(e){if(!this._validateInputs(e))return null;const t=new ut(this.points.splice(e,1)[0],this.spatialReference);return this.notifyChange("points"),t}setPoint(e,t){return this._validateInputs(e)?(aT(this,t),Array.isArray(t)||(t=t.toArray()),this.points[e]=t,this.notifyChange("points"),this):this}toJSON(e){return this.write({},e)}_validateInputs(e){return e!=null&&e>=0&&e<this.points.length}};h([f({readOnly:!0})],qg.prototype,"cache",null),h([f()],qg.prototype,"extent",null),h([f({type:[[Number]],json:{write:{isRequired:!0}}})],qg.prototype,"points",void 0),h([Yt("points")],qg.prototype,"writePoints",null),qg=a9=h([F("esri.geometry.Multipoint")],qg),qg.prototype.toJSON.isDefaultToJSON=!0;const I3=qg;function pdt(e){const t=[];for(e.reset();e.nextPath();){const r=[];for(;e.nextPoint();)r.push([e.x,e.y]);t.push(r)}return e.reset(),t}function bRe(e){const t=[];for(;e.nextPoint();)t.push([e.x,e.y]);return e.seekPathStart(),t}function KD(e,t){const r=t[0]-e[0],i=t[1]-e[1];if(e.length>2&&t.length>2){const s=e[2]-t[2];return Math.sqrt(r*r+i*i+s*s)}return Math.sqrt(r*r+i*i)}function Gce(e,t,r){const i=e[0]+r*(t[0]-e[0]),s=e[1]+r*(t[1]-e[1]);return e.length>2&&t.length>2?[i,s,e[2]+r*(t[2]-e[2])]:[i,s]}function fdt(e,t,r,i){const[s,n]=t,[o,a]=r[i],[l,c]=r[i+1],u=l-o,d=c-a,p=u*u+d*d,g=(s-o)*u+(n-a)*d,y=Math.min(1,Math.max(0,g/p));return e[0]=o+u*y,e[1]=a+d*y,e}function mdt(e,t,r){let i,s,n,o,a=!1,l=1/0;for(r.reset();r.nextPath();)if(r.nextPoint())for(i=r.x,s=r.y;r.nextPoint();)n=r.x,o=r.y,s>t!=o>t&&e<(n-i)*(t-s)/(o-s)+i&&(a=!a),l=Math.min(l,wRe(e,t,i,s,n,o)),i=n,s=o;return l===0?0:(a?1:-1)*Math.sqrt(l)}function wRe(e,t,r,i,s,n){let o=r,a=i,l=s-o,c=n-a;if(l!==0||c!==0){const u=((e-o)*l+(t-a)*c)/(l*l+c*c);u>1?(o=s,a=n):u>0&&(o+=l*u,a+=c*u)}return l=e-o,c=t-a,l*l+c*c}function jce(e,t){return Gce(e,t,.5)}function Hce(e){const t=e.length;let r=0;for(let i=0;i<t-1;++i)r+=KD(e[i],e[i+1]);return r}function Wce(e,t){if(t<=0)return e[0];const r=e.length;let i=0;for(let s=0;s<r-1;++s){const n=KD(e[s],e[s+1]);if(t-i<n){const o=(t-i)/n;return Gce(e[s],e[s+1],o)}i+=n}return e[r-1]}function qce(e,t,r){const i=e.length;let s=0,n=0,o=0;for(let a=0;a<i;a++){const l=e[a],c=e[(a+1)%i];let u=2;s+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&r&&(n+=l[0]*c[2]-c[0]*l[2],u=3),l.length>u&&c.length>u&&t&&(o+=l[0]*c[u]-c[0]*l[u])}return s<=0&&n<=0&&o<=0}function xRe(e){const t=e.length;return t>2&&Om(e[0],e[t-1])}function gdt(e){if("rings"in e)for(const t of e.rings)xRe(t)||t.push(t[0].slice())}function ydt(e){if(!e||e.length<3)return 0;let t=0;const r=e.length-1;for(let i=0;i<r;i++)t+=(e[i][0]-e[i+1][0])*(e[i][1]+e[i+1][1]);return t+=(e[r][0]-e[0][0])*(e[r][1]+e[0][1]),-.5*t}function Xce(e){if(!e||e.numPoints<3)return 0;let t,r,i=0;if(e.seekPathStart(),!e.nextPoint())return 0;t=e.x,r=e.y;const s=t,n=r;for(;e.nextPoint();)i+=(t-e.x)*(r+e.y),t=e.x,r=e.y;return i+=(t-s)*(r+n),-.5*i}function _dt(e){return e?e.hasZ?[e.xmax-e.xmin/2,e.ymax-e.ymin/2,e.zmax-e.zmin/2]:[e.xmax-e.xmin/2,e.ymax-e.ymin/2]:null}function TRe(e){return e?Zce(e.rings,e.hasZ??!1):null}function Zce(e,t){if(!e||!e.length)return null;const r=[],i=[],s=t?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=e.length;n<o;n++){const a=Yce(e[n],t,s);a&&i.push(a)}if(i.sort((n,o)=>{let a=n[2]-o[2];return a===0&&t&&(a=n[4]-o[4]),a}),i.length&&(r[0]=i[0][0],r[1]=i[0][1],t&&(r[2]=i[0][3]),(r[0]<s[0]||r[0]>s[1]||r[1]<s[2]||r[1]>s[3]||t&&(r[2]<s[4]||r[2]>s[5]))&&(r.length=0)),!r.length){const n=e[0]&&e[0].length?SRe(e[0],t):null;if(!n)return null;r[0]=n[0],r[1]=n[1],t&&n.length>2&&(r[2]=n[2])}return r}function Yce(e,t,r){let i=0,s=0,n=0,o=0,a=0;const l=e.length?e[0][0]:0,c=e.length?e[0][1]:0,u=e.length&&t?e[0][2]:0;for(let p=0;p<e.length;p++){const g=e[p],y=e[(p+1)%e.length],[_,v,w]=g,T=_-l,x=v-c,[S,O,A]=y,$=S-l,P=O-c,U=T*P-$*x;if(o+=U,i+=(T+$)*U,s+=(x+P)*U,t&&g.length>2&&y.length>2){const I=w-u,L=A-u,N=T*L-$*I;n+=(I+L)*N,a+=N}_<r[0]&&(r[0]=_),_>r[1]&&(r[1]=_),v<r[2]&&(r[2]=v),v>r[3]&&(r[3]=v),t&&(w<r[4]&&(r[4]=w),w>r[5]&&(r[5]=w))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const d=[i/(6*o)+l,s/(6*o)+c,o];return t&&(r[4]===r[5]||a===0?(d[3]=(r[4]+r[5])/2,d[4]=0):(d[3]=n/(6*a)+u,d[4]=a)),d}function SRe(e,t){const r=t?[0,0,0]:[0,0],i=t?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=e.length;l<c-1;l++){const u=e[l],d=e[l+1];if(u&&d){r[0]=u[0],r[1]=u[1],i[0]=d[0],i[1]=d[1],t&&u.length>2&&d.length>2&&(r[2]=u[2],i[2]=d[2]);const p=KD(r,i);if(p){s+=p;const g=jce(u,d);n+=p*g[0],o+=p*g[1],t&&g.length>2&&(a+=p*g[2])}}}return s>0?t?[n/s,o/s,a/s]:[n/s,o/s]:e.length?e[0]:null}function ERe(e){const{hasZ:t,numPaths:r}=e;if(r===0)return null;const i=[],s=[],n=t?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(e.reset();e.nextPath();){const o=Yce(bRe(e),e.hasZ,n);o&&s.push(o)}if(s.sort((o,a)=>{let l=o[2]-a[2];return l===0&&t&&(l=o[4]-a[4]),l}),s.length&&(i[0]=s[0][0],i[1]=s[0][1],t&&(i[2]=s[0][3]),(i[0]<n[0]||i[0]>n[1]||i[1]<n[2]||i[1]>n[3]||t&&(i[2]<n[4]||i[2]>n[5]))&&(i.length=0)),!i.length){e.reset(),e.nextPath();const o=e.numPoints?CRe(e):null;if(!o)return null;i[0]=o[0],i[1]=o[1],t&&o.length>2&&(i[2]=o[2])}return i}function CRe(e){const{hasZ:t}=e,r=t?[0,0,0]:[0,0],i=t?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;if(e.nextPoint()){let l=e.x,c=e.y,u=e.z;for(;e.nextPoint();){const d=e.x,p=e.y,g=e.z;r[0]=l,r[1]=c,i[0]=d,i[1]=p,t&&(r[2]=u,i[2]=g);const y=KD(r,i);if(y){s+=y;const _=jce(r,i);n+=y*_[0],o+=y*_[1],t&&_.length>2&&(a+=y*_[2])}l=d,c=p,u=g}}return s>0?t?[n/s,o/s,a/s]:[n/s,o/s]:e.numPoints?(e.seekPathStart(),e.nextPoint(),[e.x,e.y]):null}const ARe=1e-6;function vdt(e){let t=0;for(e.reset();e.nextPath();)t+=Xce(e);if(t<ARe){const s=ERe(e);return s?[s[0],s[1]]:null}const r=[0,0];if(e.reset(),!e.nextPath()||!e.nextPoint())return null;const i=[e.x,e.y];for(e.reset();e.nextPath();)RRe(r,i,e);return r[0]*=1/t,r[1]*=1/t,r[0]+=i[0],r[1]+=i[1],r}const ORe=1/3;function RRe(e,t,r){if(!e||!r||r.numPoints<3)return null;r.nextPoint();const i=r.x,s=r.y;r.nextPoint();let n,o=r.x-i,a=r.y-s,l=0,c=0;for(;r.nextPoint();)l=r.x-i,c=r.y-s,n=.5*ORe*(l*a-c*o),e[0]+=n*(o+l),e[1]+=n*(a+c),o=l,a=c;const u=Xce(r),d=[i,s];return d[0]-=t[0],d[1]-=t[1],d[0]*=u,d[1]*=u,e[0]+=d[0],e[1]+=d[1],e}function Nt(e=$Re){return[e[0],e[1],e[2],e[3]]}function bdt(e){return[e[0],e[1],e[2],e[3]]}function Im(e,t){return e!==t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e}function k7(e,t,r,i,s=Nt()){return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s}function Jce(e,t=Nt()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax,t}function QD(e,t){return new Pr({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}function z7(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function ry(e,t,r){if(t!=null)if("length"in t)u9(t)?(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r[3]=Math.max(e[3],t[3])):t.length!==2&&t.length!==3||(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.max(e[2],t[0]),r[3]=Math.max(e[3],t[1]));else switch(t.type){case"extent":r[0]=Math.min(e[0],t.xmin),r[1]=Math.min(e[1],t.ymin),r[2]=Math.max(e[2],t.xmax),r[3]=Math.max(e[3],t.ymax);break;case"point":r[0]=Math.min(e[0],t.x),r[1]=Math.min(e[1],t.y),r[2]=Math.max(e[2],t.x),r[3]=Math.max(e[3],t.y)}else Im(r,e)}function K5(e,t,r=e){const i=t.length;let s=e[0],n=e[1],o=e[2],a=e[3];for(let l=0;l<i;l++){const c=t[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return r[0]=s,r[1]=n,r[2]=o,r[3]=a,r}function l9(e){for(let t=0;t<4;t++)if(!isFinite(e[t]))return!1;return!0}function bc(e){return e==null||e[0]>=e[2]?0:e[2]-e[0]}function yd(e){return e[1]>=e[3]?0:e[3]-e[1]}function Kce(e){return bc(e)*yd(e)}function B7(e,t=[0,0]){return t[0]=(e[0]+e[2])/2,t[1]=(e[1]+e[3])/2,t}function Qce(e,t){return eN(e,t[0],t[1])}function sZ(e,t){const r=t[3],i=.5*(e[0]+e[2]),s=Math.abs(t[0]-i),n=.5*(e[2]-e[0]);if(s>r+n)return!1;const o=.5*(e[1]+e[3]),a=.5*(e[3]-e[1]),l=Math.abs(t[1]-o);if(l>r+a)return!1;if(s<n||l<a)return!0;const c=s-n,u=l-a;return c*c+u*u<=r*r}function wdt(e,t,r){const i=e[0],s=e[1],n=e[2],o=e[3],{x:a,y:l}=t,{x:c,y:u}=r,d=(v,w)=>(u-l)*v+(a-c)*w+(c*l-a*u)<0,p=d(i,o),g=d(n,o),y=d(n,s),_=d(i,s);return!(p===g&&g===y&&y===_&&_===p||a<i&&c<i||a>n&&c>n||l>o&&u>o||l<s&&u<s)}function xdt(e,t){return eN(e,t.x,t.y)}function eN(e,t,r){return t>=e[0]&&r>=e[1]&&t<=e[2]&&r<=e[3]}function PRe(e,t,r){return t[0]>=e[0]-r&&t[1]>=e[1]-r&&t[0]<=e[2]+r&&t[1]<=e[3]+r}function tN(e,t){return Math.max(t[0],e[0])<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])<=Math.min(t[3],e[3])}function nZ(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}function c9(e,t,r){if(t==null)return Im(r,e);const i=t[0],s=t[1],n=t[2],o=t[3];return r[0]=fe(e[0],i,n),r[1]=fe(e[1],s,o),r[2]=fe(e[2],i,n),r[3]=fe(e[3],s,o),r}function MRe(e,t){const r=(e[0]+e[2])/2,i=(e[1]+e[3])/2,s=Math.max(Math.abs(t[0]-r)-bc(e)/2,0),n=Math.max(Math.abs(t[1]-i)-yd(e)/2,0);return Math.sqrt(s*s+n*n)}function B$(e,t,r,i=e){return i[0]=e[0]+t,i[1]=e[1]+r,i[2]=e[2]+t,i[3]=e[3]+r,i}function qu(e){return e?Im(e,h9):Nt(h9)}function u9(e){return e!=null&&e.length===4}function IRe(e){return!(bc(e)!==0&&isFinite(e[0])||yd(e)!==0&&isFinite(e[1]))}function kv(e,t){return u9(e)&&u9(t)?e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]:e===t}const Tdt=[-1/0,-1/0,1/0,1/0],h9=[1/0,1/0,-1/0,-1/0],$Re=[0,0,0,0];function eue(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function tue(e){return e.points!==void 0}function rue(e){return e.x!==void 0&&e.y!==void 0}function iue(e){return e.paths!==void 0}function sue(e){return e.rings!==void 0}function nue(e){function t(r,i){return r==null?i:i==null?r:e(r,i)}return t}const k0=nue(Math.min),z0=nue(Math.max);function Sdt(e,t){return iue(t)?lT(e,t.paths,!1,!1):sue(t)?lT(e,t.rings,!1,!1):tue(t)?V7(e,t.points,!1,!1,!1,!1):eue(t)?oue(e,t):(rue(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.x,e[3]=t.y),e)}function Edt(e){let t,r,i,s;for(e.reset(),t=i=1/0,r=s=-1/0;e.nextPath();){const n=LRe(e);t=Math.min(n[0],t),i=Math.min(n[1],i),r=Math.max(n[2],r),s=Math.max(n[3],s)}return Nt([t,i,r,s])}function LRe(e){let t,r,i,s;for(t=i=1/0,r=s=-1/0;e.nextPoint();)t=Math.min(e.x,t),i=Math.min(e.y,i),r=Math.max(e.x,r),s=Math.max(e.y,s);return Nt([t,i,r,s])}function Cdt(e,t){return iue(t)?lT(e,t.paths,!0,!1):sue(t)?lT(e,t.rings,!0,!1):tue(t)?V7(e,t.points,!0,!1,!0,!1):eue(t)?oue(e,t,!0,!1,!0,!1):(rue(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.x,e[4]=t.y,e[5]=t.z),e)}function lT(e,t,r,i){const s=r?3:2;if(!t.length||!t[0].length)return null;let n,o,a,l,[c,u]=t[0][0],[d,p]=t[0][0];for(let g=0;g<t.length;g++){const y=t[g];for(let _=0;_<y.length;_++){const v=y[_],[w,T]=v;if(c=k0(c,w),u=k0(u,T),d=z0(d,w),p=z0(p,T),r&&v.length>2){const x=v[2];n=k0(n,x),o=z0(o,x)}if(i&&v.length>s){const x=v[s];a=k0(n,x),l=z0(o,x)}}}return r?i?(e[0]=c,e[1]=u,e[2]=n,e[3]=a,e[4]=d,e[5]=p,e[6]=o,e[7]=l,e.length=8,e):(e[0]=c,e[1]=u,e[2]=n,e[3]=d,e[4]=p,e[5]=o,e.length=6,e):i?(e[0]=c,e[1]=u,e[2]=a,e[3]=d,e[4]=p,e[5]=l,e.length=6,e):(e[0]=c,e[1]=u,e[2]=d,e[3]=p,e.length=4,e)}function oue(e,t,r,i,s,n){const o=t.xmin,a=t.xmax,l=t.ymin,c=t.ymax;let u=t.zmin,d=t.zmax,p=t.mmin,g=t.mmax;return s?(u=u||0,d=d||0,n?(p=p||0,g=g||0,e[0]=o,e[1]=l,e[2]=u,e[3]=p,e[4]=a,e[5]=c,e[6]=d,e[7]=g,e):(e[0]=o,e[1]=l,e[2]=u,e[3]=a,e[4]=c,e[5]=d,e)):n?(p=p||0,g=g||0,e[0]=o,e[1]=l,e[2]=p,e[3]=a,e[4]=c,e[5]=g,e):(e[0]=o,e[1]=l,e[2]=a,e[3]=c,e)}function V7(e,t,r,i,s,n){const o=r?3:2,a=i&&n,l=r&&s;if(!t.length||!t[0].length)return null;let c,u,d,p,[g,y]=t[0],[_,v]=t[0];for(let w=0;w<t.length;w++){const T=t[w],[x,S]=T;if(g=k0(g,x),y=k0(y,S),_=z0(_,x),v=z0(v,S),l&&T.length>2){const O=T[2];c=k0(c,O),u=z0(u,O)}if(a&&T.length>o){const O=T[o];d=k0(c,O),p=z0(u,O)}}return s?(c=c||0,u=u||0,n?(d=d||0,p=p||0,e[0]=g,e[1]=y,e[2]=c,e[3]=d,e[4]=_,e[5]=v,e[6]=u,e[7]=p,e):(e[0]=g,e[1]=y,e[2]=c,e[3]=_,e[4]=v,e[5]=u,e)):n?(d=d||0,p=p||0,e[0]=g,e[1]=y,e[2]=d,e[3]=_,e[4]=v,e[5]=p,e):(e[0]=g,e[1]=y,e[2]=_,e[3]=v,e)}function DRe(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function NRe(e){return e.points!==void 0}function FRe(e){return e.x!==void 0&&e.y!==void 0}function URe(e){return e.paths!==void 0}function kRe(e){return e.rings!==void 0}const G7=[];function aue(e,t,r,i){return{xmin:e,ymin:t,xmax:r,ymax:i}}function lue(e,t,r,i,s,n){return{xmin:e,ymin:t,zmin:r,xmax:i,ymax:s,zmax:n}}function cue(e,t,r,i,s,n){return{xmin:e,ymin:t,mmin:r,xmax:i,ymax:s,mmax:n}}function uue(e,t,r,i,s,n,o,a){return{xmin:e,ymin:t,zmin:r,mmin:i,xmax:s,ymax:n,zmax:o,mmax:a}}function j7(e,t=!1,r=!1){return t?r?uue(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]):lue(e[0],e[1],e[2],e[3],e[4],e[5]):r?cue(e[0],e[1],e[2],e[3],e[4],e[5]):aue(e[0],e[1],e[2],e[3])}function Adt(e){return e?DRe(e)?e:FRe(e)?BRe(e):kRe(e)?hue(e):URe(e)?due(e):NRe(e)?zRe(e):null:null}function zRe(e){const{hasZ:t,hasM:r,points:i}=e;return j7(V7(G7,i,t??!1,r??!1),t,r)}function BRe(e){const{x:t,y:r,z:i,m:s}=e,n=s!=null;return i!=null?n?uue(t,r,i,s,t,r,i,s):lue(t,r,i,t,r,i):n?cue(t,r,s,t,r,s):aue(t,r,t,r)}function hue(e){const{hasZ:t,hasM:r,rings:i}=e,s=lT(G7,i,t??!1,r??!1);return s?j7(s,t,r):null}function due(e){const{hasZ:t,hasM:r,paths:i}=e,s=lT(G7,i,t??!1,r??!1);return s?j7(s,t,r):null}var EM;function oZ(e){return!Array.isArray(e[0])}let Kd=EM=class extends Iy{static fromExtent(e){const t=e.clone().normalize(),r=e.spatialReference;let i=!1,s=!1;for(const o of t)o.hasZ&&(i=!0),o.hasM&&(s=!0);const n={rings:t.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(i&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:r};return i&&(n.hasZ=!0),s&&(n.hasM=!0),new EM(n)}constructor(...e){super(...e),this.rings=[],this.type="polygon"}normalizeCtorArgs(e,t){let r,i,s=null,n=null;return e&&!Array.isArray(e)?(s=e.rings??null,t||(e.spatialReference?t=e.spatialReference:e.rings||(t=e)),r=e.hasZ,i=e.hasM):s=e,s=s||[],t=t||st.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=n.length>3):r===void 0?r=i?n.length>3:n.length>2:i===void 0&&(i=r?n.length>3:n.length>2)),{rings:s,spatialReference:t,hasZ:r,hasM:i}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const e=TRe(this);if(!e||isNaN(e[0])||isNaN(e[1])||this.hasZ&&isNaN(e[2]))return null;const t=new ut;return t.x=e[0],t.y=e[1],t.spatialReference=this.spatialReference,this.hasZ&&(t.z=e[2]),t}get extent(){const{spatialReference:e}=this,t=hue(this);if(!t)return null;const r=new Pr(t);return r.spatialReference=e,r}get isSelfIntersecting(){return gRe(this.rings)}writeRings(e,t){t.rings=ye(this.rings)}addRing(e){if(!e)return;const t=this.rings,r=t.length;if(oZ(e)){const i=[];for(let s=0,n=e.length;s<n;s++)i[s]=e[s].toArray();t[r]=i}else t[r]=e.concat();return this.notifyChange("rings"),this}clone(){const e=new EM;return e.spatialReference=this.spatialReference,e.rings=ye(this.rings),e.hasZ=this.hasZ,e.hasM=this.hasM,e}equals(e){if(this===e)return!0;if(e==null)return!1;const t=this.spatialReference,r=e.spatialReference;if(t!=null!=(r!=null)||t!=null&&r!=null&&!t.equals(r)||this.rings.length!==e.rings.length)return!1;const i=([s,n,o,a],[l,c,u,d])=>s===l&&n===c&&(o==null&&u==null||o===u)&&(a==null&&d==null||a===d);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=e.rings[s];if(!Om(n,o,i))return!1}return!0}contains(e){if(!e)return!1;const t=Y1(e,this.spatialReference);return oRe(this,t??e)}isClockwise(e){let t;return t=oZ(e)?e.map(r=>this.hasZ?this.hasM?[r.x,r.y,r.z,r.m]:[r.x,r.y,r.z]:[r.x,r.y]):e,qce(t,this.hasM,this.hasZ)}getPoint(e,t){if(!this._validateInputs(e,t))return null;const r=this.rings[e][t],i=this.hasZ,s=this.hasM;return i&&!s?new ut(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new ut(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new ut(r[0],r[1],r[2],r[3],this.spatialReference):new ut(r[0],r[1],this.spatialReference)}insertPoint(e,t,r){return this._validateInputs(e,t,!0)?(aT(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[e].splice(t,0,r),this.notifyChange("rings"),this):this}removePoint(e,t){if(!this._validateInputs(e,t))return null;const r=new ut(this.rings[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("rings"),r}removeRing(e){if(!this._validateInputs(e,null))return null;const t=this.rings.splice(e,1)[0],r=this.spatialReference,i=t.map(s=>new ut(s,r));return this.notifyChange("rings"),i}setPoint(e,t,r){return this._validateInputs(e,t)?(aT(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[e][t]=r,this.notifyChange("rings"),this):this}_validateInputs(e,t,r=!1){if(e==null||e<0||e>=this.rings.length)return!1;if(t!=null){const i=this.rings[e];if(r&&(t<0||t>i.length)||!r&&(t<0||t>=i.length))return!1}return!0}toJSON(e){return this.write({},e)}};h([f({readOnly:!0})],Kd.prototype,"cache",null),h([f({readOnly:!0})],Kd.prototype,"centroid",null),h([f({readOnly:!0})],Kd.prototype,"extent",null),h([f({readOnly:!0})],Kd.prototype,"isSelfIntersecting",null),h([f({type:[[[Number]]],json:{write:{isRequired:!0}}})],Kd.prototype,"rings",void 0),h([Yt("rings")],Kd.prototype,"writeRings",null),Kd=EM=h([F("esri.geometry.Polygon")],Kd),Kd.prototype.toJSON.isDefaultToJSON=!0;const J1=Kd;var d9;function VRe(e){return!Array.isArray(e[0])}let Xg=d9=class extends Iy{constructor(...e){super(...e),this.paths=[],this.type="polyline"}normalizeCtorArgs(e,t){let r,i,s=null,n=null;return e&&!Array.isArray(e)?(s=e.paths??null,t||(e.spatialReference?t=e.spatialReference:e.paths||(t=e)),r=e.hasZ,i=e.hasM):s=e,s=s||[],t=t||st.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=!1):r===void 0?r=!i&&n.length>3:i===void 0&&(i=!r&&n.length>3)),{paths:s,spatialReference:t,hasZ:r,hasM:i}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:e}=this,t=due(this);if(!t)return null;const r=new Pr(t);return r.spatialReference=e,r}writePaths(e,t){t.paths=ye(this.paths)}addPath(e){if(!e)return;const t=this.paths,r=t.length;if(VRe(e)){const i=[];for(let s=0,n=e.length;s<n;s++)i[s]=e[s].toArray();t[r]=i}else t[r]=e.concat();return this.notifyChange("paths"),this}clone(){const e=new d9;return e.spatialReference=this.spatialReference,e.paths=ye(this.paths),e.hasZ=this.hasZ,e.hasM=this.hasM,e}getPoint(e,t){if(!this._validateInputs(e,t))return null;const r=this.paths[e][t],i=this.hasZ,s=this.hasM;return i&&!s?new ut(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new ut(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new ut(r[0],r[1],r[2],r[3],this.spatialReference):new ut(r[0],r[1],this.spatialReference)}insertPoint(e,t,r){return this._validateInputs(e,t,!0)?(aT(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[e].splice(t,0,r),this.notifyChange("paths"),this):this}removePath(e){if(!this._validateInputs(e,null))return null;const t=this.paths.splice(e,1)[0],r=this.spatialReference,i=t.map(s=>new ut(s,r));return this.notifyChange("paths"),i}removePoint(e,t){if(!this._validateInputs(e,t))return null;const r=new ut(this.paths[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("paths"),r}setPoint(e,t,r){return this._validateInputs(e,t)?(aT(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[e][t]=r,this.notifyChange("paths"),this):this}_validateInputs(e,t,r=!1){if(e==null||e<0||e>=this.paths.length)return!1;if(t!=null){const i=this.paths[e];if(r&&(t<0||t>i.length)||!r&&(t<0||t>=i.length))return!1}return!0}toJSON(e){return this.write({},e)}};h([f({readOnly:!0})],Xg.prototype,"cache",null),h([f({readOnly:!0})],Xg.prototype,"extent",null),h([f({type:[[[Number]]],json:{write:{isRequired:!0}}})],Xg.prototype,"paths",void 0),h([Yt("paths")],Xg.prototype,"writePaths",null),Xg=d9=h([F("esri.geometry.Polyline")],Xg),Xg.prototype.toJSON.isDefaultToJSON=!0;const rN=Xg,GRe=jl()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),Odt=jl()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function pue(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function H7(e){return e.points!==void 0}function W7(e){return e.x!==void 0&&e.y!==void 0}function q7(e){return e.paths!==void 0}function X7(e){return e.rings!==void 0}function cT(e){return e==null?null:e instanceof Iy?e:W7(e)?ut.fromJSON(e):q7(e)?rN.fromJSON(e):X7(e)?J1.fromJSON(e):H7(e)?I3.fromJSON(e):pue(e)?Pr.fromJSON(e):null}function Z7(e){return e?W7(e)?"esriGeometryPoint":q7(e)?"esriGeometryPolyline":X7(e)?"esriGeometryPolygon":pue(e)?"esriGeometryEnvelope":H7(e)?"esriGeometryMultipoint":null:null}const jRe={esriGeometryPoint:ut,esriGeometryPolyline:rN,esriGeometryPolygon:J1,esriGeometryEnvelope:Pr,esriGeometryMultipoint:I3};function HRe(e){return e&&jRe[e]||null}const Y7={base:Iy,key:"type",typeMap:{extent:Pr,multipoint:I3,point:ut,polyline:rN,polygon:J1}};cy(Y7);var Zr;(function(e){e[e.ADD=1]="ADD",e[e.REMOVE=2]="REMOVE",e[e.MOVE=4]="MOVE"})(Zr||(Zr={}));function fue(e){return(t,r)=>{t[r]=e}}class iN extends Voe{notify(){const t=this._observers;if(t&&t.length>0){const r=t.slice();for(const i of r)i.onInvalidated(),i.onCommitted()}}}var im;class WRe{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(t){this.defaultPrevented=!1,this.item=t}}const jc=new fn(WRe,void 0,e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1}),qRe=()=>{};function Q5(e){return e?e instanceof hv?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function eF(e){if(e&&e.length)return e[0]}function XRe(e,t,r,i){const s=Math.min(e.length-r,t.length-i);let n=0;for(;n<s&&e[r+n]===t[i+n];)n++;return n}function mue(e,t,r,i){t&&t.forEach((s,n,o)=>{e.push(s),mue(e,r.call(i,s,n,o),r,i)})}const fg=new Set,mg=new Set,gg=new Set,tF=new Map;let ZRe=0,hv=im=class extends cs.EventedAccessor{static isCollection(e){return e!=null&&e instanceof im}constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new iN,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:ZRe++})}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof im?{items:e}:e:{}}destroy(){this._removeAllRaw()}*[Symbol.iterator](){yield*this.items}get items(){return Ft(this._observable),this._items}set items(e){this._emitBeforeChanges(Zr.ADD)||(this._splice(0,this.length,Q5(e)),this._emitAfterChanges(Zr.ADD))}hasEventListener(e){return e==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(e)}on(e,t){if(e==="change"){const r=this._chgListeners,i={removed:!1,callback:t};return r.push(i),this._notifications&&this._notifications.push({listeners:r.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=qRe,i.removed=!0,r.splice(r.indexOf(i),1)}}}return this._emitter.on(e,t)}once(e,t){const r=this.on(e,t);return{remove(){r.remove()}}}add(e,t){if(Ft(this._observable),this._emitBeforeChanges(Zr.ADD))return this;const r=this.getNextIndex(t??null);return this._splice(r,0,[e]),this._emitAfterChanges(Zr.ADD),this}addMany(e,t=this._items.length){if(Ft(this._observable),!e||!e.length)return this;if(this._emitBeforeChanges(Zr.ADD))return this;const r=this.getNextIndex(t);return this._splice(r,0,Q5(e)),this._emitAfterChanges(Zr.ADD),this}at(e){if(Ft(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(Ft(this._observable),!this.length||this._emitBeforeChanges(Zr.REMOVE))return[];const e=this._removeAllRaw();return this._emitAfterChanges(Zr.REMOVE),e}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return Ft(this._observable),this._createNewInstance({items:this._items.map(ye)})}concat(...e){Ft(this._observable);const t=e.map(Q5);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(Ft(this._observable),!this.length||this._emitBeforeChanges(Zr.REMOVE))return;const r=this._splice(0,this.length),i=r.length;for(let s=0;s<i;s++)e.call(t,r[s],s,r);this._emitAfterChanges(Zr.REMOVE)}every(e,t){return Ft(this._observable),this._items.every(e,t)}filter(e,t){let r;return Ft(this._observable),r=arguments.length===2?this._items.filter(e,t):this._items.filter(e),this._createNewInstance({items:r})}find(e,t){return Ft(this._observable),this._items.find(e,t)}findIndex(e,t){return Ft(this._observable),this._items.findIndex(e,t)}flatten(e,t){Ft(this._observable);const r=[];return mue(r,this,e,t),new im(r)}forEach(e,t){return Ft(this._observable),this._items.forEach(e,t)}getItemAt(e){return Ft(this._observable),this._items[e]}getNextIndex(e){Ft(this._observable);const t=this.length;return(e=e??t)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return Ft(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return Ft(this._observable),this._items.indexOf(e,t)}join(e=","){return Ft(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return Ft(this._observable),this._items.lastIndexOf(e,t)}map(e,t){Ft(this._observable);const r=this._items.map(e,t);return new im({items:r})}reorder(e,t=this.length-1){Ft(this._observable);const r=this.indexOf(e);if(r!==-1){if(t<0?t=0:t>=this.length&&(t=this.length-1),r!==t){if(this._emitBeforeChanges(Zr.MOVE))return e;this._splice(r,1),this._splice(t,0,[e]),this._emitAfterChanges(Zr.MOVE)}return e}}pop(){if(Ft(this._observable),!this.length||this._emitBeforeChanges(Zr.REMOVE))return;const e=eF(this._splice(this.length-1,1));return this._emitAfterChanges(Zr.REMOVE),e}push(...e){return Ft(this._observable),this._emitBeforeChanges(Zr.ADD)||(this._splice(this.length,0,e),this._emitAfterChanges(Zr.ADD)),this.length}reduce(e,t){Ft(this._observable);const r=this._items;return arguments.length===2?r.reduce(e,t):r.reduce(e)}reduceRight(e,t){Ft(this._observable);const r=this._items;return arguments.length===2?r.reduceRight(e,t):r.reduceRight(e)}remove(e){return Ft(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(Ft(this._observable),e<0||e>=this.length||this._emitBeforeChanges(Zr.REMOVE))return;const t=eF(this._splice(e,1));return this._emitAfterChanges(Zr.REMOVE),t}removeMany(e){if(Ft(this._observable),!e||!e.length||this._emitBeforeChanges(Zr.REMOVE))return[];const t=e instanceof im?e.toArray():e,r=this._items,i=[],s=t.length;for(let n=0;n<s;n++){const o=t[n],a=r.indexOf(o);if(a>-1){const l=1+XRe(t,r,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&i.push.apply(i,c),n+=l-1}}return this._emitAfterChanges(Zr.REMOVE),i}reverse(){if(Ft(this._observable),this._emitBeforeChanges(Zr.MOVE))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(Zr.MOVE),this}shift(){if(Ft(this._observable),!this.length||this._emitBeforeChanges(Zr.REMOVE))return;const e=eF(this._splice(0,1));return this._emitAfterChanges(Zr.REMOVE),e}slice(e=0,t=this.length){return Ft(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return Ft(this._observable),this._items.some(e,t)}sort(e){if(Ft(this._observable),!this.length||this._emitBeforeChanges(Zr.MOVE))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(Zr.MOVE),this}splice(e,t,...r){Ft(this._observable);const i=(t?Zr.REMOVE:0)|(r.length?Zr.ADD:0);if(this._emitBeforeChanges(i))return[];const s=this._splice(e,t,r)||[];return this._emitAfterChanges(i),s}toArray(){return Ft(this._observable),this._items.slice()}toJSON(){return Ft(this._observable),this.toArray()}toLocaleString(){return Ft(this._observable),this._items.toLocaleString()}toString(){return Ft(this._observable),this._items.toString()}unshift(...e){return Ft(this._observable),!e.length||this._emitBeforeChanges(Zr.ADD)||(this._splice(0,0,e),this._emitAfterChanges(Zr.ADD)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,r){const i=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=w3(()=>this._dispatchChange())),t){if(o=i.splice(e,t),this.hasEventListener("before-remove")){const a=jc.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),i.splice(e,0,n),e+=1,l-=1,c-=1);jc.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=jc.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);jc.release(a)}}if(r&&r.length){if(s){const u=[];for(const d of r){const p=s.ensureType(d);p==null&&d!=null||u.push(p)}r=u}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=e===this.length;if(a||l){const u=jc.acquire();u.target=this,u.cancellable=!0;const d=jc.acquire();d.target=this,d.cancellable=!1;for(const p of r)a?(u.reset(p),this.emit("before-add",u),u.defaultPrevented||(c?i.push(p):i.splice(e++,0,p),this._set("length",i.length),l&&(d.reset(p),this.emit("after-add",d)))):(c?i.push(p):i.splice(e++,0,p),this._set("length",i.length),d.reset(p),this.emit("after-add",d));jc.release(d),jc.release(u)}else{if(c)for(const u of r)i.push(u);else i.splice(e,0,...r);this._set("length",i.length)}}return(r&&r.length||o&&o.length)&&this._notifyChangeEvent(r,o),o}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const r=jc.acquire();r.target=this,r.cancellable=!0,r.type=e,this.emit("before-changes",r),t=r.defaultPrevented,jc.release(r)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=jc.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),jc.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const e=this._notifications;this._notifications=null;for(const t of e){const r=t.changes;fg.clear(),mg.clear(),gg.clear();for(const{added:l,removed:c}of r){if(l)if(gg.size===0&&mg.size===0)for(const u of l)fg.add(u);else for(const u of l)mg.has(u)?(gg.add(u),mg.delete(u)):gg.has(u)||fg.add(u);if(c)if(gg.size===0&&fg.size===0)for(const u of c)mg.add(u);else for(const u of c)fg.has(u)?fg.delete(u):(gg.delete(u),mg.add(u))}const i=Ol.acquire();fg.forEach(l=>{i.push(l)});const s=Ol.acquire();mg.forEach(l=>{s.push(l)});const n=this._items,o=t.items,a=Ol.acquire();if(gg.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),t.listeners&&(i.length||s.length||a.length)){const l={target:this,added:i,removed:s,moved:a},c=t.listeners.length;for(let u=0;u<c;u++){const d=t.listeners[u];d.removed||d.callback.call(this,l)}}Ol.release(i),Ol.release(s),Ol.release(a)}fg.clear(),mg.clear(),gg.clear()}};hv.ofType=e=>{if(!e)return im;if(tF.has(e))return tF.get(e);let t=null;if(typeof e=="function")t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(const i in e.typeMap){const s=e.typeMap[i].prototype.declaredClass;t?t+=` | ${s}`:t=s}let r=class extends im{};return h([fue({Type:e,ensureType:typeof e=="function"?ro(e):cy(e)})],r.prototype,"itemType",void 0),r=h([F(`esri.core.Collection<${t}>`)],r),tF.set(e,r),r},h([f()],hv.prototype,"length",void 0),h([f()],hv.prototype,"items",null),hv=im=h([F("esri.core.Collection")],hv);const Pt=hv;var uT;function YRe(e,t){switch(e.type){case"range":{const r="range"in e?e.range[0]:e.minValue,i="range"in e?e.range[1]:e.maxValue;if(r!=null&&+t<r||i!=null&&+t>i)return uT.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(e.codedValues==null||e.codedValues.every(r=>r==null||r.code!==t))return uT.INVALID_CODED_VALUE}return null}(function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(uT||(uT={}));const JRe=K.getLogger("esri.support.arcadeOnDemand");let rF;function J7(){return rF||(rF=(async()=>{const e=await ue(()=>import("./arcadeUtils.3adba2fe.js").then(function(t){return t.az}),["assets/arcadeUtils.3adba2fe.js","assets/arcadeTimeUtils.65bae7d6.js","assets/executionError.10e29c03.js","assets/FieldsIndex.09813895.js","assets/number.57f4f0d6.js","assets/hash.25af2a28.js"]);return{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),rF}const KRe=(e,t,r)=>$3.create(e,t,r,null,["$feature"],[]),QRe=(e,t,r)=>$3.create(e,t,r,null,["$feature","$view"],[]),Rdt=(e,t,r,i)=>$3.create(e,t,r,i,["$feature","$view"],[]);class $3{constructor(t,r,i,s,n,o,a){this.services=null,this.script=t,this.evaluate=s;const l=Array.isArray(o)?o:o.fields;this.fields=l,this._syntaxTree=i,this._arcade=r,this._arcadeFeature=n,this._spatialReference=a,this._referencesGeometry=r.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(t,r,i,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await J7(),u=st.fromJSON(r);let d;try{d=a.parseScript(t,o)}catch(P){return JRe.error(new G("arcade-bad-expression","Failed to parse arcade script",{script:t,error:P})),null}const p=n.reduce((P,U)=>({...P,[U]:null}),{});let g=null;s!=null&&(g=new c(s),g.immutable=!0,p.$config=null);const y=a.scriptUsesGeometryEngine(d),_=y&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(d)&&a.enableFeatureSetSupport(),w=a.scriptIsAsync(d),T=w&&a.enableAsyncSupport(),x={vars:p,spatialReference:u,useAsync:!!T};await Promise.all([_,v,T]);const S=new Set;await a.loadDependentModules(S,d,null,w,y);const O=new c;O.immutable=!1,O.setField("scale",0);const A=a.compileScript(d,x),$=(P,U)=>("$view"in P&&P.$view&&(O.setField("scale",typeof P.$view=="object"&&"scale"in P.$view?P.$view.scale:void 0),P.$view=O),g&&(P.$config=g),A({vars:P,spatialReference:u,services:U}));return new $3(t,a,d,$,new l,i,u)}repurposeFeature(t){return t.geometry&&!t.geometry.spatialReference&&(t.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(t.geometry,t.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}}const ePe=/^([0-9_])/,tPe=/[^a-z0-9_\u0080-\uffff]+/gi;function Pdt(e){return e==null?null:e.trim().replaceAll(tPe,"_").replace(ePe,"F$1")||null}const rPe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],iPe=["field","normalizationField"];function Mdt(e,t){if(e!=null&&t!=null){for(const r of Array.isArray(e)?e:[e])if(aZ(rPe,r,t),"visualVariables"in r&&r.visualVariables)for(const i of r.visualVariables)aZ(iPe,i,t)}}function aZ(e,t,r){if(e)for(const i of e){const s=um(i,t),n=s&&typeof s!="function"&&r.get(s);n&&i2(i,n.name,t)}}function Idt(e,t){if(e!=null&&t?.fields?.length)if("startField"in e){const r=t.get(e.startField),i=t.get(e.endField);e.startField=r?.name??null,e.endField=i?.name??null}else{const r=t.get(e.startTimeField),i=t.get(e.endTimeField);e.startTimeField=r?.name??null,e.endTimeField=i?.name??null}}const iF=new Set;function gue(e,t){return e&&t?(iF.clear(),uA(iF,e,t),Array.from(iF).sort()):[]}function uA(e,t,r){if(r)if(t?.fields?.length)if(r.includes("*"))for(const{name:i}of t.fields)e.add(i);else for(const i of r)sN(e,t,i);else{if(r.includes("*"))return e.clear(),void e.add("*");for(const i of r)i!=null&&e.add(i)}}function sN(e,t,r){if(typeof r=="string")if(t){const i=t.get(r);i&&e.add(i.name)}else e.add(r)}function $dt(e,t){return t==null||e==null?[]:t.includes("*")?(e.fields??[]).map(r=>r.name):t}async function py(e,t,r){if(!r)return;const{arcadeUtils:i}=await J7(),s=i.extractFieldNames(r,t?.fields?.map(n=>n.name));for(const n of s)sN(e,t,n)}async function yue(e,t,r){if(r&&r!=="1=1"){const{WhereClause:i}=await ue(()=>import("./WhereClause.c0b1e923.js").then(function(n){return n.W}),["assets/WhereClause.c0b1e923.js","assets/executionError.10e29c03.js"]),s=i.create(r,t);if(!s.isStandardized)throw new G("fieldUtils:collectFilterFields","Where clause is not standardized",{where:r});uA(e,t,s.fieldNames)}}function Ldt({displayField:e,fields:t}){return e||(t&&t.length?sF(t,"name-or-title")||sF(t,"unique-identifier")||sF(t,"type-or-category")||sPe(t):null)}function sPe(e){for(const t of e){if(!t||!t.name)continue;const r=t.name.toLowerCase();if(r.includes("name")||r.includes("title"))return t.name}return null}function sF(e,t){for(const r of e)if(r&&r.valueType&&r.valueType===t)return r.name;return null}async function Ddt(e,t){if(!t)return;const r=t.elevationInfo?.featureExpressionInfo;return r?r.collectRequiredFields(e,t.fieldsIndex):void 0}function nPe(e,t,r){r.onStatisticExpression?py(e,t,r.onStatisticExpression.expression):e.add(r.onStatisticField)}async function Ndt(e,t,r){if(!t||!r||!("fields"in r))return;const i=[],s=r.popupTemplate;i.push(oPe(e,t,s)),r.fields&&i.push(...r.fields.map(async n=>nPe(e,t.fieldsIndex,n))),await Promise.all(i)}async function oPe(e,t,r){const i=[];r?.expressionInfos&&i.push(...r.expressionInfos.map(n=>py(e,t.fieldsIndex,n.expression)));const s=r?.content;if(Array.isArray(s))for(const n of s)n.type==="expression"&&n.expressionInfo&&i.push(py(e,t.fieldsIndex,n.expressionInfo.expression));await Promise.all(i)}async function Fdt(e,t,r){t&&(t.timeInfo&&r!=null&&r.timeExtent&&uA(e,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),t.floorInfo&&uA(e,t.fieldsIndex,[t.floorInfo.floorField]),r!=null&&r.where!=null&&await yue(e,t.fieldsIndex,r.where))}async function Udt(e,t,r){t&&r&&await Promise.all(r.map(i=>aPe(e,t,i)))}async function aPe(e,t,r){t&&r&&(r.valueExpression?await py(e,t.fieldsIndex,r.valueExpression):r.field&&sN(e,t.fieldsIndex,r.field))}function kdt(e){return e?gue(e.fieldsIndex,_ue(e)):[]}function lPe(e){if(!e)return[];const t=e.geometryFieldsInfo;return t?gue(e.fieldsIndex,[t.shapeAreaField,t.shapeLengthField]):[]}const cPe=["oid","global-id","guid"],uPe=["oid","global-id"],hPe=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i];function dPe(e){const t=new Set;vue(e).forEach(i=>t.add(i)),lPe(e).forEach(i=>t.add(i.toLowerCase()));const r=e&&"infoFor3D"in e?e.infoFor3D:void 0;return r&&(Object.values(r.assetMapFieldRoles).forEach(i=>t.add(i.toLowerCase())),Object.values(r.transformFieldRoles).forEach(i=>t.add(i.toLowerCase()))),Array.from(t)}function _ue(e){if(!e)return[];const t="editFieldsInfo"in e&&e.editFieldsInfo;if(!t)return[];const{creationDateField:r,creatorField:i,editDateField:s,editorField:n}=t;return[r,i,s,n].filter(Boolean)}function vue(e){return _ue(e).map(t=>t.toLowerCase())}function zdt(e,t){return e.editable&&!cPe.includes(e.type)&&!vue(t).includes(e.name?.toLowerCase()??"")}function Bdt(e,t){const r=e.name?.toLowerCase()??"";return!(t?.objectIdField!=null&&r===t.objectIdField.toLowerCase()||t?.globalIdField!=null&&r===t.globalIdField.toLowerCase()||dPe(t).includes(r)||uPe.includes(e.type)||hPe.some(i=>i.test(r)))}async function Vdt(e,t){const{labelingInfo:r,fieldsIndex:i}=t;r&&r.length&&await Promise.all(r.map(s=>pPe(e,i,s)))}async function pPe(e,t,r){if(!r)return;const i=r.getLabelExpression(),s=r.where;if(i.type==="arcade")await py(e,t,i.expression);else{const n=i.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{sN(e,t,o.slice(1,-1))})}await yue(e,t,s)}function Gdt(e){const t=e.defaultValue;return t!==void 0&&xue(e,t)?t:e.nullable?null:void 0}function bue(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}function fPe(e){return e===null||bue(e)}const K7="isInteger"in Number?Number.isInteger:e=>typeof e=="number"&&isFinite(e)&&Math.floor(e)===e;function mPe(e){return e===null||K7(e)}function wue(e){return e!=null&&typeof e=="string"}function gPe(e){return e===null||wue(e)}function yPe(){return!0}function xue(e,t){let r;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":r=e.nullable?mPe:K7;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":r=e.nullable?fPe:bue;break;case"string":case"esriFieldTypeString":r=e.nullable?gPe:wue;break;default:r=yPe}return arguments.length===1?r:r(t)}const _Pe=["integer","small-integer","single","double"],vPe=new Set([..._Pe,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),bPe=["date","date-only","time-only","timestamp-offset"],wPe=new Set([...bPe,"esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function Tue(e){return e!=null&&vPe.has(e.type)}function jdt(e){return e!=null&&(e.type==="string"||e.type==="esriFieldTypeString")}function Hdt(e){return e!=null&&wPe.has(e.type)}var V$,G$;function Wdt(e){return e==null||typeof e=="number"&&isNaN(e)?null:e}function qdt(e,t){return e==null||e.nullable&&t===null?null:Tue(e)&&!xPe(e.type,Number(t))?V$.OUT_OF_RANGE:xue(e,t)?e.domain?YRe(e.domain,t):null:G$.INVALID_TYPE}function xPe(e,t){const r=typeof e=="string"?Sue(e):e;if(!r)return!1;const i=r.min,s=r.max;return r.isInteger?K7(t)&&t>=i&&t<=s:t>=i&&t<=s}function Sue(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return TPe;case"esriFieldTypeInteger":case"integer":return SPe;case"esriFieldTypeBigInteger":case"big-integer":return EPe;case"esriFieldTypeSingle":case"single":return CPe;case"esriFieldTypeDouble":case"double":return APe}}(function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(V$||(V$={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(G$||(G$={}));const TPe={min:-32768,max:32767,isInteger:!0},SPe={min:-2147483648,max:2147483647,isInteger:!0},EPe={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0},CPe={min:-34e37,max:12e37,isInteger:!1},APe={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function Xdt(e,t,r){switch(e){case uT.INVALID_CODED_VALUE:return`Value ${r} is not in the coded domain - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case uT.VALUE_OUT_OF_RANGE:return`Value ${r} is out of the range of valid values - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case G$.INVALID_TYPE:return`Value ${r} is not a valid value for the field type - field: ${t.name}, type: ${t.type}, nullable: ${t.nullable}`;case V$.OUT_OF_RANGE:{const{min:i,max:s}=Sue(t.type);return`Value ${r} is out of range for the number type - field: ${t.name}, type: ${t.type}, value range is ${i} to ${s}`}}}function Zdt(e,t){return!OPe(e,t,null)}function OPe(e,t,r){if(!t||!t.attributes||!e){if(r!=null)for(const n of e??[])r.add(n);return!0}const i=t.attributes;let s=!1;for(const n of e)if(!(n in i)){if(s=!0,r==null)break;r.add(n)}return s}function Ydt(e){return!!e&&["raster.itempixelvalue","raster.servicepixelvalue"].some(t=>e.toLowerCase().startsWith(t))}let CM=class extends Pe{constructor(e){super(e),this.type=null}};h([f({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],CM.prototype,"type",void 0),CM=h([F("esri.popup.content.Content")],CM);const $y=CM;var p9;let O_=p9=class extends $y{constructor(e){super(e),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new p9({description:this.description,displayType:this.displayType,title:this.title})}};h([f({type:String,json:{write:!0}})],O_.prototype,"description",void 0),h([f({type:["auto","preview","list"],json:{write:!0}})],O_.prototype,"displayType",void 0),h([f({type:String,json:{write:!0}})],O_.prototype,"title",void 0),h([f({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],O_.prototype,"type",void 0),O_=p9=h([F("esri.popup.content.AttachmentsContent")],O_);const j$=O_;var f9;let R_=f9=class extends $y{constructor(e){super(e),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new f9({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?ye(this.outFields):null})}};h([f()],R_.prototype,"creator",void 0),h([f()],R_.prototype,"destroyer",void 0),h([f()],R_.prototype,"outFields",void 0),h([f({type:["custom"],readOnly:!0})],R_.prototype,"type",void 0),R_=f9=h([F("esri.popup.content.CustomContent")],R_);const RPe=R_;var m9;let Tw=m9=class extends Pe{constructor(e){super(e),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new m9({title:this.title,expression:this.expression})}};h([f({type:String,json:{write:!0}})],Tw.prototype,"title",void 0),h([f({type:String,json:{write:!0}})],Tw.prototype,"expression",void 0),h([f({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],Tw.prototype,"returnType",void 0),Tw=m9=h([F("esri.popup.ElementExpressionInfo")],Tw);const PPe=Tw;var g9;let qS=g9=class extends $y{constructor(e){super(e),this.expressionInfo=null,this.type="expression"}clone(){return new g9({expressionInfo:this.expressionInfo?.clone()})}};h([f({type:PPe,json:{write:!0}})],qS.prototype,"expressionInfo",void 0),h([f({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],qS.prototype,"type",void 0),qS=g9=h([F("esri.popup.content.ExpressionContent")],qS);const Q7=qS;function Wt(e,t={}){const r=e instanceof kl?e:new kl(e,t),i={type:t?.ignoreUnknown??1?r.apiValues:String,json:{type:r.jsonValues,read:!t?.readOnly&&{reader:r.read},write:{writer:r.write}}};return t?.readOnly!==void 0&&(i.readOnly=!!t.readOnly),t?.default!==void 0&&(i.json.default=t.default),t?.name!==void 0&&(i.json.name=t.name),t?.nonNullable!==void 0&&(i.nonNullable=t.nonNullable),f(i)}let Sw=class extends of(Pe){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}formatNumber(e){return iT(e,_Ee(this))}formatDate(e,t=!1){return this.dateFormat?uy(e,{...HS(this.dateFormat),...t&&m7}):this.formatNumber(e)}formatDateOnly(e){const t=(this.dateFormat&&HS(this.dateFormat))??void 0;return pEe(e,t)}formatTimeOnly(e){const t=(this.dateFormat&&HS(this.dateFormat))??void 0;return fEe(e,t)}formatTimestamp(e){const t=(this.dateFormat&&HS(this.dateFormat))??void 0;return mEe(e,t)}formatRasterPixelValue(e){return e.includes("-")?e:e.trim().includes(",")?this._formatDelimitedString(e,",",", "):e.trim().includes(";")?this._formatDelimitedString(e,";","; "):e.trim().includes(" ")?this._formatDelimitedString(e," "," "):this.formatNumber(Number(e))}_formatDelimitedString(e,t,r){return e&&t&&r?e.trim().split(t).map(i=>this.formatNumber(Number(i))).join(r):e}};h([Wt(hEe)],Sw.prototype,"dateFormat",void 0),h([f({type:Boolean,json:{write:!0}})],Sw.prototype,"digitSeparator",void 0),h([f({type:Ps,json:{write:!0}})],Sw.prototype,"places",void 0),Sw=h([F("esri.popup.support.FieldInfoFormat")],Sw);const MPe=Sw;var y9;let Th=y9=class extends Pe{constructor(e){super(e),this.fieldName=null,this.format=null,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new y9({fieldName:this.fieldName,format:this.format?ye(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};h([f({type:String,json:{write:!0}})],Th.prototype,"fieldName",void 0),h([f({type:MPe,json:{write:!0}})],Th.prototype,"format",void 0),h([f({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],Th.prototype,"isEditable",void 0),h([f({type:String,json:{write:!0}})],Th.prototype,"label",void 0),h([Wt(new kl({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],Th.prototype,"stringFieldOption",void 0),h([f({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],Th.prototype,"statisticType",void 0),h([f({type:String,json:{write:!0}})],Th.prototype,"tooltip",void 0),h([f({type:Boolean,json:{write:!0}})],Th.prototype,"visible",void 0),Th=y9=h([F("esri.popup.FieldInfo")],Th);const Eue=Th;var _9;let Nf=_9=class extends $y{constructor(e){super(e),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(e,t){t.fieldInfos=e&&e.map(r=>r.toJSON())}clone(){return new _9(ye({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};h([f({type:Object,json:{write:!0}})],Nf.prototype,"attributes",void 0),h([f({type:String,json:{write:!0}})],Nf.prototype,"description",void 0),h([f({type:[Eue]})],Nf.prototype,"fieldInfos",void 0),h([Yt("fieldInfos")],Nf.prototype,"writeFieldInfos",null),h([f({type:String,json:{write:!0}})],Nf.prototype,"title",void 0),h([f({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],Nf.prototype,"type",void 0),Nf=_9=h([F("esri.popup.content.FieldsContent")],Nf);const H$=Nf;let P_=class extends Pe{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};h([f({type:String,json:{write:!0}})],P_.prototype,"altText",void 0),h([f({type:String,json:{write:!0}})],P_.prototype,"caption",void 0),h([f({type:String,json:{write:!0}})],P_.prototype,"title",void 0),h([f({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],P_.prototype,"type",void 0),P_=h([F("esri.popup.content.mixins.MediaInfo")],P_);const eG=P_;var v9;let Ew=v9=class extends xe{constructor(e){super(e),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new v9({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};h([f()],Ew.prototype,"fieldName",void 0),h([f()],Ew.prototype,"tooltip",void 0),h([f()],Ew.prototype,"value",void 0),Ew=v9=h([F("esri.popup.content.support.ChartMediaInfoValueSeries")],Ew);const IPe=Ew;var b9;let M_=b9=class extends Pe{constructor(e){super(e),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new b9({fields:ye(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};h([f({type:[String],json:{write:!0}})],M_.prototype,"fields",void 0),h([f({type:String,json:{write:!0}})],M_.prototype,"normalizeField",void 0),h([f({type:[IPe],json:{read:!1}})],M_.prototype,"series",void 0),h([f({type:String,json:{write:!0}})],M_.prototype,"tooltipField",void 0),M_=b9=h([F("esri.popup.content.support.ChartMediaInfoValue")],M_);const $Pe=M_;let XS=class extends eG{constructor(e){super(e),this.type=null,this.value=null}};h([f({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],XS.prototype,"type",void 0),h([f({type:$Pe,json:{write:!0}})],XS.prototype,"value",void 0),XS=h([F("esri.popup.content.mixins.ChartMediaInfo")],XS);const nN=XS,oN=jl()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var w9;let AM=w9=class extends nN{constructor(e){super(e),this.type="bar-chart"}clone(){return new w9({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};h([f({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:oN.write}})],AM.prototype,"type",void 0),AM=w9=h([F("esri.popup.content.BarChartMediaInfo")],AM);const Cue=AM;var x9;let OM=x9=class extends nN{constructor(e){super(e),this.type="column-chart"}clone(){return new x9({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};h([f({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:oN.write}})],OM.prototype,"type",void 0),OM=x9=h([F("esri.popup.content.ColumnChartMediaInfo")],OM);const Aue=OM;var T9;let ZS=T9=class extends Pe{constructor(e){super(e),this.linkURL=null,this.sourceURL=null}clone(){return new T9({linkURL:this.linkURL,sourceURL:this.sourceURL})}};h([f({type:String,json:{write:!0}})],ZS.prototype,"linkURL",void 0),h([f({type:String,json:{write:!0}})],ZS.prototype,"sourceURL",void 0),ZS=T9=h([F("esri.popup.content.support.ImageMediaInfoValue")],ZS);const LPe=ZS;var S9;let Cw=S9=class extends eG{constructor(e){super(e),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new S9({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};h([f({type:Number,json:{write:!0}})],Cw.prototype,"refreshInterval",void 0),h([f({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],Cw.prototype,"type",void 0),h([f({type:LPe,json:{write:!0}})],Cw.prototype,"value",void 0),Cw=S9=h([F("esri.popup.content.ImageMediaInfo")],Cw);const Oue=Cw;var E9;let RM=E9=class extends nN{constructor(e){super(e),this.type="line-chart"}clone(){return new E9({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};h([f({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:oN.write}})],RM.prototype,"type",void 0),RM=E9=h([F("esri.popup.content.LineChartMediaInfo")],RM);const Rue=RM;var C9;let PM=C9=class extends nN{constructor(e){super(e),this.type="pie-chart"}clone(){return new C9({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};h([f({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:oN.write}})],PM.prototype,"type",void 0),PM=C9=h([F("esri.popup.content.PieChartMediaInfo")],PM);const Pue=PM,Mue={base:eG,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":Cue,"column-chart":Aue,"line-chart":Rue,"pie-chart":Pue,image:Oue}};var A9;let Sh=A9=class extends $y{constructor(e){super(e),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(e){return e&&e.map(t=>t.type==="image"?Oue.fromJSON(t):t.type==="barchart"?Cue.fromJSON(t):t.type==="columnchart"?Aue.fromJSON(t):t.type==="linechart"?Rue.fromJSON(t):t.type==="piechart"?Pue.fromJSON(t):void 0).filter(Boolean)}writeMediaInfos(e,t){t.mediaInfos=e&&e.map(r=>r.toJSON())}clone(){return new A9(ye({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};h([f()],Sh.prototype,"activeMediaInfoIndex",void 0),h([f({type:Object,json:{write:!0}})],Sh.prototype,"attributes",void 0),h([f({type:String,json:{write:!0}})],Sh.prototype,"description",void 0),h([f({types:[Mue]})],Sh.prototype,"mediaInfos",void 0),h([br("mediaInfos")],Sh.prototype,"readMediaInfos",null),h([Yt("mediaInfos")],Sh.prototype,"writeMediaInfos",null),h([f({type:String,json:{write:!0}})],Sh.prototype,"title",void 0),h([f({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],Sh.prototype,"type",void 0),Sh=A9=h([F("esri.popup.content.MediaContent")],Sh);const W$=Sh;var O9;let YS=O9=class extends Pe{constructor(e){super(e),this.field=null,this.order=null}clone(){return new O9({field:this.field,order:this.order})}};h([f({type:String,json:{write:!0}})],YS.prototype,"field",void 0),h([f({type:["asc","desc"],json:{write:!0}})],YS.prototype,"order",void 0),YS=O9=h([F("esri.popup.support.RelatedRecordsInfoFieldOrder")],YS);const Iue=YS;let Qd=class extends of($y){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};h([f({type:String,json:{write:!0}})],Qd.prototype,"description",void 0),h([f({type:Number,json:{type:Ps,write:!0}})],Qd.prototype,"displayCount",void 0),h([f({type:["list"],json:{write:!0}})],Qd.prototype,"displayType",void 0),h([f({type:[Iue],json:{write:!0}})],Qd.prototype,"orderByFields",void 0),h([f({type:Number,json:{type:Ps,write:!0}})],Qd.prototype,"relationshipId",void 0),h([f({type:String,json:{write:!0}})],Qd.prototype,"title",void 0),h([f({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],Qd.prototype,"type",void 0),Qd=h([F("esri.popup.content.RelationshipContent")],Qd);const q$=Qd;var R9;let JS=R9=class extends $y{constructor(e){super(e),this.text=null,this.type="text"}clone(){return new R9({text:this.text})}};h([f({type:String,json:{write:!0}})],JS.prototype,"text",void 0),h([f({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],JS.prototype,"type",void 0),JS=R9=h([F("esri.popup.content.TextContent")],JS);const X$=JS,DPe={base:null,key:"type",typeMap:{attachment:j$,media:W$,text:X$,expression:Q7,field:H$,relationship:q$}};var P9;let I_=P9=class extends Pe{constructor(e){super(e),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new P9({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};h([f({type:String,json:{write:!0}})],I_.prototype,"name",void 0),h([f({type:String,json:{write:!0}})],I_.prototype,"title",void 0),h([f({type:String,json:{write:!0}})],I_.prototype,"expression",void 0),h([f({type:["string","number"],json:{write:!0}})],I_.prototype,"returnType",void 0),I_=P9=h([F("esri.popup.ExpressionInfo")],I_);const NPe=I_;var M9;let KS=M9=class extends Pe{constructor(e){super(e),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new M9({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};h([f({type:Boolean,json:{write:!0}})],KS.prototype,"returnTopmostRaster",void 0),h([f({type:Boolean,json:{write:!0}})],KS.prototype,"showNoDataRecords",void 0),KS=M9=h([F("esri.popup.LayerOptions")],KS);const FPe=KS;var I9;let QS=I9=class extends Pe{constructor(e){super(e),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new I9({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?ye(this.orderByFields):null})}};h([f({type:Boolean,json:{write:!0}})],QS.prototype,"showRelatedRecords",void 0),h([f({type:[Iue],json:{write:!0}})],QS.prototype,"orderByFields",void 0),QS=I9=h([F("esri.popup.RelatedRecordsInfo")],QS);const UPe=QS;let $ue=0;const tG=e=>{let t=class extends e{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+$ue++})}};return t=h([F("esri.core.Identifiable")],t),t},Jdt=e=>{let t=class extends e{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:$ue++})}};return t=h([F("esri.core.NumericIdentifiable")],t),t};let lZ=class extends tG(class{}){};lZ=h([F("esri.core.Identifiable")],lZ);var $9;let iu=$9=class extends tG(xe){constructor(e){super(e),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new $9({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};h([f()],iu.prototype,"active",void 0),h([f()],iu.prototype,"className",void 0),h([f()],iu.prototype,"disabled",void 0),h([f()],iu.prototype,"icon",void 0),h([f()],iu.prototype,"id",void 0),h([f()],iu.prototype,"indicator",void 0),h([f()],iu.prototype,"title",void 0),h([f()],iu.prototype,"type",void 0),h([f()],iu.prototype,"visible",void 0),iu=$9=h([F("esri.support.actions.ActionBase")],iu);const rG=iu;var L9;let MM=L9=class extends rG{constructor(e){super(e),this.image=null,this.type="button"}clone(){return new L9({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};h([f()],MM.prototype,"image",void 0),MM=L9=h([F("esri.support.Action.ActionButton")],MM);const kPe=MM;var D9;let eE=D9=class extends rG{constructor(e){super(e),this.image=null,this.type="toggle",this.value=!1}clone(){return new D9({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};h([f()],eE.prototype,"image",void 0),h([f()],eE.prototype,"value",void 0),eE=D9=h([F("esri.support.Action.ActionToggle")],eE);const zPe=eE,BPe="esri.PopupTemplate",VPe=K.getLogger(BPe),q2="relationships/",cZ="expression/",GPe=Pt.ofType({key:"type",defaultKeyValue:"button",base:rG,typeMap:{button:kPe,toggle:zPe}}),jPe={base:$y,key:"type",typeMap:{media:W$,custom:RPe,text:X$,attachments:j$,fields:H$,expression:Q7,relationship:q$}},HPe=["attachments","fields","media","text","expression","relationship"];let qn=class extends of(Pe){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(t=>cy(jPe,t)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||zc(e)?e:(VPe.error("content error","unsupported content value",{value:e}),null)}readContent(e,t){const{popupElements:r}=t;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(t.description,t.mediaInfos,r):this._readPopupInfo(t)}writeContent(e,t,r,i){typeof e!="string"?Array.isArray(e)&&(t.popupElements=e.filter(s=>HPe.includes(s.type)).map(s=>s&&s.toJSON(i)),t.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(t):s.type==="media"?this._writeMediaContent(s,t):s.type==="text"?this._writeTextContent(s,t):s.type==="relationship"&&this._writeRelationshipContent(s,t)})):t.description=e}writeFieldInfos(e,t,r,i){const{content:s}=this,n=Array.isArray(s)?s:null;if(e){const o=n?n.filter(l=>l.type==="fields"):[],a=o.length&&o.every(l=>l.fieldInfos?.length);t.fieldInfos=e.filter(Boolean).map(l=>{const c=l.toJSON(i);return a&&(c.visible=!1),c})}if(n)for(const o of n)o.type==="fields"&&this._writeFieldsContent(o,t)}writeLayerOptions(e,t,r,i){t[r]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(i)}writeTitle(e,t){t.title=e||""}async collectRequiredFields(e,t){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(e,t,[...r,...this._getContentExpressionInfos(this.content,r)]),uA(e,t,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const t=new Set;return await this.collectRequiredFields(t,e),[...t].sort()}_writeFieldsContent(e,t){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const r=ye(e.fieldInfos);Array.isArray(t.fieldInfos)?r.forEach(i=>{const s=t.fieldInfos.find(n=>n.fieldName.toLowerCase()===i.fieldName.toLowerCase());s?s.visible=!0:t.fieldInfos.push(i)}):t.fieldInfos=r}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,t){const r=e.orderByFields?.map(s=>this._toFieldOrderJSON(s,e.relationshipId))||[],i=[...t.relatedRecordsInfo?.orderByFields||[],...r];t.relatedRecordsInfo={showRelatedRecords:!0,...i?.length&&{orderByFields:i}}}_writeTextContent(e,t){!t.description&&e.text&&(t.description=e.text)}_writeMediaContent(e,t){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=ye(e.mediaInfos);Array.isArray(t.mediaInfos)?t.mediaInfos=[...t.mediaInfos,...r]:t.mediaInfos=r}_readPopupInfoElements(e,t,r){const i={description:!1,mediaInfos:!1};return r.map(s=>s.type==="media"?(s.mediaInfos||!t||i.mediaInfos||(s.mediaInfos=t,i.mediaInfos=!0),W$.fromJSON(s)):s.type==="text"?(s.text||!e||i.description||(s.text=e,i.description=!0),X$.fromJSON(s)):s.type==="attachments"?j$.fromJSON(s):s.type==="fields"?H$.fromJSON(s):s.type==="expression"?Q7.fromJSON(s):s.type==="relationship"?q$.fromJSON(s):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:t,order:r}=e;if(!t?.startsWith(q2))return null;const i=t.replace(q2,"").split("/");if(i.length!==2)return null;const s=parseInt(i[0],10),n=i[1];return typeof s=="number"&&n?q$.fromJSON({relationshipId:s,orderByFields:[{field:n,order:r}]}):null}_toFieldOrderJSON(e,t){const{order:r,field:i}=e;return{field:`${q2}${t}/${i}`,order:r}}_readPopupInfo({description:e,mediaInfos:t,showAttachments:r,relatedRecordsInfo:i={showRelatedRecords:!1}}){const s=[];e?s.push(new X$({text:e})):s.push(new H$),Array.isArray(t)&&t.length&&s.push(W$.fromJSON({mediaInfos:t})),r&&s.push(j$.fromJSON({displayType:"auto"}));const{showRelatedRecords:n,orderByFields:o}=i;return n&&o?.length&&o.forEach(a=>{const l=this._toRelationshipContent(a);l&&s.push(l)}),s.length?s:e}_getContentElementFields(e){const t=e?.type;if(t==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(t==="custom")return e.outFields||[];if(t==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(t==="media"){const r=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...r.reduce((i,s)=>[...i,...this._getMediaInfoFields(s)],[])]}return t==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:t,title:r,value:i}=e,s=i||{},{fields:n,normalizeField:o,tooltipField:a,sourceURL:l,linkURL:c}=s,u=[...this._extractFieldNames(r),...this._extractFieldNames(t),...this._extractFieldNames(l),...this._extractFieldNames(c),...n??[]];return o&&u.push(o),a&&u.push(a),u}_getContentExpressionInfos(e,t){return Array.isArray(e)?e.reduce((r,i)=>[...r,...i.type==="expression"&&i.expressionInfo?[i.expressionInfo]:[]],t):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((t,r)=>[...t,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(e,t,r){r&&await Promise.all(r.map(i=>py(e,t,i.expression)))}_getFieldInfoFields(e){return e?e.filter(t=>t.visible===void 0||!!t.visible).map(t=>t.fieldName).filter(t=>!t.startsWith(q2)&&!t.startsWith(cZ)):[]}_getActionsFields(e){return e?e.toArray().reduce((t,r)=>[...t,...this._getActionFields(r)],[]):[]}_getActionFields(e){const{className:t,title:r,type:i}=e,s=i==="button"||i==="toggle"?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(t),...this._extractFieldNames(s)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const t=/{[^}]*}/g,r=e.match(t);if(!r)return[];const i=/\{(\w+):.+\}/,s=r.filter(n=>!(n.indexOf(`{${q2}`)===0||n.indexOf(`{${cZ}`)===0)).map(n=>n.replace(i,"{$1}"));return s?s.map(n=>n.slice(1,-1)):[]}};h([f({type:GPe})],qn.prototype,"actions",void 0),h([f()],qn.prototype,"content",void 0),h([si("content")],qn.prototype,"castContent",null),h([br("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],qn.prototype,"readContent",null),h([Yt("content",{popupElements:{type:Pt.ofType(DPe)},showAttachments:{type:Boolean},mediaInfos:{type:Pt.ofType(Mue)},description:{type:String},relatedRecordsInfo:{type:UPe}})],qn.prototype,"writeContent",null),h([f({type:[NPe],json:{write:!0}})],qn.prototype,"expressionInfos",void 0),h([f({type:[Eue]})],qn.prototype,"fieldInfos",void 0),h([Yt("fieldInfos")],qn.prototype,"writeFieldInfos",null),h([f({type:FPe})],qn.prototype,"layerOptions",void 0),h([Yt("layerOptions")],qn.prototype,"writeLayerOptions",null),h([f({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],qn.prototype,"lastEditInfoEnabled",void 0),h([f()],qn.prototype,"outFields",void 0),h([f()],qn.prototype,"overwriteActions",void 0),h([f()],qn.prototype,"returnGeometry",void 0),h([f({json:{type:String}})],qn.prototype,"title",void 0),h([Yt("title")],qn.prototype,"writeTitle",null),qn=h([F("esri.PopupTemplate")],qn);const WPe=qn,uZ=new kl({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let qPe=0,Aw=class extends Pe{constructor(e){super(e),this.id="sym"+qPe++,this.type=null,this.color=new ot([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,t){}hash(){return JSON.stringify(this.toJSON())}clone(){}};h([f({type:uZ.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:uZ.write}}})],Aw.prototype,"type",void 0),h([f({type:ot,json:{write:{allowNull:!0}}})],Aw.prototype,"color",void 0),h([br("color")],Aw.prototype,"readColor",null),Aw=h([F("esri.symbols.Symbol")],Aw);const Bc=Aw;var N9;let Zg=N9=class extends Bc{constructor(e){super(e),this.data=null,this.type="cim"}readData(e,t){return t}writeData(e,t){Object.assign(t,e)}async collectRequiredFields(e,t){if(this.data?.type==="CIMSymbolReference"){const r=this.data.primitiveOverrides;if(r){const i=r.map(s=>{const n=s.valueExpressionInfo;return py(e,t,n.expression)});await Promise.all(i)}}}clone(){return new N9({data:ye(this.data)})}hash(){return qne(JSON.stringify(this.data)).toString()}};h([f({json:{write:!1}})],Zg.prototype,"color",void 0),h([f({json:{write:!0}})],Zg.prototype,"data",void 0),h([br("data",["symbol"])],Zg.prototype,"readData",null),h([Yt("data",{})],Zg.prototype,"writeData",null),h([Wt({CIMSymbolReference:"cim"},{readOnly:!0})],Zg.prototype,"type",void 0),Zg=N9=h([F("esri.symbols.CIMSymbol")],Zg);const L3=Zg;let Ow=class extends Pe{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,t,r){e||(t[r]=e)}};h([f({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],Ow.prototype,"enabled",void 0),h([Yt("enabled")],Ow.prototype,"writeEnabled",null),h([f({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],Ow.prototype,"type",void 0),Ow=h([F("esri.symbols.Symbol3DLayer")],Ow);const cf=Ow,XPe=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,ZPe="screenUtils.toPt: input not recognized!",Lue=96;function Ho(e){return e?e/72*Lue:0}function _d(e){return e?72*e/Lue:0}function Ms(e){if(typeof e=="string"){const t=e.match(XPe);if(t){const r=Number(t[1]),i=t[3]&&t[3].toLowerCase(),s=e.charAt(0)==="-",n=i==="px"?_d(r):r;return s?-n:n}return console.warn(ZPe),null}return e}function Xu(e=0,t=0){return{x:e,y:t}}function zi(e=0,t=0){return[e,t]}function Due(e=0,t=0){return[e,t]}function xo(e=0,t=0,r=0){return[e,t,r]}function Kdt(e){return e}function Qdt(e){return e}function ept(e){return e}function Sp(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]}function iG(e){const t=kV(100*(1-e));return Math.max(0,Math.min(t,100))}function hA(e){const t=1-e/100;return Math.max(0,Math.min(t,1))}function YPe(e,t){const r=t.transparency!=null?hA(t.transparency):1,i=t.color;return i&&Array.isArray(i)?new ot([i[0]||0,i[1]||0,i[2]||0,r]):null}function JPe(e,t){t.color=e.toJSON().slice(0,3);const r=iG(e.a);r!==0&&(t.transparency=r)}const Wm={type:ot,json:{type:[Ps],default:null,read:{source:["color","transparency"],reader:YPe},write:{target:{color:{type:[Ps]},transparency:{type:Ps}},writer:JPe}}},Xp={type:Number,cast:Ms,json:{write:!0}};let $_=class extends Pe{constructor(e){super(e),this.color=new ot([0,0,0,1]),this.extensionLength=0,this.size=_d(1)}clone(){}cloneProperties(){return{color:ye(this.color),size:this.size,extensionLength:this.extensionLength}}};h([f({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],$_.prototype,"type",void 0),h([f(Wm)],$_.prototype,"color",void 0),h([f({...Xp,json:{write:{overridePolicy:e=>({enabled:!!e})}}})],$_.prototype,"extensionLength",void 0),h([f(Xp)],$_.prototype,"size",void 0),$_=h([F("esri.symbols.edges.Edges3D")],$_);const sG=$_;var F9;let IM=F9=class extends sG{constructor(e){super(e),this.type="sketch"}clone(){return new F9(this.cloneProperties())}};h([Wt({sketch:"sketch"},{readOnly:!0})],IM.prototype,"type",void 0),IM=F9=h([F("esri.symbols.edges.SketchEdges3D")],IM);const KPe=IM;var U9;let $M=U9=class extends sG{constructor(e){super(e),this.type="solid"}clone(){return new U9(this.cloneProperties())}};h([Wt({solid:"solid"},{readOnly:!0})],$M.prototype,"type",void 0),$M=U9=h([F("esri.symbols.support.SolidEdges3D")],$M);const QPe=$M,Nue={types:{key:"type",base:sG,typeMap:{solid:QPe,sketch:KPe}},json:{write:!0}};var k9;let Ac=k9=class extends Pe{constructor(e){super(e),this.color=null}clone(){const e={color:this.color!=null?this.color.clone():null};return new k9(e)}};h([f(Wm)],Ac.prototype,"color",void 0),Ac=k9=h([F("esri.symbols.support.Symbol3DMaterial")],Ac);var z9;let Yg=z9=class extends cf{constructor(e){super(e),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new z9({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};h([Wt({Extrude:"extrude"},{readOnly:!0})],Yg.prototype,"type",void 0),h([f({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],Yg.prototype,"size",void 0),h([f({type:Ac,json:{write:!0}})],Yg.prototype,"material",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Yg.prototype,"castShadows",void 0),h([f(Nue)],Yg.prototype,"edges",void 0),Yg=z9=h([F("esri.symbols.ExtrudeSymbol3DLayer")],Yg);const Fue=Yg;let tE=class extends Bc{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};h([Wt({esriSLS:"simple-line"},{readOnly:!0})],tE.prototype,"type",void 0),h([f({type:Number,cast:Ms,json:{write:!0}})],tE.prototype,"width",void 0),tE=h([F("esri.symbols.LineSymbol")],tE);const eMe=tE,tMe=["begin","end","begin-end"],Uue=["arrow","circle","square","diamond","cross","x"];var B9;let ep=B9=class extends Pe{constructor(e){super(e),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(e,t,r,i){t[r]=i?.origin==="web-map"?"arrow":e}set color(e){this._set("color",e)}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}writeColor(e,t,r,i){i?.origin==="web-map"||(t[r]=e)}clone(){return new B9({color:ye(this.color),placement:this.placement,style:this.style})}hash(){return`${this.placement}.${this.color?.hash()}.${this.style}`}};h([f({type:["begin","end","begin-end"],json:{write:!0}})],ep.prototype,"placement",void 0),h([Wt({"line-marker":"line-marker"},{readOnly:!0}),f({json:{origins:{"web-map":{write:!1}}}})],ep.prototype,"type",void 0),h([f({type:Uue})],ep.prototype,"style",void 0),h([Yt("style")],ep.prototype,"writeStyle",null),h([f({type:ot,value:null,json:{write:{allowNull:!0}}})],ep.prototype,"color",null),h([br("color")],ep.prototype,"readColor",null),h([Yt("color")],ep.prototype,"writeColor",null),ep=B9=h([F("esri.symbols.LineSymbolMarker")],ep);const rMe=ep;var V9;const nF=new kl({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let Ff=V9=class extends eMe{constructor(...e){super(...e),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(e,t,r,i,s,n){if(e&&typeof e!="string")return e;const o={};return e!=null&&(o.style=e),t!=null&&(o.color=t),r!=null&&(o.width=Ms(r)),i!=null&&(o.cap=i),s!=null&&(o.join=s),n!=null&&(o.miterLimit=Ms(n)),o}clone(){return new V9({color:ye(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:this.marker?.clone()})}hash(){return`${super.hash()}.${this.color?.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${this.marker?.hash()}`}};h([Wt({esriSLS:"simple-line"},{readOnly:!0})],Ff.prototype,"type",void 0),h([f({type:nF.apiValues,json:{read:nF.read,write:nF.write}})],Ff.prototype,"style",void 0),h([f({type:["butt","round","square"],json:{write:{overridePolicy:(e,t,r)=>({enabled:e!=="round"&&(r==null||r.origin==null)})}}})],Ff.prototype,"cap",void 0),h([f({type:["miter","round","bevel"],json:{write:{overridePolicy:(e,t,r)=>({enabled:e!=="round"&&(r==null||r.origin==null)})}}})],Ff.prototype,"join",void 0),h([f({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":rMe}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],Ff.prototype,"marker",void 0),h([f({type:Number,json:{read:!1,write:!1}})],Ff.prototype,"miterLimit",void 0),Ff=V9=h([F("esri.symbols.SimpleLineSymbol")],Ff);const K1=Ff;let rE=class extends Bc{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};h([f({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":K1}},json:{default:null,write:!0}})],rE.prototype,"outline",void 0),h([f({type:["simple-fill","picture-fill"],readOnly:!0})],rE.prototype,"type",void 0),rE=h([F("esri.symbols.FillSymbol")],rE);const kue=rE;let LM=class extends Pe{constructor(e){super(e)}clone(){}};h([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],LM.prototype,"type",void 0),LM=h([F("esri.symbols.patterns.LinePattern3D")],LM);const zue=LM,iMe=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var G9;const sMe=jl()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let iE=G9=class extends zue{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new G9(e)}};h([f({type:["style"]})],iE.prototype,"type",void 0),h([Wt(sMe),f({type:iMe})],iE.prototype,"style",void 0),iE=G9=h([F("esri.symbols.patterns.LineStylePattern3D")],iE);const nG=iE;let DM=class extends Pe{constructor(e){super(e)}clone(){}};h([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],DM.prototype,"type",void 0),DM=h([F("esri.symbols.patterns.Pattern3D")],DM);const Bue=DM,nMe=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var j9;let sE=j9=class extends Bue{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new j9(e)}};h([f({type:["style"]})],sE.prototype,"type",void 0),h([f({type:nMe,json:{read:!0,write:!0}})],sE.prototype,"style",void 0),sE=j9=h([F("esri.symbols.patterns.StylePattern3D")],sE);const Vue=sE,oMe={types:{key:"type",base:Bue,typeMap:{style:Vue}},json:{write:!0}},Gue={types:{key:"type",base:zue,typeMap:{style:nG}},json:{write:!0}},hC=new ot("white");new ot("black");const aMe=new ot([255,255,255,0]);function lMe(e){return e.r===0&&e.g===0&&e.b===0}var H9;let dC=H9=class extends Ac{constructor(e){super(e),this.colorMixMode=null}clone(){const e={color:this.color!=null?this.color.clone():null,colorMixMode:this.colorMixMode};return new H9(e)}};h([Wt({multiply:"multiply",replace:"replace",tint:"tint"})],dC.prototype,"colorMixMode",void 0),dC=H9=h([F("esri.symbols.support.Symbol3DFillMaterial")],dC);function Qs(e=Xue){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function g1(e,t,r,i,s,n,o=Qs()){return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function tpt(e,t){const r=isFinite(e[2])||isFinite(e[5]);return new Pr(r?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:t}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:t})}function hT(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function cMe(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])}function Zp(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function Tc(e,t,r=0,i=t.length/3){let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];for(let u=0;u<i;u++)s=Math.min(s,t[r+3*u]),n=Math.min(n,t[r+3*u+1]),o=Math.min(o,t[r+3*u+2]),a=Math.max(a,t[r+3*u]),l=Math.max(l,t[r+3*u+1]),c=Math.max(c,t[r+3*u+2]);e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function oF(e,t,r){const i=t.length;let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];if(r)for(let u=0;u<i;u++){const d=t[u];s=Math.min(s,d[0]),n=Math.min(n,d[1]),o=Math.min(o,d[2]),a=Math.max(a,d[0]),l=Math.max(l,d[1]),c=Math.max(c,d[2])}else for(let u=0;u<i;u++){const d=t[u];s=Math.min(s,d[0]),n=Math.min(n,d[1]),a=Math.max(a,d[0]),l=Math.max(l,d[1])}e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function uMe(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0}function Q1(e){return e[0]>=e[3]?0:e[3]-e[0]}function eb(e){return e[1]>=e[4]?0:e[4]-e[1]}function Ly(e){return e[2]>=e[5]?0:e[5]-e[2]}function jue(e){const t=Q1(e),r=Ly(e),i=eb(e);return Math.sqrt(t*t+r*r+i*i)}function td(e,t=[0,0,0]){return t[0]=e[0]+Q1(e)/2,t[1]=e[1]+eb(e)/2,t[2]=e[2]+Ly(e)/2,t}function zO(e,t=[0,0,0]){return t[0]=Q1(e),t[1]=eb(e),t[2]=Ly(e),t}function oG(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function rpt(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]}function hMe(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function rd(e,t){return t==null||hMe(e,t)}function Hue(e,t,r,i,s=e){return s[0]=e[0]+t,s[1]=e[1]+r,s[2]=e[2]+i,s[3]=e[3]+t,s[4]=e[4]+r,s[5]=e[5]+i,s}function ipt(e,t,r=e){const i=e[0]+Q1(e)/2,s=e[1]+eb(e)/2,n=e[2]+Ly(e)/2;return r[0]=i+(e[0]-i)*t,r[1]=s+(e[1]-s)*t,r[2]=n+(e[2]-n)*t,r[3]=i+(e[3]-i)*t,r[4]=s+(e[4]-s)*t,r[5]=n+(e[5]-n)*t,r}function Wue(e,t,r=e){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r!==e&&(r[3]=e[3],r[4]=e[4],r[5]=e[5]),r}function que(e,t,r=e){return r[3]=t[0],r[4]=t[1],r[5]=t[2],r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),e}function aN(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function mi(e){return e?aN(e,hZ):Qs(hZ)}function aG(e,t){return t||(t=Nt()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t}function spt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function dMe(e,t,r,i,s){return e[0]=t,e[1]=r,e[2]=Number.NEGATIVE_INFINITY,e[3]=i,e[4]=s,e[5]=Number.POSITIVE_INFINITY,e}function W9(e){return e.length===6}function lG(e){return Q1(e)===0&&eb(e)===0&&Ly(e)===0}function npt(e,t,r){if(e==null||t==null)return e===t;if(!W9(e)||!W9(t))return!1;if(r){for(let i=0;i<e.length;i++)if(!r(e[i],t[i]))return!1}else for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function pMe(e,t,r,i,s,n){return g1(e,t,r,i,s,n,fMe)}const opt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],hZ=[1/0,1/0,1/0,-1/0,-1/0,-1/0],Xue=[0,0,0,0,0,0],fMe=Qs();function aF(e,{isPrimitive:t,width:r,depth:i,height:s}){const n=t?10:1;if(r==null&&s==null&&i==null)return[n*e[0],n*e[1],n*e[2]];const o=Ce(r,i,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/e[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=e[l]*a);return o}const mMe=g1(-.5,-.5,-.5,.5,.5,.5),gMe=g1(-.5,-.5,0,.5,.5,1),yMe=g1(-.5,-.5,0,.5,.5,.5);function _Me(e){switch(e){case"sphere":case"cube":case"diamond":return mMe;case"cylinder":case"cone":case"inverted-cone":return gMe;case"tetrahedron":return yMe;default:return}}const cG=["butt","square","round"],vMe=[...cG,"none"],Zue=["miter","bevel","round"];var q9;let L_=q9=class extends Pe{constructor(e){super(e),this.color=new ot([0,0,0,1]),this.size=_d(1),this.pattern=null,this.patternCap="butt"}clone(){const e={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new q9(e)}};h([f(Wm)],L_.prototype,"color",void 0),h([f(Xp)],L_.prototype,"size",void 0),h([f(Gue)],L_.prototype,"pattern",void 0),h([f({type:cG,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],L_.prototype,"patternCap",void 0),L_=q9=h([F("esri.symbols.support.Symbol3DOutline")],L_);var NM;let Uf=NM=class extends cf{constructor(e){super(e),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const e={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new NM(e)}static fromSimpleFillSymbol(e){const t=e.outline&&e.outline.style&&e.outline.style!=="inside-frame"&&e.outline.style!=="solid"?new nG({style:e.outline.style}):null,r={size:e.outline?.width??0,color:(e.outline?.color??hC).clone(),pattern:t};return t&&e.outline?.cap&&(r.patternCap=e.outline.cap),new NM({material:new dC({color:(e.color??aMe).clone()}),pattern:e.style&&e.style!=="solid"?new Vue({style:e.style}):null,outline:r})}};h([Wt({Fill:"fill"},{readOnly:!0})],Uf.prototype,"type",void 0),h([f({type:dC,json:{write:!0}})],Uf.prototype,"material",void 0),h([f(oMe)],Uf.prototype,"pattern",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Uf.prototype,"castShadows",void 0),h([f({type:L_,json:{write:!0}})],Uf.prototype,"outline",void 0),h([f(Nue)],Uf.prototype,"edges",void 0),Uf=NM=h([F("esri.symbols.FillSymbol3DLayer")],Uf);const D3=Uf,bMe=["none","underline","line-through"],wMe=["normal","italic","oblique"],xMe=["normal","lighter","bold","bolder"],Yue={type:Number,cast:e=>{const t=Xh(e);return t===0?1:fe(t,.1,4)},nonNullable:!0},TMe=["left","right","center"],SMe=["baseline","top","middle","bottom"],Jue={type:TMe,nonNullable:!0},Kue={type:SMe,nonNullable:!0},apt=8;var X9;let kf=X9=class extends Pe{constructor(e){super(e),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(e){return Ms(e)}clone(){return new X9({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};h([f({type:bMe,json:{default:"none",write:!0}})],kf.prototype,"decoration",void 0),h([f({type:String,json:{write:!0}})],kf.prototype,"family",void 0),h([f({type:Number,json:{write:{overridePolicy:(e,t,r)=>({enabled:!r||!r.textSymbol3D})}}})],kf.prototype,"size",void 0),h([si("size")],kf.prototype,"castSize",null),h([f({type:wMe,json:{default:"normal",write:!0}})],kf.prototype,"style",void 0),h([f({type:xMe,json:{default:"normal",write:!0}})],kf.prototype,"weight",void 0),kf=X9=h([F("esri.symbols.Font")],kf);const lN=kf;function y1(e,t){const r=t&&t.url&&t.url.path;if(e&&r&&(e=ja(e,r,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const i=ZV(e,t.portalItem.itemUrl);i!=null&&EMe.test(i)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(i).path)}return Z9(e,t&&t.portal)}function dT(e,t,r=dA.YES){if(e==null)return e;!Ec(e)&&t&&t.blockedRelativeUrls&&t.blockedRelativeUrls.push(e);let i=ja(e);if(t){const s=t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.rootPath||t.url&&t.url.path;if(s){const n=Z9(s,t.portal),o=Z9(i,t.portal);i=ZV(o,n,n),i!=null&&i!==o&&i!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(i)}}return i=ehe(i,t?.portal),Ec(i)&&(i=ld(i)),t?.resources&&t?.portalItem&&!Ec(i)&&!nf(i)&&r===dA.YES&&t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(i),compress:!1}),i}function uG(e,t,r){return y1(e,r)}function fy(e,t,r,i){const s=dT(e,i);s!==void 0&&(t[r]=s)}const Que=/\/items\/([^\/]+)\/resources\/(.*)/,EMe=/^\.\/resources\//;function CMe(e){return(e?.match(Que)??null)?.[1]??null}function AMe(e){const t=e?.match(Que)??null;if(t==null)return null;const r=t[2],i=r.lastIndexOf("/");if(i===-1){const{path:o,extension:a}=wq(r);return{prefix:null,filename:o,extension:a}}const{path:s,extension:n}=wq(r.slice(i+1));return{prefix:r.slice(0,i),filename:s,extension:n}}function ehe(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?R8(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function Z9(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const r=`${t.urlKey}.${t.customBaseUrl}`,i=WV();return wl(i,`${i.scheme}://${r}`)?R8(e,t.portalHostname,r):R8(e,r,t.portalHostname)}var dA;(function(e){e[e.YES=0]="YES",e[e.NO=1]="NO"})(dA||(dA={}));const lpt=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return dA},ensureMainOnlineDomain:ehe,fromJSON:y1,itemIdFromResourceUrl:CMe,prefixAndFilenameFromResourceUrl:AMe,read:uG,toJSON:dT,write:fy},Symbol.toStringTag,{value:"Module"}));var Y9;const OMe=jl()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let D_=Y9=class extends Pe{constructor(e){super(e)}readHref(e,t,r){return e?y1(e,r):t.dataURI}writeHref(e,t,r,i){e&&(nf(e)?t.dataURI=e:(t.href=dT(e,i),Ec(t.href)&&(t.href=ld(t.href))))}clone(){return new Y9({href:this.href,primitive:this.primitive})}};h([f({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],D_.prototype,"href",void 0),h([br("href")],D_.prototype,"readHref",null),h([Yt("href",{href:{type:String},dataURI:{type:String}})],D_.prototype,"writeHref",null),h([Wt(OMe)],D_.prototype,"primitive",void 0),D_=Y9=h([F("esri.symbols.support.IconSymbol3DLayerResource")],D_);const RMe="circle";var J9;let sx=J9=class extends xe{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new J9({x:this.x,y:this.y})}};h([f({type:Number})],sx.prototype,"x",void 0),h([f({type:Number})],sx.prototype,"y",void 0),sx=J9=h([F("esri.symbols.support.Symbol3DAnchorPosition2D")],sx);var K9;let nE=K9=class extends Pe{constructor(e){super(e),this.color=new ot([0,0,0,1]),this.size=_d(1)}clone(){const e={color:this.color!=null?this.color.clone():null,size:this.size};return new K9(e)}};h([f(Wm)],nE.prototype,"color",void 0),h([f(Xp)],nE.prototype,"size",void 0),nE=K9=h([F("esri.symbols.support.Symbol3DIconOutline")],nE);var Rw;const the="esri.symbols.IconSymbol3DLayer";let tp=Rw=class extends cf{constructor(e){super(e),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new Rw({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,outline:this.outline!=null?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(e){const t=e.color||hC,r=dZ(e),i=e.outline&&e.outline.width>0?{size:e.outline.width,color:(e.outline.color||hC).clone()}:null;return new Rw({size:e.size,resource:{primitive:MMe(e.style)},material:{color:t},outline:i,anchor:r?"relative":void 0,anchorPosition:r})}static fromPictureMarkerSymbol(e){const t=!e.color||lMe(e.color)?hC:e.color,r=dZ(e);return new Rw({size:e.width<=e.height?e.height:e.width,resource:{href:e.url},material:{color:t.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(e){return new Rw({resource:{href:Ooe({mediaType:"application/json",data:JSON.stringify(e.data)})}})}};function dZ(e){const t="width"in e?e.width:e.size,r="height"in e?e.height:e.size,i=pZ(e.xoffset),s=pZ(e.yoffset);return(i||s)&&t&&r?{x:-i/t,y:s/r}:null}function pZ(e){return isFinite(e)?e:0}h([f({type:Ac,json:{write:!0}})],tp.prototype,"material",void 0),h([f({type:D_,json:{write:!0}})],tp.prototype,"resource",void 0),h([Wt({Icon:"icon"},{readOnly:!0})],tp.prototype,"type",void 0),h([f(Xp)],tp.prototype,"size",void 0),h([Wt({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),f({json:{default:"center"}})],tp.prototype,"anchor",void 0),h([f({type:sx,json:{type:[Number],read:{reader:e=>new sx({x:e[0],y:e[1]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],tp.prototype,"anchorPosition",void 0),h([f({type:nE,json:{write:!0}})],tp.prototype,"outline",void 0),tp=Rw=h([F(the)],tp);const PMe={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function MMe(e){return PMe[e]||(K.getLogger(the).warn(`${e} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const B0=tp;function $m(e,t,r=Pt){return t||(t=new r),t===e||(t.removeAll(),IMe(e)?t.addMany(e):e&&t.add(e)),t}function hG(e){return e}function IMe(e){return e&&(Array.isArray(e)||"items"in e&&Array.isArray(e.items))}const $Me="not-loaded",LMe="loading",DMe="failed",fZ="loaded",rhe=e=>{let t=class extends e{constructor(...r){super(...r),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(i=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=ND(n,l);this.destroyed&&l(new G("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===$Me){this._set("loadStatus",LMe);const a=this._loadController=new AbortController;s({signal:a.signal}),Ws(a.signal,()=>{this._promiseProps.abort()})}return i(),o}})),this.when(()=>{this._set("loadStatus",fZ),this._loadController=null},i=>{this._set("loadStatus",DMe),this._set("loadError",i),this._loadController=null})}destroy(){this._loadController=$c(this._loadController),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===fZ}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){return this.isFulfilled()||(this._set("loadError",new G("load:cancelled","Cancelled")),this._loadController?.abort()),this}};return h([f({readOnly:!0})],t.prototype,"loaded",null),h([f({readOnly:!0})],t.prototype,"loadError",void 0),h([f({clonable:!1})],t.prototype,"loadStatus",void 0),h([f({type:[o1],readOnly:!0})],t.prototype,"loadWarnings",null),t=h([F("esri.core.Loadable")],t),t};let oE=class extends rhe(x$){};oE=h([F("esri.core.Loadable")],oE),function(e){function t(r){return!(!r||!r.load)}e.LoadableMixin=rhe,e.isLoadable=t}(oE||(oE={}));const Lm=oE;let BO;function NMe(e){return BO&&!BO.destroyed||(BO=e()),BO}var Q9;const FMe=new kl({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let su=Q9=class extends xe{constructor(e){super(e),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(e){e!=="asc"&&e!=="desc"||this._set("sortOrder",e)}clone(){return new Q9({categories:this.categories?ye(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(e,t){let r=[];this.categories&&(r=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let i="";if(this.extent){const o=Y1(this.extent,st.WGS84);o!=null&&(i=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&e.extraQuery&&(s="("+s+")"+e.extraQuery);const n={categories:r,bbox:i,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>FMe.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...t,...n}}}};h([f()],su.prototype,"categories",void 0),h([f()],su.prototype,"disableExtraQuery",void 0),h([f({type:Pr})],su.prototype,"extent",void 0),h([f()],su.prototype,"filter",void 0),h([f()],su.prototype,"num",void 0),h([f()],su.prototype,"query",void 0),h([f()],su.prototype,"sortField",void 0),h([f()],su.prototype,"sortOrder",null),h([f()],su.prototype,"start",void 0),su=Q9=h([F("esri.portal.PortalQueryParams")],su);const Ep=su;let N_=class extends xe{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};h([f()],N_.prototype,"nextQueryParams",void 0),h([f()],N_.prototype,"queryParams",void 0),h([f()],N_.prototype,"results",void 0),h([f()],N_.prototype,"total",void 0),N_=h([F("esri.portal.PortalQueryResult")],N_);const UMe=N_;let zf=class extends Pe{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new G("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};h([f({type:Date})],zf.prototype,"created",void 0),h([f()],zf.prototype,"id",void 0),h([f()],zf.prototype,"portal",void 0),h([f()],zf.prototype,"title",void 0),h([f({readOnly:!0})],zf.prototype,"url",null),h([f()],zf.prototype,"username",void 0),zf=h([F("esri.portal.PortalFolder")],zf);const kMe=zf;let Xn=class extends Pe{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t&&this.portal?this.portal?.normalizeUrl(`${e}/info/${t}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return Sl(this.portal).request(this.url+"/categorySchema",e).then(t=>{const r=t.categorySchema||[];return r.some(i=>i.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):r})}fetchMembers(e){return Sl(this.portal).request(this.url+"/users",e)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}toJSON(){throw new G("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,t){let r=ro(Ep,e);const i=Sl(this.portal);return parseFloat(i.currentVersion)>5?(r=r||new Ep,i.queryPortal(`/content/groups/${this.id}/search`,r,"PortalItem",t)):(r=r?r.clone():new Ep,r.query="group:"+this.id+(r.query?" "+r.query:""),i.queryItems(r,t))}_fetchCategorySchemaSet(e,t){const r=Sl(this.portal);return r.fetchSelf(r.authMode,!0,t).then(i=>{const s=i.contentCategorySetsGroupQuery;if(s){const n=new Ep;return n.disableExtraQuery=!0,n.num=1,n.query=s,r.queryGroups(n,t)}throw new G("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(i=>{if(i.total){const s=i.results[0],n=new Ep;return n.num=1,n.query=`typekeywords:"${e}"`,s.queryItems(n,t)}throw new G("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(i=>i.total?i.results[0].fetchData("json",t).then(s=>{const n=s&&s.categorySchema;return n&&n.length?n:[]}):[])}};h([f()],Xn.prototype,"access",void 0),h([f({type:Date})],Xn.prototype,"created",void 0),h([f()],Xn.prototype,"description",void 0),h([f()],Xn.prototype,"id",void 0),h([f()],Xn.prototype,"isInvitationOnly",void 0),h([f({type:Date})],Xn.prototype,"modified",void 0),h([f()],Xn.prototype,"owner",void 0),h([f()],Xn.prototype,"portal",void 0),h([f()],Xn.prototype,"snippet",void 0),h([f()],Xn.prototype,"sortField",void 0),h([f()],Xn.prototype,"sortOrder",void 0),h([f()],Xn.prototype,"tags",void 0),h([f()],Xn.prototype,"thumbnail",void 0),h([f({readOnly:!0})],Xn.prototype,"thumbnailUrl",null),h([f()],Xn.prototype,"title",void 0),h([f({readOnly:!0})],Xn.prototype,"url",null),Xn=h([F("esri.portal.PortalGroup")],Xn);const ek=Xn;var zMe=Object.freeze(Object.defineProperty({__proto__:null,default:ek},Symbol.toStringTag,{value:"Module"})),tk;let ts=tk=class extends Pe{constructor(...e){super(...e),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal.normalizeUrl(`${e}/info/${t}?f=json`):null}get userContentUrl(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}`:null}get url(){const e=this.get("portal.restUrl");return e?`${e}/community/users/${this.username}`:null}addItem(e){const t=e&&e.item,r=e&&e.data,i=e&&e.folder,s={method:"post"};t&&(s.query=t.createPostQuery(),r!=null&&(typeof r=="string"?s.query.text=r:typeof r=="object"&&(s.query.text=JSON.stringify(r))));let n=this.userContentUrl;return i&&(n+="/"+(typeof i=="string"?i:i.id)),this.portal.request(n+"/addItem",s).then(o=>(t.id=o.id,t.portal=this.portal,t.loaded?t.reload():t.load()))}deleteItem(e){let t=this.userContentUrl;return e.ownerFolder&&(t+="/"+e.ownerFolder),this.portal.request(t+`/items/${e.id}/delete`,{method:"post"}).then(()=>{e.id=null,e.portal=null})}deleteItems(e){const t=this.userContentUrl+"/deleteItems",r=e.map(i=>i.id);if(r.length){const i={method:"post",query:{items:r.join(",")}};return this.portal.request(t,i).then(()=>{e.forEach(s=>{s.id=null,s.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const e={query:{num:1}};return this.portal.request(this.userContentUrl??"",e).then(t=>{let r;return r=t&&t.folders?t.folders.map(i=>{const s=kMe.fromJSON(i);return s.portal=this.portal,s}):[],r})}fetchGroups(){return this.portal.request(this.url??"").then(e=>{let t;return t=e&&e.groups?e.groups.map(r=>{const i=ek.fromJSON(r);return i.portal=this.portal,i}):[],t})}fetchItems(e){const t=e??{};let r,i=this.userContentUrl??"";return t.folder&&(i+="/"+t.folder.id),ue(()=>Promise.resolve().then(function(){return lpe}),void 0).then(({default:s})=>{r=s;const n={folders:!1,num:t.num||10,start:t.start||1,sortField:t.sortField||"created",sortOrder:t.sortOrder||"asc"};return this.portal.request(i,{query:n})}).then(s=>{let n;return s&&s.items?(n=s.items.map(o=>{const a=r.fromJSON(o);return a.portal=this.portal,a}),Promise.all(n.map(o=>o.load())).catch(o=>o).then(()=>({items:n,nextStart:s.nextStart,total:s.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(e=>e.tags)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}queryFavorites(e){return this.favGroupId?(this._favGroup||(this._favGroup=new ek({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(e)):Promise.reject(new G("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new G("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new tk;return t.sourceJSON=e,t.read(e),t}};h([f()],ts.prototype,"access",void 0),h([f({type:Date})],ts.prototype,"created",void 0),h([f()],ts.prototype,"culture",void 0),h([f()],ts.prototype,"description",void 0),h([f()],ts.prototype,"email",void 0),h([f()],ts.prototype,"favGroupId",void 0),h([f()],ts.prototype,"fullName",void 0),h([f({type:Date})],ts.prototype,"modified",void 0),h([f()],ts.prototype,"orgId",void 0),h([f()],ts.prototype,"portal",void 0),h([f()],ts.prototype,"preferredView",void 0),h([f()],ts.prototype,"privileges",void 0),h([f()],ts.prototype,"region",void 0),h([f()],ts.prototype,"role",void 0),h([f()],ts.prototype,"roleId",void 0),h([f()],ts.prototype,"sourceJSON",void 0),h([f()],ts.prototype,"thumbnail",void 0),h([f({readOnly:!0})],ts.prototype,"thumbnailUrl",null),h([f()],ts.prototype,"units",void 0),h([f({readOnly:!0})],ts.prototype,"userContentUrl",null),h([f({readOnly:!0})],ts.prototype,"url",null),h([f()],ts.prototype,"username",void 0),h([f()],ts.prototype,"userType",void 0),ts=tk=h([F("esri.portal.PortalUser")],ts);const ihe=ts;var BMe=Object.freeze(Object.defineProperty({__proto__:null,default:ihe},Symbol.toStringTag,{value:"Module"})),Bf;let VO;const mZ={PortalGroup:()=>ue(()=>Promise.resolve().then(function(){return zMe}),void 0),PortalItem:()=>ue(()=>Promise.resolve().then(function(){return lpe}),void 0),PortalUser:()=>ue(()=>Promise.resolve().then(function(){return BMe}),void 0)};let Me=Bf=class extends M3(Lm){constructor(e){super(e),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=Or.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(e){return typeof e=="string"?{url:e}:e}destroy(){gZ.unregister(this),this.defaultBasemap=Re(this.defaultBasemap),this.defaultDevBasemap=Re(this.defaultDevBasemap),this.defaultVectorBasemap=Re(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=xi(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(e){if(e)for(const t of e)Or.request.trustedServers.includes(t)||Or.request.trustedServers.push(t);return e}readDefaultBasemap(e){return this._readBasemap(e)}readDefaultDevBasemap(e){return this._readBasemap(e)}readDefaultVectorBasemap(e){return this._readBasemap(e)}get extraQuery(){const e=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let e=this.url;if(e){const t=e.indexOf("/sharing");e=t>0?e.substring(0,t):this.url.replace(/\/+$/,""),e+="/sharing/rest"}return e}get thumbnailUrl(){const e=this.restUrl,t=this.thumbnail;return e&&t?this._normalizeSSL(e+"/portals/self/resources/"+t):null}readUrlKey(e){return e&&e.toLowerCase()}readUser(e){let t=null;return e&&(t=ihe.fromJSON(e),t.portal=this),t}load(e){const t=ue(()=>Promise.resolve().then(function(){return jDe}),void 0).then(({default:r})=>{Jt(e),VO=r}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,e)).then(r=>{if(ar){const i=ar;this.credential=i.findCredential(this.restUrl),this.credential||this.authMode!==Bf.AUTH_MODE_AUTO||(this._esriIdCredentialCreateHandle?.remove(),this._esriIdCredentialCreateHandle=i.on("credential-create",VMe(new WeakRef(this))),gZ.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(t),Promise.resolve(this)}async createElevationLayers(){await this.load();const e=this._getHelperService("defaultElevationLayers"),t=(await ue(()=>import("./ElevationLayer.cf56593c.js"),["assets/ElevationLayer.cf56593c.js","assets/ArcGISCachedService.92b623b2.js","assets/TileInfoTilemapCache.01f05855.js","assets/TilemapCache.dd73177a.js","assets/ArcGISService.116191b2.js","assets/PortalLayer.9c2e677f.js","assets/portalItemUtils.ea6f2bf4.js"])).default;return e?e.map(r=>new t({id:r.id,url:r.url})):[]}async fetchBasemaps(e,t){const r=await this._fetchBasemaps(e,t);if(t?.include3d===!0&&this.use3dBasemaps!==!1){const i=await this._fetchBasemaps3D(e,t);r.unshift(...i)}return r}fetchCategorySchema(e){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",e).then(t=>t.categorySchema):Hs(e)?Promise.reject(Cr()):Promise.resolve([])}fetchFeaturedGroups(e){const t=this.featuredGroups,r=new Ep;if(r.num=100,r.sortField="title",t&&t.length){const i=[];for(const s of t)i.push(`(title:"${s.title}" AND owner:${s.owner})`);return r.query=i.join(" OR "),this.queryGroups(r,e).then(s=>s.results)}return Hs(e)?Promise.reject(Cr()):Promise.resolve([])}fetchRegions(e){const t=this.user?.culture||this.culture||ud();return this.request(this.restUrl+"/portals/regions",{...e,query:{culture:t}})}fetchSettings(e){const t=this.user?.culture||this.culture||ud();return this.request(this.restUrl+"/portals/self/settings",{...e,query:{culture:t}})}static getDefault(){return NMe(()=>new Bf)}queryGroups(e,t){return this.queryPortal("/community/groups",e,"PortalGroup",t)}queryItems(e,t){return this.queryPortal("/search",e,"PortalItem",t)}queryUsers(e,t){return e.sortField||(e.sortField="username"),this.queryPortal("/community/users",e,"PortalUser",t)}fetchSelf(e=this.authMode,t=!1,r){const i=this.restUrl+"/portals/self",s={authMode:e,query:{culture:ud().toLowerCase()},...r};return s.authMode==="auto"&&(s.authMode="no-prompt"),t&&(s.query.default=!0),this.request(i,s)}queryPortal(e,t,r,i){const s=ro(Ep,t),n=o=>this.request(this.restUrl+e,{...s.toRequestOptions(this),...i}).then(a=>{const l=s.clone();return l.start=a.nextStart,new UMe({nextQueryParams:l,queryParams:s,total:a.total,results:Bf._resultsToTypedArray(o,{portal:this},a,i)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(W1(l),a)));return r&&mZ[r]?mZ[r]().then(({default:o})=>(Jt(i),n(o))):n()}signIn(){if(this.authMode===Bf.AUTH_MODE_ANONYMOUS)return Promise.reject(new G("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const e=t=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(t||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=t,this.fetchSelf("immediate"))):this.user&&this.credential===t?null:(this.credential=t,this.fetchSelf("immediate"))).then(r=>{r&&(this.sourceJSON=r,this.read(r))});return ar?ar.getCredential(this.restUrl).then(t=>e(t)):e(this.credential)}normalizeUrl(e){const t=this.credential&&this.credential.token;return this._normalizeSSL(t?e+(e.includes("?")?"&":"?")+"token="+t:e)}requestToTypedArray(e,t,r){return this.request(e,t).then(i=>{const s=Bf._resultsToTypedArray(r,{portal:this},i);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():i)).then(()=>s,()=>s)})}request(e,t={}){const r={f:"json",...t.query},{authMode:i=this.authMode===Bf.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=t,c={authMode:i,body:s,cacheBust:n,method:o,query:r,responseType:a,timeout:0,signal:l};return ii(this._normalizeSSL(e),c).then(u=>u.data)}toJSON(){throw new G("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new Bf({sourceJSON:e})}_getHelperService(e){const t=this.helperServices&&this.helperServices[e];if(!t)throw new G("portal:service-not-found",`The \`helperServices\` do not include an entry named "${e}"`);return t}async _fetchBasemaps(e,t){const r=new Ep;r.query=e||(Or.apiKey&&Noe(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0;const i=await this.queryGroups(r,t);if(!i.total)return[];const s=i.results[0];r.num=100,r.query='type:"Web Map" -type:"Web Application"',r.sortField=s.sortField||"name",r.sortOrder=s.sortOrder||"desc";const n=await s.queryItems(r,t);return n.total?n.results.filter(o=>o.type==="Web Map").map(o=>new VO({portalItem:o})):[]}async _fetchBasemaps3D(e,t){const r=e||this.basemapGalleryGroupQuery3D;if(!r)return[];const i=new Ep({query:r,disableExtraQuery:!0}),s=await this.queryGroups(i,t);if(!s.total)return[];const n=s.results[0];i.num=100,i.query='type:"Web Scene"',i.sortField=n.sortField||"name",i.sortOrder=n.sortOrder||"desc";const o=await n.queryItems(i,t);return o.total?o.results.filter(a=>a.type==="Web Scene").map(a=>new VO({portalItem:a})):[]}_normalizeSSL(e){return e.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(e){if(e){const t=VO.fromJSON(e);return t.portalItem={portal:this},t}return null}static _resultsToTypedArray(e,t,r,i){let s=[];if(r){const n=i!=null?i.signal:null;s=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(e||t)&&(s=s.map(o=>{const a=Object.assign(e?e.fromJSON(o):o,t);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};Me.AUTH_MODE_ANONYMOUS="anonymous",Me.AUTH_MODE_AUTO="auto",Me.AUTH_MODE_IMMEDIATE="immediate",h([f()],Me.prototype,"access",void 0),h([f()],Me.prototype,"allSSL",void 0),h([f()],Me.prototype,"authMode",void 0),h([f()],Me.prototype,"authorizedCrossOriginDomains",void 0),h([br("authorizedCrossOriginDomains")],Me.prototype,"readAuthorizedCrossOriginDomains",null),h([f()],Me.prototype,"basemapGalleryGroupQuery",void 0),h([f({json:{name:"3DBasemapGalleryGroupQuery"}})],Me.prototype,"basemapGalleryGroupQuery3D",void 0),h([f()],Me.prototype,"bingKey",void 0),h([f()],Me.prototype,"canListApps",void 0),h([f()],Me.prototype,"canListData",void 0),h([f()],Me.prototype,"canListPreProvisionedItems",void 0),h([f()],Me.prototype,"canProvisionDirectPurchase",void 0),h([f()],Me.prototype,"canSearchPublic",void 0),h([f()],Me.prototype,"canShareBingPublic",void 0),h([f()],Me.prototype,"canSharePublic",void 0),h([f()],Me.prototype,"canSignInArcGIS",void 0),h([f()],Me.prototype,"canSignInIDP",void 0),h([f()],Me.prototype,"colorSetsGroupQuery",void 0),h([f()],Me.prototype,"commentsEnabled",void 0),h([f({type:Date})],Me.prototype,"created",void 0),h([f()],Me.prototype,"credential",void 0),h([f()],Me.prototype,"culture",void 0),h([f()],Me.prototype,"currentVersion",void 0),h([f()],Me.prototype,"customBaseUrl",void 0),h([f()],Me.prototype,"defaultBasemap",void 0),h([br("defaultBasemap")],Me.prototype,"readDefaultBasemap",null),h([f()],Me.prototype,"defaultDevBasemap",void 0),h([br("defaultDevBasemap")],Me.prototype,"readDefaultDevBasemap",null),h([f({type:Pr})],Me.prototype,"defaultExtent",void 0),h([f()],Me.prototype,"defaultVectorBasemap",void 0),h([br("defaultVectorBasemap")],Me.prototype,"readDefaultVectorBasemap",null),h([f()],Me.prototype,"description",void 0),h([f()],Me.prototype,"devBasemapGalleryGroupQuery",void 0),h([f()],Me.prototype,"eueiEnabled",void 0),h([f({readOnly:!0})],Me.prototype,"extraQuery",null),h([f()],Me.prototype,"featuredGroups",void 0),h([f()],Me.prototype,"featuredItemsGroupQuery",void 0),h([f()],Me.prototype,"galleryTemplatesGroupQuery",void 0),h([f()],Me.prototype,"livingAtlasGroupQuery",void 0),h([f()],Me.prototype,"hasCategorySchema",void 0),h([f()],Me.prototype,"helpBase",void 0),h([f()],Me.prototype,"helperServices",void 0),h([f()],Me.prototype,"helpMap",void 0),h([f()],Me.prototype,"homePageFeaturedContent",void 0),h([f()],Me.prototype,"homePageFeaturedContentCount",void 0),h([f()],Me.prototype,"httpPort",void 0),h([f()],Me.prototype,"httpsPort",void 0),h([f()],Me.prototype,"id",void 0),h([f()],Me.prototype,"ipCntryCode",void 0),h([f({readOnly:!0})],Me.prototype,"isOrganization",null),h([f()],Me.prototype,"isPortal",void 0),h([f()],Me.prototype,"isReadOnly",void 0),h([f({readOnly:!0})],Me.prototype,"itemPageUrl",null),h([f()],Me.prototype,"layerTemplatesGroupQuery",void 0),h([f()],Me.prototype,"maxTokenExpirationMinutes",void 0),h([f({type:Date})],Me.prototype,"modified",void 0),h([f()],Me.prototype,"name",void 0),h([f()],Me.prototype,"portalHostname",void 0),h([f()],Me.prototype,"portalMode",void 0),h([f()],Me.prototype,"portalProperties",void 0),h([f()],Me.prototype,"region",void 0),h([f({readOnly:!0})],Me.prototype,"restUrl",null),h([f()],Me.prototype,"rotatorPanels",void 0),h([f()],Me.prototype,"showHomePageDescription",void 0),h([f()],Me.prototype,"sourceJSON",void 0),h([f()],Me.prototype,"staticImagesUrl",void 0),h([f({json:{name:"2DStylesGroupQuery"}})],Me.prototype,"stylesGroupQuery2d",void 0),h([f({json:{name:"stylesGroupQuery"}})],Me.prototype,"stylesGroupQuery3d",void 0),h([f()],Me.prototype,"supportsHostedServices",void 0),h([f()],Me.prototype,"symbolSetsGroupQuery",void 0),h([f()],Me.prototype,"templatesGroupQuery",void 0),h([f()],Me.prototype,"thumbnail",void 0),h([f({readOnly:!0})],Me.prototype,"thumbnailUrl",null),h([f()],Me.prototype,"units",void 0),h([f()],Me.prototype,"url",void 0),h([f()],Me.prototype,"urlKey",void 0),h([br("urlKey")],Me.prototype,"readUrlKey",null),h([f()],Me.prototype,"user",void 0),h([br("user")],Me.prototype,"readUser",null),h([f()],Me.prototype,"use3dBasemaps",void 0),h([f()],Me.prototype,"useStandardizedQuery",void 0),h([f()],Me.prototype,"useVectorBasemaps",void 0),h([f()],Me.prototype,"vectorBasemapGalleryGroupQuery",void 0),Me=Bf=h([F("esri.portal.Portal")],Me);const ba=Me,gZ=new FinalizationRegistry(e=>{e.remove()});function VMe(e){const t=ar;return()=>{const r=e.deref();r&&t.findCredential(r.restUrl)&&r.signIn().catch(()=>{})}}let F_=class extends of(Pe){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};h([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],F_.prototype,"type",void 0),h([f({type:tMe,json:{default:"begin-end",write:!0}})],F_.prototype,"placement",void 0),h([f({type:Uue,json:{default:"arrow",write:!0}})],F_.prototype,"style",void 0),h([f({type:ot,json:{type:[Ps],default:null,write:!0}})],F_.prototype,"color",void 0),F_=h([F("esri.symbols.LineStyleMarker3D")],F_);const rk=F_;var FM;let rp=FM=class extends cf{constructor(e){super(e),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=_d(1),this.pattern=null,this.marker=null}clone(){const e={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new FM(e)}static fromSimpleLineSymbol(e){const t={enabled:!0,size:e.width??_d(1),cap:e.cap||"butt",join:e.join||"miter",pattern:e.style&&e.style!=="inside-frame"?new nG({style:e.style}):null,material:new Ac({color:(e.color||hC).clone()}),marker:e.marker?new rk({placement:e.marker.placement,style:e.marker.style,color:e.marker.color?.clone()??null}):null};return new FM(t)}};h([f({type:Ac,json:{write:!0}})],rp.prototype,"material",void 0),h([Wt({Line:"line"},{readOnly:!0})],rp.prototype,"type",void 0),h([f({type:Zue,json:{write:!0,default:"miter"}})],rp.prototype,"join",void 0),h([f({type:cG,json:{write:!0,default:"butt"}})],rp.prototype,"cap",void 0),h([f(Xp)],rp.prototype,"size",void 0),h([f(Gue)],rp.prototype,"pattern",void 0),h([f({types:{key:"type",base:rk,typeMap:{style:rk}},json:{write:!0}})],rp.prototype,"marker",void 0),rp=FM=h([F("esri.symbols.LineSymbol3DLayer")],rp);const N3=rp;var ik;const GMe=jl()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let aE=ik=class extends Pe{clone(){return new ik({href:this.href,primitive:this.primitive})}};h([f({type:String,json:{read:uG,write:fy}})],aE.prototype,"href",void 0),h([Wt(GMe)],aE.prototype,"primitive",void 0),aE=ik=h([F("esri.symbols.support.ObjectSymbol3DLayerResource")],aE);const she="sphere";var sk;let dv=sk=class extends xe{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new sk({x:this.x,y:this.y,z:this.z})}};h([f({type:Number})],dv.prototype,"x",void 0),h([f({type:Number})],dv.prototype,"y",void 0),h([f({type:Number})],dv.prototype,"z",void 0),dv=sk=h([F("esri.symbols.support.Symbol3DAnchorPosition3D")],dv);var nk;let ia=nk=class extends cf{constructor(e){super(e),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new nk({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};h([f({type:Ac,json:{write:!0}})],ia.prototype,"material",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],ia.prototype,"castShadows",void 0),h([f({type:aE,json:{write:!0}})],ia.prototype,"resource",void 0),h([Wt({Object:"object"},{readOnly:!0})],ia.prototype,"type",void 0),h([f({type:Number,json:{write:!0}})],ia.prototype,"width",void 0),h([f({type:Number,json:{write:!0}})],ia.prototype,"height",void 0),h([f({type:Number,json:{write:!0}})],ia.prototype,"depth",void 0),h([Wt({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),f({json:{default:"origin"}})],ia.prototype,"anchor",void 0),h([f({type:dv,json:{type:[Number],read:{reader:e=>new dv({x:e[0],y:e[1],z:e[2]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y,e.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],ia.prototype,"anchorPosition",void 0),h([f({type:Number,json:{write:!0}})],ia.prototype,"heading",void 0),h([f({type:Number,json:{write:!0}})],ia.prototype,"tilt",void 0),h([f({type:Number,json:{write:!0}})],ia.prototype,"roll",void 0),h([f({readOnly:!0})],ia.prototype,"isPrimitive",null),ia=nk=h([F("esri.symbols.ObjectSymbol3DLayer")],ia);const dG=ia;var ok;let Da=ok=class extends cf{constructor(e){super(e),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(e,t){return e??(t.height==null&&t.size!=null?t.size:void 0)}readHeight(e,t){return e??(t.width==null&&t.size!=null?t.size:void 0)}clone(){return new ok({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};h([f({type:Ac,json:{write:!0}})],Da.prototype,"material",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Da.prototype,"castShadows",void 0),h([Wt({Path:"path"},{readOnly:!0})],Da.prototype,"type",void 0),h([f({type:["circle","quad"],json:{write:!0,default:"circle"}})],Da.prototype,"profile",void 0),h([f({type:Zue,json:{write:!0,default:"miter"}})],Da.prototype,"join",void 0),h([f({type:vMe,json:{write:!0,default:"butt"}})],Da.prototype,"cap",void 0),h([f({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],Da.prototype,"width",void 0),h([br("width",["width","size","height"])],Da.prototype,"readWidth",null),h([f({type:Number,json:{write:!0}})],Da.prototype,"height",void 0),h([br("height",["height","size","width"])],Da.prototype,"readHeight",null),h([f({type:["center","bottom","top"],json:{write:!0,default:"center"}})],Da.prototype,"anchor",void 0),h([f({type:["heading","all"],json:{write:!0,default:"all"}})],Da.prototype,"profileRotation",void 0),Da=ok=h([F("esri.symbols.PathSymbol3DLayer")],Da);const pG=Da;var ak;let nx=ak=class extends Pe{constructor(){super(...arguments),this.color=new ot([0,0,0,1]),this.size=0}clone(){const e={color:ye(this.color),size:this.size};return new ak(e)}};h([f(Wm)],nx.prototype,"color",void 0),h([f(Xp)],nx.prototype,"size",void 0),nx=ak=h([F("esri.symbols.support.Symbol3DHalo")],nx);let pC=class extends of(Pe){constructor(e){super(e),this.color=null}};h([f(Wm)],pC.prototype,"color",void 0),pC=h([F("esri.symbols.support.Symbol3DTextBackground")],pC);var UM;let hl=UM=class extends cf{constructor(e){super(e),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(e){e!=null&&this._userSize!=null&&(e.size=this._userSize),this._set("font",e)}writeFont(e,t,r,i){const s={...i,textSymbol3D:!0};t.font=e.write({},s),delete t.font.size}get size(){return this._userSize!=null?this._userSize:this.font!=null&&this.font.size!=null?this.font.size:9}set size(e){this._userSize=e,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const e=new UM({enabled:this.enabled,font:this.font&&ye(this.font),halo:this.halo&&ye(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:ye(this.background)});return e._userSize=this._userSize,e}static fromTextSymbol(e){return new UM({font:e.font!=null?e.font.clone():new lN,halo:jMe(e.haloColor,e.haloSize),horizontalAlignment:e.horizontalAlignment,lineHeight:e.lineHeight,material:e.color?new Ac({color:e.color.clone()}):null,text:e.text,verticalAlignment:e.verticalAlignment,background:e.backgroundColor?new pC({color:e.backgroundColor.clone()}):null})}};function jMe(e,t){return e&&t!=null&&t>0?new nx({color:ye(e),size:t}):null}h([f({type:lN,json:{write:!0}})],hl.prototype,"font",null),h([Yt("font")],hl.prototype,"writeFont",null),h([f({type:nx,json:{write:!0}})],hl.prototype,"halo",void 0),h([f({...Jue,json:{default:"center",write:!0}})],hl.prototype,"horizontalAlignment",void 0),h([f({...Yue,json:{default:1,write:!0}})],hl.prototype,"lineHeight",void 0),h([f({type:Ac,json:{write:!0}})],hl.prototype,"material",void 0),h([f({type:pC,json:{write:!0}})],hl.prototype,"background",void 0),h([f(Xp)],hl.prototype,"size",null),h([f({type:String,json:{write:!0}})],hl.prototype,"text",void 0),h([Wt({Text:"text"},{readOnly:!0})],hl.prototype,"type",void 0),h([f({...Kue,json:{default:"baseline",write:!0}})],hl.prototype,"verticalAlignment",void 0),hl=UM=h([F("esri.symbols.TextSymbol3DLayer")],hl);const tb=hl;var lk;let Jg=lk=class extends cf{constructor(e){super(e),this.color=ck.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new lk({color:ye(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};h([f({type:ot,nonNullable:!0,json:{type:[Ps],write:(e,t,r)=>t[r]=e.toArray(ot.AlphaMode.UNLESS_OPAQUE),default:()=>ck.clone(),defaultEquals:e=>e.toCss(!0)===ck.toCss(!0)}})],Jg.prototype,"color",void 0),h([Wt({Water:"water"},{readOnly:!0})],Jg.prototype,"type",void 0),h([f({type:["small","medium","large"],json:{write:!0,default:"medium"}})],Jg.prototype,"waterbodySize",void 0),h([f({type:Number,json:{write:!0,default:null}})],Jg.prototype,"waveDirection",void 0),h([f({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],Jg.prototype,"waveStrength",void 0),Jg=lk=h([F("esri.symbols.WaterSymbol3DLayer")],Jg);const ck=new ot([0,119,190]),nhe=Jg;var uk;let U_=uk=class extends xe{constructor(e){super(e),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new uk({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};h([f({type:String})],U_.prototype,"name",void 0),h([f({type:String})],U_.prototype,"styleUrl",void 0),h([f({type:String})],U_.prototype,"styleName",void 0),h([f({type:ba})],U_.prototype,"portal",void 0),U_=uk=h([F("esri.symbols.support.StyleOrigin")],U_);const pA=U_;var hk;let zv=hk=class extends xe{constructor(){super(...arguments),this.url=""}clone(){return new hk({url:this.url})}};h([f({type:String})],zv.prototype,"url",void 0),zv=hk=h([F("esri.symbols.support.Thumbnail")],zv);const ohe={icon:B0,object:dG,line:N3,path:pG,fill:D3,extrude:Fue,text:tb,water:nhe},HMe=Pt.ofType({base:cf,key:"type",typeMap:ohe,errorContext:"symbol-layer"});let ip=class extends Bc{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const t=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,r=t&&t.type||Pt;this._set("symbolLayers",new r)}get color(){return null}set color(e){this.constructed&&K.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){$m(e,this._get("symbolLayers"))}readStyleOrigin(e,t,r){if(e.styleUrl&&e.name){const i=y1(e.styleUrl,r);return new pA({styleUrl:i,name:e.name})}if(e.styleName&&e.name)return new pA({portal:r&&r.portal||ba.getDefault(),styleName:e.styleName,name:e.name});r&&r.messages&&r.messages.push(new o1("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,t,r,i){if(e.styleUrl&&e.name){let s=dT(e.styleUrl,i);Ec(s)&&(s=ld(s)),t.styleOrigin={styleUrl:s,name:e.name}}else e.styleName&&e.name&&(e.portal&&i&&i.portal&&!Hxe(e.portal.restUrl,i.portal.restUrl)?i&&i.messages&&i.messages.push(new o1("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):t.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof cf||e&&ohe[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};h([f({json:{read:!1,write:!1}})],ip.prototype,"color",null),h([f({type:HMe,nonNullable:!0,json:{write:!0}}),si(hG)],ip.prototype,"symbolLayers",null),h([f({type:pA})],ip.prototype,"styleOrigin",void 0),h([br("styleOrigin")],ip.prototype,"readStyleOrigin",null),h([Yt("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],ip.prototype,"writeStyleOrigin",null),h([f({type:zv,json:{read:!1}})],ip.prototype,"thumbnail",void 0),h([f({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],ip.prototype,"type",void 0),ip=h([F("esri.symbols.Symbol3D")],ip);const p2=ip;let lE=class extends Pe{constructor(e){super(e),this.visible=!0}clone(){}};h([f({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],lE.prototype,"type",void 0),h([f({readOnly:!0})],lE.prototype,"visible",void 0),lE=h([F("esri.symbols.callouts.Callout3D")],lE);const ahe=lE;var dk;let kM=dk=class extends Pe{constructor(){super(...arguments),this.color=new ot("white")}clone(){return new dk({color:ye(this.color)})}};h([f(Wm)],kM.prototype,"color",void 0),kM=dk=h([F("esri.symbols.callouts.LineCallout3DBorder")],kM);const lhe=kM;Object.freeze(Object.defineProperty({__proto__:null,default:lhe},Symbol.toStringTag,{value:"Module"}));var pk;let Kg=pk=class extends ahe{constructor(e){super(e),this.type="line",this.color=new ot([0,0,0,1]),this.size=_d(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new pk({color:ye(this.color),size:this.size,border:ye(this.border)})}};h([Wt({line:"line"},{readOnly:!0})],Kg.prototype,"type",void 0),h([f(Wm)],Kg.prototype,"color",void 0),h([f(Xp)],Kg.prototype,"size",void 0),h([f({type:lhe,json:{write:!0}})],Kg.prototype,"border",void 0),h([f({readOnly:!0})],Kg.prototype,"visible",null),Kg=pk=h([F("esri.symbols.callouts.LineCallout3D")],Kg);const WMe=Kg;function fG(e){if(!e)return!1;const t=e.verticalOffset;return!!t&&!(t.screenLength<=0||t.maxWorldLength!=null&&t.maxWorldLength<=0)}function che(e){if(!e||!e.supportsCallout||!e.supportsCallout())return!1;const t=e.callout;return!!t&&!!t.visible&&!!fG(e)}function mG(e){return e.type==="point-3d"||e.type==="label-3d"}function uhe(e){return e.horizontalAlignment==="center"}const hhe={types:{key:"type",base:ahe,typeMap:{line:WMe}},json:{write:!0}};var fk;let Pw=fk=class extends Pe{constructor(e){super(e),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new fk({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};h([f(Xp)],Pw.prototype,"screenLength",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0,default:0}})],Pw.prototype,"minWorldLength",void 0),h([f({type:Number,json:{write:!0}})],Pw.prototype,"maxWorldLength",void 0),Pw=fk=h([F("esri.symbols.support.Symbol3DVerticalOffset")],Pw);const dhe=Pw;var zM;const phe=Pt.ofType({base:null,key:"type",typeMap:{text:tb}});let Qg=zM=class extends p2{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new phe,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return che(this)}hasVisibleVerticalOffset(){return fG(this)}clone(){return new zM({styleOrigin:ye(this.styleOrigin),symbolLayers:ye(this.symbolLayers),thumbnail:ye(this.thumbnail),callout:ye(this.callout),verticalOffset:ye(this.verticalOffset)})}static fromTextSymbol(e){return new zM({symbolLayers:[tb.fromTextSymbol(e)]})}};h([f({type:dhe,json:{write:!0}})],Qg.prototype,"verticalOffset",void 0),h([f(hhe)],Qg.prototype,"callout",void 0),h([f({json:{read:!1,write:!1}})],Qg.prototype,"styleOrigin",void 0),h([f({type:phe})],Qg.prototype,"symbolLayers",void 0),h([Wt({LabelSymbol3D:"label-3d"},{readOnly:!0})],Qg.prototype,"type",void 0),Qg=zM=h([F("esri.symbols.LabelSymbol3D")],Qg);const cN=Qg;var BM;const fhe=Pt.ofType({base:null,key:"type",typeMap:{line:N3,path:pG}}),qMe=Pt.ofType({base:null,key:"type",typeMap:{line:N3,path:pG}});let cE=BM=class extends p2{constructor(e){super(e),this.symbolLayers=new fhe,this.type="line-3d"}clone(){return new BM({styleOrigin:ye(this.styleOrigin),symbolLayers:ye(this.symbolLayers),thumbnail:ye(this.thumbnail)})}static fromSimpleLineSymbol(e){return new BM({symbolLayers:[N3.fromSimpleLineSymbol(e)]})}};h([f({type:fhe,json:{type:qMe}})],cE.prototype,"symbolLayers",void 0),h([Wt({LineSymbol3D:"line-3d"},{readOnly:!0})],cE.prototype,"type",void 0),cE=BM=h([F("esri.symbols.LineSymbol3D")],cE);const uN=cE;let e0=class extends Bc{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};h([f({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],e0.prototype,"angle",void 0),h([f({type:["simple-marker","picture-marker"],readOnly:!0})],e0.prototype,"type",void 0),h([f({type:Number,cast:Ms,json:{write:!0}})],e0.prototype,"xoffset",void 0),h([f({type:Number,cast:Ms,json:{write:!0}})],e0.prototype,"yoffset",void 0),h([f({type:Number,cast:e=>e==="auto"?e:Ms(e),json:{write:!0}})],e0.prototype,"size",void 0),e0=h([F("esri.symbols.MarkerSymbol")],e0);const mhe=e0;var VM;const ghe=Pt.ofType({base:null,key:"type",typeMap:{fill:D3}});let uE=VM=class extends p2{constructor(e){super(e),this.symbolLayers=new ghe,this.type="mesh-3d"}clone(){return new VM({styleOrigin:ye(this.styleOrigin),symbolLayers:ye(this.symbolLayers),thumbnail:ye(this.thumbnail)})}static fromSimpleFillSymbol(e){return new VM({symbolLayers:[D3.fromSimpleFillSymbol(e)]})}};h([f({type:ghe})],uE.prototype,"symbolLayers",void 0),h([Wt({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],uE.prototype,"type",void 0),uE=VM=h([F("esri.symbols.MeshSymbol3D")],uE);const hN=uE;function XMe(e,t,r){return t.imageData?Ooe({mediaType:t.contentType||"image/png",isBase64:!0,data:t.imageData}):yhe(t.url,r)}function yhe(e,t){return YMe(t)&&!Ec(e)&&t?.layer?.parsedUrl?sf(t.layer.parsedUrl.path,"images",e):y1(e,t)}function ZMe(e,t,r,i){if(nf(e)){const s=n1(e);if(!s)return;t.contentType=s.mediaType,t.imageData=s.data,r&&r.imageData===t.imageData&&r.url&&fy(r.url,t,"url",i)}else fy(e,t,"url",i)}const _he={json:{read:{source:["imageData","url"],reader:XMe},write:{writer(e,t,r,i){ZMe(e,t,this.source,i)}}}},vhe={readOnly:!0,json:{read:{source:["imageData","url"],reader(e,t,r){const i={};return t.imageData&&(i.imageData=t.imageData),t.contentType&&(i.contentType=t.contentType),t.url&&(i.url=yhe(t.url,r)),i}}}};function YMe(e){return!(e==null||e.origin!=="service"&&e.origin!=="portal-item"||e.layer?.type!=="feature"&&e.layer?.type!=="stream")}var mk;let nu=mk=class extends kue{constructor(...e){super(...e),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(e,t,r,i){if(e&&typeof e!="string"&&e.imageData==null)return e;const s={};return e&&(s.url=e),t&&(s.outline=t),r!=null&&(s.width=Ms(r)),i!=null&&(s.height=Ms(i)),s}clone(){const e=new mk({color:ye(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return e._set("source",ye(this.source)),e}hash(){return`${super.hash()}.${this.color?.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};h([Wt({esriPFS:"picture-fill"},{readOnly:!0})],nu.prototype,"type",void 0),h([f(_he)],nu.prototype,"url",void 0),h([f({type:Number,json:{write:!0}})],nu.prototype,"xscale",void 0),h([f({type:Number,json:{write:!0}})],nu.prototype,"yscale",void 0),h([f({type:Number,cast:Ms,json:{write:!0}})],nu.prototype,"width",void 0),h([f({type:Number,cast:Ms,json:{write:!0}})],nu.prototype,"height",void 0),h([f({type:Number,cast:Ms,json:{write:!0}})],nu.prototype,"xoffset",void 0),h([f({type:Number,cast:Ms,json:{write:!0}})],nu.prototype,"yoffset",void 0),h([f(vhe)],nu.prototype,"source",void 0),nu=mk=h([F("esri.symbols.PictureFillSymbol")],nu);const bhe=nu;var gk;let Eh=gk=class extends mhe{constructor(...e){super(...e),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(e,t,r){if(e&&typeof e!="string"&&e.imageData==null)return e;const i={};return e&&(i.url=e),t!=null&&(i.width=Ms(t)),r!=null&&(i.height=Ms(r)),i}readHeight(e,t){return t.size||e}readWidth(e,t){return t.size||e}clone(){const e=new gk({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return e._set("source",ye(this.source)),e}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};h([f({json:{write:!1}})],Eh.prototype,"color",void 0),h([Wt({esriPMS:"picture-marker"},{readOnly:!0})],Eh.prototype,"type",void 0),h([f(_he)],Eh.prototype,"url",void 0),h([f(vhe)],Eh.prototype,"source",void 0),h([f({type:Number,cast:Ms,json:{write:!0}})],Eh.prototype,"height",void 0),h([br("height",["height","size"])],Eh.prototype,"readHeight",null),h([f({type:Number,cast:Ms,json:{write:!0}})],Eh.prototype,"width",void 0),h([f({json:{write:!1}})],Eh.prototype,"size",void 0),Eh=gk=h([F("esri.symbols.PictureMarkerSymbol")],Eh);const dN=Eh;var k_;const whe=Pt.ofType({base:null,key:"type",typeMap:{icon:B0,object:dG,text:tb}});let z_=k_=class extends p2{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.symbolLayers=new whe,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const e of this.symbolLayers.items)switch(e.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return che(this)}hasVisibleVerticalOffset(){return fG(this)}clone(){return new k_({verticalOffset:ye(this.verticalOffset),callout:ye(this.callout),styleOrigin:ye(this.styleOrigin),symbolLayers:ye(this.symbolLayers),thumbnail:ye(this.thumbnail)})}static fromSimpleMarkerSymbol(e){return new k_({symbolLayers:[B0.fromSimpleMarkerSymbol(e)]})}static fromPictureMarkerSymbol(e){return new k_({symbolLayers:[B0.fromPictureMarkerSymbol(e)]})}static fromCIMSymbol(e){if(e.data?.symbol?.type!=="CIMPointSymbol")return null;const r=e.data.symbol;return new k_(r?.callout?{symbolLayers:[B0.fromCIMSymbol(e)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}:{symbolLayers:[B0.fromCIMSymbol(e)]})}static fromTextSymbol(e){return new k_({symbolLayers:[tb.fromTextSymbol(e)]})}};h([f({type:dhe,json:{write:!0}})],z_.prototype,"verticalOffset",void 0),h([f(hhe)],z_.prototype,"callout",void 0),h([f({type:whe,json:{origins:{"web-scene":{write:!0}}}})],z_.prototype,"symbolLayers",void 0),h([Wt({PointSymbol3D:"point-3d"},{readOnly:!0})],z_.prototype,"type",void 0),z_=k_=h([F("esri.symbols.PointSymbol3D")],z_);const V0=z_;var hE;const xhe=Pt.ofType({base:null,key:"type",typeMap:{extrude:Fue,fill:D3,icon:B0,line:N3,object:dG,text:tb,water:nhe}});let dE=hE=class extends p2{constructor(e){super(e),this.symbolLayers=new xhe,this.type="polygon-3d"}clone(){return new hE({styleOrigin:ye(this.styleOrigin),symbolLayers:ye(this.symbolLayers),thumbnail:ye(this.thumbnail)})}static fromJSON(e){const t=new hE;if(t.read(e),t.symbolLayers.length===2&&t.symbolLayers.at(0).type==="fill"&&t.symbolLayers.at(1).type==="line"){const r=t.symbolLayers.at(0),i=t.symbolLayers.at(1);!i.enabled||e.symbolLayers&&e.symbolLayers[1]&&e.symbolLayers[1].enable===!1||(r.outline={size:i.size,color:i.material!=null?i.material.color:null}),t.symbolLayers.removeAt(1)}return t}static fromSimpleFillSymbol(e){return new hE({symbolLayers:[D3.fromSimpleFillSymbol(e)]})}};h([f({type:xhe,json:{write:!0}})],dE.prototype,"symbolLayers",void 0),h([Wt({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],dE.prototype,"type",void 0),dE=hE=h([F("esri.symbols.PolygonSymbol3D")],dE);const pN=dE;var yk;const lF=new kl({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let B_=yk=class extends kue{constructor(...e){super(...e),this.color=new ot([0,0,0,.25]),this.outline=new K1,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(e,t,r){if(e&&typeof e!="string")return e;const i={};return e&&(i.style=e),t&&(i.outline=t),r&&(i.color=r),i}clone(){return new yk({color:ye(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};h([f()],B_.prototype,"color",void 0),h([f()],B_.prototype,"outline",void 0),h([Wt({esriSFS:"simple-fill"},{readOnly:!0})],B_.prototype,"type",void 0),h([f({type:lF.apiValues,json:{read:lF.read,write:lF.write}})],B_.prototype,"style",void 0),B_=yk=h([F("esri.symbols.SimpleFillSymbol")],B_);const gG=B_;var _k;const cF=new kl({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let sp=_k=class extends mhe{constructor(...e){super(...e),this.color=new ot([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new K1}normalizeCtorArgs(e,t,r,i){if(e&&typeof e!="string")return e;const s={};return e&&(s.style=e),t!=null&&(s.size=Ms(t)),r&&(s.outline=r),i&&(s.color=i),s}writeColor(e,t){e&&this.style!=="x"&&this.style!=="cross"&&(t.color=e.toJSON()),e===null&&(t.color=null)}set path(e){this.style="path",this._set("path",e)}clone(){return new _k({angle:this.angle,color:ye(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${this.outline?.hash()}`}};h([f()],sp.prototype,"color",void 0),h([Yt("color")],sp.prototype,"writeColor",null),h([Wt({esriSMS:"simple-marker"},{readOnly:!0})],sp.prototype,"type",void 0),h([f()],sp.prototype,"size",void 0),h([f({type:cF.apiValues,json:{read:cF.read,write:cF.write}})],sp.prototype,"style",void 0),h([f({type:String,json:{write:!0}})],sp.prototype,"path",null),h([f({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":K1}},json:{default:null,write:!0}})],sp.prototype,"outline",void 0),sp=_k=h([F("esri.symbols.SimpleMarkerSymbol")],sp);const fN=sp;var vk;let hs=vk=class extends Bc{constructor(...e){super(...e),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new lN,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(e,t,r){if(e&&typeof e!="string")return e;const i={};return e&&(i.text=e),t&&(i.font=t),r&&(i.color=r),i}writeLineWidth(e,t,r,i){i&&typeof i!="string"?i.origin:t[r]=e}castLineWidth(e){return Ms(e)}writeLineHeight(e,t,r,i){i&&typeof i!="string"?i.origin:t[r]=e}clone(){return new vk({angle:this.angle,backgroundColor:ye(this.backgroundColor),borderLineColor:ye(this.borderLineColor),borderLineSize:this.borderLineSize,color:ye(this.color),font:this.font&&this.font.clone(),haloColor:ye(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color?.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};h([f({type:ot,json:{write:!0}})],hs.prototype,"backgroundColor",void 0),h([f({type:ot,json:{write:!0}})],hs.prototype,"borderLineColor",void 0),h([f({type:Number,json:{write:!0},cast:Ms})],hs.prototype,"borderLineSize",void 0),h([f({type:lN,json:{write:!0}})],hs.prototype,"font",void 0),h([f({...Jue,json:{write:!0}})],hs.prototype,"horizontalAlignment",void 0),h([f({type:Boolean,json:{write:!0}})],hs.prototype,"kerning",void 0),h([f({type:ot,json:{write:!0}})],hs.prototype,"haloColor",void 0),h([f({type:Number,cast:Ms,json:{write:!0}})],hs.prototype,"haloSize",void 0),h([f({type:Boolean,json:{write:!0}})],hs.prototype,"rightToLeft",void 0),h([f({type:Boolean,json:{write:!0}})],hs.prototype,"rotated",void 0),h([f({type:String,json:{write:!0}})],hs.prototype,"text",void 0),h([Wt({esriTS:"text"},{readOnly:!0})],hs.prototype,"type",void 0),h([f({...Kue,json:{write:!0}})],hs.prototype,"verticalAlignment",void 0),h([f({type:Number,cast:Ms,json:{write:!0}})],hs.prototype,"xoffset",void 0),h([f({type:Number,cast:Ms,json:{write:!0}})],hs.prototype,"yoffset",void 0),h([f({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],hs.prototype,"angle",void 0),h([f({type:Number,json:{write:!0}})],hs.prototype,"width",void 0),h([f({type:Number})],hs.prototype,"lineWidth",void 0),h([Yt("lineWidth")],hs.prototype,"writeLineWidth",null),h([si("lineWidth")],hs.prototype,"castLineWidth",null),h([f(Yue)],hs.prototype,"lineHeight",void 0),h([Yt("lineHeight")],hs.prototype,"writeLineHeight",null),hs=vk=h([F("esri.symbols.TextSymbol")],hs);const F3=hs;var bk;let Ch=bk=class extends Bc{constructor(e){super(e),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const e=this.portal!=null?this.portal:ba.getDefault(),t=e.user?e.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${t}:${e.url}`}read(e,t){this.portal=t?.portal,super.read(e,t)}clone(){return new bk({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(e){return this._fetchSymbol("webRef",e)}fetchCIMSymbol(e){return this._fetchSymbol("cimRef",e)}async _fetchSymbol(e,t){const r=t!=null?t.cache:null,i=r?this._fetchCacheKey:null;if(r!=null){const a=i&&r.get(i);if(a)return a.clone()}const{resolveWebStyleSymbol:s}=await ue(()=>Promise.resolve().then(function(){return tJe}),void 0);Jt(t);const n=s(this,{portal:this.portal},e,t);n.catch(a=>{K.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return e==="webRef"&&o.type==="point-3d"||e==="cimRef"&&o.type==="cim"?(r?.set(i,o.clone()),o):null}};h([f({json:{write:!1}})],Ch.prototype,"color",void 0),h([f({type:String,json:{write:!0}})],Ch.prototype,"styleName",void 0),h([f({type:ba,json:{write:!1}})],Ch.prototype,"portal",void 0),h([f({type:String,json:{read:uG,write:fy}})],Ch.prototype,"styleUrl",void 0),h([f({type:zv,json:{read:!1}})],Ch.prototype,"thumbnail",void 0),h([f({type:String,json:{write:!0}})],Ch.prototype,"name",void 0),h([Wt({styleSymbolReference:"web-style"},{readOnly:!0})],Ch.prototype,"type",void 0),h([f()],Ch.prototype,"_fetchCacheKey",null),Ch=bk=h([F("esri.symbols.WebStyleSymbol")],Ch);const f2=Ch;function mN(e){if(!e)return!1;switch(e.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function _1(e){if(!e)return!1;switch(e.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const yG={base:Bc,key:"type",typeMap:{"simple-fill":gG,"picture-fill":bhe,"picture-marker":dN,"simple-line":K1,"simple-marker":fN,text:F3,"label-3d":cN,"line-3d":uN,"mesh-3d":hN,"point-3d":V0,"polygon-3d":pN,"web-style":f2,cim:L3},errorContext:"symbol"},cpt={base:Bc,key:"type",typeMap:{"picture-marker":dN,"simple-marker":fN,text:F3,"web-style":f2,cim:L3},errorContext:"symbol"},JMe=Hoe({types:yG}),upt={base:Bc,key:"type",typeMap:{"simple-fill":gG,"picture-fill":bhe,"picture-marker":dN,"simple-line":K1,"simple-marker":fN,text:F3,"line-3d":uN,"mesh-3d":hN,"point-3d":V0,"polygon-3d":pN,"web-style":f2,cim:L3},errorContext:"symbol"},hpt={base:Bc,key:"type",typeMap:{text:F3,"label-3d":cN},errorContext:"symbol"},dpt={base:Bc,key:"type",typeMap:{"line-3d":uN,"mesh-3d":hN,"point-3d":V0,"polygon-3d":pN,"web-style":f2,cim:L3},errorContext:"symbol"},ppt={base:Bc,key:"type",typeMap:{"label-3d":cN},errorContext:"symbol"},fpt=cy(yG);var wk;function KMe(e){if(!e)return null;const t={};for(const r in e){const i=cT(e[r]);i&&(t[r]=i)}return Object.keys(t).length!==0?t:null}function QMe(e){if(e==null)return null;const t={};for(const r in e){const i=e[r];i&&(t[r]=i.toJSON())}return Object.keys(t).length!==0?t:null}let dl=wk=class extends of(Pe){constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:Nl(),configurable:!0})}normalizeCtorArgs(e,t,r,i){return e&&!e.declaredClass?e:{geometry:e,symbol:t,attributes:r,popupTemplate:i}}set aggregateGeometries(e){const t=this._get("aggregateGeometries");JSON.stringify(t)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))}set geometry(e){const t=this._get("geometry");t!==e&&(this._set("geometry",e),this._notifyLayer("geometry",t,e))}set symbol(e){const t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))}set visible(e){const t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))}cloneShallow(){return new wk({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible})}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;for(const t of[this.sourceLayer,this.layer])if(t){if("popupTemplate"in t&&t.popupTemplate)return t.popupTemplate;if(e&&"defaultPopupTemplate"in t&&t.defaultPopupTemplate!=null)return t.defaultPopupTemplate}return null}getAttribute(e){return this.attributes?.[e]}setAttribute(e,t){if(this.attributes){const r=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",r,t,e)}else this.attributes={[e]:t},this._notifyLayer("attributes",void 0,t,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:QMe(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(e={}){const{geometry:t}=this;if(t?.type==="mesh"){const r={origin:t.origin,transform:t.transform};this._notifyLayer("origin-transform",r,r,e.action)}}_notifyLayer(e,t,r,i){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:e,oldValue:t,newValue:r};e==="origin-transform"&&(s.action=i),e==="attributes"&&(s.attributeName=i),this.layer.graphicChanged(s)}};h([f({value:null,json:{read:KMe}})],dl.prototype,"aggregateGeometries",null),h([f({value:null})],dl.prototype,"attributes",null),h([f({value:null,types:Y7,json:{read:cT}})],dl.prototype,"geometry",null),h([f({type:Boolean})],dl.prototype,"isAggregate",void 0),h([f({clonable:"reference"})],dl.prototype,"layer",void 0),h([f({type:WPe})],dl.prototype,"popupTemplate",void 0),h([f({clonable:"reference"})],dl.prototype,"sourceLayer",void 0),h([f({value:null,types:yG})],dl.prototype,"symbol",null),h([f({type:Boolean,value:!0})],dl.prototype,"visible",null),dl=wk=h([F("esri.Graphic")],dl),function(e){e.generateUID=Nl}(dl||(dl={}));const v1=dl;var xk;let t0=xk=class extends Pe{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new xk({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};function uF(){return{enabled:!this.camera}}h([f({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:uF}}}}})],t0.prototype,"rotation",void 0),h([si("rotation")],t0.prototype,"castRotation",null),h([f({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:uF}}}}})],t0.prototype,"scale",void 0),h([f({types:Y7,json:{read:cT,write:!0,origins:{"web-scene":{read:cT,write:{overridePolicy:uF}}}}})],t0.prototype,"targetGeometry",void 0),h([f({type:Wu,json:{write:!0}})],t0.prototype,"camera",void 0),t0=xk=h([F("esri.Viewpoint")],t0);const zl=t0;class Tk{constructor(t=r=>r.values().next().value){this._peeker=t,this._observable=new iN,this._items=new Set}get length(){return Ft(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let t;for(t of this._items);return t}peek(){if(this.length!==0)return this._peeker(this._items)}push(t){this.contains(t)||(this._items.add(t),this._observable.notify())}contains(t){return Ft(this._observable),this._items.has(t)}pop(){if(this.length===0)return;const t=this.peek();return this._items.delete(t),this._observable.notify(),t}popLast(){if(this.length===0)return;const t=this.last();return this._items.delete(t),this._observable.notify(),t}remove(t){this.contains(t)&&(this._items.delete(t),this._observable.notify())}filter(t){const r=this.length;return this._items.forEach(i=>{t(i)||this._items.delete(i)}),r!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){Ft(this._observable),yield*this._items}}const eIe={statsWorker:()=>ue(()=>import("./statsWorker.e2654428.js"),["assets/statsWorker.e2654428.js","assets/heatmapUtils.32e9a30b.js","assets/utils.8873e24e.js","assets/generateRendererUtils.e8dfecdf.js"]),geometryEngineWorker:()=>ue(()=>import("./geometryEngineWorker.ac0c84b8.js"),["assets/geometryEngineWorker.ac0c84b8.js","assets/geometryEngineJSON.e71e98d1.js","assets/geometryEngineBase.d1b13217.js","assets/json.7bed7e43.js"]),CSVSourceWorker:()=>ue(()=>import("./CSVSourceWorker.6cc047cc.js"),["assets/CSVSourceWorker.6cc047cc.js","assets/json.7bed7e43.js","assets/FeatureStore.e774d369.js","assets/BoundsStore.13c0920f.js","assets/PooledRBush.b9188fbe.js","assets/quickselect.b8e0afc3.js","assets/optimizedFeatureQueryEngineAdapter.b17e3ee2.js","assets/centroid.66ea1f85.js","assets/QueryEngine.f42b4b13.js","assets/normalizeUtils.54c24a4d.js","assets/normalizeUtilsCommon.87227ae2.js","assets/WhereClause.c0b1e923.js","assets/executionError.10e29c03.js","assets/QueryEngineCapabilities.a6a6a20b.js","assets/utils.8873e24e.js","assets/generateRendererUtils.e8dfecdf.js","assets/FieldsIndex.09813895.js","assets/number.57f4f0d6.js","assets/clientSideDefaults.f7f5ffde.js","assets/defaultsJSON.a416f32c.js"]),EdgeProcessingWorker:()=>ue(()=>import("./EdgeProcessingWorker.98f055e1.js"),[]),ElevationSamplerWorker:()=>ue(()=>import("./ElevationSamplerWorker.68dfab2e.js"),["assets/ElevationSamplerWorker.68dfab2e.js","assets/PooledRBush.b9188fbe.js","assets/quickselect.b8e0afc3.js","assets/georeference.20930ae2.js","assets/MeshGeoreferencedRelativeVertexSpace.a44e5587.js","assets/MeshLocalVertexSpace.33b046fb.js"]),FeatureServiceSnappingSourceWorker:()=>ue(()=>import("./FeatureServiceSnappingSourceWorker.a96cf6ca.js"),["assets/FeatureServiceSnappingSourceWorker.a96cf6ca.js","assets/FeatureStore.e774d369.js","assets/BoundsStore.13c0920f.js","assets/PooledRBush.b9188fbe.js","assets/quickselect.b8e0afc3.js","assets/optimizedFeatureQueryEngineAdapter.b17e3ee2.js","assets/centroid.66ea1f85.js","assets/QueryEngine.f42b4b13.js","assets/normalizeUtils.54c24a4d.js","assets/normalizeUtilsCommon.87227ae2.js","assets/WhereClause.c0b1e923.js","assets/executionError.10e29c03.js","assets/json.7bed7e43.js","assets/QueryEngineCapabilities.a6a6a20b.js","assets/utils.8873e24e.js","assets/generateRendererUtils.e8dfecdf.js","assets/FieldsIndex.09813895.js","assets/Query.e586665e.js","assets/symbologySnappingCandidates.f2dfaf9f.js","assets/pbfQueryUtils.c4418ce7.js","assets/pbf.82c57b62.js","assets/query.22cd43bf.js","assets/queryZScale.2643e684.js"]),GeoJSONSourceWorker:()=>ue(()=>import("./GeoJSONSourceWorker.d0c407e4.js"),["assets/GeoJSONSourceWorker.d0c407e4.js","assets/FeatureStore.e774d369.js","assets/BoundsStore.13c0920f.js","assets/PooledRBush.b9188fbe.js","assets/quickselect.b8e0afc3.js","assets/optimizedFeatureQueryEngineAdapter.b17e3ee2.js","assets/centroid.66ea1f85.js","assets/QueryEngine.f42b4b13.js","assets/normalizeUtils.54c24a4d.js","assets/normalizeUtilsCommon.87227ae2.js","assets/WhereClause.c0b1e923.js","assets/executionError.10e29c03.js","assets/json.7bed7e43.js","assets/QueryEngineCapabilities.a6a6a20b.js","assets/utils.8873e24e.js","assets/generateRendererUtils.e8dfecdf.js","assets/FieldsIndex.09813895.js","assets/geojson.91d0658d.js","assets/clientSideDefaults.f7f5ffde.js","assets/defaultsJSON.a416f32c.js","assets/sourceUtils.7f114829.js"]),LercWorker:()=>ue(()=>import("./LercWorker.3a4f3e3f.js"),[]),MemorySourceWorker:()=>ue(()=>import("./MemorySourceWorker.88020487.js"),["assets/MemorySourceWorker.88020487.js","assets/objectIdUtils.fb7e1f23.js","assets/FeatureStore.e774d369.js","assets/BoundsStore.13c0920f.js","assets/PooledRBush.b9188fbe.js","assets/quickselect.b8e0afc3.js","assets/optimizedFeatureQueryEngineAdapter.b17e3ee2.js","assets/centroid.66ea1f85.js","assets/QueryEngine.f42b4b13.js","assets/normalizeUtils.54c24a4d.js","assets/normalizeUtilsCommon.87227ae2.js","assets/WhereClause.c0b1e923.js","assets/executionError.10e29c03.js","assets/json.7bed7e43.js","assets/QueryEngineCapabilities.a6a6a20b.js","assets/utils.8873e24e.js","assets/generateRendererUtils.e8dfecdf.js","assets/FieldsIndex.09813895.js","assets/clientSideDefaults.f7f5ffde.js","assets/defaultsJSON.a416f32c.js","assets/sourceUtils.7f114829.js"]),PBFDecoderWorker:()=>ue(()=>import("./PBFDecoderWorker.fdd188ce.js"),["assets/PBFDecoderWorker.fdd188ce.js","assets/pbfQueryUtils.c4418ce7.js","assets/pbf.82c57b62.js"]),Pipeline:()=>ue(()=>import("./Pipeline.3be33139.js").then(function(e){return e.P}),["assets/Pipeline.3be33139.js","assets/QueryEngine.f42b4b13.js","assets/normalizeUtils.54c24a4d.js","assets/normalizeUtilsCommon.87227ae2.js","assets/WhereClause.c0b1e923.js","assets/executionError.10e29c03.js","assets/json.7bed7e43.js","assets/QueryEngineCapabilities.a6a6a20b.js","assets/utils.8873e24e.js","assets/generateRendererUtils.e8dfecdf.js","assets/FieldsIndex.09813895.js","assets/StreamFeatureManager.ae72b5b8.js","assets/quickselect.b8e0afc3.js","assets/diffUtils.f0876598.js","assets/arcadeTimeUtils.65bae7d6.js","assets/centroid.66ea1f85.js","assets/ogcFeatureUtils.c15e0a84.js","assets/geojson.91d0658d.js","assets/clientSideDefaults.f7f5ffde.js","assets/defaultsJSON.a416f32c.js","assets/query.22cd43bf.js","assets/pbfQueryUtils.c4418ce7.js","assets/pbf.82c57b62.js","assets/queryZScale.2643e684.js","assets/Query.e586665e.js","assets/createConnection.6a562f88.js","assets/definitions.c3f2bf92.js","assets/TileInfoView.86066260.js","assets/number.bbe84298.js","assets/geohashUtils.a46ddc15.js"]),PointCloudWorker:()=>ue(()=>import("./PointCloudWorker.c91cfe37.js"),["assets/PointCloudWorker.c91cfe37.js","assets/PointCloudWorkerUtil.6fb4a2d3.js","assets/PointCloudUniqueValueRenderer.6a8e22b5.js","assets/ColorStop.f762bde8.js","assets/I3SBinaryReader.f09861ac.js"]),RasterWorker:()=>ue(()=>import("./RasterWorker.53aba54c.js"),["assets/RasterWorker.53aba54c.js","assets/dataUtils.cbb4073f.js","assets/colorUtils.307b1728.js","assets/utils.74c24531.js","assets/colorRamps.80cb140e.js","assets/rasterProjectionHelper.b292b8c5.js"]),SceneLayerSnappingSourceWorker:()=>ue(()=>import("./SceneLayerSnappingSourceWorker.f0d5545d.js"),[]),SceneLayerWorker:()=>ue(()=>import("./SceneLayerWorker.c8cc9b18.js").then(function(e){return e.a}),["assets/SceneLayerWorker.c8cc9b18.js","assets/MeshGeoreferencedRelativeVertexSpace.a44e5587.js","assets/MeshLocalVertexSpace.33b046fb.js","assets/I3SNode.8380a4f6.js"]),WFSSourceWorker:()=>ue(()=>import("./WFSSourceWorker.754c50a9.js"),["assets/WFSSourceWorker.754c50a9.js","assets/FeatureStore.e774d369.js","assets/BoundsStore.13c0920f.js","assets/PooledRBush.b9188fbe.js","assets/quickselect.b8e0afc3.js","assets/optimizedFeatureQueryEngineAdapter.b17e3ee2.js","assets/centroid.66ea1f85.js","assets/QueryEngine.f42b4b13.js","assets/normalizeUtils.54c24a4d.js","assets/normalizeUtilsCommon.87227ae2.js","assets/WhereClause.c0b1e923.js","assets/executionError.10e29c03.js","assets/json.7bed7e43.js","assets/QueryEngineCapabilities.a6a6a20b.js","assets/utils.8873e24e.js","assets/generateRendererUtils.e8dfecdf.js","assets/FieldsIndex.09813895.js","assets/geojson.91d0658d.js","assets/sourceUtils.7f114829.js","assets/wfsUtils.54c0e0fb.js","assets/xmlUtils.11789372.js"]),WorkerTileHandler:()=>ue(()=>import("./WorkerTileHandler.b0b32baa.js"),["assets/WorkerTileHandler.b0b32baa.js","assets/TileClipper.f7503fb7.js","assets/StyleRepository.06b2d88d.js","assets/colorUtils.307b1728.js","assets/definitions.c3f2bf92.js","assets/Rect.5473b346.js","assets/pbf.82c57b62.js","assets/TurboLine.a8fd7711.js","assets/BidiEngine.725a17e4.js"])};var yo;(function(e){e[e.HANDSHAKE=0]="HANDSHAKE",e[e.OPEN=1]="OPEN",e[e.OPENED=2]="OPENED",e[e.RESPONSE=3]="RESPONSE",e[e.INVOKE=4]="INVOKE",e[e.ABORT=5]="ABORT",e[e.CLOSE=6]="CLOSE",e[e.OPEN_PORT=7]="OPEN_PORT",e[e.ON=8]="ON"})(yo||(yo={}));let tIe=0;function The(){return tIe++}function rIe(e){return e&&typeof e=="object"&&("result"in e||"transferList"in e)}function fA(e){return e?typeof e=="string"?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function _G(e,t,r,i){if(t.type===yo.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==yo.INVOKE&&t.type!==yo.RESPONSE)return void e.postMessage(t);let s;if(rIe(r)?(s=yZ(r.transferList),t.data=r.result):(s=yZ(i),t.data=r),s){if(ne("ff")){for(const n of s)if("byteLength"in n&&n.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(t.type){case yo.INVOKE:throw o;case yo.RESPONSE:return void _G(e,{type:yo.RESPONSE,jobId:t.jobId,error:fA(o)})}}}e.postMessage(t,s)}else e.postMessage(t)}function mA(e){if(!e)return null;const t=e.data;return t?typeof t=="string"?JSON.parse(t):t:null}function yZ(e){if(!e||!e.length)return null;if(ne("esri-workers-arraybuffer-transfer"))return e;const t=e.filter(r=>!iIe(r));return t.length?t:null}function iIe(e){return e instanceof ArrayBuffer||e?.constructor?.name==="ArrayBuffer"}const{CLOSE:_Z,ABORT:vZ,INVOKE:bZ,RESPONSE:X2,OPEN_PORT:wZ,ON:sIe}=yo,nIe=2;class oIe{constructor(t){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=t,this._timer=null,this._process=this._process.bind(this)}push(t){t.type===yo.ABORT?this._cancelledJobIds.add(t.jobId):(this._invokeMessages.push(t),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const t of this._invokeMessages)this._cancelledJobIds.has(t.jobId)||this._invoke(t);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class Rl{static connect(t){const r=new MessageChannel;let i;i=typeof t=="function"?new t:"default"in t&&typeof t.default=="function"?new t.default:t;const s=new Rl(r.port1,{channel:r,client:i},()=>null);return typeof i=="object"&&"remoteClient"in i&&(i.remoteClient=s),Rl.clients.set(s,i),r.port2}static loadWorker(t){const r=eIe[t];return r?r():Promise.resolve(null)}constructor(t,r,i){this._port=t,this._getNextJob=i,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new oIe(s=>this._onInvokeMessage(s)),this._client=r.client,this._onMessage=this._onMessage.bind(this),this._channel=r.channel,this._schedule=r.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:_Z}),this._close()}isBusy(){return this._outJobs.size>0}invoke(t,r,i){const s=i?.signal,n=i?.transferList;if(!this._port)return Promise.reject(new G("worker:port-closed",`Cannot call invoke('${t}'), port is closed`,{methodName:t,data:r}));const o=The();return new Promise((a,l)=>{if(Hs(s))return this._processWork(),void l(Cr());const c=Ws(s,()=>{const d=this._outJobs.get(o);d&&(this._outJobs.delete(o),this._processWork(),xi(d.abortHandle),this._post({type:vZ,jobId:o}),l(Cr()))}),u={resolve:a,reject:l,abortHandle:c,debugInfo:t};this._outJobs.set(o,u),this._post({type:bZ,jobId:o,methodName:t,abortable:s!=null},r,n)})}on(t,r){const i=new MessageChannel;function s(n){r(n.data)}return this._port.postMessage({type:yo.ON,eventType:t,port:i.port2},[i.port2]),i.port1.addEventListener("message",s),i.port1.start(),{remove(){i.port1.postMessage({type:yo.CLOSE}),i.port1.close(),i.port1.removeEventListener("message",s)}}}jobAdded(){this._processWork()}openPort(){const t=new MessageChannel;return this._post({type:wZ,port:t.port2}),t.port1}_processWork(){if(this._outJobs.size>=nIe)return;const t=this._getNextJob();if(!t)return;const{methodName:r,data:i,invokeOptions:s,resolver:n}=t;this.invoke(r,i,s).then(o=>n.resolve(o)).catch(o=>n.reject(o))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(t=>{xi(t.abortHandle),t.reject(Cr(`Worker closing, aborting job calling '${t.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(t){this._schedule!=null?this._schedule(()=>this._processMessage(t)):this._processMessage(t)}_processMessage(t){const r=mA(t);if(r)switch(r.type){case X2:this._onResponseMessage(r);break;case bZ:this._invokeQueue.push(r);break;case vZ:this._onAbortMessage(r);break;case _Z:this._onCloseMessage();break;case wZ:this._onOpenPortMessage(r);break;case sIe:this._onOnMessage(r)}}_onAbortMessage(t){const r=this._inJobs,i=t.jobId,s=r.get(i);this._invokeQueue.push(t),s&&(s.controller&&s.controller.abort(),r.delete(i))}_onCloseMessage(){const t=this._client;this._close(),t&&"destroy"in t&&Rl.clients.get(this)===t&&t.destroy(),Rl.clients.delete(this),t?.remoteClient&&(t.remoteClient=null)}_onInvokeMessage(t){const{methodName:r,jobId:i,data:s,abortable:n}=t,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,u=c[r];try{if(!u&&r&&r.includes(".")){const d=r.split(".");for(let p=0;p<d.length-1;p++)c=c[d[p]],u=c[d[p+1]]}if(typeof u!="function")throw new TypeError(`${r} is not a function`);l=u.call(c,s,{client:this,signal:o?o.signal:null})}catch(d){return void this._post({type:X2,jobId:i,error:fA(d)})}zc(l)?(a.set(i,{controller:o,promise:l}),l.then(d=>{a.has(i)&&(a.delete(i),this._post({type:X2,jobId:i},d))},d=>{a.has(i)&&(a.delete(i),$s(d)||this._post({type:X2,jobId:i,error:fA(d||{message:`Error encountered at method ${r}`})}))})):this._post({type:X2,jobId:i},l)}_onOpenPortMessage(t){new Rl(t.port,{client:this._client},()=>null)}_onOnMessage(t){const{port:r}=t,i=this._client.on(t.eventType,n=>{r.postMessage(n)}),s=ey(t.port,"message",n=>{mA(n)?.type===yo.CLOSE&&(s.remove(),i.remove(),r.close())})}_onResponseMessage(t){const{jobId:r,error:i,data:s}=t,n=this._outJobs;if(!n.has(r))return;const o=n.get(r);n.delete(r),this._processWork(),xi(o.abortHandle),i?o.reject(G.fromJSON(JSON.parse(i))):o.resolve(s)}_post(t,r,i){return _G(this._port,t,r,i)}}Rl.kernelInfo={buildDate:$oe,fullVersion:t7,revision:Loe},Rl.clients=new Map;class aIe{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new Tk}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(t,r){return new Promise((i,s)=>{let n=!0;const o=a=>{Jt(r.signal),n&&(n=!1,a())};this._clients.length=t.length,this._clientPromises.length=t.length,this._inUseClients.length=t.length;for(let a=0;a<t.length;++a){const l=t[a];zc(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new Rl(c,r,()=>this._ongoingJobsQueue.pop()??null),o(i),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new Rl(l,r,()=>this._ongoingJobsQueue.pop()??null),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(i))}})}broadcast(t,r,i){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a?.invoke(t,r,i))}return s}close(){let t;for(;t=this._ongoingJobsQueue.pop();)t.resolver.reject(Cr(`Worker closing, aborting job calling '${t.methodName}'`));for(const r of this._clientPromises)r.then(i=>i?.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0}invoke(t,r,i){let s;Array.isArray(i)?(K.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),s={transferList:i}):s=i;const n=Ys();this._ongoingJobsQueue.push({methodName:t,data:r,invokeOptions:s,resolver:n});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l?.jobAdded())}return n.promise}on(t,r){return Promise.all(this._clientPromises).then(()=>Jx(this._clients.map(i=>i.on(t,r))))}openPorts(){return new Promise(t=>{const r=new Array(this._clientPromises.length);let i=r.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{n&&(r[s]=n.openPort()),--i==0&&t(r)})})}get test(){return{numClients:this._clients.length}}}const lIe={};function cIe(e){const t={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:{...e.has},map:{...e.map},packages:e.packages&&e.packages.concat()||[],paths:{...e.paths}};return e.hasOwnProperty("async")||(t.async=!0),e.hasOwnProperty("isDebug")||(t.isDebug=!1),e.baseUrl||(t.baseUrl=lIe.baseUrl),t}class uIe{constructor(){const t=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(r=>{this[r]=(...i)=>t[r](...i)})}}class GM{constructor(){this._dispatcher=new uIe,this._workerPostMessage({type:yo.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(t){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=t,t&&this.addEventListener("message",t)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(t){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=t,t&&this.addEventListener("messageerror",t)}get onerror(){return this._onerrorHandler}set onerror(t){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=t,t&&this.addEventListener("error",t)}postMessage(t){Kx(()=>{this._workerMessageHandler(new MessageEvent("message",{data:t}))})}dispatchEvent(t){return this._dispatcher.dispatchEvent(t)}addEventListener(t,r,i){this._dispatcher.addEventListener(t,r,i)}removeEventListener(t,r,i){this._dispatcher.removeEventListener(t,r,i)}_workerPostMessage(t){Kx(()=>{this.dispatchEvent(new MessageEvent("message",{data:t}))})}async _workerMessageHandler(t){const r=mA(t);if(r&&r.type===yo.OPEN){const{modulePath:i,jobId:s}=r;let n=await Rl.loadWorker(i);n||(n=await ue(()=>import(i),[]));const o=Rl.connect(n);this._workerPostMessage({type:yo.OPENED,jobId:s,data:o})}}}const Sk=K.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:hIe}=yo,dIe='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,s)=>{if(t){if(t.aborted)return s(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:ABORT,jobId:n}),s(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:s}),self.postMessage({type:INVOKE,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n??s}\\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case OPEN:let n;function t(e){const o=n.connect(e);self.postMessage({type:OPENED,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case RESPONSE:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let GO,jO;const xZ="Failed to create Worker. Fallback to execute module in main thread";async function pIe(){if(!ne("esri-workers")||(ne("mozilla"),0))return TZ(new GM);if(!GO&&!jO)try{const t=dIe.split('"{CONFIGURATION}"').join(`'${fIe()}'`);GO=URL.createObjectURL(new Blob([t],{type:"text/javascript"}))}catch(t){jO=t||{}}let e;if(GO)try{e=new Worker(GO,{name:"esri-worker-"+mIe++})}catch{Sk.warn(xZ,jO),e=new GM}else Sk.warn(xZ,jO),e=new GM;return TZ(e)}async function TZ(e){return new Promise(t=>{function r(s){const n=mA(s);n&&n.type===hIe&&(e.removeEventListener("message",r),e.removeEventListener("error",i),t(e))}function i(s){s.preventDefault(),e.removeEventListener("message",r),e.removeEventListener("error",i),Sk.warn("Failed to create Worker. Fallback to execute module in main thread",s),(e=new GM).addEventListener("message",r),e.addEventListener("error",i)}e.addEventListener("message",r),e.addEventListener("error",i)})}function fIe(){let e;if(Or.default!=null){const s={...Or};delete s.default,e=JSON.parse(JSON.stringify(s))}else e=JSON.parse(JSON.stringify(Or));e.assetsPath=ja(e.assetsPath),e.defaultAssetsPath=e.defaultAssetsPath?ja(e.defaultAssetsPath):void 0,e.request.interceptors=[],e.log.interceptors=[],e.locale=ud(),e.has={"esri-csp-restrictions":ne("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":ne("esri-2d-update-debug"),"esri-2d-log-updating":ne("esri-2d-log-updating"),"featurelayer-pbf":ne("featurelayer-pbf"),"featurelayer-simplify-thresholds":ne("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":ne("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":ne("featurelayer-simplify-mobile-factor"),"esri-atomics":ne("esri-atomics"),"esri-shared-array-buffer":ne("esri-shared-array-buffer"),"esri-tiles-debug":ne("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":ne("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":ne("feature-polyline-generalization-factor"),"host-webworker":1,"polylabel-placement-enabled":ne("polylabel-placement-enabled")},e.workers.loaderUrl&&(e.workers.loaderUrl=ja(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=ja(e.workers.workerPath):e.workers.workerPath=ja($r("esri/core/workers/RemoteClient.js")),e.workers.useDynamicImport=!1;const t=Or.workers.loaderConfig,r=cIe({baseUrl:t?.baseUrl,locale:ud(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...t?.has},map:{...t?.map},paths:{...t?.paths},packages:t?.packages||[]}),i={buildDate:$oe,fullVersion:t7,revision:Loe};return JSON.stringify({esriConfig:e,loaderConfig:r,kernelInfo:i})}let mIe=0;const{ABORT:SZ,INVOKE:gIe,OPEN:yIe,OPENED:_Ie,RESPONSE:Z2}=yo;class vG{static async create(t){const r=await pIe();return new vG(r,t)}constructor(t,r){this._outJobs=new Map,this._inJobs=new Map,this.worker=t,this.id=r,t.addEventListener("message",this._onMessage.bind(this)),t.addEventListener("error",i=>{i.preventDefault(),K.getLogger("esri.core.workers.WorkerOwner").error(i)})}terminate(){this.worker.terminate()}async open(t,r={}){const{signal:i}=r,s=The();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:ND(i,()=>{this._outJobs.delete(s),this._post({type:SZ,jobId:s})})};this._outJobs.set(s,a),this._post({type:yIe,jobId:s,modulePath:t})})}_onMessage(t){const r=mA(t);if(r)switch(r.type){case _Ie:this._onOpenedMessage(r);break;case Z2:this._onResponseMessage(r);break;case SZ:this._onAbortMessage(r);break;case gIe:this._onInvokeMessage(r)}}_onAbortMessage(t){const r=this._inJobs,i=t.jobId,s=r.get(i);s&&(s.controller&&s.controller.abort(),r.delete(i))}_onInvokeMessage(t){const{methodName:r,jobId:i,data:s,abortable:n}=t,o=n?new AbortController:null,a=this._inJobs,l=oTe[r];let c;try{if(typeof l!="function")throw new TypeError(`${r} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(u){return void this._post({type:Z2,jobId:i,error:fA(u)})}zc(c)?(a.set(i,{controller:o,promise:c}),c.then(u=>{a.has(i)&&(a.delete(i),this._post({type:Z2,jobId:i},u))},u=>{a.has(i)&&(a.delete(i),u||(u={message:"Error encountered at method"+r}),$s(u)||this._post({type:Z2,jobId:i,error:fA(u||{message:`Error encountered at method ${r}`})}))})):this._post({type:Z2,jobId:i},c)}_onOpenedMessage(t){const{jobId:r,data:i}=t,s=this._outJobs.get(r);s&&(this._outJobs.delete(r),xi(s.abortHandle),s.resolve(i))}_onResponseMessage(t){const{jobId:r,error:i,data:s}=t,n=this._outJobs.get(r);n&&(this._outJobs.delete(r),xi(n.abortHandle),i?n.reject(G.fromJSON(JSON.parse(i))):n.resolve(s))}_post(t,r,i){return _G(this.worker,t,r,i)}}const EZ=ne("host-browser")?Math.min(navigator.hardwareConcurrency-1,ne("workers-pool-size")):0;let Av=ne("esri-mobile")?Math.min(EZ,3):EZ;Av||(Av=ne("safari")&&ne("mac")?7:2);let CZ=0;const jM=[];function vIe(){She()}async function HO(e,t){const r=new aIe;return await r.open(e,t),r}async function bIe(e,t={}){if(typeof e!="string")throw new G("workers:undefined-module","modulePath is missing");let r=t.strategy||"distributed";if(ne("host-webworker")&&!ne("esri-workers")&&(r="local"),r==="local"){let i=await Rl.loadWorker(e);i||(i=await ue(()=>import(e),[])),Jt(t.signal);const s=t.client||i;return HO([Rl.connect(i)],{...t,client:s})}if(await She(),Jt(t.signal),r==="dedicated"){const i=CZ++%Av;return HO([await jM[i].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const i=Math.min(t.maxNumWorkers,Av);if(i<Av){const s=new Array(i);for(let n=0;n<i;++n){const o=CZ++%Av;s[n]=jM[o].open(e,t)}return HO(s,t)}}return HO(jM.map(i=>i.open(e,t)),t)}let WO=null;async function She(){if(WO)return WO;new AbortController;const e=[];for(let t=0;t<Av;t++){const r=vG.create(t).then(i=>(jM[t]=i,i));e.push(r)}return WO=Promise.all(e),WO}let Fp=class extends xe{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._handles=new gi,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll(),this._handles.destroy()}add(e,t,r={}){return this._installWatch(e,t,r,le)}addWhen(e,t,r={}){return this._installWatch(e,t,r,Dc)}addOnCollectionChange(e,t,{initial:r=!1,final:i=!1}={}){const s=++this._handleId;return this._handles.add([qo(e,"after-changes",this._createSyncUpdatingCallback(),Vr),qo(e,"change",t,{onListenerAdd:r?n=>t({added:n.toArray(),removed:[]}):void 0,onListenerRemove:i?n=>t({added:[],removed:n.toArray()}):void 0})],s),Xo(()=>this._handles.remove(s))}addPromise(e){if(e==null)return e;const t=++this._handleId;this._handles.add({remove:()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this._handles.has(qO)||this._set("updating",!1))}},t),this._pendingPromises.add(e),this._set("updating",!0);const r=()=>this._handles.remove(t);return e.then(r,r),e}removeAll(){this._pendingPromises.clear(),this._handles.removeAll(),this._set("updating",!1)}_installWatch(e,t,r={},i){const s=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,s);const n=i(e,t,r);return this._handles.add(n,s),Xo(()=>this._handles.remove(s))}_installSyncUpdatingWatch(e,t){const r=this._createSyncUpdatingCallback(),i=le(e,r,{sync:!0,equals:()=>!1});return this._handles.add(i,t),i}_createSyncUpdatingCallback(){return()=>{this._handles.remove(qO),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this._handles.add(w3(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this._handles.remove(qO))}),qO)}}};h([f({readOnly:!0})],Fp.prototype,"updating",void 0),Fp=h([F("esri.core.support.WatchUpdatingTracking")],Fp);const qO=-42,bG=e=>{let t=class extends e{constructor(){super(...arguments),this._handles=new gi,this._updatingHandles=new Fp}destroy(){this.destroyed||(this._handles.destroy(),this._updatingHandles.destroy())}get handles(){return this._handles}get updatingHandles(){return this._updatingHandles}};return h([f({readOnly:!0})],t.prototype,"handles",null),h([f({readOnly:!0})],t.prototype,"updatingHandles",null),t=h([F("esri.core.HandleOwner")],t),t};let gA=class extends bG(xe){};gA=h([F("esri.core.HandleOwner")],gA);let fC=class extends bG(Pt){constructor(e){super(e),this.handles.add([this.on("before-add",t=>{t.item==null&&t.preventDefault()}),this.on("after-add",t=>this._own(t.item)),this.on("after-remove",t=>this._release(t.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(Pt.ofType(this.itemType.Type))(e):new Pt(e)}};function Ek(e,t){return{type:e,cast:hG,set(r){const i=$m(r,this._get(t),e);i.owner=this,this._set(t,i)}}}h([f()],fC.prototype,"owner",null),fC=h([F("esri.core.support.OwningCollection")],fC);var pE;const Z$=jl()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),Ehe=Z$.jsonValues.slice();eA(Ehe,"orthometric");const mC=jl()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let Ah=pE=class extends Pe{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,r){return Z$.write(e,t,r)}readHeightModel(e,t,r){return Z$.read(e)||(r&&r.messages&&r.messages.push(wIe(e,{context:r})),null)}readHeightUnit(e,t,r){return mC.read(e)||(r&&r.messages&&r.messages.push(AZ(e,{context:r})),null)}readHeightUnitService(e,t,r){return Nce(e)||mC.read(e)||(r&&r.messages&&r.messages.push(AZ(e,{context:r})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new pE({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const r=XOe(t);return new pE({heightModel:e.heightModel,heightUnit:r,vertCRS:e.vertCRS})}write(e,t){return t={origin:"web-scene",...t},super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new pE;return t.read(e,{origin:"web-scene"}),t}};function AZ(e,t){return new o1("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}function wIe(e,t){return new o1("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}h([f({type:Z$.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:Ehe,default:"ellipsoidal"}}}})],Ah.prototype,"heightModel",void 0),h([Yt("web-scene","heightModel")],Ah.prototype,"writeHeightModel",null),h([br(["web-scene","service"],"heightModel")],Ah.prototype,"readHeightModel",null),h([f({type:mC.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:mC.jsonValues,write:mC.write}}}})],Ah.prototype,"heightUnit",void 0),h([br("web-scene","heightUnit")],Ah.prototype,"readHeightUnit",null),h([br("service","heightUnit")],Ah.prototype,"readHeightUnitService",null),h([f({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],Ah.prototype,"vertCRS",void 0),h([br("service","vertCRS",["vertCRS","ellipsoid","geoid"])],Ah.prototype,"readVertCRS",null),Ah=pE=h([F("esri.geometry.HeightModelInfo")],Ah);const rb=Ah;function Ss(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function uf(e,t,r,i,s,n,o,a,l,c,u,d,p,g,y,_,v){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e[9]=u,e[10]=d,e[11]=p,e[12]=g,e[13]=y,e[14]=_,e[15]=v,e}function Zu(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Bl(e,t){if(e===t){const r=t[1],i=t[2],s=t[3],n=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=n,e[11]=t[14],e[12]=s,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function m2(e,t){return Fn(e,t)||Zu(e),e}function Fn(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=t[9],p=t[10],g=t[11],y=t[12],_=t[13],v=t[14],w=t[15],T=r*a-i*o,x=r*l-s*o,S=r*c-n*o,O=i*l-s*a,A=i*c-n*a,$=s*c-n*l,P=u*_-d*y,U=u*v-p*y,I=u*w-g*y,L=d*v-p*_,N=d*w-g*_,Z=p*w-g*v;let W=T*Z-x*N+S*L+O*I-A*U+$*P;return W?(W=1/W,e[0]=(a*Z-l*N+c*L)*W,e[1]=(s*N-i*Z-n*L)*W,e[2]=(_*$-v*A+w*O)*W,e[3]=(p*A-d*$-g*O)*W,e[4]=(l*I-o*Z-c*U)*W,e[5]=(r*Z-s*I+n*U)*W,e[6]=(v*S-y*$-w*x)*W,e[7]=(u*$-p*S+g*x)*W,e[8]=(o*N-a*I+c*P)*W,e[9]=(i*I-r*N-n*P)*W,e[10]=(y*A-_*S+w*T)*W,e[11]=(d*S-u*A-g*T)*W,e[12]=(a*U-o*L-l*P)*W,e[13]=(r*L-i*U+s*P)*W,e[14]=(_*x-y*O-v*T)*W,e[15]=(u*O-d*x+p*T)*W,e):null}function xIe(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=t[9],p=t[10],g=t[11],y=t[12],_=t[13],v=t[14],w=t[15];return e[0]=a*(p*w-g*v)-d*(l*w-c*v)+_*(l*g-c*p),e[1]=-(i*(p*w-g*v)-d*(s*w-n*v)+_*(s*g-n*p)),e[2]=i*(l*w-c*v)-a*(s*w-n*v)+_*(s*c-n*l),e[3]=-(i*(l*g-c*p)-a*(s*g-n*p)+d*(s*c-n*l)),e[4]=-(o*(p*w-g*v)-u*(l*w-c*v)+y*(l*g-c*p)),e[5]=r*(p*w-g*v)-u*(s*w-n*v)+y*(s*g-n*p),e[6]=-(r*(l*w-c*v)-o*(s*w-n*v)+y*(s*c-n*l)),e[7]=r*(l*g-c*p)-o*(s*g-n*p)+u*(s*c-n*l),e[8]=o*(d*w-g*_)-u*(a*w-c*_)+y*(a*g-c*d),e[9]=-(r*(d*w-g*_)-u*(i*w-n*_)+y*(i*g-n*d)),e[10]=r*(a*w-c*_)-o*(i*w-n*_)+y*(i*c-n*a),e[11]=-(r*(a*g-c*d)-o*(i*g-n*d)+u*(i*c-n*a)),e[12]=-(o*(d*v-p*_)-u*(a*v-l*_)+y*(a*p-l*d)),e[13]=r*(d*v-p*_)-u*(i*v-s*_)+y*(i*p-s*d),e[14]=-(r*(a*v-l*_)-o*(i*v-s*_)+y*(i*l-s*a)),e[15]=r*(a*p-l*d)-o*(i*p-s*d)+u*(i*l-s*a),e}function TIe(e){const t=e[0],r=e[1],i=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],d=e[10],p=e[11],g=e[12],y=e[13],_=e[14],v=e[15];return(t*o-r*n)*(d*v-p*_)-(t*a-i*n)*(u*v-p*y)+(t*l-s*n)*(u*_-d*y)+(r*a-i*o)*(c*v-p*g)-(r*l-s*o)*(c*_-d*g)+(i*l-s*a)*(c*y-u*g)}function Jr(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],p=t[9],g=t[10],y=t[11],_=t[12],v=t[13],w=t[14],T=t[15];let x=r[0],S=r[1],O=r[2],A=r[3];return e[0]=x*i+S*a+O*d+A*_,e[1]=x*s+S*l+O*p+A*v,e[2]=x*n+S*c+O*g+A*w,e[3]=x*o+S*u+O*y+A*T,x=r[4],S=r[5],O=r[6],A=r[7],e[4]=x*i+S*a+O*d+A*_,e[5]=x*s+S*l+O*p+A*v,e[6]=x*n+S*c+O*g+A*w,e[7]=x*o+S*u+O*y+A*T,x=r[8],S=r[9],O=r[10],A=r[11],e[8]=x*i+S*a+O*d+A*_,e[9]=x*s+S*l+O*p+A*v,e[10]=x*n+S*c+O*g+A*w,e[11]=x*o+S*u+O*y+A*T,x=r[12],S=r[13],O=r[14],A=r[15],e[12]=x*i+S*a+O*d+A*_,e[13]=x*s+S*l+O*p+A*v,e[14]=x*n+S*c+O*g+A*w,e[15]=x*o+S*u+O*y+A*T,e}function Ja(e,t,r){const i=r[0],s=r[1],n=r[2];if(t===e)e[12]=t[0]*i+t[4]*s+t[8]*n+t[12],e[13]=t[1]*i+t[5]*s+t[9]*n+t[13],e[14]=t[2]*i+t[6]*s+t[10]*n+t[14],e[15]=t[3]*i+t[7]*s+t[11]*n+t[15];else{const o=t[0],a=t[1],l=t[2],c=t[3],u=t[4],d=t[5],p=t[6],g=t[7],y=t[8],_=t[9],v=t[10],w=t[11];e[0]=o,e[1]=a,e[2]=l,e[3]=c,e[4]=u,e[5]=d,e[6]=p,e[7]=g,e[8]=y,e[9]=_,e[10]=v,e[11]=w,e[12]=o*i+u*s+y*n+t[12],e[13]=a*i+d*s+_*n+t[13],e[14]=l*i+p*s+v*n+t[14],e[15]=c*i+g*s+w*n+t[15]}return e}function gN(e,t,r){const i=r[0],s=r[1],n=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function $l(e,t,r,i){let s,n,o,a,l,c,u,d,p,g,y,_,v,w,T,x,S,O,A,$,P,U,I,L,N=i[0],Z=i[1],W=i[2],V=Math.sqrt(N*N+Z*Z+W*W);return V<Ta()?null:(V=1/V,N*=V,Z*=V,W*=V,s=Math.sin(r),n=Math.cos(r),o=1-n,a=t[0],l=t[1],c=t[2],u=t[3],d=t[4],p=t[5],g=t[6],y=t[7],_=t[8],v=t[9],w=t[10],T=t[11],x=N*N*o+n,S=Z*N*o+W*s,O=W*N*o-Z*s,A=N*Z*o-W*s,$=Z*Z*o+n,P=W*Z*o+N*s,U=N*W*o+Z*s,I=Z*W*o-N*s,L=W*W*o+n,e[0]=a*x+d*S+_*O,e[1]=l*x+p*S+v*O,e[2]=c*x+g*S+w*O,e[3]=u*x+y*S+T*O,e[4]=a*A+d*$+_*P,e[5]=l*A+p*$+v*P,e[6]=c*A+g*$+w*P,e[7]=u*A+y*$+T*P,e[8]=a*U+d*I+_*L,e[9]=l*U+p*I+v*L,e[10]=c*U+g*I+w*L,e[11]=u*U+y*I+T*L,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function pT(e,t,r){const i=Math.sin(r),s=Math.cos(r),n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],d=t[10],p=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*s+c*i,e[5]=o*s+u*i,e[6]=a*s+d*i,e[7]=l*s+p*i,e[8]=c*s-n*i,e[9]=u*s-o*i,e[10]=d*s-a*i,e[11]=p*s-l*i,e}function yN(e,t,r){const i=Math.sin(r),s=Math.cos(r),n=t[0],o=t[1],a=t[2],l=t[3],c=t[8],u=t[9],d=t[10],p=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s-c*i,e[1]=o*s-u*i,e[2]=a*s-d*i,e[3]=l*s-p*i,e[8]=n*i+c*s,e[9]=o*i+u*s,e[10]=a*i+d*s,e[11]=l*i+p*s,e}function fT(e,t,r){const i=Math.sin(r),s=Math.cos(r),n=t[0],o=t[1],a=t[2],l=t[3],c=t[4],u=t[5],d=t[6],p=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s+c*i,e[1]=o*s+u*i,e[2]=a*s+d*i,e[3]=l*s+p*i,e[4]=c*s-n*i,e[5]=u*s-o*i,e[6]=d*s-a*i,e[7]=p*s-l*i,e}function U3(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function SIe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Nc(e,t,r){if(t===0)return Zu(e);let i,s,n,o=r[0],a=r[1],l=r[2],c=Math.sqrt(o*o+a*a+l*l);return c<Ta()?null:(c=1/c,o*=c,a*=c,l*=c,i=Math.sin(t),s=Math.cos(t),n=1-s,e[0]=o*o*n+s,e[1]=a*o*n+l*i,e[2]=l*o*n-a*i,e[3]=0,e[4]=o*a*n-l*i,e[5]=a*a*n+s,e[6]=l*a*n+o*i,e[7]=0,e[8]=o*l*n+a*i,e[9]=a*l*n-o*i,e[10]=l*l*n+s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Che(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function EIe(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ahe(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ohe(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=i+i,l=s+s,c=n+n,u=i*a,d=i*l,p=i*c,g=s*l,y=s*c,_=n*c,v=o*a,w=o*l,T=o*c;return e[0]=1-(g+_),e[1]=d+T,e[2]=p-w,e[3]=0,e[4]=d-T,e[5]=1-(u+_),e[6]=y+v,e[7]=0,e[8]=p+w,e[9]=y-v,e[10]=1-(u+g),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function CIe(e,t){const r=AIe,i=-t[0],s=-t[1],n=-t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=i*i+s*s+n*n+o*o;return d>0?(r[0]=2*(a*o+u*i+l*n-c*s)/d,r[1]=2*(l*o+u*s+c*i-a*n)/d,r[2]=2*(c*o+u*n+a*s-l*i)/d):(r[0]=2*(a*o+u*i+l*n-c*s),r[1]=2*(l*o+u*s+c*i-a*n),r[2]=2*(c*o+u*n+a*s-l*i)),Ohe(e,t,r),e}const AIe=C();function Ck(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function Rhe(e,t){const r=t[0],i=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(r*r+i*i+s*s),e[1]=Math.sqrt(n*n+o*o+a*a),e[2]=Math.sqrt(l*l+c*c+u*u),e}function OIe(e,t){const r=t[0]+t[5]+t[10];let i=0;return r>0?(i=2*Math.sqrt(r+1),e[3]=.25*i,e[0]=(t[6]-t[9])/i,e[1]=(t[8]-t[2])/i,e[2]=(t[1]-t[4])/i):t[0]>t[5]&&t[0]>t[10]?(i=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/i,e[0]=.25*i,e[1]=(t[1]+t[4])/i,e[2]=(t[8]+t[2])/i):t[5]>t[10]?(i=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/i,e[0]=(t[1]+t[4])/i,e[1]=.25*i,e[2]=(t[6]+t[9])/i):(i=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/i,e[0]=(t[8]+t[2])/i,e[1]=(t[6]+t[9])/i,e[2]=.25*i),e}function RIe(e,t,r,i){const s=t[0],n=t[1],o=t[2],a=t[3],l=s+s,c=n+n,u=o+o,d=s*l,p=s*c,g=s*u,y=n*c,_=n*u,v=o*u,w=a*l,T=a*c,x=a*u,S=i[0],O=i[1],A=i[2];return e[0]=(1-(y+v))*S,e[1]=(p+x)*S,e[2]=(g-T)*S,e[3]=0,e[4]=(p-x)*O,e[5]=(1-(d+v))*O,e[6]=(_+w)*O,e[7]=0,e[8]=(g+T)*A,e[9]=(_-w)*A,e[10]=(1-(d+y))*A,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function PIe(e,t,r,i,s){const n=t[0],o=t[1],a=t[2],l=t[3],c=n+n,u=o+o,d=a+a,p=n*c,g=n*u,y=n*d,_=o*u,v=o*d,w=a*d,T=l*c,x=l*u,S=l*d,O=i[0],A=i[1],$=i[2],P=s[0],U=s[1],I=s[2],L=(1-(_+w))*O,N=(g+S)*O,Z=(y-x)*O,W=(g-S)*A,V=(1-(p+w))*A,J=(v+T)*A,R=(y+x)*$,k=(v-T)*$,z=(1-(p+_))*$;return e[0]=L,e[1]=N,e[2]=Z,e[3]=0,e[4]=W,e[5]=V,e[6]=J,e[7]=0,e[8]=R,e[9]=k,e[10]=z,e[11]=0,e[12]=r[0]+P-(L*P+W*U+R*I),e[13]=r[1]+U-(N*P+V*U+k*I),e[14]=r[2]+I-(Z*P+J*U+z*I),e[15]=1,e}function MIe(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=r+r,a=i+i,l=s+s,c=r*o,u=i*o,d=i*a,p=s*o,g=s*a,y=s*l,_=n*o,v=n*a,w=n*l;return e[0]=1-d-y,e[1]=u+w,e[2]=p-v,e[3]=0,e[4]=u-w,e[5]=1-c-y,e[6]=g+_,e[7]=0,e[8]=p+v,e[9]=g-_,e[10]=1-c-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Phe(e,t,r,i,s,n,o){const a=1/(r-t),l=1/(s-i),c=1/(n-o);return e[0]=2*n*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*l,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(s+i)*l,e[10]=(o+n)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*n*2*c,e[15]=0,e}function IIe(e,t,r,i,s){const n=1/Math.tan(t/2);let o;return e[0]=n/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0?(o=1/(i-s),e[10]=(s+i)*o,e[14]=2*s*i*o):(e[10]=-1,e[14]=-2*i),e}function $Ie(e,t,r,i){const s=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-a)*l*.5,e[9]=(s-n)*c*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}function Mhe(e,t,r,i,s,n,o){const a=1/(t-r),l=1/(i-s),c=1/(n-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*a,e[13]=(s+i)*l,e[14]=(o+n)*c,e[15]=1,e}function _N(e,t,r,i){const s=t[0],n=t[1],o=t[2];let a=s-r[0],l=n-r[1],c=o-r[2];const u=Ta();if(Math.abs(a)<u&&Math.abs(l)<u&&Math.abs(c)<u)return void Zu(e);let d=1/Math.sqrt(a*a+l*l+c*c);a*=d,l*=d,c*=d;const p=i[0],g=i[1],y=i[2];let _=g*c-y*l,v=y*a-p*c,w=p*l-g*a;d=Math.sqrt(_*_+v*v+w*w),d?(d=1/d,_*=d,v*=d,w*=d):(_=0,v=0,w=0);let T=l*w-c*v,x=c*_-a*w,S=a*v-l*_;d=Math.sqrt(T*T+x*x+S*S),d?(d=1/d,T*=d,x*=d,S*=d):(T=0,x=0,S=0),e[0]=_,e[1]=T,e[2]=a,e[3]=0,e[4]=v,e[5]=x,e[6]=l,e[7]=0,e[8]=w,e[9]=S,e[10]=c,e[11]=0,e[12]=-(_*s+v*n+w*o),e[13]=-(T*s+x*n+S*o),e[14]=-(a*s+l*n+c*o),e[15]=1}function Ihe(e,t,r,i){const s=t[0],n=t[1],o=t[2],a=i[0],l=i[1],c=i[2];let u=s-r[0],d=n-r[1],p=o-r[2],g=u*u+d*d+p*p;g>0&&(g=1/Math.sqrt(g),u*=g,d*=g,p*=g);let y=l*p-c*d,_=c*u-a*p,v=a*d-l*u;return g=y*y+_*_+v*v,g>0&&(g=1/Math.sqrt(g),y*=g,_*=g,v*=g),e[0]=y,e[1]=_,e[2]=v,e[3]=0,e[4]=d*v-p*_,e[5]=p*y-u*v,e[6]=u*_-d*y,e[7]=0,e[8]=u,e[9]=d,e[10]=p,e[11]=0,e[12]=s,e[13]=n,e[14]=o,e[15]=1,e}function LIe(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function DIe(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)}function NIe(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function $he(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function FIe(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function UIe(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e}function Lhe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function wG(e,t){if(e===t)return!0;const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],p=e[10],g=e[11],y=e[12],_=e[13],v=e[14],w=e[15],T=t[0],x=t[1],S=t[2],O=t[3],A=t[4],$=t[5],P=t[6],U=t[7],I=t[8],L=t[9],N=t[10],Z=t[11],W=t[12],V=t[13],J=t[14],R=t[15],k=Ta();return Math.abs(r-T)<=k*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(i-x)<=k*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(s-S)<=k*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(n-O)<=k*Math.max(1,Math.abs(n),Math.abs(O))&&Math.abs(o-A)<=k*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(a-$)<=k*Math.max(1,Math.abs(a),Math.abs($))&&Math.abs(l-P)<=k*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(c-U)<=k*Math.max(1,Math.abs(c),Math.abs(U))&&Math.abs(u-I)<=k*Math.max(1,Math.abs(u),Math.abs(I))&&Math.abs(d-L)<=k*Math.max(1,Math.abs(d),Math.abs(L))&&Math.abs(p-N)<=k*Math.max(1,Math.abs(p),Math.abs(N))&&Math.abs(g-Z)<=k*Math.max(1,Math.abs(g),Math.abs(Z))&&Math.abs(y-W)<=k*Math.max(1,Math.abs(y),Math.abs(W))&&Math.abs(_-V)<=k*Math.max(1,Math.abs(_),Math.abs(V))&&Math.abs(v-J)<=k*Math.max(1,Math.abs(v),Math.abs(J))&&Math.abs(w-R)<=k*Math.max(1,Math.abs(w),Math.abs(R))}function xG(e){const t=Ta(),r=e[0],i=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10];return Math.abs(1-(r*r+n*n+l*l))<=t&&Math.abs(1-(i*i+o*o+c*c))<=t&&Math.abs(1-(s*s+a*a+u*u))<=t}function vN(e){return e[0]===1&&e[1]===0&&e[2]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[8]===0&&e[9]===0&&e[10]===1}const kIe=Jr,zIe=$he;Object.freeze(Object.defineProperty({__proto__:null,add:NIe,adjoint:xIe,copy:Ss,determinant:TIe,equals:wG,exactEquals:Lhe,frob:DIe,fromQuat:MIe,fromQuat2:CIe,fromRotation:Nc,fromRotationTranslation:Ohe,fromRotationTranslationScale:RIe,fromRotationTranslationScaleOrigin:PIe,fromScaling:SIe,fromTranslation:U3,fromXRotation:Che,fromYRotation:EIe,fromZRotation:Ahe,frustum:Phe,getRotation:OIe,getScaling:Rhe,getTranslation:Ck,hasIdentityRotation:vN,identity:Zu,invert:Fn,invertOrIdentity:m2,isOrthoNormal:xG,lookAt:_N,mul:kIe,multiply:Jr,multiplyScalar:FIe,multiplyScalarAndAdd:UIe,ortho:Mhe,perspective:IIe,perspectiveFromFieldOfView:$Ie,rotate:$l,rotateX:pT,rotateY:yN,rotateZ:fT,scale:gN,set:uf,str:LIe,sub:zIe,subtract:$he,targetTo:Ihe,translate:Ja,transpose:Bl},Symbol.toStringTag,{value:"Module"}));let hF,Q=null;function Dhe(){return!!Q}function BIe(){return!!ne("esri-wasm")}function Nhe(){return hF||(hF=ue(()=>import("./pe-wasm.ec7e51d2.js"),[]).then(e=>e.p).then(({default:e})=>e({locateFile:t=>$r(`esri/geometry/support/${t}`)})).then(e=>{Uhe(e)}),hF)}var Ak,ms,Ok;(function(e){function t(n,o,a){Q.ensureCache.prepare();const l=pv(a),c=a===l,u=Q.ensureFloat64(l),d=Q._pe_geog_to_proj(Q.getPointer(n),o,u);return d&&A0(a,o,u,c),d}function r(n,o,a,l){switch(l){case ms.PE_TRANSFORM_P_TO_G:return i(n,o,a);case ms.PE_TRANSFORM_G_TO_P:return t(n,o,a)}return 0}function i(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){Q.ensureCache.prepare();const c=pv(a),u=a===c,d=Q.ensureFloat64(c),p=Q._pe_proj_to_geog_center(Q.getPointer(n),o,d,l);return p&&A0(a,o,d,u),p}e.geogToProj=t,e.projGeog=r,e.projToGeog=i,e.projToGeogCenter=s})(Ak||(Ak={})),function(e){function t(){e.PE_BUFFER_MAX=Q.PeDefs.prototype.PE_BUFFER_MAX,e.PE_NAME_MAX=Q.PeDefs.prototype.PE_NAME_MAX,e.PE_MGRS_MAX=Q.PeDefs.prototype.PE_MGRS_MAX,e.PE_USNG_MAX=Q.PeDefs.prototype.PE_USNG_MAX,e.PE_DD_MAX=Q.PeDefs.prototype.PE_DD_MAX,e.PE_DDM_MAX=Q.PeDefs.prototype.PE_DDM_MAX,e.PE_DMS_MAX=Q.PeDefs.prototype.PE_DMS_MAX,e.PE_UTM_MAX=Q.PeDefs.prototype.PE_UTM_MAX,e.PE_PARM_MAX=Q.PeDefs.prototype.PE_PARM_MAX,e.PE_TYPE_NONE=Q.PeDefs.prototype.PE_TYPE_NONE,e.PE_TYPE_GEOGCS=Q.PeDefs.prototype.PE_TYPE_GEOGCS,e.PE_TYPE_PROJCS=Q.PeDefs.prototype.PE_TYPE_PROJCS,e.PE_TYPE_GEOGTRAN=Q.PeDefs.prototype.PE_TYPE_GEOGTRAN,e.PE_TYPE_COORDSYS=Q.PeDefs.prototype.PE_TYPE_COORDSYS,e.PE_TYPE_UNIT=Q.PeDefs.prototype.PE_TYPE_UNIT,e.PE_TYPE_LINUNIT=Q.PeDefs.prototype.PE_TYPE_LINUNIT,e.PE_STR_OPTS_NONE=Q.PeDefs.prototype.PE_STR_OPTS_NONE,e.PE_STR_AUTH_NONE=Q.PeDefs.prototype.PE_STR_AUTH_NONE,e.PE_STR_AUTH_TOP=Q.PeDefs.prototype.PE_STR_AUTH_TOP,e.PE_STR_NAME_CANON=Q.PeDefs.prototype.PE_STR_NAME_CANON,e.PE_PARM_X0=Q.PeDefs.prototype.PE_PARM_X0,e.PE_PARM_ND=Q.PeDefs.prototype.PE_PARM_ND,e.PE_TRANSFORM_1_TO_2=Q.PeDefs.prototype.PE_TRANSFORM_1_TO_2,e.PE_TRANSFORM_2_TO_1=Q.PeDefs.prototype.PE_TRANSFORM_2_TO_1,e.PE_TRANSFORM_P_TO_G=Q.PeDefs.prototype.PE_TRANSFORM_P_TO_G,e.PE_TRANSFORM_G_TO_P=Q.PeDefs.prototype.PE_TRANSFORM_G_TO_P,e.PE_HORIZON_RECT=Q.PeDefs.prototype.PE_HORIZON_RECT,e.PE_HORIZON_POLY=Q.PeDefs.prototype.PE_HORIZON_POLY,e.PE_HORIZON_LINE=Q.PeDefs.prototype.PE_HORIZON_LINE,e.PE_HORIZON_DELTA=Q.PeDefs.prototype.PE_HORIZON_DELTA}e.init=t}(ms||(ms={})),function(e){const t={},r={},i=g=>{if(g){const y=g.getType();switch(y){case ms.PE_TYPE_GEOGCS:g=Q.castObject(g,Q.PeGeogcs);break;case ms.PE_TYPE_PROJCS:g=Q.castObject(g,Q.PeProjcs);break;case ms.PE_TYPE_GEOGTRAN:g=Q.castObject(g,Q.PeGeogtran);break;default:y&ms.PE_TYPE_UNIT&&(g=Q.castObject(g,Q.PeUnit))}}return g};function s(){Q.PeFactory.prototype.initialize(null)}function n(g){return o(ms.PE_TYPE_COORDSYS,g)}function o(g,y){let _=null,v=t[g];if(v||(v={},t[g]=v),v.hasOwnProperty(String(y)))_=v[y];else{const w=Q.PeFactory.prototype.factoryByType(g,y);Q.compare(w,Q.NULL)||(_=w,v[y]=_)}return _=i(_),_}function a(g,y){let _=null,v=r[g];if(v||(v={},r[g]=v),v.hasOwnProperty(y))_=v[y];else{const w=Q.PeFactory.prototype.fromString(g,y);Q.compare(w,Q.NULL)||(_=w,v[y]=_)}return _=i(_),_}function l(g){return o(ms.PE_TYPE_GEOGCS,g)}function c(g){return o(ms.PE_TYPE_GEOGTRAN,g)}function u(g){return Q.PeFactory.prototype.getCode(g)}function d(g){return o(ms.PE_TYPE_PROJCS,g)}function p(g){return o(ms.PE_TYPE_UNIT,g)}e.initialize=s,e.coordsys=n,e.factoryByType=o,e.fromString=a,e.geogcs=l,e.geogtran=c,e.getCode=u,e.projcs=d,e.unit=p}(Ok||(Ok={}));let Fhe=null;var Y$,Rk,Pk,Mk,J$,Ik,K$,Q$,$k;function Uhe(e){function t(n,o,a){n[o]=a(n[o])}Q=e,ms.init(),Y$.init(),J$.init(),K$.init(),Q$.init(),Fhe=class extends Q.PeGCSExtent{destroy(){Q.destroy(this)}};const r=[Q.PeDatum,Q.PeGeogcs,Q.PeGeogtran,Q.PeObject,Q.PeParameter,Q.PePrimem,Q.PeProjcs,Q.PeSpheroid,Q.PeUnit];for(const n of r)t(n.prototype,"getName",o=>function(){return o.call(this,new Array(ms.PE_NAME_MAX))});for(const n of[Q.PeGeogtran,Q.PeProjcs])t(n.prototype,"getParameters",o=>function(){const a=new Array(ms.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const u=Q.getValue(l,"*");a[c]=u?Q.wrapPointer(u,Q.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});t(Q.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return A0(a,o,n.call(this)),a}),t(Q.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=Q._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!Q.compare(l,Q.NULL)){a=[l];const c=this.getSteps();if(c>1){const u=Q.getPointer(l);for(let d=1;d<c;d++)a.push(Q.wrapPointer(u+o*d,Q.PeGTlistExtendedGTs))}}return a}});const i=Q._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!Q.compare(l,Q.NULL)){a=[l];const c=l.getNump();if(c>1){const u=Q.getPointer(l);for(let d=1;d<c;d++)a.push(Q.wrapPointer(u+i*d,Q.PeHorizon))}}return o.set(n,a),a};t(Q.PeProjcs.prototype,"horizonGcsGenerate",s),t(Q.PeProjcs.prototype,"horizonPcsGenerate",s),Q.PeObject.prototype.toString=function(n=ms.PE_STR_OPTS_NONE){Q.ensureCache.prepare();const o=Q.getPointer(this),a=Q.ensureInt8(new Array(ms.PE_BUFFER_MAX));return Q.UTF8ToString(Q._pe_object_to_string_ext(o,n,a))}}function yf(e){if(!e)return;const t=Q.getClass(e);if(!t)return;const r=Q.getCache(t);if(!r)return;const i=Q.getPointer(e);i&&delete r[i]}function XO(e,t){const r=[],i=new Array(t);for(let s=0;s<e;s++)r.push(Q.ensureInt8(i));return r}function pv(e){let t;return Array.isArray(e[0])?(t=[],e.forEach(r=>{t.push(r[0],r[1])})):t=e,t}function A0(e,t,r,i=!1){if(i)for(let s=0;s<2*t;s++)e[s]=Q.getValue(r+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=e.length===0;for(let n=0;n<t;n++)s&&(e[n]=new Array(2)),e[n][0]=Q.getValue(r,"double"),e[n][1]=Q.getValue(r+Float64Array.BYTES_PER_ELEMENT,"double"),r+=2*Float64Array.BYTES_PER_ELEMENT}}(function(e){let t;function r(){e.PE_GTLIST_OPTS_COMMON=Q.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,t=Q._pe_getPeGTlistExtendedEntrySize()}function i(s,n,o,a,l,c){let u=null;const d=new Q.PeInteger(c);try{const p=Q.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,d);if((c=d.val)&&(u=[p],c>1)){const g=Q.getPointer(p);for(let y=1;y<c;y++)u.push(Q.wrapPointer(g+t*y,Q.PeGTlistExtendedEntry))}}finally{Q.destroy(d)}return u}e.init=r,e.getGTlist=i})(Y$||(Y$={})),function(e){function t(r){if(r&&r.length){for(const i of r)yf(i),i.getEntries().forEach(s=>{yf(s);const n=s.getGeogtran();yf(n),n.getParameters().forEach(yf),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{yf(o);const a=o.getDatum();yf(a),yf(a.getSpheroid()),yf(o.getPrimem()),yf(o.getUnit())})});Q.PeGTlistExtendedEntry.prototype.Delete(r[0])}}e.destroy=t}(Rk||(Rk={})),function(e){function t(r,i,s,n,o){Q.ensureCache.prepare();const a=pv(s),l=s===a,c=Q.ensureFloat64(a);let u=0;n&&(u=Q.ensureFloat64(n));const d=Q._pe_geog_to_geog(Q.getPointer(r),i,c,u,o);return d&&A0(s,i,c,l),d}e.geogToGeog=t}(Pk||(Pk={})),function(e){const t=(c,u,d,p,g,y)=>{let _,v;switch(Q.ensureCache.prepare(),c){case"dd":_=Q._pe_geog_to_dd,v=ms.PE_DD_MAX;break;case"ddm":_=Q._pe_geog_to_ddm,v=ms.PE_DDM_MAX;break;case"dms":_=Q._pe_geog_to_dms,v=ms.PE_DMS_MAX}let w=0;u&&(w=Q.getPointer(u));const T=pv(p),x=Q.ensureFloat64(T),S=XO(d,v),O=_(w,d,x,g,Q.ensureInt32(S));if(O)for(let A=0;A<d;A++)y[A]=Q.UTF8ToString(S[A]);return O},r=(c,u,d,p,g)=>{let y;switch(Q.ensureCache.prepare(),c){case"dd":y=Q._pe_dd_to_geog;break;case"ddm":y=Q._pe_ddm_to_geog;break;case"dms":y=Q._pe_dms_to_geog}let _=0;u&&(_=Q.getPointer(u));const v=p.map(S=>Q.ensureString(S)),w=Q.ensureInt32(v),T=Q.ensureFloat64(new Array(2*d)),x=y(_,d,w,T);return x&&A0(g,d,T),x};function i(c,u,d,p,g){return t("dms",c,u,d,p,g)}function s(c,u,d,p){return r("dms",c,u,d,p)}function n(c,u,d,p,g){return t("ddm",c,u,d,p,g)}function o(c,u,d,p){return r("ddm",c,u,d,p)}function a(c,u,d,p,g){return t("dd",c,u,d,p,g)}function l(c,u,d,p){return r("dd",c,u,d,p)}e.geogToDms=i,e.dmsToGeog=s,e.geogToDdm=n,e.ddmToGeog=o,e.geogToDd=a,e.ddToGeog=l}(Mk||(Mk={})),function(e){function t(){e.PE_MGRS_STYLE_NEW=Q.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=Q.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=Q.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=Q.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=Q.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function r(s,n,o,a,l,c,u){Q.ensureCache.prepare();let d=0;s&&(d=Q.getPointer(s));const p=pv(o),g=Q.ensureFloat64(p),y=XO(n,ms.PE_MGRS_MAX),_=Q.ensureInt32(y),v=Q._pe_geog_to_mgrs_extended(d,n,g,a,l,c,_);if(v)for(let w=0;w<n;w++)u[w]=Q.UTF8ToString(y[w]);return v}function i(s,n,o,a,l){Q.ensureCache.prepare();let c=0;s&&(c=Q.getPointer(s));const u=o.map(y=>Q.ensureString(y)),d=Q.ensureInt32(u),p=Q.ensureFloat64(new Array(2*n)),g=Q._pe_mgrs_to_geog_extended(c,n,d,a,p);return g&&A0(l,n,p),g}e.init=t,e.geogToMgrsExtended=r,e.mgrsToGeogExtended=i}(J$||(J$={})),function(e){function t(i,s,n,o,a,l,c){Q.ensureCache.prepare();let u=0;i&&(u=Q.getPointer(i));const d=pv(n),p=Q.ensureFloat64(d),g=XO(s,ms.PE_MGRS_MAX),y=Q.ensureInt32(g),_=Q._pe_geog_to_usng(u,s,p,o,a,l,y);if(_)for(let v=0;v<s;v++)c[v]=Q.UTF8ToString(g[v]);return _}function r(i,s,n,o){Q.ensureCache.prepare();let a=0;i&&(a=Q.getPointer(i));const l=n.map(p=>Q.ensureString(p)),c=Q.ensureInt32(l),u=Q.ensureFloat64(new Array(2*s)),d=Q._pe_usng_to_geog(a,s,c,u);return d&&A0(o,s,u),d}e.geogToUsng=t,e.usngToGeog=r}(Ik||(Ik={})),function(e){function t(){e.PE_UTM_OPTS_NONE=Q.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=Q.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=Q.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function r(s,n,o,a,l){Q.ensureCache.prepare();let c=0;s&&(c=Q.getPointer(s));const u=pv(o),d=Q.ensureFloat64(u),p=XO(n,ms.PE_UTM_MAX),g=Q.ensureInt32(p),y=Q._pe_geog_to_utm(c,n,d,a,g);if(y)for(let _=0;_<n;_++)l[_]=Q.UTF8ToString(p[_]);return y}function i(s,n,o,a,l){Q.ensureCache.prepare();let c=0;s&&(c=Q.getPointer(s));const u=o.map(y=>Q.ensureString(y)),d=Q.ensureInt32(u),p=Q.ensureFloat64(new Array(2*n)),g=Q._pe_utm_to_geog(c,n,d,a,p);return g&&A0(l,n,p),g}e.init=t,e.geogToUtm=r,e.utmToGeog=i}(K$||(K$={})),function(e){const t=new Map;function r(){e.PE_PCSINFO_OPTION_NONE=Q.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=Q.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=Q.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=Q.PePCSInfo.prototype.PE_POLE_POINT}function i(s,n=e.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return t.has(s)&&(a=t.get(s),a[n]&&(o=a[n])),o||(o=Q.PePCSInfo.prototype.generate(s,n),a||(a=[],t.set(s,a)),a[n]=o),o}e.init=r,e.generate=i}(Q$||(Q$={})),function(e){function t(){return Q.PeVersion.prototype.version_string()}e.versionString=t}($k||($k={}));const VIe=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return Ak},get PeDefs(){return ms},get PeFactory(){return Ok},get PeGCSExtent(){return Fhe},get PeGTTransformations(){return Pk},get PeGTlistExtended(){return Y$},get PeGTlistExtendedEntry(){return Rk},get PeNotationDms(){return Mk},get PeNotationMgrs(){return J$},get PeNotationUsng(){return Ik},get PeNotationUtm(){return K$},get PePCSInfo(){return Q$},get PeVersion(){return $k},_init:Uhe,get _pe(){return Q},isLoaded:Dhe,isSupported:BIe,load:Nhe},Symbol.toStringTag,{value:"Module"})),mpt=Math.PI/180,gpt=/SPHEROID\[([^\]]+)]/i,yg=Kt.radius,ph=Kt.eccentricitySquared,GIe={a1:yg*ph,a2:yg*ph*yg*ph,a3:yg*ph*ph/2,a4:yg*ph*yg*ph*2.5,a5:yg*ph+yg*ph*ph/2,a6:1-ph},ypt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:Kt.radius,f:Kt.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:Mm.radius,f:Mm.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:Np.radius,f:Np.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:Np.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let ZO=0;class Mx{static fromGE(t){const r=new Mx;return r._wkt=t.wkt,r._wkid=t.wkid,r._isInverse=t.isInverse,r}constructor(t){this.uid=ZO++,t?(this._wkt=t.wkt!=null?t.wkt:null,this._wkid=t.wkid!=null?t.wkid:-1,this._isInverse=t.isInverse!=null&&t.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(t){this._wkt=t,this.uid=ZO++}get wkid(){return this._wkid}set wkid(t){this._wkid=t,this.uid=ZO++}get isInverse(){return this._isInverse}set isInverse(t){this._isInverse=t,this.uid=ZO++}getInverse(){const t=new Mx;return t._wkt=this.wkt,t._wkid=this._wkid,t._isInverse=!this.isInverse,t}}class pm{static cacheKey(t,r){return[t.wkid!==void 0&&t.wkid!==null?t.wkid.toString():"-1",t.wkt!==void 0&&t.wkt!==null?t.wkt.toString():"",r.wkid!==void 0&&r.wkid!==null?r.wkid.toString():"-1",r.wkt!==void 0&&r.wkt!==null?r.wkt.toString():""].join(",")}static fromGE(t){const r=new pm;let i="";for(const s of t.steps){const n=Mx.fromGE(s);r.steps.push(n),i+=n.uid.toString()+","}return r._cachedProjection={},r._gtlistentry=null,r._chain=i,r}constructor(t){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,t&&t.steps)for(const r of t.steps)r instanceof Mx?this.steps.push(r):this.steps.push(new Mx({wkid:r.wkid,wkt:r.wkt,isInverse:r.isInverse}))}getInverse(){const t=new pm;t.steps=[];for(let r=this.steps.length-1;r>=0;r--){const i=this.steps[r];t.steps.push(i.getInverse())}return t}getGTListEntry(){let t="";for(const r of this.steps)t+=r.uid.toString()+",";return t!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=t),this._gtlistentry}assignCachedGe(t,r,i){this._cachedProjection[pm.cacheKey(t,r)]=i}getCachedGeTransformation(t,r){let i="";for(const n of this.steps)i+=n.uid.toString()+",";i!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=i);const s=this._cachedProjection[pm.cacheKey(t,r)];return s===void 0?null:s}}function jIe(e,t,r){if(t==null||r==null||r.vcsWkid||kn(t,r))return null;const i=s9(t)/s9(r);if(i===1)return null;switch(e){case"point":case"esriGeometryPoint":return s=>HIe(s,i);case"polyline":case"esriGeometryPolyline":return s=>qIe(s,i);case"polygon":case"esriGeometryPolygon":return s=>WIe(s,i);case"multipoint":case"esriGeometryMultipoint":return s=>XIe(s,i);case"extent":case"esriGeometryEnvelope":return s=>ZIe(s,i);default:return null}}function HIe(e,t){e&&e.z!=null&&(e.z*=t)}function WIe(e,t){if(e)for(const r of e.rings)for(const i of r)i.length>2&&(i[2]*=t)}function qIe(e,t){if(e)for(const r of e.paths)for(const i of r)i.length>2&&(i[2]*=t)}function XIe(e,t){if(e)for(const r of e.points)r.length>2&&(r[2]*=t)}function ZIe(e,t){e&&e.zmin!=null&&e.zmax!=null&&(e.zmin*=t,e.zmax*=t)}let hd=null,my=null,gC=null,HM={};const khe=new iN;function bN(){return!!hd&&Dhe()}function yA(e){return gC==null&&(gC=Promise.all([Nhe(),ue(()=>import("./geometryEngineBase.d1b13217.js"),[]).then(t=>t.g),ue(()=>import("./hydrated.f8dda357.js"),[])])),gC.then(([,t,{hydratedAdapter:r}])=>{Jt(e),my=r,hd=t.default,hd._enableProjection(VIe),khe.notify()})}function g2(e,t,r=null,i=null){return Array.isArray(e)?e.length===0?[]:Lk(my,e,e[0].spatialReference,t,r,i):Lk(my,[e],e.spatialReference,t,r,i)[0]}function Lk(e,t,r,i,s=null,n=null){if(r==null||i==null)return t;if(Dm(r,i,s))return t.map(o=>TG(o,r,i));if(s==null){const o=pm.cacheKey(r,i);HM[o]!==void 0?s=HM[o]:((s=Bhe(r,i,void 0))==null&&(s=new pm),HM[o]=s)}if(hd==null||e==null)throw new wN;return n!=null?hd._project(e,t,r,i,s,n):hd._project(e,t,r,i,s)}function YIe(e,t){const r=zhe([e],t);return r.pending!=null?{pending:r.pending,geometry:null}:r.geometries!=null?{pending:null,geometry:r.geometries[0]}:{pending:null,geometry:null}}function zhe(e,t){if(!bN()){for(const r of e)if(r!=null&&!kn(r.spatialReference,t)&&jo(r.spatialReference)&&jo(t)&&!Dm(r.spatialReference,t))return Ft(khe),{pending:yA(),geometries:null}}return{pending:null,geometries:e.map(r=>r==null?null:kn(r.spatialReference,t)?r:jo(r.spatialReference)&&jo(t)?Vhe(r,t):null)}}function Bhe(e,t,r=null){if(e==null||t==null)return null;if(hd==null||my==null)throw new wN;const i=hd._getTransformation(my,e,t,r,r?.spatialReference);return i!==null?pm.fromGE(i):null}function JIe(e,t,r=null){if(hd==null||my==null)throw new wN;const i=hd._getTransformationBySuitability(my,e,t,r,r?.spatialReference);if(i!==null){const s=[];for(const n of i)s.push(pm.fromGE(n));return s}return[]}class wN extends G{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var q;function KIe(){hd=null,my=null,gC=null,HM={}}(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",e[e.WGS84=2]="WGS84",e[e.WEB_MERCATOR=3]="WEB_MERCATOR",e[e.WGS84_ECEF=4]="WGS84_ECEF",e[e.CGCS2000=5]="CGCS2000",e[e.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",e[e.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",e[e.GCSMARS2000=8]="GCSMARS2000",e[e.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",e[e.GCSMOON2000=10]="GCSMOON2000",e[e.LON_LAT=11]="LON_LAT",e[e.PLATE_CARREE=12]="PLATE_CARREE"})(q||(q={}));const QIe={get loadPromise(){return gC}};function Vhe(e,t){try{const r=g2(e,t);if(r==null)return null;"xmin"in e&&"xmin"in r&&(r.zmin=e.zmin,r.zmax=e.zmax);const i=jIe(r.type,e.spatialReference,t);return i?.(r),r}catch(r){if(!(r instanceof wN))throw r;return null}}function Dm(e,t,r){return!r&&(!!kn(e,t)||jo(e)&&jo(t)&&!!AG(e,t,RG))}async function e$e(e,t,r,i){if(bN())return cq(i);if(Array.isArray(e)){for(const{source:s,dest:n,geographicTransformation:o}of e)if(!Dm(s,n,o))return yA(i)}else if(!Dm(e,t,r))return yA(i);return cq(i)}function t$e(e,t){switch(AG(e,t,RG)){case vi:return"copy3";case j0:return"wgs84ToSphericalECEF";case b1:return"wgs84ToWebMercator";case G0:return"wgs84ToPlateCarree";case W0:return"wgs84ToWGS84ECEF";case Bv:return"webMercatorToWGS84";case Qhe:return"webMercatorToSphericalECEF";case ede:return"webMercatorToWGS84ECEF";case tde:return"webMercatorToPlateCarree";case q0:return"wgs84ECEFToWGS84";case nde:return"wgs84ECEFToSphericalECEF";case ode:return"wgs84ECEFToWebMercator";case H0:return"sphericalECEFToWGS84";case ide:return"sphericalECEFToWebMercator";case kk:return"sphericalMarsPCPFToMars2000";case Uk:return"sphericalMoonPCPFToMoon2000";case sde:return"sphericalECEFToWGS84ECEF";case Fk:return"mars2000ToSphericalPCPF";case Nk:return"moon2000ToSphericalPCPF";default:return null}}function TG(e,t,r){return e?"x"in e?jhe(e,t,new ut,r,0):"xmin"in e?Xhe(e,t,new Pr,r,0):"rings"in e?qhe(e,t,new J1,r,0):"paths"in e?Whe(e,t,new rN,r,0):"points"in e?Hhe(e,t,new I3,r,0):null:null}function Ghe(e,t,r=t.spatialReference,i=0){return r!=null&&e.spatialReference!=null&&jhe(e,e.spatialReference,t,r,i)!=null}function jhe(e,t,r,i,s){Ar[0]=e.x,Ar[1]=e.y;const n=e.z;return Ar[2]=n!==void 0?n:s,ji(Ar,t,0,Ar,i,0,1)?(r.x=Ar[0],r.y=Ar[1],r.spatialReference=i,n===void 0?(r.z=void 0,r.hasZ=!1):(r.z=Ar[2],r.hasZ=!0),e.m===void 0?(r.m=void 0,r.hasM=!1):(r.m=e.m,r.hasM=!0),r):null}function r$e(e,t,r=t.spatialReference,i=0){return e.spatialReference!=null&&r!=null&&Hhe(e,e.spatialReference,t,r,i)!=null}function Hhe(e,t,r,i,s){const{points:n,hasZ:o,hasM:a}=e,l=[],c=n.length,u=[];for(const d of n)u.push(d[0],d[1],o?d[2]:s);if(!ji(u,t,0,u,i,0,c))return null;for(let d=0;d<c;++d){const p=3*d,g=u[p],y=u[p+1];o&&a?l.push([g,y,u[p+2],n[d][3]]):o?l.push([g,y,u[p+2]]):a?l.push([g,y,n[d][2]]):l.push([g,y])}return r.points=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r}function i$e(e,t,r=t.spatialReference,i=0){return e.spatialReference!=null&&r!=null&&Whe(e,e.spatialReference,t,r,i)!=null}function Whe(e,t,r,i,s){const{paths:n,hasZ:o,hasM:a}=e,l=[];return Jhe(n,o??!1,a??!1,t,l,i,s)?(r.paths=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function s$e({hasZ:e,spatialReference:t,paths:r},i,s=0){const n=Yp(t,y2),o=Nu[n][q.WGS84_COMPARABLE_LON_LAT];if(o==null)return!1;const a=e?l=>l:l=>se(Ar,l[0],l[1],s);for(const l of r){const c=[];for(const u of l){const d=[0,0,s];o(a(u),0,d,0),c.push(d)}i.push(c)}return!0}function n$e({hasZ:e,spatialReference:t,rings:r},i,s=0){const n=Yp(t,y2),o=Nu[n][q.WGS84_COMPARABLE_LON_LAT];if(o==null)return!1;const a=e?l=>l:l=>se(Ar,l[0],l[1],s);for(const l of r){const c=[];for(const u of l){const d=[0,0,s];o(a(u),0,d,0),c.push(d)}i.push(c)}return!0}function o$e(e,t,r=t.spatialReference,i=0){return e.spatialReference!=null&&r!=null&&qhe(e,e.spatialReference,t,r,i)!=null}function qhe(e,t,r,i,s){const{rings:n,hasZ:o,hasM:a}=e,l=[];return Jhe(n,o??!1,a??!1,t,l,i,s)?(r.rings=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function a$e(e,t,r=t.spatialReference,i=0){return e.spatialReference!=null&&r!=null&&Xhe(e,e.spatialReference,t,r,i)!=null}function Xhe(e,t,r,i,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:u}=e;return Dk(n,o,c?e.zmin:s,t,Ar,i)?(r.xmin=Ar[0],r.ymin=Ar[1],c&&(r.zmin=Ar[2]),Dk(a,l,c?e.zmax:s,t,Ar,i)?(r.xmax=Ar[0],r.ymax=Ar[1],c&&(r.zmax=Ar[2]),u&&(r.mmin=e.mmin,r.mmax=e.mmax),r.spatialReference=i,r):null):null}function Nm(e,t,r){if(t==null||r==null)return null;const i=new ut({spatialReference:r});return ji(e,t,0,Ar,r,0,1)?(i.x=Ar[0],i.y=Ar[1],i.z=Ar[2],i):null}function SG(e,t,r){return ji(e,t,0,Ar,r.spatialReference,0,1)?(r.x=Ar[0],r.y=Ar[1],r.z=Ar[2],r):null}function no(e,t,r,i=0){Ar[0]=e.x,Ar[1]=e.y;const s=e.z;return Ar[2]=s!==void 0?s:i,ji(Ar,e.spatialReference,0,t,r,0,1)}function Dk(e,t,r,i,s,n){return Xi[0]=e,Xi[1]=t,Xi[2]=r,ji(Xi,i,0,s,n,0,1)}function yn(e,t,r,i){return!(t==null||i==null||e.length<2)&&(e.length===2&&(Xi[0]=e[0],Xi[1]=e[1],Xi[2]=0,e=Xi),ji(e,t,0,r,i,0,1))}function Zhe(e,t){Ar[0]=e.x,Ar[1]=e.y;const r=e.z;return Ar[2]=r!==void 0?r:0,Yhe(Ar,e.spatialReference,t)}function Yhe(e,t,r){return l$e(e,t,r)}function l$e(e,t,r){if(t==null)return!1;const i=Yp(t,y2),s=Nu[i][q.WGS84_COMPARABLE_LON_LAT];return s!=null&&(s(e,0,Xi,0),r!==Xi&&(r[0]=Xi[0],r[1]=Xi[1],r.length>2&&(r[2]=Xi[2])),!0)}function ji(e,t,r,i,s,n,o=1){const a=AG(t,s,RG);if(a==null)return!1;if(a===vi){if(e===i&&r===n)return!0;const c=r+3*o;for(let u=r,d=n;u<c;u++,d++)i[d]=e[u];return!0}const l=r+3*o;for(let c=r,u=n;c<l;c+=3,u+=3)a(e,c,i,u);return!0}function c$e(e,t,r,i,s){re(Ar,e),oe(YO,e,t),yn(Ar,r,Ar,s),yn(YO,r,YO,s),ce(i,YO,Ar),pe(i,i)}function Jhe(e,t,r,i,s,n,o=0){const a=new Array;for(const c of e)for(const u of c)a.push(u[0],u[1],t?u[2]:o);if(!ji(a,i,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;for(const c of e){const u=new Array;for(const d of c)t&&r?u.push([a[l++],a[l++],a[l++],d[3]]):t?u.push([a[l++],a[l++],a[l++]]):r?(u.push([a[l++],a[l++],d[2]]),l++):(u.push([a[l++],a[l++]]),l++);s.push(u)}return!0}function u$e(e,t,r,i){if(t==null||i==null)return!1;const s=ade(t,i,_$e);if(s.projector===vi)return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],!0;if(s.projector==null)return!1;const{source:n,dest:o}=s;if(o.spatialReferenceId===q.WEB_MERCATOR){const a=Nu[n.spatialReferenceId][q.WGS84];return a!=null&&(a(e,0,Gh,0),b1(Gh,0,r,0),r[3]=OZ(Gh[1],e[2],e[3],Kt.radius),!0)}if(n.spatialReferenceId!==q.WGS84&&n.spatialReferenceId!==q.CGCS2000||o.spatialReferenceId!==q.PLATE_CARREE){s.projector(e,0,r,0);const a=n.metersPerUnit??1,l=o.metersPerUnit??1;r[3]=e[3]*a/l}else{const a=Nu[n.spatialReferenceId][q.SPHERICAL_ECEF],l=Nu[q.SPHERICAL_ECEF][q.PLATE_CARREE];let c=e[3];a!=null&&l!=null&&(c=OZ(e[1],e[2],e[3],Kt.radius)),s.projector(e,0,r,0),r[3]=c}return!0}function OZ(e,t,r,i){const s=i+t;if(s<i/2||r>s)return Number.MAX_VALUE;const n=Math.abs(id*e)+Math.asin(r/s);return n>=Math.PI/2?Number.MAX_VALUE:r/Math.cos(n)}function k3(e,t,r,i){return e!=null&&(kn(t,i)?(Im(r,e),!0):(Xi[0]=e[0],Xi[1]=e[1],Xi[2]=0,!!ji(Xi,t,0,Xi,i,0,1)&&(r[0]=Xi[0],r[1]=Xi[1],Xi[0]=e[2],Xi[1]=e[3],Xi[2]=0,!!ji(Xi,t,0,Xi,i,0,1)&&(r[2]=Xi[0],r[3]=Xi[1],!0))))}function h$e(e,t,r,i){if(t==null||i==null)return!1;const s=Yp(t,y2),n=Yp(i,lde);if(s===n&&s!==q.UNKNOWN||kn(t,i))return r[0]=1,r[1]=1,r[2]=1,!0;if(s===q.SPHERICAL_ECEF){const o=Se(e),a=o/Math.sqrt(e[0]*e[0]+e[1]*e[1]),l=o/Kt.radius;if(n===q.WEB_MERCATOR)return r[0]=a*l,r[1]=a*l,r[2]=1,!0;if(n===q.WGS84||n===q.CGCS2000){const c=yC;return r[0]=c*a*l,r[1]=c*l,r[2]=1,!0}}else if(s===q.PLATE_CARREE){if(n===q.WGS84||n===q.CGCS2000)return r[0]=yC,r[1]=yC,r[2]=1,!0;if(n===q.WEB_MERCATOR){const o=e[1]/Kt.radius;return r[0]=1,r[1]=1/Math.cos(o),r[2]=1,!0}}return!1}function Oc(e,t,r,i){if(e==null||i==null)return!1;const s=Yp(e,y2),n=Yp(i,lde);if(s===n&&!RZ(n)&&(s!==q.UNKNOWN||kn(e,i)))return U3(r,t),!0;if(RZ(n)){const o=Nu[s][q.LON_LAT],a=Nu[q.LON_LAT][n];return o!=null&&a!=null&&(o(t,0,Gh,0),a(Gh,0,_g,0),EG(id*Gh[0],id*Gh[1],r),r[12]=_g[0],r[13]=_g[1],r[14]=_g[2],!0)}if((n===q.WEB_MERCATOR||n===q.PLATE_CARREE)&&(s===q.WGS84||s===q.CGCS2000&&n===q.PLATE_CARREE||s===q.SPHERICAL_ECEF||s===q.WEB_MERCATOR)){const o=Nu[s][q.LON_LAT],a=Nu[q.LON_LAT][n];return o!=null&&a!=null&&(o(t,0,Gh,0),a(Gh,0,_g,0),s===q.SPHERICAL_ECEF?Khe(id*Gh[0],id*Gh[1],r):Zu(r),r[12]=_g[0],r[13]=_g[1],r[14]=_g[2],!0)}return!1}function RZ(e){return e===q.SPHERICAL_ECEF||e===q.SPHERICAL_MARS_PCPF||e===q.SPHERICAL_MOON_PCPF}function EG(e,t,r){const i=Math.sin(e),s=Math.cos(e),n=Math.sin(t),o=Math.cos(t),a=r;return a[0]=-i,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*i,a[9]=o*i,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function Khe(e,t,r){return EG(e,t,r),Bl(r,r),r}function Yp(e,t){return e?t.spatialReference===e?t.spatialReferenceId:(t.spatialReference=e,"metersPerUnit"in t&&(t.metersPerUnit=Sa(e,1)),e.wkt===Ice.wkt?t.spatialReferenceId=q.SPHERICAL_ECEF:lA(e)?t.spatialReferenceId=q.WGS84:h1(e)?t.spatialReferenceId=q.WEB_MERCATOR:M7(e)?t.spatialReferenceId=q.PLATE_CARREE:e.wkt===$ce.wkt?t.spatialReferenceId=q.WGS84_ECEF:e.wkid===Pu.CGCS2000?t.spatialReferenceId=q.CGCS2000:e.wkt===D7.wkt?t.spatialReferenceId=q.SPHERICAL_MARS_PCPF:e.wkt===N7.wkt?t.spatialReferenceId=q.SPHERICAL_MOON_PCPF:af(e)?t.spatialReferenceId=q.GCSMARS2000:lf(e)?t.spatialReferenceId=q.GCSMOON2000:t.spatialReferenceId=q.UNKNOWN):q.UNKNOWN}function vi(e,t,r,i){e!==r&&(r[i++]=e[t++],r[i++]=e[t++],r[i]=e[t])}function Bv(e,t,r,i){r[i++]=mT*(e[t++]/Kt.radius),r[i++]=mT*(Math.PI/2-2*Math.atan(Math.exp(-e[t++]/Kt.radius))),r[i]=e[t]}function Qhe(e,t,r,i){Bv(e,t,r,i),j0(r,i,r,i)}function ede(e,t,r,i){Bv(e,t,r,i),W0(r,i,r,i)}function xN(e,t,r,i,s){const n=.4999999*Math.PI,o=fe(id*e[t+1],-n,n),a=Math.sin(o);r[i++]=id*e[t]*s.radius,r[i++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),r[i]=e[t+2]}function b1(e,t,r,i){xN(e,t,r,i,Kt)}const PZ=Kt.radius*Math.PI/180,yC=180/(Kt.radius*Math.PI);function G0(e,t,r,i){r[i]=e[t]*PZ,r[i+1]=e[t+1]*PZ,r[i+2]=e[t+2]}function Ov(e,t,r,i){r[i]=e[t]*yC,r[i+1]=e[t+1]*yC,r[i+2]=e[t+2]}function tde(e,t,r,i){Bv(e,t,r,i),G0(r,i,r,i)}function d$e(e,t,r,i){q0(e,t,r,i),G0(r,i,r,i)}function p$e(e,t,r,i){H0(e,t,r,i),G0(r,i,r,i)}function f$e(e,t,r,i){Ov(e,t,r,i),j0(r,i,r,i)}function m$e(e,t,r,i){Ov(e,t,r,i),b1(r,i,r,i)}function g$e(e,t,r,i){Ov(e,t,r,i),W0(r,i,r,i)}function gy(e){if(e==null)return!1;const t=Yp(e,y2);return!!Nu[t][q.WGS84_COMPARABLE_LON_LAT]}function rde(e,t,r,i){const s=Math.cos(r);e[0]=Math.cos(t)*s*i,e[1]=Math.sin(t)*s*i,e[2]=Math.sin(r)*i}function CG(e,t,r,i,s){const n=s+e[t+2],o=id*e[t+1],a=id*e[t],l=Math.cos(o);r[i++]=Math.cos(a)*l*n,r[i++]=Math.sin(a)*l*n,r[i]=Math.sin(o)*n}function Nk(e,t,r,i){CG(e,t,r,i,Mm.radius)}function Fk(e,t,r,i){CG(e,t,r,i,Np.radius)}function j0(e,t,r,i){CG(e,t,r,i,Kt.radius)}function TN(e,t,r,i,s){const n=e[t],o=e[t+1],a=e[t+2],l=Math.sqrt(n*n+o*o+a*a),c=Hu(a/(l===0?1:l)),u=Math.atan2(o,n);r[i++]=mT*u,r[i++]=mT*c,r[i]=l-s}function Uk(e,t,r,i){TN(e,t,r,i,Mm.radius)}function kk(e,t,r,i){TN(e,t,r,i,Np.radius)}function H0(e,t,r,i){TN(e,t,r,i,Kt.radius)}function ide(e,t,r,i){H0(e,t,r,i),b1(r,i,r,i)}function sde(e,t,r,i){H0(e,t,r,i),W0(r,i,r,i)}function y$e(e,t,r,i,s){const n=id*e[t],o=id*e[t+1],a=e[t+2],l=Math.sin(o),c=Math.cos(o),u=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);r[i++]=(u+a)*c*Math.cos(n),r[i++]=(u+a)*c*Math.sin(n),r[i++]=(u*(1-s.eccentricitySquared)+a)*l}function W0(e,t,r,i){y$e(e,t,r,i,Kt)}function q0(e,t,r,i){const s=GIe,n=e[t],o=e[t+1],a=e[t+2];let l,c,u,d,p,g,y,_,v,w,T,x,S,O,A,$,P,U,I,L,N;l=Math.abs(a),c=n*n+o*o,u=Math.sqrt(c),d=c+a*a,p=Math.sqrt(d),L=Math.atan2(o,n),g=a*a/d,y=c/d,O=s.a2/p,A=s.a3-s.a4/p,y>.3?(_=l/p*(1+y*(s.a1+O+g*A)/p),I=Math.asin(_),w=_*_,v=Math.sqrt(1-w)):(v=u/p*(1-g*(s.a5-O-y*A)/p),I=Math.acos(v),w=1-v*v,_=Math.sqrt(w)),T=1-Kt.eccentricitySquared*w,x=Kt.radius/Math.sqrt(T),S=s.a6*x,O=u-x*v,A=l-S*_,P=v*O+_*A,$=v*A-_*O,U=$/(S/T+P),I+=U,N=P+$*U/2,a<0&&(I=-I),r[i++]=mT*L,r[i++]=mT*I,r[i]=N}function nde(e,t,r,i){q0(e,t,r,i),j0(r,i,r,i)}function ode(e,t,r,i){q0(e,t,r,i),b1(r,i,r,i)}const Nu={[q.WGS84]:{[q.CGCS2000]:null,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:vi,[q.WGS84_COMPARABLE_LON_LAT]:vi,[q.SPHERICAL_ECEF]:j0,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:b1,[q.PLATE_CARREE]:G0,[q.WGS84]:vi,[q.WGS84_ECEF]:W0},[q.CGCS2000]:{[q.CGCS2000]:vi,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:vi,[q.WGS84_COMPARABLE_LON_LAT]:vi,[q.SPHERICAL_ECEF]:j0,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:G0,[q.WGS84]:null,[q.WGS84_ECEF]:W0},[q.GCSMARS2000]:{[q.CGCS2000]:null,[q.GCSMARS2000]:vi,[q.GCSMOON2000]:null,[q.LON_LAT]:vi,[q.WGS84_COMPARABLE_LON_LAT]:null,[q.SPHERICAL_ECEF]:null,[q.SPHERICAL_MARS_PCPF]:Fk,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:null,[q.WGS84]:null,[q.WGS84_ECEF]:null},[q.GCSMOON2000]:{[q.CGCS2000]:null,[q.GCSMARS2000]:null,[q.GCSMOON2000]:vi,[q.LON_LAT]:vi,[q.WGS84_COMPARABLE_LON_LAT]:null,[q.SPHERICAL_ECEF]:null,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:Nk,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:null,[q.WGS84]:null,[q.WGS84_ECEF]:null},[q.WEB_MERCATOR]:{[q.CGCS2000]:null,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:Bv,[q.WGS84_COMPARABLE_LON_LAT]:Bv,[q.SPHERICAL_ECEF]:Qhe,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:vi,[q.PLATE_CARREE]:tde,[q.WGS84]:Bv,[q.WGS84_ECEF]:ede},[q.WGS84_ECEF]:{[q.CGCS2000]:q0,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:q0,[q.WGS84_COMPARABLE_LON_LAT]:q0,[q.SPHERICAL_ECEF]:nde,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:ode,[q.PLATE_CARREE]:d$e,[q.WGS84]:q0,[q.WGS84_ECEF]:vi},[q.SPHERICAL_ECEF]:{[q.CGCS2000]:H0,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:H0,[q.WGS84_COMPARABLE_LON_LAT]:H0,[q.SPHERICAL_ECEF]:vi,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:ide,[q.PLATE_CARREE]:p$e,[q.WGS84]:H0,[q.WGS84_ECEF]:sde},[q.SPHERICAL_MARS_PCPF]:{[q.CGCS2000]:null,[q.GCSMARS2000]:kk,[q.GCSMOON2000]:null,[q.LON_LAT]:kk,[q.WGS84_COMPARABLE_LON_LAT]:null,[q.SPHERICAL_ECEF]:null,[q.SPHERICAL_MARS_PCPF]:vi,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:null,[q.WGS84]:null,[q.WGS84_ECEF]:null},[q.SPHERICAL_MOON_PCPF]:{[q.CGCS2000]:null,[q.GCSMARS2000]:null,[q.GCSMOON2000]:Uk,[q.LON_LAT]:Uk,[q.WGS84_COMPARABLE_LON_LAT]:null,[q.SPHERICAL_ECEF]:null,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:vi,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:null,[q.WGS84]:null,[q.WGS84_ECEF]:null},[q.UNKNOWN]:{[q.CGCS2000]:null,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:null,[q.WGS84_COMPARABLE_LON_LAT]:null,[q.SPHERICAL_ECEF]:null,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:vi,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:null,[q.WGS84]:null,[q.WGS84_ECEF]:null},[q.LON_LAT]:{[q.CGCS2000]:vi,[q.GCSMARS2000]:vi,[q.GCSMOON2000]:vi,[q.LON_LAT]:vi,[q.WGS84_COMPARABLE_LON_LAT]:vi,[q.SPHERICAL_ECEF]:j0,[q.SPHERICAL_MARS_PCPF]:Fk,[q.SPHERICAL_MOON_PCPF]:Nk,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:b1,[q.PLATE_CARREE]:G0,[q.WGS84]:vi,[q.WGS84_ECEF]:W0},[q.WGS84_COMPARABLE_LON_LAT]:{[q.CGCS2000]:null,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:vi,[q.WGS84_COMPARABLE_LON_LAT]:vi,[q.SPHERICAL_ECEF]:j0,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:G0,[q.WGS84]:vi,[q.WGS84_ECEF]:W0},[q.PLATE_CARREE]:{[q.CGCS2000]:Ov,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:Ov,[q.WGS84_COMPARABLE_LON_LAT]:Ov,[q.SPHERICAL_ECEF]:f$e,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:m$e,[q.PLATE_CARREE]:vi,[q.WGS84]:Ov,[q.WGS84_ECEF]:g$e}};function AG(e,t,r=OG()){return e==null||t==null?null:ade(e,t,r).projector}function ade(e,t,r){if(e==null||t==null||r.source.spatialReference===e&&r.dest.spatialReference===t)return r;const i=Yp(e,r.source),s=Yp(t,r.dest);return i===q.UNKNOWN&&s===q.UNKNOWN?kn(e,t)?r.projector=vi:r.projector=null:r.projector=Nu[i][s],r}function OG(){return{source:{spatialReference:null,spatialReferenceId:q.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:q.UNKNOWN,metersPerUnit:1},projector:vi}}const y2={spatialReference:null,spatialReferenceId:q.UNKNOWN},lde={spatialReference:null,spatialReferenceId:q.UNKNOWN},RG=OG(),_$e=OG(),id=Ot(1),mT=xa(1),Xi=C(),Gh=C(),_g=C(),Ar=C(),YO=C();var _pt=Object.freeze(Object.defineProperty({__proto__:null,canProjectToWGS84ComparableLonLat:gy,canProjectWithoutEngine:Dm,computeENUToSphericalPCPFLocalRotation:EG,computeSphericalPCPFToENULocalRotation:Khe,computeTranslationToOriginAndRotation:Oc,getProjectorName:t$e,getTransformation:Bhe,getTransformations:JIe,initializeProjection:e$e,isLoaded:bN,load:yA,localLinearScaleFactors:h$e,lonLatToSphericalPCPF:rde,lonLatToWebMercatorComparable:xN,project:g2,projectBoundingRect:k3,projectBoundingSphere:u$e,projectBuffer:ji,projectDirection:c$e,projectExtent:a$e,projectMany:Lk,projectMultipoint:r$e,projectOrLoad:YIe,projectOrLoadMany:zhe,projectPoint:Ghe,projectPointToVector:no,projectPointToWGS84ComparableLonLat:Zhe,projectPolygon:o$e,projectPolygonToWGS84ComparableLonLat:n$e,projectPolyline:i$e,projectPolylineToWGS84ComparableLonLat:s$e,projectVectorToDehydratedPoint:SG,projectVectorToPoint:Nm,projectVectorToVector:yn,projectVectorToWGS84ComparableLonLat:Yhe,projectWithoutEngine:TG,projectXYZToVector:Dk,sphericalPCPFtoLonLatElevation:TN,test:QIe,tryProjectWithZConversion:Vhe,unload:KIe},Symbol.toStringTag,{value:"Module"}));class qm{constructor(t){this._allocator=t,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&Kx(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const t=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*MZ);this._items.length=Math.min(t,this._items.length),this._itemsPtr=0}_grow(){for(let t=0;t<Math.max(8,Math.min(this._items.length,MZ));t++)this._items.push(this._allocator())}}const MZ=1024;function be(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function gT(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function PG(e,t,r,i,s,n,o,a,l,c,u,d,p,g,y,_){return[e,t,r,i,s,n,o,a,l,c,u,d,p,g,y,_]}function cde(e,t){return new Float64Array(e,t,16)}const Ks=be();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Ks,clone:gT,create:be,createView:cde,fromValues:PG},Symbol.toStringTag,{value:"Module"}));var Ll;(function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"})(Ll||(Ll={}));var eL;(function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"})(eL||(eL={}));function $i(){return[1,0,0,0,1,0,0,0,1]}function ude(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function v$e(e,t,r,i,s,n,o,a,l){return[e,t,r,i,s,n,o,a,l]}function hde(e,t){return new Float64Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:ude,create:$i,createView:hde,fromValues:v$e},Symbol.toStringTag,{value:"Module"}));function rh(){return[0,0,0,1]}function b$e(e){return[e[0],e[1],e[2],e[3]]}function w$e(e,t,r,i){return[e,t,r,i]}function dde(e,t){return new Float64Array(e,t,4)}const x$e=rh();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:x$e,clone:b$e,create:rh,createView:dde,fromValues:w$e},Symbol.toStringTag,{value:"Module"}));function Ne(){return[0,0]}function fE(e){return[e[0],e[1]]}function or(e,t){return[e,t]}function pde(e){const t=Ne(),r=Math.min(2,e.length);for(let i=0;i<r;++i)t[i]=e[i];return t}function fde(e,t){return new Float64Array(e,t,2)}function mde(){return Ne()}function gde(){return or(1,1)}function yde(){return or(1,0)}function _de(){return or(0,1)}const vd=mde(),T$e=gde(),vde=yde(),S$e=_de();Object.freeze(Object.defineProperty({__proto__:null,ONES:T$e,UNIT_X:vde,UNIT_Y:S$e,ZEROS:vd,clone:fE,create:Ne,createView:fde,fromArray:pde,fromValues:or,ones:gde,unitX:yde,unitY:_de,zeros:mde},Symbol.toStringTag,{value:"Module"}));function Ht(){return[0,0,0,0]}function z3(e){return[e[0],e[1],e[2],e[3]]}function At(e,t,r,i){return[e,t,r,i]}function MG(e){const t=Ht(),r=Math.min(4,e.length);for(let i=0;i<r;++i)t[i]=e[i];return t}function bde(e,t){return new Float64Array(e,t,4)}function wde(){return Ht()}function xde(){return At(1,1,1,1)}function Tde(){return At(1,0,0,0)}function Sde(){return At(0,1,0,0)}function Ede(){return At(0,0,1,0)}function Cde(){return At(0,0,0,1)}const Up=wde(),Mu=xde(),E$e=Tde(),C$e=Sde(),A$e=Ede(),O$e=Cde();Object.freeze(Object.defineProperty({__proto__:null,ONES:Mu,UNIT_W:O$e,UNIT_X:E$e,UNIT_Y:C$e,UNIT_Z:A$e,ZEROS:Up,clone:z3,create:Ht,createView:bde,fromArray:MG,fromValues:At,ones:xde,unitW:Cde,unitX:Tde,unitY:Sde,unitZ:Ede,zeros:wde},Symbol.toStringTag,{value:"Module"}));class gc{constructor(t,r,i){this._itemByteSize=t,this._itemCreate=r,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(i/this._itemByteSize)}get(){this._itemsPtr===0&&Kx(()=>this._reset());const t=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=t;){const r=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let i=0;i<this._itemsPerBuffer;++i)this._items.push(this._itemCreate(r,i*this._itemByteSize));this._buffers.push(r)}return this._items[this._itemsPtr++]}_reset(){const t=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>t;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(t=fb){return new gc(16,fde,t)}static createVec3f64(t=fb){return new gc(24,SV,t)}static createVec4f64(t=fb){return new gc(32,bde,t)}static createMat3f64(t=fb){return new gc(72,hde,t)}static createMat4f64(t=fb){return new gc(128,cde,t)}static createQuatf64(t=fb){return new gc(32,dde,t)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}}const fb=4*eL.KILOBYTES,vpt=gc.createVec2f64(),Le=gc.createVec3f64(),IG=gc.createVec4f64();gc.createMat3f64();const $G=gc.createMat4f64(),bpt=gc.createQuatf64();function Sd(e){return e?{origin:Ts(e.origin),vector:Ts(e.vector)}:{origin:C(),vector:C()}}function R$e(e,t){const r=M$e.get();return r.origin=e,r.vector=t,r}function wpt(e,t=Sd()){return P$e(e.origin,e.vector,t)}function P$e(e,t,r=Sd()){return re(r.origin,e),re(r.vector,t),r}function Vv(e,t,r=Sd()){return re(r.origin,e),ce(r.vector,t,e),r}function LG(e,t){const r=ce(Le.get(),t,e.origin),i=de(e.vector,r),s=de(e.vector,e.vector),n=fe(i/s,0,1),o=ce(Le.get(),te(Le.get(),e.vector,n),r);return de(o,o)}function xpt(e,t,r){return zk(e,t,0,1,r)}function Tpt(e,t,r){return oe(r,e.origin,te(r,e.vector,t))}function zk(e,t,r,i,s){const{vector:n,origin:o}=e,a=ce(Le.get(),t,o),l=de(n,a)/Bo(n);return te(s,n,fe(l,r,i)),oe(s,s,e.origin)}function Spt(e,t){if(Ode(e,R$e(t.origin,t.direction),!1,tL)){const{tA:r,pB:i,distance2:s}=tL;if(r>=0&&r<=1)return s;if(r<0)return gn(e.origin,i);if(r>1)return gn(oe(Le.get(),e.origin,e.vector),i)}return null}function Ade(e,t,r){return!!Ode(e,t,!0,tL)&&(re(r,tL.pA),!0)}function Ode(e,t,r,i){const n=e.origin,o=oe(Le.get(),n,e.vector),a=t.origin,l=oe(Le.get(),a,t.vector),c=Le.get(),u=Le.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],u[0]=l[0]-a[0],u[1]=l[1]-a[1],u[2]=l[2]-a[2],Math.abs(u[0])<1e-6&&Math.abs(u[1])<1e-6&&Math.abs(u[2])<1e-6)return!1;const d=Le.get();if(d[0]=o[0]-n[0],d[1]=o[1]-n[1],d[2]=o[2]-n[2],Math.abs(d[0])<1e-6&&Math.abs(d[1])<1e-6&&Math.abs(d[2])<1e-6)return!1;const p=c[0]*u[0]+c[1]*u[1]+c[2]*u[2],g=u[0]*d[0]+u[1]*d[1]+u[2]*d[2],y=c[0]*d[0]+c[1]*d[1]+c[2]*d[2],_=u[0]*u[0]+u[1]*u[1]+u[2]*u[2],v=(d[0]*d[0]+d[1]*d[1]+d[2]*d[2])*_-g*g;if(Math.abs(v)<1e-6)return!1;let w=(p*g-y*_)/v,T=(p+g*w)/_;r&&(w=fe(w,0,1),T=fe(T,0,1));const x=Le.get(),S=Le.get();return x[0]=n[0]+w*d[0],x[1]=n[1]+w*d[1],x[2]=n[2]+w*d[2],S[0]=a[0]+T*u[0],S[1]=a[1]+T*u[1],S[2]=a[2]+T*u[2],i.tA=w,i.tB=T,i.pA=x,i.pB=S,i.distance2=gn(x,S),!0}const tL={tA:0,tB:0,pA:C(),pB:C(),distance2:0},M$e=new qm(()=>Sd());function Dn(e){return e?IZ(Ts(e.origin),Ts(e.direction)):IZ(C(),C())}function IZ(e,t){return{origin:e,direction:t}}function Ept(e,t){return Om(e.origin,t.origin)&&Om(e.direction,t.direction)}function Fc(e,t){const r=D$e.get();return r.origin=e,r.direction=t,r}function rL(e,t=Dn()){return Rde(e.origin,e.direction,t)}function I$e(e,t,r=Dn()){return re(r.origin,e),ce(r.direction,t,e),r}function Rde(e,t,r=Dn()){return re(r.origin,e),re(r.direction,t),r}function $$e(e,t){const r=rt(Le.get(),pe(Le.get(),e.direction),ce(Le.get(),t,e.origin));return de(r,r)}function L$e(e,t,r){const i=de(e.direction,ce(r,t,e.origin));return oe(r,e.origin,te(r,e.direction,i)),r}const D$e=new qm(()=>Dn());function _C(e,t){return de(e,t)/Se(e)}function SN(e,t){const r=de(e,t)/(Se(e)*Se(t));return-_n(r)}function Pde(e,t,r){pe(JO,e),pe(dF,t);const i=de(JO,dF),s=_n(i),n=rt(JO,JO,dF);return de(n,r)<0?2*Math.PI-s:s}const JO=C(),dF=C(),Mde=ls();function ls(){return Ht()}function yT(e,t=ls()){return $u(t,e)}function Ide(e,t){return At(e[0],e[1],e[2],t)}function N$e(e){return e}function F$e(e){e[0]=e[1]=e[2]=e[3]=0}function EN(e,t){return e[0]=e[1]=e[2]=0,e[3]=t,e}function ym(e){return e[3]}function U$e(e){return e}function $de(e,t,r,i){return At(e,t,r,i)}function k$e(e,t,r){return e!==r&&re(r,e),r[3]=e[3]+t,r}function z$e(e,t,r){return K.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),e===r?r:yT(e,r)}function Dy(e,t,r){if(t==null)return!1;const{origin:i,direction:s}=t,n=B$e;n[0]=i[0]-e[0],n[1]=i[1]-e[1],n[2]=i[2]-e[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];if(o===0)return!1;const a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-e[3]*e[3]);if(l<0)return!1;const c=Math.sqrt(l);let u=(-a-c)/(2*o);const d=(-a+c)/(2*o);return(u<0||d<u&&d>0)&&(u=d),!(u<0)&&(r&&(r[0]=i[0]+s[0]*u,r[1]=i[1]+s[1]*u,r[2]=i[2]+s[2]*u),!0)}const B$e=C();function Bk(e,t){return Dy(e,t,null)}function V$e(e,t,r){if(Dy(e,t,r))return r;const i=_2(e,t,Le.get());return oe(r,t.origin,te(Le.get(),t.direction,ni(t.origin,i)/Se(t.direction))),r}function _2(e,t,r){const i=Le.get(),s=$G.get();rt(i,t.origin,t.direction);const n=ym(e);rt(r,i,t.origin),te(r,r,1/Se(r)*n);const o=Nde(e,t.origin),a=SN(t.origin,r);return Nc(s,a+o,i),Ue(r,r,s),r}function G$e(e,t,r){return Dy(e,t,r)?r:(L$e(t,e,r),Lde(e,r,r))}function Lde(e,t,r){const i=ce(Le.get(),t,e),s=te(Le.get(),i,e[3]/Se(i));return oe(r,s,e)}function Dde(e,t){const r=ce(Le.get(),t,e),i=Bo(r),s=e[3]*e[3];return Math.sqrt(Math.abs(i-s))}function Nde(e,t){const r=ce(Le.get(),t,e),i=Se(r),s=ym(e),n=s+Math.abs(s-i);return _n(s/n)}const pF=C();function Fde(e,t,r,i){const s=ce(pF,t,e);switch(r){case Ll.X:{const n=rq(s,pF)[2];return se(i,-Math.sin(n),Math.cos(n),0)}case Ll.Y:{const n=rq(s,pF),o=n[1],a=n[2],l=Math.sin(o);return se(i,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case Ll.Z:return pe(i,s);default:return}}function Ude(e,t){const r=ce(Vk,t,e);return Se(r)-e[3]}function j$e(e,t,r,i){const s=Ude(e,t),n=Fde(e,t,Ll.Z,Vk),o=te(Vk,n,r-s);return oe(i,t,o)}function H$e(e,t){const r=gn(e,t),i=ym(e);return r<=i*i}function W$e(e,t,r=ls()){const i=ni(e,t),s=e[3],n=t[3];return i+n<s?($u(r,e),r):i+s<n?($u(r,t),r):(Lr(r,e,t,(i+n-s)/(2*i)),r[3]=(i+s+n)/2,r)}const Vk=C(),CN=ls(),q$e=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:Mde,altitudeAt:Ude,angleToSilhouette:Nde,axisAt:Fde,clear:F$e,closestPoint:G$e,closestPointOnSilhouette:_2,containsPoint:H$e,copy:yT,create:ls,distanceToSilhouette:Dde,elevate:k$e,fromCenterAndRadius:Ide,fromRadius:EN,fromValues:$de,getCenter:U$e,getRadius:ym,intersectRay:Dy,intersectRayClosestSilhouette:V$e,intersectsRay:Bk,projectPoint:Lde,setAltitudeAt:j$e,setExtent:z$e,tmpSphere:CN,union:W$e,wrap:N$e},Symbol.toStringTag,{value:"Module"}));function _T(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],r=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],i=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}function X$e(e,t){const r=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),i=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),s=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return se(e,r,i,s),e}function Cpt(e,t,r){r=r||e;const i=de(e,t);se(r,e[0]-i*t[0],e[1]-i*t[1],e[2]-i*t[2]),pe(r,r)}function Apt(e,t,r){Math.abs(e[0])>Math.abs(e[1])?se(t,0,1,0):se(t,1,0,0),rt(r,e,t),pe(t,t),rt(t,r,e),pe(r,r)}function Z$e(e,t){return(e%t+t)%t}function KO(e,t,r,i,s,n){const o=e+(t-e)*s;return o+(r+(i-r)*s-o)*n}function Y$e(e,t,r,i=C()){const s=Se(e),n=Se(t),o=de(e,t)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-r)*s+r*n)/Math.sin(a),c=l/s*Math.sin((1-r)*a),u=l/n*Math.sin(r*a);return te(Rv,e,c),te(Pv,t,u),oe(i,Rv,Pv)}return Lr(i,e,t,r)}function Opt(e,t,r,i=C(),s=C()){const n=Se(e),o=Se(t),a=de(e,t)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),u=Math.sin(r*l),d=Math.sin((1-r)*l),p=(1-r)*n+r*o;{const g=p/c,y=g/o*u;te(Rv,e,g/n*d),te(Pv,t,y),oe(i,Rv,Pv)}{const g=1/n*(-Math.cos((1-r)*l)*l*p+d*(-n+o));te(Rv,e,g);const y=1/o*(Math.cos(r*l)*l*p+u*(-n+o));te(Pv,t,y),oe(s,Rv,Pv),te(s,s,1/c)}return s}return Lr(i,e,t,r),ce(s,t,e),pe(s,s),s}function WM(e,t,r){e=pe(Rv,e),t=pe(Pv,t);const i=_n(de(e,t));if(r){const s=rt(J$e,e,t);if(de(s,r)<0)return-i}return i}function qM(e){const t=e.length;return r=>{if(r<=e[0][0])return e[0][1];if(r>=e[t-1][0])return e[t-1][1];let i=1;for(;r>e[i][0];)i++;const s=e[i-1][0],n=e[i][0],o=(n-r)/(n-s);return o*e[i-1][1]+(1-o)*e[i][1]}}function Rpt(e,t,r,i){ce($Z,t,e),ce(LZ,r,e),rt(i,$Z,LZ),pe(i,i),i[3]=-de(e,i)}const $Z=C(),LZ=C(),J$e=C(),Rv=C(),Pv=C();function Sr(e=mE){return[e[0],e[1],e[2],e[3]]}function K$e(e=mE[0],t=mE[1],r=mE[2],i=mE[3]){return DG(e,t,r,i,IG.get())}function AN(e,t){return DG(t[0],t[1],t[2],t[3],e)}function DG(e,t,r,i,s=Sr()){return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s}function kde(e,t,r){return re(r,e),r[3]=t,r}function B3(e,t,r){const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=t[0]*s,r[1]=t[1]*s,r[2]=t[2]*s,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function ko(e,t,r,i=Sr()){const s=r[0]-t[0],n=r[1]-t[1],o=r[2]-t[2],a=e[0]-t[0],l=e[1]-t[1],c=e[2]-t[2],u=n*c-o*l,d=o*a-s*c,p=s*l-n*a,g=u*u+d*d+p*p,y=Math.abs(g-1)>1e-5&&g>1e-12?1/Math.sqrt(g):1;return i[0]=u*y,i[1]=d*y,i[2]=p*y,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]),i}function zde(e,t,r,i,s){const n=e.length/3;if(n<3)return!1;se(Y2,e[3*r],e[3*r+1],e[3*r+2]);let o=i,a=!1;for(;o<n-1&&!a;){const l=3*o;se(mb,e[l],e[l+1],e[l+2]),o++,a=!Go(Y2,mb)}if(!a)return!1;for(o=Math.max(o,s),a=!1;o<n&&!a;){const l=3*o;se(fv,e[l],e[l+1],e[l+2]),o++,ce(QO,Y2,mb),pe(QO,QO),ce(eR,mb,fv),pe(eR,eR),a=!Go(Y2,fv)&&!Go(mb,fv)&&Math.abs(de(QO,eR))<Q$e}return a?(ko(Y2,mb,fv,t),!0):(r!==0||i!==1||s!==2)&&zde(e,t,0,1,2)}const Q$e=.99619469809,Y2=C(),mb=C(),fv=C(),QO=C(),eR=C();function Gk(e,t,r){return t!==e&&AN(e,t),e[3]=-de(e,r),e}function jk(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function _A(e,t,r,i){return rt(fv,t,e),B3(r,fv,i)}function Ppt(e,t,r,i){return ON(e,t,ce(Le.get(),r,t),nLe,i)}function ib(e,t,r){return t!=null&&ON(e,t.origin,t.direction,oLe,r)}function eLe(e,t,r){return ON(e,t.origin,t.vector,kp.NONE,r)}function tLe(e,t,r){return ON(e,t.origin,t.vector,kp.CLAMP,r)}function Bde(e,t){return ri(e,t)>=0}function rLe(e,t){const r=de(e,t.ray.direction),i=-ri(e,t.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const s=i/r;return r>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function iLe(e,t){const r=de(e,t.ray.direction),i=-ri(e,t.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;const s=i/r;return r>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function sLe(e,t,r){const i=te(Le.get(),e,-e[3]),s=Hk(e,ce(Le.get(),t,i),Le.get());return oe(r,s,i),r}function Hk(e,t,r){const i=te(Le.get(),e,de(e,t));return ce(r,t,i),r}function ri(e,t){return de(e,t)+e[3]}function ON(e,t,r,i,s){const n=de(e,r);if(n===0)return!1;let o=-(de(e,t)+e[3])/n;return i&kp.CLAMP&&(o=fe(o,0,1)),!(!(i&kp.INFINITE_MIN)&&o<0||!(i&kp.INFINITE_MAX)&&o>1)&&(oe(s,t,te(s,r,o)),!0)}function Mpt(e){return e}const mE=[0,0,1,0];var kp;(function(e){e[e.NONE=0]="NONE",e[e.CLAMP=1]="CLAMP",e[e.INFINITE_MIN=4]="INFINITE_MIN",e[e.INFINITE_MAX=8]="INFINITE_MAX"})(kp||(kp={}));const nLe=kp.INFINITE_MIN|kp.INFINITE_MAX,oLe=kp.INFINITE_MAX,fF=K.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class aLe{constructor(){this.plane=Sr(),this.origin=C(),this.basis1=C(),this.basis2=C()}}const Vde=aLe;function Xm(e=Qde){return{plane:Sr(e.plane),origin:Ts(e.origin),basis1:Ts(e.basis1),basis2:Ts(e.basis2)}}function lLe(e,t,r){const i=bLe.get();return i.origin=e,i.basis1=t,i.basis2=r,i.plane=K$e(0,0,0,0),RN(i),i}function sb(e,t=Xm()){return NG(e.origin,e.basis1,e.basis2,t)}function cLe(e,t){re(t.origin,e.origin),re(t.basis1,e.basis1),re(t.basis2,e.basis2),AN(t.plane,e.plane)}function NG(e,t,r,i=Xm()){return re(i.origin,e),re(i.basis1,t),re(i.basis2,r),RN(i),_Le(i,"fromValues()"),i}function RN(e){_A(e.basis2,e.basis1,e.origin,e.plane)}function Gde(e,t,r){e!==r&&sb(e,r);const i=te(Le.get(),Fm(e),t);return oe(r.origin,r.origin,i),r.plane[3]-=t,r}function uLe(e,t,r){return jde(t,r),Gde(r,zG(e,e.origin),r),r}function jde(e,t=Xm()){const r=(e[2]-e[0])/2,i=(e[3]-e[1])/2;return se(t.origin,e[0]+r,e[1]+i,0),se(t.basis1,r,0,0),se(t.basis2,0,i,0),DG(0,0,1,0,t.plane),t}function FG(e,t,r){return!!ib(e.plane,t,r)&&Jde(e,r)}function hLe(e,t,r){if(FG(e,t,r))return r;const i=Hde(e,t,Le.get());return oe(r,t.origin,te(Le.get(),t.direction,ni(t.origin,i)/Se(t.direction))),r}function Hde(e,t,r){const i=iL.get();Kde(e,t,i,iL.get());let s=Number.POSITIVE_INFINITY;for(const n of VG){const o=BG(e,n,PN.get()),a=Le.get();if(eLe(i,o,a)){const l=Hm(Le.get(),t.origin,a),c=Math.abs(_n(de(t.direction,l)));c<s&&(s=c,re(r,a))}}return s===Number.POSITIVE_INFINITY?Wde(e,t,r):r}function Wde(e,t,r){if(FG(e,t,r))return r;const i=iL.get(),s=iL.get();Kde(e,t,i,s);let n=Number.POSITIVE_INFINITY;for(const o of VG){const a=BG(e,o,PN.get()),l=Le.get();if(tLe(i,a,l)){const c=$$e(t,l);if(!Bde(s,l))continue;c<n&&(n=c,re(r,l))}}return UG(e,t.origin)<n&&qde(e,t.origin,r),r}function qde(e,t,r){const i=sLe(e.plane,t,Le.get()),s=zk(DZ(e,e.basis1),i,-1,1,Le.get()),n=zk(DZ(e,e.basis2),i,-1,1,Le.get());return ce(r,oe(Le.get(),s,n),e.origin),r}function Xde(e,t,r){const{origin:i,basis1:s,basis2:n}=e,o=ce(Le.get(),t,i),a=_C(s,o),l=_C(n,o),c=_C(Fm(e),o);return se(r,a,l,c)}function UG(e,t){const r=Xde(e,t,Le.get()),{basis1:i,basis2:s}=e,n=Se(i),o=Se(s),a=Math.max(Math.abs(r[0])-n,0),l=Math.max(Math.abs(r[1])-o,0),c=r[2];return a*a+l*l+c*c}function dLe(e,t){return Math.sqrt(UG(e,t))}function pLe(e,t){let r=Number.NEGATIVE_INFINITY;for(const i of VG){const s=BG(e,i,PN.get()),n=LG(s,t);n>r&&(r=n)}return Math.sqrt(r)}function kG(e,t){return Bde(e.plane,t)&&Jde(e,t)}function fLe(e,t,r,i){return yLe(e,r,i)}function zG(e,t){const r=-e.plane[3];return _C(Fm(e),t)-r}function mLe(e,t,r,i){const s=zG(e,t),n=te(vLe,Fm(e),r-s);return oe(i,t,n),i}function Zde(e,t){return Go(e.basis1,t.basis1)&&Go(e.basis2,t.basis2)&&Go(e.origin,t.origin)}function Yde(e,t,r){return e!==r&&sb(e,r),Fn(gb,t),Bl(gb,gb),Ue(r.basis1,e.basis1,gb),Ue(r.basis2,e.basis2,gb),Ue(r.plane,e.plane,gb),Ue(r.origin,e.origin,t),Gk(r.plane,r.plane,r.origin),r}function gLe(e,t,r,i){return e!==i&&sb(e,i),Nc(mF,t,r),Ue(i.basis1,e.basis1,mF),Ue(i.basis2,e.basis2,mF),RN(i),i}function Fm(e){return e.plane}function yLe(e,t,r){switch(t){case Ll.X:re(r,e.basis1),pe(r,r);break;case Ll.Y:re(r,e.basis2),pe(r,r);break;case Ll.Z:re(r,Fm(e))}return r}function Jde(e,t){const r=ce(Le.get(),t,e.origin),i=Bo(e.basis1),s=Bo(e.basis2),n=de(e.basis1,r),o=de(e.basis2,r);return-n-i<0&&n-i<0&&-o-s<0&&o-s<0}function DZ(e,t){const r=PN.get();return re(r.origin,e.origin),re(r.vector,t),r}function BG(e,t,r){const{basis1:i,basis2:s,origin:n}=e,o=te(Le.get(),i,t.origin[0]),a=te(Le.get(),s,t.origin[1]);oe(r.origin,o,a),oe(r.origin,r.origin,n);const l=te(Le.get(),i,t.direction[0]),c=te(Le.get(),s,t.direction[1]);return te(r.vector,oe(l,l,c),2),r}function _Le(e,t){Math.abs(de(e.basis1,e.basis2)/(Se(e.basis1)*Se(e.basis2)))>1e-6&&fF.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(de(e.basis1,Fm(e)))>1e-6&&fF.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-de(Fm(e),e.origin)-e.plane[3])>1e-6&&fF.warn(t,"Plane offset is not consistent with plane origin")}function Kde(e,t,r,i){const s=Fm(e);_A(s,t.direction,t.origin,r),_A(r,s,t.origin,i)}const Qde={plane:Sr(),origin:Ce(0,0,0),basis1:Ce(1,0,0),basis2:Ce(0,1,0)},iL=new qm(Sr),PN=new qm(Sd),vLe=C(),bLe=new qm(()=>Xm()),VG=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],gb=be(),mF=be(),wLe=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:Vde,UP:Qde,altitudeAt:zG,axisAt:fLe,closestPoint:Wde,closestPointOnSilhouette:Hde,copy:sb,copyWithoutVerify:cLe,create:Xm,distance:dLe,distance2:UG,distanceToSilhouette:pLe,elevate:Gde,equals:Zde,extrusionContainsPoint:kG,fromAABoundingRect:jde,fromValues:NG,intersectRay:FG,intersectRayClosestSilhouette:hLe,normal:Fm,projectPoint:qde,projectPointLocal:Xde,rotate:gLe,setAltitudeAt:mLe,setExtent:uLe,transform:Yde,updateUnboundedPlane:RN,wrap:lLe},Symbol.toStringTag,{value:"Module"})),xLe=new st(Ice),NZ=new st(D7),FZ=new st(N7),Ipt=new st($ce);function MN(e){return e&&(af(e)||kn(e,NZ))?NZ:e&&(lf(e)||kn(e,FZ))?FZ:xLe}function TLe(e){const{value:t,operations:r}=e;return{operations:r,value:r.create(t)}}function SLe(e,t,r){return e.operations.setExtent(e.value,t,r.value),r}function ELe(e){return{operations:e,value:e.create()}}function epe(e,t,r=ELe(e)){return r.operations=e,e.copy(t,r.value),r}function CLe(e){return epe(q$e,$de(0,0,0,Mr(e).radius))}const UZ=2**50;function ALe(){return epe(wLe,NG([0,0,0],[UZ,0,0],[0,UZ,0]))}function OLe(e,t,r){return e.operations.axisAt(e.value,t,Ll.Z,r)}function RLe(e,t,r,i){return e.operations.axisAt(e.value,t,r,i)}function PLe(e,t,r){return e.operations.intersectRay(e.value,t,r)}function MLe(e,t,r){return e.operations.intersectRayClosestSilhouette(e.value,t,r)}function ILe(e,t){return e.operations.altitudeAt(e.value,t)}function tpe(e,t,r,i){return e.operations.setAltitudeAt(e.value,t,r,i)}function $Le(e,t,r,i){return t!==i&&Ss(i,t),se(yb,i[12],i[13],i[14]),tpe(e,yb,r,yb),i[12]=yb[0],i[13]=yb[1],i[14]=yb[2],i}function gF(e,t,r){return e.operations.elevate(e.value,t,r.value)}const yb=C();function kZ(e,t,r,i,s){return s[0]=de(e,t),s[1]=de(e,r),s[2]=de(e,i),s}function Wk(e,t,r,i,s){re(r,e),re(tR,t),pe(tR,tR),rt(i,tR,r),rt(s,i,r)}function LLe(e,t){return e?MN(t):t.isGeographic?st.PlateCarree:t}const tR=C(),GG=96;function $pt(e,t){const r=t||e.extent,i=e.width,s=Sa(r&&r.spatialReference);return r&&i?r.width/i*s*F7*GG:0}function DLe(e,t){return e/(Sa(t)*F7*GG)}function NLe(e){return e/(F7*GG)}const FLe="OBJECTID";function Lpt(e){return e!=null&&typeof e=="object"&&"type"in e&&e.type==="feature"}function vC(e){const t=e?.type;return t==="base-tile"||t==="tile"||t==="elevation"||t==="imagery-tile"||t==="base-elevation"||t==="open-street-map"||t==="wcs"||t==="web-tile"||t==="wmts"||t==="vector-tile"}function vT(e){return e!=null&&"type"in e&&e.type==="group"}const Dpt={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function ULe(e){const t=e?.type;return t==="building-scene"||t==="integrated-mesh"||t==="point-cloud"||t==="scene"}function zZ(e){return e?.type==="voxel"}function BZ(e){return e?.type==="imagery-tile"}function rpe(e){return e!=null&&e.parent!=null&&"declaredClass"in e.parent&&e.parent.declaredClass==="esri.Basemap"&&e.parent.baseLayers.includes(e)}function jG(e){return e?.type==="feature"&&!e.url&&e.source?.type==="memory"}function Npt(e){return e?.type==="feature"&&e.source?.type==="feature-layer"}function kLe(e){if(e.activeLayer){const t=e.activeLayer.tileMatrixSet;if(t)return t;const r=e.activeLayer.tileMatrixSets;if(r)return r}return null}async function Fpt(e,t){const r=ar?.findServerInfo(e);if(r?.currentVersion!=null)return r.owningSystemUrl||null;const i=e.toLowerCase().indexOf("/rest/services");if(i===-1)return null;const s=`${e.substring(0,i)}/rest/info`,n=t!=null?t.signal:null,{data:o}=await ii(s,{query:{f:"json"},responseType:"json",signal:n});return o?.owningSystemUrl||null}function zLe(e){if(!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function BLe(e){return zLe(e)?"effectiveCapabilities"in e?e.effectiveCapabilities:e.capabilities:null}function VLe(e){if(!("editingEnabled"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function GLe(e){return!!VLe(e)&&("effectiveEditingEnabled"in e?e.effectiveEditingEnabled:e.editingEnabled)}let bT=class extends fC{constructor(e){super(e),this.handles.add(this.on("before-add",t=>{t.item!=null&&t.item.parent===this.owner&&(K.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),t.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};bT=h([F("esri.support.AnalysesCollection")],bT);const XM={widthBreakpoint:{getValue(e){const t=e.viewSize[0],r=e.breakpoints,i=this.values;return t<=r.xsmall?i.xsmall:t<=r.small?i.small:t<=r.medium?i.medium:t<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){const t=e.viewSize[1],r=e.breakpoints,i=this.values;return t<=r.xsmall?i.xsmall:t<=r.small?i.small:t<=r.medium?i.medium:t<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){const t=e.viewSize,r=t[0],i=t[1],s=this.values;return i>=r?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},yF={xsmall:544,small:768,medium:992,large:1200};function jLe(e){const t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}function _F(e,t){return t?XM[e].valueToClassName[t].split(" "):[]}const HLe=e=>{let t=class extends e{constructor(...r){super(...r),this._breakpointsHandles=new gi,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=yF}initialize(){this._breakpointsHandles.add(le(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Rr))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=Re(this._breakpointsHandles))}set breakpoints(r){if(r===this._get("breakpoints"))return;const i=jLe(r);if(!i){const s=JSON.stringify(yF,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}r=i?r:yF,this._set("breakpoints",{...r})}_updateClassNames(){if(!this.container)return;const r=Ol.acquire(),i=Ol.acquire();let s,n=!1;for(s in XM){const o=this[s],a=XM[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,_F(s,o).forEach(l=>i.push(l)),_F(s,a).forEach(l=>r.push(l)))}n&&(this._applyClassNameChanges(r,i),Ol.release(r),Ol.release(i))}_applyClassNameChanges(r,i){const s=this.container;s&&(i.forEach(n=>s.classList.remove(n)),r.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const r=this.container;if(!r)return;let i;for(i in XM)_F(i,this[i]).forEach(s=>r.classList.remove(s))}};return h([f()],t.prototype,"breakpoints",null),h([f()],t.prototype,"orientation",void 0),h([f()],t.prototype,"widthBreakpoint",void 0),h([f()],t.prototype,"heightBreakpoint",void 0),t=h([F("esri.views.BreakpointsOwner")],t),t};let r0=class extends xe{constructor(){super(...arguments),this.items=new Pt,this._watchUpdatingTracking=new Fp,this._callbacks=new Map,this._projector=TX(),this._hiddenProjector=TX()}get needsRender(){return this.items.length>0}get updating(){return this._watchUpdatingTracking?.updating??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,t=>{for(const r of t.added){const i=()=>r.render();this._callbacks.set(r,i),this._projector.append(this.surface,i)}for(const r of t.removed){const i=this._projector.detach(this._callbacks.get(r));this.surface.removeChild(i.domNode),this._callbacks.delete(r)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,r=this._hiddenProjector;let i;const s=()=>(i=e.render(),i);r.append(t,s),r.renderNow();const n={left:0,top:0,right:0,bottom:0};if(i&&i.domNode){const o=i.domNode.getBoundingClientRect();n.left=o.left,n.top=o.top,n.right=o.right,n.bottom=o.bottom}for(r.detach(s);t.firstChild;)t.removeChild(t.firstChild);return n}overlaps(e,t){const r=this.computeBoundingRect(e),i=this.computeBoundingRect(t);return Math.max(r.left,i.left)<=Math.min(r.right,i.right)&&Math.max(r.top,i.top)<=Math.min(r.bottom,i.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e){if(!this.items.some(r=>r.visible))return;const t=e.getContext("2d");t.save(),t.font=this._fontString(),this.items.forEach(r=>{t.save(),r.renderCanvas(t),t.restore()}),t.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};h([f({readOnly:!0})],r0.prototype,"surface",void 0),h([f({readOnly:!0})],r0.prototype,"items",void 0),h([f({readOnly:!0})],r0.prototype,"needsRender",null),h([f({readOnly:!0})],r0.prototype,"_watchUpdatingTracking",void 0),h([f({readOnly:!0})],r0.prototype,"updating",null),r0=h([F("esri.views.overlay.ViewOverlay")],r0);const VZ=r0,vF=[0,0];function WLe(e){const t=(e.ownerDocument||window.document).defaultView,r=e.getBoundingClientRect();return vF[0]=r.left+(t?.pageXOffset??0),vF[1]=r.top+(t?.pageYOffset??0),vF}function GZ(e){e&&(lle(e),e.parentNode&&e.parentNode.removeChild(e))}function qLe(e){const t=document.createElement("div");return e.appendChild(t),t}const J2=16,rR=750,XLe=512,ZLe=2,YLe=e=>{let t=class extends e{constructor(...r){super(...r),this._freqInfo={freq:J2,time:rR},this._overlayRenderTaskHandle=null,this.height=0,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([le(()=>this.cursor,i=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",i)}),le(()=>this.navigating,i=>{const{surface:s}=this;s&&s.setAttribute("data-navigating",i.toString())})])}initialize(){this.addHandles([le(()=>this.ui,(r,i)=>this._handleUIChange(r,i),Rr),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=Re(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(r){const i=this._get("container"),s=GD(r);if(s||typeof r!="string"||K.getLogger(this).error("#container",`element with id '${r}' not found`),i===s)return;if(this._stopMeasuring(),i&&(i.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(GZ(this.root),this._set("root",null)),this.userContent&&(pX(this.userContent,i),GZ(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const n=document.createElement("div");n.className="esri-view-user-storage",pX(s,n),s.appendChild(n),this._set("userContent",n);const o=document.createElement("div");o.className="esri-view-root",s.insertBefore(o,s.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new VZ;o.appendChild(l.surface),this._set("overlay",l),this.addHandles(le(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=Qx({render:()=>this.overlay?.render()}):this._overlayRenderTaskHandle=xi(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",s),this._startMeasuring()}get focused(){const r=document.activeElement===this.surface;return document.hasFocus()&&r}get size(){return[this.width,this.height]}blur(){this.surface?.blur()}focus(){this.surface?.focus()}pageToContainer(r,i,s){const n=this.position;return r-=n?n[0]:0,i-=n?n[1]:0,s?(s[0]=r,s[1]=i):s=[r,i],s}containerToPage(r,i,s){const n=this.position;return r+=n?n[0]:0,i+=n?n[1]:0,s?(s[0]=r,s[1]=i):s=[r,i],s}_handleUIChange(r,i){this.removeHandles("ui"),i&&i!==r&&i.destroy(),r&&(r.view=this,this.addHandles(le(()=>this.root,s=>{r.container=s?qLe(s):null},Rr),"ui")),this._set("ui",r)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const r=this._freqInfo;r.freq=J2,r.time=rR,this.addHandles([(()=>{const i=()=>{r.freq=J2,r.time=rR};return window.addEventListener("resize",i),{remove(){window.removeEventListener("resize",i)}}})(),Qx({prepare:i=>{const s=this._measure(),n=this._freqInfo;if(n.time+=i.deltaTime,s&&(n.freq=J2,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?J2:Math.min(rR,n.freq*ZLe),!s&&n.freq>=XLe&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const r=this.container,i=r?r.clientWidth:0,s=r?r.clientHeight:0;if(i===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return i===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",i),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:i,height:s}),!0)}_position(){const r=this.container,i=this.position,s=r&&WLe(r);return!!s&&(!i||s[0]!==i[0]||s[1]!==i[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return h([f()],t.prototype,"container",null),h([f({readOnly:!0})],t.prototype,"focused",null),h([f({readOnly:!0})],t.prototype,"height",void 0),h([f({type:VZ})],t.prototype,"overlay",void 0),h([f({readOnly:!0})],t.prototype,"position",void 0),h([f({readOnly:!0})],t.prototype,"resizing",void 0),h([f({readOnly:!0})],t.prototype,"root",void 0),h([f({value:null,readOnly:!0})],t.prototype,"size",null),h([f({readOnly:!0})],t.prototype,"surface",void 0),h([f({readOnly:!0})],t.prototype,"suspended",void 0),h([f()],t.prototype,"ui",void 0),h([f({readOnly:!0})],t.prototype,"userContent",void 0),h([f({readOnly:!0})],t.prototype,"width",void 0),h([f()],t.prototype,"widthBreakpoint",void 0),t=h([F("esri.views.DOMContainer")],t),t},HG=K.getLogger("esri.layers.support.ElevationSampler");class ipe{queryElevation(t){return spe(t.clone(),this)}on(){return tDe}projectIfRequired(t,r){return npe(t,r)}}class JLe extends ipe{get spatialReference(){return this.extent.spatialReference}constructor(t,r,i){super(),this.tile=t,this.noDataValue=i;const s=t.tile.extent;this.extent=QD(s,r.spatialReference),this.extent.zmin=t.zmin,this.extent.zmax=t.zmax,this._aaExtent=s;const n=Sa(r.spatialReference),o=r.lodAt(t.tile.level).resolution*n;this.demResolution={min:o,max:o}}contains(t){const r=this.projectIfRequired(t,this.spatialReference);return r!=null&&this.containsAt(r.x,r.y)}containsAt(t,r){return eN(this._aaExtent,t,r)}elevationAt(t,r){if(!this.containsAt(t,r)){const i=this.extent,s=`${i.xmin}, ${i.ymin}, ${i.xmax}, ${i.ymax}`;return HG.warn("#elevationAt()",`Point used to sample elevation (${t}, ${r}) is outside of the sampler extent (${s})`),this.noDataValue}return this.tile.sample(t,r)??this.noDataValue}}class Upt extends ipe{get spatialReference(){return this.extent.spatialReference}constructor(t,r,i){let s;super(),typeof r=="number"?(this.noDataValue=r,s=null):(s=r,this.noDataValue=i),this.samplers=s?t.map(o=>new JLe(o,s,this.noDataValue)):t;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=QD(Nt(),s.spatialReference),this.demResolution={min:0,max:0}}elevationAt(t,r){for(const i of this.samplers)if(i.containsAt(t,r))return i.elevationAt(t,r);return HG.warn("#elevationAt()",`Point used to sample elevation (${t}, ${r}) is outside of the sampler`),this.noDataValue}}function spe(e,t){const r=npe(e,t.spatialReference);if(!r)return null;switch(e.type){case"point":KLe(e,r,t);break;case"polyline":QLe(e,r,t);break;case"multipoint":eDe(e,r,t)}return e}function npe(e,t){if(e==null)return null;const r=e.spatialReference;if(r.equals(t))return e;const i=Y1(e,t);return i||HG.error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${t.wkid})`),i}function KLe(e,t,r){e.z=r.elevationAt(t.x,t.y)}function QLe(e,t,r){Cp.spatialReference=t.spatialReference;const i=e.hasM&&!e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s],o=t.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];Cp.x=c[0],Cp.y=c[1],i&&(l[3]=l[2]),l[2]=r.elevationAt(Cp.x,Cp.y)}}e.hasZ=!0}function eDe(e,t,r){Cp.spatialReference=t.spatialReference;const i=e.hasM&&!e.hasZ;for(let s=0;s<e.points.length;s++){const n=e.points[s],o=t.points[s];Cp.x=o[0],Cp.y=o[1],i&&(n[3]=n[2]),n[2]=r.elevationAt(Cp.x,Cp.y)}e.hasZ=!0}const Cp=new ut,tDe={remove(){}};var qk;let np=qk=class extends Pe{constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new qk({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};h([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],np.prototype,"cols",void 0),h([f({type:Ps,json:{write:!0}})],np.prototype,"level",void 0),h([f({type:String,json:{write:!0}})],np.prototype,"levelValue",void 0),h([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],np.prototype,"origin",void 0),h([f({type:Number,json:{write:!0}})],np.prototype,"resolution",void 0),h([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],np.prototype,"rows",void 0),h([f({type:Number,json:{write:!0}})],np.prototype,"scale",void 0),np=qk=h([F("esri.layers.support.LOD")],np);const Yh=np;class rDe{constructor(t,r,i,s,n=void 0){this.id=t,this.level=r,this.row=i,this.col=s,this.extent=n}}var i0;const jZ=new kl({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Io=i0=class extends Pe{static create(e={}){const{resolutionFactor:t=1,scales:r,size:i=256,spatialReference:s=st.WebMercator,numLODs:n=24}=e;if(!jo(s)){const d=[];if(r)for(let p=0;p<r.length;p++){const g=r[p];d.push(new Yh({level:p,scale:g,resolution:g}))}else{let p=5e-4;for(let g=n-1;g>=0;g--)d.unshift(new Yh({level:g,scale:p,resolution:p})),p*=2}return new i0({dpi:96,lods:d,origin:new ut(0,0,s),size:[i,i],spatialReference:s})}const o=Fv(s),a=e.origin?new ut({x:e.origin.x,y:e.origin.y,spatialReference:s}):new ut(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(Sa(s)*39.37*l),u=[];if(r)for(let d=0;d<r.length;d++){const p=r[d],g=p*c;u.push(new Yh({level:d,scale:p,resolution:g}))}else{let d=Pce(s)?512/i*5916575275917094e-7:256/i*591657527591555e-6;const p=Math.ceil(n/t);u.push(new Yh({level:0,scale:d,resolution:d*c}));for(let g=1;g<p;g++){const y=d/2**t,_=y*c;u.push(new Yh({level:g,scale:y,resolution:_})),d=y}}return new i0({dpi:l,lods:u,origin:a,size:[i,i],spatialReference:s})}constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const r=Fv(e);return e.isWrappable&&!!r&&Math.abs(r.origin[0]-t.x)<=r.dx}return!1}readOrigin(e,t){return ut.fromJSON({spatialReference:t.spatialReference,...e})}set lods(e){let t=0,r=0;const i=[],s=this._levelToLOD={};e&&(t=-1/0,r=1/0,e.forEach(n=>{i.push(n.scale),t=n.scale>t?n.scale:t,r=n.scale<r?n.scale:r,s[n.level]=n})),this._set("scales",i),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];const r=Math.floor(e),i=r+1;return t[r]/(t[r]/t[i])**(e-r)}scaleToZoom(e){const t=this.scales,r=t.length-1;let i=0;for(;i<r;i++){const s=t[i],n=t[i+1];if(s<=e)return i;if(n===e)return i+1;if(s>e&&n<e)return i+Math.log(s/e)/Math.log(s/n)}return i}snapScale(e,t=.95){const r=this.scaleToZoom(e);return r%Math.floor(r)>=t?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))}tileAt(e,t,r,i){const s=this.lodAt(e);if(!s)return null;let n,o;if(typeof t=="number")n=t,o=r;else if(kn(t.spatialReference,this.spatialReference))n=t.x,o=t.y,i=r;else{const c=Y1(t,this.spatialReference);if(c==null)return null;n=c.x,o=c.y,i=r}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return i||(i=new rDe(null,0,0,0,Nt())),i.level=e,i.row=Math.floor((this.origin.y-o)/l+.001),i.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(i),i}updateTileInfo(e,t=i0.ExtrapolateOptions.NONE){let r=this.lodAt(e.level);if(!r&&t===i0.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<e.level&&(r=o)}if(!r)return;const i=e.level-r.level,s=r.resolution*this.size[0]/2**i,n=r.resolution*this.size[1]/2**i;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=Nt()),e.extent[0]=this.origin.x+e.col*s,e.extent[1]=this.origin.y-(e.row+1)*n,e.extent[2]=e.extent[0]+s,e.extent[3]=e.extent[1]+n}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||t.parentLevel===-1)&&(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),!0)}getTileBounds(e,t){const r=this.lodAt(t.level);if(r==null)return null;const{resolution:i}=r,s=i*this.size[0],n=i*this.size[1];return e[0]=this.origin.x+t.col*s,e[1]=this.origin.y-(t.row+1)*n,e[2]=e[0]+s,e[3]=e[1]+n,e}lodAt(e){return this._levelToLOD?.[e]??null}clone(){return i0.fromJSON(this.write({}))}getOrCreateCompatible(e,t){if(this.size[0]===256&&this.size[1]===256)return e===256?this:null;const r=[],i=this.lods.length;for(let s=0;s<i;s++){const n=this.lods[s],o=n.resolution*t;r.push(new Yh({level:n.level,scale:n.scale,resolution:o}))}return new i0({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let r=0;r<e.length;r++){const i=e[r];this._upsampleLevels[i.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/i.resolution:0},t=i}}};h([f({type:Number,json:{write:!0}})],Io.prototype,"compressionQuality",void 0),h([f({type:Number,json:{write:!0}})],Io.prototype,"dpi",void 0),h([f({type:String,json:{read:jZ.read,write:jZ.write,origins:{"web-scene":{read:!1,write:!1}}}})],Io.prototype,"format",void 0),h([f({readOnly:!0})],Io.prototype,"isWrappable",null),h([f({type:ut,json:{write:!0}})],Io.prototype,"origin",void 0),h([br("origin")],Io.prototype,"readOrigin",null),h([f({type:[Yh],value:null,json:{write:!0}})],Io.prototype,"lods",null),h([f({readOnly:!0})],Io.prototype,"scales",void 0),h([f({cast:e=>Array.isArray(e)?e:typeof e=="number"?[e,e]:[256,256]})],Io.prototype,"size",void 0),h([br("size",["rows","cols"])],Io.prototype,"readSize",null),h([Yt("size",{cols:{type:Ps},rows:{type:Ps}})],Io.prototype,"writeSize",null),h([f({type:st,json:{write:!0}})],Io.prototype,"spatialReference",void 0),Io=i0=h([F("esri.layers.support.TileInfo")],Io),function(e){var t;(t=e.ExtrapolateOptions||(e.ExtrapolateOptions={}))[t.NONE=0]="NONE",t[t.POWER_OF_TWO=1]="POWER_OF_TWO"}(Io||(Io={}));const ZM=Io,iDe=12;class Pi{constructor(t){const r=Pi.checkUnsupported(t);if(r!=null)throw r;const i=t;this.spatialReference=i.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=gy(this.spatialReference)||af(this.spatialReference)||lf(this.spatialReference),this.origin=[i.origin.x,i.origin.y],this.pixelSize=i.size[0],this.dpi=i.dpi;const s=i.lods.reduce((c,u,d)=>(u.level<c.min&&(c.min=u.level,c.minIndex=d),c.max=Math.max(c.max,u.level),c),{min:1/0,minIndex:0,max:-1/0}),n=i.lods[s.minIndex],o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*i.size[0],a*i.size[1]]},a/=2,l/=2}clone(){return new Pi(this.toTileInfo())}toTileInfo(){return new ZM({dpi:this.dpi,origin:new ut({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((t,r)=>new Yh({level:r,scale:t.scale,resolution:t.resolution}))})}getExtent(t,r,i,s){const n=this.levels[t],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+i*o,s[2]=this.origin[0]+(i+1)*o,s[3]=this.origin[1]-r*a,s[1]=this.origin[1]-(r+1)*a}convertExtentToRadians(t,r){this._isWebMercator?(r[0]=eZ(t[0]),r[1]=k$(t[1]),r[2]=eZ(t[2]),r[3]=k$(t[3])):this._isGCS&&(r[0]=Ot(t[0]),r[1]=Ot(t[1]),r[2]=Ot(t[2]),r[3]=Ot(t[3]))}getExtentGeometry(t,r,i,s=new Pr){return this.getExtent(t,r,i,Id),s.spatialReference=this.spatialReference,s.xmin=Id[0],s.ymin=Id[1],s.xmax=Id[2],s.ymax=Id[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(t){if(t==null)return!1;let r=!1;for(;this.levels.length<=t;){const i=this.levels[this.levels.length-1],s=i.resolution/2;this.levels.push({resolution:s,scale:i.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),r=!0}return r}capMaxLod(t){this.levels.length>t+1&&(this.levels.length=t+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(t){return this.levels[0].scale/2**t}levelAtScale(t){const r=this.levels[0].scale;return t>=r?0:Math.log(r/t)*Math.LOG2E}resolutionAtLevel(t){return this.levels[0].resolution/2**t}compatibleWith(t){if(!(t instanceof Pi)){if(Pi.checkUnsupported(t))return!1;t=new Pi(t)}if(!t.spatialReference.equals(this.spatialReference)||t.pixelSize!==this.pixelSize)return!1;const r=Math.min(this.levels.length,t.levels.length)-1,i=this.levels[r].resolution;let s=.5*i;return!Sx(t.origin[0],this.origin[0],s)||!Sx(t.origin[1],this.origin[1],s)?!1:(s=.5*i/2**r/this.pixelSize*iDe,Sx(i,t.levels[r].resolution,s))}rootTilesInExtent(t,r=null,i=1/0){const s=new Array,n=this.levels[0].tileSize;if(t==null||n[0]===0||n[1]===0)return s;Pi.computeRowColExtent(t,n,this.origin,Id);let o=Id[1],a=Id[3],l=Id[0],c=Id[2];const u=c-l,d=a-o;if(u*d>i){const p=Math.floor(Math.sqrt(i));d>p&&(o=o+Math.floor(.5*d)-Math.floor(.5*p),a=o+p),u>p&&(l=l+Math.floor(.5*u)-Math.floor(.5*p),c=l+p)}for(let p=o;p<a;p++)for(let g=l;g<c;g++)s.push([0,p,g]);return r!=null&&(r[0]=this.origin[0]+l*n[0],r[1]=this.origin[1]-a*n[1],r[2]=this.origin[0]+c*n[0],r[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(t,r,i,s){const n=.001*(t[2]-t[0]+(t[3]-t[1]));s[0]=Math.max(0,Math.floor((t[0]+n-i[0])/r[0])),s[2]=Math.max(0,Math.ceil((t[2]-n-i[0])/r[0])),s[1]=Math.max(0,Math.floor((i[1]-t[3]+n)/r[1])),s[3]=Math.max(0,Math.ceil((i[1]-t[1]-n)/r[1]))}static isPowerOfTwo(t){const r=t.lods,i=r[0].resolution*2**r[0].level;return!r.some(s=>!dwe(s.resolution,i/2**s.level))}static hasGapInLevels(t){const r=t.lods.map(i=>i.level);r.sort((i,s)=>i-s);for(let i=1;i<r.length;i++)if(r[i]!==r[0]+i)return!0;return!1}static tileSizeSupported(t){const r=t.size[1];return r===t.size[0]&&(r&r-1)==0&&r>=128&&r<=512}static hasOriginPerLODs(t){const r=t.origin;return t.lods.some(i=>i.origin!=null&&(i.origin[0]!==r.x||i.origin[1]!==r.y))}static getMissingTileInfoError(){return new G("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(t){return t==null?WG():t.lods.length<1?new G("tilingscheme:generic","Tiling scheme must have at least one level"):Pi.isPowerOfTwo(t)?Pi.hasGapInLevels(t)?new G("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):Pi.tileSizeSupported(t)?Pi.hasOriginPerLODs(t)?new G("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new G("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new G("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(t,r){const i=t[2]-t[0],s=t[3]-t[1],n=Sa(r),o=1.2*Math.max(i,s),a=256,l=96,c=.0254,u=new Pi(new ZM({size:[a,a],origin:new ut({x:t[0]-.5*(o-i),y:t[3]+.5*(o-s)}),lods:[new Yh({level:0,resolution:o/a,scale:1/(a/l*c/(o*n))})],spatialReference:r}));return u.ensureMaxLod(20),u}static makeWebMercatorAuxiliarySphere(t){const r=new Pi(Pi.WebMercatorAuxiliarySphereTileInfo);return r.ensureMaxLod(t),r}static makeGCSWithTileSize(t,r=256,i=16){const s=256/r,n=new Pi(new ZM({size:[r,r],origin:new ut({x:-180,y:90,spatialReference:t}),spatialReference:t,lods:[new Yh({level:0,resolution:.703125*s,scale:295497598570834e-6*s})]}));return n.ensureMaxLod(i),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}function WG(){return new G("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}Pi.WebMercatorAuxiliarySphereTileInfo=new ZM({size:[256,256],origin:new ut({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:st.WebMercator}),spatialReference:st.WebMercator,lods:[new Yh({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),Pi.WebMercatorAuxiliarySphere=Pi.makeWebMercatorAuxiliarySphere(19);const Id=Nt(),ox=64,gE=512,sDe=2.5,vA=pwe(d8/10),ope=2,ape=Nt();Pi.WebMercatorAuxiliarySphere.getExtent(0,0,0,ape);const nDe=Nt([-180,-90,180,90]),oDe="Cannot extend surface to encompass all layers because it would result in too many root tiles.",aDe="Surface extent is too large for tile resolution at level 0.",lDe=3;let cDe=lDe;function Xk(e){return e<4?3:cDe}let s0=class extends cs.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=vA}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(e==null||e.extent==null||e.spatialReference==null)return null;const t=QD(e.extent,e.spatialReference);return t.zmin=e.visibleElevationBounds.min,t.zmax=e.visibleElevationBounds.max,t}get spatialReference(){return this.view.basemapTerrain?.spatialReference??st.WGS84}elevationAt(e,t){if(this.extent==null||!ua(this.extent,e,t)){const r=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return K.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler extent (${r})`),this.noDataValue}return this.view.elevationProvider?.getElevation(e,t,0,this.spatialReference,"ground")??this.noDataValue}queryElevation(e){return spe(e.clone(),this)}};h([f({readOnly:!0})],s0.prototype,"demResolution",void 0),h([f({readOnly:!0})],s0.prototype,"extent",null),h([f({readOnly:!0})],s0.prototype,"noDataValue",void 0),h([f()],s0.prototype,"spatialReference",null),h([f({constructOnly:!0})],s0.prototype,"view",void 0),s0=h([F("esri.views.support.GroundViewElevationSampler")],s0);const uDe=s0;let n0=class extends xe{constructor(e){super(e),this.view=null,this.layerViews=new Pt}initialize(){this.addHandles(Dc(()=>this.view?.map?.ground,e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this.removeAllHandles(),this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new uDe({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>le(()=>e.updating,()=>this._updateUpdating(),Vr)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};h([f({readOnly:!0})],n0.prototype,"elevationSampler",null),h([f({type:Boolean,readOnly:!0})],n0.prototype,"updating",null),h([f({constructOnly:!0})],n0.prototype,"view",void 0),h([f({type:Pt,readOnly:!0})],n0.prototype,"layerViews",void 0),h([f({readOnly:!0})],n0.prototype,"suspended",null),n0=h([F("esri.views.GroundView")],n0);const hDe=n0;function IN(e,t,r){return Sc(e.map((i,s)=>t.apply(r,[i,s])))}async function dDe(e,t,r){return(await Sc(e.map((i,s)=>t.apply(r,[i,s])))).map(i=>i.value)}function qG(e){return{ok:!0,value:e}}function XG(e){return{ok:!1,error:e}}function pDe(e){return e!=null&&e.ok===!0?e.value:null}function fDe(e){return e!=null&&e.ok===!1?e.error:null}async function Yu(e){if(e==null)return{ok:!1,error:new Error("no promise provided")};try{return qG(await e)}catch(t){return XG(t)}}async function kpt(e){try{return qG(await e)}catch(t){return W1(t),XG(t)}}function zpt(e){if(e.ok===!0)return e.value;throw e.error}function v2(e,t){return new o0(e,t)}let o0=class extends xe{get value(){return pDe(this._result)}get error(){return fDe(this._result)}get finished(){return this._result!=null}constructor(e,t){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=$c(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then(i=>{this._result=qG(i),this._cleanup()},i=>{this._result=XG(i),this._cleanup()}),this._abortHandle=Ws(t,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=xi(this._abortHandle),this._abortController=null}};h([f()],o0.prototype,"value",null),h([f()],o0.prototype,"error",null),h([f()],o0.prototype,"finished",null),h([f()],o0.prototype,"promise",void 0),h([f()],o0.prototype,"_result",void 0),o0=h([F("esri.core.asyncUtils.ReactiveTask")],o0);const HZ=new Set;function mDe(e,t,r=!1){r&&HZ.has(t)||(r&&HZ.add(t),e.warn(`\u{1F6D1} DEPRECATED - ${t}`))}function X0(e,t,r={}){if(ne("esri-deprecation-warnings")){const{moduleName:i}=r;sL(e,`Property: ${(i?i+"::":"")+t}`,r)}}function sL(e,t,r={}){if(ne("esri-deprecation-warnings")){const{replacement:i,version:s,see:n,warnOnce:o}=r;let a=t;i&&(a+=`
	\u{1F6E0}\uFE0F Replacement: ${i}`),s&&(a+=`
	\u2699\uFE0F Version: ${s}`),n&&(a+=`
	\u{1F517} See ${n} for more details.`),mDe(e,a,o)}}class Um{constructor(t,r){this._owner=r,this._properties={},this._afterDispatchHandle=null;for(const i in t){const s=t[i],n=new roe(s,void 0,void 0,2,2);this._properties[i]={pool:n,acquired:[]}}this._afterDispatchHandle=boe(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const t in this._properties){const r=this._properties[t];for(const i of r.acquired)gq(i)||r.pool.release(i);r.pool.destroy(),r.pool=null,r.acquired=null}this._properties=null,this._owner=null}get(t){const r=this._owner._get(t),i=this._properties[t];let s=i.pool.acquire();for(i.acquired.push(s);s===r;)i.acquired.push(s),s=i.pool.acquire();return s}_release(){for(const t in this._properties){const r=this._properties[t];let i=0;for(const s of r.acquired)gq(s)?r.acquired[i++]=s:r.pool.release(s);r.acquired.length=i}}}const gDe=ne("mac")?"Meta":"Ctrl",$N={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let e=48;e<58;e++)$N[e]=String.fromCharCode(e);for(let e=1;e<25;e++)$N[111+e]=`F${e}`;for(let e=65;e<91;e++)$N[e]=[String.fromCharCode(e+32),String.fromCharCode(e)];function yDe(e){if(e.key!==void 0)return jwe(e);const t=$N[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t}function _De(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}class vDe{constructor(t,r=[]){this.eventType=t,this.keyModifiers=r}matches(t){if(t.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const r=t.modifiers;for(const i of this.keyModifiers)if(!r.has(i))return!1;return!0}}const WZ=K.getLogger("esri.views.input.InputHandler");class ao{constructor(t){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=t}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const t in this._incoming){const r=this._incoming[t];for(const i of r)this._incomingEventMatches.push(i.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(t=>t.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(t){this._manager?WZ.error("This InputHandler has already been registered with an InputManager"):(t.setEventCallback(r=>this._handleEvent(r)),t.setUninstallCallback(()=>this._onUninstall()),this._manager=t)}onUninstall(){}registerIncoming(t,r,i){let s;typeof r=="function"?(i=r,s=[]):s=r||[];const n=typeof t=="string"?new vDe(t,s):t,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=u=>{const d=this._incoming[u.match.eventType];if(d){const p=d.indexOf(u);d.splice(p,1),o(),this._manager&&this._manager.updateDependencies()}},l=new bDe(n,i,{onPause:a,onRemove:a,onResume:u=>{const d=this._incoming[u.match.eventType];d&&!d.includes(u)&&(d.push(u),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(t){if(this._outgoing[t])throw new Error("There is already a callback registered for this outgoing InputEvent: "+t);const r=new wDe(t,{onEmit:(i,s,n,o)=>{this._manager?.emit(i.eventType,s,n,o)},onRemove:i=>{delete this._outgoing[i.eventType],this._manager?.updateDependencies()}});return this._outgoing[t]=r,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),r}startCapturingPointer(t){this._manager?.setPointerCapture(t,!0)}stopCapturingPointer(t){this._manager?.setPointerCapture(t,!1)}refreshHasPendingInputs(){this._manager?.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):WZ.error("This InputHandler is not registered with an InputManager")}_handleEvent(t){const r=this._incoming[t.type];if(r){for(const i of r)if(i.match.matches(t)&&(i.callback?.(t),t.shouldStopPropagation()))break}}}class bDe{constructor(t,r,i){this.match=t,this._callback=r,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class wDe{constructor(t,r){this.eventType=t,this._removed=!1,this._handler=r}emit(t,r,i){this._removed||this._handler.onEmit(this,t,r,i)}remove(){this._removed=!0,this._handler.onRemove(this)}}class xDe extends ao{constructor(t){super(!0),this._onChange=t,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",r=>{this._update(r.data)})}_update(t){const r=t.native.pointerType==="touch"?"touch":"mouse",{x:i,y:s}=t;r===this._value&&this._x===i&&this._y===s||(this._value=r,this._x=i,this._y=s,this._onChange(r,i,s))}}class TDe{constructor(t,r){this._observable=new iN,this._value=t,this._equalityFunction=r}get value(){return Ft(this._observable),this._value}set value(t){this._equalityFunction(t,this._value)||(this._value=t,this._observable.notify())}mutate(t){t(this._value),this._observable.notify()}}function bA(e,t=jne){return new TDe(e,t)}class SDe extends ao{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=bA(!1),this._onPointerAdd=({data:t})=>{t.pointerType==="touch"&&(this._activeTouchPointerIds.add(t.native.pointerId),this._update())},this._onPointerRemove=({data:t})=>{t.pointerType==="touch"&&(this._activeTouchPointerIds.delete(t.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}}let ou=class extends xe{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=gDe,this._latestPointerType="mouse",this._propertiesPool=new Um({latestPointerLocation:ADe},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,t,r=iy.INTERNAL){if(this._nameToGroup[e])return void K.getLogger(this).error("There is already an InputHandler group registered under the name `"+e+"`");if(t.length===0)return void K.getLogger(this).error("Can't register a group of zero handlers");const i={name:e,handlers:t.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=i;for(let s=i.handlers.length-1;s>=0;s--){const n=i.handlers[s];this._handlers.push(n),n.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(o,a,l,c,u)=>{this._emitInputEvent(n.priorityIndex+1,o,a,l,u,c)},setPointerCapture:(o,a)=>{this._setPointerCapture(i,n,o,a)},setEventCallback:o=>{n.eventCallback=o},setUninstallCallback:o=>{n.uninstallCallback=o},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach(r=>{r.removed=!0,r.uninstallCallback?.()}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):K.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,t=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const i=this._handlers[r];i.priorityIndex=r,this._handlersPriority.push(i)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const i=this._handlersPriority[r];i.priorityIndex=r;let s=i.handler.hasSideEffects;if(!s){for(const n of i.handler.outgoingEventTypes)if(e.has(n)){s=!0;break}}if(s)for(const n of i.handler.incomingEventMatches){e.add(n.eventType);for(const o of n.keyModifiers)_De(o)||t.add(o)}i.active=s}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,t,r){this._latestPointerType=e;const i=this._get("latestPointerLocation");if(i==null||i.x!==t||i.y!==r){const s=this._propertiesPool.get("latestPointerLocation");s.x=t,s.y=r,this._set("latestPointerLocation",s)}}_onEventReceived(e,t){if(e==="pointer-capture-lost"){const s=t;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,t);const r=this.test.timestamp!=null?this.test.timestamp:t.native?t.native.timestamp:void 0,i=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,r,i)}_updateKeyModifiers(e,t){if(!t)return;let r=!1;const i=()=>{if(!r){const o=new Set;this._activeKeyModifiers.forEach(a=>{o.add(a)}),this._activeKeyModifiers=o,r=!0}},s=(o,a)=>{a&&!this._activeKeyModifiers.has(o)?(i(),this._activeKeyModifiers.add(o)):!a&&this._activeKeyModifiers.has(o)&&(i(),this._activeKeyModifiers.delete(o))};if(e==="key-down"||e==="key-up"){const o=t.key;this._keyModifiers.has(o)&&s(o,e==="key-down")}const n=t.native;s("Alt",!(!n||!n.altKey)),s("Ctrl",!(!n||!n.ctrlKey)),s("Shift",!(!n||!n.shiftKey)),s("Meta",!(!n||!n.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new xDe((e,t,r)=>this._setLatestPointer(e,t,r)),this._multiTouchHandler=new SDe,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],iy.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,iy.INTERNAL)}_setPointerCapture(e,t,r,i){const s=e.name+"-"+t.priorityIndex,n=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,n),i?(n.add(s),n.size===1&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):n.has(s)&&(n.delete(s),n.size===0&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,t,r,i){this._emitInputEvent(0,e,t,r,i)}_emitInputEvent(e,t,r,i,s,n){const o=i!==void 0?i:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),a=s!==void 0&&s,l={event:new EDe(t,r,o,n||this._activeKeyModifiers,a),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(l):this._doNewPropagation(l)}_doNewPropagation(e){this._currentPropagation={events:new Tk,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:t,priorityIndex:r}=e.events.pop(),i=t.data&&t.data.eventId;if(!(i!=null&&this._stoppedPropagationEventIds.has(i)))for(e.currentHandler=this._handlersPriority[r];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!t.shouldStopPropagation()&&e.currentHandler.eventCallback?.(t),t.shouldStopPropagation()){i!=null&&this._stoppedPropagationEventIds.add(i);break}if(t.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:t,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const t=new Tk;t.push(e);const r=this._currentPropagation;if(r){for(;r.events.length;)t.push(r.events.pop());r.events=t,r.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const r of e.handler.incomingEventMatches)for(const i of t.handler.incomingEventMatches){if(r.eventType!==i.eventType)continue;const s=r.keyModifiers.filter(n=>i.keyModifiers.includes(n));if(s.length===r.keyModifiers.length!=(s.length===i.keyModifiers.length))return r.keyModifiers.length>i.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const r of e){let i=0;for(;i<t.length&&this._compareHandlerPriority(r,t[i])>=0;)i++;t.splice(i,0,r)}return t}get debug(){const e=t=>{const r=this._setPointerCapture;this._setPointerCapture=()=>{},t(),this._setPointerCapture=r};return{injectEvent:(t,r)=>{e(()=>{this._onEventReceived(t,r)})},disablePointerCapture:e}}};h([f({readOnly:!0})],ou.prototype,"hasPendingInputs",null),h([f({constructOnly:!0})],ou.prototype,"eventSource",void 0),h([f({constructOnly:!0})],ou.prototype,"recognizers",void 0),h([f()],ou.prototype,"_latestPointerType",void 0),h([f()],ou.prototype,"latestPointerType",null),h([f()],ou.prototype,"multiTouchActive",null),h([f({readOnly:!0})],ou.prototype,"latestPointerLocation",void 0),h([f()],ou.prototype,"_paused",void 0),h([f({readOnly:!0})],ou.prototype,"updating",null),ou=h([F("esri.views.input.InputManager")],ou);class EDe{constructor(t,r,i,s,n){this.type=t,this.data=r,this.timestamp=i,this.modifiers=s,this.cancelable=n,this._propagationState=b0.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=b0.STOPPED}shouldStopPropagation(){return(this._propagationState&b0.STOPPED)!=0}async(t){this._propagationState|=b0.PAUSED;const r=(i,s)=>{this._propagationState&=~b0.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw i;return i};return(typeof t=="function"?t():t).then(i=>r(i,!1),i=>r(i,!0))}shouldPausePropagation(t){return!!(this._propagationState&b0.PAUSED)&&(this._resumeCallback=t,!0)}preventDefault(){this.data.native.preventDefault()}}var b0;(function(e){e[e.NONE=0]="NONE",e[e.STOPPED=1]="STOPPED",e[e.PAUSED=2]="PAUSED"})(b0||(b0={}));const iy={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};class CDe{}const ADe=CDe;function $d(e){return e!=null&&"open"in e&&"declaredClass"in e}function qZ(e){return e!=null&&"declaredClass"in e&&"dockOptions"in e}const ODe=e=>{let t=class extends e{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([le(()=>[this.ui,this.popup],([r,i],s)=>{const n="popup",o="manual";if(s){const[a,l]=s;a&&$d(l)&&(l.view=null,qZ(l)&&a.remove(l,n))}r&&$d(i)&&(i.view=this,qZ(i)&&r.add(i,{key:n,position:o,internal:!0}))},Rr),this.on("click",r=>{this.popup&&this.popupEnabled&&(r.pointerType!=="mouse"||r.button===0)&&(!$d(this.popup)&&"autoOpenEnabled"in this.popup&&this.popup.autoOpenEnabled===!1||($d(this.popup)?this.popup.viewModel.handleViewClick(r):r.async(async()=>{await this.setupPopup(),$d(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(r)})))},iy.WIDGET)]),eT(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{ue(()=>import("./Popup.325ec2f7.js").then(function(r){return r.a0}),["assets/Popup.325ec2f7.js","assets/unitFormatUtils.42a6eb3a.js","assets/AttachmentInfo.98a0f643.js","assets/AttachmentQuery.c430db32.js","assets/ColorStop.f762bde8.js","assets/jsonUtils.4745b876.js","assets/UniqueValueRenderer.0143139a.js","assets/diffUtils.f0876598.js","assets/colorRamps.80cb140e.js","assets/DictionaryLoader.90c8c47c.js","assets/FieldsIndex.09813895.js","assets/heatmapUtils.32e9a30b.js","assets/Query.e586665e.js","assets/executeQueryJSON.640d70ab.js","assets/query.22cd43bf.js","assets/normalizeUtils.54c24a4d.js","assets/normalizeUtilsCommon.87227ae2.js","assets/pbfQueryUtils.c4418ce7.js","assets/pbf.82c57b62.js","assets/queryZScale.2643e684.js","assets/FeatureSet.97dc0f24.js","assets/RelationshipQuery.60e2b826.js","assets/TopFeaturesQuery.165d1927.js","assets/FeatureLayer.6ea98f03.js","assets/sql.414b1952.js","assets/FeatureLayerBase.07ef7e55.js","assets/featureLayerUtils.0566dc37.js","assets/serviceCapabilitiesUtils.c358c66d.js","assets/editsZScale.58b9a03e.js","assets/APIKeyMixin.605900a3.js","assets/ArcGISService.116191b2.js","assets/BlendLayer.eacc4944.js","assets/jsonUtils.1c231e28.js","assets/CustomParametersMixin.244652a9.js","assets/EditBusLayer.3831f0f2.js","assets/FeatureEffectLayer.a9b039ed.js","assets/FeatureEffect.ee83c7e0.js","assets/FeatureFilter.97dd33dd.js","assets/FeatureReductionLayer.9f7296a1.js","assets/LabelClass.1c6b8047.js","assets/defaults.83793da7.js","assets/defaultsJSON.a416f32c.js","assets/OrderedLayer.bbc75e49.js","assets/PortalLayer.9c2e677f.js","assets/portalItemUtils.ea6f2bf4.js","assets/ScaleRangeLayer.1a5bb9a6.js","assets/TemporalLayer.5874b62b.js","assets/FeatureTemplate.c7eaa370.js","assets/FeatureType.4659b5f1.js","assets/fieldProperties.174d0f24.js","assets/labelingInfo.990e68e3.js","assets/versionUtils.05c8a355.js","assets/styleUtils.a985c9a8.js","assets/popupUtils.f5ffced0.js"])})}destroy(){this.destroyed||this.closePopup()}async openPopup(r){$d(this.popup)&&this.popup.open(r);try{if(await this.setupPopup(),!this.popup)return void K.getLogger(this).error(new G("view:null-popup","Popup is null and can't be opened"));this.popup.open(r)}catch{}}closePopup(){this._popupSetupTask?.abort(),$d(this.popup)&&this.popup.close()}async fetchPopupFeatures(r,i){await this.when();const{location:s,queryArea:n,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(r,i),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(n,o,i),u=c.map(d=>d.promise);return{location:s,clientOnlyGraphics:a,allGraphicsPromise:b8([l,...u]).then(d=>Array.from(new Set(d.flat()))),promisesPerLayerView:c}}async setupPopup(){if(this._popupSetupTask?.abort(),this.popup&&!$d(this.popup))return this._popupSetupTask=v2(async r=>{const{default:i}=await ue(()=>import("./Popup.325ec2f7.js").then(function(n){return n.a0}),["assets/Popup.325ec2f7.js","assets/unitFormatUtils.42a6eb3a.js","assets/AttachmentInfo.98a0f643.js","assets/AttachmentQuery.c430db32.js","assets/ColorStop.f762bde8.js","assets/jsonUtils.4745b876.js","assets/UniqueValueRenderer.0143139a.js","assets/diffUtils.f0876598.js","assets/colorRamps.80cb140e.js","assets/DictionaryLoader.90c8c47c.js","assets/FieldsIndex.09813895.js","assets/heatmapUtils.32e9a30b.js","assets/Query.e586665e.js","assets/executeQueryJSON.640d70ab.js","assets/query.22cd43bf.js","assets/normalizeUtils.54c24a4d.js","assets/normalizeUtilsCommon.87227ae2.js","assets/pbfQueryUtils.c4418ce7.js","assets/pbf.82c57b62.js","assets/queryZScale.2643e684.js","assets/FeatureSet.97dc0f24.js","assets/RelationshipQuery.60e2b826.js","assets/TopFeaturesQuery.165d1927.js","assets/FeatureLayer.6ea98f03.js","assets/sql.414b1952.js","assets/FeatureLayerBase.07ef7e55.js","assets/featureLayerUtils.0566dc37.js","assets/serviceCapabilitiesUtils.c358c66d.js","assets/editsZScale.58b9a03e.js","assets/APIKeyMixin.605900a3.js","assets/ArcGISService.116191b2.js","assets/BlendLayer.eacc4944.js","assets/jsonUtils.1c231e28.js","assets/CustomParametersMixin.244652a9.js","assets/EditBusLayer.3831f0f2.js","assets/FeatureEffectLayer.a9b039ed.js","assets/FeatureEffect.ee83c7e0.js","assets/FeatureFilter.97dd33dd.js","assets/FeatureReductionLayer.9f7296a1.js","assets/LabelClass.1c6b8047.js","assets/defaults.83793da7.js","assets/defaultsJSON.a416f32c.js","assets/OrderedLayer.bbc75e49.js","assets/PortalLayer.9c2e677f.js","assets/portalItemUtils.ea6f2bf4.js","assets/ScaleRangeLayer.1a5bb9a6.js","assets/TemporalLayer.5874b62b.js","assets/FeatureTemplate.c7eaa370.js","assets/FeatureType.4659b5f1.js","assets/fieldProperties.174d0f24.js","assets/labelingInfo.990e68e3.js","assets/versionUtils.05c8a355.js","assets/styleUtils.a985c9a8.js","assets/popupUtils.f5ffced0.js"]);if(Jt(r),!this.popup||$d(this.popup))return;const s=this.popup;delete s.open,delete s.close,this.popup=new i(s)}),this._popupSetupTask.promise}_queryLayerPopupFeatures(r,i,s){return i.map(({layerView:n,graphics:o})=>{const a={clientGraphics:o,event:s?.event,signal:s?.signal,defaultPopupTemplateEnabled:s!=null&&!!s.defaultPopupTemplateEnabled},l=n.fetchPopupFeatures(r,a);return{layerView:n,promise:l}})}_isValidPopupGraphic(r,i){return r&&!!r.getEffectivePopupTemplate(i!=null&&i.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(r,i){const{clientGraphics:s,queryArea:n,location:o}=await this._popupHitTestGraphics(r,i),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(s,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:n,location:o}}async _popupHitTestGraphics(r,i){const s=await this.popupHitTest(r),n=s.results,o=s.mapPoint,a=n.filter(c=>c.type==="graphic"&&this._isValidPopupGraphic(c.graphic,i)),l=a.length?a[0].mapPoint:null;return{clientGraphics:a.map(c=>c.graphic),queryArea:o,location:o||l}}_getFetchPopupLayerViews(){const r=[];return this.allLayerViews.forEach(i=>{this._isValidPopupLayerView(i)&&r.push(i)}),this.graphicsView!=null&&this._isValidPopupLayerView(this.graphicsView)&&r.push(this.graphicsView),r.reverse()}_isValidPopupLayerView(r){return r!=null&&(!("layer"in r)||!r.suspended)&&"fetchPopupFeatures"in r}_graphicsPerFetchPopupLayerView(r,i){const s=[],n=new Map,o=i.map(a=>{const l=[];return"layer"in a?n.set(a.layer,l):n.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of r){const l=n.get(a.layer)||n.get(a.sourceLayer)||null;l?l.push(a):s.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:s}}};return h([f({cast(r){return!r||$d(r)||typeof r=="object"&&(r.open=i=>(sL(K.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(i)),r.close=()=>(sL(K.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),r}})],t.prototype,"popup",void 0),h([f()],t.prototype,"popupEnabled",void 0),t=h([F("esri.views.PopupView")],t),t};async function ZG(e,t){return await e.load(),RDe(e,t)}async function RDe(e,t){const r=[],i=(...n)=>{for(const o of n)o!=null&&(Array.isArray(o)?i(...o):Pt.isCollection(o)?o.forEach(a=>i(a)):Lm.isLoadable(o)&&r.push(o))};t(i);let s=null;if(await dDe(r,async n=>{const o=await Yu(PDe(n)?n.loadAll():n.load());o.ok!==!1||s||(s=o)}),s)throw s.error;return e}function PDe(e){return"loadAll"in e&&typeof e.loadAll=="function"}let Vf=class extends xe{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){e!=null&&Ec(e)?K.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",t){const r=this.cdnUrl;if(r==null)throw new G("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:e,query:{token:this.portalItem.apiKey},signal:t?.signal})}async update(e,t){const{addOrUpdateResource:r}=await ue(()=>Promise.resolve().then(function(){return QE}),void 0);return r(this,"update",e,t)}hasPath(){return this.path!=null}_normalizePath(e,t){return e==null?e:(e=e.replace(/^\/+/,""),t!=null&&Ec(e)&&(e=ZV(e,t.itemUrl)),e?.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};h([f()],Vf.prototype,"portalItem",void 0),h([f({type:String,value:null})],Vf.prototype,"path",null),h([si("path")],Vf.prototype,"_castPath",null),h([f({type:String,readOnly:!0})],Vf.prototype,"url",null),h([f({type:String,readOnly:!0})],Vf.prototype,"cdnUrl",null),h([f({type:String,readOnly:!0})],Vf.prototype,"itemRelativeUrl",null),Vf=h([F("esri.portal.PortalItemResource")],Vf);const MDe=Vf;let yE=class extends xe{constructor(e){super(e),this.created=null,this.rating=null}};h([f()],yE.prototype,"created",void 0),h([f()],yE.prototype,"rating",void 0),yE=h([F("esri.portal.PortalRating")],yE);const bF=yE;var V_;const IDe=new Set(["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","GeoJson","CSV","KML","WFS","WMTS","WMS","Feed"]),$De=new Set(["KML","GeoJson","CSV"]);let er=V_=class extends M3(Lm){static from(e){return Yx(V_,e)}constructor(e){super(e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const e=this.type,t=this.typeKeywords||[];let r=e;return e==="Feature Service"||e==="Feature Collection"?r=t.includes("Table")?"Table":t.includes("Route Layer")?"Route Layer":t.includes("Markup")?"Markup":"Feature Layer":e==="Image Service"?r=t.includes("Elevation 3D Layer")?"Elevation Layer":t.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":e==="Scene Service"?r="Scene Layer":e==="Video Service"?r="Video Layer":e==="Scene Package"?r="Scene Layer Package":e==="Stream Service"?r="Feature Layer":e==="Geoprocessing Service"?r=t.includes("Web Tool")?"Tool":"Geoprocessing Service":e==="Geocoding Service"?r="Locator":e==="Geoenrichment Service"?r="GeoEnrichment Service":e==="Microsoft Powerpoint"?r="Microsoft PowerPoint":e==="GeoJson"?r="GeoJSON":e==="Globe Service"?r="Globe Layer":e==="Vector Tile Service"?r="Tile Layer":e==="netCDF"?r="NetCDF":e==="Map Service"?r=t.includes("Spatiotemporal")||!t.includes("Hosted Service")&&!t.includes("Tiled")||t.includes("Relational")?"Map Image Layer":"Tile Layer":e&&e.toLowerCase().includes("add in")?r=e.replaceAll(/(add in)/gi,"Add-In"):e==="datastore catalog service"?r="Big Data File Share":e==="Compact Tile Package"?r="Tile Package (tpkx)":e==="OGCFeatureServer"?r="OGC Feature Layer":e==="web mapping application"&&t.includes("configurableApp")?r="Instant App":e==="Insights Page"?r="Insights Report":e==="Excalibur Imagery Project"&&(r="Excalibur Project"),r}readExtent(e){return e&&e.length?new Pr(e[0][0],e[0][1],e[1][0],e[1][1]):null}get iconUrl(){const e=this.type&&this.type.toLowerCase()||"",t=this.typeKeywords||[],r="esri/images/portal/",i="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,u=!1;return e.indexOf("service")>0||e==="feature collection"||e==="kml"||e==="wms"||e==="wmts"||e==="wfs"?(n=t.includes("Hosted Service"),e==="feature service"||e==="feature collection"||e==="kml"||e==="wfs"?(o=t.includes("Table"),a=t.includes("Route Layer"),l=t.includes("Markup"),c=t.includes("Spatiotemporal"),u=t.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":n?"featureshosted":u?"utilitynetwork":"features"):s=e==="map service"||e==="wms"||e==="wmts"?n||t.includes("Tiled")||e==="wmts"?"maptiles":"mapimages":e==="scene service"?t.includes("Line")?"sceneweblayerline":t.includes("3DObject")?"sceneweblayermultipatch":t.includes("Point")?"sceneweblayerpoint":t.includes("IntegratedMesh")?"sceneweblayermesh":t.includes("PointCloud")?"sceneweblayerpointcloud":t.includes("Polygon")?"sceneweblayerpolygon":t.includes("Building")?"sceneweblayerbuilding":t.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":e==="image service"?t.includes("Elevation 3D Layer")?"elevationlayer":t.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":e==="stream service"?"streamlayer":e==="video service"?t.includes("Live Stream")?"livestreamvideolayer":"videolayer":e==="vector tile service"?"vectortile":e==="datastore catalog service"?"datastorecollection":e==="geocoding service"?"geocodeservice":e==="geoprocessing service"?t.includes("Web Tool")?"tool":"layers":e==="geodata service"?"geodataservice":"layers"):s=e==="web map"||e==="cityengine web scene"?"maps":e==="web scene"?t.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":e==="web mapping application"&&t.includes("configurableApp")?"instantapps":e==="web mapping application"||e==="mobile application"||e==="application"||e==="operation view"||e==="desktop application"?"apps":e==="map document"||e==="map package"||e==="published map"||e==="scene document"||e==="globe document"||e==="basemap package"||e==="mobile basemap package"||e==="mobile map package"||e==="project package"||e==="project template"||e==="pro map"||e==="layout"||e==="layer"&&t.includes("ArcGIS Pro")||e==="explorer map"&&t.indexOf("Explorer Document")?"mapsgray":e==="service definition"||e==="csv"||e==="shapefile"||e==="cad drawing"||e==="geojson"||e==="netcdf"||e==="administrative report"?"datafiles":e==="explorer add in"||e==="desktop add in"||e==="windows viewer add in"||e==="windows viewer configuration"?"appsgray":e==="360 vr experience"?"360vr":e==="arcgis pro add in"||e==="arcgis pro configuration"?"addindesktop":e==="rule package"||e==="file geodatabase"||e==="sqlite geodatabase"||e==="csv collection"||e==="kml collection"||e==="windows mobile package"||e==="map template"||e==="desktop application template"||e==="gml"||e==="arcpad package"||e==="code sample"||e==="form"||e==="document link"||e==="earth configuration"||e==="operations dashboard add in"||e==="rules package"||e==="image"||e==="workflow manager package"||e==="explorer map"&&t.includes("Explorer Mapping Application")||t.includes("Document")?"datafilesgray":e==="network analysis service"||e==="geoprocessing service"||e==="geodata service"||e==="geometry service"||e==="geoprocessing package"||e==="locator package"||e==="geoprocessing sample"||e==="workflow manager service"?"toolsgray":e==="layer"||e==="layer package"||e==="explorer layer"?"layersgray":e==="scene package"?"scenepackage":e==="mobile scene package"?"mobilescenepackage":e==="tile package"||e==="compact tile package"?"tilepackage":e==="task file"?"taskfile":e==="report template"?"report-template":e==="statistical data collection"?"statisticaldatacollection":e==="insights workbook"?"workbook":e==="insights model"?"insightsmodel":e==="insights page"?"insightspage":e==="insights theme"?"insightstheme":e==="hub initiative"?"hubinitiative":e==="hubpage"?"hubpage":e==="hub event"?"hubevent":e==="hub site application"?"hubsite":e==="hub project"?"hubproject":e==="relational database connection"?"relationaldatabaseconnection":e==="big data file share"?"datastorecollection":e==="image collection"?"imagecollection":e==="style"?"style":e==="desktop style"?"desktopstyle":e==="dashboard"?"dashboard":e==="raster function template"?"rasterprocessingtemplate":e==="vector tile package"?"vectortilepackage":e==="ortho mapping project"?"orthomappingproject":e==="ortho mapping template"?"orthomappingtemplate":e==="solution"?"solutions":e==="geopackage"?"geopackage":e==="deep learning package"?"deeplearningpackage":e==="real time analytic"?"realtimeanalytics":e==="big data analytic"?"bigdataanalytics":e==="feed"?"feed":e==="excalibur imagery project"?"excaliburimageryproject":e==="notebook"?"notebook":e==="storymap"?"storymap":e==="survey123 add in"?"survey123addin":e==="mission"?"mission":e==="mission report"?"missionreport":e==="quickcapture project"?"quickcaptureproject":e==="pro report"?"proreport":e==="pro report template"?"proreporttemplate":e==="urban model"?"urbanmodel":e==="web experience"?"experiencebuilder":e==="web experience template"?"webexperiencetemplate":e==="experience builder widget"?"experiencebuilderwidget":e==="experience builder widget package"?"experiencebuilderwidgetpackage":e==="workflow"?"workflow":e==="insights script"?"insightsscript":e==="kernel gateway connection"?"kernelgatewayconnection":e==="hub initiative template"?"hubinitiativetemplate":e==="storymap theme"?"storymaptheme":e==="knowledge graph"?"knowledgegraph":e==="native application"?"nativeapp":e==="native application installer"?"nativeappinstaller":e==="link chart"?"linkchart":e==="investigation"?"investigation":e==="ogcfeatureserver"?"features":e==="pro project"?"proproject":e==="insights workbook package"?"insightsworkbookpackage":e==="apache parquet"?"apacheparquet":e==="notebook code snippets"||e==="notebook code snippet library"?"notebookcodesnippets":e==="suitability model"?"suitabilitymodel":e==="esri classifier definition"?"classifierdefinition":e==="esri classification schema"?"classificationschema":e==="insights data engineering workbook"?"dataengineeringworkbook":e==="insights data engineering model"?"dataengineeringmodel":e==="deep learning studio project"?"deeplearningproject":e==="discussion"?"discussion":e==="allsource project"?"allsourceproject":e==="api key"?"apikey":e==="data pipeline"?"datapipelines":"maps",s?$r(r+s+i+".png"):null}get isLayer(){return this.type!=null&&IDe.has(this.type)}get itemCdnUrl(){let e=this.itemUrl;return e&&ar&&!ar.findCredential(e)&&(e=ar._normalizeAGOLorgDomain(e),e=e.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),e=e.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),e=e.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),e}get itemPageUrl(){const e=this.portal?.itemPageUrl;return e&&this.id?`${e}?id=${this.id}`:null}get itemUrl(){const e=this.portal?.restUrl;return e&&this.id?`${e}/content/items/${this.id}`:null}get thumbnailUrl(){const e=this.itemUrl,t=this.thumbnail;return e&&t?this.portal?.normalizeUrl(`${e}/info/${t}?f=json`)??null:null}get userItemUrl(){const e=this.get("portal.restUrl");if(!e)return null;const t=this.owner||this.get("portal.user.username");return t?`${e}/content/users/${this.ownerFolder?`${t}/${this.ownerFolder}`:t}/items/${this.id}`:null}load(e){const t=this.portal??(this.portal=ba.getDefault()),r=t.load(e).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?t.request(this.itemUrl,{signal:e!=null?e.signal:null,query:{token:this.apiKey}}):{}).then(i=>{this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(r),Promise.resolve(this)}async addRating(e){const t={method:"post",query:{}};return e instanceof bF&&(e=e.rating),e==null||isNaN(e)||typeof e!="number"||(t.query.rating=e),this.portal?(await this.portal.request(this.itemUrl+"/addRating",t),new bF({rating:e,created:new Date})):null}clone(){const e={access:this.access,accessInformation:this.accessInformation,applicationProxies:ye(this.applicationProxies),avgRating:this.avgRating,categories:ye(this.categories),created:ye(this.created),culture:this.culture,description:this.description,extent:ye(this.extent),groupCategories:ye(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:ye(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:ye(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ye(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ye(this.typeKeywords),url:this.url};this.loaded&&(e.loadStatus="loaded");const t=new V_({sourceJSON:this.sourceJSON}).set(e);return t._set("isOrgItem",this.isOrgItem),t}createPostQuery(){const e=this.toJSON();for(const r of["tags","typeKeywords","categories"])e[r]=e[r]?.join(", ");const{extent:t}=e;return t&&(e.extent=JSON.stringify(t)),e}async deleteRating(){await Sl(this.portal).request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(e="json",t){return Sl(this.portal).request(this.itemUrl+"/data",{responseType:e,...t,query:{token:this.apiKey}})}async fetchRating(e){const t=await Sl(this.portal).request(this.itemUrl+"/rating",{query:{token:this.apiKey},...e});return t.rating!=null?(t.created=new Date(t.created),new bF(t)):null}fetchRelatedItems(e,t){return Sl(this.portal).requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...e,token:this.apiKey},...t},V_)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}reload(){return Sl(this.portal).request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(e=>(this.sourceJSON=e,this.read(e),this))}update(e){return this.id?this.load().then(()=>Sl(this.portal).signIn()).then(()=>{const t=e&&e.data,r={method:"post"};r.query=this.createPostQuery();for(const i in r.query)r.query[i]===null&&(r.query[i]="");return r.query.clearEmptyFields=!0,t!=null&&(typeof t=="string"?r.query.text=t:typeof t=="object"&&(r.query.text=JSON.stringify(t))),this.portal.request(`${this.userItemUrl}/update`,r).then(()=>this.reload())}):Promise.reject(new G("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(e){if(!this.id)throw new G("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:t,itemUrl:r}=this;await Sl(t).signIn();const{copyResources:i,folder:s,tags:n,title:o}=e||{},a={method:"post",query:{copyPrivateResources:i==="all",folder:typeof s=="string"?s:s?.id,includeResources:!!i,tags:n?.join(","),title:o}},{itemId:l}=await t.request(`${r}/copy`,a);return new V_({id:l,portal:t})}updateThumbnail(e){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const t=e.thumbnail,r=e.filename,i={method:"post"};if(typeof t=="string")nf(t)?i.query={data:t}:i.query={url:ja(t)},r!=null&&(i.query.filename=r);else{const s=new FormData;r!=null?s.append("file",t,r):s.append("file",t),i.body=s}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,i).then(()=>this.reload())}):Promise.reject(new G("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(e={},t){const{fetchResources:r}=await ue(()=>Promise.resolve().then(function(){return QE}),void 0);return r(this,e,t)}async addResource(e,t,r){const{addOrUpdateResource:i}=await ue(()=>Promise.resolve().then(function(){return QE}),void 0);return e.portalItem=this,i(e,"add",t,r)}async removeResource(e,t){const{removeResource:r}=await ue(()=>Promise.resolve().then(function(){return QE}),void 0);if(e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new G("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return r(this,e,t)}async removeAllResources(e){const{removeAllResources:t}=await ue(()=>Promise.resolve().then(function(){return QE}),void 0);return t(this,e)}resourceFromPath(e){return new MDe({portalItem:this,path:e})}toJSON(){const e=this.extent,t={accessInformation:this.accessInformation,categories:ye(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ye(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ye(this.typeKeywords),url:this.url};return PD(t)}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new V_({sourceJSON:e})}_getPostQuery(){const e=this.toJSON();for(const t in e)t==="tags"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="typeKeywords"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="extent"&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}};h([f({type:["private","shared","org","public"]})],er.prototype,"access",void 0),h([f()],er.prototype,"accessInformation",void 0),h([f({type:String})],er.prototype,"apiKey",void 0),h([f({json:{read:{source:"appProxies"}}})],er.prototype,"applicationProxies",void 0),h([f()],er.prototype,"avgRating",void 0),h([f()],er.prototype,"categories",void 0),h([f({type:Date})],er.prototype,"created",void 0),h([f()],er.prototype,"culture",void 0),h([f()],er.prototype,"description",void 0),h([f({readOnly:!0})],er.prototype,"displayName",null),h([f({type:Pr})],er.prototype,"extent",void 0),h([br("extent")],er.prototype,"readExtent",null),h([f()],er.prototype,"groupCategories",void 0),h([f({readOnly:!0})],er.prototype,"iconUrl",null),h([f()],er.prototype,"id",void 0),h([f({readOnly:!0})],er.prototype,"isLayer",null),h([f({type:Boolean,readOnly:!0})],er.prototype,"isOrgItem",void 0),h([f()],er.prototype,"itemControl",void 0),h([f({readOnly:!0})],er.prototype,"itemPageUrl",null),h([f({readOnly:!0})],er.prototype,"itemUrl",null),h([f()],er.prototype,"licenseInfo",void 0),h([f({type:Date})],er.prototype,"modified",void 0),h([f()],er.prototype,"name",void 0),h([f()],er.prototype,"numComments",void 0),h([f()],er.prototype,"numRatings",void 0),h([f()],er.prototype,"numViews",void 0),h([f()],er.prototype,"owner",void 0),h([f()],er.prototype,"ownerFolder",void 0),h([f({type:ba})],er.prototype,"portal",void 0),h([f()],er.prototype,"screenshots",void 0),h([f()],er.prototype,"size",void 0),h([f()],er.prototype,"snippet",void 0),h([f()],er.prototype,"sourceJSON",void 0),h([f({type:String})],er.prototype,"sourceUrl",void 0),h([f({type:String})],er.prototype,"spatialReference",void 0),h([f()],er.prototype,"tags",void 0),h([f()],er.prototype,"thumbnail",void 0),h([f({readOnly:!0})],er.prototype,"thumbnailUrl",null),h([f()],er.prototype,"title",void 0),h([f()],er.prototype,"type",void 0),h([f()],er.prototype,"typeKeywords",void 0),h([f({type:String,json:{read(e,t){if($De.has(t.type)){const r=this.portal?.restUrl;e||(e=r&&this.id?`${r}/content/items/${this.id}/data`:null)}return e}}})],er.prototype,"url",void 0),h([f({readOnly:!0})],er.prototype,"userItemUrl",null),er=V_=h([F("esri.portal.PortalItem")],er);const LN=er;var lpe=Object.freeze(Object.defineProperty({__proto__:null,default:LN},Symbol.toStringTag,{value:"Module"}));async function LDe(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e,r=await ole("esri/t9n/basemaps");return r[e]||r[t]}const Zk={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return $r("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return $r("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return $r("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return $r("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return $r("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return $r("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return $r("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return $r("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return $r("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return $r("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return $r("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return $r("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return $r("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return $r("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return $r("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return $r("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return $r("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return $r("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return $r("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return $r("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return $r("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return $r("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return $r("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return $r("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return $r("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return $r("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return $r("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}},DDe=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),NDe=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function FDe(e){return e.layerContainerType==="basemap"?DDe:e.layerContainerType==="operational-layers"?NDe:null}function UDe(e,t){if(t.restrictedWebMapWriting){const r=FDe(t);return r==null||r.has(e.type)&&!jG(e)}return!0}function kDe(e,t){if(t)if(jG(e)){const r=um("featureCollection.layers",t),i=r&&r[0]&&r[0].layerDefinition;i&&XZ(e,i)}else e.type!=="group"&&XZ(e,t)}function XZ(e,t){"maxScale"in e&&(t.maxScale=y$(e.maxScale)??void 0),"minScale"in e&&(t.minScale=y$(e.minScale)??void 0)}function zDe(e,t){if(kDe(e,t),t&&("blendMode"in e&&(t.blendMode=e.blendMode,t.blendMode==="normal"&&delete t.blendMode),t.opacity=y$(e.opacity)??void 0,t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&e.type!=="wmts"))if(jG(e)){const r=t.featureCollection;r&&(r.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}function ZZ(e,t,r){if(!("write"in e)||!e.write)return r&&r.messages&&r.messages.push(new G("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if(UDe(e,r)){const i={};return e.write(i,r)?i:null}return t!=null&&zDe(e,t=ye(t)),t}var YM;let BDe=0;const cpe="esri.Basemap";let au=YM=class extends M3(Lm){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+BDe++,this.baseLayers=new Pt,this.referenceLayers=new Pt;const t=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type==="elevation"&&K.getLogger(this).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=i=>{i.parent=null};this.addHandles([this.baseLayers.on("after-add",i=>t(i.item)),this.referenceLayers.on("after-add",i=>t(i.item)),this.baseLayers.on("after-remove",i=>r(i.item)),this.referenceLayers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(e=>{K.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.baseLayers.removeAll();for(const r of e)r.destroy();const t=this.referenceLayers.removeAll();for(const r of t)r.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem?.destroy(),this.portalItem=null}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set baseLayers(e){this._set("baseLayers",$m(e,this._get("baseLayers")))}_writeBaseLayers(e,t,r){const i=[];e&&(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach(s=>{const n=ZZ(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);n!=null&&i.push(n)}),this.referenceLayers.forEach(s=>{const n=ZZ(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);n!=null&&(s.type!=="scene"&&(n.isReference=!0),i.push(n))})),t.baseMapLayers=i}set referenceLayers(e){this._set("referenceLayers",$m(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return ZG(this,e=>{e(this.baseLayers,this.referenceLayers)})}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(t=>QI(t)?t.clone():t),referenceLayers:this.referenceLayers.map(t=>QI(t)?t.clone():t)};return this.loaded&&(e.loadStatus="loaded"),new YM({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t&&t.origin||(t={origin:"web-map",...t}),super.write(e,t),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(r=>{const i=ye(r);return i.url&&qp(i.url)&&(i.url=`https:${i.url}`),i.templateUrl&&qp(i.templateUrl)&&(i.templateUrl=`https:${i.templateUrl}`),i})),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:r}=this;Jt(e);const i=[];if(t){const s=t.context?t.context.url:null;if(i.push(this._loadLayersFromJSON(t.data,s,e)),t.data.id&&!t.data.title){const n=t.data.id;i.push(LDe(n).then(o=>{o&&this.read({title:o},t.context)}))}}else r&&i.push(this._loadFromItem(r,e));await Promise.all(i)}async _loadLayersFromJSON(e,t,r){const i=this.resourceInfo&&this.resourceInfo.context,s=this.portalItem&&this.portalItem.portal||i&&i.portal||null,n=GDe[i?.origin||""]??"web-map",{populateOperationalLayers:o}=await ue(()=>import("./layersCreator.c5a200d8.js"),["assets/layersCreator.c5a200d8.js","assets/lazyLayerLoader.65116701.js","assets/portalLayers.3d66e6e8.js","assets/layersLoader.364682ca.js","assets/fetchService.1153b1df.js","assets/jsonContext.d19fd1ca.js","assets/portalItemUtils.ea6f2bf4.js","assets/styleUtils.a985c9a8.js"]),a=[];if(Jt(r),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const l={context:{origin:n,url:t,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=p=>n==="web-scene"&&p.layerType==="ArcGISSceneServiceLayer"||p.isReference,u=o(this.baseLayers,e.baseMapLayers.filter(p=>!c(p)),l);a.push(u);const d=o(this.referenceLayers,e.baseMapLayers.filter(c),l);a.push(d)}await Sc(a)}async _loadFromItem(e,t){const r=await e.load(t),i=await r.fetchData("json",t),s=Us(e.itemUrl??"");return this._set("resourceInfo",{data:i.baseMap??{},context:{origin:VDe[e.type||""]??"web-map",portal:e.portal||ba.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||ba.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,t)}static fromId(e){const t=Zk[e];if(!t)return null;if(t.deprecated){let r=null;e==="dark-gray"?r="dark-gray-vector":e==="gray"?r="gray-vector":e==="streets"?r="streets-vector":e==="topo"&&(r="topo-vector"),sL(K.getLogger(cpe),`The ${e} basemap has entered mature support and is no longer being updated.`,{replacement:r,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return YM.fromJSON(t)}};h([f({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,r,i){this._writeBaseLayers(e,t,i)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:Pt}},writer(e,t,r,i){this._writeBaseLayers(e,t,i)}}}}}})],au.prototype,"baseLayers",null),h([f({type:String,json:{origins:{"web-scene":{write:!0}}}})],au.prototype,"id",void 0),h([f({type:LN})],au.prototype,"portalItem",void 0),h([f()],au.prototype,"referenceLayers",null),h([f({readOnly:!0})],au.prototype,"resourceInfo",void 0),h([f({type:st})],au.prototype,"spatialReference",void 0),h([f()],au.prototype,"thumbnailUrl",void 0),h([f({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],au.prototype,"title",void 0),h([Yt("title")],au.prototype,"writeTitle",null),au=YM=h([F(cpe)],au);const VDe={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},GDe={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},wA=au;var jDe=Object.freeze(Object.defineProperty({__proto__:null,default:wA},Symbol.toStringTag,{value:"Module"}));function Bpt(e){}function HDe(e){return()=>e}var Yk;let JM=Yk=class extends Pe{constructor(e){super(e),this.type="none"}clone(){return new Yk({type:this.type})}};h([Wt({none:"none",stayAbove:"stay-above"})],JM.prototype,"type",void 0),JM=Yk=h([F("esri.ground.NavigationConstraint")],JM);var Jk;let Gf=Jk=class extends M3(Lm){constructor(e){super(e),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new Pt;const t=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type!=="elevation"&&i.type!=="base-elevation"&&K.getLogger(this).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},r=i=>{i.parent=null};this.addHandles([this.layers.on("after-add",i=>t(i.item)),this.layers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(e=>{$s(e)||K.getLogger(this).error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)t.destroy();this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set layers(e){this._set("layers",$m(e,this._get("layers")))}writeLayers(e,t,r,i){const s=[];e&&(i={...i,layerContainerType:"ground"},e.forEach(n=>{if("write"in n){const o={};HDe(n)().write(o,i)&&s.push(o)}else i&&i.messages&&i.messages.push(new G("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),t.layers=s}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return ZG(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t?.signal});const{ElevationQuery:r}=await ue(()=>import("./ElevationQuery.e9c2bde7.js"),[]);Jt(t);const i=new r,s=this.layers.filter(YZ).toArray();return i.queryAll(s,e,t)}async createElevationSampler(e,t){await this.load({signal:t?.signal});const{ElevationQuery:r}=await ue(()=>import("./ElevationQuery.e9c2bde7.js"),[]);Jt(t);const i=new r,s=this.layers.filter(YZ).toArray();return i.createSamplerAll(s,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:ye(this.surfaceColor),navigationConstraint:ye(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new Jk({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve()}_loadLayersFromJSON(e,t,r){const i=t&&t.origin||"web-scene",s=t&&t.portal||null,n=t&&t.url||null;return ue(()=>import("./layersCreator.c5a200d8.js"),["assets/layersCreator.c5a200d8.js","assets/lazyLayerLoader.65116701.js","assets/portalLayers.3d66e6e8.js","assets/layersLoader.364682ca.js","assets/fetchService.1153b1df.js","assets/jsonContext.d19fd1ca.js","assets/portalItemUtils.ea6f2bf4.js","assets/styleUtils.a985c9a8.js"]).then(({populateOperationalLayers:o})=>{Jt(r);const a=[];if(e.layers&&Array.isArray(e.layers)){const l={context:{origin:i,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,e.layers,l))}return Sc(a)}).then(()=>{})}};function WDe(e){return e&&"createElevationSampler"in e}function YZ(e){return e.type==="elevation"||WDe(e)}h([f({json:{read:!1}})],Gf.prototype,"layers",null),h([Yt("layers")],Gf.prototype,"writeLayers",null),h([f({readOnly:!0})],Gf.prototype,"resourceInfo",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Ps,read:{reader:hA,source:"transparency"},write:{writer:(e,t)=>{t.transparency=iG(e)},target:"transparency"}}})],Gf.prototype,"opacity",void 0),h([f({type:ot,json:{type:[Ps],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],Gf.prototype,"surfaceColor",void 0),h([f({type:JM,json:{write:!0}})],Gf.prototype,"navigationConstraint",void 0),Gf=Jk=h([F("esri.Ground")],Gf);const xA=Gf;let Mw=class extends Pt{constructor(e){super(e),this.getCollections=null}initialize(){this.own(yoe(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections!=null?this.getCollections():null;if(e==null)return void this.removeAll();let t=0;for(const r of e)r!=null&&(t=this._processCollection(t,r));this.splice(t,this.length)}_createNewInstance(e){return new Pt(e)}_processCollection(e,t){if(!t)return e;const r=this.itemFilterFunction??(i=>!!i);for(const i of t)if(i){if(r(i)){const s=this.indexOf(i,e);s>=0?s!==e&&this.reorder(i,e):this.add(i,e),++e}if(this.getChildrenFunction){const s=this.getChildrenFunction(i);if(Array.isArray(s))for(const n of s)e=this._processCollection(e,n);else e=this._processCollection(e,s)}}return e}};h([f()],Mw.prototype,"getCollections",void 0),h([f()],Mw.prototype,"getChildrenFunction",void 0),h([f()],Mw.prototype,"itemFilterFunction",void 0),Mw=h([F("esri.core.CollectionFlattener")],Mw);const TA=Mw,qDe=[["binary","application/octet-stream","bin",""]];function XDe(e,t){return JG(JDe(e,t))}function ZDe(e,t){return JG(KDe(e,t))}function Vpt(e,t){return upe(YDe(e,t))}function YG(e){return[...qDe,...e]}function YDe(e,t){return YG(t).find(r=>JG(r)===e)}function JDe(e,t){return YG(t).find(r=>upe(r)===e)}function KDe(e,t){const r=e.toLowerCase();return YG(t).find(i=>QDe(i).some(s=>r.endsWith(s)))}function JG(e){return e?.[0]}function upe(e){return e?.[1]}function QDe(e){return e?.[2].split(",")??[]}function Gpt(e){return e.tables?.find(t=>t.role==="assetMaps")}function eNe(e){return!(!(e&&typeof e=="object"&&"loaded"in e&&e.loaded&&BLe(e)?.operations?.supportsEditing&&"type"in e)||"editingEnabled"in e&&!GLe(e)||e.type==="scene"&&!tNe(e))}function tNe(e){const t=e.infoFor3D;if(!t)return!0;const{supportedFormats:r,queryFormats:i}=t,s=XDe("model/gltf-binary",r)??ZDe("glb",r);return s!=null&&i.includes(s)}const JZ=K.getLogger("esri.support.basemapUtils");function rNe(){return{}}function iNe(e){for(const t in e){const r=e[t];r?.destroyed===!1&&r.destroy(),delete e[t]}}function KG(e,t){let r;if(typeof e=="string"){if(!(e in Zk)){const i=Object.entries(Zk).filter(([s,n])=>Or.apiKey&&!n.classic||!Or.apiKey&&n.classic&&!n.deprecated).map(([s])=>`"${s}"`).join(", ");return JZ.warn(`Unable to find basemap definition for: ${e}. Try one of these: ${i}`),null}t&&(r=t[e]),r||(r=wA.fromId(e),t&&(t[e]=r))}else r=ro(wA,e);return r?.destroyed&&(JZ.warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function sNe(e,t=null){const r=KG(e);if(!r)return null;const i=r.clone();return t&&(i.baseLayers=KZ(i.baseLayers,t.baseLayers),i.referenceLayers=KZ(i.referenceLayers,t.referenceLayers)),i}function KZ(e,t){const r=new Pt;return e.forEach(i=>{const s=t.find(n=>nNe(QZ(i),QZ(n)))||i;r.includes(s)?r.push(i):r.push(s)}),r}function QZ(e){return{type:e.type,url:oNe("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl||""),minScale:"minScale"in e&&e.minScale!=null?e.minScale:0,maxScale:"maxScale"in e&&e.maxScale!=null?e.maxScale:0,opacity:e.opacity!=null?e.opacity:1,visible:e.visible==null||!!e.visible,sublayers:e.type!=="map-image"&&e.type!=="wms"||e.sublayers==null?void 0:e.sublayers?.map(t=>({id:t.id,visible:t.visible})),activeLayerId:e.type==="wmts"?e.activeLayer?.id:void 0}}function nNe(e,t){if(e.type!==t.type||e.type==="scene"||e.url!==t.url||e.minScale!==t.minScale||e.maxScale!==t.maxScale||e.visible!==t.visible||e.opacity!==t.opacity)return!1;if(e.activeLayerId!=null||t.activeLayerId!=null)return e.activeLayerId===t.activeLayerId;if(e.sublayers!=null||t.sublayers!=null){if(e.sublayers==null||t.sublayers==null||e.sublayers.length!==t.sublayers.length)return!1;for(let r=0;r<e.sublayers.length;r++){const i=e.sublayers.at(r),s=t.sublayers.at(r);if(i?.id!==s?.id||i?.visible!==s?.visible)return!1}}return!0}function oNe(e){return e?ld(e).replace(/^\s*https?:/i,"").toLowerCase():""}function aNe(e){return new TA({getCollections:()=>[e.tables,e.layers],getChildrenFunction:t=>{const r=[];return"tables"in t&&r.push(t.tables),"layers"in t&&r.push(t.layers),r},itemFilterFunction:t=>{const r=t.parent;return!!r&&"tables"in r&&r.tables.includes(t)}})}function wF(e){for(const t of e.values())t?.destroy();e.clear()}const eY={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function lNe(e){let t=null;if(typeof e=="string")if(e in eY){const r=eY[e];t=new xA({resourceInfo:{data:{layers:[r]}}})}else K.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=ro(xA,e);return t}async function cNe(e){const t="portalItem"in e?e:{portalItem:e},{fromItem:r}=await ue(()=>import("./portalLayers.3d66e6e8.js"),["assets/portalLayers.3d66e6e8.js","assets/lazyLayerLoader.65116701.js","assets/layersLoader.364682ca.js","assets/fetchService.1153b1df.js","assets/jsonContext.d19fd1ca.js","assets/portalItemUtils.ea6f2bf4.js","assets/styleUtils.a985c9a8.js"]);try{return await r(t)}catch(i){const s=t&&t.portalItem,n=s&&s.id||"unset",o=s&&s.portal&&s.portal.url||Or.portalUrl;throw K.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",i),i}}let uNe=0,Zn=class extends cs.EventedMixin(tG(Lm)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new Pr(-180,-90,180,90,st.WGS84),this.id=Date.now().toString(16)+"-layer-"+uNe++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=st.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const t=typeof e=="string"?{url:e}:e;return(await ue(()=>import("./arcgisLayers.704ecbf2.js"),["assets/arcgisLayers.704ecbf2.js","assets/fetchService.1153b1df.js","assets/lazyLayerLoader.65116701.js"])).fromUrl(t)}static fromPortalItem(e){return cNe(e)}initialize(){this.when().catch(e=>{$s(e)||K.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,t=this.parent;"layers"in t&&t.layers.includes(e)?t.layers.remove(e):"tables"in t&&t.tables.includes(e)?t.tables.remove(e):"baseLayers"in t&&t.baseLayers.includes(e)?t.baseLayers.remove(e):"baseLayers"in t&&t.referenceLayers.includes(e)&&t.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return Us(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await ii(e,{query:{f:"json"},responseType:"json"})).data;throw new G("layer:no-attribution-data","Layer does not have attribution data")}};h([f({type:String})],Zn.prototype,"attributionDataUrl",void 0),h([f({type:Pr})],Zn.prototype,"fullExtent",void 0),h([f({readOnly:!0})],Zn.prototype,"hasAttributionData",null),h([f({type:String,clonable:!1})],Zn.prototype,"id",void 0),h([f({type:Boolean,nonNullable:!0})],Zn.prototype,"legendEnabled",void 0),h([f({type:["show","hide","hide-children"]})],Zn.prototype,"listMode",void 0),h([f({type:Number,range:{min:0,max:1},nonNullable:!0})],Zn.prototype,"opacity",void 0),h([f({clonable:!1})],Zn.prototype,"parent",void 0),h([f({readOnly:!0})],Zn.prototype,"parsedUrl",null),h([f({type:Boolean})],Zn.prototype,"popupEnabled",void 0),h([f({type:Boolean})],Zn.prototype,"attributionVisible",void 0),h([f({type:st})],Zn.prototype,"spatialReference",void 0),h([f({type:String})],Zn.prototype,"title",void 0),h([f({readOnly:!0,json:{read:!1}})],Zn.prototype,"type",void 0),h([f()],Zn.prototype,"url",void 0),h([f({type:Boolean,nonNullable:!0})],Zn.prototype,"visible",void 0),Zn=h([F("esri.layers.Layer")],Zn);const hpe=Zn;function Kk(e,t,r){let i,s;if(e)for(let n=0,o=e.length;n<o;n++){if(i=e.at(n),i?.[t]===r)return i;if(i?.type==="group"&&(s=Kk(i.layers,t,r),s))return s}}const hNe=e=>{let t=class extends e{constructor(...r){super(...r),this.layers=new Pt;const i=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||K.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>i(o.item)),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))])}destroy(){const r=this.layers.toArray();for(const i of r)i.destroy();this.layers.destroy()}set layers(r){this._set("layers",$m(r,this._get("layers")))}add(r,i){const s=this.layers;if(i=s.getNextIndex(i),r instanceof hpe){const n=r;n.parent===this?this.reorder(n,i):s.add(n,i)}else zc(r)?r.then(n=>{this.destroyed||this.add(n,i)}):K.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(r,i){const s=this.layers;let n=s.getNextIndex(i);r.slice().forEach(o=>{o.parent!==this?(s.add(o,n),n+=1):this.reorder(o,n)})}findLayerById(r){return Kk(this.layers,"id",r)}findLayerByUid(r){return Kk(this.layers,"uid",r)}remove(r){return this.layers.remove(r)}removeMany(r){return this.layers.removeMany(r)}removeAll(){return this.layers.removeAll()}reorder(r,i){return this.layers.reorder(r,i)}layerAdded(r){}layerRemoved(r){}};return h([f()],t.prototype,"layers",null),t=h([F("esri.support.LayersMixin")],t),t};function Qk(e,t,r){if(e)for(let i=0,s=e.length;i<s;i++){const n=e.at(i);if(n[t]===r)return n;if(n?.type==="group"){const o=Qk(n.tables,t,r);if(o)return o}}}const dNe=e=>{let t=class extends e{constructor(...r){super(...r),this.tables=new Pt,this.addHandles([this.tables.on("after-add",i=>{const s=i.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&K.getLogger(this).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",i=>{i.item.parent=null})])}destroy(){const r=this.tables.removeAll();for(const i of r)i.destroy();this.tables.destroy()}set tables(r){this._set("tables",$m(r,this._get("tables")))}findTableById(r){return Qk(this.tables,"id",r)}findTableByUid(r){return Qk(this.tables,"uid",r)}};return h([f()],t.prototype,"tables",null),t=h([F("esri.support.TablesMixin")],t),t};let op=class extends dNe(hNe(cs.EventedMixin(xe))){constructor(e){super(e),this.allLayers=new TA({getCollections:()=>[this.basemap?.baseLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=aNe(this),this.basemap=null,this.editableLayers=new TA({getCollections:()=>[this.allLayers],itemFilterFunction:eNe}),this.ground=new xA,this._basemapCache=rNe()}destroy(){this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.ground?.destroy(),this.basemap?.destroy(),iNe(this._basemapCache),this._basemapCache=null}castBasemap(e){return KG(e,this._basemapCache)}castGround(e){return lNe(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};h([f({readOnly:!0,dependsOn:[]})],op.prototype,"allLayers",void 0),h([f({readOnly:!0})],op.prototype,"allTables",void 0),h([f({type:wA})],op.prototype,"basemap",void 0),h([si("basemap")],op.prototype,"castBasemap",null),h([f({readOnly:!0})],op.prototype,"editableLayers",void 0),h([f({type:xA,nonNullable:!0})],op.prototype,"ground",void 0),h([si("ground")],op.prototype,"castGround",null),op=h([F("esri.Map")],op);const dpe=op,tY={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},pNe={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function fNe(e,t){const r=new Date(e,t+1,1);return r.setDate(0),r.getDate()}function Gv(e,t,r){const i=new Date(e.getTime());if(t&&r){const s=pNe[r],{getter:n,setter:o,multiplier:a}=s;if(r==="months"){const l=fNe(i.getFullYear(),i.getMonth()+t);i.getDate()>l&&i.setDate(l)}i[o](i[n]()+t*a)}return i}function rY(e,t){switch(t){case"milliseconds":return new Date(e.getTime());case"seconds":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds());case"minutes":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes());case"hours":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());case"days":return new Date(e.getFullYear(),e.getMonth(),e.getDate());case"weeks":return new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay());case"months":return new Date(e.getFullYear(),e.getMonth(),1);case"years":return new Date(e.getFullYear(),0,1);case"decades":return new Date(e.getFullYear()-e.getFullYear()%10,0,1);case"centuries":return new Date(e.getFullYear()-e.getFullYear()%100,0,1);default:return new Date}}function jpt(e,t,r){return e===0?0:e*tY[t]/tY[r]}var Oh;let lc=Oh=class extends Pe{static get allTime(){return iY}static get empty(){return mNe}constructor(e){super(e),this.end=null,this.start=null}readEnd(e,t){return t.end!=null?new Date(t.end):null}writeEnd(e,t){t.end=e?e.getTime():null}get isAllTime(){return this.equals(Oh.allTime)}get isEmpty(){return this.equals(Oh.empty)}readStart(e,t){return t.start!=null?new Date(t.start):null}writeStart(e,t){t.start=e?e.getTime():null}clone(){return new Oh({end:this.end,start:this.start})}equals(e){if(!e)return!1;const t=this.start!=null?this.start.getTime():this.start,r=this.end!=null?this.end.getTime():this.end,i=e.start!=null?e.start.getTime():e.start,s=e.end!=null?e.end.getTime():e.end;return t===i&&r===s}expandTo(e){if(this.isEmpty||this.isAllTime)return this.clone();const t=Lu(this.start,i=>rY(i,e)),r=Lu(this.end,i=>{const s=rY(i,e);return i.getTime()===s.getTime()?s:Gv(s,1,e)});return new Oh({start:t,end:r})}intersection(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return Oh.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();const t=this.start?.getTime()??-1/0,r=this.end?.getTime()??1/0,i=e.start?.getTime()??-1/0,s=e.end?.getTime()??1/0;let n,o;if(i>=t&&i<=r?n=i:t>=i&&t<=s&&(n=t),r>=i&&r<=s?o=r:s>=t&&s<=r&&(o=s),n!=null&&o!=null&&!isNaN(n)&&!isNaN(o)){const a=new Oh;return a.start=n===-1/0?null:new Date(n),a.end=o===1/0?null:new Date(o),a}return Oh.empty}offset(e,t){if(this.isEmpty||this.isAllTime)return this.clone();const r=new Oh,{start:i,end:s}=this;return i!=null&&(r.start=Gv(i,e,t)),s!=null&&(r.end=Gv(s,e,t)),r}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return iY.clone();const t=this.start!=null&&e.start!=null?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,r=this.end!=null&&e.end!=null?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new Oh({start:t,end:r})}};h([f({type:Date,json:{write:{allowNull:!0}}})],lc.prototype,"end",void 0),h([br("end")],lc.prototype,"readEnd",null),h([Yt("end")],lc.prototype,"writeEnd",null),h([f({readOnly:!0,json:{read:!1}})],lc.prototype,"isAllTime",null),h([f({readOnly:!0,json:{read:!1}})],lc.prototype,"isEmpty",null),h([f({type:Date,json:{write:{allowNull:!0}}})],lc.prototype,"start",void 0),h([br("start")],lc.prototype,"readStart",null),h([Yt("start")],lc.prototype,"writeStart",null),lc=Oh=h([F("esri.TimeExtent")],lc);const iY=new lc,mNe=new lc({start:void 0,end:void 0}),DN=lc;let bC=class extends fC{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};h([fue({Type:v1,ensureType:ro(v1)})],bC.prototype,"itemType",void 0),bC=h([F("esri.support.GraphicsCollection")],bC);const sY=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);function gNe(e,t="system"){if(!e||!sY.has(e.timeZone))return t;const r=sY.get(e.timeZone);return _Ne(e.timeZone)||e.respectsDaylightSaving?r:yNe(r)}function yNe(e){const t=ur.local().setZone(e),r=Math.min(t.set({month:1,day:1}).offset,t.set({month:5}).offset);return r===0?"Etc/UTC":`Etc/GMT${va.instance(-r).formatOffset(0,"narrow")}`}function _Ne(e){return e.startsWith("UTC")}let a0=class extends of(Pe){constructor(e){super(e),this.legacy=null,this.timeZone="system"}readLegacy(e,t){const{timeZone:r,respectsDaylightSaving:i}=t;return{timeZone:r,respectsDaylightSaving:i}}readTimeZone(e,t){return"timeZoneIANA"in t?t.timeZoneIANA:gNe(t)}writeTimeZone(e,t){t.timeZoneIANA=e}equals(e){return e!=null&&this.timeZone!=null&&e.timeZone!=null&&this.timeZone===e.timeZone}};h([f()],a0.prototype,"legacy",void 0),h([br("legacy",["timeZone"])],a0.prototype,"readLegacy",null),h([f({type:String,nonNullable:!0})],a0.prototype,"timeZone",void 0),h([br("timeZone",["timeZone","timeZoneIANA","respectsDaylightSaving"])],a0.prototype,"readTimeZone",null),h([Yt("timeZone")],a0.prototype,"writeTimeZone",null),a0=h([F("esri.time.TimeReference")],a0);const ppe=a0;let l0=class extends xe{constructor(e){super(e),this.view=null,this.baseLayerViews=new Pt,this.referenceLayerViews=new Pt,this._loadingHandle=le(()=>this.view?.map?.basemap,t=>{t&&t.load().catch(()=>{})},Rr)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){if(this.view&&this.view.suspended)return!1;const e=this.view?.map?.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(t=>t.updating)||this.referenceLayerViews.some(t=>t.updating))}};h([f({constructOnly:!0})],l0.prototype,"view",void 0),h([f({readOnly:!0})],l0.prototype,"baseLayerViews",void 0),h([f({readOnly:!0})],l0.prototype,"referenceLayerViews",void 0),h([f({readOnly:!0})],l0.prototype,"suspended",null),h([f({type:Boolean,readOnly:!0})],l0.prototype,"updating",null),l0=h([F("esri.views.BasemapView")],l0);function vNe(e){return"tryRecycleWith"in e}class bNe{constructor(t,r,i){this.layer=t,this.view=r,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=Ys(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,Ws(this._controller.signal,()=>{const s=new G("cancelled:layerview-create","layerview creation cancelled",{layer:t});this._deferred.reject(s)})}tryRecycle(t){if(!this.done||!this.layerView||!vNe(this.layerView))return null;const r=this.layer.type,i=this._controller.signal;for(let s=0;s<t.length;s++){const n=t[s];if(n.type!==r)continue;const o=this.layerView.tryRecycleWith(n,{signal:i});if(o){t.splice(s,1),this.layer=n;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(Jt(this._controller.signal),n.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),n.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,u)=>Ws(this._controller.signal,()=>u(Cr())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:t}=this;if(t){const{layer:r,view:i}=this;r.emit("layerview-destroy",{view:i,layerView:t}),i.emit("layerview-destroy",{layer:r,layerView:t})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:t},layer:r,view:i}=this;this._map=i.map;try{let s,n;if(await r.load({signal:t}),"prefetchResources"in r&&await r.prefetchResources?.({signal:t}),xNe(r))s=await r.createLayerView(i,{signal:t});else{if(!this.layerViewImporter.hasLayerViewModule(r))throw new G("layer:view-not-supported","No layerview implementation was found");const l=await this.layerViewImporter.importLayerView(r);Jt(t),s="default"in l?new l.default({layer:r,view:i}):new l({layer:r,view:i})}const o=()=>{n=xi(n),s.destroyed||s.destroy(),s.layer=null,s.parent=null,s.view=null,this.done=!0};n=Ws(t,o),Jt(t);try{await s.when()}catch(l){throw o(),l}if(!this._map?.allLayers?.includes(r))return o(),void this._deferred.reject(new G("view:no-layerview-for-layer","The layer has been removed from the map",{layer:r}));this.layerView=s,r.emit("layerview-create",{view:i,layerView:s}),i.emit("layerview-create",{layer:r,layerView:s}),this.done=!0,this._deferred.resolve(s)}catch(s){r.emit("layerview-create-error",{view:i,error:s}),i.emit("layerview-create-error",{layer:r,error:s}),this.done=!0,this._deferred.reject(new G("layerview:create-error","layerview creation failed",{layer:r,error:s}))}}}let lu=class extends xe{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new Fp,this.supportsGround=!0,this._preloadLayerViewModules=()=>{const t=this.view.map?.allLayers;if(t)for(const r of t)this.layerViewImporter.hasLayerViewModule(r)&&this.layerViewImporter.importLayerView(r)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=Ys(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(w3(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{if(this.destroyed)return;const t=this.view.map;if(this._map!==t&&(this.clear(),this._map=t),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const r=new Set,i=[],s=this.view.ready,n=a=>{if(a!=null){for(const l of a)if(l){r.add(l);const c=this._layerLayerViewInfoMap.get(l);c&&s?c.start():c||this._recyclingInfoMap.has(l)||i.push(l),"layers"in l&&l.layers&&n(l.layers)}}};for(const a of this._rootCollectionNames)n(this.get(a));for(const[a,l]of this._layerLayerViewInfoMap)if(!r.has(a)){this._layerLayerViewInfoMap.delete(l.layer);const c=l.tryRecycle(i);c?(this.notifyChange("updating"),this._recyclingInfoMap.set(l.layer,l),c.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(l.layer),this._layerLayerViewInfoMap.set(l.layer,l),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(l.layer),l.destroy(),this._reschedule()})):l.destroy()}for(const[a,l]of this._recyclingInfoMap)r.has(a)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(l.layer),l.destroy());for(const a of i)this._createLayerView(a);this._refreshCollections();const o=[t?.ground?.layers,t?.basemap?.baseLayers,t?.basemap?.referenceLayers,t?.layers].filter(a=>!!a);r.forEach(a=>"layers"in a&&o.push(a.layers)),this.addHandles(o.map(a=>this._watchUpdatingTracking.addOnCollectionChange(()=>a,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.own([qo(()=>this.view?.map?.allLayers,"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),le(()=>{const e=this.view,t=e?.map;return[t?.basemap,t?.ground,t?.layers,e?.ready]},()=>this._reschedule(),_s)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),wF(this._recyclingInfoMap),wF(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(Cr()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||_o(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){this.destroyed||(wF(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new G("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,r){if(!e||!t)return void(t&&t.removeAll());let i=0;for(const s of e){const n=this._layerLayerViewInfoMap.get(s);if(!n||!n.layerView)continue;const o=n.layerView;o.layer=s,o.parent=r,t.at(i)!==o&&t.splice(i,0,o),s.layers&&this._populateLayerViewsOwners(s.layers,o.layerViews,o),i+=1}i<t.length&&t.splice(i,t.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new bNe(e,this.view,this.layerViewImporter);t.promise.then(()=>this._refreshCollections(),r=>{r&&($s(r)||r.name==="cancelled:layerview-create")||K.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:r}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};h([f()],lu.prototype,"_workPromise",void 0),h([f({readOnly:!0})],lu.prototype,"_watchUpdatingTracking",void 0),h([f({readOnly:!0})],lu.prototype,"_layersToLayerViews",null),h([f({readOnly:!0})],lu.prototype,"_rootCollectionNames",null),h([f()],lu.prototype,"layerViewImporter",void 0),h([f()],lu.prototype,"supportsGround",void 0),h([f({readOnly:!0})],lu.prototype,"updating",null),h([f({readOnly:!0})],lu.prototype,"updatingRemaining",null),h([f({constructOnly:!0})],lu.prototype,"view",void 0),lu=h([F("esri.views.LayerViewManager")],lu);const wNe=lu;function xNe(e){return"createLayerView"in e&&e.createLayerView!=null}let ic=class extends xe{constructor(e){super(e),this.factor=1.5,this.offset=Xu(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};h([f({type:Number})],ic.prototype,"factor",void 0),h([f({nonNullable:!0})],ic.prototype,"offset",void 0),h([f()],ic.prototype,"position",void 0),h([f({type:Number,range:{min:0}})],ic.prototype,"size",void 0),h([f()],ic.prototype,"maskUrl",void 0),h([f()],ic.prototype,"maskEnabled",void 0),h([f()],ic.prototype,"overlayUrl",void 0),h([f()],ic.prototype,"overlayEnabled",void 0),h([f({readOnly:!0})],ic.prototype,"version",null),h([f({type:Boolean})],ic.prototype,"visible",void 0),ic=h([F("esri.views.Magnifier")],ic);const fpe=ic;class TNe{constructor(){this._tasks=new Array,this._running=bA(!1)}get length(){return this._tasks.length}get running(){return this._running.value}destroy(){this.cancelAll()}runTask(t){for(;!t.done&&this._process(t);)t.madeProgress()}push(t,r,i){return this._running.value=!0,new Promise((s,n)=>this._tasks.push(new nY(s,n,t,r,i)))}unshift(t,r,i){return this._running.value=!0,new Promise((s,n)=>this._tasks.unshift(new nY(s,n,t,r,i)))}_process(t){if(this._tasks.length===0)return!1;const r=this._tasks.shift();try{const i=Hs(r.signal);if(i&&!r.abortCallback)r.reject(Cr());else{const s=i?r.abortCallback?.(Cr()):r.callback(t);zc(s)?s.then(r.resolve,r.reject):r.resolve(s)}}catch(i){r.reject(i)}return this._running.value=this._tasks.length>0,!0}cancelAll(){const t=Cr();for(const r of this._tasks)if(r.abortCallback){const i=r.abortCallback(t);r.resolve(i)}else r.reject(t);this._tasks.length=0,this._running.value=!1}}class nY{constructor(t,r,i,s=void 0,n=void 0){this.resolve=t,this.reject=r,this.callback=i,this.signal=s,this.abortCallback=n}}let _E=class extends xe{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};h([f()],_E.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),h([f()],_E.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),_E=h([F("esri.views.support.DebugFlags")],_E);const SNe=new _E;var Er;(function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"})(Er||(Er={}));function ENe(){return new nL.Scheduler}var Eo,at;(function(e){e[e.YIELD=1]="YIELD"})(Eo||(Eo={})),function(e){e.RESOURCE_CONTROLLER_IMMEDIATE="immediate",e.RESOURCE_CONTROLLER="schedule",e.SLIDE="slide",e.STREAM_DATA_LOADER="stream loader",e.ELEVATION_QUERY="elevation query",e.TERRAIN_SURFACE="terrain",e.SURFACE_GEOMETRY_UPDATES="surface geometry updates",e.LOD_RENDERER="LoD renderer",e.GRAPHICS_CORE="Graphics3D",e.I3S_CONTROLLER="I3S",e.POINT_CLOUD_LAYER="point cloud",e.FEATURE_TILE_FETCHER="feature fetcher",e.OVERLAY="overlay",e.STAGE="stage",e.GRAPHICS_DECONFLICTOR="graphics deconflictor",e.FILTER_VISIBILITY="Graphics3D filter visibility",e.SCALE_VISIBILITY="Graphics3D scale visibility",e.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",e.POINT_OF_INTEREST_FREQUENT="POI frequent",e.POINT_OF_INTEREST_INFREQUENT="POI infrequent",e.LABELER="labeler",e.FEATURE_QUERY_ENGINE="feature query",e.FEATURE_TILE_TREE="feature tile tree",e.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",e.ELEVATION_ALIGNMENT="elevation alignment",e.TEXT_TEXTURE_ATLAS="text texture atlas",e.TEXTURE_UNLOAD="texture unload",e.LINE_OF_SIGHT_TOOL="line of sight tool",e.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",e.ELEVATION_PROFILE="elevation profile",e.SNAPPING="snapping",e.SHADOW_ACCUMULATOR="shadow accumulator",e.CLOUDS_GENERATOR="clouds generator",e[e.NONE=0]="NONE",e[e.TEST_PRIO=1]="TEST_PRIO"}(at||(at={}));const vp=0,oY=new Map([[at.RESOURCE_CONTROLLER_IMMEDIATE,vp],[at.RESOURCE_CONTROLLER,4],[at.SLIDE,vp],[at.STREAM_DATA_LOADER,vp],[at.ELEVATION_QUERY,vp],[at.TERRAIN_SURFACE,1],[at.SURFACE_GEOMETRY_UPDATES,1],[at.LOD_RENDERER,2],[at.GRAPHICS_CORE,2],[at.I3S_CONTROLLER,2],[at.POINT_CLOUD_LAYER,2],[at.FEATURE_TILE_FETCHER,2],[at.OVERLAY,4],[at.STAGE,4],[at.GRAPHICS_DECONFLICTOR,4],[at.FILTER_VISIBILITY,4],[at.SCALE_VISIBILITY,4],[at.FRUSTUM_VISIBILITY,4],[at.CLOUDS_GENERATOR,4],[at.POINT_OF_INTEREST_FREQUENT,6],[at.POINT_OF_INTEREST_INFREQUENT,30],[at.LABELER,8],[at.FEATURE_QUERY_ENGINE,8],[at.FEATURE_TILE_TREE,16],[at.FEATURE_TILE_TREE_ACTIVE,vp],[at.ELEVATION_ALIGNMENT,12],[at.TEXT_TEXTURE_ATLAS,12],[at.TEXTURE_UNLOAD,12],[at.LINE_OF_SIGHT_TOOL,16],[at.LINE_OF_SIGHT_TOOL_INTERACTIVE,vp],[at.SNAPPING,vp],[at.SHADOW_ACCUMULATOR,30]]);function aY(e){return oY.has(e)?oY.get(e):typeof e=="number"?e:1}const lY=6.5,cY=1,CNe=30,uY=1e3/30,hY=100,dY=.9;var nL,Zy;(function(e){class t{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(n=>n.needsUpdate)}constructor(){this._updating=bA(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new hm("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=Er.INTERACTING,this._tasks=new Mt,this._runQueue=new Mt,this._load=0,this._idleStateCallbacks=new Mt,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=le(()=>SNe.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,Rr);for(const o of Object.keys(at))this.performanceInfo.tasks.set(at[o],new hm(at[o]));const n=this;this._test={FRAME_SAFETY_BUDGET:lY,INTERACTING_BUDGET:uY,IDLE_BUDGET:hY,get availableBudget(){return n._budget.budget},usedBudget:0,getBudget:()=>n._budget,setBudget:o=>n._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),xi(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(n){this._updatingChanged(),n&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(n,o){const a=aY(n),l=new r(this,n,o,a);return this._tasks.push(l),this._updatingChanged(),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new hm(n)),l}registerIdleStateCallbacks(n,o){const a={idleBegin:n,idleEnd:o};this._idleStateCallbacks.push(a),this.state===Er.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===Er.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==Er.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(n){this._test.usedBudget=0,++this._frameNumber;let o=lY,a=n.frameDuration,l=cY;switch(this.state){case Er.IDLE:o=0,a=Math.max(hY,n.frameDuration),l=CNe;break;case Er.INTERACTING:a=Math.max(uY,n.frameDuration);case Er.ANIMATING:}return a=a-n.elapsedFrameTime-o,this.state!==Er.IDLE&&a<cY&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Er.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case Er.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n),this._updatingChanged()}_updateTask(n){this._tasks.forAll(o=>{o.name===n&&o.setPriority(n)})}_getState(n){if(this._runQueue.some(a=>a.name===n))return Zy.SCHEDULED;let o=Zy.IDLE;return this._tasks.forAll(a=>{a.name===n&&a.needsUpdate&&(a.schedulePriority<=1?o=Zy.READY:o!==Zy.READY&&(o=Zy.WAITING))}),o}_getRuntime(n){let o=0;return this._tasks.forAll(a=>{a.name===n&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&n.set(a.name,(n.get(a.name)||0)+1)}),n.size===0)return null;let o="";return n.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*dY+n*(1-dY)}_schedule(){for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{n.basePriority===vp&&n.needsUpdate&&!this._runQueue.includes(n)&&n.blockFrame!==this._frameNumber&&this._runQueue.unshift(n)});this._runQueue.length===0;){let n=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==vp&&a.blockFrame!==this._frameNumber&&(n=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!n)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const n=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===Eo.YIELD&&(a.blockFrame=this._frameNumber)}catch(c){K.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c)}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,at.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&l>2*this._budget.budget&&console.log("Task",a.name,"used",l,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-n)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-n)}_startFrameTaskTimes(){for(const n of Object.keys(at))this._frameTaskTimes.set(at[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(n)}get test(){return this._test}}e.Scheduler=t;class r{get task(){return this._task.value}get updating(){return this._queue.running}constructor(n,o,a,l){this._scheduler=n,this.name=o,this._basePriority=l,this.blockFrame=0,this.runtime=0,this._queue=new TNe,this._handles=new gi,this.schedulePriority=this._basePriority,this._task=bA(a??this._queue),this._handles.add(Dc(()=>this.task.running,c=>n.taskRunningChanged(c)))}remove(){this.processQueue(_a),this._scheduler.removeTask(this),this.schedule=wT.schedule,this.reschedule=wT.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){this.name=n;const o=aY(n);this._basePriority!==vp&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,o,a){return this._queue.push(n,o,a)}reschedule(n,o,a){return this._queue.unshift(n,o,a)}processQueue(n){this._queue.runTask(n)}}class i{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=Er.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}e.Budget=i})(nL||(nL={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(Zy||(Zy={}));const _a=(()=>{const e=new nL.Budget;return e.enabled=!1,e})();class ANe{remove(){}processQueue(){}schedule(t,r,i){try{if(Hs(r)){const s=Cr();return i?Promise.resolve(i(s)):Promise.reject(s)}return w8(t(_a))}catch(s){return Promise.reject(s)}}reschedule(t,r,i){return this.schedule(t,r,i)}}const wT=new ANe;let ax=class extends xe{constructor(e,t){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=t?.registerTask(at.TEXTURE_UNLOAD)??wT}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask?.remove(),this._textureRequests?.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests?.clear()}get updating(){return this._frameTask.updating}fromData(e,t,r){const i=this.makeUid(e);let s=this._textureRequests.get(i);if(!s){const n=new mpe(r);n.texture=t(),this._stage?.add(n.texture),this._stage?.loadImmediate(n.texture),this._textureRequests.set(i,n),s=n}return s.referenceCount++,{uid:i,texture:s.texture,release:()=>this._release(i)}}_release(e){const t=this._textureRequests.get(e);t?(t.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),t.referenceCount--,t.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const t=this._textureRequests.get(e);!t||t.referenceCount>0||(this._releaseTextureRequest(t),this._textureRequests.delete(e))}_releaseTextureRequest(e){e.onRemove&&e.onRemove(),e.texture?this._stage?.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,t=null){return t!=null?`${e}.${t}px`:e}};h([f()],ax.prototype,"_frameTask",void 0),h([f()],ax.prototype,"updating",null),ax=h([F("esri.views.3d.support.TextureCollection")],ax);class mpe{constructor(t){this.onRemove=t,this.referenceCount=0}}var pY;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"})(pY||(pY={}));const gpe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],ype={};function _pe(e){return!!ype[e]}function ONe(e){for(const t of e)if(!_pe(t))return!1;return!0}gpe.forEach(e=>{ype[e]=!0});class RNe{constructor(t){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=t,this.inputManager=null}connect(t){t&&this.disconnect(),this.inputManager=t,this._handlers.forEach(({handler:r,priority:i},s)=>this.inputManager?.installHandlers(s,[r],i))}disconnect(){this.inputManager&&this._handlers.forEach((t,r)=>this.inputManager?.uninstallHandlers(r)),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(t,r,i,s){const n=Array.isArray(t)?t:t.split(",");if(!ONe(n))return n.some(_pe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(r)?a=r:(o=r,a=[]),typeof i=="function"?o=i:s=i,s=s??iy.DEFAULT;const l=this._createUniqueGroupName(),c=new PNe(this.view,n,a,o);this._handlers.set(l,{handler:c,priority:s});for(const u of n){const d=this._handlerCounts.get(u)||0;this._handlerCounts.set(u,d+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),{remove:()=>this._removeHandler(l,n)}}hasHandler(t){return!!this._handlerCounts.get(t)}_removeHandler(t,r){if(this._handlers.has(t)){this._handlers.delete(t);for(const i of r){const s=this._handlerCounts.get(i);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",i):s===1?this._handlerCounts.delete(i):this._handlerCounts.set(i,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(t)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}}class PNe extends ao{constructor(t,r,i,s){super(!0),this._latestDragStart=void 0,this.view=t;for(const n of r)switch(n){case"click":this.registerIncoming("click",i,o=>s(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",i,o=>s(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",i,o=>s(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,o=>s(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",i,o=>s(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",i,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",i,o=>s(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",i,o=>s(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",i,o=>s(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",i,o=>s(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",i,o=>s(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,o=>s(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,o=>s(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,o=>s(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,o=>s(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",i,o=>{s(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",i,o=>{s(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",i,o=>{s(this._wrapBlur(o))})}}_wrapFocus(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:r=>t.async(r),preventDefault:()=>t.preventDefault()}}_wrapBlur(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:r=>t.async(r),preventDefault:()=>t.preventDefault()}}_wrapClick(t){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:u}=t;return{type:"click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:u,screenPoint:Xu(n,o),mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:d=>t.async(d),preventDefault:()=>t.preventDefault()}}_wrapDoubleClick(t){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:u}=t;return{type:"double-click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:u,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:d=>t.async(d),preventDefault:()=>t.preventDefault()}}_wrapImmediateClick(t){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:u,timestamp:d}=t;return{type:"immediate-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:d,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:u,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapImmediateDoubleClick(t){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:u,timestamp:d}=t;return{type:"immediate-double-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:d,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:u,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapHold(t){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a}=t.data,{cancelable:l,timestamp:c}=t;return{type:"hold",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(n,o),cancelable:l,stopPropagation:()=>t.stopPropagation(),async:u=>t.async(u),preventDefault:()=>t.preventDefault()}}_getMapPoint(t,r){return this.view.toMap(Xu(t,r),{exclude:[]})}_wrapDrag(t){const r=t.data,{x:i,y:s}=r.center,{action:n,pointerType:o,button:a}=r;if(n==="start"&&(this._latestDragStart=r),!this._latestDragStart)return;const l=r.pointer.native,c=r.buttons,{cancelable:u,timestamp:d}=t,p={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return n==="end"&&(this._latestDragStart=void 0),{type:"drag",action:n,x:i,y:s,origin:p,pointerType:o,button:a,buttons:c,radius:r.radius,angle:xa(r.angle),native:l,timestamp:d,cancelable:u,stopPropagation:()=>t.stopPropagation(),async:g=>t.async(g),preventDefault:()=>t.preventDefault()}}_wrapKeyDown(t){const{key:r,repeat:i,native:s}=t.data,{cancelable:n,timestamp:o}=t;return{type:"key-down",key:r,repeat:i,native:s,timestamp:o,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:a=>t.async(a),preventDefault:()=>t.preventDefault()}}_wrapKeyUp(t){const{key:r,native:i}=t.data,{cancelable:s,timestamp:n}=t;return{type:"key-up",key:r,native:i,timestamp:n,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:o=>t.async(o),preventDefault:()=>t.preventDefault()}}_wrapPointer(t,r){const{x:i,y:s,button:n,buttons:o,native:a,eventId:l}=t.data,c=a.pointerId,u=a.pointerType,{cancelable:d,timestamp:p}=t;return{type:r,x:i,y:s,pointerId:c,pointerType:u,button:n,buttons:o,native:a,timestamp:p,eventId:l,cancelable:d,stopPropagation:()=>t.stopPropagation(),async:g=>t.async(g),preventDefault:()=>t.preventDefault()}}_wrapPointerDrag(t){const{x:r,y:i,buttons:s,native:n,eventId:o}=t.data.currentEvent,{button:a}=t.data.startEvent,l=t.data.startEvent.native.pointerId,c=t.data.startEvent.native.pointerType,u=t.data.action,d={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:p,timestamp:g}=t;return{type:"pointer-drag",x:r,y:i,pointerId:l,pointerType:c,button:a,buttons:s,action:u,origin:d,native:n,timestamp:g,eventId:o,cancelable:p,stopPropagation:()=>t.stopPropagation(),async:y=>t.async(y),preventDefault:()=>t.preventDefault()}}_wrapMouseWheel(t){const{cancelable:r,data:i,timestamp:s}=t,{x:n,y:o,deltaY:a,native:l}=i;return{type:"mouse-wheel",x:n,y:o,deltaY:a,native:l,timestamp:s,cancelable:r,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}_wrapGamepad(t){const{action:r,state:i,device:s}=t.data,{cancelable:n,timestamp:o}=t,{buttons:a,axes:l}=i;return{type:"gamepad",device:s,timestamp:o,action:r,buttons:a,axes:l,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}}var SA,fY,mY;(function(e){e[e.USER=0]="USER",e[e.MANAGER=1]="MANAGER"})(SA||(SA={})),function(e){e[e.None=0]="None",e[e.Unfocused=1]="Unfocused",e[e.Focused=2]="Focused",e[e.Unselected=4]="Unselected",e[e.Selected=8]="Selected",e[e.All=15]="All"}(fY||(fY={})),function(e){e[e.None=0]="None",e[e.Custom1=16]="Custom1",e[e.Custom2=32]="Custom2",e[e.Custom3=64]="Custom3",e[e.Custom4=128]="Custom4",e[e.Custom5=256]="Custom5",e[e.Custom6=512]="Custom6",e[e.Custom7=1024]="Custom7",e[e.Custom8=2048]="Custom8",e[e.Custom9=4096]="Custom9",e[e.Custom10=8192]="Custom10",e[e.Custom11=16384]="Custom11",e[e.Custom12=32768]="Custom12",e[e.All=65520]="All"}(mY||(mY={}));function MNe(e){return[e.on("before-add",t=>{const r=t.item;if(r==null||e.includes(r))return K.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault();r.onAdd()}),e.on("after-remove",t=>{const r=t.item;r.active&&(r.view.activeTool=null),r.destroy()})]}function ez(e){return e.visible&&e.getEditableFlag!=null&&e.getEditableFlag(SA.USER)&&e.getEditableFlag(SA.MANAGER)}function ap(e){return Xu(e.x,e.y)}function Hpt(e){return zi(e.x,e.y)}function vpe(e,t){const r=(e instanceof HTMLElement?e:e.surface)?.getBoundingClientRect();return r?Xu(t.clientX-r.left,t.clientY-r.top):Xu(0,0)}function gY(e,t){return t instanceof Event?vpe(e,t):ap(t)}function yY(e){if(e instanceof Event)return!0;if(typeof e=="object"&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}class INe{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(t,r){const i=()=>t.stopPropagation();switch(t.type){case"pointer-move":_Y(t.pointerType)&&this._pointerLocations.set(t.pointerId,{x:t.x,y:t.y,pointerType:t.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),t.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!vY(t))break;const s=ap(t),n=this._intersect(s,t.pointerType,r.forEachTool);if(n==null)break;const o=n.manipulator,a=n.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(t)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,t,r),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(t)&&!o.grabbing&&(this._grabbedManipulators.set(t.pointerId,{manipulator:o,tool:a,start:s,pointerType:t.pointerType}),this._grabbedManipulators.size===1&&r.activeTool==null&&(this._revertToNullActiveTool=!0,r.setActiveTool(n.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:t.pointerType,screenPoint:s}),i());break}case"pointer-up":this._draggedManipulators.has(t.pointerId)||this._handlePointerEnd(t,r);break;case"pointer-drag":{if(!vY(t))break;const s=this._grabbedManipulators.get(t.pointerId),n=Lu(s,({manipulator:u})=>u),o=Lu(s,({tool:u})=>u);if(n==null||o==null)break;const a=ap(t);a.x=fe(a.x,0,r.view.width),a.y=fe(a.y,0,r.view.height);const l=s.start,c=this._draggedManipulators.get(t.pointerId);switch(t.action){case"start":case"update":t.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,c?n.events.emit("drag",{action:"update",start:l,screenPoint:a}):n.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:t.pointerType}),this._draggedManipulators.set(t.pointerId,{tool:o,manipulator:n,start:l}));break;case"end":n.dragging=!1,c&&n.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(t.pointerId),this._handlePointerEnd(t,r)}i();break}case"immediate-click":{const s=ap(t),n=this._intersect(s,t.pointerType,r.forEachTool);if($Ne(t)||r.forEachTool(c=>{if((n==null||n.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let u=!1;c.manipulators.forEach(({manipulator:d})=>{d.selected&&(d.selected=!1,u=!0)}),u&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),n==null)break;const{manipulator:o,tool:a}=n;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=t.native.shiftKey;o.events.emit("immediate-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:l,stopPropagation:i});break}case"click":{const s=ap(t),n=this._intersect(s,t.pointerType,r.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=t.native.shiftKey;o.events.emit(t.type,{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a}),i();break}case"double-click":{const s=ap(t),n=this._intersect(s,t.pointerType,r.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=t.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:i});break}case"immediate-double-click":{const s=ap(t),n=this._intersect(s,t.pointerType,r.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=t.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:i});break}}this._onFocusChange(r.forEachTool)}_ungrabManipulatorBeforeDragging(t,r,i){t.grabbing=!1,t.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:ap(r)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===t&&this._grabbedManipulators.delete(n)}),this._afterManipulatorUngrab(i.setActiveTool)}_handlePointerEnd(t,r){const i=Lu(this._grabbedManipulators.get(t.pointerId),({manipulator:s})=>s);i!=null&&i.grabbing&&(i.grabbing=!1,i.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:ap(t)}),this._grabbedManipulators.delete(t.pointerId),this._afterManipulatorUngrab(r.setActiveTool))}_cursorFromMap(t){let r=null;return _o(t,({manipulator:i})=>!(i==null||!i.interactive)&&(i.grabbing&&i.grabCursor?(r=i.grabCursor,!0):!!i.cursor&&(r=i.cursor,!0))),r}_onFocusChange(t){this._updateCursor(),this._updateFocusedManipulatorTools(t)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(t){const r=new Set,i=new Set;this._grabbedManipulators.forEach(({tool:s})=>{r.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{i.add(s)}),t(s=>{s.hasGrabbedManipulators=r.has(s),s.hasHoveredManipulators=i.has(s);const n=this._grabbedManipulators.values(),o=ETe(n,({tool:a})=>a===s);s.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(t,{forEachTool:r,setActiveTool:i},s=!0,n){const o=(a,l)=>a===t&&(n==null||n===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},u)=>{o(a,l)&&(this._grabbedManipulators.delete(u),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorUngrab(i),this._onFocusChange(r)}_intersect(t,r,i){let s=null;return i(n=>{if(n.manipulators==null||!ez(n))return!1;const o=n.manipulators.intersect(t,r);return o!=null&&(s={tool:n,manipulator:o},!0)}),s}updateHoveredStateFromKnownPointers(t){this._pointerLocations.forEach((r,i)=>{this._updateHoveredStateForPointerAtScreenPosition(Xu(r.x,r.y),i,r.pointerType,t)})}handleHoverEvent(t,r){t.type!=="pointer-up"&&t.type!=="immediate-click"&&t.type!=="pointer-move"||!_Y(t.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(ap(t),t.pointerId,t.pointerType,r)}_updateHoveredStateForPointerAtScreenPosition(t,r,i,s){let n=this._intersect(t,i,s);const o=Lu(this._hoveredManipulators.get(r),({manipulator:a})=>a);n==null||n.manipulator.interactive||(n=null),n!=null&&o===n.manipulator||(o!=null&&(o.hovering=!1),n!=null?(n.manipulator.hovering=!0,this._hoveredManipulators.set(r,n)):this._hoveredManipulators.delete(r),this._onFocusChange(s))}_afterManipulatorUngrab(t){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(t(null),this._revertToNullActiveTool=!1)}}function _Y(e){return e==="mouse"}function vY(e){return e.pointerType!=="mouse"||e.button===0}function $Ne(e){return!!e.native.shiftKey}const bY="attached",xF="tools",LNe=1e3;let Rh=class extends gA{constructor(e){super(e),this._clock=b3,this._manipulatorState=new INe,this.tools=new Pt,this.cursor=null,this._interacting=!1,this._interactingTimeout=null,this._forEachTool=t=>{for(const r of this.tools.items)if(t(r))return}}initialize(){this.handles.add([this.view.on(gpe,e=>{this._handleInputEvent(e)},iy.TOOL),...MNe(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void K.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const t=this.activeTool;this._set("activeTool",e),t?.deactivate(),e?.activate(),this._removeIncompleteTools(e);for(const r of this.tools){this._updateToolEditableFlag(r);const i=ez(r);this.activeTool!=null&&i||this._manipulatorState.clearPointers(r,this._manipulatorStateEventArgs,!i)}this._updateCursor()}get updating(){return this.updatingHandles.updating||this.tools.some(e=>e.updating)||(this.textures?.updating??!1)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeout=xi(this._interactingTimeout)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeout=this._clock.setTimeout(()=>this._interacting=!1,LNe)}attach(){this.view.type==="3d"?(this._set("textures",new ax(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([le(()=>{const{state:e}=this.view;return"camera"in e&&e.camera},()=>this._forEachManipulator(e=>e.onViewChange())),this.view.elevationProvider?.on("elevation-change",e=>this._forEachManipulator(t=>t.onElevationChange(e))),Xo(()=>this._set("textures",Re(this.textures)))],bY)):this.handles.add(le(()=>this.view.extent,()=>this._forEachManipulator(e=>e.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.handles.remove(bY),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(t=>{t.manipulators&&t.manipulators.forEach(({manipulator:r})=>e(r,t))})}_handleInputEvent(e){let t=!1;const r={...e,stopPropagation:()=>{t=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r):this._forEachTool(i=>{!t&&i.visible&&i.handleInputEvent(r)}),!t&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,this._manipulatorStateEventArgs),t||this.activeTool==null||this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.handles.remove(xF),this._forEachTool(e=>{if(e instanceof xe){const t=le(()=>[e.cursor,e.visible,e.editable],()=>{ez(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.handles.add(t,xF)}e.manipulators&&this.handles.add([e.manipulators.on("after-remove",t=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,t.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],xF)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){e.setEditableFlag?.(SA.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(t=>!(t.cursor==null||!t.visible)&&(e=t.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(t=>(e==null||t!==e)&&!t.created&&t.removeIncompleteOnCancel).forEach(t=>{this.tools.remove(t)})}get test(){return{setClock:e=>this._clock=e}}};h([f({constructOnly:!0,nonNullable:!0})],Rh.prototype,"view",void 0),h([f({readOnly:!0,nonNullable:!0})],Rh.prototype,"textures",void 0),h([f({value:null})],Rh.prototype,"activeTool",null),h([f({readOnly:!0,type:Pt})],Rh.prototype,"tools",void 0),h([f({readOnly:!0})],Rh.prototype,"cursor",void 0),h([f({readOnly:!0})],Rh.prototype,"updating",null),h([f()],Rh.prototype,"_interacting",void 0),h([f({readOnly:!0})],Rh.prototype,"interacting",null),Rh=h([F("esri.views.ToolViewManager")],Rh);let Iw=class extends xe{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":DNe.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return NNe[this.deviceType]}};h([f({nonNullable:!0,readOnly:!0})],Iw.prototype,"nativeIndex",void 0),h([f({type:String,readOnly:!0})],Iw.prototype,"deviceType",null),h([f({type:Number,readOnly:!0})],Iw.prototype,"axisThreshold",null),Iw=h([F("esri.views.input.gamepad.GamepadInputDevice")],Iw);const DNe=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),NNe={standard:.15,spacemouse:.025,unknown:0},QG=Iw;let vE=class extends xe{constructor(...e){super(...e),this.devices=new Pt,this.enabledFocusMode="document"}};h([f({type:Pt.ofType(QG),readOnly:!0})],vE.prototype,"devices",void 0),h([f({type:["document","view","none"]})],vE.prototype,"enabledFocusMode",void 0),vE=h([F("esri.views.input.gamepad.GamepadSettings")],vE);const FNe=vE;let KM=class extends xe{constructor(){super(...arguments),this.gamepad=new FNe}};h([f({readOnly:!0})],KM.prototype,"gamepad",void 0),KM=h([F("esri.views.input.Input")],KM);const UNe=KM;let c0=class extends xe{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};h([f({type:Boolean,nonNullable:!0})],c0.prototype,"enabled",void 0),h([f({type:QG})],c0.prototype,"device",void 0),h([f({type:["pan","zoom"],nonNullable:!0})],c0.prototype,"mode",void 0),h([f({type:["forward-down","forward-up"],nonNullable:!0})],c0.prototype,"tiltDirection",void 0),h([f({type:Number,nonNullable:!0})],c0.prototype,"velocityFactor",void 0),c0=h([F("esri.views.navigation.gamepad.GamepadSettings")],c0);const bpe=c0;let G_=class extends xe{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new bpe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};h([f({type:Boolean})],G_.prototype,"browserTouchPanEnabled",void 0),h([f({type:bpe,nonNullable:!0})],G_.prototype,"gamepad",void 0),h([f({type:Boolean})],G_.prototype,"momentumEnabled",void 0),h([f({type:Boolean})],G_.prototype,"mouseWheelZoomEnabled",void 0),G_=h([F("esri.views.navigation.Navigation")],G_);const wpe=G_,xpe={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},Tpe=Object.values(xpe),Spe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${Tpe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),kNe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${Tpe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),zNe=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function Wpt(e){return!!Spe.test(e)}function ej(e){if(e==null)return null;const t=Us(e),r=t.path.match(Spe)||t.path.match(kNe);if(!r)return null;const[,i,s,n,o]=r,a=s.indexOf("/");return{title:Epe(a!==-1?s.slice(a+1):s),serverType:xpe[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:i}}}function BNe(e){const t=Us(e).path.match(zNe);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function Epe(e){return(e=e.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function qpt(e,t){const r=[];if(e){const i=ej(e);i!=null&&i.title&&r.push(i.title)}if(t){const i=Epe(t);r.push(i)}if(r.length===2){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function Xpt(e){if(!e)return!1;const t=".arcgis.com/",r="//services",i="//tiles",s="//features",n=(e=e.toLowerCase()).includes(t),o=e.includes(r)||e.includes(i)||e.includes(s);return n&&o}function Zpt(e,t){return e&&Roe(Moe(e,t))}function Ypt(e){let{url:t}=e;if(!t)return{url:t};t=Moe(t,e.logger);const r=Us(t),i=ej(r.path);let s;if(i!=null)i.sublayer!=null&&e.layer.layerId==null&&(s=i.sublayer),t=i.url.path;else if(e.nonStandardUrlAllowed){const n=BNe(r.path);n!=null&&(t=n.serviceUrl,s=n.sublayerId)}return{url:Roe(t),layerId:s}}function Jpt(e,t,r,i,s){fy(t,i,"url",s),i.url&&e.layerId!=null&&(i.url=sf(i.url,r,e.layerId.toString()))}function Kpt(e){if(!e)return!1;const t=e.toLowerCase(),r=t.includes("/services/"),i=t.includes("/mapserver/wmsserver"),s=t.includes("/imageserver/wmsserver"),n=t.includes("/wmsserver");return r&&(i||s||n)}function VNe(e,t){if(!e)return null;if(!tz(e))return new G("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:e});const r=e.heightUnit,i=rb.deriveUnitFromSR(e,t).heightUnit;return r!==i?new G("webscene:incompatible-height-unit",`The vertical units of the scene (${r}) must match the horizontal units of the scene (${i})`,{verticalUnit:r,horizontalUnit:i}):null}function Qpt(e,t,r){const i=Cpe(e),s=t,n=GNe(i,s,r);if(i){const o=rb.deriveUnitFromSR(i,e.spatialReference).heightUnit;if(!r&&o!==i.heightUnit){const a=new G("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new G("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i,error:a})}}if(!jNe(e)||n===xl.Unsupported)return new G("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i});switch(n){case xl.Units:{const o=i?.heightUnit||"unknown",a=s?.heightUnit||"unknown",l=new G("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new G("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case xl.HeightModel:{const o=i?.heightModel||"unknown",a=s?.heightModel||"unknown",l=new G("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new G("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case xl.CRS:{const o=i?.vertCRS||"unknown",a=s?.vertCRS||"unknown",l=new G("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new G("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}}return null}function GNe(e,t,r){if(!tz(e)||!tz(t))return xl.Unsupported;if(e==null||t==null)return xl.Ok;if(!r&&e.heightUnit!==t.heightUnit)return xl.Units;if(e.heightModel!==t.heightModel)return xl.HeightModel;switch(e.heightModel){case"gravity-related-height":return xl.Ok;case"ellipsoidal":return e.vertCRS===t.vertCRS?xl.Ok:xl.CRS;default:return xl.Unsupported}}var xl;function tz(e){return e==null||e.heightModel!=null&&e.heightUnit!=null}function jNe(e){return"heightModelInfo"in e&&e.heightModelInfo!=null||e.spatialReference!=null||!Rpe(e)}function Cpe(e){const t=e.url?ej(e.url):void 0;return!(e.spatialReference?.vcsWkid==null&&t!=null&&t.serverType==="ImageServer")&&Ape(e)&&e.heightModelInfo?e.heightModelInfo:Rpe(e)?rb.deriveUnitFromSR(WNe,e.spatialReference):null}function Ape(e){return"heightModelInfo"in e}function Ope(e){if(e.type==="unknown"||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function Rpe(e){return Ope(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):Ppe(e)}function HNe(e){return e.layers!=null||Ppe(e)||Ope(e)||Ape(e)}function Ppe(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(e){e[e.Ok=0]="Ok",e[e.Units=1]="Units",e[e.HeightModel=2]="HeightModel",e[e.CRS=3]="CRS",e[e.Unsupported=4]="Unsupported"})(xl||(xl={}));const WNe=new rb({heightModel:"gravity-related-height"});var Ie;function wY(e){return e==="global"?Ie.Global:Ie.Local}function TF(e){return e===Ie.Global?"global":"local"}(function(e){e[e.Global=1]="Global",e[e.Local=2]="Local"})(Ie||(Ie={}));let rz,SF=null;async function qNe(e){SF||(SF=ue(()=>Promise.resolve().then(function(){return det}),void 0).then(t=>rz=t)),await SF,Jt(e)}async function Mpe(e,t,r,i){if(!e)return null;const s=e.spatialReference;return bN()||Dm(s,t)?g2(e,t):rz?rz.projectGeometry(e,t,r,i):(await Promise.race([qNe(i),yA(i)]),Mpe(e,t,r,i))}let Oi=class extends xe{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=$c(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference!=null?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){const e=this.map?.(),t=[];return this.priorityCollection!=null&&t.push(this.priorityCollection),t.push({parent:e?.basemap,layers:e?.basemap?.baseLayers},{layers:e?.layers},{parent:e?.ground,layers:e?.ground?.layers},{parent:e?.basemap,layers:e?.basemap?.referenceLayers}),t}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:t}=this._allLayers;let r=null;for(const s of e){const n=this._getSupportedSpatialReferences(s);if(n.length>0){const o=this._narrowDownSpatialReferenceCandidates(r,n);o!=null&&(r=o)}if(r!=null&&r.length===1)break}if(t&&(r==null||r.length!==1))return{updating:!0};const i=this._pickSpatialReferenceCandidate(r);return{spatialReference:i!=null?i.spatialReference:null,viewingMode:i!=null?i.viewingMode:null,updating:!1}}get _tileInfoTask(){if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:t}=this._collectLayers([{parent:this.map?.()?.basemap,layers:this.map?.()?.basemap?.baseLayers},{layers:this.map?.()?.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const r=e[0].tileInfo;return{tileInfo:r&&r.spatialReference.equals(this.spatialReference)?r:null,updating:!1}}return{updating:t}}get _heightModelInfoTask(){if(!this.required.heightModelInfo||this.suspended&&this._get("_heightModelInfoTask")?.heightModelInfo)return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:t}=this._allLayers;for(const r of e)if(HNe(r)){const i=Cpe(r);if(i)return{heightModelInfo:i,vcsWkid:r.spatialReference?.vcsWkid,latestVcsWkid:r.spatialReference?.latestVcsWkid,updating:!1}}return{updating:t}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,t=e.updating,r=[];for(const i of e.layers){const s="fullExtents"in i&&i.fullExtents||(i.fullExtent!=null?[i.fullExtent]:[]),n=this.requiresExtentInSpatialReference?null:s[0],o=s.find(a=>a.spatialReference.equals(this.spatialReference))??n;if(o)return{candidates:[{extent:o,layer:i}],updating:!1};if(this._getSupportedSpatialReferences(i).length>0)for(const a of s)r.push({extent:a,layer:i})}return{candidates:r,updating:t}}get _extentTask(){const{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const r=this._pickExtentCandidate(e),i=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&i.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=$c(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:i.clone(),task:v2(async s=>{try{const n=await Mpe(r.extent,i,"portalItem"in r.layer?r.layer.portalItem:void 0,s);this._projectExtentTask={...this._projectExtentTask,task:null,output:n}}catch{if(Hs(s))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if(e==null)return t;const r=[],i=(s,n)=>s!=null?n!=null?s===n&&s:s:n;for(const s of e)for(const n of t){if(!s.spatialReference.equals(n.spatialReference))continue;const o=i(s.viewingMode,n.viewingMode);if(o!==!1){r.push({spatialReference:s.spatialReference,viewingMode:o});break}}return r.length>0?r:null}_pickSpatialReferenceCandidate(e){const t=this.defaultSpatialReference;return e==null||e.length<1?t!=null?{spatialReference:t,viewingMode:null}:null:(t!=null&&e.length>1&&e.some(({spatialReference:r})=>r.equals(t))&&(e=e.filter(({spatialReference:r})=>r.equals(t))),e.length>1&&e.some(({viewingMode:r})=>r!==Ie.Local)&&(e=e.filter(({viewingMode:r})=>r!==Ie.Local)),e[0])}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(t.length===0)return[];const r=[];for(const i of t){const s=this.getSpatialReferenceSupport({spatialReference:i,layer:e});if(s!=null){const n=s.constraints!=null?s.constraints:[{spatialReference:i,viewingMode:null}];for(const{spatialReference:o,viewingMode:a}of n)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!o.equals(this.userSpatialReference)||r.push({spatialReference:o,viewingMode:a})}}return r}_pickExtentCandidate(e){const t=this.spatialReference;return e.find(({extent:r})=>t.equals(r.spatialReference))||e[0]}_collectLayers(e){if(this._loadMaybe(this.map?.())!=="loaded")return{layers:[],updating:!0};const t=new XNe;for(const r of e)if(this._collectCollection(r,t),t.preloading===this.sourcePreloadCount)break;return{layers:t.layers,updating:t.updating}}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(const r of e.layers){switch(this._loadMaybe(r)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":t.updating||t.layers.push(r),"layers"in r&&this._collectCollection({layers:r.layers},t)}if(t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(t=>{$s(t)||console.log(t)}),"loading"):e.loadStatus:"loaded"}};h([f()],Oi.prototype,"required",void 0),h([f({constructOnly:!0})],Oi.prototype,"map",void 0),h([f({constructOnly:!0})],Oi.prototype,"getSpatialReferenceSupport",void 0),h([f()],Oi.prototype,"defaultSpatialReference",void 0),h([f()],Oi.prototype,"userSpatialReference",void 0),h([f()],Oi.prototype,"sourcePreloadCount",void 0),h([f()],Oi.prototype,"priorityCollection",void 0),h([f()],Oi.prototype,"requiresExtentInSpatialReference",void 0),h([f()],Oi.prototype,"suspended",void 0),h([f({readOnly:!0})],Oi.prototype,"ready",null),h([f({readOnly:!0})],Oi.prototype,"heightModelInfoReady",null),h([f({readOnly:!0})],Oi.prototype,"spatialReference",null),h([f({readOnly:!0})],Oi.prototype,"extent",null),h([f({readOnly:!0})],Oi.prototype,"heightModelInfo",null),h([f({readOnly:!0})],Oi.prototype,"vcsWkid",null),h([f({readOnly:!0})],Oi.prototype,"latestVcsWkid",null),h([f({readOnly:!0})],Oi.prototype,"viewingMode",null),h([f({readOnly:!0})],Oi.prototype,"tileInfo",null),h([f({readOnly:!0})],Oi.prototype,"mapCollections",null),h([f({readOnly:!0})],Oi.prototype,"_allLayers",null),h([f({readOnly:!0})],Oi.prototype,"_spatialReferenceTask",null),h([f({readOnly:!0})],Oi.prototype,"_tileInfoTask",null),h([f({readOnly:!0})],Oi.prototype,"_heightModelInfoTask",null),h([f({readOnly:!0})],Oi.prototype,"_extentCandidatesTask",null),h([f()],Oi.prototype,"_extentTask",null),h([f()],Oi.prototype,"_projectExtentTask",void 0),Oi=h([F("esri.views.support.DefaultsFromMap")],Oi);class XNe{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}}var bE;let Et=bE=class extends bG(cs.EventedMixin(jD(xe))){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new TA({getCollections:()=>[this.basemapView?.baseLayerViews,this.groundView?.layerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:YNe}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new bC,this.analyses=new bT,this.typeSpecificPreconditionsReady=!0,this.layerViews=new Pt,this.magnifier=new fpe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.timeReference=new ppe,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new UNe,this.navigation=new wpe,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new RNe(this),this.persistableViewModels=new Pt,this._isValid=!1,this._readyCycleForced=!1,this._currentSpatialReference=null,this.handles.add(le(()=>this.preconditionsReady,t=>{t?(this._currentSpatialReference=this.spatialReference,bE.views.add(this)):(this._currentSpatialReference=null,bE.views.remove(this)),this.notifyChange("spatialReference"),!t&&this.ready?(this.toolViewManager?.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),this.layerViewManager?.clear(),this._teardown()):t&&!this.ready&&(this._startup(),this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach())},Vr))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,eT(()=>this.ready)))),this.basemapView=new l0({view:this}),this.layerViewManager=new wNe({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.toolViewManager=new Rh({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([le(()=>this.initialExtentRequired,e=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:e},{sync:!0,initial:!0}),le(()=>this.ready,e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)},{sync:!0}),le(()=>this._userSpatialReference,e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let e=null;this.handles.add([le(()=>this.defaultsFromMap?.ready,t=>{const r=this.map?.allLayers.length>0;if(t&&!this.spatialReference&&r){if(e!=null)return;const i=Xo(()=>e=$c(e));e=v2(async s=>{try{await rA(this.spatialReferenceWarningDelay,null,s)}catch{return}finally{e=null}K.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(i,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){this.destroyed||(bE.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Re(this.graphics),this.analyses=Re(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Re(this.analysisViewManager),this.toolViewManager=Re(this.toolViewManager),this.layerViewManager=Re(this.layerViewManager),this.basemapView=Re(this.basemapView),this.groundView?.destroy(),this.layerViews?.forEach(e=>e.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.removeAll(),this.map=Re(this.map))}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return K.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){return this.toolViewManager?.activeTool}set activeTool(e){this.toolViewManager&&(this.toolViewManager.activeTool=e)}get animation(){return this._get("animation")}set animation(e){this._set("animation",e)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Oi({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:e=>this.getSpatialReferenceSupport(e),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(e){this._set("extent",e)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||Lm.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!this.defaultsFromMap?.ready||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(e){e!==this._get("map")&&(e?.destroyed&&(K.getLogger(this).warn("#map","The provided map is already destroyed",{map:e}),e=null),Lm.isLoadable(e)&&e.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",e))}get spatialReference(){let e=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return e&&this.defaultsFromMap?.required?.heightModelInfo&&(e=e.clone(),e.vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),e}set spatialReference(e){const t=!kn(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get tools(){return this.toolViewManager?.tools}get initialExtent(){return this.defaultsFromMap?.extent}get cursor(){const e=this.toolViewManager?this.toolViewManager.cursor:null;return e??(this._cursor||"default")}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(e){return this.layerViewManager?.whenLayerView(e)??Promise.reject()}getDefaultSpatialReference(){return this.defaultsFromMap?.spatialReference}getDefaultHeightModelInfo(){return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??this.defaultsFromMap?.heightModelInfo??null}importLayerView(e){throw new G("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(e){return this.getSpatialReferenceSupport({spatialReference:e})!=null}when(e,t){return this.isResolved()&&!this.ready&&K.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,t)}forceReadyCycle(){this.ready&&(Dc(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}};Et.views=new Pt,h([f()],Et.prototype,"_userSpatialReference",void 0),h([f()],Et.prototype,"activeTool",null),h([f({readOnly:!0})],Et.prototype,"allLayerViews",void 0),h([f()],Et.prototype,"groundView",void 0),h([f()],Et.prototype,"animation",null),h([f()],Et.prototype,"basemapView",void 0),h([f()],Et.prototype,"center",null),h([f({readOnly:!0})],Et.prototype,"_defaultsFromMapSettings",null),h([f()],Et.prototype,"defaultsFromMap",null),h([f()],Et.prototype,"fatalError",void 0),h([f({type:Pr})],Et.prototype,"extent",null),h([f(Ek(bC,"graphics"))],Et.prototype,"graphics",void 0),h([f(Ek(bT,"analyses"))],Et.prototype,"analyses",void 0),h([f({readOnly:!0,type:rb})],Et.prototype,"heightModelInfo",null),h([f({readOnly:!0})],Et.prototype,"interacting",null),h([f({readOnly:!0})],Et.prototype,"navigating",null),h([f({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Et.prototype,"preconditionsReady",null),h([f({readOnly:!0})],Et.prototype,"typeSpecificPreconditionsReady",void 0),h([f({type:Pt,readOnly:!0})],Et.prototype,"layerViews",void 0),h([f()],Et.prototype,"resolution",null),h([f({type:fpe})],Et.prototype,"magnifier",void 0),h([f({value:null,type:dpe})],Et.prototype,"map",null),h([f()],Et.prototype,"padding",void 0),h([f({readOnly:!0})],Et.prototype,"ready",void 0),h([f({type:st})],Et.prototype,"spatialReference",null),h([f()],Et.prototype,"spatialReferenceWarningDelay",void 0),h([f()],Et.prototype,"stationary",null),h([f({readOnly:!0})],Et.prototype,"supportsGround",void 0),h([f({type:DN})],Et.prototype,"timeExtent",void 0),h([f({type:ppe,nonNullable:!0})],Et.prototype,"timeReference",void 0),h([f()],Et.prototype,"tools",null),h([f()],Et.prototype,"toolViewManager",void 0),h([f({readOnly:!0})],Et.prototype,"type",void 0),h([f({type:Number})],Et.prototype,"scale",void 0),h([f({readOnly:!0})],Et.prototype,"updating",void 0),h([f({readOnly:!0})],Et.prototype,"initialExtentRequired",void 0),h([f({readOnly:!0})],Et.prototype,"initialExtent",null),h([f()],Et.prototype,"cursor",null),h([f({readOnly:!0})],Et.prototype,"input",void 0),h([f({type:wpe,nonNullable:!0})],Et.prototype,"navigation",void 0),h([f()],Et.prototype,"layerViewManager",void 0),h([f()],Et.prototype,"analysisViewManager",void 0),h([f()],Et.prototype,"width",void 0),h([f()],Et.prototype,"height",void 0),h([f({readOnly:!0})],Et.prototype,"resizing",void 0),h([f({value:null,readOnly:!0})],Et.prototype,"size",null),h([f({readOnly:!0})],Et.prototype,"suspended",void 0),h([f({readOnly:!0})],Et.prototype,"viewEvents",void 0),h([f({readOnly:!0})],Et.prototype,"persistableViewModels",void 0),h([f()],Et.prototype,"_isValid",void 0),h([f()],Et.prototype,"_readyCycleForced",void 0),h([f()],Et.prototype,"_currentSpatialReference",void 0),Et=bE=h([F("esri.views.View")],Et);const ZNe=Et;function YNe(e){return e.layerViews}let u0=class extends x${constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=Ys(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._resolver?.reject(new G("ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._resolver?.resolve())}update(e,t){t||(t=zc(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};h([f({readOnly:!0})],u0.prototype,"done",null),h([f({readOnly:!0,type:String})],u0.prototype,"state",void 0),h([f()],u0.prototype,"target",void 0),u0=h([F("esri.views.ViewAnimation")],u0),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(u0||(u0={}));const xT=u0,K2=()=>ue(()=>import("./TileLayerView3D.15f3624b.js"),["assets/TileLayerView3D.15f3624b.js","assets/LayerView3D.a0f4cfd4.js","assets/TiledLayerView3D.a907660c.js","assets/LayerView.948860d4.js","assets/RefreshableLayerView.93fee593.js","assets/MapServiceLayerViewHelper.8a01bf5c.js","assets/floorFilterUtils.2fa4f3da.js","assets/normalizeUtils.54c24a4d.js","assets/normalizeUtilsCommon.87227ae2.js","assets/sql.414b1952.js","assets/sublayerUtils.e7f91234.js","assets/popupUtils.5174221c.js","assets/drapedUtils.603ce2e5.js"]),xY=()=>ue(()=>import("./ElevationLayerView3D.cc3b0d18.js"),["assets/ElevationLayerView3D.cc3b0d18.js","assets/LayerView3D.a0f4cfd4.js","assets/TiledLayerView3D.a907660c.js","assets/LayerView.948860d4.js"]),TY={"base-dynamic":()=>ue(()=>import("./BaseDynamicLayerView3D.57a2262a.js"),["assets/BaseDynamicLayerView3D.57a2262a.js","assets/DynamicLayerView3D.50afe590.js","assets/LayerView3D.a0f4cfd4.js","assets/projectExtentUtils.4a1e869d.js","assets/ImageMaterial.1905961e.js","assets/LayerView.948860d4.js","assets/RefreshableLayerView.93fee593.js"]),"base-elevation":xY,"base-tile":K2,"bing-maps":K2,"building-scene":()=>ue(()=>import("./BuildingSceneLayerView3D.5c9b2124.js"),["assets/BuildingSceneLayerView3D.5c9b2124.js","assets/BuildingGroupSublayer.d2b758b8.js","assets/BuildingComponentSublayer.2fceafa3.js","assets/UniqueValueRenderer.0143139a.js","assets/ColorStop.f762bde8.js","assets/diffUtils.f0876598.js","assets/colorRamps.80cb140e.js","assets/jsonUtils.4745b876.js","assets/DictionaryLoader.90c8c47c.js","assets/FieldsIndex.09813895.js","assets/heatmapUtils.32e9a30b.js","assets/FeatureLayer.6ea98f03.js","assets/sql.414b1952.js","assets/FeatureLayerBase.07ef7e55.js","assets/featureLayerUtils.0566dc37.js","assets/AttachmentQuery.c430db32.js","assets/Query.e586665e.js","assets/RelationshipQuery.60e2b826.js","assets/serviceCapabilitiesUtils.c358c66d.js","assets/editsZScale.58b9a03e.js","assets/queryZScale.2643e684.js","assets/FeatureSet.97dc0f24.js","assets/APIKeyMixin.605900a3.js","assets/ArcGISService.116191b2.js","assets/BlendLayer.eacc4944.js","assets/jsonUtils.1c231e28.js","assets/CustomParametersMixin.244652a9.js","assets/EditBusLayer.3831f0f2.js","assets/FeatureEffectLayer.a9b039ed.js","assets/FeatureEffect.ee83c7e0.js","assets/FeatureFilter.97dd33dd.js","assets/FeatureReductionLayer.9f7296a1.js","assets/LabelClass.1c6b8047.js","assets/defaults.83793da7.js","assets/defaultsJSON.a416f32c.js","assets/OrderedLayer.bbc75e49.js","assets/PortalLayer.9c2e677f.js","assets/portalItemUtils.ea6f2bf4.js","assets/ScaleRangeLayer.1a5bb9a6.js","assets/TemporalLayer.5874b62b.js","assets/FeatureTemplate.c7eaa370.js","assets/FeatureType.4659b5f1.js","assets/fieldProperties.174d0f24.js","assets/labelingInfo.990e68e3.js","assets/versionUtils.05c8a355.js","assets/styleUtils.a985c9a8.js","assets/TopFeaturesQuery.165d1927.js","assets/popupUtils.f5ffced0.js","assets/capabilities.e8ada26d.js","assets/I3SIndexInfo.9cdb77bc.js","assets/I3SLayerDefinitions.0628cd13.js","assets/I3SUtil.1e24f8d3.js","assets/I3SBinaryReader.f09861ac.js","assets/popupUtils.5174221c.js","assets/WhereClause.c0b1e923.js","assets/executionError.10e29c03.js","assets/I3SMeshView3D.a9aee39d.js","assets/I3SOverrides.43bac39f.js","assets/I3SNode.8380a4f6.js","assets/meshFeatureSet.54057ed0.js","assets/MeshGeoreferencedRelativeVertexSpace.a44e5587.js","assets/MeshLocalVertexSpace.33b046fb.js","assets/georeference.20930ae2.js","assets/External.3b5c14d5.js","assets/FeatureLayerView3D.69570ebc.js","assets/FeatureLayerViewBase3D.d9ff8f8b.js","assets/FeatureLikeLayerView3D.2804d5c7.js","assets/dehydratedFeatureComparison.d41240fc.js","assets/queryForSymbologySnapping.b7a5beb4.js","assets/elevationInfoUtils.d710f6c5.js","assets/hash.25af2a28.js","assets/Graphics3DObjectStates.1983c1d0.js","assets/optimizedFeatureQueryEngineAdapter.b17e3ee2.js","assets/centroid.66ea1f85.js","assets/PooledRBush.b9188fbe.js","assets/quickselect.b8e0afc3.js","assets/floorFilterUtils.2fa4f3da.js","assets/QueryEngine.f42b4b13.js","assets/normalizeUtils.54c24a4d.js","assets/normalizeUtilsCommon.87227ae2.js","assets/json.7bed7e43.js","assets/QueryEngineCapabilities.a6a6a20b.js","assets/utils.8873e24e.js","assets/generateRendererUtils.e8dfecdf.js","assets/FeatureStore.e774d369.js","assets/BoundsStore.13c0920f.js","assets/projectExtentUtils.4a1e869d.js","assets/LayerView3D.a0f4cfd4.js","assets/query.22cd43bf.js","assets/pbfQueryUtils.c4418ce7.js","assets/pbf.82c57b62.js","assets/EventedSet.2b4d6c27.js","assets/LayerView.948860d4.js","assets/RefreshableLayerView.93fee593.js","assets/SceneModification.98a0e780.js","assets/persistable.2f8a3a21.js","assets/resourceExtension.748c0ef1.js","assets/SceneLayerWorker.c8cc9b18.js","assets/I3SQueryFeatureStore.694338c7.js","assets/DefinitionExpressionSceneLayerView.017e13a9.js"]),csv:()=>ue(()=>import("./CSVLayerView3D.74430d1f.js"),["assets/CSVLayerView3D.74430d1f.js","assets/FeatureLayerViewBase3D.d9ff8f8b.js","assets/FeatureLikeLayerView3D.2804d5c7.js","assets/Query.e586665e.js","assets/dehydratedFeatureComparison.d41240fc.js","assets/queryForSymbologySnapping.b7a5beb4.js","assets/elevationInfoUtils.d710f6c5.js","assets/hash.25af2a28.js","assets/diffUtils.f0876598.js","assets/UniqueValueRenderer.0143139a.js","assets/ColorStop.f762bde8.js","assets/colorRamps.80cb140e.js","assets/Graphics3DObjectStates.1983c1d0.js","assets/jsonUtils.4745b876.js","assets/DictionaryLoader.90c8c47c.js","assets/FieldsIndex.09813895.js","assets/heatmapUtils.32e9a30b.js","assets/defaults.83793da7.js","assets/defaultsJSON.a416f32c.js","assets/optimizedFeatureQueryEngineAdapter.b17e3ee2.js","assets/centroid.66ea1f85.js","assets/PooledRBush.b9188fbe.js","assets/quickselect.b8e0afc3.js","assets/popupUtils.5174221c.js","assets/FeatureFilter.97dd33dd.js","assets/floorFilterUtils.2fa4f3da.js","assets/QueryEngine.f42b4b13.js","assets/normalizeUtils.54c24a4d.js","assets/normalizeUtilsCommon.87227ae2.js","assets/WhereClause.c0b1e923.js","assets/executionError.10e29c03.js","assets/json.7bed7e43.js","assets/QueryEngineCapabilities.a6a6a20b.js","assets/utils.8873e24e.js","assets/generateRendererUtils.e8dfecdf.js","assets/FeatureSet.97dc0f24.js","assets/FeatureStore.e774d369.js","assets/BoundsStore.13c0920f.js","assets/projectExtentUtils.4a1e869d.js","assets/LayerView3D.a0f4cfd4.js","assets/query.22cd43bf.js","assets/pbfQueryUtils.c4418ce7.js","assets/pbf.82c57b62.js","assets/queryZScale.2643e684.js","assets/EventedSet.2b4d6c27.js","assets/FeatureEffect.ee83c7e0.js","assets/jsonUtils.1c231e28.js","assets/LayerView.948860d4.js","assets/RefreshableLayerView.93fee593.js"]),dimension:()=>ue(()=>import("./DimensionLayerView3D.c7c66295.js"),["assets/DimensionLayerView3D.c7c66295.js","assets/LayerView3D.a0f4cfd4.js","assets/LayerView.948860d4.js"]),elevation:xY,feature:()=>ue(()=>import("./FeatureLayerView3D.69570ebc.js"),["assets/FeatureLayerView3D.69570ebc.js","assets/FeatureLayerViewBase3D.d9ff8f8b.js","assets/FeatureLikeLayerView3D.2804d5c7.js","assets/Query.e586665e.js","assets/dehydratedFeatureComparison.d41240fc.js","assets/queryForSymbologySnapping.b7a5beb4.js","assets/elevationInfoUtils.d710f6c5.js","assets/hash.25af2a28.js","assets/diffUtils.f0876598.js","assets/UniqueValueRenderer.0143139a.js","assets/ColorStop.f762bde8.js","assets/colorRamps.80cb140e.js","assets/Graphics3DObjectStates.1983c1d0.js","assets/jsonUtils.4745b876.js","assets/DictionaryLoader.90c8c47c.js","assets/FieldsIndex.09813895.js","assets/heatmapUtils.32e9a30b.js","assets/defaults.83793da7.js","assets/defaultsJSON.a416f32c.js","assets/optimizedFeatureQueryEngineAdapter.b17e3ee2.js","assets/centroid.66ea1f85.js","assets/PooledRBush.b9188fbe.js","assets/quickselect.b8e0afc3.js","assets/popupUtils.5174221c.js","assets/FeatureFilter.97dd33dd.js","assets/floorFilterUtils.2fa4f3da.js","assets/QueryEngine.f42b4b13.js","assets/normalizeUtils.54c24a4d.js","assets/normalizeUtilsCommon.87227ae2.js","assets/WhereClause.c0b1e923.js","assets/executionError.10e29c03.js","assets/json.7bed7e43.js","assets/QueryEngineCapabilities.a6a6a20b.js","assets/utils.8873e24e.js","assets/generateRendererUtils.e8dfecdf.js","assets/FeatureSet.97dc0f24.js","assets/FeatureStore.e774d369.js","assets/BoundsStore.13c0920f.js","assets/projectExtentUtils.4a1e869d.js","assets/LayerView3D.a0f4cfd4.js","assets/query.22cd43bf.js","assets/pbfQueryUtils.c4418ce7.js","assets/pbf.82c57b62.js","assets/queryZScale.2643e684.js","assets/EventedSet.2b4d6c27.js","assets/FeatureEffect.ee83c7e0.js","assets/jsonUtils.1c231e28.js","assets/LayerView.948860d4.js","assets/RefreshableLayerView.93fee593.js"]),geojson:()=>ue(()=>import("./GeoJSONLayerView3D.0e2fb0b1.js"),["assets/GeoJSONLayerView3D.0e2fb0b1.js","assets/FeatureLayerViewBase3D.d9ff8f8b.js","assets/FeatureLikeLayerView3D.2804d5c7.js","assets/Query.e586665e.js","assets/dehydratedFeatureComparison.d41240fc.js","assets/queryForSymbologySnapping.b7a5beb4.js","assets/elevationInfoUtils.d710f6c5.js","assets/hash.25af2a28.js","assets/diffUtils.f0876598.js","assets/UniqueValueRenderer.0143139a.js","assets/ColorStop.f762bde8.js","assets/colorRamps.80cb140e.js","assets/Graphics3DObjectStates.1983c1d0.js","assets/jsonUtils.4745b876.js","assets/DictionaryLoader.90c8c47c.js","assets/FieldsIndex.09813895.js","assets/heatmapUtils.32e9a30b.js","assets/defaults.83793da7.js","assets/defaultsJSON.a416f32c.js","assets/optimizedFeatureQueryEngineAdapter.b17e3ee2.js","assets/centroid.66ea1f85.js","assets/PooledRBush.b9188fbe.js","assets/quickselect.b8e0afc3.js","assets/popupUtils.5174221c.js","assets/FeatureFilter.97dd33dd.js","assets/floorFilterUtils.2fa4f3da.js","assets/QueryEngine.f42b4b13.js","assets/normalizeUtils.54c24a4d.js","assets/normalizeUtilsCommon.87227ae2.js","assets/WhereClause.c0b1e923.js","assets/executionError.10e29c03.js","assets/json.7bed7e43.js","assets/QueryEngineCapabilities.a6a6a20b.js","assets/utils.8873e24e.js","assets/generateRendererUtils.e8dfecdf.js","assets/FeatureSet.97dc0f24.js","assets/FeatureStore.e774d369.js","assets/BoundsStore.13c0920f.js","assets/projectExtentUtils.4a1e869d.js","assets/LayerView3D.a0f4cfd4.js","assets/query.22cd43bf.js","assets/pbfQueryUtils.c4418ce7.js","assets/pbf.82c57b62.js","assets/queryZScale.2643e684.js","assets/EventedSet.2b4d6c27.js","assets/FeatureEffect.ee83c7e0.js","assets/jsonUtils.1c231e28.js","assets/LayerView.948860d4.js","assets/RefreshableLayerView.93fee593.js"]),graphics:()=>ue(()=>import("./GraphicsLayerView3D.4c816e9b.js"),["assets/GraphicsLayerView3D.4c816e9b.js","assets/LayerView3D.a0f4cfd4.js","assets/queryForSymbologySnapping.b7a5beb4.js","assets/elevationInfoUtils.d710f6c5.js","assets/GraphicsProcessor.f6fb4329.js","assets/diffUtils.f0876598.js","assets/Query.e586665e.js","assets/Graphics3DObjectStates.1983c1d0.js","assets/UniqueValueRenderer.0143139a.js","assets/ColorStop.f762bde8.js","assets/colorRamps.80cb140e.js","assets/jsonUtils.4745b876.js","assets/DictionaryLoader.90c8c47c.js","assets/FieldsIndex.09813895.js","assets/heatmapUtils.32e9a30b.js","assets/defaults.83793da7.js","assets/defaultsJSON.a416f32c.js","assets/optimizedFeatureQueryEngineAdapter.b17e3ee2.js","assets/centroid.66ea1f85.js","assets/PooledRBush.b9188fbe.js","assets/quickselect.b8e0afc3.js","assets/popupUtils.5174221c.js","assets/projectExtentUtils.4a1e869d.js","assets/LayerView.948860d4.js"]),group:()=>ue(()=>import("./GroupLayerView.a4207f6c.js"),["assets/GroupLayerView.a4207f6c.js","assets/LayerView.948860d4.js"]),imagery:()=>ue(()=>import("./ImageryLayerView3D.a8c0ee23.js"),["assets/ImageryLayerView3D.a8c0ee23.js","assets/DynamicLayerView3D.50afe590.js","assets/LayerView3D.a0f4cfd4.js","assets/projectExtentUtils.4a1e869d.js","assets/ImageMaterial.1905961e.js","assets/LayerView.948860d4.js","assets/RefreshableLayerView.93fee593.js","assets/Query.e586665e.js","assets/popupUtils.5174221c.js"]),"integrated-mesh":()=>ue(()=>import("./IntegratedMeshLayerView3D.7bdca950.js"),["assets/IntegratedMeshLayerView3D.7bdca950.js","assets/I3SMeshView3D.a9aee39d.js","assets/I3SOverrides.43bac39f.js","assets/I3SNode.8380a4f6.js","assets/I3SUtil.1e24f8d3.js","assets/Query.e586665e.js","assets/I3SBinaryReader.f09861ac.js","assets/meshFeatureSet.54057ed0.js","assets/MeshGeoreferencedRelativeVertexSpace.a44e5587.js","assets/MeshLocalVertexSpace.33b046fb.js","assets/georeference.20930ae2.js","assets/External.3b5c14d5.js","assets/FeatureSet.97dc0f24.js","assets/FeatureLayerView3D.69570ebc.js","assets/FeatureLayerViewBase3D.d9ff8f8b.js","assets/FeatureLikeLayerView3D.2804d5c7.js","assets/dehydratedFeatureComparison.d41240fc.js","assets/queryForSymbologySnapping.b7a5beb4.js","assets/elevationInfoUtils.d710f6c5.js","assets/hash.25af2a28.js","assets/diffUtils.f0876598.js","assets/UniqueValueRenderer.0143139a.js","assets/ColorStop.f762bde8.js","assets/colorRamps.80cb140e.js","assets/Graphics3DObjectStates.1983c1d0.js","assets/jsonUtils.4745b876.js","assets/DictionaryLoader.90c8c47c.js","assets/FieldsIndex.09813895.js","assets/heatmapUtils.32e9a30b.js","assets/defaults.83793da7.js","assets/defaultsJSON.a416f32c.js","assets/optimizedFeatureQueryEngineAdapter.b17e3ee2.js","assets/centroid.66ea1f85.js","assets/PooledRBush.b9188fbe.js","assets/quickselect.b8e0afc3.js","assets/popupUtils.5174221c.js","assets/FeatureFilter.97dd33dd.js","assets/floorFilterUtils.2fa4f3da.js","assets/QueryEngine.f42b4b13.js","assets/normalizeUtils.54c24a4d.js","assets/normalizeUtilsCommon.87227ae2.js","assets/WhereClause.c0b1e923.js","assets/executionError.10e29c03.js","assets/json.7bed7e43.js","assets/QueryEngineCapabilities.a6a6a20b.js","assets/utils.8873e24e.js","assets/generateRendererUtils.e8dfecdf.js","assets/FeatureStore.e774d369.js","assets/BoundsStore.13c0920f.js","assets/projectExtentUtils.4a1e869d.js","assets/LayerView3D.a0f4cfd4.js","assets/query.22cd43bf.js","assets/pbfQueryUtils.c4418ce7.js","assets/pbf.82c57b62.js","assets/queryZScale.2643e684.js","assets/EventedSet.2b4d6c27.js","assets/FeatureEffect.ee83c7e0.js","assets/jsonUtils.1c231e28.js","assets/LayerView.948860d4.js","assets/RefreshableLayerView.93fee593.js","assets/SceneModification.98a0e780.js","assets/persistable.2f8a3a21.js","assets/resourceExtension.748c0ef1.js","assets/SceneLayerWorker.c8cc9b18.js"]),"line-of-sight":()=>ue(()=>import("./LineOfSightLayerView3D.e6b85c86.js"),["assets/LineOfSightLayerView3D.e6b85c86.js","assets/LayerView3D.a0f4cfd4.js","assets/LayerView.948860d4.js"]),"map-image":()=>ue(()=>import("./MapImageLayerView3D.fd55e8ef.js"),["assets/MapImageLayerView3D.fd55e8ef.js","assets/DynamicLayerView3D.50afe590.js","assets/LayerView3D.a0f4cfd4.js","assets/projectExtentUtils.4a1e869d.js","assets/ImageMaterial.1905961e.js","assets/LayerView.948860d4.js","assets/RefreshableLayerView.93fee593.js","assets/ExportImageParameters.2bba9d02.js","assets/sql.414b1952.js","assets/floorFilterUtils.2fa4f3da.js","assets/sublayerUtils.e7f91234.js","assets/MapServiceLayerViewHelper.8a01bf5c.js","assets/normalizeUtils.54c24a4d.js","assets/normalizeUtilsCommon.87227ae2.js","assets/popupUtils.5174221c.js","assets/drapedUtils.603ce2e5.js"]),media:()=>ue(()=>import("./MediaLayerView3D.7393ef5b.js"),["assets/MediaLayerView3D.7393ef5b.js","assets/MediaElementView.27349382.js","assets/normalizeUtilsSync.ade119bb.js","assets/normalizeUtilsCommon.87227ae2.js","assets/LayerView3D.a0f4cfd4.js","assets/ImageMaterial.1905961e.js","assets/LayerView.948860d4.js"]),"ogc-feature":()=>ue(()=>import("./OGCFeatureLayerView3D.a7b50ee0.js"),["assets/OGCFeatureLayerView3D.a7b50ee0.js","assets/FeatureLayerViewBase3D.d9ff8f8b.js","assets/FeatureLikeLayerView3D.2804d5c7.js","assets/Query.e586665e.js","assets/dehydratedFeatureComparison.d41240fc.js","assets/queryForSymbologySnapping.b7a5beb4.js","assets/elevationInfoUtils.d710f6c5.js","assets/hash.25af2a28.js","assets/diffUtils.f0876598.js","assets/UniqueValueRenderer.0143139a.js","assets/ColorStop.f762bde8.js","assets/colorRamps.80cb140e.js","assets/Graphics3DObjectStates.1983c1d0.js","assets/jsonUtils.4745b876.js","assets/DictionaryLoader.90c8c47c.js","assets/FieldsIndex.09813895.js","assets/heatmapUtils.32e9a30b.js","assets/defaults.83793da7.js","assets/defaultsJSON.a416f32c.js","assets/optimizedFeatureQueryEngineAdapter.b17e3ee2.js","assets/centroid.66ea1f85.js","assets/PooledRBush.b9188fbe.js","assets/quickselect.b8e0afc3.js","assets/popupUtils.5174221c.js","assets/FeatureFilter.97dd33dd.js","assets/floorFilterUtils.2fa4f3da.js","assets/QueryEngine.f42b4b13.js","assets/normalizeUtils.54c24a4d.js","assets/normalizeUtilsCommon.87227ae2.js","assets/WhereClause.c0b1e923.js","assets/executionError.10e29c03.js","assets/json.7bed7e43.js","assets/QueryEngineCapabilities.a6a6a20b.js","assets/utils.8873e24e.js","assets/generateRendererUtils.e8dfecdf.js","assets/FeatureSet.97dc0f24.js","assets/FeatureStore.e774d369.js","assets/BoundsStore.13c0920f.js","assets/projectExtentUtils.4a1e869d.js","assets/LayerView3D.a0f4cfd4.js","assets/query.22cd43bf.js","assets/pbfQueryUtils.c4418ce7.js","assets/pbf.82c57b62.js","assets/queryZScale.2643e684.js","assets/EventedSet.2b4d6c27.js","assets/FeatureEffect.ee83c7e0.js","assets/jsonUtils.1c231e28.js","assets/LayerView.948860d4.js","assets/RefreshableLayerView.93fee593.js"]),"open-street-map":K2,"oriented-imagery":()=>ue(()=>import("./FeatureLayerView3D.69570ebc.js"),["assets/FeatureLayerView3D.69570ebc.js","assets/FeatureLayerViewBase3D.d9ff8f8b.js","assets/FeatureLikeLayerView3D.2804d5c7.js","assets/Query.e586665e.js","assets/dehydratedFeatureComparison.d41240fc.js","assets/queryForSymbologySnapping.b7a5beb4.js","assets/elevationInfoUtils.d710f6c5.js","assets/hash.25af2a28.js","assets/diffUtils.f0876598.js","assets/UniqueValueRenderer.0143139a.js","assets/ColorStop.f762bde8.js","assets/colorRamps.80cb140e.js","assets/Graphics3DObjectStates.1983c1d0.js","assets/jsonUtils.4745b876.js","assets/DictionaryLoader.90c8c47c.js","assets/FieldsIndex.09813895.js","assets/heatmapUtils.32e9a30b.js","assets/defaults.83793da7.js","assets/defaultsJSON.a416f32c.js","assets/optimizedFeatureQueryEngineAdapter.b17e3ee2.js","assets/centroid.66ea1f85.js","assets/PooledRBush.b9188fbe.js","assets/quickselect.b8e0afc3.js","assets/popupUtils.5174221c.js","assets/FeatureFilter.97dd33dd.js","assets/floorFilterUtils.2fa4f3da.js","assets/QueryEngine.f42b4b13.js","assets/normalizeUtils.54c24a4d.js","assets/normalizeUtilsCommon.87227ae2.js","assets/WhereClause.c0b1e923.js","assets/executionError.10e29c03.js","assets/json.7bed7e43.js","assets/QueryEngineCapabilities.a6a6a20b.js","assets/utils.8873e24e.js","assets/generateRendererUtils.e8dfecdf.js","assets/FeatureSet.97dc0f24.js","assets/FeatureStore.e774d369.js","assets/BoundsStore.13c0920f.js","assets/projectExtentUtils.4a1e869d.js","assets/LayerView3D.a0f4cfd4.js","assets/query.22cd43bf.js","assets/pbfQueryUtils.c4418ce7.js","assets/pbf.82c57b62.js","assets/queryZScale.2643e684.js","assets/EventedSet.2b4d6c27.js","assets/FeatureEffect.ee83c7e0.js","assets/jsonUtils.1c231e28.js","assets/LayerView.948860d4.js","assets/RefreshableLayerView.93fee593.js"]),"point-cloud":()=>ue(()=>import("./PointCloudLayerView3D.abce3983.js").then(function(e){return e.P}),["assets/PointCloudLayerView3D.abce3983.js","assets/LayerView3D.a0f4cfd4.js","assets/I3SUtil.1e24f8d3.js","assets/Query.e586665e.js","assets/I3SBinaryReader.f09861ac.js","assets/PointCloudWorkerUtil.6fb4a2d3.js","assets/PointCloudUniqueValueRenderer.6a8e22b5.js","assets/ColorStop.f762bde8.js","assets/PopupSceneLayerView.fa35fe28.js","assets/popupUtils.5174221c.js","assets/LayerView.948860d4.js"]),voxel:()=>ue(()=>import("./VoxelLayerView3D.a7066218.js"),["assets/VoxelLayerView3D.a7066218.js","assets/LayerView3D.a0f4cfd4.js","assets/PopupSceneLayerView.fa35fe28.js","assets/popupUtils.5174221c.js","assets/LayerView.948860d4.js"]),route:()=>ue(()=>import("./RouteLayerView3D.7f41d35b.js"),["assets/RouteLayerView3D.7f41d35b.js","assets/Stop.2d111546.js","assets/LayerView3D.a0f4cfd4.js","assets/GraphicsProcessor.f6fb4329.js","assets/diffUtils.f0876598.js","assets/Query.e586665e.js","assets/Graphics3DObjectStates.1983c1d0.js","assets/UniqueValueRenderer.0143139a.js","assets/ColorStop.f762bde8.js","assets/colorRamps.80cb140e.js","assets/jsonUtils.4745b876.js","assets/DictionaryLoader.90c8c47c.js","assets/FieldsIndex.09813895.js","assets/heatmapUtils.32e9a30b.js","assets/defaults.83793da7.js","assets/defaultsJSON.a416f32c.js","assets/optimizedFeatureQueryEngineAdapter.b17e3ee2.js","assets/centroid.66ea1f85.js","assets/PooledRBush.b9188fbe.js","assets/quickselect.b8e0afc3.js","assets/popupUtils.5174221c.js","assets/projectExtentUtils.4a1e869d.js","assets/EventedSet.2b4d6c27.js","assets/LayerView.948860d4.js"]),scene:e=>e.profile==null||e.profile==="mesh-pyramids"?ue(()=>import("./SceneLayerView3D.b374fa28.js"),["assets/SceneLayerView3D.b374fa28.js","assets/I3SOverrides.43bac39f.js","assets/I3SNode.8380a4f6.js","assets/I3SUtil.1e24f8d3.js","assets/Query.e586665e.js","assets/I3SBinaryReader.f09861ac.js","assets/meshFeatureSet.54057ed0.js","assets/MeshGeoreferencedRelativeVertexSpace.a44e5587.js","assets/MeshLocalVertexSpace.33b046fb.js","assets/georeference.20930ae2.js","assets/External.3b5c14d5.js","assets/FeatureSet.97dc0f24.js","assets/FeatureLayerView3D.69570ebc.js","assets/FeatureLayerViewBase3D.d9ff8f8b.js","assets/FeatureLikeLayerView3D.2804d5c7.js","assets/dehydratedFeatureComparison.d41240fc.js","assets/queryForSymbologySnapping.b7a5beb4.js","assets/elevationInfoUtils.d710f6c5.js","assets/hash.25af2a28.js","assets/diffUtils.f0876598.js","assets/UniqueValueRenderer.0143139a.js","assets/ColorStop.f762bde8.js","assets/colorRamps.80cb140e.js","assets/Graphics3DObjectStates.1983c1d0.js","assets/jsonUtils.4745b876.js","assets/DictionaryLoader.90c8c47c.js","assets/FieldsIndex.09813895.js","assets/heatmapUtils.32e9a30b.js","assets/defaults.83793da7.js","assets/defaultsJSON.a416f32c.js","assets/optimizedFeatureQueryEngineAdapter.b17e3ee2.js","assets/centroid.66ea1f85.js","assets/PooledRBush.b9188fbe.js","assets/quickselect.b8e0afc3.js","assets/popupUtils.5174221c.js","assets/FeatureFilter.97dd33dd.js","assets/floorFilterUtils.2fa4f3da.js","assets/QueryEngine.f42b4b13.js","assets/normalizeUtils.54c24a4d.js","assets/normalizeUtilsCommon.87227ae2.js","assets/WhereClause.c0b1e923.js","assets/executionError.10e29c03.js","assets/json.7bed7e43.js","assets/QueryEngineCapabilities.a6a6a20b.js","assets/utils.8873e24e.js","assets/generateRendererUtils.e8dfecdf.js","assets/FeatureStore.e774d369.js","assets/BoundsStore.13c0920f.js","assets/projectExtentUtils.4a1e869d.js","assets/LayerView3D.a0f4cfd4.js","assets/query.22cd43bf.js","assets/pbfQueryUtils.c4418ce7.js","assets/pbf.82c57b62.js","assets/queryZScale.2643e684.js","assets/EventedSet.2b4d6c27.js","assets/FeatureEffect.ee83c7e0.js","assets/jsonUtils.1c231e28.js","assets/LayerView.948860d4.js","assets/RefreshableLayerView.93fee593.js","assets/I3SMeshView3D.a9aee39d.js","assets/SceneModification.98a0e780.js","assets/persistable.2f8a3a21.js","assets/resourceExtension.748c0ef1.js","assets/SceneLayerWorker.c8cc9b18.js","assets/SceneLayerView.6afab672.js","assets/DefinitionExpressionSceneLayerView.017e13a9.js","assets/I3SQueryFeatureStore.694338c7.js","assets/PopupSceneLayerView.fa35fe28.js"]):ue(()=>import("./SceneLayerGraphicsView3D.ff7daabb.js"),["assets/SceneLayerGraphicsView3D.ff7daabb.js","assets/I3SOverrides.43bac39f.js","assets/I3SNode.8380a4f6.js","assets/I3SUtil.1e24f8d3.js","assets/Query.e586665e.js","assets/I3SBinaryReader.f09861ac.js","assets/meshFeatureSet.54057ed0.js","assets/MeshGeoreferencedRelativeVertexSpace.a44e5587.js","assets/MeshLocalVertexSpace.33b046fb.js","assets/georeference.20930ae2.js","assets/External.3b5c14d5.js","assets/FeatureSet.97dc0f24.js","assets/FeatureLayerView3D.69570ebc.js","assets/FeatureLayerViewBase3D.d9ff8f8b.js","assets/FeatureLikeLayerView3D.2804d5c7.js","assets/dehydratedFeatureComparison.d41240fc.js","assets/queryForSymbologySnapping.b7a5beb4.js","assets/elevationInfoUtils.d710f6c5.js","assets/hash.25af2a28.js","assets/diffUtils.f0876598.js","assets/UniqueValueRenderer.0143139a.js","assets/ColorStop.f762bde8.js","assets/colorRamps.80cb140e.js","assets/Graphics3DObjectStates.1983c1d0.js","assets/jsonUtils.4745b876.js","assets/DictionaryLoader.90c8c47c.js","assets/FieldsIndex.09813895.js","assets/heatmapUtils.32e9a30b.js","assets/defaults.83793da7.js","assets/defaultsJSON.a416f32c.js","assets/optimizedFeatureQueryEngineAdapter.b17e3ee2.js","assets/centroid.66ea1f85.js","assets/PooledRBush.b9188fbe.js","assets/quickselect.b8e0afc3.js","assets/popupUtils.5174221c.js","assets/FeatureFilter.97dd33dd.js","assets/floorFilterUtils.2fa4f3da.js","assets/QueryEngine.f42b4b13.js","assets/normalizeUtils.54c24a4d.js","assets/normalizeUtilsCommon.87227ae2.js","assets/WhereClause.c0b1e923.js","assets/executionError.10e29c03.js","assets/json.7bed7e43.js","assets/QueryEngineCapabilities.a6a6a20b.js","assets/utils.8873e24e.js","assets/generateRendererUtils.e8dfecdf.js","assets/FeatureStore.e774d369.js","assets/BoundsStore.13c0920f.js","assets/projectExtentUtils.4a1e869d.js","assets/LayerView3D.a0f4cfd4.js","assets/query.22cd43bf.js","assets/pbfQueryUtils.c4418ce7.js","assets/pbf.82c57b62.js","assets/queryZScale.2643e684.js","assets/EventedSet.2b4d6c27.js","assets/FeatureEffect.ee83c7e0.js","assets/jsonUtils.1c231e28.js","assets/LayerView.948860d4.js","assets/RefreshableLayerView.93fee593.js","assets/SceneLayerView.6afab672.js","assets/DefinitionExpressionSceneLayerView.017e13a9.js","assets/PopupSceneLayerView.fa35fe28.js"]),stream:()=>ue(()=>import("./StreamLayerView3D.b65380b3.js"),["assets/StreamLayerView3D.b65380b3.js","assets/StreamFeatureManager.ae72b5b8.js","assets/createConnection.6a562f88.js","assets/query.22cd43bf.js","assets/normalizeUtils.54c24a4d.js","assets/normalizeUtilsCommon.87227ae2.js","assets/pbfQueryUtils.c4418ce7.js","assets/pbf.82c57b62.js","assets/queryZScale.2643e684.js","assets/Query.e586665e.js","assets/EventedSet.2b4d6c27.js","assets/FeatureLikeLayerView3D.2804d5c7.js","assets/dehydratedFeatureComparison.d41240fc.js","assets/queryForSymbologySnapping.b7a5beb4.js","assets/elevationInfoUtils.d710f6c5.js","assets/hash.25af2a28.js","assets/diffUtils.f0876598.js","assets/UniqueValueRenderer.0143139a.js","assets/ColorStop.f762bde8.js","assets/colorRamps.80cb140e.js","assets/Graphics3DObjectStates.1983c1d0.js","assets/jsonUtils.4745b876.js","assets/DictionaryLoader.90c8c47c.js","assets/FieldsIndex.09813895.js","assets/heatmapUtils.32e9a30b.js","assets/defaults.83793da7.js","assets/defaultsJSON.a416f32c.js","assets/optimizedFeatureQueryEngineAdapter.b17e3ee2.js","assets/centroid.66ea1f85.js","assets/PooledRBush.b9188fbe.js","assets/quickselect.b8e0afc3.js","assets/popupUtils.5174221c.js","assets/FeatureFilter.97dd33dd.js","assets/floorFilterUtils.2fa4f3da.js","assets/QueryEngine.f42b4b13.js","assets/WhereClause.c0b1e923.js","assets/executionError.10e29c03.js","assets/json.7bed7e43.js","assets/QueryEngineCapabilities.a6a6a20b.js","assets/utils.8873e24e.js","assets/generateRendererUtils.e8dfecdf.js","assets/FeatureSet.97dc0f24.js","assets/FeatureStore.e774d369.js","assets/BoundsStore.13c0920f.js","assets/projectExtentUtils.4a1e869d.js","assets/LayerView3D.a0f4cfd4.js","assets/LayerView.948860d4.js"]),tile:K2,"imagery-tile":()=>ue(()=>import("./ImageryTileLayerView3D.8626e11e.js"),["assets/ImageryTileLayerView3D.8626e11e.js","assets/LayerView3D.a0f4cfd4.js","assets/TiledLayerView3D.a907660c.js","assets/rasterProjectionHelper.b292b8c5.js","assets/popupUtils.5174221c.js","assets/LayerView.948860d4.js","assets/RefreshableLayerView.93fee593.js","assets/drapedUtils.603ce2e5.js"]),"vector-tile":()=>ue(()=>import("./VectorTileLayerView3D.a58f792a.js"),["assets/VectorTileLayerView3D.a58f792a.js","assets/Rect.5473b346.js","assets/pbf.82c57b62.js","assets/rasterizingUtils.53560362.js","assets/TileInfoView.86066260.js","assets/definitions.c3f2bf92.js","assets/number.bbe84298.js","assets/GeometryUtils.020b8d8a.js","assets/StyleRepository.06b2d88d.js","assets/colorUtils.307b1728.js","assets/TileClipper.f7503fb7.js","assets/LayerView3D.a0f4cfd4.js","assets/TiledLayerView3D.a907660c.js","assets/LayerView.948860d4.js"]),wcs:()=>ue(()=>import("./ImageryTileLayerView3D.8626e11e.js"),["assets/ImageryTileLayerView3D.8626e11e.js","assets/LayerView3D.a0f4cfd4.js","assets/TiledLayerView3D.a907660c.js","assets/rasterProjectionHelper.b292b8c5.js","assets/popupUtils.5174221c.js","assets/LayerView.948860d4.js","assets/RefreshableLayerView.93fee593.js","assets/drapedUtils.603ce2e5.js"]),"web-tile":K2,wfs:()=>ue(()=>import("./WFSLayerView3D.08a046a2.js"),["assets/WFSLayerView3D.08a046a2.js","assets/FeatureLayerViewBase3D.d9ff8f8b.js","assets/FeatureLikeLayerView3D.2804d5c7.js","assets/Query.e586665e.js","assets/dehydratedFeatureComparison.d41240fc.js","assets/queryForSymbologySnapping.b7a5beb4.js","assets/elevationInfoUtils.d710f6c5.js","assets/hash.25af2a28.js","assets/diffUtils.f0876598.js","assets/UniqueValueRenderer.0143139a.js","assets/ColorStop.f762bde8.js","assets/colorRamps.80cb140e.js","assets/Graphics3DObjectStates.1983c1d0.js","assets/jsonUtils.4745b876.js","assets/DictionaryLoader.90c8c47c.js","assets/FieldsIndex.09813895.js","assets/heatmapUtils.32e9a30b.js","assets/defaults.83793da7.js","assets/defaultsJSON.a416f32c.js","assets/optimizedFeatureQueryEngineAdapter.b17e3ee2.js","assets/centroid.66ea1f85.js","assets/PooledRBush.b9188fbe.js","assets/quickselect.b8e0afc3.js","assets/popupUtils.5174221c.js","assets/FeatureFilter.97dd33dd.js","assets/floorFilterUtils.2fa4f3da.js","assets/QueryEngine.f42b4b13.js","assets/normalizeUtils.54c24a4d.js","assets/normalizeUtilsCommon.87227ae2.js","assets/WhereClause.c0b1e923.js","assets/executionError.10e29c03.js","assets/json.7bed7e43.js","assets/QueryEngineCapabilities.a6a6a20b.js","assets/utils.8873e24e.js","assets/generateRendererUtils.e8dfecdf.js","assets/FeatureSet.97dc0f24.js","assets/FeatureStore.e774d369.js","assets/BoundsStore.13c0920f.js","assets/projectExtentUtils.4a1e869d.js","assets/LayerView3D.a0f4cfd4.js","assets/query.22cd43bf.js","assets/pbfQueryUtils.c4418ce7.js","assets/pbf.82c57b62.js","assets/queryZScale.2643e684.js","assets/EventedSet.2b4d6c27.js","assets/FeatureEffect.ee83c7e0.js","assets/jsonUtils.1c231e28.js","assets/LayerView.948860d4.js","assets/RefreshableLayerView.93fee593.js"]),wms:()=>ue(()=>import("./WMSLayerView3D.726d0b71.js"),["assets/WMSLayerView3D.726d0b71.js","assets/DynamicLayerView3D.50afe590.js","assets/LayerView3D.a0f4cfd4.js","assets/projectExtentUtils.4a1e869d.js","assets/ImageMaterial.1905961e.js","assets/LayerView.948860d4.js","assets/RefreshableLayerView.93fee593.js","assets/ExportWMSImageParameters.9c26dc43.js"]),wmts:()=>ue(()=>import("./WMTSLayerView3D.7424f70c.js"),["assets/WMTSLayerView3D.7424f70c.js","assets/LayerView3D.a0f4cfd4.js","assets/TiledLayerView3D.a907660c.js","assets/LayerView.948860d4.js","assets/RefreshableLayerView.93fee593.js"]),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function JNe(e){const t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",r=t.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new G(`${r}:view-not-supported`,`${t} is not supported in 3D`)}const SY={hasLayerViewModule:e=>TY[e.type]!=null,importLayerView:e=>{const t=TY[e.type];if(t==null)throw JNe(e);return t(e)}},EY="analyses-owner-handles";var lx,mv;(function(e){e[e.PENDING=0]="PENDING",e[e.CREATED=1]="CREATED"})(lx||(lx={})),function(e){e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED"}(mv||(mv={}));let j_=class extends gA{constructor(e){super(e),this._allAnalysisViews=new Pt,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=CY(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(Cr("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(Cr()),this._attachedToViewResolver=CY()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const t=this._items.get(e);if(t==null||t.state.list===mv.REMOVED)throw new G("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return t.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),EY)}_disconnectOwners(){this.handles.remove(EY),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const i of e)this._addAnalysis(i);const t=e.on("after-add",i=>this._addAnalysis(i.item)),r=e.on("after-remove",i=>this._removeAnalysis(i.item));return{remove:()=>{t.remove(),r.remove();for(const i of e)this._removeAnalysis(i)}}}_addAnalysis(e){const t=this._items.get(e);if(t==null){const r={state:{view:lx.PENDING,list:mv.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,r),r.createAnalysisViewTask=v2(i=>this._createAnalysisViewPromise(r,i))}else t.state.list=mv.ADDED}_removeAnalysis(e){const t=this._items.get(e);t!=null?(t.state.list=mv.REMOVED,this._scheduleUpdate()):K.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=w3(()=>this._update()))}_update(){this._scheduledUpdateHandle=xi(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===mv.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case lx.PENDING:e.createAnalysisViewTask=$c(e.createAnalysisViewTask);break;case lx.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=Re(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,t){const r=e.analysis,i=r.type,s=this._analysisModules[i];if(this._creatingViewCount+=1,s.module==null)try{s.module=await this._loadAnalysisModule(i)}catch(o){throw this._creatingViewCount-=1,o}if(Hs(t))throw this._creatingViewCount-=1,Cr("AnalysisView creation aborted");const n=new s.module.default({analysis:r,view:this.view});try{await n.when()}catch(o){throw this._creatingViewCount-=1,o}if(Hs(t))throw this._creatingViewCount-=1,n.destroy(),Cr("AnalysisView creation aborted");return e.view=n,e.state.view=lx.CREATED,this._allAnalysisViews.add(n),this._creatingViewCount-=1,n}_loadAnalysisModule(e){switch(e){case"area-measurement":return ue(()=>import("./AreaMeasurementAnalysisView3D.a01a2335.js").then(function(t){return t.A}),["assets/AreaMeasurementAnalysisView3D.a01a2335.js","assets/UnitNormalizer.47c41d5d.js","assets/Segment.b33fc9b3.js","assets/unitFormatUtils.42a6eb3a.js","assets/LineVisualElement.0ee7ffd4.js","assets/elevationInfoUtils.d710f6c5.js","assets/geometryEngine.d168d102.js","assets/geometryEngineBase.d1b13217.js","assets/hydrated.f8dda357.js","assets/EditGeometryOperations.3139b272.js"]);case"dimension":return ue(()=>import("./DimensionAnalysisView3D.6fd62f7c.js").then(function(t){return t.D}),["assets/DimensionAnalysisView3D.6fd62f7c.js","assets/LineVisualElement.0ee7ffd4.js","assets/LengthDimension.4b10a477.js","assets/Segment.b33fc9b3.js","assets/unitFormatUtils.42a6eb3a.js","assets/elevationInfoUtils.d710f6c5.js","assets/analysisViewUtils.8aae6db1.js","assets/ImageMaterial.1905961e.js","assets/Factory.312f3b3e.js","assets/RightAngleQuadVisualElement.408eff27.js","assets/VisualElementResources.f6c3d94a.js","assets/PointVisualElement.eb5b4fbb.js","assets/EditGeometryOperations.3139b272.js","assets/dehydratedFeatureComparison.d41240fc.js"]);case"direct-line-measurement":return ue(()=>import("./DirectLineMeasurementAnalysisView3D.df47d119.js").then(function(t){return t.D}),["assets/DirectLineMeasurementAnalysisView3D.df47d119.js","assets/UnitNormalizer.47c41d5d.js","assets/Segment.b33fc9b3.js","assets/unitFormatUtils.42a6eb3a.js","assets/LineVisualElement.0ee7ffd4.js","assets/elevationInfoUtils.d710f6c5.js","assets/geometryEngine.d168d102.js","assets/geometryEngineBase.d1b13217.js","assets/hydrated.f8dda357.js","assets/RightAngleQuadVisualElement.408eff27.js","assets/VisualElementResources.f6c3d94a.js"]);case"line-of-sight":return ue(()=>import("./LineOfSightAnalysisView3D.0604185c.js"),["assets/LineOfSightAnalysisView3D.0604185c.js","assets/LineVisualElement.0ee7ffd4.js","assets/LineOfSightAnalysisTarget.d578021c.js","assets/persistable.2f8a3a21.js","assets/resourceExtension.748c0ef1.js","assets/elevationInfoUtils.d710f6c5.js","assets/analysisViewUtils.8aae6db1.js","assets/ImageMaterial.1905961e.js","assets/PointVisualElement.eb5b4fbb.js","assets/VisualElementResources.f6c3d94a.js"]);case"slice":return ue(()=>import("./SliceAnalysisView3D.dd811789.js").then(function(t){return t.S}),["assets/SliceAnalysisView3D.dd811789.js","assets/LineVisualElement.0ee7ffd4.js","assets/persistable.2f8a3a21.js","assets/resourceExtension.748c0ef1.js","assets/BuildingComponentSublayer.2fceafa3.js","assets/UniqueValueRenderer.0143139a.js","assets/ColorStop.f762bde8.js","assets/diffUtils.f0876598.js","assets/colorRamps.80cb140e.js","assets/jsonUtils.4745b876.js","assets/DictionaryLoader.90c8c47c.js","assets/FieldsIndex.09813895.js","assets/heatmapUtils.32e9a30b.js","assets/FeatureLayer.6ea98f03.js","assets/sql.414b1952.js","assets/FeatureLayerBase.07ef7e55.js","assets/featureLayerUtils.0566dc37.js","assets/AttachmentQuery.c430db32.js","assets/Query.e586665e.js","assets/RelationshipQuery.60e2b826.js","assets/serviceCapabilitiesUtils.c358c66d.js","assets/editsZScale.58b9a03e.js","assets/queryZScale.2643e684.js","assets/FeatureSet.97dc0f24.js","assets/APIKeyMixin.605900a3.js","assets/ArcGISService.116191b2.js","assets/BlendLayer.eacc4944.js","assets/jsonUtils.1c231e28.js","assets/CustomParametersMixin.244652a9.js","assets/EditBusLayer.3831f0f2.js","assets/FeatureEffectLayer.a9b039ed.js","assets/FeatureEffect.ee83c7e0.js","assets/FeatureFilter.97dd33dd.js","assets/FeatureReductionLayer.9f7296a1.js","assets/LabelClass.1c6b8047.js","assets/defaults.83793da7.js","assets/defaultsJSON.a416f32c.js","assets/OrderedLayer.bbc75e49.js","assets/PortalLayer.9c2e677f.js","assets/portalItemUtils.ea6f2bf4.js","assets/ScaleRangeLayer.1a5bb9a6.js","assets/TemporalLayer.5874b62b.js","assets/FeatureTemplate.c7eaa370.js","assets/FeatureType.4659b5f1.js","assets/fieldProperties.174d0f24.js","assets/labelingInfo.990e68e3.js","assets/versionUtils.05c8a355.js","assets/styleUtils.a985c9a8.js","assets/TopFeaturesQuery.165d1927.js","assets/popupUtils.f5ffced0.js","assets/capabilities.e8ada26d.js","assets/I3SIndexInfo.9cdb77bc.js","assets/I3SLayerDefinitions.0628cd13.js","assets/I3SUtil.1e24f8d3.js","assets/I3SBinaryReader.f09861ac.js","assets/popupUtils.5174221c.js","assets/analysisViewUtils.8aae6db1.js","assets/ImageMaterial.1905961e.js","assets/Factory.312f3b3e.js"])}}};function CY(){const e=Ys();return e.promise.catch(()=>{}),e}h([f()],j_.prototype,"updating",null),h([f({constructOnly:!0})],j_.prototype,"view",void 0),h([f()],j_.prototype,"_allAnalysisViews",void 0),h([f()],j_.prototype,"_creatingViewCount",void 0),j_=h([F("esri.views.3d.analysis.AnalysisViewManager3D")],j_);const KNe=j_;let jf=class extends xe{constructor(e){super(e),this.collision=new wE,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===Ie.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Ie.Local?this._set("altitude",e):K.getLogger(this).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?fe(e,this.altitude.min,this.altitude.max):e}clampTilt(e,t){if(!this.tilt)return t;const r=this.tilt(e);return fe(t,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Ie.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(t,r=EF)=>(r.min=go.min,r.max=e,r)}_createDefaultTiltLocal(){const e=this.collision.enabled?qM([[4e3,go.max],[1e4,Ot(88)],[6e6,Ot(88)]]):()=>go.max;return(t,r=EF)=>(r.min=go.min,r.max=e(t),r)}_createDefaultTiltGlobal(){const e=this.collision.enabled?qM([[4e3,go.max],[5e4,Ot(88)],[6e6,Ot(88)],[2e7,go.min]]):qM([[3e5,go.max],[3e6,Ot(88)],[6e6,Ot(88)],[2e7,go.min]]);return(t,r=EF)=>(r.min=go.min,r.max=e(t),r)}};function QNe(e){return{min:-2e5,max:4*e.radius}}h([f()],jf.prototype,"altitude",null),h([f({readOnly:!0})],jf.prototype,"collision",void 0),h([f()],jf.prototype,"distance",void 0),h([f({readOnly:!0})],jf.prototype,"minimumPoiDistance",void 0),h([f()],jf.prototype,"tilt",void 0),h([f({constructOnly:!0})],jf.prototype,"mode",void 0),jf=h([F("esri.views.3d.state.Constraints")],jf);const AY=QNe(Kt),go={min:Ot(.5),max:Ot(179.5)},EF={min:0,max:0};let wE=class extends xe{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};h([f({type:Boolean})],wE.prototype,"enabled",void 0),h([f({type:Number})],wE.prototype,"elevationMargin",void 0),wE=h([F("esri.views.3d.state.Constraints.CollisionConstraint")],wE);let cx=class extends xe{constructor(){super(...arguments),this.min=AY.min,this.max=AY.max}};h([f({type:Number})],cx.prototype,"min",void 0),h([f({type:Number})],cx.prototype,"max",void 0),cx=h([F("esri.views.3d.constraints.AltitudeConstraint")],cx);let Qf=class extends xe{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,t){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==t&&this._set("far",t))}};h([f({type:Number,value:1e-8})],Qf.prototype,"near",null),h([si("near")],Qf.prototype,"castNear",null),h([f({type:Number,value:1e-8})],Qf.prototype,"far",null),h([si("far")],Qf.prototype,"castFar",null),h([f({type:["auto","manual"]})],Qf.prototype,"mode",void 0),Qf=h([F("esri.views.3d.constraints.ClipDistanceConstraint")],Qf);const iz={min:xa(go.min),max:xa(go.max)};let gv=class extends xe{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return fe(e,iz.min,iz.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};h([f({type:["auto","manual"]})],gv.prototype,"mode",void 0),h([f({type:Number,value:iz.max})],gv.prototype,"max",null),h([si("max")],gv.prototype,"castMax",null),gv=h([F("esri.views.3d.constraints.TiltConstraint")],gv);let yv=class extends xe{constructor(){super(...arguments),this.tilt=new gv,this.altitude=new cx,this.clipDistance=new Qf}};h([f({type:gv})],yv.prototype,"tilt",void 0),h([f({type:cx})],yv.prototype,"altitude",void 0),h([f({type:Qf})],yv.prototype,"clipDistance",void 0),yv=h([F("esri.views.3d.constraints.Constraints")],yv);var sz;let cu=sz=class extends Pe{constructor(e){super(e),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,t){return t.datetime!=null&&new Date(t.datetime)||null}writeDate(e,t,r){t[r]=e.getTime()}readDirectShadowsEnabled(e,t){return!!t.directShadows}writedirectShadowsEnabled(e,t,r){e&&(t[r]=e)}writeDisplayUTCOffset(e,t){e!=null&&(t.displayUTCOffset=e)}clone(){return new sz(this.cloneConstructProperties())}cloneConstructProperties(){const e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(e.date=new Date(this.date.getTime())),e}};h([f({readOnly:!0,type:["sun"],json:{write:!0}})],cu.prototype,"type",void 0),h([f({type:Date,json:{type:Number,write:{target:"datetime"}}})],cu.prototype,"date",void 0),h([br("date",["datetime"])],cu.prototype,"readDate",null),h([Yt("date")],cu.prototype,"writeDate",null),h([f({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],cu.prototype,"directShadowsEnabled",void 0),h([br("directShadowsEnabled",["directShadows"])],cu.prototype,"readDirectShadowsEnabled",null),h([Yt("directShadowsEnabled")],cu.prototype,"writedirectShadowsEnabled",null),h([f({type:Number,json:{write:!0}})],cu.prototype,"displayUTCOffset",void 0),h([Yt("displayUTCOffset")],cu.prototype,"writeDisplayUTCOffset",null),cu=sz=h([F("esri.webscene.SunLighting")],cu);const w1=cu;var $w;const Ipe="esri.views.3d.environment.SunLighting",iR=K.getLogger(Ipe);let lp=$w=class extends cs.EventedMixin(w1){constructor(e){super(e),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const t=new Date().getFullYear(),r=new Date("March 15, "+t+" 12:00:00 UTC");this._set("defaultDate",r),this._set("date",r)}get ambientOcclusionEnabled(){return X0(iR,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(e){X0(iR,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",e)}get waterReflectionEnabled(){return X0(iR,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(e){X0(iR,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",e)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(e){return new $w(e.cloneConstructProperties())}set defaultDate(e){const t=this._get("date")===this._get("defaultDate");e=new Date(e.getTime()),this._set("defaultDate",e),t&&this._set("date",e)}set date(e){e!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(e.getTime())))}autoUpdate(e,t){const r=$w.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=t.hours,this.positionTimezoneInfo.minutes=t.minutes,this.positionTimezoneInfo.seconds=t.seconds;let i=null;e!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(e.getTime())?(i=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(i=this.date&&this.date.getTime(),this._set("date",new Date(e.getTime()))));const s=$w.calculateTimezoneOffset(this.positionTimezoneInfo);if(r!==s&&(sR.target=this,sR.timezoneOffset=s,this.emit("timezone-will-change",sR),sR.target=null),e!=null)return isNaN(e.getTime())||i!==e.getTime()}clone(){const e=this._get("date")===this._get("defaultDate"),t=new $w({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return e&&t._set("date",t._get("defaultDate")),t.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,t.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,t.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,t.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,t}cloneWithWebsceneLighting(e){const t=this.clone();return e.date!=null&&(t.date=e.date),t.directShadowsEnabled=e.directShadowsEnabled,t.displayUTCOffset=e.displayUTCOffset,t}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};h([f({type:Boolean})],lp.prototype,"cameraTrackingEnabled",void 0),h([f({type:Boolean})],lp.prototype,"ambientOcclusionEnabled",null),h([f({type:Boolean})],lp.prototype,"waterReflectionEnabled",null),h([f({type:Date})],lp.prototype,"defaultDate",null),h([f({type:Date})],lp.prototype,"date",null),lp=$w=h([F(Ipe)],lp),function(e){function t({hours:r,minutes:i,seconds:s}){return Math.round(r+i/60+s/3600)}e.calculateTimezoneOffset=t}(lp||(lp={}));const sR={target:null,timezoneOffset:0},h0=lp;var nz;let xE=nz=class extends Pe{constructor(e){super(e),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new nz(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};h([f({readOnly:!0,type:["virtual"],json:{write:!0}})],xE.prototype,"type",void 0),h([f({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],xE.prototype,"directShadowsEnabled",void 0),xE=nz=h([F("esri.webscene.VirtualLighting")],xE);const V3=xE;var QM;const $pe="esri.views.3d.environment.VirtualLighting",nR=K.getLogger($pe);let Lw=QM=class extends cs.EventedMixin(V3){constructor(e){super(e),this.cameraTrackingEnabled=!0}get ambientOcclusionEnabled(){return X0(nR,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(e){X0(nR,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",e)}get waterReflectionEnabled(){return X0(nR,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(e){X0(nR,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",e)}clone(){return new QM({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(e){return new QM(e.cloneConstructProperties())}cloneWithWebsceneLighting(e){const t=this.clone();return t.directShadowsEnabled=e.directShadowsEnabled,t}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};h([f({type:Boolean})],Lw.prototype,"ambientOcclusionEnabled",null),h([f({type:Boolean})],Lw.prototype,"waterReflectionEnabled",null),h([f({type:Boolean})],Lw.prototype,"cameraTrackingEnabled",void 0),Lw=QM=h([F($pe)],Lw);const TE=Lw,e4e={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:h0,virtual:TE}};var oz;let wC=oz=class extends xe{set quality(e){["low","high"].includes(e)&&this._set("quality",e)}clone(){return new oz({quality:this.quality})}};h([f({type:["low","high"],value:"low"})],wC.prototype,"quality",null),wC=oz=h([F("esri.views.3d.environment.SceneViewAtmosphere")],wC);var az;let SE=az=class extends Pe{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new az({cloudCover:this.cloudCover})}};h([Wt({sunny:"sunny"})],SE.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],SE.prototype,"cloudCover",void 0),SE=az=h([F("esri.views.3d.environment.SunnyWeather")],SE);const oL=SE;var lz;let EE=lz=class extends Pe{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new lz({cloudCover:this.cloudCover})}};h([Wt({cloudy:"cloudy"})],EE.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],EE.prototype,"cloudCover",void 0),EE=lz=h([F("esri.views.3d.environment.CloudyWeather")],EE);const t4e=EE;var cz;let CE=cz=class extends Pe{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new cz({fogStrength:this.fogStrength})}};h([Wt({foggy:"foggy"})],CE.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],CE.prototype,"fogStrength",void 0),CE=cz=h([F("esri.views.3d.environment.FoggyWeather")],CE);const r4e=CE;var uz;let Dw=uz=class extends Pe{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new uz({cloudCover:this.cloudCover,precipitation:this.precipitation})}};h([Wt({rainy:"rainy"})],Dw.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Dw.prototype,"cloudCover",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Dw.prototype,"precipitation",void 0),Dw=uz=h([F("esri.views.3d.environment.RainyWeather")],Dw);const i4e=Dw;var hz;let H_=hz=class extends Pe{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new hz({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};h([Wt({snowy:"snowy"})],H_.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],H_.prototype,"cloudCover",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],H_.prototype,"precipitation",void 0),h([f({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],H_.prototype,"snowCover",void 0),H_=hz=h([F("esri.views.3d.environment.SnowyWeather")],H_);const s4e=H_,tj={key:"type",base:oL,typeMap:{sunny:oL,cloudy:t4e,rainy:i4e,snowy:s4e,foggy:r4e}},n4e=Object.keys(tj.typeMap);function o4e(e,t){return!!n4e.includes(e)||(t.error(`"${e}" is not a valid weather type`),!1)}const bp=1e4,Lpe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:w1,virtual:V3}};let eI=class extends Pe{constructor(e){super(e)}clone(){}};h([f({readOnly:!0,json:{read:!1}})],eI.prototype,"type",void 0),eI=h([F("esri.webscene.background.Background")],eI);const Dpe=eI;var dz;const a4e={...Wm,nonNullable:!0};let AE=dz=class extends Dpe{constructor(e){super(e),this.type="color",this.color=new ot([0,0,0,1])}clone(){return new dz(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};h([Wt({color:"color"},{readOnly:!0})],AE.prototype,"type",void 0),h([f(a4e)],AE.prototype,"color",void 0),AE=dz=h([F("esri.webscene.background.ColorBackground")],AE);const Npe=AE,OY={base:Dpe,key:"type",typeMap:{color:Npe}};function l4e(e){return(t,r,i)=>{if(!t)return t;for(const s in e.typeMap)if(t.type===s){const n=new e.typeMap[s];return n.read(t,i),n}}}const c4e={types:OY,json:{read:l4e(OY),write:{overridePolicy:(e,t,r)=>({enabled:!r||!r.isPresentation})}}};var pz;const Fpe="esri.webscene.Environment",u4e=K.getLogger(Fpe),RY=(e,t,r)=>({enabled:!r||!r.isPresentation});let d0=pz=class extends Pe{constructor(e){super(e),this.lighting=new w1,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(e){o4e(e?.type,u4e)&&this._set("weather",e)}clone(){return new pz(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?V3.prototype.clone.call(this.lighting):w1.prototype.clone.call(this.lighting),background:ye(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};h([f({types:Lpe,nonNullable:!0,json:{write:!0}})],d0.prototype,"lighting",void 0),h([f(c4e)],d0.prototype,"background",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:RY}}})],d0.prototype,"atmosphereEnabled",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:RY}}})],d0.prototype,"starsEnabled",void 0),h([f({types:tj,nonNullable:!0,json:{write:!0},value:new oL})],d0.prototype,"weather",null),d0=pz=h([F(Fpe)],d0);const TT=d0;var OE;let Nw=OE=class extends TT{constructor(e){super(e),this.atmosphere=new wC,this.lighting=new h0,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(e){const t=e.cloneConstructProperties();return new OE({...t,lighting:t.lighting?t.lighting.type==="virtual"?TE.fromWebsceneLighting(t.lighting):h0.fromWebsceneLighting(t.lighting):void 0})}castLighting(e){return this._convertLighting(e)}applyLighting(e){this.lighting=this._convertLighting(e)}_convertLighting(e){return e?e instanceof h0||e instanceof TE?e:e instanceof w1?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(e):new h0({...e.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):e instanceof V3?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e):new TE({...e.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):cy(e4e,e):new h0}clone(){return new OE({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ye(this.background)})}cloneWithWebsceneEnvironment(e){return new OE({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ye(this.background),...e.cloneConstructProperties(),lighting:this._getLighting(e)})}_getLighting(e){switch(e.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(e.lighting):h0.fromWebsceneLighting(e.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e.lighting):TE.fromWebsceneLighting(e.lighting);default:return e.lighting,h0.fromWebsceneLighting(e.lighting)}}};h([f({type:wC,json:{read:!1},nonNullable:!0})],Nw.prototype,"atmosphere",void 0),h([f({nonNullable:!0})],Nw.prototype,"lighting",void 0),h([si("lighting")],Nw.prototype,"castLighting",null),Nw=OE=h([F("esri.views.3d.environment.SceneViewEnvironment")],Nw);const Fw=Nw;var Do;(function(e){e[e.Realistic=0]="Realistic",e[e.Local=1]="Local",e[e.Mars=2]="Mars",e[e.None=3]="None"})(Do||(Do={}));function en(e,t){return e[0]=t[0],e[1]=t[1],e}function Qt(e,t,r){return e[0]=t,e[1]=r,e}function Hh(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function Ap(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function rj(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function Upe(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function h4e(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function d4e(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function p4e(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function f4e(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function m4e(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function Pl(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function g4e(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e}function x1(e,t){const r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)}function aL(e,t){const r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function ij(e){const t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function kpe(e){const t=e[0],r=e[1];return t*t+r*r}function sj(e,t){return e[0]=-t[0],e[1]=-t[1],e}function zpe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function EA(e,t){const r=t[0],i=t[1];let s=r*r+i*i;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s),e}function Bs(e,t){return e[0]*t[0]+e[1]*t[1]}function y4e(e,t,r){const i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e}function Su(e,t,r,i){const s=t[0],n=t[1];return e[0]=s+i*(r[0]-s),e[1]=n+i*(r[1]-n),e}function _4e(e,t){t=t||1;const r=2*y3()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function Bpe(e,t,r){const i=t[0],s=t[1];return e[0]=r[0]*i+r[2]*s,e[1]=r[1]*i+r[3]*s,e}function W_(e,t,r){const i=t[0],s=t[1];return e[0]=r[0]*i+r[2]*s+r[4],e[1]=r[1]*i+r[3]*s+r[5],e}function v4e(e,t,r){const i=t[0],s=t[1];return e[0]=r[0]*i+r[3]*s+r[6],e[1]=r[1]*i+r[4]*s+r[7],e}function b4e(e,t,r){const i=t[0],s=t[1];return e[0]=r[0]*i+r[4]*s+r[12],e[1]=r[1]*i+r[5]*s+r[13],e}function w4e(e,t,r,i){const s=t[0]-r[0],n=t[1]-r[1],o=Math.sin(i),a=Math.cos(i);return e[0]=s*a-n*o+r[0],e[1]=s*o+n*a+r[1],e}function x4e(e,t){const r=e[0],i=e[1],s=t[0],n=t[1];let o=r*r+i*i;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(r*s+i*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function T4e(e){return"vec2("+e[0]+", "+e[1]+")"}function Vpe(e,t){return e[0]===t[0]&&e[1]===t[1]}function Gpe(e,t){const r=e[0],i=e[1],s=t[0],n=t[1],o=Ta();return Math.abs(r-s)<=o*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-n)<=o*Math.max(1,Math.abs(i),Math.abs(n))}function S4e(e,t,r,i,s){let n=t[0]-r[0],o=t[1]-r[1];const a=(i[0]*n+i[1]*o)*(s-1);return n=i[0]*a,o=i[1]*a,e[0]=t[0]+n,e[1]=t[1]+o,e}const E4e=ij,jpe=Ap,C4e=rj,A4e=Upe,Hpe=x1,O4e=aL,R4e=kpe;Object.freeze(Object.defineProperty({__proto__:null,add:Hh,angle:x4e,ceil:h4e,copy:en,cross:y4e,dist:Hpe,distance:x1,div:A4e,divide:Upe,dot:Bs,equals:Gpe,exactEquals:Vpe,floor:d4e,inverse:zpe,len:E4e,length:ij,lerp:Su,max:f4e,min:p4e,mul:C4e,multiply:rj,negate:sj,normalize:EA,projectAndScale:S4e,random:_4e,rotate:w4e,round:m4e,scale:Pl,scaleAndAdd:g4e,set:Qt,sqrDist:O4e,sqrLen:R4e,squaredDistance:aL,squaredLength:kpe,str:T4e,sub:jpe,subtract:Ap,transformMat2:Bpe,transformMat2d:W_,transformMat3:v4e,transformMat4:b4e},Symbol.toStringTag,{value:"Module"}));function nj(e){return fe((e-1e5)/(1e6-1e5),0,1)}const fz=1e4,P4e=.085,w0=1e5;class M4e{}const Wr=M4e;function b(e,...t){let r="";for(let i=0;i<t.length;i++)r+=e[i]+t[i];return r+=e[e.length-1],r}(function(e){function t(i){return Math.round(i).toString()}function r(i){return i.toPrecision(8)}e.int=t,e.float=r})(b||(b={}));var E;(function(e){e.POSITION="position",e.NORMAL="normal",e.NORMALCOMPRESSED="normalCompressed",e.UV0="uv0",e.AUXPOS1="auxpos1",e.AUXPOS2="auxpos2",e.COLOR="color",e.SYMBOLCOLOR="symbolColor",e.SIZE="size",e.TANGENT="tangent",e.OFFSET="offset",e.SUBDIVISIONFACTOR="subdivisionFactor",e.COLORFEATUREATTRIBUTE="colorFeatureAttribute",e.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",e.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",e.DISTANCETOSTART="distanceToStart",e.UVMAPSPACE="uvMapSpace",e.BOUNDINGRECT="boundingRect",e.UVREGION="uvRegion",e.PROFILERIGHT="profileRight",e.PROFILEUP="profileUp",e.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",e.FEATUREVALUE="featureValue",e.MODELORIGINHI="modelOriginHi",e.MODELORIGINLO="modelOriginLo",e.MODEL="model",e.MODELNORMAL="modelNormal",e.INSTANCECOLOR="instanceColor",e.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",e.LOCALTRANSFORM="localTransform",e.GLOBALTRANSFORM="globalTransform",e.BOUNDINGSPHERE="boundingSphere",e.MODELORIGIN="modelOrigin",e.MODELSCALEFACTORS="modelScaleFactors",e.FEATUREATTRIBUTE="featureAttribute",e.STATE="state",e.LODLEVEL="lodLevel",e.POSITION0="position0",e.POSITION1="position1",e.NORMALA="normalA",e.NORMALB="normalB",e.COMPONENTINDEX="componentIndex",e.VARIANTOFFSET="variantOffset",e.VARIANTSTROKE="variantStroke",e.VARIANTEXTENSION="variantExtension",e.U8PADDING="u8padding",e.U16PADDING="u16padding",e.SIDENESS="sideness",e.START="start",e.END="end",e.UP="up",e.EXTRUDE="extrude",e.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",e.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(E||(E={}));var ws;function zp(e,t){switch(t.textureCoordinateType){case ws.Default:return e.attributes.add(E.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(b`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case ws.Compressed:return e.attributes.add(E.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(b`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case ws.Atlas:return e.attributes.add(E.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(E.UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),void e.vertex.code.add(b`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:t.textureCoordinateType;case ws.None:return void e.vertex.code.add(b`void forwardTextureCoordinates() {}`);case ws.COUNT:return}}(function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Atlas=2]="Atlas",e[e.Compressed=3]="Compressed",e[e.COUNT=4]="COUNT"})(ws||(ws={}));function Hl(e){e.code.add(b`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function Uc(e){e.include(Hl),e.code.add(b`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture(depthTex, uv)), nearFar);
}`)}function NN(e){e.fragment.code.add(b`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var jr;(function(e){e[e.Pass=0]="Pass",e[e.Draw=1]="Draw"})(jr||(jr={}));class es{constructor(t,r,i,s,n=null){this.name=t,this.type=r,this.arraySize=n,this.bind={[jr.Pass]:null,[jr.Draw]:null},i!=null&&s!=null&&(this.bind[i]=s)}equals(t){return this.type===t.type&&this.name===t.name&&this.arraySize===t.arraySize}}class Rt extends es{constructor(t,r){super(t,"vec3",jr.Pass,(i,s,n)=>i.setUniform3fv(t,r(s,n)))}}function Zm(e){e.uniforms.add(new Rt("mainLightDirection",(t,r)=>r.lighting.mainLight.direction))}function hf(e){e.uniforms.add(new Rt("mainLightIntensity",(t,r)=>r.lighting.mainLight.intensity))}function lL(e){Zm(e.fragment),hf(e.fragment),e.fragment.code.add(b`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}class yr extends es{constructor(t,r){super(t,"vec2",jr.Pass,(i,s,n)=>i.setUniform2fv(t,r(s,n)))}}class Zt extends es{constructor(t,r){super(t,"vec4",jr.Pass,(i,s,n)=>i.setUniform4fv(t,r(s,n)))}}class Ae extends es{constructor(t,r){super(t,"float",jr.Pass,(i,s,n)=>i.setUniform1f(t,r(s,n)))}}class Ci extends es{constructor(t,r){super(t,"mat4",jr.Pass,(i,s,n)=>i.setUniformMatrix4fv(t,r(s,n)))}}const ea=Ht();class I4e{constructor(t){this.message=t}toString(){return`AssertException: ${this.message}`}}function Ye(e,t){if(!e){t=t||"Assertion";const r=new Error(t).stack;throw new I4e(`${t} at ${r}`)}}function _b(e,t){e||(t=t||"",console.warn("Verify failed: "+t+`
`+new Error("verify").stack))}function PY(e,t,r,i){let s,n=(r[0]-e[0])/t[0],o=(i[0]-e[0])/t[0];n>o&&(s=n,n=o,o=s);let a=(r[1]-e[1])/t[1],l=(i[1]-e[1])/t[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(r[2]-e[2])/t[2],u=(i[2]-e[2])/t[2];return c>u&&(s=c,c=u,u=s),!(n>u||c>o)&&(u<o&&(o=u),!(o<0))}function oR(e,t,r,i,s,n=Ne()){const o=(i[s]-r[s])*(t[0]-e[0])-(i[0]-r[0])*(t[s]-e[s]),a=(i[0]-r[0])*(e[s]-r[s])-(i[s]-r[s])*(e[0]-r[0]);if(o===0)return!1;const l=a/o;return n[0]=e[0]+l*(t[0]-e[0]),n[1]=e[s]+l*(t[s]-e[s]),!0}function MY(e,t,r,i,s){ea[0]=e[0],ea[1]=e[1],ea[2]=e[2],ea[3]=1,xc(ea,ea,t),s.length>2&&(s[2]=-ea[2]),xc(ea,ea,r),Ye(ea[3]!==0),s[0]=ea[0]/ea[3],s[1]=ea[1]/ea[3],s[2]=ea[2]/ea[3],s[0]=(.5*s[0]+.5)*i[2]+i[0],s[1]=(.5*s[1]+.5)*i[3]+i[1]}function $4e(e,t){return Math.log(e)/Math.log(t)}function L4e(e,t,r,i){e[12]=t,e[13]=r,e[14]=i}function Wpe(e){return e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[7]===0&&e[8]===0&&e[9]===0&&e[10]===1&&e[11]===0&&e[15]===1}const qpe=K.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class Xpe{constructor(){this._includedModules=new Map}include(t,r){if(this._includedModules.has(t)){const i=this._includedModules.get(t);if(i!==r){qpe.error("Trying to include shader module multiple times with different sets of options.");const s=new Set;for(const n of Object.keys(i))i[n]!==t[n]&&s.add(n);for(const n of Object.keys(t))i[n]!==t[n]&&s.add(n);s.forEach(n=>console.error(`  ${n}: current ${i[n]} new ${t[n]}`))}}else this._includedModules.set(t,r),t(this.builder,r)}}class pr extends Xpe{constructor(){super(...arguments),this.vertex=new IY,this.fragment=new IY,this.attributes=new F4e,this.varyings=new U4e,this.extensions=new ST,this.constants=new Os}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t){const r=this.extensions.generateSource(t),i=this.attributes.generateSource(t),s=this.varyings.generateSource(t),n=t==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=t==="vertex"?z4e:k4e,c=this.constants.generateSource().concat(n.constants.generateSource());return`#version 300 es
${r.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${i.join(`
`)}

${s.join(`
`)}

${a.join(`
`)}`}generateBind(t,r){const i=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[t];a!=null&&i.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[t];a!=null&&i.set(o.name,a)});const s=Array.from(i.values()),n=s.length;return(o,a,l)=>{for(let c=0;c<n;++c)s[c](r,o,a,l)}}}class D4e{constructor(){this._entries=new Map}add(...t){for(const r of t)this._add(r)}get(t){return this._entries.get(t)}_add(t){if(t!=null){if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new G(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}else qpe.error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(t=>t.arraySize!=null?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`)}get entries(){return Array.from(this._entries.values())}}class N4e{constructor(){this._entries=new Array}add(t){this._entries.push(t)}generateSource(){return this._entries}}class IY extends Xpe{constructor(){super(...arguments),this.uniforms=new D4e,this.code=new N4e,this.constants=new Os}get builder(){return this}}class F4e{constructor(){this._entries=new Array}add(t,r){this._entries.push([t,r])}generateSource(t){return t==="fragment"?[]:this._entries.map(r=>`in ${r[1]} ${r[0]};`)}}class U4e{constructor(){this._entries=new Map}add(t,r){this._entries.has(t)&&Ye(this._entries.get(t)===r),this._entries.set(t,r)}generateSource(t){const r=new Array;return this._entries.forEach((i,s)=>r.push(t==="vertex"?`out ${i} ${s};`:`in ${i} ${s};`)),r}}class ST{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const r=t==="vertex"?ST.ALLOWLIST_VERTEX:ST.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(i=>r.includes(i)).map(i=>`#extension ${i} : enable`)}}ST.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],ST.ALLOWLIST_VERTEX=[];class Os{constructor(){this._entries=new Set}add(t,r,i){let s="ERROR_CONSTRUCTOR_STRING";switch(r){case"float":s=Os._numberToFloatStr(i);break;case"int":s=Os._numberToIntStr(i);break;case"bool":s=i.toString();break;case"vec2":s=`vec2(${Os._numberToFloatStr(i[0])},                            ${Os._numberToFloatStr(i[1])})`;break;case"vec3":s=`vec3(${Os._numberToFloatStr(i[0])},                            ${Os._numberToFloatStr(i[1])},                            ${Os._numberToFloatStr(i[2])})`;break;case"vec4":s=`vec4(${Os._numberToFloatStr(i[0])},                            ${Os._numberToFloatStr(i[1])},                            ${Os._numberToFloatStr(i[2])},                            ${Os._numberToFloatStr(i[3])})`;break;case"ivec2":s=`ivec2(${Os._numberToIntStr(i[0])},                             ${Os._numberToIntStr(i[1])})`;break;case"ivec3":s=`ivec3(${Os._numberToIntStr(i[0])},                             ${Os._numberToIntStr(i[1])},                             ${Os._numberToIntStr(i[2])})`;break;case"ivec4":s=`ivec4(${Os._numberToIntStr(i[0])},                             ${Os._numberToIntStr(i[1])},                             ${Os._numberToIntStr(i[2])},                             ${Os._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${r}(${Array.prototype.map.call(i,n=>Os._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${r} ${t} = ${s};`),this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}const k4e=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif

out vec4 fragColor;`,z4e=`precision highp float;
precision highp sampler2D;`;class qe extends es{constructor(t,r){super(t,"sampler2D",jr.Pass,(i,s,n)=>i.bindTexture(t,r(s,n)))}}const xC=Ce(parseFloat(Number(5802e-9).toFixed(6)),parseFloat(Number(13558e-9).toFixed(6)),parseFloat(Number(331e-7).toFixed(6))),CF=3,AF=Ce(CF*parseFloat(Number(65e-8).toFixed(6)),CF*parseFloat(Number(1881e-9).toFixed(6)),CF*parseFloat(Number(85e-9).toFixed(6))),B4e=3996e-9,V4e=Ce(parseFloat(Number(xC[0]+AF[0]).toFixed(6)),parseFloat(Number(xC[1]+AF[1]).toFixed(6)),parseFloat(Number(xC[2]+AF[2]).toFixed(6)));function G4e(e){const t=new pr;t.attributes.add(E.POSITION,"vec2"),t.include(zp,{textureCoordinateType:ws.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=t;return r.uniforms.add(new Ci("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Ci("inverseViewMatrix",(s,n)=>m2(j4e,n.camera.viewMatrix))),r.code.add(b`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new Rt("backgroundColor",s=>s.backgroundColor),new yr("radii",s=>s.radii),new Rt("cameraPosition",(s,n)=>n.camera.eye),new Zt("heightParameters",s=>s.heightParameters),new Ae("innerFadeDistance",s=>s.innerFadeDistance),new Ae("altitudeFade",s=>s.altitudeFade),new qe("depthTexture",s=>s.depthTexture),new Ae("hazeStrength",s=>s.hazeStrength)),i.constants.add("betaRayleigh","vec3",xC),i.constants.add("betaCombined","vec3",V4e),i.constants.add("betaMie","float",B4e),i.constants.add("scaleHeight","float",P4e*w0),Zm(i),t.include(NN),e.haze&&(i.include(Uc),i.uniforms.add(new yr("nearFar",(s,n)=>n.camera.nearFar))),i.code.add(b`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(b`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),i.code.add(b`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),i.code.add(b`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${e.haze?b`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${e.haze?"":b`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${e.haze?"":b`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${e.haze?b`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:b`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${e.haze?"":b`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, scaleFract);

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = dot(rayDir, lightDir);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${e.haze&&e.reduced?b`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv, nearFar);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${e.haze?b`
          vec4 depthSample = texture(depthTexture, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${e.reduced?b`cameraSpaceRay *= -textureBilinear(vuv0);`:b`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0, nearFar);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:b`${e.reduced?"":b`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${e.haze?b`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:b`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${e.haze?"":b`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `),t}const j4e=be(),H4e=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:xC,build:G4e},Symbol.toStringTag,{value:"Module"}));class _r{constructor(t,r){this._module=t,this._loadModule=r}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}var fi,bt,ve,Jp,gt,sd,ET,Ze,Hr,as,xt,Ct,Ji,vt,He,Is,Ns,gr,yc,Qn;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(fi||(fi={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(bt||(bt={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(ve||(ve={})),function(e){e[e.ADD=32774]="ADD",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.SUBTRACT=32778]="SUBTRACT",e[e.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(Jp||(Jp={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(gt||(gt={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(sd||(sd={})),function(e){e[e.CW=2304]="CW",e[e.CCW=2305]="CCW"}(ET||(ET={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT"}(Ze||(Ze={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(Hr||(Hr={})),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP"}(as||(as={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(xt||(xt={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Ct||(Ct={})),function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(Ji||(Ji={})),function(e){e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.RG=33319]="RG",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER"}(vt||(vt={})),function(e){e[e.RGBA4=32854]="RGBA4",e[e.R16F=33325]="R16F",e[e.RG16F=33327]="RG16F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.R32F=33326]="R32F",e[e.RG32F=33328]="RG32F",e[e.RGBA32F=34836]="RGBA32F",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB5_A1=32855]="RGB5_A1",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.RGB16F=34843]="RGB16F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB565=36194]="RGB565",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGB10_A2UI=36975]="RGB10_A2UI"}(He||(He={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.INT=5124]="INT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(Is||(Is={})),function(e){e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(Ns||(Ns={})),function(e){e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_READ=35045]="STATIC_READ",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.STREAM_COPY=35042]="STREAM_COPY"}(gr||(gr={})),function(e){e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER"}(yc||(yc={})),function(e){e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(Qn||(Qn={}));const OF=33984;var mn,cc;(function(e){e[e.Texture=0]="Texture",e[e.BufferObject=1]="BufferObject",e[e.VertexArrayObject=2]="VertexArrayObject",e[e.Shader=3]="Shader",e[e.Program=4]="Program",e[e.FramebufferObject=5]="FramebufferObject",e[e.Renderbuffer=6]="Renderbuffer",e[e.Sync=7]="Sync",e[e.COUNT=8]="COUNT"})(mn||(mn={})),function(e){e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(cc||(cc={}));const $Y=33306;var is,LY,DY,NY,cL,mz,FY;(function(e){e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(is||(is={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT=5124]="INT",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(LY||(LY={})),function(e){e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS"}(DY||(DY={})),function(e){e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED"}(NY||(NY={})),function(e){e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED"}(cL||(cL={})),function(e){e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(mz||(mz={})),function(e){e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(FY||(FY={}));class xr{constructor(t,r,i){this.release=i,this.initializeConfiguration(t,r),this._configuration=r.snapshot(),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}destroy(){this._program=De(this._program),this._pipeline=this._configuration=null}reload(t){De(this._program),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPipelineState(t,r=null,i){t.setPipelineState(this.getPipelineState(r,i))}ensureAttributeLocations(t){this.program.assertCompatibleVertexAttributeLocations(t)}get primitiveType(){return bt.TRIANGLES}getPipelineState(t,r){return this._pipeline}initializeConfiguration(t,r){}}const dr=new Map([[E.POSITION,0],[E.NORMAL,1],[E.NORMALCOMPRESSED,1],[E.UV0,2],[E.COLOR,3],[E.COLORFEATUREATTRIBUTE,3],[E.SIZE,4],[E.TANGENT,4],[E.AUXPOS1,5],[E.SYMBOLCOLOR,5],[E.AUXPOS2,6],[E.FEATUREATTRIBUTE,6],[E.INSTANCEFEATUREATTRIBUTE,6],[E.INSTANCECOLOR,7],[E.OBJECTANDLAYERIDCOLOR,7],[E.INSTANCEOBJECTANDLAYERIDCOLOR,7],[E.MODEL,8],[E.MODELNORMAL,12],[E.MODELORIGINHI,11],[E.MODELORIGINLO,15]]),W4e=K.getLogger("esri.views.webgl.checkWebGLError");function q4e(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const Zpe=!!ne("enable-feature:webgl-debug");function yu(){return Zpe}function gz(){return Zpe}function O0(e){if(yu()){const t=e.getError();if(t){const r=q4e(e,t),i=new Error().stack;W4e.error(new G("webgl-error","WebGL error occured",{message:r,stack:i}))}}}class vr{constructor(t,r,i){this._context=t,this._locations=i,this._textures=new Map,this._freeTextureUnits=new Mt({deallocator:null}),this._glProgram=t.programCache.acquire(r.generate("vertex"),r.generate("fragment"),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=r.generateBind(jr.Pass,this),this.bindDraw=r.generateBind(jr.Draw,this),this._fragmentUniforms=yu()?r.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get compiled(){return this._glProgram.compiled}setUniform1b(t,r){this._glProgram.setUniform1i(t,r?1:0)}setUniform1i(t,r){this._glProgram.setUniform1i(t,r)}setUniform1f(t,r){this._glProgram.setUniform1f(t,r)}setUniform2fv(t,r){this._glProgram.setUniform2fv(t,r)}setUniform3fv(t,r){this._glProgram.setUniform3fv(t,r)}setUniform4fv(t,r){this._glProgram.setUniform4fv(t,r)}setUniformMatrix3fv(t,r){this._glProgram.setUniformMatrix3fv(t,r)}setUniformMatrix4fv(t,r){this._glProgram.setUniformMatrix4fv(t,r)}setUniform1fv(t,r){this._glProgram.setUniform1fv(t,r)}setUniform1iv(t,r){this._glProgram.setUniform1iv(t,r)}setUniform2iv(t,r){this._glProgram.setUniform3iv(t,r)}setUniform3iv(t,r){this._glProgram.setUniform3iv(t,r)}setUniform4iv(t,r){this._glProgram.setUniform4iv(t,r)}assertCompatibleVertexAttributeLocations(t){t.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(t,r){if(r==null||r.glName==null){const s=this._textures.get(t);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(t)),null}let i=this._textures.get(t);return i==null?(i=this._allocTextureUnit(r),this._textures.set(t,i)):i.texture=r,this._context.useProgram(this),this.setUniform1i(t,i.unit),this._context.bindTexture(r,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((t,r)=>{this._context.bindTexture(t.texture,t.unit),this.setUniform1i(r,t.unit)}),this._fragmentUniforms!=null&&this._fragmentUniforms.forEach(t=>{t.type!=="sampler2D"&&t.type!=="samplerCube"||this._textures.has(t.name)||console.error(`Texture sampler ${t.name} has no bound texture`)})}_allocTextureUnit(t){return{texture:t,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(t){this._freeTextureUnits.push(t.unit)}}var oi,T1,ns,_m,Za,km,CT,Gr,S1,vm;(function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"})(oi||(oi={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(T1||(T1={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(ns||(ns={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(_m||(_m={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Za||(Za={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee",e[e.COUNT=2]="COUNT"}(km||(km={})),function(e){e[e.CHANGED=0]="CHANGED",e[e.UNCHANGED=1]="UNCHANGED"}(CT||(CT={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(Gr||(Gr={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(S1||(S1={})),function(e){e.DDS_ENCODING="image/vnd-ms.dds",e.KTX2_ENCODING="image/ktx2",e.BASIS_ENCODING="image/x.basis"}(vm||(vm={}));function Vl(e,t,r=Jp.ADD,i=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function oo(e,t,r,i,s=Jp.ADD,n=Jp.ADD,o=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:r,dstAlpha:i,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const oj={face:sd.BACK,mode:ET.CCW},Ype={face:sd.FRONT,mode:ET.CCW},FN=e=>e===oi.Back?oj:e===oi.Front?Ype:null,Ka={zNear:0,zFar:1},It={r:!0,g:!0,b:!0,a:!0};function X4e(e){return r5e.intern(e)}function Z4e(e){return i5e.intern(e)}function Y4e(e){return s5e.intern(e)}function J4e(e){return n5e.intern(e)}function K4e(e){return o5e.intern(e)}function Q4e(e){return a5e.intern(e)}function e5e(e){return l5e.intern(e)}function t5e(e){return c5e.intern(e)}function Tt(e){return u5e.intern(e)}class Ym{constructor(t,r){this._makeKey=t,this._makeRef=r,this._interns=new Map}intern(t){if(!t)return null;const r=this._makeKey(t),i=this._interns;return i.has(r)||i.set(r,this._makeRef(t)),i.get(r)??null}}function Jm(e){return"["+e.join(",")+"]"}const r5e=new Ym(Jpe,e=>({__tag:"Blending",...e}));function Jpe(e){return e?Jm([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const i5e=new Ym(Kpe,e=>({__tag:"Culling",...e}));function Kpe(e){return e?Jm([e.face,e.mode]):null}const s5e=new Ym(Qpe,e=>({__tag:"PolygonOffset",...e}));function Qpe(e){return e?Jm([e.factor,e.units]):null}const n5e=new Ym(efe,e=>({__tag:"DepthTest",...e}));function efe(e){return e?Jm([e.func]):null}const o5e=new Ym(tfe,e=>({__tag:"StencilTest",...e}));function tfe(e){return e?Jm([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const a5e=new Ym(rfe,e=>({__tag:"DepthWrite",...e}));function rfe(e){return e?Jm([e.zNear,e.zFar]):null}const l5e=new Ym(ife,e=>({__tag:"ColorWrite",...e}));function ife(e){return e?Jm([e.r,e.g,e.b,e.a]):null}const c5e=new Ym(sfe,e=>({__tag:"StencilWrite",...e}));function sfe(e){return e?Jm([e.mask]):null}const u5e=new Ym(h5e,e=>({blending:X4e(e.blending),culling:Z4e(e.culling),polygonOffset:Y4e(e.polygonOffset),depthTest:J4e(e.depthTest),stencilTest:K4e(e.stencilTest),depthWrite:Q4e(e.depthWrite),colorWrite:e5e(e.colorWrite),stencilWrite:t5e(e.stencilWrite)}));function h5e(e){return e?Jm([Jpe(e.blending),Kpe(e.culling),Qpe(e.polygonOffset),efe(e.depthTest),tfe(e.stencilTest),rfe(e.depthWrite),ife(e.colorWrite),sfe(e.stencilWrite)]):null}class d5e{constructor(t){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=t}setPipeline(t){(this._pipelineInvalid||t!==this._pipeline)&&(this._setBlending(t.blending),this._setCulling(t.culling),this._setPolygonOffset(t.polygonOffset),this._setDepthTest(t.depthTest),this._setStencilTest(t.stencilTest),this._setDepthWrite(t.depthWrite),this._setColorWrite(t.colorWrite),this._setStencilWrite(t.stencilWrite),this._pipeline=t),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(t){this._blending=this._setSubState(t,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(t){this._culling=this._setSubState(t,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(t){this._polygonOffset=this._setSubState(t,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(t){this._depthTest=this._setSubState(t,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(t){this._stencilTest=this._setSubState(t,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(t){this._depthWrite=this._setSubState(t,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(t){this._colorWrite=this._setSubState(t,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(t){this._stencilWrite=this._setSubState(t,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(t,r,i,s){return(i||t!==r)&&(s(t),this._pipelineInvalid=!0),t}}class p5e extends Wr{constructor(){super(...arguments),this.heightParameters=Ht(),this.radii=Ne(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1,this.renderScale=Ne(),this.backgroundColor=C()}}class Mv extends xr{initializeProgram(t){return new vr(t.rctx,Mv.shader.get().build(this.configuration),dr)}initializePipeline(){return this.configuration.reduced?Tt({blending:Vl(ve.ONE,ve.ZERO),depthTest:{func:Hr.ALWAYS},colorWrite:It}):this.configuration.haze?Tt({blending:oo(ve.ONE,ve.ZERO,ve.ONE_MINUS_SRC_COLOR,ve.ONE),colorWrite:It}):Tt({blending:Vl(ve.SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),depthTest:{func:Hr.LEQUAL},colorWrite:It})}}Mv.shader=new _r(H4e,()=>ue(()=>import("./ChapmanAtmosphere.glsl.d68ad48b.js"),[]));class Yo extends Wr{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const t=this._parameterNames,r={key:this.key};for(const i of t)r[i]=this[i];return r}}function B(e={}){return(t,r)=>{if(t._parameterNames=t._parameterNames??[],t._parameterNames.push(r),e.constValue!=null)Object.defineProperty(t,r,{get:()=>e.constValue});else{const i=t._parameterNames.length-1,s=e.count||2,n=Math.ceil(Math.log2(s)),o=t._parameterBits??[0];let a=0;for(;o[a]+n>16;)a++,a>=o.length&&o.push(0);t._parameterBits=o;const l=o[a],c=(1<<n)-1<<l;o[a]+=n,Object.defineProperty(t,r,{get(){return this[i]},set(u){if(this[i]!==u&&(this[i]=u,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+u<<l&c,typeof u!="number"&&typeof u!="boolean"))throw new Error("Configuration value for "+r+" must be boolean or number, got "+typeof u)}})}}}class uL extends Yo{constructor(){super(...arguments),this.haze=!1,this.reduced=!1}}h([B()],uL.prototype,"haze",void 0),h([B()],uL.prototype,"reduced",void 0);class io{constructor(t,r,i,s,n,o=!1,a=0){this.name=t,this.count=r,this.type=i,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}}new io(E.POSITION,3,Ze.FLOAT,0,12);new io(E.POSITION,3,Ze.FLOAT,0,20),new io(E.UV0,2,Ze.FLOAT,12,20);new io(E.POSITION,3,Ze.FLOAT,0,32),new io(E.NORMAL,3,Ze.FLOAT,12,32),new io(E.UV0,2,Ze.FLOAT,24,32);new io(E.POSITION,3,Ze.FLOAT,0,16),new io(E.COLOR,4,Ze.UNSIGNED_BYTE,12,16);const aj=[new io(E.POSITION,2,Ze.FLOAT,0,8)],G3=[new io(E.POSITION,2,Ze.FLOAT,0,16),new io(E.UV0,2,Ze.FLOAT,8,16)];function UY(e){const t=e.gl;switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case t.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case t.INVALID_OPERATION:return"The specified command is not allowed for the current state";case t.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case t.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case t.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function vo(e,t){return e.vertexBuffers[t].byteLength/f5e(e.layout[t])}function f5e(e){return e[0].stride}function lj(e,t,r,i,s=0){const n=e.gl,o=e.capabilities.instancing;e.bindBuffer(r);for(const a of i){const l=t.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let u=0;u<3;u++)n.vertexAttribPointer(l+u,3,a.type,a.normalized,a.stride,a.offset+12*u+c),n.enableVertexAttribArray(l+u),a.divisor>0&&o&&o.vertexAttribDivisor(l+u,a.divisor);else if(a.count===16)for(let u=0;u<4;u++)n.vertexAttribPointer(l+u,4,a.type,a.normalized,a.stride,a.offset+16*u+c),n.enableVertexAttribArray(l+u),a.divisor>0&&o&&o.vertexAttribDivisor(l+u,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function cj(e,t,r,i){const s=e.gl,n=e.capabilities.instancing;e.bindBuffer(r);for(const o of i){const a=t.get(o.name);if(o.count<=4)s.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}e.unbindBuffer(gt.ARRAY_BUFFER)}function uj(e){switch(e){case vt.ALPHA:case vt.LUMINANCE:case vt.RED:case vt.RED_INTEGER:case He.R8:case He.R8I:case He.R8UI:case He.R8_SNORM:case Ns.STENCIL_INDEX8:return 1;case vt.LUMINANCE_ALPHA:case vt.RG:case vt.RG_INTEGER:case He.RGBA4:case He.R16F:case He.R16I:case He.R16UI:case He.RG8:case He.RG8I:case He.RG8UI:case He.RG8_SNORM:case He.RGB565:case He.RGB5_A1:case Ns.DEPTH_COMPONENT16:return 2;case vt.DEPTH_COMPONENT:case vt.RGB:case vt.RGB_INTEGER:case He.RGB8:case He.RGB8I:case He.RGB8UI:case He.RGB8_SNORM:case He.SRGB8:case Ns.DEPTH_COMPONENT24:return 3;case vt.DEPTH_STENCIL:case vt.DEPTH24_STENCIL8:case vt.RGBA:case vt.RGBA_INTEGER:case He.RGBA8:case He.R32F:case He.R11F_G11F_B10F:case He.RG16F:case He.R32I:case He.R32UI:case He.RG16I:case He.RG16UI:case He.RGBA8I:case He.RGBA8UI:case He.RGBA8_SNORM:case He.SRGB8_ALPHA8:case He.RGB9_E5:case He.RGB10_A2UI:case He.RGB10_A2:case Ns.DEPTH_STENCIL:case Ns.DEPTH_COMPONENT32F:case Ns.DEPTH24_STENCIL8:return 4;case Ns.DEPTH32F_STENCIL8:return 5;case He.RGB16F:case He.RGB16I:case He.RGB16UI:return 6;case He.RG32F:case He.RG32I:case He.RG32UI:case He.RGBA16F:case He.RGBA16I:case He.RGBA16UI:return 8;case He.RGB32F:case He.RGB32I:case He.RGB32UI:return 12;case He.RGBA32F:case He.RGBA32I:case He.RGBA32UI:return 16;case is.COMPRESSED_RGB_S3TC_DXT1_EXT:case is.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case is.COMPRESSED_RGBA_S3TC_DXT3_EXT:case is.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case is.COMPRESSED_R11_EAC:case is.COMPRESSED_SIGNED_R11_EAC:case is.COMPRESSED_RGB8_ETC2:case is.COMPRESSED_SRGB8_ETC2:case is.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case is.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case is.COMPRESSED_RG11_EAC:case is.COMPRESSED_SIGNED_RG11_EAC:case is.COMPRESSED_RGBA8_ETC2_EAC:case is.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}const vb=K.getLogger("esri.views.webgl.VertexArrayObject");let Ju=class{constructor(e,t,r,i,s=null){this._context=e,this._locations=t,this._layout=r,this._buffers=i,this._indexBuffer=s,this._glName=null,this._initialized=!1,e.instanceCounter.increment(mn.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((e,t)=>e+this._buffers[t].byteLength,this._indexBuffer!=null?this._indexBuffer.byteLength:0)}get layout(){return this._layout}get locations(){return this._locations}get memoryEstimate(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*zne}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const e in this._buffers)this._buffers[e]?.dispose(),delete this._buffers[e];this._indexBuffer=De(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&vb.warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&((this._context?.capabilities?.vao).deleteVertexArray(this._glName),this._glName=null),this._context.instanceCounter.decrement(mn.VertexArrayObject,this),this._context=s2(this._context)}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:t,_indexBuffer:r}=this;e||vb.error("Vertex buffer dictionary is empty!");const i=this._context.gl;for(const s in e){const n=e[s];n||vb.error("Vertex buffer is uninitialized!");const o=t[s];o||vb.error("Vertex element descriptor is empty!"),lj(this._context,this._locations,n,o)}r!=null&&(this._context.capabilities.vao?i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,r.glName):this._context.bindBuffer(r))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:t}=this;e||vb.error("Vertex buffer dictionary is empty!");for(const r in e){const i=e[r];i||vb.error("Vertex buffer is uninitialized!");const s=t[r];cj(this._context,this._locations,i,s)}this._indexBuffer!=null&&this._context.unbindBuffer(this._indexBuffer.bufferType)}};class Ed extends Ju{}var tr;function yz(e,t,r={}){const i=t===tr.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];for(const s of i){const n=e.getContext(s,r);if(n)return n}return null}function m5e(e,t,r={}){const i=nfe(e);for(const s of i){const n=yz(t,s,r);if(n)return n}return null}function nfe(e){if(e==="3d")return[tr.WEBGL2];const t=ne("esri-force-webgl");return t===tr.WEBGL1||t===tr.WEBGL2?[t]:ne("mac")&&ne("chrome")?[tr.WEBGL1,tr.WEBGL2]:[tr.WEBGL2,tr.WEBGL1]}(function(e){e[e.WEBGL1=1]="WEBGL1",e[e.WEBGL2=2]="WEBGL2"})(tr||(tr={}));const Ld=K.getLogger("esri.views.webgl.BufferObject");class rr{static createIndex(t,r,i){return new rr(t,gt.ELEMENT_ARRAY_BUFFER,r,i)}static createVertex(t,r,i){return new rr(t,gt.ARRAY_BUFFER,r,i)}static createUniform(t,r,i){if(t.type!==tr.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new rr(t,gt.UNIFORM_BUFFER,r,i)}static createPixelPack(t,r=gr.STREAM_READ,i){if(t.type!==tr.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const s=new rr(t,gt.PIXEL_PACK_BUFFER,r);return i&&s.setSize(i),s}static createPixelUnpack(t,r=gr.STREAM_DRAW,i){if(t.type!==tr.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new rr(t,gt.PIXEL_UNPACK_BUFFER,r,i)}constructor(t,r,i,s){this._context=t,this.bufferType=r,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(mn.BufferObject,this),this._glName=this._context.gl.createBuffer(),O0(this._context.gl),s&&this.setData(s)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteLength(){return this.bufferType===gt.ELEMENT_ARRAY_BUFFER?this._indexType===Ze.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===gt.ELEMENT_ARRAY_BUFFER||this.bufferType===gt.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(mn.BufferObject,this),this._context=s2(this._context)):this._glName&&Ld.warn("Leaked WebGL buffer object")}setSize(t,r=null){if(t<=0&&Ld.error("Buffer size needs to be positive!"),this.bufferType===gt.ELEMENT_ARRAY_BUFFER&&r!=null)switch(this._indexType=r,r){case Ze.UNSIGNED_SHORT:t*=2;break;case Ze.UNSIGNED_INT:t*=4}this._setBufferData(t)}setData(t){if(!t)return;let r=t.byteLength;this.bufferType===gt.ELEMENT_ARRAY_BUFFER&&(OD(t)&&(r/=2,this._indexType=Ze.UNSIGNED_SHORT),RD(t)&&(r/=4,this._indexType=Ze.UNSIGNED_INT)),this._setBufferData(r,t)}_setBufferData(t,r=null){this._size=t;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;r!=null?s.bufferData(this.bufferType,r,this.usage):s.bufferData(this.bufferType,t,this.usage),O0(s),this._isVAOAware&&this._context.bindVAO(i)}setSubData(t,r,i,s){if(!t)return;(r<0||r*t.BYTES_PER_ELEMENT>=this.byteLength)&&Ld.error("offset is out of range!"),i>=s&&Ld.error("end must be bigger than start!"),(r+(s-i))*t.BYTES_PER_ELEMENT>this.byteLength&&Ld.error("An attempt to write beyond the end of the buffer!");const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===tr.WEBGL2)o.bufferSubData(this.bufferType,r*t.BYTES_PER_ELEMENT,t,i,s-i);else{const a=i===0&&s===t.length?t:t.subarray(i,s);o.bufferSubData(this.bufferType,r*t.BYTES_PER_ELEMENT,a)}O0(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(t,r=0,i,s){if(this._context.type!==tr.WEBGL2)return void Ld.error("Get buffer subdata is supported in WebGL2 only!");if(i<0||s<0)return void Ld.error("Problem getting subdata: offset and length were less than zero!");const n=g5e(t)?t.BYTES_PER_ELEMENT:1;if(n*((i??0)+(s??0))>t.byteLength)return void Ld.error("Problem getting subdata: offset and length exceeded destination size!");r+n*(s??0)>this.byteLength&&Ld.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,gt.COPY_READ_BUFFER),o.getBufferSubData(gt.COPY_READ_BUFFER,r,t,i,s),this._context.unbindBuffer(gt.COPY_READ_BUFFER)}async getSubDataAsync(t,r=0,i,s){this._context.type===tr.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(t,r,i,s)):Ld.error("Get buffer subdata is supported in WebGL2 only!")}}function g5e(e){return ywe(e)}var yy;(function(e){e[e.Texture=0]="Texture",e[e.RenderBuffer=1]="RenderBuffer"})(yy||(yy={}));class hr{constructor(t=0,r=t){this.width=t,this.height=r,this.target=Ji.TEXTURE_2D,this.pixelFormat=vt.RGBA,this.dataType=Is.UNSIGNED_BYTE,this.samplingMode=xt.LINEAR,this.wrapMode=Ct.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}}function y5e(e){return e.width<=0||e.height<=0||e.internalFormat==null?0:e.width*e.height*(e.hasMipmap?4/3:1)*uj(e.internalFormat)}class hj extends hr{constructor(t,r){switch(super(),this.context=t,Object.assign(this,r),this.internalFormat){case He.R16F:case He.R16I:case He.R16UI:case He.R32F:case He.R32I:case He.R32UI:case He.R8_SNORM:case He.R8:case He.R8I:case He.R8UI:this.pixelFormat=vt.RED}}static validate(t,r){return new hj(t,r)}}const kY=4;let wt=class{constructor(e,t=null,r=null){if(this.type=yy.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,r=t;else{const i=hj.validate(e,t);if(!i)throw new G("Texture descriptor invalid");this._descriptor=i}if(this._descriptor.context.instanceCounter.increment(mn.Texture,this),this._descriptor.context.type!==tr.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),q_(this._descriptor.target)))throw new G("3D and array textures are not supported in WebGL1");this._descriptor.target===Ji.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get gpuMemoryUsage(){return x5e.delete(this),y5e(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null,this._descriptor.context.instanceCounter.decrement(mn.Texture,this))}release(){this.dispose()}resize(e,t){const r=this._descriptor;if(r.width!==e||r.height!==t){if(this._wasImmutablyAllocated)throw new G("Immutable textures can't be resized!");r.width=e,r.height=t,this._descriptor.target===Ji.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let t=Ji.TEXTURE_CUBE_MAP_POSITIVE_X;t<=Ji.TEXTURE_CUBE_MAP_NEGATIVE_Z;t++)this._setData(e,t)}setData(e){this._setData(e)}_setData(e,t){if(!this._descriptor.context||!this._descriptor.context.gl)return;const r=this._descriptor.context.gl;O0(r),this._glName||(this._glName=r.createTexture()),e===void 0&&(e=null);const i=this._descriptor,s=t??i.target,n=q_(s);e===null&&(i.width=i.width||kY,i.height=i.height||kY,n&&(i.depth=i.depth??1));const o=this._descriptor.context.bindTexture(this,wt.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(wt.TEXTURE_UNIT_FOR_UPDATES),RF(this._descriptor.context,i),this._configurePixelStorage(),O0(r);const a=this._deriveInternalFormat();if(PF(e)){let l=e.width,c=e.height;const u=1;e instanceof HTMLVideoElement&&(l=e.videoWidth,c=e.videoHeight),i.width&&i.height,n&&i.depth,i.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,a,i.hasMipmap,l,c,u),this._texImage(s,0,a,l,c,u,e),O0(r),i.hasMipmap&&this.generateMipmap(),i.width||(i.width=l),i.height||(i.height=c),n&&!i.depth&&(i.depth=u)}else{const{width:l,height:c,depth:u}=i;if(l==null||c==null)throw new G("Width and height must be specified!");if(n&&u==null)throw new G("Depth must be specified!");if(i.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,a,i.hasMipmap,l,c,u),tI(e)){const d=e.levels,p=VY(s,l,c,u),g=Math.min(p-1,d.length-1);this._descriptor.context.gl2!=null?r.texParameteri(i.target,this._descriptor.context.gl2.TEXTURE_MAX_LEVEL,g):i.hasMipmap=i.hasMipmap&&p===d.length;const y=a;if(!b5e(y))throw new G("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((_,v,w,T)=>{const x=d[Math.min(_,d.length-1)];this._compressedTexImage(s,_,y,v,w,T,x)},g)}else this._texImage(s,0,a,l,c,u,e),O0(r),i.hasMipmap&&this.generateMipmap()}zY(r,this._descriptor),BY(r,this._descriptor),_5e(this._descriptor.context,this._descriptor),O0(r),this._descriptor.context.bindTexture(o,wt.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,t,r,i,s,n,o=0){n||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const a=this._descriptor.context.gl,l=this._descriptor.context.gl2,c=this._descriptor,u=this._deriveInternalFormat(),{pixelFormat:d,dataType:p,target:g,isImmutable:y}=c;if(y&&!this._wasImmutablyAllocated)throw new G("Cannot update immutable texture before allocation!");const _=this._descriptor.context.bindTexture(this,wt.TEXTURE_UNIT_FOR_UPDATES,!0);if((t<0||r<0||i>c.width||s>c.height||t+i>c.width||r+s>c.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),o){if(!l)return void console.error("Webgl2 must be enabled to use dataRowOffset!");a.pixelStorei(l.UNPACK_SKIP_ROWS,o)}if(PF(n)?l?l.texSubImage2D(g,e,t,r,i,s,d,p,n):a.texSubImage2D(g,e,t,r,d,p,n):tI(n)?a.compressedTexSubImage2D(g,e,t,r,i,s,u,n.levels[e]):a.texSubImage2D(g,e,t,r,i,s,d,p,n),o){if(!l)return void console.error("Webgl2 must be enabled to use dataRowOffset!");a.pixelStorei(l.UNPACK_SKIP_ROWS,0)}this._descriptor.context.bindTexture(_,wt.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,t,r,i,s,n,o,a){a||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._descriptor.context.gl2;if(l==null)throw new G("3D textures are not supported in WebGL1");const c=this._descriptor,u=this._deriveInternalFormat(),{pixelFormat:d,dataType:p,isImmutable:g,target:y}=c;if(g&&!this._wasImmutablyAllocated)throw new G("Cannot update immutable texture before allocation!");q_(y)||console.warn("Attempting to set 3D texture data on a non-3D texture");const _=this._descriptor.context.bindTexture(this,wt.TEXTURE_UNIT_FOR_UPDATES);if(this._descriptor.context.setActiveTexture(wt.TEXTURE_UNIT_FOR_UPDATES),(t<0||r<0||i<0||s>c.width||n>c.height||o>c.depth||t+s>c.width||r+n>c.height||i+o>c.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),tI(a))a=a.levels[e],l.compressedTexSubImage3D(y,e,t,r,i,s,n,o,u,a);else{const v=a;l.texSubImage3D(y,e,t,r,i,s,n,o,d,p,v)}this._descriptor.context.bindTexture(_,wt.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new G("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,RF(this._descriptor.context,e)}e.samplingMode===xt.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=xt.LINEAR_MIPMAP_NEAREST):e.samplingMode===xt.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=xt.NEAREST_MIPMAP_NEAREST);const t=this._descriptor.context.bindTexture(this,wt.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(wt.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(t,wt.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,RF(this._descriptor.context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor.context.gl,t=this._descriptor;this._samplingModeDirty&&(zY(e,t),this._samplingModeDirty=!1),this._wrapModeDirty&&(BY(e,t),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(this._descriptor.context.type===tr.WEBGL1)return this._descriptor.internalFormat=this._descriptor.pixelFormat;if(this._descriptor.internalFormat!=null)return this._descriptor.internalFormat===vt.DEPTH_STENCIL&&(this._descriptor.internalFormat=vt.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case Is.FLOAT:switch(this._descriptor.pixelFormat){case vt.RGBA:return this._descriptor.internalFormat=He.RGBA32F;case vt.RGB:return this._descriptor.internalFormat=He.RGB32F;default:throw new G("Unable to derive format")}case Is.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case vt.RGBA:return this._descriptor.internalFormat=He.RGBA8;case vt.RGB:return this._descriptor.internalFormat=He.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===vt.DEPTH_STENCIL?vt.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:t,flipped:r,preMultiplyAlpha:i}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,t),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i?1:0)}_texStorage(e,t,r,i,s,n){const o=this._descriptor.context.gl2;if(o==null)throw new G("Immutable textures are not supported in WebGL1");if(!v5e(t))throw new G("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const a=r?VY(e,i,s,n):1;if(q_(e)){if(n==null)throw new G("Missing depth dimension for 3D texture upload");o.texStorage3D(e,a,t,i,s,n)}else o.texStorage2D(e,a,t,i,s);this._wasImmutablyAllocated=!0}_texImage(e,t,r,i,s,n,o){const a=this._descriptor.context.gl,l=q_(e),{isImmutable:c,pixelFormat:u,dataType:d}=this._descriptor,p=this._descriptor.context.type===tr.WEBGL2,g=p?a:null;if(p||!PF(o))if(c){if(o!=null){const y=o;if(l){if(n==null)throw new G("Missing depth dimension for 3D texture upload");g.texSubImage3D(e,t,0,0,0,i,s,n,u,d,y)}else a.texSubImage2D(e,t,0,0,i,s,u,d,y)}}else{const y=o;if(l){if(n==null)throw new G("Missing depth dimension for 3D texture upload");g.texImage3D(e,t,r,i,s,n,0,u,d,y)}else a.texImage2D(e,t,r,i,s,0,u,d,y)}else a.texImage2D(e,0,r,u,d,o)}_compressedTexImage(e,t,r,i,s,n,o){const a=this._descriptor.context.gl;let l=null;const c=q_(e),u=this._descriptor.isImmutable;if(c){if(this._descriptor.context.type!==tr.WEBGL2)throw new G("3D textures are not supported in WebGL1");l=a}if(u){if(o!=null)if(c){if(n==null)throw new G("Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(e,t,0,0,0,i,s,n,r,o)}else a.compressedTexSubImage2D(e,t,0,0,i,s,r,o)}else if(c){if(n==null)throw new G("Missing depth dimension for 3D texture upload");l.compressedTexImage3D(e,t,r,i,s,n,0,o)}else a.compressedTexImage2D(e,t,r,i,s,0,o)}_forEachMipmapLevel(e,t=1/0){let{width:r,height:i,depth:s,hasMipmap:n,target:o}=this._descriptor;const a=o===Ji.TEXTURE_3D;if(r==null||i==null||a&&s==null)throw new G("Missing texture dimensions for mipmap calculation");for(let l=0;e(l,r,i,s),n&&(r!==1||i!==1||a&&s!==1)&&!(l>=t);++l)r=Math.max(1,r>>1),i=Math.max(1,i>>1),a&&(s=Math.max(1,s>>1))}};function RF(e,t){(t.width!=null&&t.width<0||t.height!=null&&t.height<0||t.depth!=null&&t.depth<0)&&console.error("Negative dimension parameters are not allowed!");const r=e.type===tr.WEBGL2;r||!t.isImmutable&&!q_(t.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),!r&&(t.width!=null&&r1(t.width)&&t.height!=null&&r1(t.height)||(typeof t.wrapMode=="number"?t.wrapMode!==Ct.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):t.wrapMode.s===Ct.CLAMP_TO_EDGE&&t.wrapMode.t===Ct.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),t.hasMipmap&&console.error("Mipmapping requires power-of-two textures!")))}function zY(e,t){let r=t.samplingMode,i=t.samplingMode;r===xt.LINEAR_MIPMAP_NEAREST||r===xt.LINEAR_MIPMAP_LINEAR?(r=xt.LINEAR,t.hasMipmap||(i=xt.LINEAR)):r!==xt.NEAREST_MIPMAP_NEAREST&&r!==xt.NEAREST_MIPMAP_LINEAR||(r=xt.NEAREST,t.hasMipmap||(i=xt.NEAREST)),e.texParameteri(t.target,e.TEXTURE_MAG_FILTER,r),e.texParameteri(t.target,e.TEXTURE_MIN_FILTER,i)}function BY(e,t){typeof t.wrapMode=="number"?(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode.t))}function _5e(e,t){const r=e.capabilities.textureFilterAnisotropic;!r||e.gl.texParameterf(t.target,r.TEXTURE_MAX_ANISOTROPY,t.maxAnisotropy??1)}function v5e(e){return e in He}function b5e(e){return e in is}function tI(e){return e!=null&&"type"in e&&e.type==="compressed"}function w5e(e){return e!=null&&"byteLength"in e}function PF(e){return e!=null&&!tI(e)&&!w5e(e)}function q_(e){return e===Ji.TEXTURE_3D||e===Ji.TEXTURE_2D_ARRAY}function VY(e,t,r,i=1){let s=Math.max(t,r);return e===Ji.TEXTURE_3D&&(s=Math.max(s,i)),Math.round(Math.log(s)/Math.LN2)+1}wt.TEXTURE_UNIT_FOR_UPDATES=0;const x5e=new Map;function el(e,t=aj,r=dr,i=-1,s=1){let n=null;return t===G3?n=new Float32Array([i,i,0,0,s,i,1,0,i,s,0,1,s,s,1,1]):n=new Float32Array([i,i,s,i,i,s,s,s]),new Ed(e,r,{geometry:t},{geometry:rr.createVertex(e,gr.STATIC_DRAW,n)})}function T5e(e,t=aj,r=dr){const i=new Float32Array([-1,-1,3,-1,-1,3]);return new Ed(e,r,{geometry:t},{geometry:rr.createVertex(e,gr.STATIC_DRAW,i)})}const ofe=4;function afe(e,t=ofe){const r=new hr;return r.samplingMode=xt.NEAREST,r.width=r.height=t,new wt(e,r)}function S5e(e,t,r=ofe){const i=new Uint8Array(r*r*4);for(let n=0;n<i.length;n+=4)i[n]=255*t[0],i[n+1]=255*t[1],i[n+2]=255*t[2],i[n+3]=255*t[3];const s=new hr;return s.samplingMode=xt.NEAREST,s.width=s.height=r,new wt(e,s,i)}function lfe(e){const t=new hr;return t.samplingMode=xt.NEAREST,t.width=t.height=1,new wt(e,t,new Uint8Array([255,255,255,255]))}class GY{constructor(t,r){this._view=t,this.type=Do.Realistic,this._handles=new gi,this._passParameters=new p5e,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=Kt.radius,this._fadeHaze=0,this._tmpScale=Ne(),this._updateRadius(Kt.radius);const i=r.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([le(()=>this._view?.basemapTerrain?.rootTileElevationBounds,()=>this._view?.basemapTerrain?this._updateRootTileElevationBounds():null),le(()=>this._view?.basemapTerrain?.visibleElevationBounds,()=>this._view?.basemapTerrain?this._updateVisibleElevationBounds():null)]);const s=new uL;s.haze=!1,this._atmosphereTechnique=r.techniqueRepository.acquire(Mv,s),s.haze=!0,this._atmosphereHazeTechnique=r.techniqueRepository.acquire(Mv,s),s.reduced=!0,s.haze=!1,this._atmosphereReducedTechnique=r.techniqueRepository.acquire(Mv,s),s.haze=!0,this._atmosphereHazeReducedTechnique=r.techniqueRepository.acquire(Mv,s),this._vao=el(i,G3)}destroy(){this._handles.destroy(),this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._atmosphereReducedTechnique.release(),this._atmosphereHazeReducedTechnique.release(),this._vao.dispose()}render(t,r){this._render(t,r?this._atmosphereTechnique:this._atmosphereReducedTechnique,t.offscreenRenderingHelper.depthTexture,r,!1)}renderHaze(t,r,i){this._fadeHaze=r,this._render(t,i?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,t.offscreenRenderingHelper.linearDepthTexture,i,!0)}_render(t,r,i,s,n){if(i==null)return;const o=t.offscreenRenderingHelper;this._update(t.bindParameters.camera),this._passParameters.depthTexture=i;const a=o.background.color;se(this._passParameters.backgroundColor,a[0]*a[3],a[1]*a[3],a[2]*a[3]);const l=t.rctx.bindTechnique(r,this._passParameters,t.bindParameters);if(s)o.renderDepthDetached(()=>this._renderCommon(l,t));else{const c=t.rctx.getViewport(),u=Se(t.bindParameters.camera.eye)-Kt.radius;let d;if(u<w0){const y=Math.min(1,Math.max(0,u/w0));d=n?yt(.4,.5,y):yt(.2,.3,y)}else{const y=Math.min(1,Math.max(0,(u-w0)/(15*w0)));d=n?yt(.5,1,y):yt(.3,.6,y)}const p=Math.floor(d*t.bindParameters.camera.fullViewport[2]),g=Math.floor(d*t.bindParameters.camera.fullViewport[3]);t.rctx.setViewport(0,0,p,g),o.renderToTargets(()=>this._renderCommon(l,t),o.tmpColor,o.tmpDepth,[0,0,0,1],!1,!1),t.rctx.setViewport(c.x,c.y,c.width,c.height),Qt(this._tmpScale,p/t.bindParameters.camera.fullViewport[2],g/t.bindParameters.camera.fullViewport[3]),o.compositeAtmosphereToMain(t.bindParameters,n,i,this._tmpScale)}}_renderCommon(t,r){this._vao!=null&&(r.rctx.bindVAO(this._vao),t.assertCompatibleVertexAttributeLocations(this._vao),r.rctx.drawArrays(bt.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(t){return t*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const t=this._view.basemapTerrain.rootTileElevationBounds.min;t!==this._rootTileElevationMin&&(this._rootTileElevationMin=t,this._lowerBoundEarthRadius=Kt.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const t=this._adjustRadiusForTesselation(Kt.radius+this._view.basemapTerrain.visibleElevationBounds.min);t<this._lowerBoundEarthRadius&&this._updateRadius(t)}_updateRadius(t){this._lowerBoundEarthRadius=t,Qt(this._passParameters.radii,t,t+w0),this._passParameters.innerFadeDistance=2*Math.sqrt((2*t-fz)*fz)}_update(t){if(!t)return;const r=Bo(t.eye),i=Math.sqrt(r),s=r-this._passParameters.radii[1]*this._passParameters.radii[1],n=fe((i-this._passParameters.radii[0])/w0,0,1);pi(this._passParameters.heightParameters,i,r,s,n),this._passParameters.altitudeFade=nj(i-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=yt(yt(.6,1,QC(9500,10500,i-Kt.radius)),1,this._fadeHaze)}static isSupported(t){return t.renderContext.rctx.capabilities.depthTexture}}function cfe(e){e.fragment.code.add(b`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function dj(e,t){switch(e.include(zp,t),t.textureCoordinateType){case ws.Default:case ws.Compressed:return void e.fragment.code.add(b`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case ws.Atlas:return e.include(cfe),void e.fragment.code.add(b`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:t.textureCoordinateType;case ws.None:case ws.COUNT:return}}class Rc extends es{constructor(t,r){super(t,"vec3",jr.Draw,(i,s,n,o)=>i.setUniform3fv(t,r(s,n,o)))}}class zu extends es{constructor(t,r){super(t,"sampler2D",jr.Draw,(i,s,n)=>i.bindTexture(t,r(s,n)))}}class Ny{constructor(t){this._material=t.material,this._techniqueRepository=t.techniqueRep,this._output=t.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}get _markerTextureRepository(){return this._techniqueRepository.constructionContext.markerTextureRepository}ensureTechnique(t,r){return this._technique=this._techniqueRepository.releaseAndAcquire(t,this._material.getConfiguration(this._output,r),this._technique),this._technique}ensureResources(t){return _m.LOADED}}class pj extends Ny{constructor(t){super(t),this._numLoading=0,this._disposed=!1,this._textureRepository=t.textureRep,this._textureId=t.textureId,this._acquire(t.textureId,r=>this._texture=r),this._acquire(t.normalTextureId,r=>this._textureNormal=r),this._acquire(t.emissiveTextureId,r=>this._textureEmissive=r),this._acquire(t.occlusionTextureId,r=>this._textureOcclusion=r),this._acquire(t.metallicRoughnessTextureId,r=>this._textureMetallicRoughness=r)}dispose(){this._texture=Mi(this._texture),this._textureNormal=Mi(this._textureNormal),this._textureEmissive=Mi(this._textureEmissive),this._textureOcclusion=Mi(this._textureOcclusion),this._textureMetallicRoughness=Mi(this._textureMetallicRoughness),this._disposed=!0}ensureResources(t){return this._numLoading===0?_m.LOADED:_m.LOADING}get textureBindParameters(){return new ufe(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(t){this._texture!=null&&t===this._texture.id||(this._texture=Mi(this._texture),this._textureId=t,this._acquire(this._textureId,r=>this._texture=r))}_acquire(t,r){if(t==null)return void r(null);const i=this._textureRepository.acquire(t);if(zc(i))return++this._numLoading,void i.then(s=>{if(this._disposed)return Mi(s),void r(null);r(s)}).finally(()=>--this._numLoading);r(i)}}class ufe extends Wr{constructor(t=null,r=null,i=null,s=null,n=null){super(),this.texture=t,this.textureNormal=r,this.textureEmissive=i,this.textureOcclusion=s,this.textureMetallicRoughness=n}}var Qe;(function(e){e[e.Disabled=0]="Disabled",e[e.Normal=1]="Normal",e[e.Schematic=2]="Schematic",e[e.Water=3]="Water",e[e.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",e[e.Terrain=5]="Terrain",e[e.TerrainWithWater=6]="TerrainWithWater",e[e.COUNT=7]="COUNT"})(Qe||(Qe={}));function fj(e,t){const r=e.fragment,i=t.hasMetallicRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;if(t.pbrMode===Qe.Normal&&i&&e.include(dj,t),t.pbrMode!==Qe.Schematic)if(t.pbrMode!==Qe.Disabled){if(t.pbrMode===Qe.Normal){r.code.add(b`vec3 mrr;
vec3 emission;
float occlusion;`);const s=t.pbrTextureBindType;t.hasMetallicRoughnessTexture&&(r.uniforms.add(s===jr.Pass?new qe("texMetallicRoughness",n=>n.textureMetallicRoughness):new zu("texMetallicRoughness",n=>n.textureMetallicRoughness)),r.code.add(b`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),t.hasEmissionTexture&&(r.uniforms.add(s===jr.Pass?new qe("texEmission",n=>n.textureEmissive):new zu("texEmission",n=>n.textureEmissive)),r.code.add(b`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),t.hasOcclusionTexture?(r.uniforms.add(s===jr.Pass?new qe("texOcclusion",n=>n.textureOcclusion):new zu("texOcclusion",n=>n.textureOcclusion)),r.code.add(b`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):r.code.add(b`float getBakedOcclusion() { return 1.0; }`),s===jr.Pass?r.uniforms.add(new Rt("emissionFactor",n=>n.emissiveFactor),new Rt("mrrFactors",n=>n.mrrFactors)):r.uniforms.add(new Rc("emissionFactor",n=>n.emissiveFactor),new Rc("mrrFactors",n=>n.mrrFactors)),r.code.add(b`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${t.hasMetallicRoughnessTexture?b`applyMetallnessAndRoughness(${t.hasMetallicRoughnessTextureTransform?b`metallicRoughnessUV`:"vuv0"});`:""}

      ${t.hasEmissionTexture?b`applyEmission(${t.hasEmissiveTextureTransform?b`emissiveUV`:"vuv0"});`:""}

      ${t.hasOcclusionTexture?b`applyOcclusion(${t.hasOcclusionTextureTransform?b`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else r.code.add(b`float getBakedOcclusion() { return 1.0; }`);else r.code.add(b`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function mj(e,t){const r=e.fragment,i=t.lightingSphericalHarmonicsOrder!==void 0?t.lightingSphericalHarmonicsOrder:2;i===0?(r.uniforms.add(new Rt("lightingAmbientSH0",(s,n)=>se(jY,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),r.code.add(b`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===1?(r.uniforms.add(new Zt("lightingAmbientSH_R",(s,n)=>pi(_f,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new Zt("lightingAmbientSH_G",(s,n)=>pi(_f,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new Zt("lightingAmbientSH_B",(s,n)=>pi(_f,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))),r.code.add(b`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===2&&(r.uniforms.add(new Rt("lightingAmbientSH0",(s,n)=>se(jY,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new Zt("lightingAmbientSH_R1",(s,n)=>pi(_f,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new Zt("lightingAmbientSH_G1",(s,n)=>pi(_f,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new Zt("lightingAmbientSH_B1",(s,n)=>pi(_f,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new Zt("lightingAmbientSH_R2",(s,n)=>pi(_f,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new Zt("lightingAmbientSH_G2",(s,n)=>pi(_f,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new Zt("lightingAmbientSH_B2",(s,n)=>pi(_f,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))),r.code.add(b`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),t.pbrMode!==Qe.Normal&&t.pbrMode!==Qe.Schematic||r.code.add(b`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const jY=C(),_f=Ht();function j3(e){e.vertex.code.add(b`const float PI = 3.141592653589793;`),e.fragment.code.add(b`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var vs,E1;function E5e(e){return e?.cubeMap!=null}function gj(e){return e!=null&&!e.running}(function(e){e[e.RENDERING=0]="RENDERING",e[e.FINISHED_RENDERING=1]="FINISHED_RENDERING",e[e.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS",e[e.SWITCH_CHANNELS=3]="SWITCH_CHANNELS",e[e.FINISHED=4]="FINISHED"})(vs||(vs={})),function(e){e[e.RG=0]="RG",e[e.BA=1]="BA"}(E1||(E1={}));class C5e{constructor(){this.readChannels=E1.RG,this.renderingStage=vs.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=C(),this.isCameraPositionFinal=!0,this.parallax=new HY,this.parallaxNew=new HY,this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3},this.fadeInOut={stage:ln.FINISHED,factor:1,distanceThresholdFactor:.6},this.fadeIn={stage:El.FINISHED,factor:1,distanceThresholdFactor:2},this.fadeInOutHeight={stage:_y.FINISHED,factor:-1}}get isFading(){return this.fadeInOut.stage===ln.FADE_OUT||this.fadeInOut.stage===ln.FADE_IN||this.fadeIn.stage===El.FADE_IN||this.fadeInOutHeight.stage!==_y.FINISHED||this.renderingStage===vs.FADING_TEXTURE_CHANNELS}}var El,ln,_y;(function(e){e[e.FINISHED=0]="FINISHED",e[e.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",e[e.FADE_IN=2]="FADE_IN"})(El||(El={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.FADE_OUT=1]="FADE_OUT",e[e.SWITCH=2]="SWITCH",e[e.FADE_IN=3]="FADE_IN"}(ln||(ln={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.HEIGHT_FADE=1]="HEIGHT_FADE"}(_y||(_y={}));class HY{constructor(){this.anchorPointClouds=C(),this.cloudsHeight=1e5,this.radiusCurvatureCorrectionFactor=0,this.transform=be()}}class Bp extends es{constructor(t,r){super(t,"bool",jr.Pass,(i,s,n)=>i.setUniform1b(t,r(s,n)))}}class A5e extends es{constructor(t,r){super(t,"samplerCube",jr.Pass,(i,s,n)=>i.bindTexture(t,r(s,n)))}}function hfe(e){const t=e.fragment;t.uniforms.add(new Ci("rotationMatrixClouds",(r,i)=>i.cloudsFade.parallax.transform),new Ci("rotationMatrixCloudsCrossFade",(r,i)=>i.cloudsFade.parallaxNew.transform),new Rt("anchorPosition",(r,i)=>i.cloudsFade.parallax.anchorPointClouds),new Rt("anchorPositionCrossFade",(r,i)=>i.cloudsFade.parallaxNew.anchorPointClouds),new Ae("cloudsHeight",(r,i)=>i.cloudsFade.parallax.cloudsHeight),new Ae("radiusCurvatureCorrectionFactor",(r,i)=>i.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new Ae("totalFadeInOut",(r,i)=>i.cloudsFade.fadeInOut.stage===ln.FINISHED?i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeIn.factor:i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeInOut.factor),new Ae("crossFadeAnchorFactor",(r,i)=>fe(i.cloudsFade.crossFade.factor,0,1)),new A5e("cubeMap",(r,i)=>i.cloudsFade.data?.cubeMap?i.cloudsFade.data.cubeMap.colorTexture:null),new Bp("crossFade",(r,i)=>i.cloudsFade.crossFade.enabled),new Bp("readChannelsRG",(r,i)=>i.cloudsFade.readChannels===E1.RG),new Bp("fadeTextureChannels",(r,i)=>i.cloudsFade.renderingStage===vs.FADING_TEXTURE_CHANNELS)),t.constants.add("planetRadius","float",Kt.radius),t.code.add(b`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),t.code.add(b`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),t.code.add(b`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),Zm(t),hf(t),t.code.add(b`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),t.code.add(b`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),t.code.add(b`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),t.code.add(b`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),t.code.add(b`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function df(e){e.code.add(b`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function O5e(){const e=new pr;e.attributes.add(E.POSITION,"vec2"),e.varyings.add("worldRay","vec3");const{vertex:t,fragment:r}=e;return t.uniforms.add(new Ci("inverseProjectionMatrix",(i,s)=>s.camera.inverseProjectionMatrix),new Ci("inverseViewMatrix",(i,s)=>m2(R5e,s.camera.viewMatrix))),t.code.add(b`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),r.include(df),r.include(Hl),e.include(mj,{pbrMode:Qe.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(j3),e.include(NN),e.include(lL),e.include(hfe,{instancedDoublePrecision:!1}),r.uniforms.add(new Rt("cameraPosition",(i,s)=>s.camera.eye)),r.code.add(b`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),e}const R5e=be(),P5e=Object.freeze(Object.defineProperty({__proto__:null,build:O5e},Symbol.toStringTag,{value:"Module"}));class UN extends xr{constructor(t){super(t,new Yo,()=>this.destroy())}initializeProgram(t){return new vr(t.rctx,UN.shader.get().build(),dr)}initializePipeline(){return Tt({blending:oo(ve.ONE,ve.ZERO,ve.SRC_ALPHA,ve.ONE),depthTest:{func:Hr.LEQUAL},colorWrite:It})}}UN.shader=new _r(P5e,()=>ue(()=>import("./CloudsComposition.glsl.66ab952d.js"),[]));let X_=class extends xe{constructor(e){super(e),this._technique=new UN(e),this._vao=el(e.rctx)}destroy(){this._technique=Mi(this._technique),this._vao=De(this._vao)}render(e){const t=e.bindParameters.cloudsFade;if(this._vao==null||t.data==null)return;if(!this._technique.compiled)return void this.requestRender();const r=e.rctx.bindTechnique(this._technique,M5e,e.bindParameters);e.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(bt.TRIANGLE_STRIP,0,4)}};h([f({constructOnly:!0})],X_.prototype,"rctx",void 0),h([f({constructOnly:!0})],X_.prototype,"viewingMode",void 0),h([f({constructOnly:!0})],X_.prototype,"planetRadius",void 0),h([f({constructOnly:!0})],X_.prototype,"requestRender",void 0),X_=h([F("esri.views.3d.environment.CloudsComposition")],X_);const M5e=new Wr;function Ku(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function I5e(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function yj(e,t,r,i,s,n,o,a,l,c){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e}function _j(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Qu(e,t){if(e===t){const r=t[1],i=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function nb(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=u*o-a*c,p=-u*n+a*l,g=c*n-o*l;let y=r*d+i*p+s*g;return y?(y=1/y,e[0]=d*y,e[1]=(-u*i+s*c)*y,e[2]=(a*i-s*o)*y,e[3]=p*y,e[4]=(u*r-s*l)*y,e[5]=(-a*r+s*n)*y,e[6]=g*y,e[7]=(-c*r+i*l)*y,e[8]=(o*r-i*n)*y,e):null}function $5e(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return e[0]=o*u-a*c,e[1]=s*c-i*u,e[2]=i*a-s*o,e[3]=a*l-n*u,e[4]=r*u-s*l,e[5]=s*n-r*a,e[6]=n*c-o*l,e[7]=i*l-r*c,e[8]=r*o-i*n,e}function L5e(e){const t=e[0],r=e[1],i=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*(c*n-o*l)+r*(-c*s+o*a)+i*(l*s-n*a)}function AT(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],p=r[0],g=r[1],y=r[2],_=r[3],v=r[4],w=r[5],T=r[6],x=r[7],S=r[8];return e[0]=p*i+g*o+y*c,e[1]=p*s+g*a+y*u,e[2]=p*n+g*l+y*d,e[3]=_*i+v*o+w*c,e[4]=_*s+v*a+w*u,e[5]=_*n+v*l+w*d,e[6]=T*i+x*o+S*c,e[7]=T*s+x*a+S*u,e[8]=T*n+x*l+S*d,e}function hL(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],p=r[0],g=r[1];return e[0]=i,e[1]=s,e[2]=n,e[3]=o,e[4]=a,e[5]=l,e[6]=p*i+g*o+c,e[7]=p*s+g*a+u,e[8]=p*n+g*l+d,e}function vj(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],p=Math.sin(r),g=Math.cos(r);return e[0]=g*i+p*o,e[1]=g*s+p*a,e[2]=g*n+p*l,e[3]=g*o-p*i,e[4]=g*a-p*s,e[5]=g*l-p*n,e[6]=c,e[7]=u,e[8]=d,e}function bj(e,t,r){const i=r[0],s=r[1],n=r[2];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=n*t[6],e[7]=n*t[7],e[8]=n*t[8],e}function D5e(e,t,r){const i=r[0],s=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e}function N5e(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function F5e(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function U5e(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function k5e(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function wj(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=r+r,a=i+i,l=s+s,c=r*o,u=i*o,d=i*a,p=s*o,g=s*a,y=s*l,_=n*o,v=n*a,w=n*l;return e[0]=1-d-y,e[3]=u-w,e[6]=p+v,e[1]=u+w,e[4]=1-c-y,e[7]=g-_,e[2]=p-v,e[5]=g+_,e[8]=1-c-d,e}function dfe(e,t){const r=t[0],i=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10],d=u*o-a*c,p=-u*n+a*l,g=c*n-o*l,y=r*d+i*p+s*g;if(!y)return null;const _=1/y;return e[0]=d*_,e[1]=(-u*i+s*c)*_,e[2]=(a*i-s*o)*_,e[3]=p*_,e[4]=(u*r-s*l)*_,e[5]=(-a*r+s*n)*_,e[6]=g*_,e[7]=(-c*r+i*l)*_,e[8]=(o*r-i*n)*_,e}function vy(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=t[9],p=t[10],g=t[11],y=t[12],_=t[13],v=t[14],w=t[15],T=r*a-i*o,x=r*l-s*o,S=r*c-n*o,O=i*l-s*a,A=i*c-n*a,$=s*c-n*l,P=u*_-d*y,U=u*v-p*y,I=u*w-g*y,L=d*v-p*_,N=d*w-g*_,Z=p*w-g*v;let W=T*Z-x*N+S*L+O*I-A*U+$*P;return W?(W=1/W,e[0]=(a*Z-l*N+c*L)*W,e[1]=(l*I-o*Z-c*U)*W,e[2]=(o*N-a*I+c*P)*W,e[3]=(s*N-i*Z-n*L)*W,e[4]=(r*Z-s*I+n*U)*W,e[5]=(i*I-r*N-n*P)*W,e[6]=(_*$-v*A+w*O)*W,e[7]=(v*S-y*$-w*x)*W,e[8]=(y*A-_*S+w*T)*W,e):null}function z5e(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function B5e(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function V5e(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)}function G5e(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e}function pfe(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}function j5e(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e}function H5e(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e}function W5e(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function q5e(e,t){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=t[0],p=t[1],g=t[2],y=t[3],_=t[4],v=t[5],w=t[6],T=t[7],x=t[8],S=Ta();return Math.abs(r-d)<=S*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(i-p)<=S*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(s-g)<=S*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(n-y)<=S*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(o-_)<=S*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(a-v)<=S*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-w)<=S*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(c-T)<=S*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(u-x)<=S*Math.max(1,Math.abs(u),Math.abs(x))}function xj(e){const t=Ta(),r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return Math.abs(1-(r*r+n*n+l*l))<=t&&Math.abs(1-(i*i+o*o+c*c))<=t&&Math.abs(1-(s*s+a*a+u*u))<=t}const X5e=AT,Z5e=pfe;Object.freeze(Object.defineProperty({__proto__:null,add:G5e,adjoint:$5e,copy:I5e,determinant:L5e,equals:q5e,exactEquals:W5e,frob:V5e,fromMat2d:k5e,fromMat4:Ku,fromQuat:wj,fromRotation:F5e,fromScaling:U5e,fromTranslation:N5e,identity:_j,invert:nb,isOrthoNormal:xj,mul:X5e,multiply:AT,multiplyScalar:j5e,multiplyScalarAndAdd:H5e,normalFromMat4:vy,normalFromMat4Legacy:dfe,projection:z5e,rotate:vj,scale:bj,scaleByVec2:D5e,set:yj,str:B5e,sub:Z5e,subtract:pfe,translate:hL,transpose:Qu},Symbol.toStringTag,{value:"Module"}));function Yi(){return new Float32Array(3)}function dL(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Br(e,t,r){const i=new Float32Array(3);return i[0]=e,i[1]=t,i[2]=r,i}function ffe(e,t){return new Float32Array(e,t,3)}function Tj(){return Yi()}function mfe(){return Br(1,1,1)}function gfe(){return Br(1,0,0)}function yfe(){return Br(0,1,0)}function _fe(){return Br(0,0,1)}const Y5e=Tj(),J5e=mfe(),K5e=gfe(),Q5e=yfe(),eFe=_fe();Object.freeze(Object.defineProperty({__proto__:null,ONES:J5e,UNIT_X:K5e,UNIT_Y:Q5e,UNIT_Z:eFe,ZEROS:Y5e,clone:dL,create:Yi,createView:ffe,fromValues:Br,ones:mfe,unitX:gfe,unitY:yfe,unitZ:_fe,zeros:Tj},Symbol.toStringTag,{value:"Module"}));var qa;(function(e){e[e.SIXTEEN=0]="SIXTEEN",e[e.HUNDRED=1]="HUNDRED",e[e.TWOHUNDRED=2]="TWOHUNDRED",e[e.COUNT=3]="COUNT"})(qa||(qa={}));class rI extends Yo{constructor(){super(...arguments),this.steps=qa.SIXTEEN,this.writeTextureChannels=E1.RG}}h([B({count:qa.COUNT})],rI.prototype,"steps",void 0),h([B({constValue:ne("esri-mobile")?1024:2048})],rI.prototype,"cubeMapSize",void 0),h([B()],rI.prototype,"writeTextureChannels",void 0);class RE{constructor(t,r,i,s,n,o,a,l,c=.5){this.coverage=t,this.density=r,this.absorption=i,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}}const WY=new RE([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],qa.SIXTEEN),Lo={sunny:WY,cloudy:new RE([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],qa.TWOHUNDRED,.6),rainy:new RE([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],qa.TWOHUNDRED,.4),snowy:new RE([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],qa.HUNDRED,.65),foggy:new RE([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],qa.SIXTEEN),default:WY},wu=ne("esri-mobile")?64:128,tFe=wu/128,zh=Math.ceil(Math.sqrt(wu)),sy=(wu+2)*zh,rFe=1e5,MF=128,iFe=sy/1560;function ih(e,t=!0){e.attributes.add(E.POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.code.add(b`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?b`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}class CA extends es{constructor(t,r){super(t,"mat3",jr.Draw,(i,s,n)=>i.setUniformMatrix3fv(t,r(s,n)))}}class vfe extends Wr{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=Lo.default.raymarchingSteps,this.weatherTile=Ne()}}class bfe extends Wr{constructor(){super(...arguments),this.viewMatrix=$i()}}function sFe(e){const t=new pr;t.include(ih,!1);const r=t.fragment;return r.uniforms.add(new Ae("cloudRadius",i=>i.cloudRadius),new Ae("power",i=>yt(35,120,i.absorption)),new Ae("sigmaE",i=>1+i.absorption),new Ae("density",i=>yt(0,.3,i.density)),new Ae("cloudSize",i=>yt(0,.02,Math.max(.01,1-i.cloudSize))),new Ae("detailSize",i=>yt(0,.2,Math.max(.01,1-i.detailSize))),new Ae("smoothness",i=>yt(0,.5,1-i.smoothness)),new Ae("cloudHeight",i=>yt(0,1500,i.cloudHeight)),new Ae("coverage",i=>i.coverage),new CA("view",i=>i.viewMatrix),new qe("cloudShapeTexture",i=>i.noiseTexture!=null?i.noiseTexture.textureAtlas:null),new yr("cloudVariables",i=>Qt(nFe,i.coverage,i.absorption))),r.constants.add("halfCubeMapSize","float",.5*e.cubeMapSize),r.code.add(b`
    const int STEPS = ${e.steps===qa.SIXTEEN?b`16`:e.steps===qa.HUNDRED?b`100`:b`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),r.code.add(b`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${b.float(sy)};
      const float dataWidth = ${b.float(sy)};
      const float tileRows = ${b.float(zh)};
      const vec3 atlasDimensions = vec3(${b.float(wu)}, ${b.float(wu)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${b.float(tFe)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${b.float(iFe)} * p) / ${b.float(sy)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),r.code.add(b`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),r.code.add(b`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),r.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),r.code.add(b`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),r.code.add(b`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),r.code.add(b`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),t}const nFe=Ne(),oFe=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:bfe,CloudsPassParameters:vfe,build:sFe},Symbol.toStringTag,{value:"Module"}));class kN extends xr{constructor(t,r){super(t,r,()=>this.destroy())}initializeProgram(t){return new vr(t.rctx,kN.shader.get().build(this.configuration),dr)}initializePipeline(){return Tt({blending:Vl(ve.CONSTANT_COLOR,ve.ONE_MINUS_CONSTANT_COLOR,Jp.ADD,this.configuration.writeTextureChannels===E1.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Hr.LEQUAL},colorWrite:It})}}kN.shader=new _r(oFe,()=>ue(()=>import("./Clouds.glsl.fe16f647.js"),[]));var wc;(function(e){e[e.Full=0]="Full",e[e.WeatherMap=1]="WeatherMap",e[e.COUNT=2]="COUNT"})(wc||(wc={}));class _z extends Yo{constructor(){super(...arguments),this.mode=wc.Full}}h([B({count:wc.COUNT})],_z.prototype,"mode",void 0);class wfe extends Wr{constructor(){super(...arguments),this.weatherTile=or(0,0)}}function aFe(e){const t=new pr;return t.include(ih,!1),t.fragment.code.add(b`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),e.mode===wc.Full&&t.fragment.code.add(b`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${b.float(zh)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${b.float(8)});

      float worley0 = worley(p, ${b.float(2)} * 2.0);
      float worley1 = worley(p, ${b.float(2)} * 8.0);
      float worley2 = worley(p, ${b.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${b.float(2)});
      float worley1 = worley(p, ${b.float(2)} * 2.0);
      float worley2 = worley(p, ${b.float(2)} * 4.0);
      float worley3 = worley(p, ${b.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),t.fragment.uniforms.add(new yr("weatherTile",r=>r.weatherTile)),t.fragment.code.add(b`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${b.float(MF)});

      // Get global coordinates of p
      p += weatherTile * ${b.float(MF)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${b.float(rFe)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),t.fragment.code.add(b`void main() {`),e.mode===wc.Full&&t.fragment.code.add(b`
        float padWidth = 1.0;
        float paddedSize = ${b.float(wu)} + 2.0 * padWidth;
        float tileCount = ${b.float(zh)} * ${b.float(zh)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${b.float(wu)};
          }

          if (startPadY) {
            pixel.y += ${b.float(wu)};
          }

          if (endPadX) {
            pixel.x -= ${b.float(wu)};
          }

          if (endPadY) {
            pixel.y -= ${b.float(wu)};
          }

          uv = vec2(pixel.xy / ${b.float(wu)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${b.float(wu)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${b.float(zh)} * ${b.float(zh)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${b.float(zh)} * ${b.float(zh)});
        p = p_;
        p.z /= (${b.float(zh)} * ${b.float(zh)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),t.fragment.code.add(b`
      vec2 mapUV = ${b.float(MF)} * (gl_FragCoord.xy / ${b.float(sy)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${e.mode===wc.Full?b`fragColor.ba = vec2(0.0, map);`:b`fragColor = vec4(map);`};
    }
  `),t}const lFe=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:wfe,build:aFe},Symbol.toStringTag,{value:"Module"}));class AA extends xr{initializeProgram(t){return new vr(t.rctx,AA.shader.get().build(this.configuration),dr)}initializePipeline(){return Tt({blending:this.configuration.mode===wc.Full?Vl(ve.ONE,ve.ZERO):oo(ve.ZERO,ve.ONE,ve.ONE,ve.ZERO),depthTest:{func:Hr.ALWAYS},colorWrite:It})}}AA.shader=new _r(lFe,()=>ue(()=>import("./NoiseTextureAtlas.glsl.d11d7dc1.js"),[]));class pL{constructor(t,r,i=r){this.internalFormat=t,this.width=r,this.height=i,this.multisampled=!1,this.samples=1}}function cFe(e){return e.width<=0||e.height<=0||e.internalFormat==null?0:e.width*e.height*uj(e.internalFormat)}class uFe{constructor(t,r){this._context=t,this._descriptor=r,this.type=yy.RenderBuffer,this._context.instanceCounter.increment(mn.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=r;if(a){if(this._context.type!==tr.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,o,s,n)}else i.renderbufferStorage(i.RENDERBUFFER,o,s,n)}get descriptor(){return this._descriptor}get samples(){const t=this._descriptor.samples,r=this._context.parameters.maxSamples;return t?Math.min(t,r):r}get gpuMemoryUsage(){return cFe(this._descriptor)}resize(t,r){const i=this._descriptor;if(i.width===t&&i.height===r)return;i.width=t,i.height=r;const s=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):s.renderbufferStorage(s.RENDERBUFFER,i.internalFormat,i.width,i.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(mn.Renderbuffer,this),this._context=s2(this._context))}}const hFe=K.getLogger("esri.views.webgl.FramebufferObject");class Bi{constructor(t,r,i=null){this._context=t,this._glName=null,this._colorAttachments=new Map,this._depthBuffer=null,this._stencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,t.instanceCounter.increment(mn.FramebufferObject,this);const s=iI(r)?r:new wt(this._context,r);if(this._colorAttachments.set(cc.COLOR_ATTACHMENT0,s),this._validateTextureDescriptor(s.descriptor),this._validateColorAttachmentPoint(cc.COLOR_ATTACHMENT0),i!=null)if(pFe(i))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),this._depthStencilTexture=iI(i)?i:new wt(this._context,i),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const n=dFe(i)?i:new uFe(this._context,i),o=n.descriptor;o.internalFormat===Ns.STENCIL_INDEX8?this._stencilBuffer=n:this._depthBuffer=n,this._validateRenderBufferDescriptor(o)}}dispose(){if(this._colorAttachments.size===0&&!this._glName)return;const t=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((r,i)=>this.detachColorTexture(i)?.dispose()),this.detachDepthStencilBuffer()?.dispose(),this.detachDepthStencilTexture()?.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(t),this._context.instanceCounter.decrement(mn.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(cc.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthBuffer||this._stencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._colorAttachments.get(cc.COLOR_ATTACHMENT0)?.descriptor?.width??0}get height(){return this._colorAttachments.get(cc.COLOR_ATTACHMENT0)?.descriptor?.height??0}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((t,[r,i])=>t+i.gpuMemoryUsage,this.depthStencilAttachment?.gpuMemoryUsage??0)}getColorTexture(t){const r=this._colorAttachments.get(t);return r&&iI(r)?r:null}attachColorTexture(t,r=cc.COLOR_ATTACHMENT0){if(!t)return;this._validateColorAttachmentPoint(r);const i=t.descriptor;this._validateTextureDescriptor(i),this.detachColorTexture(r)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,r)),this._colorAttachments.set(r,t)}detachColorTexture(t=cc.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(t);if(r)return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)),this._colorAttachments.delete(t),r}setColorTextureTarget(t,r=cc.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(r);i&&this._framebufferTexture2D(i.glName,r,t)}attachDepthStencil(t){if(t)switch(t.type){case yy.Texture:return this._attachDepthStencilTexture(t);case yy.RenderBuffer:return this._attachDepthStencilBuffer(t)}}_attachDepthStencilTexture(t){if(t==null)return;const r=t.descriptor;r.pixelFormat!==vt.DEPTH_STENCIL&&r.pixelFormat!==vt.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),r.dataType!==Is.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),this._validateTextureDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,$Y)),this._depthStencilTexture?.dispose(),this._depthStencilTexture=t}detachDepthStencilTexture(){const t=this._depthStencilTexture;return t&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,$Y)),this._depthStencilTexture=null,t}_attachDepthStencilBuffer(t){if(t==null)return;const r=t.descriptor;if(r.internalFormat!==Ns.DEPTH_STENCIL&&r.internalFormat!==Ns.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),this._validateRenderBufferDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl,s=this._getGLAttachmentPoint(r);i.framebufferRenderbuffer(Qn.FRAMEBUFFER,s,i.RENDERBUFFER,t.glName)}this._depthBuffer?.dispose(),this._depthBuffer=t}detachDepthStencilBuffer(){const t=this._depthBuffer;if(t&&this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,i=this._getGLAttachmentPoint(t.descriptor);r.framebufferRenderbuffer(Qn.FRAMEBUFFER,i,r.RENDERBUFFER,null),t.dispose()}return this._depthBuffer=null,t}copyToTexture(t,r,i,s,n,o,a){(t<0||r<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=a.descriptor;a.descriptor.target!==Ji.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(l?.width==null||l?.height==null||t+i>this.width||r+s>this.height||n+i>l.width||o+s>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,u=c.bindTexture(a,wt.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(wt.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(Ji.TEXTURE_2D,0,n,o,t,r,i,s),c.bindTexture(u,wt.TEXTURE_UNIT_FOR_UPDATES)}readPixels(t,r,i,s,n,o,a){(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(t,r,i,s,n,o,a)}async readPixelsAsync(t,r,i,s,n,o,a){if(this._context.type!==tr.WEBGL2)return yu()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(t,r,i,s,n,o,a);const l=this._context.gl,c=rr.createPixelPack(this._context,gr.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(t,r,i,s,n,o,0),this._context.unbindBuffer(gt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(t,r){if(this.width===t&&this.height===r)return;const i={width:t,height:r};Iv(i,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(s=>s.resize(i.width,i.height)),this._depthStencilTexture?.resize(i.width,i.height),this._initialized&&(Iv(i,this._context.parameters.maxRenderbufferSize),this._depthBuffer?.resize(i.width,i.height),this._stencilBuffer?.resize(i.width,i.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(t=Qn.FRAMEBUFFER){const r=this._context.gl;if(this._initialized)return void r.bindFramebuffer(t,this.glName);this._glName&&r.deleteFramebuffer(this._glName);const i=r.createFramebuffer();r.bindFramebuffer(t,i),this._colorAttachments.forEach((n,o)=>this._framebufferTexture2D(n.glName,o,qY(n),t));const s=this._depthBuffer||this._stencilBuffer;if(s){const n=this._getGLAttachmentPoint(s.descriptor);r.framebufferRenderbuffer(t,n,r.RENDERBUFFER,s.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,r.DEPTH_STENCIL_ATTACHMENT,qY(this._depthStencilTexture),t);yu()&&r.checkFramebufferStatus(t)!==r.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=i,this._initialized=!0}_framebufferTexture2D(t,r=cc.COLOR_ATTACHMENT0,i=Ji.TEXTURE_2D,s=Qn.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,r,i,t,n)}_disposeDepthStencilAttachments(){const t=this._context.gl;if(this._depthBuffer){if(this._initialized){this._context.bindFramebuffer(this);const r=this._getGLAttachmentPoint(this._depthBuffer.descriptor);t.framebufferRenderbuffer(Qn.FRAMEBUFFER,r,t.RENDERBUFFER,null)}this._depthBuffer=De(this._depthBuffer)}this._stencilBuffer&&(this._initialized&&(this._context.bindFramebuffer(this),t.framebufferRenderbuffer(Qn.FRAMEBUFFER,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,null)),this._stencilBuffer=De(this._stencilBuffer)),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=De(this._depthStencilTexture))}_validateTextureDescriptor(t){t.target!==Ji.TEXTURE_2D&&t.target!==Ji.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),Iv(t,this._context.parameters.maxTextureSize),this._validateBufferDimensions(t)}_validateRenderBufferDescriptor(t){Iv(t,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(t)}_validateBufferDimensions(t){t.width<=0&&(t.width=this.width),t.height<=0&&(t.height=this.height),this.width>0&&this.height>0&&(this.width===t.width&&this.height===t.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(t){switch(t.internalFormat){case Ns.DEPTH_COMPONENT16:case Ns.DEPTH_COMPONENT24:case Ns.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case Ns.DEPTH24_STENCIL8:case Ns.DEPTH32F_STENCIL8:case Ns.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case Ns.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(t){if(Bi._MAX_COLOR_ATTACHMENTS===-1){const i=this._context.capabilities.drawBuffers;if(i){const s=this._context.gl;Bi._MAX_COLOR_ATTACHMENTS=s.getParameter(i.MAX_COLOR_ATTACHMENTS)}else Bi._MAX_COLOR_ATTACHMENTS=1}const r=t-cc.COLOR_ATTACHMENT0;r+1>Bi._MAX_COLOR_ATTACHMENTS&&K.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${r+1}. Implementation supports up to ${Bi._MAX_COLOR_ATTACHMENTS} color attachments`)}}function iI(e){return e!=null&&"type"in e&&e.type===yy.Texture}function dFe(e){return e!=null&&"type"in e&&e.type===yy.RenderBuffer}function pFe(e){return iI(e)||e!=null&&"pixelFormat"in e}function Iv(e,t){const r=Math.max(e.width,e.height);if(r>t){hFe.warn(`Resizing FBO attachment size ${e.width}x${e.height} to device limit ${t}`);const i=t/r;return e.width=Math.round(e.width*i),e.height=Math.round(e.height*i),!1}return!0}function qY(e){return e.descriptor.target===Ji.TEXTURE_CUBE_MAP?Ji.TEXTURE_CUBE_MAP_POSITIVE_X:Ji.TEXTURE_2D}Bi._MAX_COLOR_ATTACHMENTS=-1;let PE=class extends xe{constructor(e){super(e),this._needsRender=!0,this._passParameters=new wfe,this._frameBuffer=new Bi(e.context.renderContext.rctx,new hr(sy)),this._vao=el(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return this._texture!=null?this._weatherMapTechnique!=null&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(wc.WeatherMap)):this._fullTechnique!=null&&this._fullTechnique.compiled&&(this._texture=this._render(wc.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(en(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=Mi(this._fullTechniqueCached),this._weatherMapTechniqueCached=Mi(this._weatherMapTechniqueCached),this._frameBuffer=De(this._frameBuffer),this._vao=De(this._vao)}get _fullTechnique(){if(this._fullTechniqueCached==null){const e=new _z;e.mode=wc.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(AA,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(this._weatherMapTechniqueCached==null){const e=new _z;e.mode=wc.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(AA,e)}return this._weatherMapTechniqueCached}_render(e){if(this._vao==null||this._frameBuffer==null)return null;const t=e===wc.Full?this._fullTechnique:this._weatherMapTechnique,r=this.context.renderContext.rctx,i=r.getViewport();r.setViewport(0,0,sy,sy),r.bindFramebuffer(this._frameBuffer);const s=r.bindTechnique(t,this._passParameters,null);return r.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.setViewport(i.x,i.y,i.width,i.height),this._needsRender=!1,this._frameBuffer.colorTexture}};h([f({constructOnly:!0})],PE.prototype,"context",void 0),h([f({readOnly:!0})],PE.prototype,"_techniqueRepository",null),PE=h([F("esri.views.3d.environment.NoiseTextureAtlas")],PE);function xfe(e){e.include(Uc),e.uniforms.add(new qe("geometryDepthTexture",(t,r)=>r.multipassGeometry.linearDepthTexture),new yr("nearFar",(t,r)=>r.camera.nearFar)),e.code.add(b`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}class fFe{constructor(){this.enabled=!1}}function kc(e,t){t.hasMultipassTerrain&&(e.fragment.include(Uc),e.fragment.uniforms.add(new qe("terrainDepthTexture",(r,i)=>i.multipassTerrain.linearDepthTexture)),e.fragment.uniforms.add(new yr("nearFar",(r,i)=>i.camera.nearFar)),e.fragment.uniforms.add(new yr("inverseViewport",(r,i)=>i.inverseViewport)),e.fragment.code.add(b`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${t.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}class mFe{constructor(){this.enabled=!1,this.cullAboveGround=!1}}function gFe(e,t){const r=e.fragment;r.include(Uc),r.uniforms.add(new yr("nearFar",(i,s)=>s.camera.nearFar)),r.uniforms.add(new qe("depthMap",(i,s)=>s.linearDepthTexture)),r.uniforms.add(new Ci("proj",(i,s)=>s.ssr.camera.projectionMatrix)),r.uniforms.add(new Ae("invResolutionHeight",(i,s)=>1/s.ssr.camera.height)),r.uniforms.add(new Ci("reprojectionMatrix",(i,s)=>s.ssr.reprojectionMatrix)),r.code.add(b`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${t.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}class yFe{constructor(){this.enabled=!1,this.fadeFactor=1,this.reprojectionMatrix=be()}}function zN(e){return e?{ray:Dn(e.ray),c0:e.c0,c1:e.c1}:{ray:Dn(),c0:0,c1:Number.MAX_VALUE}}function _Fe(e,t=zN()){return rL(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function vFe(e,t,r=zN()){const i=Se(e.vector);return Rde(e.origin,t,r.ray),r.c0=0,r.c1=i,r}function eft(e,t){return Tfe(e,e.c0,t)}function tft(e,t){return Tfe(e,e.c1,t)}function Tfe(e,t,r){return oe(r,e.ray.origin,te(r,e.ray.direction,t))}new qm(()=>zN());function OA(e){return e?[Sr(e[0]),Sr(e[1]),Sr(e[2]),Sr(e[3]),Sr(e[4]),Sr(e[5])]:[Sr(),Sr(),Sr(),Sr(),Sr(),Sr()]}function Sfe(){return[C(),C(),C(),C(),C(),C(),C(),C()]}function fL(e,t){for(let r=0;r<b2;r++)AN(e[r],t[r])}function Efe(e,t,r,i=EFe){const s=Jr($G.get(),t,e);Fn(s,s);for(let n=0;n<TFe;++n){const o=xc(IG.get(),SFe[n],s);se(i[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}Cfe(r,i)}function Cfe(e,t){ko(t[We.FAR_BOTTOM_LEFT],t[We.NEAR_BOTTOM_LEFT],t[We.NEAR_TOP_LEFT],e[ti.LEFT]),ko(t[We.NEAR_BOTTOM_RIGHT],t[We.FAR_BOTTOM_RIGHT],t[We.FAR_TOP_RIGHT],e[ti.RIGHT]),ko(t[We.FAR_BOTTOM_LEFT],t[We.FAR_BOTTOM_RIGHT],t[We.NEAR_BOTTOM_RIGHT],e[ti.BOTTOM]),ko(t[We.NEAR_TOP_LEFT],t[We.NEAR_TOP_RIGHT],t[We.FAR_TOP_RIGHT],e[ti.TOP]),ko(t[We.NEAR_BOTTOM_LEFT],t[We.NEAR_BOTTOM_RIGHT],t[We.NEAR_TOP_RIGHT],e[ti.NEAR]),ko(t[We.FAR_BOTTOM_RIGHT],t[We.FAR_BOTTOM_LEFT],t[We.FAR_TOP_LEFT],e[ti.FAR])}function Z0(e,t){for(let r=0;r<b2;r++){const i=e[r];if(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]>=t[3])return!1}return!0}function bFe(e,t){return Ofe(e,_Fe(t,Rfe.get()))}function rft(e,t){for(let r=0;r<b2;r++){const i=e[r];if(!iLe(i,t))return!1}return!0}function wFe(e,t,r){return Ofe(e,vFe(t,r,Rfe.get()))}function Afe(e,t){for(let r=0;r<b2;r++)if(ri(e[r],t)>0)return!1;return!0}function Ofe(e,t){for(let r=0;r<b2;r++)if(!rLe(e[r],t))return!1;return!0}var ti,We;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.TOP=3]="TOP",e[e.NEAR=4]="NEAR",e[e.FAR=5]="FAR"})(ti||(ti={})),function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(We||(We={}));const xFe={bottom:[We.FAR_BOTTOM_RIGHT,We.NEAR_BOTTOM_RIGHT,We.NEAR_BOTTOM_LEFT,We.FAR_BOTTOM_LEFT],near:[We.NEAR_BOTTOM_LEFT,We.NEAR_BOTTOM_RIGHT,We.NEAR_TOP_RIGHT,We.NEAR_TOP_LEFT],far:[We.FAR_BOTTOM_RIGHT,We.FAR_BOTTOM_LEFT,We.FAR_TOP_LEFT,We.FAR_TOP_RIGHT],right:[We.NEAR_BOTTOM_RIGHT,We.FAR_BOTTOM_RIGHT,We.FAR_TOP_RIGHT,We.NEAR_TOP_RIGHT],left:[We.FAR_BOTTOM_LEFT,We.NEAR_BOTTOM_LEFT,We.NEAR_TOP_LEFT,We.FAR_TOP_LEFT],top:[We.FAR_TOP_LEFT,We.NEAR_TOP_LEFT,We.NEAR_TOP_RIGHT,We.FAR_TOP_RIGHT]},b2=6,TFe=8,SFe=[At(-1,-1,-1,1),At(1,-1,-1,1),At(1,1,-1,1),At(-1,1,-1,1),At(-1,-1,1,1),At(1,-1,1,1),At(1,1,1,1),At(-1,1,1,1)],Rfe=new qm(zN),EFe=Sfe();function CFe(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/t)}function AFe(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/r)}function OFe(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}function RFe(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}var vz;let lt=vz=class extends xe{constructor(e={}){super(e),this._center=C(),this._up=C(),this._viewUp=C(),this._viewForward=C(),this._viewRight=C(),this._ray=Dn(),this._viewport=At(0,0,1,1),this._padding=At(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=or(1,1e3),this._viewDirty=!0,this._viewMatrix=be(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=be(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=be(),this._frustumDirty=!0,this._frustum=OA(),this._fullViewport=Ht(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(e){this._pixelRatio=e>0?e:1}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center,"_center")}get ray(){return ce(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){Ss(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const e=t1(Ht(),this._viewport,1/this.pixelRatio),t=this._get("screenViewport");return t&&JI(e,t)?t:e}get screenPadding(){if(this.pixelRatio===1)return this._padding;const e=t1(Ht(),this._padding,1/this.pixelRatio),t=this._get("screenPadding");return t&&JI(e,t)?t:e}get x(){return this._viewport[0]}set x(e){e+=this._padding[Gt.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(e){e+=this._padding[Gt.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[Gt.RIGHT]+this._padding[Gt.LEFT]}set fullWidth(e){this.width=e-(this._padding[Gt.RIGHT]+this._padding[Gt.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[Gt.TOP]+this._padding[Gt.BOTTOM]}set fullHeight(e){this.height=e-(this._padding[Gt.TOP]+this._padding[Gt.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[Gt.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[Gt.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){Tx(this._padding,e)||(this._viewport[0]+=e[Gt.LEFT]-this._padding[Gt.LEFT],this._viewport[1]+=e[Gt.BOTTOM]-this._padding[Gt.BOTTOM],this._viewport[2]-=e[Gt.RIGHT]+e[Gt.LEFT]-(this._padding[Gt.RIGHT]+this._padding[Gt.LEFT]),this._viewport[3]-=e[Gt.TOP]+e[Gt.BOTTOM]-(this._padding[Gt.TOP]+this._padding[Gt.BOTTOM]),$u(this._padding,e),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Jr(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const e=this.width,t=this.height,r=this.near*Math.tan(this.fovY/2),i=r*this._aspect,s=Phe(be(),-i*(1+2*this._padding[Gt.LEFT]/e),i*(1+2*this._padding[Gt.RIGHT]/e),-r*(1+2*this._padding[Gt.BOTTOM]/t),r*(1+2*this._padding[Gt.TOP]/t),this.near,this.far),n=this._get("projectionMatrix");return n&&wG(n,s)?n:s}get inverseProjectionMatrix(){return Fn(be(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||be()}get fov(){return this._fov}set fov(e){this._fov=e,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return OFe(this._fov,this.width,this.height)}set fovX(e){this._fov=CFe(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return RFe(this._fov,this.width,this.height)}set fovY(e){this._fov=AFe(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return ni(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Fn(this._viewInverseTransposeMatrix,this.viewMatrix),Bl(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(e){re(this._ray.origin,e.eye),this.center=e.center,this.up=e.up,$u(this._viewport,e.viewport),this.notifyChange("_viewport"),$u(this._padding,e.padding),this.notifyChange("_padding"),en(this._nearFar,e.nearFar),this.notifyChange("_nearFar"),this._fov=e.fov,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||(Ss(this._viewMatrix,e.viewMatrix),re(this._viewRight,e.viewRight),re(this._viewUp,e.viewUp),re(this._viewForward,e.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||(fL(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Ss(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),$u(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up}clone(){return new vz().copyFrom(this)}equals(e){return Go(this.eye,e.eye)&&Go(this.center,e.center)&&Go(this.up,e.up)&&Tx(this._viewport,e.viewport)&&Tx(this._padding,e.padding)&&Vpe(this.nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}almostEquals(e){if(Math.abs(e.fov-this._fov)>=.001||YI(e.screenPadding,this.screenPadding)>=1||YI(this.screenViewport,e.screenViewport)>=1)return!1;Ln(Ao,e.eye,e.center),Ln(IF,this.eye,this.center);const t=de(Ao,IF),r=c8(Ao),i=c8(IF),s=5e-4;return t*t>=(1-1e-10)*r*i&&ED(e.eye,this.eye)<Math.max(r,i)*s*s}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}_viewDirectionDistance(e){return Math.abs(_C(this.viewForward,ce(Ao,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=zi()){return e[0]=(this.padding[Gt.LEFT]+this.width/2)/this.pixelRatio,e[1]=(this.padding[Gt.TOP]+this.height/2)/this.pixelRatio,e}getRenderCenter(e,t=.5,r=.5){return e[0]=this.padding[Gt.LEFT]+this.width*t,e[1]=this.padding[Gt.BOTTOM]+this.height*r,e[2]=.5,e}setGLViewport(e){const t=this.viewport,r=this.padding;e.setViewport(t[0]-r[3],t[1]-r[2],t[2]+r[1]+r[3],t[3]+r[0]+r[2])}applyProjection(e,t){e!==Vt&&re(Vt,e),Vt[3]=1,xc(Vt,Vt,this.projectionMatrix);const r=Math.abs(Vt[3]);te(Vt,Vt,1/r);const i=this.fullViewport;t[0]=yt(0,i[0]+i[2],.5+.5*Vt[0]),t[1]=yt(0,i[1]+i[3],.5+.5*Vt[1]),t[2]=.5*(Vt[2]+1),t[3]=r}unapplyProjection(e,t){const r=this.fullViewport;Vt[0]=(e[0]/(r[0]+r[2])*2-1)*e[3],Vt[1]=(e[1]/(r[1]+r[3])*2-1)*e[3],Vt[2]=(2*e[2]-1)*e[3],Vt[3]=e[3],this.inverseProjectionMatrix!=null&&(xc(Vt,Vt,this.inverseProjectionMatrix),t[0]=Vt[0],t[1]=Vt[1],t[2]=Vt[2])}projectToScreen(e,t){return this.projectToRenderScreen(e,$F),this.renderToScreen($F,t),t}projectToRenderScreen(e,t){if(Vt[0]=e[0],Vt[1]=e[1],Vt[2]=e[2],Vt[3]=1,xc(Vt,Vt,this.viewProjectionMatrix),Vt[3]===0)return null;te(Vt,Vt,1/Math.abs(Vt[3]));const r=this.fullViewport;return"x"in t?(t.x=yt(0,r[0]+r[2],.5+.5*Vt[0]),t.y=yt(0,r[1]+r[3],.5+.5*Vt[1])):(t[0]=yt(0,r[0]+r[2],.5+.5*Vt[0]),t[1]=yt(0,r[1]+r[3],.5+.5*Vt[1]),t.length>2&&(t[2]=.5*(Vt[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,$F),t)}unprojectFromRenderScreen(e,t){if(Jr(aR,this.projectionMatrix,this.viewMatrix),!Fn(aR,aR))return null;const r=this.fullViewport;return Vt[0]=2*(e[0]-r[0])/r[2]-1,Vt[1]=2*(e[1]-r[1])/r[3]-1,Vt[2]=2*e[2]-1,Vt[3]=1,xc(Vt,Vt,aR),Vt[3]===0?null:(t[0]=Vt[0]/Vt[3],t[1]=Vt[1]/Vt[3],t[2]=Vt[2]/Vt[3],t)}constrainWindowSize(e,t,r,i){const s=e*this.pixelRatio,n=t*this.pixelRatio,o=Math.max(s-r/2,0),a=Math.max(this.fullHeight-n-i/2,0),l=-Math.min(s-r/2,0),c=-Math.min(this.fullHeight-n-i/2,0);return[o,a,r-l- -Math.min(this.fullWidth-s-r/2,0),i-c- -Math.min(n-i/2,0)]}computeUp(e){e===Ie.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(e,t){const r=e[0]*this.pixelRatio,i=this.fullHeight-e[1]*this.pixelRatio;return t[0]=r,t[1]=i,t}renderToScreen(e,t){const r=e[0]/this.pixelRatio,i=(this.fullHeight-e[1])/this.pixelRatio;t[0]=r,t[1]=i}_computeUpGlobal(){ce(Ao,this.center,this.eye);const e=Se(this.center);e<1?(se(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(de(Ao,this.center))>.9999*Se(Ao)*e||(rt(this._up,Ao,this.center),rt(this._up,this._up,Ao),pe(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){Hm(Ao,this.eye,this.center),Math.abs(Ao[2])<=.9999&&(te(Ao,Ao,Ao[2]),se(this._up,-Ao[0],-Ao[1],1-Ao[2]),pe(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(e,t,r=""){typeof e[0]=="number"&&isFinite(e[0])&&typeof e[1]=="number"&&isFinite(e[1])&&typeof e[2]=="number"&&isFinite(e[2])?Go(e,t)||(re(t,e),this._markViewDirty(),r.length&&this.notifyChange(r)):K.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(Efe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(_N(this._viewMatrix,this.eye,this.center,this.up),se(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),se(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),se(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};h([f()],lt.prototype,"_center",void 0),h([f()],lt.prototype,"_up",void 0),h([f()],lt.prototype,"_viewport",void 0),h([f()],lt.prototype,"_padding",void 0),h([f()],lt.prototype,"_fov",void 0),h([f()],lt.prototype,"_nearFar",void 0),h([f()],lt.prototype,"_pixelRatio",void 0),h([f()],lt.prototype,"pixelRatio",null),h([f()],lt.prototype,"eye",null),h([f()],lt.prototype,"center",null),h([f()],lt.prototype,"up",null),h([f({readOnly:!0})],lt.prototype,"nearFar",null),h([f()],lt.prototype,"near",null),h([f()],lt.prototype,"far",null),h([f()],lt.prototype,"viewport",null),h([f({readOnly:!0})],lt.prototype,"screenViewport",null),h([f({readOnly:!0})],lt.prototype,"screenPadding",null),h([f()],lt.prototype,"x",null),h([f()],lt.prototype,"y",null),h([f()],lt.prototype,"width",null),h([f()],lt.prototype,"height",null),h([f()],lt.prototype,"fullWidth",null),h([f()],lt.prototype,"fullHeight",null),h([f({readOnly:!0})],lt.prototype,"_aspect",null),h([f()],lt.prototype,"padding",null),h([f({readOnly:!0})],lt.prototype,"projectionMatrix",null),h([f({readOnly:!0})],lt.prototype,"inverseProjectionMatrix",null),h([f()],lt.prototype,"fov",null),h([f()],lt.prototype,"fovX",null),h([f()],lt.prototype,"fovY",null),lt=vz=h([F("esri.views.3d.webgl-engine.lib.Camera")],lt);const Vt=Ht(),aR=be(),Ao=C(),IF=C(),$F=xo();var Gt;(function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"})(Gt||(Gt={}));var ae;(function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",e[e.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",e[e.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",e[e.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",e[e.LASERLINES=12]="LASERLINES",e[e.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",e[e.HUD_MATERIAL=14]="HUD_MATERIAL",e[e.LABEL_MATERIAL=15]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=16]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",e[e.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",e[e.DRAPED_WATER=19]="DRAPED_WATER",e[e.VOXEL=20]="VOXEL",e[e.MAX_SLOTS=21]="MAX_SLOTS"})(ae||(ae={}));var tt;(function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.FrontFace=2]="FrontFace",e[e.NONE=3]="NONE",e[e.COUNT=4]="COUNT"})(tt||(tt={}));class Sj{constructor(t=C()){this.intensity=t}}class Pfe{constructor(t=C(),r=Ce(.57735,.57735,.57735)){this.intensity=t,this.direction=r}}class mL{constructor(t=C(),r=Ce(.57735,.57735,.57735),i=!0,s=1,n=1){this.intensity=t,this.direction=r,this.castShadows=i,this.specularStrength=s,this.environmentStrength=n}}class Mfe{constructor(){this.r=[0],this.g=[0],this.b=[0]}}function PFe(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]*t[i];return r}function LF(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]*t;return r}function Ix(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]+t[i];return r}function Ife(e){return(e+1)*(e+1)}function MFe(e){return fe(Math.floor(Math.sqrt(e)-1),0,2)}function $fe(e,t,r){const i=e[0],s=e[1],n=e[2],o=r||[];return o.length=Ife(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*i,o[2]=.4886025119*n,o[3]=.4886025119*s),t>=2&&(o[4]=1.09254843059*i*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*i*n,o[8]=.54627421529*(i*i-s*s)),o}function IFe(e,t){const r=Ife(e),i=t||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let s=0;s<r;s++)i.r[s]=i.g[s]=i.b[s]=0;return i}function $Fe(e,t){const r=MFe(t.r.length);for(const i of e)Wo(bz,i.direction),$fe(bz,r,am),PFe(am,sI),LF(am,i.intensity[0],bb),Ix(t.r,bb),LF(am,i.intensity[1],bb),Ix(t.g,bb),LF(am,i.intensity[2],bb),Ix(t.b,bb);return t}function LFe(e,t){$fe(bz,0,am);for(const r of e)t.r[0]+=am[0]*sI[0]*r.intensity[0]*4*Math.PI,t.g[0]+=am[0]*sI[0]*r.intensity[1]*4*Math.PI,t.b[0]+=am[0]*sI[0]*r.intensity[2]*4*Math.PI;return t}function DFe(e,t,r,i){IFe(t,i),se(r.intensity,0,0,0);let s=!1;const n=NFe,o=FFe,a=UFe;n.length=0,o.length=0,a.length=0;for(const l of e)l instanceof mL&&!s?(re(r.direction,l.direction),re(r.intensity,l.intensity),r.specularStrength=l.specularStrength,r.environmentStrength=l.environmentStrength,r.castShadows=l.castShadows,s=!0):l instanceof mL||l instanceof Pfe?n.push(l):l instanceof Sj?o.push(l):l instanceof Mfe&&a.push(l);$Fe(n,i),LFe(o,i);for(const l of a)Ix(i.r,l.r),Ix(i.g,l.g),Ix(i.b,l.b)}const NFe=[],FFe=[],UFe=[],am=[0],bb=[0],bz=C(),sI=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];class XY{constructor(){this.color=C(),this.intensity=1}}class kFe{constructor(){this.direction=C(),this.ambient=new XY,this.diffuse=new XY}}const Lfe=.4;class DF{constructor(){this._shOrder=2,this._legacy=new kFe,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new Mfe,this._mainLight=new mL(C(),Ce(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(t){DFe(t,this._shOrder,this._mainLight,this._sphericalHarmonics),re(this._legacy.direction,this._mainLight.direction);const r=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*r,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*r,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*r,te(this._legacy.diffuse.color,this._mainLight.intensity,r),re(lR,this._legacy.diffuse.color),te(lR,lR,Lfe*this.globalFactor),oe(this._legacy.ambient.color,this._legacy.ambient.color,lR)}copyFrom(t){this._sphericalHarmonics.r=Array.from(t.sh.r),this._sphericalHarmonics.g=Array.from(t.sh.g),this._sphericalHarmonics.b=Array.from(t.sh.b),re(this._mainLight.direction,t.mainLight.direction),re(this._mainLight.intensity,t.mainLight.intensity),this._mainLight.castShadows=t.mainLight.castShadows,this._mainLight.specularStrength=t.mainLight.specularStrength,this._mainLight.environmentStrength=t.mainLight.environmentStrength,this.globalFactor=t.globalFactor,this.noonFactor=t.noonFactor}lerpLighting(t,r,i){if(Lr(this._mainLight.intensity,t.mainLight.intensity,r.mainLight.intensity,i),this._mainLight.environmentStrength=yt(t.mainLight.environmentStrength,r.mainLight.environmentStrength,i),this._mainLight.specularStrength=yt(t.mainLight.specularStrength,r.mainLight.specularStrength,i),re(this._mainLight.direction,r.mainLight.direction),this._mainLight.castShadows=r.mainLight.castShadows,this.globalFactor=yt(t.globalFactor,r.globalFactor,i),this.noonFactor=yt(t.noonFactor,r.noonFactor,i),t.sh.r.length===r.sh.r.length)for(let s=0;s<r.sh.r.length;s++)this._sphericalHarmonics.r[s]=yt(t.sh.r[s],r.sh.r[s],i),this._sphericalHarmonics.g[s]=yt(t.sh.g[s],r.sh.g[s],i),this._sphericalHarmonics.b[s]=yt(t.sh.b[s],r.sh.b[s],i);else for(let s=0;s<r.sh.r.length;s++)this._sphericalHarmonics.r[s]=r.sh.r[s],this._sphericalHarmonics.g[s]=r.sh.g[s],this._sphericalHarmonics.b[s]=r.sh.b[s]}}const lR=C();class BN{constructor(t,r,i){this.shadowMap=t,this.ssaoHelper=r,this.slicePlane=i,this.slot=ae.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=tt.NONE,this.alignPixelEnabled=!1,this._camera=new lt,this._inverseViewport=Ne(),this.oldLighting=new DF,this.newLighting=new DF,this._fadedLighting=new DF,this._lighting=this.newLighting,this.ssr=new yFe,this.multipassTerrain=new mFe,this.multipassGeometry=new fFe,this.overlays=[],this.cloudsFade=new C5e}get camera(){return this._camera}set camera(t){this._camera=this.ssr.camera=t,this._inverseViewport[0]=1/t.fullViewport[2],this._inverseViewport[1]=1/t.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(t){const{oldLighting:r,newLighting:i}=this;t>=1?this._lighting=i:(this._fadedLighting.lerpLighting(r,i,t),this._lighting=this._fadedLighting)}}let Na=class extends xe{constructor(e){super(e),this._handles=new gi,this._techniques=new Array,this._techniqueConfiguration=new rI,this._bindParameters=new BN(null,null,null),this._passParameters=new vfe,this._drawParameters=new bfe,this._weatherTile=Ne(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=yt(Lo.default.coverage[0],Lo.default.coverage[1],.5),this.density=yt(Lo.default.density[0],Lo.default.density[1],.5),this.absorption=yt(Lo.default.absorption[0],Lo.default.absorption[1],.5),this.cloudSize=yt(Lo.default.cloudSize[0],Lo.default.cloudSize[1],.5),this.detailSize=yt(Lo.default.detailSize[0],Lo.default.detailSize[1],.5),this.smoothness=yt(Lo.default.smoothness[0],Lo.default.smoothness[1],.5),this.cloudHeight=yt(Lo.default.cloudHeight[0],Lo.default.cloudHeight[1],.5),this.raymarchingSteps=Lo.default.raymarchingSteps,this._viewMatrix=be(),this._dirty=!1,this.running=!1,this._vao=el(e.context.renderContext.rctx)}_getTechnique(e){const t=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,r=t===E1.RG?2*e:2*e+1;return this._techniques[r]||(this._techniqueConfiguration.writeTextureChannels=t,this._techniqueConfiguration.steps=e,this._techniques[r]=new kN({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[r])}updateWeatherTile(){const e=this.view.camera.position.latitude,t=this.view.camera.position.longitude;if(e==null||t==null)return;Qt(this._weatherTile,(e+90)/180,(t+180)/360);const r=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-r)*this._weatherTile[1]);let i=0,s=0;if(this.view.environment!=null&&this.view.environment.lighting.type!=="virtual"&&this.view.environment.lighting.date!=null){const n=new Date(this.view.environment.lighting.date);n.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),i=31*n.getUTCMonth()+n.getUTCDate(),s=n.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+i)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+s%100)%(4*this._weatherTileCount),Gpe(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){const e=Mr(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this._handles.add([this.view.resourceController.scheduler.registerTask(at.CLOUDS_GENERATOR,this),le(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),Rr)])}destroy(){this._handles.destroy(),this._techniques.forEach(e=>Mi(e)),this._frameBufferCube=De(this._frameBufferCube),this._techniques.length=0,this._vao.dispose(),this._passParameters.noiseTexture=Re(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case qa.SIXTEEN:return 1;case qa.HUNDRED:return 4;case qa.COUNT:case qa.TWOHUNDRED:return 8}}_ensureNoiseTexture(){if(this._passParameters.noiseTexture!=null)this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new PE({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return this._passParameters.noiseTexture.textureAtlas!=null}_ensureFrameBufferCube(e){if(this._frameBufferCube==null){const t=new hr(e);t.target=Ji.TEXTURE_CUBE_MAP,t.wrapMode=Ct.CLAMP_TO_EDGE,this._frameBufferCube=new Bi(this.context.renderContext.rctx,t)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=De(this._frameBufferCube)}applyPreset(e,t){const r=e.median,i=s=>{const n=yt(s[0],s[1],r);return t<.5?yt(s[0],n,2*t):yt(n,s[1],2*(t-.5))};this.coverage=i(e.coverage),this.density=i(e.density),this.absorption=i(e.absorption),this.cloudSize=i(e.cloudSize),this.detailSize=i(e.detailSize),this.smoothness=i(e.smoothness),this.cloudHeight=i(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),en(this._passParameters.weatherTile,this._weatherTile));const t=this._getTechnique(this._passParameters.raymarchingSteps);if(!t.compiled||!this.context.renderContext.bindParameters.cloudsFade.isCameraPositionFinal||this.context.renderContext.bindParameters.cloudsFade.isFading||!this._ensureNoiseTexture())return Eo.YIELD;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=vs.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const r=this.context.renderContext.rctx,i=r.bindTechnique(t,this._passParameters,this._bindParameters);r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao);const s=r.getViewport(),n=t.configuration.cubeMapSize,o=n/this._tilesPerFace,a=this._tileIndex*o;r.setViewport(0,a,n,o);const l=this._ensureFrameBufferCube(n);r.bindFramebuffer(l);const c=zFe[this._faceIndex],u=BFe[this._faceIndex];Ihe(this._viewMatrix,VFe,c,u),Ku(this._drawParameters.viewMatrix,this._viewMatrix);const d=Ji.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return l.setColorTextureTarget(d),i.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.gl.flush(),r.setViewport(s.x,s.y,s.width,s.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.context.renderContext.bindParameters.cloudsFade.renderingStage=vs.FINISHED_RENDERING):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),Eo.YIELD}};h([f({constructOnly:!0})],Na.prototype,"context",void 0),h([f({constructOnly:!0})],Na.prototype,"view",void 0),h([f({constructOnly:!0})],Na.prototype,"requestRender",void 0),h([f()],Na.prototype,"coverage",void 0),h([f()],Na.prototype,"density",void 0),h([f()],Na.prototype,"absorption",void 0),h([f()],Na.prototype,"cloudSize",void 0),h([f()],Na.prototype,"detailSize",void 0),h([f()],Na.prototype,"smoothness",void 0),h([f()],Na.prototype,"cloudHeight",void 0),h([f()],Na.prototype,"raymarchingSteps",void 0),h([f()],Na.prototype,"running",void 0),Na=h([F("esri.views.3d.environment.CloudsGenerator")],Na);const zFe=[Br(1,0,0),Br(-1,0,0),Br(0,1,0),Br(0,-1,0),Br(0,0,1)],BFe=[Br(0,1,0),Br(0,1,0),Br(0,0,-1),Br(0,0,1),Br(0,1,0)],VFe=Tj();class Dfe extends Wr{constructor(){super(...arguments),this.fogColor=C(),this.fogStrength=4e-6,this.atmosphereC=1,this.fogAmount=0}}function GFe(){const e=new pr;e.attributes.add(E.POSITION,"vec2"),e.include(zp,{textureCoordinateType:ws.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:t,fragment:r}=e;return t.uniforms.add(new Ci("inverseProjectionMatrix",(i,s)=>s.camera.inverseProjectionMatrix),new Ci("inverseViewMatrix",(i,s)=>m2(jFe,s.camera.viewMatrix))),t.code.add(b`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new Ae("atmosphereC",i=>i.atmosphereC),new Rt("cameraPosition",(i,s)=>s.camera.eye),new yr("nearFar",(i,s)=>s.camera.nearFar),new qe("depthTexture",i=>i.depthTexture),new Ae("fogStrength",i=>i.fogStrength),new Ae("fogAmount",i=>i.fogAmount),new Rt("fogColor",i=>i.fogColor)),e.include(NN),r.include(Uc),r.code.add(b`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(b`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(b`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`),e}const jFe=be(),HFe=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:Dfe,build:GFe},Symbol.toStringTag,{value:"Module"}));class VN extends xr{constructor(t){super(t,new Yo,()=>this.destroy())}initializeProgram(t){return new vr(t.rctx,VN.shader.get().build(),dr)}initializePipeline(){return Tt({blending:oo(ve.SRC_ALPHA,ve.ZERO,ve.ONE_MINUS_SRC_ALPHA,ve.ONE),colorWrite:It})}}VN.shader=new _r(HFe,()=>ue(()=>import("./Fog.glsl.d2a36f31.js"),[]));const WFe=.95,qFe=1;let Z_=class extends xe{constructor(e){super(e),this._passParameters=new Dfe;const t=e.context.renderContext.rctx;this._vao=el(t,G3),this._technique=new VN(e);const r=Mr(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+w0}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,t){if(this._update(e,t),this._passParameters.fogAmount<=0)return;const r=this._technique;if(!r.compiled)return void this.context.requestRender();const i=e.offscreenRenderingHelper;i.renderDepthDetached(()=>{this._passParameters.depthTexture=i.depthTexture;const s=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);this._renderFog(s,e)})}_renderFog(e,t){const r=t.rctx;r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(bt.TRIANGLE_STRIP,0,4)}_update(e,t){const r=e.bindParameters.camera;pe(ZY,r.eye);const i=Math.max(0,de(ZY,e.bindParameters.lighting.mainLight.direction)),s=t.color;te(YY,s,.1),Lr(this._passParameters.fogColor,YY,s,i);const n=Se(r.eye),o=n*n;this._passParameters.atmosphereC=o-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-QC(WFe*bp,qFe*bp,Math.abs(n-this._planetRadius)))*t.amount,this._passParameters.fogStrength=t.strength}static isSupported(e){return e.capabilities.depthTexture}};h([f({constructOnly:!0})],Z_.prototype,"context",void 0),h([f({constructOnly:!0})],Z_.prototype,"view",void 0),h([f({constructOnly:!0})],Z_.prototype,"rctx",void 0),h([f({constructOnly:!0})],Z_.prototype,"viewingMode",void 0),Z_=h([F("esri.views.3d.environment.Fog")],Z_);class XFe{constructor(){this.color=C(),this.strength=0,this.amount=0}}const ZY=C(),YY=C();class bo extends Yo{}h([B({constValue:!0})],bo.prototype,"hasSliceHighlight",void 0),h([B({constValue:!1})],bo.prototype,"hasSliceInVertexProgram",void 0),h([B({constValue:!1})],bo.prototype,"instancedDoublePrecision",void 0),h([B({constValue:!1})],bo.prototype,"hasModelTransformation",void 0),h([B({constValue:jr.Pass})],bo.prototype,"pbrTextureBindType",void 0);var Kp;(function(e){e[e.Cone=0]="Cone",e[e.Cylinder=1]="Cylinder",e[e.Underground=2]="Underground",e[e.COUNT=3]="COUNT"})(Kp||(Kp={}));class Ej extends bo{constructor(){super(...arguments),this.geometry=Kp.Cone}}h([B({count:Kp.COUNT})],Ej.prototype,"geometry",void 0);var D;(function(e){e[e.Color=0]="Color",e[e.Depth=1]="Depth",e[e.Normal=2]="Normal",e[e.Shadow=3]="Shadow",e[e.ShadowHighlight=4]="ShadowHighlight",e[e.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",e[e.Highlight=6]="Highlight",e[e.Alpha=7]="Alpha",e[e.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",e[e.COUNT=9]="COUNT"})(D||(D={}));function H3(e){e.attributes.add(E.POSITION,"vec3"),e.vertex.code.add(b`vec3 positionModel() { return position; }`)}function gL({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(b`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(b`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}class sh extends es{constructor(t,r){super(t,"mat3",jr.Pass,(i,s,n)=>i.setUniformMatrix3fv(t,r(s,n)))}}function $x(e,t){e.include(H3);const r=e.vertex;r.include(gL,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),r.uniforms.add(new Rt("transformWorldFromViewTH",i=>i.transformWorldFromViewTH),new Rt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new sh("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new Ci("transformProjFromView",i=>i.transformProjFromView),new CA("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new Rc("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new Rc("transformWorldFromModelTL",i=>i.transformWorldFromModelTL)),r.code.add(b`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(b`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?b`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:b`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),e.fragment.uniforms.add(new Rt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL)),r.code.add(b`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),e.fragment.code.add(b`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class Nfe extends Wr{constructor(){super(...arguments),this.transformWorldFromViewTH=C(),this.transformWorldFromViewTL=C(),this.transformViewFromCameraRelativeRS=$i(),this.transformProjFromView=be()}}class Ffe extends Wr{constructor(){super(...arguments),this.transformWorldFromModelRS=$i(),this.transformWorldFromModelTH=C(),this.transformWorldFromModelTL=C()}}function by(e){e.varyings.add("linearDepth","float")}function C1(e){e.vertex.uniforms.add(new yr("nearFar",(t,r)=>r.camera.nearFar))}function GN(e){e.vertex.code.add(b`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function w2(e,t){const{vertex:r}=e;switch(t.output){case D.Color:if(t.receiveShadows)return by(e),void r.code.add(b`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case D.Depth:case D.Shadow:case D.ShadowHighlight:case D.ShadowExcludeHighlight:return e.include($x,t),by(e),C1(e),GN(e),void r.code.add(b`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}r.code.add(b`void forwardLinearDepth() {}`)}function Xa(e){GN(e),e.vertex.code.add(b`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),e.vertex.code.add(b`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}class Cj extends Wr{constructor(){super(...arguments),this.texV=Ne(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new Ufe}}class Ufe{constructor(){this.center=C(),this.v1=C(),this.v2=C()}}function ZFe(e){const t=new pr,{vertex:r,fragment:i}=t;if(Zm(r),e.geometry===Kp.Underground)t.attributes.add(E.POSITION,"vec2"),t.varyings.add("color","vec4"),r.uniforms.add(new Rt("cameraPosition",(s,n)=>n.camera.eye),new Ae("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)),r.code.add(b`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),i.code.add(b`void main() {
fragColor = color;
}`);else{t.include(Xa,e),t.attributes.add(E.POSITION,"vec3"),t.varyings.add("vtc","vec2"),t.varyings.add("falloff","float");const s=e.geometry===Kp.Cylinder;r.uniforms.add(new Ci("proj",(a,l)=>l.camera.projectionMatrix),new Ci("view",(a,l)=>l.camera.viewMatrix)),s||(t.varyings.add("innerFactor","float"),r.uniforms.add(new Rt("silCircleCenter",a=>a.silhouette.center)),r.uniforms.add(new Rt("silCircleV1",a=>a.silhouette.v1)),r.uniforms.add(new Rt("silCircleV2",a=>a.silhouette.v2)),r.uniforms.add(new yr("texV",a=>a.texV)),r.uniforms.add(new Ae("innerScale",a=>a.innerScale)));const n=6.2831853,o=1/128;r.code.add(b`
		void main(void) {
      ${s?b`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:b`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${b.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${b.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),i.uniforms.add(new qe("tex",a=>a.texture)),s||i.uniforms.add(new Ae("altitudeFade",a=>a.altitudeFade)),i.code.add(b`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${s?b`fragColor = atmosphereColor;`:b`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return t}const YFe=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:Ufe,SimpleAtmospherePassParameters:Cj,build:ZFe},Symbol.toStringTag,{value:"Module"}));class OT extends xr{initializeProgram(t){return new vr(t.rctx,OT.shader.get().build(this.configuration),dr)}initializePipeline(){return this.configuration.geometry===Kp.Cylinder?Tt({blending:oo(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),culling:oj,depthTest:{func:Hr.LEQUAL},colorWrite:It}):Tt({blending:oo(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),depthTest:{func:Hr.LEQUAL},colorWrite:It})}}OT.shader=new _r(YFe,()=>ue(()=>import("./SimpleAtmosphere.glsl.0eb5b4b2.js"),[]));const JFe=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function Wl(e,t=0){const r=e.stride;return Array.from(e.fields.keys()).filter(i=>{const s=e.fields.get(i)?.optional;return!(s&&s.glPadding)}).map(i=>{const s=e.fields.get(i),n=s.constructor.ElementCount,o=KFe(s.constructor.ElementType),a=s.offset,l=!(!s.optional||!s.optional.glNormalized);return new io(i,n,o,a,r,l,t)})}function KFe(e){const t=QFe[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const QFe={u8:Ze.UNSIGNED_BYTE,u16:Ze.UNSIGNED_SHORT,u32:Ze.UNSIGNED_INT,i8:Ze.BYTE,i16:Ze.SHORT,i32:Ze.INT,f32:Ze.FLOAT};class Aj{constructor(t,r,i=0,s,n){this.TypedArrayConstructor=t,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,s,this.stride,s+i*this.stride)}getMat(t,r){let i=t*this.typedBufferStride;for(let s=0;s<9;s++)r[s]=this.typedBuffer[i++];return r}setMat(t,r){let i=t*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[i++]=r[s]}get(t,r){return this.typedBuffer[t*this.typedBufferStride+r]}set(t,r,i){this.typedBuffer[t*this.typedBufferStride+r]=i}copyFrom(t,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=t*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}Aj.ElementCount=9;class Oj{constructor(t,r,i=0,s,n){this.TypedArrayConstructor=t,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,s,this.stride,s+i*this.stride)}getMat(t,r){let i=t*this.typedBufferStride;for(let s=0;s<16;s++)r[s]=this.typedBuffer[i++];return r}setMat(t,r){let i=t*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[i++]=r[s]}get(t,r){return this.typedBuffer[t*this.typedBufferStride+r]}set(t,r,i){this.typedBuffer[t*this.typedBufferStride+r]=i}copyFrom(t,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=t*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}Oj.ElementCount=16;class Km{constructor(t,r,i=0,s,n){this.TypedArrayConstructor=t,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.stride=s,this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(t,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,s,this.stride,s+i*this.stride)}get(t){return this.typedBuffer[t*this.typedBufferStride]}set(t,r){this.typedBuffer[t*this.typedBufferStride]=r}get buffer(){return this.typedBuffer.buffer}}Km.ElementCount=1;class Qm{constructor(t,r,i=0,s,n){this.TypedArrayConstructor=t,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,s,this.stride,s+i*this.stride)}getVec(t,r){return t*=this.typedBufferStride,Qt(r,this.typedBuffer[t],this.typedBuffer[t+1])}setVec(t,r){t*=this.typedBufferStride,this.typedBuffer[t++]=r[0],this.typedBuffer[t]=r[1]}get(t,r){return this.typedBuffer[t*this.typedBufferStride+r]}set(t,r,i){this.typedBuffer[t*this.typedBufferStride+r]=i}setValues(t,r,i){t*=this.typedBufferStride,this.typedBuffer[t++]=r,this.typedBuffer[t]=i}copyFrom(t,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=t*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}Qm.ElementCount=2;class eg{constructor(t,r,i=0,s,n){this.TypedArrayConstructor=t,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,s,this.stride,s+i*this.stride)}getVec(t,r){return t*=this.typedBufferStride,se(r,this.typedBuffer[t],this.typedBuffer[t+1],this.typedBuffer[t+2])}setVec(t,r){t*=this.typedBufferStride,this.typedBuffer[t++]=r[0],this.typedBuffer[t++]=r[1],this.typedBuffer[t]=r[2]}get(t,r){return this.typedBuffer[t*this.typedBufferStride+r]}set(t,r,i){this.typedBuffer[t*this.typedBufferStride+r]=i}setValues(t,r,i,s){t*=this.typedBufferStride,this.typedBuffer[t++]=r,this.typedBuffer[t++]=i,this.typedBuffer[t]=s}copyFrom(t,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=t*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}eg.ElementCount=3;class tg{constructor(t,r,i=0,s,n){this.TypedArrayConstructor=t,this.start=i,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,s,this.stride,s+i*this.stride)}getVec(t,r){return t*=this.typedBufferStride,pi(r,this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t])}setVec(t,r){t*=this.typedBufferStride,this.typedBuffer[t++]=r[0],this.typedBuffer[t++]=r[1],this.typedBuffer[t++]=r[2],this.typedBuffer[t]=r[3]}get(t,r){return this.typedBuffer[t*this.typedBufferStride+r]}set(t,r,i){this.typedBuffer[t*this.typedBufferStride+r]=i}setValues(t,r,i,s,n){t*=this.typedBufferStride,this.typedBuffer[t++]=r,this.typedBuffer[t++]=i,this.typedBuffer[t++]=s,this.typedBuffer[t]=n}copyFrom(t,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=t*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}tg.ElementCount=4;class x2 extends Km{constructor(t,r=0,i,s){super(Float32Array,t,r,i,s),this.elementType="f32"}static fromTypedArray(t,r){return new x2(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}x2.ElementType="f32";class bd extends Qm{constructor(t,r=0,i,s){super(Float32Array,t,r,i,s),this.elementType="f32"}slice(t,r){return this.sliceBuffer(bd,t,r)}static fromTypedArray(t,r){return new bd(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}bd.ElementType="f32";class Es extends eg{constructor(t,r=0,i,s){super(Float32Array,t,r,i,s),this.elementType="f32"}slice(t,r){return this.sliceBuffer(Es,t,r)}static fromTypedArray(t,r){return new Es(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Es.ElementType="f32";class Gl extends tg{constructor(t,r=0,i,s){super(Float32Array,t,r,i,s),this.elementType="f32"}slice(t,r){return this.sliceBuffer(Gl,t,r)}static fromTypedArray(t,r){return new Gl(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Gl.ElementType="f32";class wd extends Aj{constructor(t,r=0,i,s){super(Float32Array,t,r,i,s),this.elementType="f32"}slice(t,r){return this.sliceBuffer(wd,t,r)}static fromTypedArray(t,r){return new wd(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}wd.ElementType="f32";class RT extends Aj{constructor(t,r=0,i,s){super(Float64Array,t,r,i,s),this.elementType="f64"}slice(t,r){return this.sliceBuffer(RT,t,r)}static fromTypedArray(t,r){return new RT(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}RT.ElementType="f64";class PT extends Oj{constructor(t,r=0,i,s){super(Float32Array,t,r,i,s),this.elementType="f32"}slice(t,r){return this.sliceBuffer(PT,t,r)}static fromTypedArray(t,r){return new PT(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}PT.ElementType="f32";class wy extends Oj{constructor(t,r=0,i,s){super(Float64Array,t,r,i,s),this.elementType="f64"}slice(t,r){return this.sliceBuffer(wy,t,r)}static fromTypedArray(t,r){return new wy(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}wy.ElementType="f64";class MT extends Km{constructor(t,r=0,i,s){super(Float64Array,t,r,i,s),this.elementType="f64"}slice(t,r){return this.sliceBuffer(MT,t,r)}static fromTypedArray(t,r){return new MT(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}MT.ElementType="f64";class IT extends Qm{constructor(t,r=0,i,s){super(Float64Array,t,r,i,s),this.elementType="f64"}slice(t,r){return this.sliceBuffer(IT,t,r)}static fromTypedArray(t,r){return new IT(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}IT.ElementType="f64";class Qa extends eg{constructor(t,r=0,i,s){super(Float64Array,t,r,i,s),this.elementType="f64"}slice(t,r){return this.sliceBuffer(Qa,t,r)}static fromTypedArray(t,r){return new Qa(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Qa.ElementType="f64";class A1 extends tg{constructor(t,r=0,i,s){super(Float64Array,t,r,i,s),this.elementType="f64"}slice(t,r){return this.sliceBuffer(A1,t,r)}static fromTypedArray(t,r){return new A1(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}A1.ElementType="f64";class zm extends Km{constructor(t,r=0,i,s){super(Uint8Array,t,r,i,s),this.elementType="u8"}slice(t,r){return this.sliceBuffer(zm,t,r)}static fromTypedArray(t,r){return new zm(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}zm.ElementType="u8";class O1 extends Qm{constructor(t,r=0,i,s){super(Uint8Array,t,r,i,s),this.elementType="u8"}slice(t,r){return this.sliceBuffer(O1,t,r)}static fromTypedArray(t,r){return new O1(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}O1.ElementType="u8";class R1 extends eg{constructor(t,r=0,i,s){super(Uint8Array,t,r,i,s),this.elementType="u8"}slice(t,r){return this.sliceBuffer(R1,t,r)}static fromTypedArray(t,r){return new R1(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}R1.ElementType="u8";class zn extends tg{constructor(t,r=0,i,s){super(Uint8Array,t,r,i,s),this.elementType="u8"}slice(t,r){return this.sliceBuffer(zn,t,r)}static fromTypedArray(t,r){return new zn(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}zn.ElementType="u8";class P1 extends Km{constructor(t,r=0,i,s){super(Uint16Array,t,r,i,s),this.elementType="u16"}slice(t,r){return this.sliceBuffer(P1,t,r)}static fromTypedArray(t,r){return new P1(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}P1.ElementType="u16";class $T extends Qm{constructor(t,r=0,i,s){super(Uint16Array,t,r,i,s),this.elementType="u16"}slice(t,r){return this.sliceBuffer($T,t,r)}static fromTypedArray(t,r){return new $T(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}$T.ElementType="u16";class M1 extends eg{constructor(t,r=0,i,s){super(Uint16Array,t,r,i,s),this.elementType="u16"}slice(t,r){return this.sliceBuffer(M1,t,r)}static fromTypedArray(t,r){return new M1(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}M1.ElementType="u16";class xy extends tg{constructor(t,r=0,i,s){super(Uint16Array,t,r,i,s),this.elementType="u16"}slice(t,r){return this.sliceBuffer(xy,t,r)}static fromTypedArray(t,r){return new xy(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}xy.ElementType="u16";class I1 extends Km{constructor(t,r=0,i,s){super(Uint32Array,t,r,i,s),this.elementType="u32"}slice(t,r){return this.sliceBuffer(I1,t,r)}static fromTypedArray(t,r){return new I1(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}I1.ElementType="u32";class LT extends Qm{constructor(t,r=0,i,s){super(Uint32Array,t,r,i,s),this.elementType="u32"}slice(t,r){return this.sliceBuffer(LT,t,r)}static fromTypedArray(t,r){return new LT(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}LT.ElementType="u32";class RA extends eg{constructor(t,r=0,i,s){super(Uint32Array,t,r,i,s),this.elementType="u32"}slice(t,r){return this.sliceBuffer(RA,t,r)}static fromTypedArray(t,r){return new RA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}RA.ElementType="u32";class PA extends tg{constructor(t,r=0,i,s){super(Uint32Array,t,r,i,s),this.elementType="u32"}slice(t,r){return this.sliceBuffer(PA,t,r)}static fromTypedArray(t,r){return new PA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}PA.ElementType="u32";class DT extends Km{constructor(t,r=0,i,s){super(Int8Array,t,r,i,s),this.elementType="i8"}slice(t,r){return this.sliceBuffer(DT,t,r)}static fromTypedArray(t,r){return new DT(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}DT.ElementType="i8";class $1 extends Qm{constructor(t,r=0,i,s){super(Int8Array,t,r,i,s),this.elementType="i8"}slice(t,r){return this.sliceBuffer($1,t,r)}static fromTypedArray(t,r){return new $1(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}$1.ElementType="i8";class MA extends eg{constructor(t,r=0,i,s){super(Int8Array,t,r,i,s),this.elementType="i8"}slice(t,r){return this.sliceBuffer(MA,t,r)}static fromTypedArray(t,r){return new MA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}MA.ElementType="i8";class IA extends tg{constructor(t,r=0,i,s){super(Int8Array,t,r,i,s),this.elementType="i8"}slice(t,r){return this.sliceBuffer(IA,t,r)}static fromTypedArray(t,r){return new IA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}IA.ElementType="i8";class $A extends Km{constructor(t,r=0,i,s){super(Int16Array,t,r,i,s),this.elementType="i16"}slice(t,r){return this.sliceBuffer($A,t,r)}static fromTypedArray(t,r){return new $A(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}$A.ElementType="i16";class Ty extends Qm{constructor(t,r=0,i,s){super(Int16Array,t,r,i,s),this.elementType="i16"}slice(t,r){return this.sliceBuffer(Ty,t,r)}static fromTypedArray(t,r){return new Ty(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Ty.ElementType="i16";class LA extends eg{constructor(t,r=0,i,s){super(Int16Array,t,r,i,s),this.elementType="i16"}slice(t,r){return this.sliceBuffer(LA,t,r)}static fromTypedArray(t,r){return new LA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}LA.ElementType="i16";class DA extends tg{constructor(t,r=0,i,s){super(Int16Array,t,r,i,s),this.elementType="i16"}slice(t,r){return this.sliceBuffer(DA,t,r)}static fromTypedArray(t,r){return new DA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}DA.ElementType="i16";class NA extends Km{constructor(t,r=0,i,s){super(Int32Array,t,r,i,s),this.elementType="i32"}slice(t,r){return this.sliceBuffer(NA,t,r)}static fromTypedArray(t,r){return new NA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}NA.ElementType="i32";class FA extends Qm{constructor(t,r=0,i,s){super(Int32Array,t,r,i,s),this.elementType="i32"}slice(t,r){return this.sliceBuffer(FA,t,r)}static fromTypedArray(t,r){return new FA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}FA.ElementType="i32";class UA extends eg{constructor(t,r=0,i,s){super(Int32Array,t,r,i,s),this.elementType="i32"}slice(t,r){return this.sliceBuffer(UA,t,r)}static fromTypedArray(t,r){return new UA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}UA.ElementType="i32";class kA extends tg{constructor(t,r=0,i,s){super(Int32Array,t,r,i,s),this.elementType="i32"}slice(t,r){return this.sliceBuffer(kA,t,r)}static fromTypedArray(t,r){return new kA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}kA.ElementType="i32";function JY(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}class yL{constructor(t,r){this.layout=t,this.buffer=typeof r=="number"?new ArrayBuffer(r*t.stride):r;for(const i of t.fields.keys()){const s=t.fields.get(i);this[i]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(t,r){const i=this[t];return i&&i.elementCount===r.ElementCount&&i.elementType===r.ElementType?i:null}slice(t,r){return new yL(this.layout,this.buffer.slice(t*this.stride,r*this.stride))}copyFrom(t,r=0,i=0,s=t.count){const n=this.stride;if(n%4==0){const o=new Uint32Array(t.buffer,r*n,s*n/4);new Uint32Array(this.buffer,i*n,s*n/4).set(o)}else{const o=new Uint8Array(t.buffer,r*n,s*n);new Uint8Array(this.buffer,i*n,s*n).set(o)}return this}}class jN{constructor(t=null){this._stride=0,this._lastAligned=0,this._fields=new Map,t&&(this._stride=t.stride,t.fields.forEach(r=>this._fields.set(r[0],{...r[1],constructor:r6e(r[1].constructor)})))}vec2f(t,r){return this._appendField(t,bd,r),this}vec2f64(t,r){return this._appendField(t,IT,r),this}vec3f(t,r){return this._appendField(t,Es,r),this}vec3f64(t,r){return this._appendField(t,Qa,r),this}vec4f(t,r){return this._appendField(t,Gl,r),this}vec4f64(t,r){return this._appendField(t,A1,r),this}mat3f(t,r){return this._appendField(t,wd,r),this}mat3f64(t,r){return this._appendField(t,RT,r),this}mat4f(t,r){return this._appendField(t,PT,r),this}mat4f64(t,r){return this._appendField(t,wy,r),this}vec4u8(t,r){return this._appendField(t,zn,r),this}f32(t,r){return this._appendField(t,x2,r),this}f64(t,r){return this._appendField(t,MT,r),this}u8(t,r){return this._appendField(t,zm,r),this}u16(t,r){return this._appendField(t,P1,r),this}i8(t,r){return this._appendField(t,DT,r),this}vec2i8(t,r){return this._appendField(t,$1,r),this}vec2i16(t,r){return this._appendField(t,Ty,r),this}vec2u8(t,r){return this._appendField(t,O1,r),this}vec4u16(t,r){return this._appendField(t,xy,r),this}u32(t,r){return this._appendField(t,I1,r),this}_appendField(t,r,i){if(this._fields.has(t))return void Ye(!1,`${t} already added to vertex buffer layout`);const s=r.ElementCount*JY(r.ElementType),n=this._stride;this._stride+=s,this._fields.set(t,{size:s,constructor:r,offset:n,optional:i})}createBuffer(t){return new yL(this,t)}createView(t){return new yL(this,t)}clone(){const t=new jN;return t._stride=this._stride,t._fields=new Map,this._fields.forEach((r,i)=>t._fields.set(i,r)),t.BufferType=this.BufferType,t}get stride(){if(this._lastAligned!==this._fields.size){let t=1;this._fields.forEach(r=>t=Math.max(t,JY(r.constructor.ElementType))),this._stride=Math.floor((this._stride+t-1)/t)*t,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}}function Li(){return new jN}class e6e{constructor(t){this.fields=new Array,t.fields.forEach((r,i)=>{const s={...r,constructor:kfe(r.constructor)};this.fields.push([i,s])}),this.stride=t.stride}}const t6e=[x2,bd,Es,Gl,wd,PT,MT,IT,Qa,A1,RT,wy,zm,O1,R1,zn,P1,$T,M1,xy,I1,LT,RA,PA,DT,$1,MA,IA,$A,Ty,LA,DA,NA,FA,UA,kA];function kfe(e){return`${e.ElementType}_${e.ElementCount}`}function r6e(e){return zfe.get(e)}const zfe=new Map;t6e.forEach(e=>zfe.set(kfe(e),e));function To(e,t=!1){return e<=Ic?t?new Array(e).fill(0):new Array(e):new Float64Array(e)}function Bfe(e){return(md(e)?e.length:e.byteLength/8)<=Ic?Array.from(e):new Float64Array(e)}function Bu(e,t,r){return Array.isArray(e)?e.slice(t,t+r):e.subarray(t,t+r)}function ift(e,t){for(let r=0;r<t.length;++r)e[r]=t[r];return e}function sft(e){return Array.isArray(e)?new Float64Array(e):e}function Vi(e,t=!1){return e<=Ic?t?new Array(e).fill(0):new Array(e):new Float32Array(e)}function nft(e){return md(e)?e.length<Ic?e:new Float32Array(e):e.length<Ic?Array.from(e):e}function KY(e){return(md(e)?e.length:e.byteLength/8)<=Ic?Array.from(e):new Float32Array(e)}function _L(e,t,r){return Array.isArray(e)?e.slice(t,t+r):e.subarray(t,t+r)}function Vp(e){return md(e)?e.length<Ic?e:QY(e):e.length<Ic?Array.from(e):e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT?e:QY(e)}function QY(e){let t=!0;for(const r of e){if(r>=65536)return md(e)?new Uint32Array(e):e;r>=256&&(t=!1)}return t?new Uint8Array(e):new Uint16Array(e)}function vL(e){return e<=Ic?new Array(e):e<=65536?new Uint16Array(e):new Uint32Array(e)}function i6e(e){return e<=Ic?new Array(e):new Uint32Array(e)}let wb=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const Vfe=[0],NF=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function NT(e){if(e===1)return Vfe;if(e<Ic)return Array.from(new Uint16Array(NF.buffer,0,e));if(e<NF.length)return new Uint16Array(NF.buffer,0,e);if(e>wb.length){const t=Math.max(2*wb.length,e);wb=new Uint32Array(t);for(let r=0;r<wb.length;r++)wb[r]=r}return new Uint32Array(wb.buffer,0,e)}let cR=new Uint8Array(65536);function T2(e){if(e===1)return Vfe;if(e<Ic)return new Array(e).fill(0);if(e>cR.length){const t=Math.max(2*cR.length,e);cR=new Uint8Array(t)}return new Uint8Array(cR.buffer,0,e)}class Fe{constructor(t,r,i=!1,s=r){this.data=t,this.size=r,this.exclusive=i,this.stride=s}}var wz;(function(e){function t(o,a){const l=o[a],c=o[a+1],u=o[a+2];return Math.sqrt(l*l+c*c+u*u)}function r(o,a){const l=o[a],c=o[a+1],u=o[a+2],d=1/Math.sqrt(l*l+c*c+u*u);o[a]*=d,o[a+1]*=d,o[a+2]*=d}function i(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,u,d=a){(u=u||o)[d]=o[a]+l[c],u[d+1]=o[a+1]+l[c+1],u[d+2]=o[a+2]+l[c+2]}function n(o,a,l,c,u,d=a){(u=u||o)[d]=o[a]-l[c],u[d+1]=o[a+1]-l[c+1],u[d+2]=o[a+2]-l[c+2]}e.length=t,e.normalize=r,e.scale=i,e.add=s,e.subtract=n})(wz||(wz={}));var Ki;(function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Mesh=2]="Mesh",e[e.Line=3]="Line",e[e.Point=4]="Point",e[e.Material=5]="Material",e[e.Texture=6]="Texture",e[e.COUNT=7]="COUNT"})(Ki||(Ki={}));function s6e(e){if(e.length<Ic)return Array.from(e);if(md(e))return Float64Array.from(e);if(!("BYTES_PER_ELEMENT"in e))return Array.from(e);switch(e.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(e);case 2:return OD(e)?Uint16Array.from(e):Int16Array.from(e);case 4:return Float32Array.from(e);default:return Float64Array.from(e)}}class HN{constructor(t,r,i,s){this.primitiveIndices=t,this._numIndexPerPrimitive=r,this.indices=i,this.position=s,this._children=void 0,Ye(t.length>=1),Ye(i.length%this._numIndexPerPrimitive==0),Ye(i.length>=t.length*this._numIndexPerPrimitive),Ye(s.size===3||s.size===4);const{data:n,size:o}=s,a=t.length;let l=o*i[this._numIndexPerPrimitive*t[0]];Yy.clear(),Yy.push(l);const c=Ce(n[l],n[l+1],n[l+2]),u=Ts(c);for(let g=0;g<a;++g){const y=this._numIndexPerPrimitive*t[g];for(let _=0;_<this._numIndexPerPrimitive;++_){l=o*i[y+_],Yy.push(l);let v=n[l];c[0]=Math.min(v,c[0]),u[0]=Math.max(v,u[0]),v=n[l+1],c[1]=Math.min(v,c[1]),u[1]=Math.max(v,u[1]),v=n[l+2],c[2]=Math.min(v,c[2]),u[2]=Math.max(v,u[2])}}this.bbMin=c,this.bbMax=u;const d=Lr(C(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(u[0]-c[0],u[1]-c[1]),u[2]-c[2]);let p=this.radius*this.radius;for(let g=0;g<Yy.length;++g){l=Yy.at(g);const y=n[l]-d[0],_=n[l+1]-d[1],v=n[l+2]-d[2],w=y*y+_*_+v*v;if(w<=p)continue;const T=Math.sqrt(w),x=.5*(T-this.radius);this.radius=this.radius+x,p=this.radius*this.radius;const S=x/T;d[0]+=y*S,d[1]+=_*S,d[2]+=v*S}this.center=d,Yy.clear()}getChildren(){if(this._children||gn(this.bbMin,this.bbMax)<=1)return this._children;const t=Lr(C(),this.bbMin,this.bbMax,.5),r=this.primitiveIndices.length,i=new Uint8Array(r),s=new Array(8);for(let c=0;c<8;++c)s[c]=0;const{data:n,size:o}=this.position;for(let c=0;c<r;++c){let u=0;const d=this._numIndexPerPrimitive*this.primitiveIndices[c];let p=o*this.indices[d],g=n[p],y=n[p+1],_=n[p+2];for(let v=1;v<this._numIndexPerPrimitive;++v){p=o*this.indices[d+v];const w=n[p],T=n[p+1],x=n[p+2];w<g&&(g=w),T<y&&(y=T),x<_&&(_=x)}g<t[0]&&(u|=1),y<t[1]&&(u|=2),_<t[2]&&(u|=4),i[c]=u,++s[u]}let a=0;for(let c=0;c<8;++c)s[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=s[c]>0?new Uint32Array(s[c]):void 0;for(let c=0;c<8;++c)s[c]=0;for(let c=0;c<r;++c){const u=i[c];l[u][s[u]++]=this.primitiveIndices[c]}this._children=new Array;for(let c=0;c<8;++c)l[c]!==void 0&&this._children.push(new HN(l[c],this._numIndexPerPrimitive,this.indices,this.position));return this._children}static prune(){Yy.prune()}}const Yy=new Mt({deallocator:null});class W3{constructor(){this.id=Nl()}unload(){}}function n6e(e){return e?{p0:Ts(e.p0),p1:Ts(e.p1),p2:Ts(e.p2)}:{p0:C(),p1:C(),p2:C()}}function eJ(e,t,r){const i=t[0]-e[0],s=t[1]-e[1],n=r[0]-e[0],o=r[1]-e[1];return .5*Math.abs(i*o-s*n)}function o6e(e,t,r){return ce(FF,t,e),ce(tJ,r,e),Se(rt(FF,FF,tJ))/2}new qm(Sd);new qm(()=>n6e());const FF=C(),tJ=C();function a6e(e,t,r){if(!e||!t)return!1;const{size:i,data:s}=e;se(r,0,0,0),se(_u,0,0,0);let n=0,o=0;for(let a=0;a<t.length-2;a+=3){const l=t[a]*i,c=t[a+1]*i,u=t[a+2]*i;se(Mn,s[l],s[l+1],s[l+2]),se(lm,s[c],s[c+1],s[c+2]),se(uR,s[u],s[u+1],s[u+2]);const d=o6e(Mn,lm,uR);d?(oe(Mn,Mn,lm),oe(Mn,Mn,uR),te(Mn,Mn,1/3*d),oe(r,r,Mn),n+=d):(oe(_u,_u,Mn),oe(_u,_u,lm),oe(_u,_u,uR),o+=3)}return(o!==0||n!==0)&&(n!==0?(te(r,r,1/n),!0):o!==0&&(te(r,_u,1/o),!0))}function l6e(e,t,r){if(!e||!t)return!1;const{size:i,data:s}=e;se(r,0,0,0);let n=-1,o=0;for(let a=0;a<t.length;a++){const l=t[a]*i;n!==l&&(r[0]+=s[l],r[1]+=s[l+1],r[2]+=s[l+2],o++),n=l}return o>1&&te(r,r,1/o),o>0}function c6e(e,t,r,i){if(!e)return!1;se(i,0,0,0),se(_u,0,0,0);let s=0,n=0;const{size:o,data:a}=e,l=t?t.length-1:a.length/o-1,c=l+(r?2:0);for(let u=0;u<c;u+=2){const d=u<l?u:l,p=u<l?u+1:0,g=(t?t[d]:d)*o,y=(t?t[p]:p)*o;Mn[0]=a[g],Mn[1]=a[g+1],Mn[2]=a[g+2],lm[0]=a[y],lm[1]=a[y+1],lm[2]=a[y+2],te(Mn,oe(Mn,Mn,lm),.5);const _=_3(Mn,lm);_>0?(oe(i,i,te(Mn,Mn,_)),s+=_):s===0&&(oe(_u,_u,Mn),n++)}return s!==0?(te(i,i,1/s),!0):n!==0&&(te(i,_u,1/n),!0)}const Mn=C(),lm=C(),uR=C(),_u=C();class bL{constructor(t){this.channel=t,this.id=Nl()}}function xz(e,t,r){for(let i=0;i<r;++i)t[2*i]=e[i],t[2*i+1]=e[i]-t[2*i]}function u6e(e,t){const r=e.length;for(let i=0;i<r;++i)ux[0]=e[i],t[i]=ux[0];return t}function h6e(e,t){const r=e.length;for(let i=0;i<r;++i)ux[0]=e[i],ux[1]=e[i]-ux[0],t[i]=ux[1];return t}const ux=new Float32Array(2);function Tz(e,t){return e==null&&(e=[]),e.push(t),e}function Sz(e,t){if(e==null)return null;const r=e.filter(i=>i!==t);return r.length===0?null:r}function d6e(e,t,r,i,s){hR[0]=e.get(t,0),hR[1]=e.get(t,1),hR[2]=e.get(t,2),xz(hR,Jy,3),r.set(s,0,Jy[0]),i.set(s,0,Jy[1]),r.set(s,1,Jy[2]),i.set(s,1,Jy[3]),r.set(s,2,Jy[4]),i.set(s,2,Jy[5])}const hR=C(),Jy=new Float32Array(6);class Cs extends W3{constructor(t,r,i=[],s=null,n=Ki.Mesh,o=null,a=-1){super(),this.material=t,this.mapPositions=s,this.type=n,this.objectAndLayerIdColor=o,this.edgeIndicesLength=a,this.visible=!0,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[l,c]of r)c&&this._vertexAttributes.set(l,{...c});if(i==null||i.length===0){const l=p6e(this._vertexAttributes),c=NT(l);this.edgeIndicesLength=this.edgeIndicesLength<0?l:this.edgeIndicesLength;for(const u of this._vertexAttributes.keys())this._indices.set(u,c)}else for(const[l,c]of i)c&&(this._indices.set(l,Vp(c)),l===E.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(l).length:this.edgeIndicesLength))}instantiate(t={}){const r=new Cs(t.material||this.material,[],void 0,this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._vertexAttributes.forEach((i,s)=>{i.exclusive=!1,r._vertexAttributes.set(s,i)}),this._indices.forEach((i,s)=>r._indices.set(s,i)),r._boundingInfo=this._boundingInfo,r.transformation=t.transformation||this.transformation,r}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(t){let r=this._vertexAttributes.get(t);return r&&!r.exclusive&&(r={...r,exclusive:!0,data:s6e(r.data)},this._vertexAttributes.set(t,r)),r}setAttributeData(t,r){const i=this._vertexAttributes.get(t);i&&this._vertexAttributes.set(t,{...i,exclusive:!0,data:r})}get indices(){return this._indices}get indexCount(){const t=this._indices.values().next().value;return t?t.length:0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return!!(this.type===Ki.Mesh?this._computeAttachmentOriginTriangles(t):this.type===Ki.Line?this._computeAttachmentOriginLines(t):this._computeAttachmentOriginPoints(t))&&(this._transformation!=null&&Ue(t,t,this._transformation),!0)}_computeAttachmentOriginTriangles(t){const r=this.indices.get(E.POSITION),i=this.vertexAttributes.get(E.POSITION);return a6e(i,r,t)}_computeAttachmentOriginLines(t){const r=this.vertexAttributes.get(E.POSITION),i=this.indices.get(E.POSITION);return c6e(r,i,i&&f6e(this.material.parameters,r,i),t)}_computeAttachmentOriginPoints(t){const r=this.indices.get(E.POSITION),i=this.vertexAttributes.get(E.POSITION);return l6e(i,r,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const t=this.indices.get(E.POSITION),r=this.vertexAttributes.get(E.POSITION);if(!t||t.length===0||!r)return null;const i=this.type===Ki.Mesh?3:1;Ye(t.length%i==0,"Indexing error: "+t.length+" not divisible by "+i);const s=NT(t.length/i);return new HN(s,i,t,r)}get transformation(){return this._transformation??Ks}set transformation(t){this._transformation=t&&t!==Ks?gT(t):null}get shaderTransformation(){return this._shaderTransformer!=null?this._shaderTransformer(this.transformation):this.transformation}get shaderTransformer(){return this._shaderTransformer}set shaderTransformer(t){this._shaderTransformer=t}get hasVolatileTransformation(){return this._shaderTransformer!=null}addHighlight(){const t=new bL(km.Highlight);return this.highlights=Tz(this.highlights,t),t}removeHighlight(t){this.highlights=Sz(this.highlights,t)}}function p6e(e){const t=e.values().next().value;return t==null?0:t.data.length/t.size}function f6e(e,t,r){return!(!("isClosed"in e)||!e.isClosed)&&(r?r.length>2:t.data.length>6)}const xb=wz,UF=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],m6e=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],g6e=[0,0,1,0,1,1,0,1],y6e=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],Gfe=new Array(36);for(let e=0;e<6;e++)for(let t=0;t<6;t++)Gfe[6*e+t]=e;const Y_=new Array(36);for(let e=0;e<6;e++)Y_[6*e]=0,Y_[6*e+1]=1,Y_[6*e+2]=2,Y_[6*e+3]=2,Y_[6*e+4]=3,Y_[6*e+5]=0;function _6e(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(24);for(let i=0;i<8;i++)r[3*i]=UF[i][0]*t[0],r[3*i+1]=UF[i][1]*t[1],r[3*i+2]=UF[i][2]*t[2];return new Cs(e,[[E.POSITION,new Fe(r,3,!0)],[E.NORMAL,new Fe(m6e,3)],[E.UV0,new Fe(g6e,2)]],[[E.POSITION,y6e],[E.NORMAL,Gfe],[E.UV0,Y_]])}const kF=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],v6e=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],b6e=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],w6e=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function x6e(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(18);for(let i=0;i<6;i++)r[3*i]=kF[i][0]*t[0],r[3*i+1]=kF[i][1]*t[1],r[3*i+2]=kF[i][2]*t[2];return new Cs(e,[[E.POSITION,new Fe(r,3,!0)],[E.NORMAL,new Fe(v6e,3)]],[[E.POSITION,b6e],[E.NORMAL,w6e]])}const nI=Br(-.5,0,-.5),oI=Br(.5,0,-.5),aI=Br(0,0,.5),lI=Br(0,.5,0),Tb=Yi(),Sb=Yi(),Lx=Yi(),Dx=Yi(),Nx=Yi();ce(Tb,nI,lI),ce(Sb,nI,oI),rt(Lx,Tb,Sb),pe(Lx,Lx),ce(Tb,oI,lI),ce(Sb,oI,aI),rt(Dx,Tb,Sb),pe(Dx,Dx),ce(Tb,aI,lI),ce(Sb,aI,nI),rt(Nx,Tb,Sb),pe(Nx,Nx);const zF=[nI,oI,aI,lI],T6e=[0,-1,0,Lx[0],Lx[1],Lx[2],Dx[0],Dx[1],Dx[2],Nx[0],Nx[1],Nx[2]],S6e=[0,1,2,3,1,0,3,2,1,3,0,2],E6e=[0,0,0,1,1,1,2,2,2,3,3,3];function C6e(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(12);for(let i=0;i<4;i++)r[3*i]=zF[i][0]*t[0],r[3*i+1]=zF[i][1]*t[1],r[3*i+2]=zF[i][2]*t[2];return new Cs(e,[[E.POSITION,new Fe(r,3,!0)],[E.NORMAL,new Fe(T6e,3)]],[[E.POSITION,S6e],[E.NORMAL,E6e]])}function oft(e,t,r,i,s={uv:!0}){const n=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(r)),u=Math.max(2,Math.floor(i)),d=(c+1)*(u+1),p=Vi(3*d),g=Vi(3*d),y=Vi(2*d),_=[];let v=0;for(let S=0;S<=u;S++){const O=[],A=S/u,$=a+A*l,P=Math.cos($);for(let U=0;U<=c;U++){const I=U/c,L=n+I*o,N=Math.cos(L)*P,Z=Math.sin($),W=-Math.sin(L)*P;p[3*v]=N*t,p[3*v+1]=Z*t,p[3*v+2]=W*t,g[3*v]=N,g[3*v+1]=Z,g[3*v+2]=W,y[2*v]=I,y[2*v+1]=A,O.push(v),++v}_.push(O)}const w=new Array;for(let S=0;S<u;S++)for(let O=0;O<c;O++){const A=_[S][O],$=_[S][O+1],P=_[S+1][O+1],U=_[S+1][O];S===0?(w.push(A),w.push(P),w.push(U)):S===u-1?(w.push(A),w.push($),w.push(P)):(w.push(A),w.push($),w.push(P),w.push(P),w.push(U),w.push(A))}const T=[[E.POSITION,w],[E.NORMAL,w]],x=[[E.POSITION,new Fe(p,3,!0)],[E.NORMAL,new Fe(g,3,!0)]];return s.uv&&(x.push([E.UV0,new Fe(y,2,!0)]),T.push([E.UV0,w])),s.offset&&(T[0][0]=E.OFFSET,x[0][0]=E.OFFSET,T.push([E.POSITION,T2(w.length)]),x.push([E.POSITION,new Fe(Float64Array.from(s.offset),3,!0)])),new Cs(e,x,T)}function A6e(e,t,r,i){const{vertexAttributes:s,indices:n}=jfe(t,r,i);return new Cs(e,s,n)}function jfe(e,t,r){const i=e;let s,n;if(r)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const u=i*(1+Math.sqrt(5))/2;s=[-i,u,0,i,u,0,-i,-u,0,i,-u,0,0,-i,u,0,i,u,0,-i,-u,0,i,-u,u,0,-i,u,0,i,-u,0,-i,-u,0,i],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let u=0;u<s.length;u+=3)xb.scale(s,u,e/xb.length(s,u));let o={};function a(u,d){u>d&&([u,d]=[d,u]);const p=u.toString()+"."+d.toString();if(o[p])return o[p];let g=s.length;return s.length+=3,xb.add(s,3*u,s,3*d,s,g),xb.scale(s,g,e/xb.length(s,g)),g/=3,o[p]=g,g}for(let u=0;u<t;u++){const d=n.length,p=new Array(4*d);for(let g=0;g<d;g+=3){const y=n[g],_=n[g+1],v=n[g+2],w=a(y,_),T=a(_,v),x=a(v,y),S=4*g;p[S]=y,p[S+1]=w,p[S+2]=x,p[S+3]=_,p[S+4]=T,p[S+5]=w,p[S+6]=v,p[S+7]=x,p[S+8]=T,p[S+9]=w,p[S+10]=T,p[S+11]=x}n=p,o={}}const l=KY(s);for(let u=0;u<l.length;u+=3)xb.normalize(l,u);const c=[[E.POSITION,n],[E.NORMAL,n]];return{vertexAttributes:[[E.POSITION,new Fe(KY(s),3,!0)],[E.NORMAL,new Fe(l,3,!0)]],indices:c}}function Ez(e,t,r,i,s,n,o,a,l=null){const c=r?[r[0],r[1],r[2]]:[0,0,0],u=t?[t[0],t[1],t[2]]:[0,0,1];o=o||[0,0];const d=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],p=s!=null&&s.length===2?s:[1,1],g=[[E.POSITION,new Fe(c,3,!0)],[E.NORMAL,new Fe(u,3,!0)],[E.UV0,new Fe(o,o.length)],[E.COLOR,new Fe(d,4,!0)],[E.SIZE,new Fe(p,2)]];if(n!=null){const y=[n[0],n[1],n[2],n[3]];g.push([E.AUXPOS1,new Fe(y,4)])}if(a!=null){const y=[a[0],a[1],a[2],a[3]];g.push([E.AUXPOS2,new Fe(y,4)])}return new Cs(e,g,null,null,Ki.Point,l)}const O6e=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function aft(e,t=O6e){const r=new Array(12);for(let u=0;u<4;u++)for(let d=0;d<3;d++)r[3*u+d]=t[u][d];const i=[0,1,2,2,3,0],s=[0,0,1],n=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[E.POSITION,i],[E.NORMAL,n],[E.UV0,i],[E.COLOR,n]],c=[[E.POSITION,new Fe(r,3,!0)],[E.NORMAL,new Fe(s,3,!0)],[E.UV0,new Fe(o,2,!0)],[E.COLOR,new Fe(a,4,!0)]];return new Cs(e,c,l)}function rJ(e,t,r,i,s,n=!0,o=!0){let a=0;const l=r,c=t;let u=Br(0,a,0),d=Br(0,a+c,0),p=Br(0,-1,0),g=Br(0,1,0);s&&(a=c,d=Br(0,0,0),u=Br(0,a,0),p=Br(0,1,0),g=Br(0,-1,0));const y=[d,u],_=[p,g],v=i+2,w=Math.sqrt(c*c+l*l);if(s)for(let P=i-1;P>=0;P--){const U=P*(2*Math.PI/i),I=Br(Math.cos(U)*l,a,Math.sin(U)*l);y.push(I);const L=Br(c*Math.cos(U)/w,-l/w,c*Math.sin(U)/w);_.push(L)}else for(let P=0;P<i;P++){const U=P*(2*Math.PI/i),I=Br(Math.cos(U)*l,a,Math.sin(U)*l);y.push(I);const L=Br(c*Math.cos(U)/w,l/w,c*Math.sin(U)/w);_.push(L)}const T=new Array,x=new Array;if(n){for(let P=3;P<y.length;P++)T.push(1),T.push(P-1),T.push(P),x.push(0),x.push(0),x.push(0);T.push(y.length-1),T.push(2),T.push(1),x.push(0),x.push(0),x.push(0)}if(o){for(let P=3;P<y.length;P++)T.push(P),T.push(P-1),T.push(0),x.push(P),x.push(P-1),x.push(1);T.push(0),T.push(2),T.push(y.length-1),x.push(1),x.push(2),x.push(_.length-1)}const S=Vi(3*v);for(let P=0;P<v;P++)S[3*P]=y[P][0],S[3*P+1]=y[P][1],S[3*P+2]=y[P][2];const O=Vi(3*v);for(let P=0;P<v;P++)O[3*P]=_[P][0],O[3*P+1]=_[P][1],O[3*P+2]=_[P][2];const A=[[E.POSITION,T],[E.NORMAL,x]],$=[[E.POSITION,new Fe(S,3,!0)],[E.NORMAL,new Fe(O,3,!0)]];return new Cs(e,$,A)}function R6e(e,t,r,i,s,n,o){const a=s?dL(s):Br(1,0,0),l=n?dL(n):Br(0,0,0);o??(o=!0);const c=Yi();pe(c,a);const u=Yi();te(u,c,Math.abs(t));const d=Yi();te(d,u,-.5),oe(d,d,l);const p=Br(0,1,0);Math.abs(1-de(c,p))<.2&&se(p,0,0,1);const g=Yi();rt(g,c,p),pe(g,g),rt(p,g,c);const y=2*i+(o?2:0),_=i+(o?2:0),v=Vi(3*y),w=Vi(3*_),T=Vi(2*y),x=new Array(3*i*(o?4:2)),S=new Array(3*i*(o?4:2));o&&(v[3*(y-2)]=d[0],v[3*(y-2)+1]=d[1],v[3*(y-2)+2]=d[2],T[2*(y-2)]=0,T[2*(y-2)+1]=0,v[3*(y-1)]=v[3*(y-2)]+u[0],v[3*(y-1)+1]=v[3*(y-2)+1]+u[1],v[3*(y-1)+2]=v[3*(y-2)+2]+u[2],T[2*(y-1)]=1,T[2*(y-1)+1]=1,w[3*(_-2)]=-c[0],w[3*(_-2)+1]=-c[1],w[3*(_-2)+2]=-c[2],w[3*(_-1)]=c[0],w[3*(_-1)+1]=c[1],w[3*(_-1)+2]=c[2]);const O=(L,N,Z)=>{x[L]=N,S[L]=Z};let A=0;const $=Yi(),P=Yi();for(let L=0;L<i;L++){const N=L*(2*Math.PI/i);te($,p,Math.sin(N)),te(P,g,Math.cos(N)),oe($,$,P),w[3*L]=$[0],w[3*L+1]=$[1],w[3*L+2]=$[2],te($,$,r),oe($,$,d),v[3*L]=$[0],v[3*L+1]=$[1],v[3*L+2]=$[2],T[2*L]=L/i,T[2*L+1]=0,v[3*(L+i)]=v[3*L]+u[0],v[3*(L+i)+1]=v[3*L+1]+u[1],v[3*(L+i)+2]=v[3*L+2]+u[2],T[2*(L+i)]=L/i,T[2*L+1]=1;const Z=(L+1)%i;O(A++,L,L),O(A++,L+i,L),O(A++,Z,Z),O(A++,Z,Z),O(A++,L+i,L),O(A++,Z+i,Z)}if(o){for(let L=0;L<i;L++){const N=(L+1)%i;O(A++,y-2,_-2),O(A++,L,_-2),O(A++,N,_-2)}for(let L=0;L<i;L++){const N=(L+1)%i;O(A++,L+i,_-1),O(A++,y-1,_-1),O(A++,N+i,_-1)}}const U=[[E.POSITION,x],[E.NORMAL,S],[E.UV0,x]],I=[[E.POSITION,new Fe(v,3,!0)],[E.NORMAL,new Fe(w,3,!0)],[E.UV0,new Fe(T,2,!0)]];return new Cs(e,I,U)}function lft(e,t,r,i,s,n,o=Br(0,0,0)){const a=t.length,l=Vi(r.length*a*3+(6*i.length||0)),c=Vi(r.length*a*3+(i?6:0)),u=new Array,d=new Array;let p=0,g=0;const y=Yi(),_=Yi(),v=Yi(),w=Yi(),T=Yi(),x=Yi(),S=Yi(),O=C(),A=Yi(),$=Yi(),P=Yi(),U=Yi(),I=Yi(),L=Sr();se(A,0,1,0),ce(_,r[1],r[0]),pe(_,_),n?(oe(O,r[0],o),pe(v,O)):se(v,0,0,1),wL(_,v,A,A,T,v,iJ),re(w,v),re(U,T);for(let z=0;z<i.length;z++)te(x,T,i[z][0]),te(O,v,i[z][2]),oe(x,x,O),oe(x,x,r[0]),l[p++]=x[0],l[p++]=x[1],l[p++]=x[2];c[g++]=-_[0],c[g++]=-_[1],c[g++]=-_[2];for(let z=0;z<s.length;z++)u.push(s[z][0]>0?s[z][0]:-s[z][0]-1+i.length),u.push(s[z][1]>0?s[z][1]:-s[z][1]-1+i.length),u.push(s[z][2]>0?s[z][2]:-s[z][2]-1+i.length),d.push(0),d.push(0),d.push(0);let N=i.length;const Z=i.length-1;for(let z=0;z<r.length;z++){let H=!1;z>0&&(re(y,_),z<r.length-1?(ce(_,r[z+1],r[z]),pe(_,_)):H=!0,oe($,y,_),pe($,$),oe(P,r[z-1],w),B3(r[z],$,L),ib(L,Fc(P,y),O)?(ce(O,O,r[z]),pe(v,O),rt(T,$,v),pe(T,T)):wL($,w,U,A,T,v,iJ),re(w,v),re(U,T)),n&&(oe(O,r[z],o),pe(I,O));for(let X=0;X<a;X++)if(te(x,T,t[X][0]),te(O,v,t[X][1]),oe(x,x,O),pe(S,x),c[g++]=S[0],c[g++]=S[1],c[g++]=S[2],oe(x,x,r[z]),l[p++]=x[0],l[p++]=x[1],l[p++]=x[2],!H){const Y=(X+1)%a;u.push(N+X),u.push(N+a+X),u.push(N+Y),u.push(N+Y),u.push(N+a+X),u.push(N+a+Y);for(let ee=0;ee<6;ee++){const me=u.length-6;d.push(u[me+ee]-Z)}}N+=a}const W=r[r.length-1];for(let z=0;z<i.length;z++)te(x,T,i[z][0]),te(O,v,i[z][1]),oe(x,x,O),oe(x,x,W),l[p++]=x[0],l[p++]=x[1],l[p++]=x[2];const V=g/3;c[g++]=_[0],c[g++]=_[1],c[g++]=_[2];const J=N-a;for(let z=0;z<s.length;z++)u.push(s[z][0]>=0?N+s[z][0]:-s[z][0]-1+J),u.push(s[z][2]>=0?N+s[z][2]:-s[z][2]-1+J),u.push(s[z][1]>=0?N+s[z][1]:-s[z][1]-1+J),d.push(V),d.push(V),d.push(V);const R=[[E.POSITION,u],[E.NORMAL,d]],k=[[E.POSITION,new Fe(l,3,!0)],[E.NORMAL,new Fe(c,3,!0)]];return new Cs(e,k,R)}function cft(e,t,r,i){Ye(t.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),Ye(t[0].length===3,"createPolylineGeometry(): malformed vertex"),Ye(r==null||r.length===t.length,"createPolylineGeometry: need same number of points and normals"),Ye(r==null||r[0].length===3,"createPolylineGeometry(): malformed normal");const s=To(3*t.length),n=new Array(2*(t.length-1));let o=0,a=0;for(let u=0;u<t.length;u++){for(let d=0;d<3;d++)s[o++]=t[u][d];u>0&&(n[a++]=u-1,n[a++]=u)}const l=[],c=[];if(l.push([E.POSITION,n]),c.push([E.POSITION,new Fe(s,3,!0)]),r){const u=Vi(3*r.length);let d=0;for(let p=0;p<t.length;p++)for(let g=0;g<3;g++)u[d++]=r[p][g];l.push([E.NORMAL,n]),c.push([E.NORMAL,new Fe(u,3,!0)])}return i&&(c.push([E.COLOR,new Fe(i,4)]),l.push([E.COLOR,NT(i.length/4)])),new Cs(e,c,l,null,Ki.Line)}function P6e(e,t=e){const r=e.vertexAttributes,i=r.get(E.POSITION).data,s=r.get(E.NORMAL).data;if(s){const n=t.getMutableAttribute(E.NORMAL).data;for(let o=0;o<s.length;o+=3){const a=s[o+1];n[o+1]=-s[o+2],n[o+2]=a}}if(i){const n=t.getMutableAttribute(E.POSITION).data;for(let o=0;o<i.length;o+=3){const a=i[o+1];n[o+1]=-i[o+2],n[o+2]=a}}}function BF(e,t,r,i,s){return!(Math.abs(de(t,e))>s)&&(rt(r,e,t),pe(r,r),rt(i,r,e),pe(i,i),!0)}function wL(e,t,r,i,s,n,o){return BF(e,t,s,n,o)||BF(e,r,s,n,o)||BF(e,i,s,n,o)}const iJ=.99619469809;class M6e{constructor(t,r){this.type=Do.Local,this._configuration=new Ej,this._passParameters=new Cj,this._configuration.geometry=Kp.Cylinder,this._technique=r.techniqueRepository.acquire(OT,this._configuration);const i=r.renderContext.rctx;this._vao=this._createVertexArrayObject(i),this._vaoCount=vo(this._vao,"geometry");const s=new hr;s.wrapMode=Ct.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new wt(i,s,JFe)}destroy(){this._passParameters.texture=De(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(t){const r=t.rctx,i=r.bindTechnique(this._technique,this._passParameters,t.bindParameters);I6e(sJ,t.bindParameters.camera.viewMatrix),i.setUniformMatrix4fv("view",sJ),r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(bt.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(t){const r=jfe(1,2,!1),i=r.indices[0][1],s=r.vertexAttributes[0][1];for(let l=0;l<i.length;l+=3){const c=i[l];i[l]=i[l+2],i[l+2]=c}const n=s.data,o=nJ.createBuffer(i.length),a=o.position;for(let l=0;l<i.length;++l){const c=3*i[l];a.set(l,0,n[c]),a.set(l,1,n[c+1]),a.set(l,2,n[c+2])}return new Ed(t,dr,{geometry:Wl(nJ)},{geometry:rr.createVertex(t,gr.STATIC_DRAW,o.buffer)})}}function I6e(e,t){Ss(e,t),e[12]=0,e[13]=0,e[14]=0,e[15]=1}const sJ=be(),nJ=Li().vec3f(E.POSITION),$6e=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),dR=128,oJ=-fz,aJ=0,VF=50,L6e=()=>1-511/512,D6e=qM([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);class N6e{constructor(t,r){this.view=t,this.type=Do.Mars,this._passParameters=new Cj,this._vaoCount=0,this._texV1=1;const i=Mr(t.spatialReference);this._planetRadius=i.radius,this._outerRimWidth=i.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+oJ)/this._planetRadius,this._middleRimFactor=(this._planetRadius+aJ)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=aJ/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=r.techniqueRepository;const s=r.renderContext.rctx;this._cameraChangeHandle=le(()=>this.view.state?.camera,()=>r.requestRender(),_s),this._vao=this._createRibbon(s),this._vaoCount=vo(this._vao,"geometry"),this._fadeVao=el(s),this._fadeVaoCount=vo(this._fadeVao,"geometry");const n=new hr;n.wrapMode=Ct.CLAMP_TO_EDGE,n.flipped=!0,n.width=1,n.height=512,this._passParameters.texture=new wt(s,n,$6e);const o=new Ej;o.geometry=Kp.Cone,this._coneTechnique=this._techniqueRepository.acquire(OT,o),o.geometry=Kp.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(OT,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=De(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(t){const r=t.bindParameters.camera;this._update(r);const i=t.rctx;this._passParameters.undergroundFadeAlpha<1&&(i.bindTechnique(this._coneTechnique,this._passParameters,t.bindParameters),i.bindVAO(this._vao),i.drawArrays(bt.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(i.bindTechnique(this._undergroundTechnique,this._passParameters,t.bindParameters),i.bindVAO(this._fadeVao),i.drawArrays(bt.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(t){const r=C(),i=this._planetRadius,s=Se(t.eye),n=s-i;if(n<0){const g=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=g}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(VF,n),a=i+oJ;this._passParameters.innerScale=F6e(i+o,i,a)-1,this._passParameters.altitudeFade=nj(n),te(r,t.eye,(i+VF)/s),lJ(r,t.center,t.up,i,this._passParameters.silhouette);const l=this._computeScreenRimWidth(t,r,t.up,this._passParameters.silhouette),c=L6e(),u=D6e(n);let d=this._texV0+c*this._texVScale,p=this._texV0+l*u*this._texVScale;if(n>VF){lJ(t.eye,t.center,t.up,i,this._passParameters.silhouette);const g=this._computeScreenRimWidth(t,t.eye,t.up,this._passParameters.silhouette),y=fe((g-1.5)/(l-1.5),0,1);d=this._texV0+y*c*this._texVScale,p=this._texV0+yt(this._texV1,l*u,y)*this._texVScale}Qt(this._passParameters.texV,d,p)}_createRibbon(t){const r=Vi(3+3*dR*3),i=new Uint32Array(3*dR*5);r[0]=0,r[1]=0,r[2]=-1;for(let o=0;o<dR;o++){const a=9*o+3;r[a]=o,r[a+1]=this._innerRimFactor,r[a+2]=-1,r[a+3]=o,r[a+4]=this._middleRimFactor,r[a+5]=0,r[a+6]=o,r[a+7]=this._outerRimFactor,r[a+8]=1;const l=3*o+1,c=o===dR-1?1:l+3,u=15*o;i[u]=l,i[u+1]=l+1,i[u+2]=c+1,i[u+3]=c+1,i[u+4]=c,i[u+5]=l,i[u+6]=l+1,i[u+7]=l+2,i[u+8]=c+2,i[u+9]=c+2,i[u+10]=c+1,i[u+11]=l+1,i[u+12]=l,i[u+13]=c,i[u+14]=0}const s=cJ.createBuffer(i.length),n=s.position;for(let o=0;o<i.length;++o){const a=3*i[o];n.set(o,0,r[a]),n.set(o,1,r[a+1]),n.set(o,2,r[a+2])}return new Ed(t,dr,{geometry:Wl(cJ)},{geometry:rr.createVertex(t,gr.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(t,r,i,s){return oe(Eb,s.center,s.v2),te(pR,Eb,this._outerRimFactor),_N(GF,r,Eb,i),MY(Eb,GF,t.projectionMatrix,t.viewport,Eb),MY(pR,GF,t.projectionMatrix,t.viewport,pR),ni(Eb,pR)/t.height}}function lJ(e,t,r,i,s){const n=Se(e),o=i*Math.sqrt(n*n-i*i)/n,a=Math.sqrt(i*i-o*o),l=s.v1,c=s.v2;return te(s.center,e,a/n),rt(l,e,t),Bo(l)<1&&rt(l,e,r),te(l,l,o/Se(l)),rt(c,l,e),te(c,c,o/Se(c)),o}const GF=be(),Eb=C(),pR=C();function F6e(e,t,r){return e*e/(Math.sqrt(e*e-t*t)*Math.sqrt(e*e-r*r)+t*r)}const cJ=Li().vec3f(E.POSITION);var Bm;(function(e){e[e.Rain=0]="Rain",e[e.Snow=1]="Snow",e[e.COUNT=2]="COUNT"})(Bm||(Bm={}));class Cz extends Yo{constructor(){super(...arguments),this.type=Bm.Rain}}h([B({count:Bm.COUNT})],Cz.prototype,"type",void 0);function U6e(e){const t=new pr;return t.attributes.add(E.POSITION,"vec3"),t.attributes.add(E.INSTANCEFEATUREATTRIBUTE,"float"),t.vertex.uniforms.add(new Rt("cameraPosition",(r,i)=>i.camera.eye)),t.vertex.uniforms.add(new Rt("offset",(r,i)=>k6e(r,i))),t.vertex.uniforms.add(new Ae("width",r=>r.width)),t.vertex.uniforms.add(new Ci("proj",(r,i)=>i.camera.projectionMatrix)),t.vertex.uniforms.add(new Ci("view",(r,i)=>i.camera.viewMatrix)),t.vertex.uniforms.add(new Ae("time",r=>r.time)),t.varyings.add("vUv","vec2"),t.vertex.code.add(b`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${e.type===Bm.Rain?b`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:b`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),t.fragment.uniforms.add(new Ae("opacity",r=>r.opacity),new Rt("particleColor",(r,i)=>z6e(i,e))),t.fragment.code.add(b`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${e.type===Bm.Rain?b`d = 0.35 * smoothstep(0.5, 0.0, d);`:b`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `),t}function k6e(e,t){const r=t.camera.eye,i=.5*e.width,s=1/e.width,n=Ene(Az,se(Az,(r[0]+i)*s,(r[1]+i)*s,(r[2]+i)*s));return Ln(n,r,te(n,n,e.width))}function z6e(e,t){const r=t.type===Bm.Rain?V6e:B6e,i=te(Az,r,G6e),s=e.camera.eye;pe(uJ,s);const n=Math.max(0,de(uJ,e.lighting.mainLight.direction));return Lr(i,i,r,n)}const Az=C(),uJ=C(),B6e=Ce(1,1,1),V6e=Ce(.85,.85,.85),G6e=.7,j6e=Object.freeze(Object.defineProperty({__proto__:null,build:U6e},Symbol.toStringTag,{value:"Module"}));class H6e extends Wr{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}}class zA extends xr{initializeProgram(t){return new vr(t.rctx,zA.shader.get().build(this.configuration),cI)}initializePipeline(){return Tt({blending:oo(ve.ONE,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),depthTest:{func:Hr.LEQUAL},colorWrite:It})}}zA.shader=new _r(j6e,()=>ue(()=>import("./Precipitation.glsl.b156bc31.js"),[]));const cI=new Map([[E.POSITION,0],[E.INSTANCEFEATUREATTRIBUTE,1]]);class Hfe{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:t,fixedTime:r}){return r!=null?this._time!==r&&(this._time=r,!0):(this._time=this._time+t,t!==0)}}class W6e{constructor(t,r){this.deltaTime=t,this.fixedTime=r}}let J_=class extends xe{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new H6e,this._animation=new Hfe,this._updatingTracking=new Fp,this._passParameters.time=0,this._passParameters.radius=Mr(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=Mi(this._snowTechniqueCached),this._rainTechniqueCached=Mi(this._rainTechniqueCached),this._vao=De(this._vao),this._instanceIdBuffer=De(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(this._rainTechniqueCached==null){const e=new Cz;e.type=Bm.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire(zA,e)}return this._rainTechniqueCached}get _snowTechnique(){if(this._snowTechniqueCached==null){const e=new Cz;e.type=Bm.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire(zA,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,t,r){const i=r==="rainy"?this._rainTechnique:this._snowTechnique;if(!i.compiled)return void this.context.requestRender();const s=e.rctx;if(this._ensureResources(s),i==null||this._vao==null||this._instanceIdBuffer==null||(e.bindParameters.cloudsFade.data!=null&&(this._passParameters.opacity=1-e.bindParameters.cloudsFade.fadeInOutHeight.factor),this._passParameters.opacity<=0))return;const n=.35;t=t<.5?yt(0,n,2*t):yt(n,1,2*(t-.5)),this._passParameters.time=(r==="rainy"?this._rainSpeed:this._snowSpeed)*BV(this._animation.time)%1e5;const o=s.bindTechnique(i,this._passParameters,e.bindParameters);s.bindVAO(this._vao),o.assertCompatibleVertexAttributeLocations(this._vao),lj(s,cI,this._instanceIdBuffer,hJ,0),s.capabilities.instancing?.drawArraysInstanced(bt.TRIANGLES,0,3,this._numParticles*t),cj(s,cI,this._instanceIdBuffer,hJ)}_ensureResources(e){this._vao==null&&(this._vao=this._createVertexArrayObject(e)),this._instanceIdBuffer==null&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const t=[];for(let r=0;r<this._numParticles;r++)t.push(r);return rr.createVertex(e,gr.STATIC_DRAW,new Float32Array(t))}_createVertexArrayObject(e){const t=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new Ed(e,cI,{geometry:Wl(q6e)},{geometry:rr.createVertex(e,gr.STATIC_DRAW,t)})}};h([f({constructOnly:!0})],J_.prototype,"context",void 0),h([f({constructOnly:!0})],J_.prototype,"view",void 0),h([f({readOnly:!0})],J_.prototype,"updating",null),h([f()],J_.prototype,"_updatingTracking",void 0),J_=h([F("esri.views.3d.environment.Precipitation")],J_);const q6e=Li().vec3f(E.POSITION),hJ=Wl(Li().f32(E.INSTANCEFEATUREATTRIBUTE),1);function X6e(){const e=new pr;return e.attributes.add(E.POSITION,"vec3"),e.attributes.add(E.COLOR,"vec4"),e.attributes.add(E.SIZE,"float"),e.varyings.add("vcolor","vec4"),e.varyings.add("vsize","float"),e.vertex.uniforms.add(new Ci("transform",(t,r)=>Z6e(t,r)),new Zt("viewport",(t,r)=>r.camera.fullViewport),new Ae("pixelRatio",(t,r)=>r.camera.pixelRatio)),e.vertex.code.add(b`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),e.fragment.code.add(b`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`),e}function Z6e(e,t){return Ss(vg,t.camera.projectionMatrix),vg[10]=24e-8-1,vg[11]=-1,vg[14]=(24e-8-2)*t.camera.near,Jr(vg,vg,t.camera.viewMatrix),Jr(vg,vg,e.modelMatrix)}const vg=be(),Y6e=Object.freeze(Object.defineProperty({__proto__:null,build:X6e},Symbol.toStringTag,{value:"Module"}));class J6e extends Wr{constructor(){super(...arguments),this.modelMatrix=be()}}class WN extends xr{constructor(t){super(t,new Yo,()=>this.destroy())}initializeProgram(t){return new vr(t.rctx,WN.shader.get().build(),dr)}initializePipeline(){return Tt({blending:oo(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),depthTest:{func:Hr.LEQUAL},colorWrite:It})}}WN.shader=new _r(Y6e,()=>ue(()=>import("./Stars.glsl.dd99ead3.js"),[]));let p0=class extends xe{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return this._loadDataTask!=null&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new J6e,this._updatingTracking=new Fp}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=$c(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=Mi(this._technique),this._vao=De(this._vao),Ky=null}render(e){const{rctx:t}=e;if(this._ensureResources(t),this._technique==null||this._vao==null)return;if(!this._technique.compiled)return void this.requestRender();const r=t.bindTechnique(this._technique,this._renderParameter,e.bindParameters);t.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(bt.POINTS,0,this._numPoints)}_ensureResources(e){if(this._technique!=null||Ky==null)return;this._technique=new WN({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=Ky.byteLength/dJ;const t=new Float32Array(Ky,0,2*this._numPoints),r=new Uint8Array(Ky,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,t,r,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,i=>this._update(i),Rr)}_computeDayDuration(e){const t=e,r=new Date(e.getFullYear(),0,1,11,58,56);return(+t-+r)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+r)}_update(e){if(!e)return;const t=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*this._computeDayDuration(e),i=Ss(this._renderParameter.modelMatrix,eUe);fT(i,i,-r*Math.PI),Jr(i,Q6e,i),fT(i,i,-t*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,t,r,i){const s=pJ.createBuffer(i),n=s.position,o=s.color,a=s.size;for(let l=0;l<i;l++){const c=t[2*l],u=t[2*l+1];n.set(l,0,-Math.cos(c)*Math.sin(u)),n.set(l,1,-Math.sin(c)*Math.sin(u)),n.set(l,2,-Math.cos(u));const d=this._unpackUint8Attributes(r[l]),p=this._hexToRGB(K6e[d[1]]);o.set(l,0,255*p[0]),o.set(l,1,255*p[1]),o.set(l,2,255*p[2]),o.set(l,3,255),a.set(l,d[0])}return new Ed(e,dr,{geometry:Wl(pJ)},{geometry:rr.createVertex(e,gr.STATIC_DRAW,s.buffer)})}_createLoadDataTask(){if(Ky!=null)return null;const e=v2(async t=>{const{data:r}=await IEe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:t});this._verifyStarData(r),Ky=r});return e.promise.catch(t=>{$s(t)||K.getLogger(this).error(t)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new G("stars:no-data-received","Failed to create stars because star catalogue is missing");const t=e.byteLength/dJ;if(t%1!=0||t>5e4||t<5e3)throw new G("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};h([f({constructOnly:!0})],p0.prototype,"view",void 0),h([f({constructOnly:!0})],p0.prototype,"requestRender",void 0),h([f({readOnly:!0})],p0.prototype,"updating",null),h([f()],p0.prototype,"_loadDataTask",void 0),h([f()],p0.prototype,"_updatingTracking",void 0),p0=h([F("esri.views.3d.environment.Stars")],p0);const K6e=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],Q6e=PG(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),eUe=PG(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),dJ=9,pJ=Li().vec3f(E.POSITION).vec4u8(E.COLOR).f32(E.SIZE);let Ky=null;function tUe(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function xL(e,t,r){r*=.5;const i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function Rj(e,t){const r=2*Math.acos(t[3]),i=Math.sin(r/2);return i>Ta()?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r}function Pj(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=r[0],l=r[1],c=r[2],u=r[3];return e[0]=i*u+o*a+s*c-n*l,e[1]=s*u+o*l+n*a-i*c,e[2]=n*u+o*c+i*l-s*a,e[3]=o*u-i*a-s*l-n*c,e}function rUe(e,t,r){r*=.5;const i=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+o*a,e[1]=s*l+n*a,e[2]=n*l-s*a,e[3]=o*l-i*a,e}function iUe(e,t,r){r*=.5;const i=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l-n*a,e[1]=s*l+o*a,e[2]=n*l+i*a,e[3]=o*l-s*a,e}function sUe(e,t,r){r*=.5;const i=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+s*a,e[1]=s*l-i*a,e[2]=n*l+o*a,e[3]=o*l-n*a,e}function nUe(e,t){const r=t[0],i=t[1],s=t[2];return e[0]=r,e[1]=i,e[2]=s,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-s*s)),e}function uI(e,t,r,i){const s=t[0],n=t[1],o=t[2],a=t[3];let l,c,u,d,p,g=r[0],y=r[1],_=r[2],v=r[3];return c=s*g+n*y+o*_+a*v,c<0&&(c=-c,g=-g,y=-y,_=-_,v=-v),1-c>Ta()?(l=Math.acos(c),u=Math.sin(l),d=Math.sin((1-i)*l)/u,p=Math.sin(i*l)/u):(d=1-i,p=i),e[0]=d*s+p*g,e[1]=d*n+p*y,e[2]=d*o+p*_,e[3]=d*a+p*v,e}function oUe(e){const t=y3,r=t(),i=t(),s=t(),n=Math.sqrt(1-r),o=Math.sqrt(r);return e[0]=n*Math.sin(2*Math.PI*i),e[1]=n*Math.cos(2*Math.PI*i),e[2]=o*Math.sin(2*Math.PI*s),e[3]=o*Math.cos(2*Math.PI*s),e}function aUe(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=r*r+i*i+s*s+n*n,a=o?1/o:0;return e[0]=-r*a,e[1]=-i*a,e[2]=-s*a,e[3]=n*a,e}function Sy(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function Wfe(e,t){const r=t[0]+t[4]+t[8];let i;if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{let s=0;t[4]>t[0]&&(s=1),t[8]>t[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;i=Math.sqrt(t[3*s+s]-t[3*n+n]-t[3*o+o]+1),e[s]=.5*i,i=.5/i,e[3]=(t[3*n+o]-t[3*o+n])*i,e[n]=(t[3*n+s]+t[3*s+n])*i,e[o]=(t[3*o+s]+t[3*s+o])*i}return e}function lUe(e,t,r,i){const s=.5*Math.PI/180;t*=s,r*=s,i*=s;const n=Math.sin(t),o=Math.cos(t),a=Math.sin(r),l=Math.cos(r),c=Math.sin(i),u=Math.cos(i);return e[0]=n*l*u-o*a*c,e[1]=o*a*u+n*l*c,e[2]=o*l*c-n*a*u,e[3]=o*l*u+n*a*c,e}function cUe(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}const Mj=$u,uUe=pi,hUe=RV,dUe=Pj,pUe=t1,fUe=$ne,mUe=IV,qfe=PV,gUe=qfe,Xfe=MV,yUe=Xfe,Ij=Ine,_Ue=Tx,vUe=JI;function bUe(e,t,r){const i=de(t,r);return i<-.999999?(rt(Dd,wUe,t),bl(Dd)<1e-6&&rt(Dd,xUe,t),pe(Dd,Dd),xL(e,Dd,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(rt(Dd,t,r),e[0]=Dd[0],e[1]=Dd[1],e[2]=Dd[2],e[3]=1+i,Ij(e,e))}const Dd=C(),wUe=Ce(1,0,0),xUe=Ce(0,1,0);function TUe(e,t,r,i,s,n){return uI(fJ,t,s,n),uI(mJ,r,i,n),uI(e,fJ,mJ,2*n*(1-n)),e}const fJ=rh(),mJ=rh();function SUe(e,t,r,i){const s=EUe;return s[0]=r[0],s[3]=r[1],s[6]=r[2],s[1]=i[0],s[4]=i[1],s[7]=i[2],s[2]=-t[0],s[5]=-t[1],s[8]=-t[2],Ij(e,Wfe(e,s))}const EUe=$i();Object.freeze(Object.defineProperty({__proto__:null,add:hUe,calculateW:nUe,conjugate:Sy,copy:Mj,dot:fUe,equals:vUe,exactEquals:_Ue,fromEuler:lUe,fromMat3:Wfe,getAxisAngle:Rj,identity:tUe,invert:aUe,len:gUe,length:qfe,lerp:mUe,mul:dUe,multiply:Pj,normalize:Ij,random:oUe,rotateX:rUe,rotateY:iUe,rotateZ:sUe,rotationTo:bUe,scale:pUe,set:uUe,setAxes:SUe,setAxisAngle:xL,slerp:uI,sqlerp:TUe,sqrLen:yUe,squaredLength:Xfe,str:cUe},Symbol.toStringTag,{value:"Module"}));function rg(e=AUe){return[e[0],e[1],e[2],e[3]]}function jF(e,t,r=rg()){return re(r,e),r[3]=t,r}function gJ(e,t,r=rg()){return rt(r,e,t),pe(r,r),r[3]=-Ane(e,t),r}function yJ(e,t,r=rg()){return xL(fR,e,_J(e)),xL(vJ,t,_J(t)),Pj(fR,vJ,fR),CUe(r,xa(Rj(r,fR)))}function uft(e,t,r,i=rg()){return jF(Tne,e,mR),jF(Sne,t,bJ),jF(CV,r,wJ),yJ(mR,bJ,mR),yJ(mR,wJ,i),i}function hft(e){return e}function dft(e){return e[3]}function _J(e){return Ot(e[3])}function CUe(e,t){return e[3]=t,e}const AUe=[0,0,1,0],fR=rh(),vJ=rh();rg();const mR=rg(),bJ=rg(),wJ=rg();function OUe(e,t,r){const i=e.parallax.anchorPointClouds;e.fadeIn.stage===El.FINISHED&&(e.fadeIn.factor=0,re(i,Op),e.fadeIn.stage=El.CHANGE_ANCHOR,e.crossFade.enabled=!1,e.fadeInOut.stage=ln.FINISHED),e.fadeIn.stage===El.CHANGE_ANCHOR&&e.isCameraPositionFinal&&(gj(e.data)&&e.renderingStage!==vs.RENDERING||e.renderingStage===vs.FADING_TEXTURE_CHANNELS)&&(re(i,Op),e.fadeIn.stage=El.FADE_IN,e.startTime=t,e.renderingStage===vs.FADING_TEXTURE_CHANNELS&&(e.renderingStage=vs.SWITCH_CHANNELS)),e.fadeIn.factor<1&&e.fadeIn.stage===El.FADE_IN?e.fadeIn.factor=r?fe((t-e.startTime)/(Zfe*r),0,1):1:e.fadeIn.factor>=1&&e.fadeIn.stage===El.FADE_IN&&(e.fadeIn.stage=El.FINISHED,e.fadeIn.factor=1)}function RUe(e,t,r){const{fadeInOut:i,crossFade:s}=e;i.stage===ln.FINISHED&&(e.startTime=t,i.factor=1,i.stage=ln.FADE_OUT),i.factor>0&&i.stage===ln.FADE_OUT?i.factor=r?1-fe((t-e.startTime)/(LUe*r),0,1):0:(i.factor<=0&&i.stage===ln.FADE_OUT&&(i.factor=0,re(e.parallax.anchorPointClouds,Op)),i.factor<=0&&i.stage===ln.FADE_OUT&&e.isCameraPositionFinal&&(i.factor=0,i.stage=ln.SWITCH,e.crossFade.enabled=!1,s.factor=1),i.stage===ln.SWITCH&&(gj(e.data)&&e.renderingStage!==vs.RENDERING||e.renderingStage===vs.FADING_TEXTURE_CHANNELS)&&(e.startTime=t,i.factor=0,i.stage=ln.FADE_IN,re(e.parallax.anchorPointClouds,Op),e.crossFade.enabled=!1,s.factor=1,e.renderingStage===vs.FADING_TEXTURE_CHANNELS&&(e.renderingStage=vs.SWITCH_CHANNELS)),i.factor<1&&i.stage===ln.FADE_IN?i.factor=r?fe((t-e.startTime)/(Zfe*r),0,1):1:i.factor>=1&&i.stage===ln.FADE_IN&&(i.stage=ln.FINISHED,i.factor=1))}function PUe(e,t,r,i){const{crossFade:s}=e,n=e.parallax.anchorPointClouds;e.crossFade.enabled&&!i||(re(e.parallaxNew.anchorPointClouds,Op),e.startTime=t,s.factor=0,e.crossFade.enabled=!0),s.factor<1&&e.crossFade.enabled?s.factor=r?fe((t-e.startTime)/(DUe*r),0,1):1:s.factor>=1&&e.crossFade.enabled&&(e.crossFade.enabled=!1,s.factor=1,re(n,e.parallaxNew.anchorPointClouds),e.renderingStage===vs.FADING_TEXTURE_CHANNELS&&(e.renderingStage=vs.SWITCH_CHANNELS))}function xJ(e,t,r,i){const s=e.fadeInOutHeight,n=s.stage===_y.FINISHED?r:e.startTimeHeightFade;if(i!==0){const o=(r-n)/(NUe*i);s.factor+=t?-o:o}else s.factor=t?0:1;e.startTimeHeightFade=r,s.factor=fe(s.factor,0,1),s.stage=_y.HEIGHT_FADE}function MUe(e,t,r,i,s){e.renderingStage===vs.FINISHED_RENDERING&&(e.renderingStage=vs.FADING_TEXTURE_CHANNELS);const n=Se(t.eye);e.fadeInOutHeight.factor<0&&(e.fadeInOutHeight.factor=n-Kt.radius>bp?1:0),e.isCameraPositionFinal=ly(e.cameraPositionLastFrame,t.eye),pe(Op,t.eye),te(Op,Op,Kt.radius);const o=e.parallax;o.anchorPointClouds[0]===0&&o.anchorPointClouds[1]===0&&o.anchorPointClouds[2]===0&&re(o.anchorPointClouds,Op);const a=Se(ce($Ue,o.anchorPointClouds,Op));let l=!0;a>e.fadeIn.distanceThresholdFactor*o.cloudsHeight||e.fadeIn.stage!==El.FINISHED?OUe(e,i,s):a>e.fadeInOut.distanceThresholdFactor*o.cloudsHeight||e.fadeInOut.stage!==ln.FINISHED?RUe(e,i,s):a>e.crossFade.distanceThresholdFactor*o.cloudsHeight||e.crossFade.enabled||e.renderingStage===vs.FADING_TEXTURE_CHANNELS?PUe(e,i,s,(r!==Er.IDLE||!gj(e.data))&&e.renderingStage!==vs.FADING_TEXTURE_CHANNELS):l=!1;const c=n-Kt.radius;if((c>1.7*bp||c<-bp)&&e.fadeInOutHeight.factor<1?e.fadeInOutHeight.factor=1:(c>bp||c<-.35*bp)&&e.fadeInOutHeight.factor<1?xJ(e,!1,i,s):c<bp&&c>-.35*bp&&e.fadeInOutHeight.factor>0?xJ(e,!0,i,s):e.fadeInOutHeight.stage=_y.FINISHED,e.renderingStage===vs.SWITCH_CHANNELS&&(e.readChannels=1-e.readChannels,e.renderingStage=vs.FINISHED),o.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(n*n-Kt.radius*Kt.radius,0))/n,gJ(TJ,o.anchorPointClouds,Cb),$l(o.transform,Ks,Cb[3],Cb),l){const{parallaxNew:u}=e;gJ(TJ,u.anchorPointClouds,Cb),$l(u.transform,Ks,Cb[3],Cb)}re(e.cameraPositionLastFrame,t.eye)}function IUe(e){return e.crossFade.enabled||e.fadeInOut.stage!==ln.FINISHED||e.fadeIn.stage!==El.FINISHED||e.fadeInOutHeight.stage!==_y.FINISHED||e.renderingStage!==vs.FINISHED}const TJ=Ce(0,0,1),Cb=rg(),Op=C(),$Ue=C(),Zfe=1,LUe=.5,DUe=1.3,NUe=1;class S2{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(t,r){return this._outer.get(t)?.get(r)}set(t,r,i){const s=this._outer.get(t);s?s.set(r,i):this._outer.set(t,new Map([[r,i]]))}delete(t,r){const i=this._outer.get(t);i&&(i.delete(r),i.size===0&&this._outer.delete(t))}forEach(t){this._outer.forEach((r,i)=>t(r,i))}}var Fs;function SJ(e=!ne("disable-feature:high-quality-idle"),t=null){const r=new S2;return e?(r.set(Er.IDLE,Fs.Antialiasing,t!=="low"),r.set(Er.IDLE,Fs.HighResolutionAtmosphere,t!=="low"),r.set(Er.IDLE,Fs.HighQualityTransparency,!0),r.set(Er.IDLE,Fs.SSAO,!0),r.set(Er.IDLE,Fs.WaterReflection,!0),r.set(Er.IDLE,Fs.PhysicalPixelRendering,!ne("esri-mobile"))):(r.set(Er.ANIMATING,Fs.HighResolutionShadows,!0),r.set(Er.INTERACTING,Fs.HighResolutionShadows,!0)),r.set(Er.IDLE,Fs.HighResolutionShadows,!0),r.set(Er.IDLE,Fs.HighResolutionVoxel,!0),r}(function(e){e[e.Antialiasing=0]="Antialiasing",e[e.HighQualityTransparency=1]="HighQualityTransparency",e[e.HighResolutionVoxel=2]="HighResolutionVoxel",e[e.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",e[e.SSAO=4]="SSAO",e[e.WaterReflection=5]="WaterReflection",e[e.HighResolutionShadows=6]="HighResolutionShadows",e[e.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(Fs||(Fs={}));var Fx;(function(e){e[e.Immediate=0]="Immediate",e[e.Faded=1]="Faded"})(Fx||(Fx={}));var ME;const FUe=[ae.POSTPROCESSING_ENVIRONMENT_OPAQUE,ae.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let uo=ME=class extends xe{constructor(e){super(e),this._context=null,this._atmosphere=null,this._oldWeatherParameters=new HF,this._newWeatherParameters=new HF,this._fadedWeatherParameters=new HF,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(FUe,this)}destroy(){this.removeHandles(),this.uninitializeRenderContext(),this.view?._stage!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return this.atmosphere!=null?this.atmosphere.type:Do.None}get canRender(){return!(this._atmosphere===null&&this._stars===null)}get needsLinearDepth(){return this._atmosphereType===Do.Realistic}updateAnimation(e){return this._precipitation!=null&&this._precipitation.update(e)}get updating(){return this._stars!=null&&this._stars.updating||this._clouds!=null&&this._clouds.running}get weatherVisible(){return Se(this.view.state.camera.eye)-Mr(this.view.spatialReference).radius<=bp}get _stars(){const e=this.view,t=e.environment?.starsEnabled??!1,r=this._get("_stars");return t&&this._context!=null?r??new p0({view:e,requestRender:()=>this._setNeedsRender()}):(Re(r),null)}get _precipitation(){const e=this._get("_precipitation");if(!this._precipitationEnabled||this._context==null)return Re(e),null;const t=this.view,r=this._context;return e!=null&&e.context===r?e:(Re(e),new J_({context:r,view:t}))}get _clouds(){const e=this._get("_clouds");if(!this.weatherEnabled||this._context==null)return Re(e),null;if(e!=null)return e;const t=this.view,r=this._context;return Re(e),new Na({context:r,view:t,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const e=this._get("_cloudsComposition");if(!this.weatherEnabled||this._context==null)return Re(e),null;const t=this.view.state.viewingMode,r=this._context.renderContext.rctx,i=Mr(this.view.spatialReference).radius;return e!=null&&e.viewingMode===t&&e.planetRadius===i?e:(Re(e),new X_({rctx:r,viewingMode:t,planetRadius:i,requestRender:()=>this._setNeedsRender()}))}get _fog(){const e=this._get("_fog");if(!this.weatherEnabled||this._context==null)return Re(e),null;if(e!=null)return e;const t=this.view,r=this._context,i=this._context.renderContext.rctx,s=this.view.state.viewingMode;return new Z_({context:r,view:t,rctx:i,viewingMode:s})}get weatherEnabled(){return!!this.view?.environmentManager?.weatherEnabled}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(e=null){this._context=e;const t=()=>this._setNeedsRender();this.addHandles([le(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),r=>this._updateAtmosphere(r),_s),le(()=>this._stars,t),le(()=>this._precipitation,t),le(()=>this._clouds,()=>this._updateWeather(),Rr),le(()=>this._fog,()=>this._updateFogHaze(),Rr),le(()=>this.view.state.mode,()=>{this._setNeedsRender()},Vr),le(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},_s)])}uninitializeRenderContext(){this._context=null,this._atmosphere=Re(this._atmosphere),this._set("_stars",Re(this._stars)),this._set("_precipitation",Re(this._precipitation)),this._set("_clouds",Re(this._clouds)),this._set("_cloudsComposition",Re(this._cloudsComposition)),this._set("_fog",Re(this._fog))}prepareRender(e){e.bindParameters.cloudsFade.data=E5e(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&e.bindParameters.cloudsFade.data?.cubeMap!=null&&(MUe(e.bindParameters.cloudsFade,e.bindParameters.camera,this.view.state.mode,e.time,this.view.qualitySettings.fadeDuration),this._updateWeatherFading(e.bindParameters),e.bindParameters.cloudsFade.renderingStage===vs.FINISHED&&this._clouds!=null&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),e.bindParameters.cloudsFade.data=null))}render(e){if(e.output===D.Color)switch(e.bindParameters.slot){case ae.POSTPROCESSING_ENVIRONMENT_OPAQUE:this._stars!=null&&this._stars.render(e),this.atmosphere!=null&&(this.atmosphere.render(e,this.view?.qualitySettings.highResolutionAtmosphere||this.view?._stage?.renderer?.isFeatureEnabled(Fs.HighResolutionAtmosphere)),this._cloudsComposition!=null&&e.bindParameters.cloudsFade.data!=null&&(this.weatherVisible&&this._clouds!=null&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(e)),IUe(e.bindParameters.cloudsFade)&&this._context!=null&&e.bindParameters.cloudsFade.data?.cubeMap!=null&&this._context.requestRender());break;case ae.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(this.atmosphere!=null&&(this.atmosphere.renderHaze(e,this._weatherParameters.hazeAmount,this.view?.qualitySettings.highResolutionAtmosphere||this.view?._stage?.renderer?.isFeatureEnabled(Fs.HighResolutionAtmosphere)),this._weatherParameters.fog.amount>0&&this._fog!=null&&this._fog.render(e,this._weatherParameters.fog),this._precipitation!=null)){const t=this.view.environment.weather;t.type!=="rainy"&&t.type!=="snowy"||this._precipitation.render(e,t.precipitation,t.type)}}}updateLightSources(e,t,r,i){if(this._context!=null){const s=this._context.renderContext;s.bindParameters.oldLighting.copyFrom(s.bindParameters.lighting),s.bindParameters.newLighting.noonFactor=t,s.bindParameters.newLighting.globalFactor=r,s.bindParameters.newLighting.set(e),i===Fx.Faded||s.bindParameters.weatherFading?s.bindParameters.fadeLighting(0):s.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const e=this.weatherEnabled?this.view.environment.weather:null;return e==null?null:e.type==="rainy"||e.type==="snowy"?{type:e.type,weatherAdjustment:e.cloudCover,effect:e.precipitation}:{type:e.type,weatherAdjustment:e.type==="foggy"?e.fogStrength:e.cloudCover}}_updateWeatherFading(e){if(!e.weatherFading)return;const t=e.cloudsFade;return t.fadeIn.stage===El.FADE_IN?(e.fadeLighting(t.fadeIn.factor),void this._fadeWeather(t.fadeIn.factor)):t.fadeInOut.stage===ln.FADE_IN?(e.fadeLighting(t.fadeInOut.factor),void this._fadeWeather(t.fadeInOut.factor)):t.crossFade.enabled?(e.fadeLighting(t.crossFade.factor),void this._fadeWeather(t.crossFade.factor)):(e.fadeLighting(0),void this._fadeWeather(0))}_fadeWeather(e){const{_newWeatherParameters:t,_oldWeatherParameters:r}=this;e>=1?this._weatherParameters=t:(this._fadedWeatherParameters.lerp(r,t,e),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const e=this._weatherUpdateParameters;e!=null&&this._clouds!=null&&(this._clouds.applyPreset(Lo[e.type],e.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){this._context!=null&&this._context.requestRender()}_updateFogHaze(){const e=this._weatherUpdateParameters;if(this._fog==null||e==null||this._context==null)return;const t=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),e.type){case"foggy":this._newWeatherParameters.fog.strength=yt(3e-5,.005,e.weatherAdjustment**3),re(this._newWeatherParameters.fog.color,EJ),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=yt(4e-6,2e-4,(e.effect??0)**3),re(this._newWeatherParameters.fog.color,UUe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=yt(4e-6,2e-4,(e.effect??0)**3),re(this._newWeatherParameters.fog.color,EJ),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}t.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(e){const t=this._selectAtmosphereType(e);if(t!==Do.None&&this._context){if(!this._atmosphere||this._atmosphere.type!==t){this._atmosphere=Re(this._atmosphere);const r=this._getAtmosphereClass(t);r&&(this._atmosphere=new r(this.view,this._context))}}else this._atmosphere=Re(this._atmosphere);this._setNeedsRender()}_getAtmosphereClass(e){switch(e){case Do.Realistic:return GY;case Do.Local:return M6e;case Do.Mars:return N6e;default:case Do.None:return null}}_selectAtmosphereType(e){const{enabled:t,viewingMode:r}=e;return!t||lf(this.view.spatialReference)?Do.None:r===Ie.Local?Do.Local:this._context!=null&&GY.isSupported(this._context)&&nT(this.view.spatialReference)?Do.Realistic:af(this.view.spatialReference)?Do.Mars:Do.None}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),stubGetAtmosphereClass:e=>{CJ=ME.prototype._getAtmosphereClass,ME.prototype._getAtmosphereClass=e},restoreGetAtmosphereClass:()=>{ME.prototype._getAtmosphereClass=CJ}}}};h([f({constructOnly:!0})],uo.prototype,"view",void 0),h([f({readOnly:!0})],uo.prototype,"atmosphere",null),h([f({readOnly:!0})],uo.prototype,"_atmosphereType",null),h([f({type:Boolean,readOnly:!0})],uo.prototype,"updating",null),h([f({readOnly:!0})],uo.prototype,"weatherVisible",null),h([f()],uo.prototype,"_context",void 0),h([f()],uo.prototype,"_atmosphere",void 0),h([f({readOnly:!0})],uo.prototype,"_stars",null),h([f({readOnly:!0})],uo.prototype,"_precipitation",null),h([f({readOnly:!0})],uo.prototype,"_clouds",null),h([f({readOnly:!0})],uo.prototype,"_cloudsComposition",null),h([f({readOnly:!0})],uo.prototype,"_fog",null),h([f({readOnly:!0})],uo.prototype,"weatherEnabled",null),h([f({readOnly:!0})],uo.prototype,"_precipitationEnabled",null),h([f({readOnly:!0})],uo.prototype,"_weatherUpdateParameters",null),uo=ME=h([F("esri.views.3d.environment.EnvironmentRenderer")],uo);class HF{constructor(){this.fog=new XFe,this.hazeAmount=1}copyFrom(t){this.fog.amount=t.fog.amount,this.hazeAmount=t.hazeAmount,this.fog.strength=t.fog.strength,re(this.fog.color,t.fog.color)}lerp(t,r,i){this.fog.amount=yt(t.fog.amount,r.fog.amount,i),this.hazeAmount=yt(t.hazeAmount,r.hazeAmount,i),this.fog.strength=yt(t.fog.strength,r.fog.strength,i),Lr(this.fog.color,t.fog.color,r.fog.color,i)}}const UUe=Ce(.5,.5,.5),EJ=Ce(1.5,1.5,1.5);let CJ;function AJ(e,t,r){if(t.longitude==null||t.latitude==null||r.longitude==null||r.latitude==null)throw new Error("Invalid points: no lon/lat");return kUe(e,t.longitude,t.latitude,r.longitude,r.latitude)}function kUe(e,t,r,i,s){const n=Ot(r),o=Ot(s),a=n-o,l=Ot(t)-Ot(i),c=Math.sin(a/2),u=Math.sin(l/2),d=2*Hu(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*u*u))*e;return Math.round(1e4*d)/1e4}function zUe(e,t,r){const i=t.spatialReference,s=Mr(i),n=new ut(t.x,e.y,i),o=new ut(r.x,e.y,i),a=new ut(e.x,t.y,i),l=new ut(e.x,r.y,i);return{lon:AJ(s.radius,n,o),lat:AJ(s.radius,a,l)}}function BUe(e,t,r){const i=t/r,s=Ot(e),n=Math.sin(i/2),o=Math.cos(s),a=2*Hu(Math.sqrt(n*n/(o*o)));return xa(a)}function VUe(e,t){let r=e/15;return t||(r=Math.round(r)),r}function OJ(e,t){const r=e?.[0];if(r==null)return null;t||(t={hours:0,minutes:0,seconds:0}),t.hours=VUe(r,!0);const i=t.hours%1;t.hours-=i,t.minutes=60*i;const s=t.minutes%1;return t.minutes-=s,t.seconds=Math.round(60*s),t}var pft=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function q3(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var RJ,PJ,MJ,Oz={exports:{}};Oz.exports,RJ=Oz,PJ=function(){var e=Math.PI,t=Math.sin,r=Math.cos,i=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=e/180,l=864e5,c=2440588,u=2451545,d={dec:0,ra:0};function p(R){return R.valueOf()/l-.5+c}function g(R){return new Date((R+.5-c)*l)}function y(R){return p(R)-u}var _=23.4397*a;function v(R,k){return n(t(R)*r(_)-i(k)*t(_),r(R))}function w(R,k){return s(t(k)*r(_)+r(k)*t(_)*t(R))}function T(R,k,z){return n(t(R),r(R)*t(k)-i(z)*r(k))}function x(R,k,z){return s(t(k)*t(z)+r(k)*r(z)*r(R))}function S(R,k){return a*(280.16+360.9856235*R)-k}function O(R){return a*(357.5291+.98560028*R)}function A(R){return a*(1.9148*t(R)+.02*t(2*R)+3e-4*t(3*R))}function $(R,k){return R+k+102.9372*a+e}function P(R,k){var z=O(R),H=$(z,A(z));return k||(k={dec:0,ra:0}),k.dec=w(H,0),k.ra=v(H,0),k}var U={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(R,k,z,H){var X=a*-z,Y=a*k,ee=y(R),me=P(ee,d),$e=S(ee,X)-me.ra;return H||(H={azimuth:0,altitude:0}),H.azimuth=T($e,Y,me.dec),H.altitude=x($e,Y,me.dec),H}},I=[[-.83,"sunrise","sunset"]];U.addTime=function(R,k,z){I.push([R,k,z])};var L=9e-4;function N(R,k){return Math.round(R-L-k/(2*e))}function Z(R,k,z){return L+(R+k)/(2*e)+z}function W(R,k,z){return u+R+.0053*t(k)-.0069*t(2*z)}function V(R,k,z){return o((t(R)-t(k)*t(z))/(r(k)*r(z)))}function J(R){var k=a*(134.963+13.064993*R),z=a*(93.272+13.22935*R),H=a*(218.316+13.176396*R)+6.289*a*t(k),X=5.128*a*t(z),Y=385001-20905*r(k);return{ra:v(H,X),dec:w(H,X),dist:Y}}return U.getTimes=function(R,k,z){var H=a*-z,X=a*k,Y=N(y(R),H),ee=Z(0,H,Y),me=O(ee),$e=A(me),pt=$(me,$e),St=w(pt,0),it=W(ee,me,pt);function ft(nt){return W(Z(V(nt,X,St),H,Y),me,pt)}function ge(nt){var ze=(t(nt)-t(X)*t(St))/(r(X)*r(St));return ze<-1?U.PolarException.MIDNIGHT_SUN:ze>1?U.PolarException.POLAR_NIGHT:U.PolarException.NORMAL}var Ee,_t,_e,ke,Ve,ct={solarNoon:g(it),nadir:g(it-.5),polarException:U.PolarException.NORMAL};for(Ee=0,_t=I.length;Ee<_t;Ee+=1)Ve=it-((ke=ft((_e=I[Ee])[0]*a))-it),ct[_e[1]]=g(Ve),ct[_e[2]]=g(ke);return ct.polarException=ge(I[0][0]*a),ct},U.getMoonPosition=function(R,k,z){var H=a*-z,X=a*k,Y=y(R),ee=J(Y),me=S(Y,H)-ee.ra,$e=x(me,X,ee.dec);return $e+=.017*a/i($e+10.26*a/($e+5.1*a)),{azimuth:T(me,X,ee.dec),altitude:$e,distance:ee.dist}},U.getMoonFraction=function(R){var k=y(R),z=P(k),H=J(k),X=149598e3,Y=o(t(z.dec)*t(H.dec)+r(z.dec)*r(H.dec)*r(z.ra-H.ra)),ee=n(X*t(Y),H.dist-X*r(Y));return(1+r(ee))/2},U},(MJ=PJ())!==void 0&&(RJ.exports=MJ);const L1=q3(Oz.exports),ma={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};class gR{constructor(t,r){this.direct=t,this.ambient=r}}function GUe(e,t,r,i,s,n){se(n.ambient.color,1,1,1),n.ambient.intensity=ma.global.ambient,se(n.direct.color,1,1,1),n.direct.intensity=ma.global.direct;const o=t[2],a=fe((Math.abs(o)-ma.local.altitude)/(ma.global.altitude-ma.local.altitude),0,1);let l;if(n.globalFactor=a,e!=null&&(l=L1.getTimes(e,t[1],t[0])),a<1){let c;if(e!=null)c=YUe(e,l,i);else{const u=Kfe(i);c={direct:{intensity:ma.local.directAtNoon*u.direct,color:Ce(1,1,1)},ambient:{intensity:ma.local.ambientAtNoon*u.ambient,color:Ce(1,1,1)},timeOfDay:"early afternoon"}}Lr(n.ambient.color,c.ambient.color,n.ambient.color,a),n.ambient.intensity=yt(c.ambient.intensity,n.ambient.intensity,a),Lr(n.direct.color,c.direct.color,n.direct.color,a),n.direct.intensity=yt(c.direct.intensity,n.direct.intensity,a),n.specularStrength=i==="rainy"||i==="snowy"||i==="foggy"?0:1,n.environmentStrength=i==="rainy"?.7:i==="snowy"||i==="foggy"?.75:1}n.noonFactor=e!=null?ZUe(e,l):1,e!=null?jUe(e,t,r,n.direct.directionToLightSource):Yfe(s,r,n.direct.directionToLightSource)}function Yfe(e,t,r){t===Ie.Global?pe(ZF,e.eye):se(ZF,0,0,1),te(YF,e.viewForward,-1);const i=WM(YF,ZF),s=Math.max(i-2*JF,0),n=.85*s/(s+1),o=Math.max(JF,i-JF-n);Nc(VJ,-o,e.viewRight),Ue(r,YF,VJ),oe(r,r,te(JUe,e.viewRight,KUe)),pe(r,r)}function jUe(e,t,r,i){const s=XUe,n=Zu(qUe);if(r===Ie.Global)L1.getPosition(e,0,0,s),se(i,0,0,-1),pT(n,n,-s.azimuth),yN(n,n,-s.altitude),Ue(i,i,n);else{const o=ma.planarDirection,a=o.globalAngles,l=t[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=fe(c,0,1),c<1?(L1.getPosition(e,t[1],t[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),se(i,0,-1,0),fT(n,n,-s.azimuth),pT(n,n,-s.altitude),Ue(i,i,n)}}function HUe(e,t){if(t===Ie.Global)return!0;const r=ma.planarDirection;return Math.abs(e)<r.localAltitude}const WUe=Ce(.5773502691896258,-.5773502691896258,.5773502691896258);class Jfe{constructor(){this.ambient={color:Ce(1,1,1),intensity:.55},this.direct={color:Ce(1,1,1),intensity:.55,directionToLightSource:Ts(WUe)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const qUe=be(),XUe={azimuth:0,altitude:0};function ZUe(e,t){const r=e.valueOf();let i,s;t.polarException===L1.PolarException.MIDNIGHT_SUN?(i=r-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,s=i+432e6):t.polarException===L1.PolarException.POLAR_NIGHT?(i=r-2,s=r-1):(i=t.sunrise.valueOf(),s=t.sunset.valueOf());const n=i+(s-i)/2;return 1-fe(Math.abs(r-n)/432e5,0,1)}function Kfe(e){switch(e){case"disabled":case"sunny":case"cloudy":return new gR(1,1);case"rainy":return new gR(.4,1.2);case"snowy":return new gR(.5,1.3);case"foggy":return new gR(.2,1.6)}}function IJ(e,t){const r=(e[0]+e[1]+e[2])/3;e[0]+=(r-e[0])*t,e[1]+=(r-e[1])*t,e[2]+=(r-e[2])*t}const WF=Ce(.01,.01,.01),Rz=Ce(1,.6,.5),Pz=Ce(1,.98,.98),$J=Ce(1,1,1),qF=Ce(.8,.8,1),Mz=Ce(.8,.8,1),Iz=Ce(.98,.98,1),LJ=Ce(1,1,1),XF=or(.01,ma.local.ambientAtNight),$z=or(ma.local.directAtTwilight,ma.local.ambientAtTwilight),Lz=or(.9*ma.local.directAtNoon,ma.local.ambientAtNoon),DJ=or(ma.local.directAtNoon,ma.local.ambientAtNoon),NJ=Lz,FJ=Pz,UJ=Iz,kJ=$z,zJ=Rz,BJ=Mz;function YUe(e,t,r){const i=e.valueOf();let s,n;t.polarException===L1.PolarException.MIDNIGHT_SUN?(s=i-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,n=s+432e6):t.polarException===L1.PolarException.POLAR_NIGHT?(s=i-2,n=i-1):(s=t.sunrise.valueOf(),n=t.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,u=a+l,d=.06*o,p=s-d/2,g=s+d/2,y=n-d/2,_=n+d/2,v=Ne(),w=C(),T=C();let x="";if(i<p||i>_)en(v,XF),re(w,WF),re(T,qF),x="night";else if(i<g){const A=(i-p)/(g-p);Su(v,XF,$z,A),Lr(w,WF,Rz,A),Lr(T,qF,Mz,A),x="sun rising"}else if(i<c){const A=(i-g)/(c-g);Su(v,$z,Lz,A),Lr(w,Rz,Pz,A),Lr(T,Mz,Iz,A),x="early morning"}else if(i<a){const A=(i-c)/(a-c);Su(v,Lz,DJ,A),Lr(w,Pz,$J,A),Lr(T,Iz,LJ,A),x="late morning"}else if(i<u){const A=(i-a)/(u-a);Su(v,DJ,NJ,A),Lr(w,$J,FJ,A),Lr(T,LJ,UJ,A),x="early afternoon"}else if(i<y){const A=(i-u)/(y-u);Su(v,NJ,kJ,A),Lr(w,FJ,zJ,A),Lr(T,UJ,BJ,A),x="late afternoon"}else if(i<_){const A=(i-y)/(_-y);Su(v,kJ,XF,A),Lr(w,zJ,WF,A),Lr(T,BJ,qF,A),x="sun setting"}let S=0;switch(r){case"rainy":case"foggy":S=.8;break;case"snowy":S=.5}S>0&&(IJ(w,S),IJ(T,S));const O=Kfe(r);return{direct:{intensity:v[0]*O.direct,color:w},ambient:{intensity:v[1]*O.ambient,color:T},timeOfDay:x}}const VJ=be(),ZF=C(),YF=C(),JUe=C(),JF=.25,KUe=.2;let Ph=class extends cs.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new gi,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new mL,this._ambientLight=new Sj,this._moonLight=new Pfe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){return this._renderer?.view}get updating(){return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!this._renderer?.updating)}get weatherEnabled(){return this._view?.environment.atmosphereEnabled&&!this._disableWeather&&this._view?.state?.viewingMode===Ie.Global&&nT(this._view.spatialReference)}get weatherVisible(){return this.weatherEnabled&&this._renderer?.weatherVisible}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new uo({view:e});const t=()=>this._updateRenderParameters(),r=()=>this._cameraHandler();this._viewHandles.add([le(()=>e.environment.lighting,i=>this._updateLightingHandler(i),Vr),le(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,i=>this._lightingDateHandler(i),Vr),le(()=>e.stationary,()=>this._interactingStationaryHandler()),le(()=>e.environment.lighting.directShadowsEnabled,t,Vr),le(()=>e.qualitySettings.ambientOcclusion,t,Vr),le(()=>e.qualitySettings.reflections,t,Vr),le(()=>e.environment.background?.color,t,Vr),le(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Vr),le(()=>e.environment.weather.type,()=>this._updateLighting(null,Fx.Faded),Vr),le(()=>this.weatherEnabled,()=>this._updateLighting(null,Fx.Faded),Vr),le(()=>e.viewingMode,()=>this._resetReferencePosition(!0),_s),le(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,i=>this._updateCameraTracking(i),_s),le(()=>e.state.camera,r,_s),le(()=>this.disableQueries,r)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=Re(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const t=this._view.environment.lighting;t?.type!=="virtual"&&(t.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const t=this._view.environment.lighting;if(t?.type!=="virtual"){if(e){if(!t.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const r=this._view.spatialReference;if(!gy(r)){const i=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(i))return void this._requestReferencePositionUpdate(i)}if(this._preupdateTracking(e),this._referencePosWGS84Comparable!=null){const i=OJ(this._referencePosWGS84Comparable,GJ);i!=null&&(t.autoUpdate(null,i),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const t=this._view;if(!t.ready)return;const r=t.stateManager.camera;r&&(this._cameraHandlerClientSide(r,e)||this._cameraHandlerServerSide(r))}_cameraHandlerClientSide(e,t){const r=nT(this._view.spatialReference);if(r&&!gy(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const i=e.position;return this._referencePosWGS84Comparable==null&&(this._referencePosWGS84Comparable=C()),r?Zhe(i,this._referencePosWGS84Comparable):se(this._referencePosWGS84Comparable,i.longitude??0,i.latitude??0,i.z??0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,t)||this._updateLighting(t),!0}_cameraHandlerServerSide(e){const t=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(t))&&this._requestReferencePositionUpdate(t,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(t.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,t=Fx.Immediate){const r=this._view;e=e||(r.environment.lighting.type==="virtual"?null:r.environment.lighting.date);const i=this._referencePosWGS84Comparable,s=i!=null?QUe:e8e,n=this.weatherVisible?r.environment.weather.type:"disabled";i!=null?GUe(e,i,r.state.viewingMode,n,r.state.camera,s):r.environment.lighting.type==="virtual"&&Yfe(r.state.camera,r.state.viewingMode,s.direct.directionToLightSource);const o=this._mainLight,a=s.direct;te(o.intensity,a.color,a.intensity*Math.PI),re(o.direction,a.directionToLightSource),o.specularStrength=s.specularStrength,o.environmentStrength=s.environmentStrength;const l=this._ambientLight;te(l.intensity,s.ambient.color,s.ambient.intensity);const c=this._moonLight;Lr(c.intensity,r8e,i8e,s.globalFactor);const u=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));te(c.intensity,c.intensity,u),re(c.direction,a.directionToLightSource),this._renderer.updateLightSources([o,l,c],s.noonFactor,s.globalFactor,t),this._updateRenderParameters()}_autoUpdateTimezone(e,t=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const r=t8e;r.setTime((t||this._view.environment.lighting.date).getTime());const i=OJ(e,GJ);if(i==null)return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===i.hours&&s.minutes===i.minutes&&s.seconds===i.seconds)return!1}else s=i;const n=r.getUTCHours()-(i.hours-s.hours),o=r.getUTCMinutes()-(i.minutes-s.minutes),a=r.getUTCSeconds()-(i.seconds-s.seconds);return r.setUTCHours(n),r.setUTCMinutes(o),r.setUTCSeconds(a),!t&&this._view.environment.lighting.autoUpdate(r,i)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const t=this._referencePosWGS84Comparable==null||HUe(this._referencePosWGS84Comparable[2],this._view.state.viewingMode),r=this._view.environment.background,i=r instanceof Npe?{type:"color",color:MG(ot.toUnitRGBA(r.color))}:{type:"color",color:At(0,0,0,1)};e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&t,background:i,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,t=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!t,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const r=this._referencePosUpdateQuery=rA(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===r){const s=()=>this._referencePosUpdateQuery!==r;return this._doReferencePositionUpdateQuery(s)}}).catch(s=>{s.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===r&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),i=this._referencePosUpdateTimer=rA(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===i&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const t=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(t[0])&&!isNaN(t[1])){const r=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=t[0],this._referencePosWGS84Comparable[1]=t[1],this._referencePosWGS84Comparable[2]=r):this._referencePosWGS84Comparable=[t[0],t[1],r],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let t=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(t*=this._view.mapCoordsHelper.unitInMeters),t>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(t){e._referencePointUpdateInterval=t},set referencePointUpdateDistThreshold(t){e._referencePointUpdateDistThreshold=t},set referencePosUpdateTimer(t){e._referencePosUpdateTimer=t},set referencePointUpdateDelay(t){e._referencePointUpdateDelay=t},set disableWeather(t){e._disableWeather=t}}}};h([f({type:Boolean,readOnly:!0})],Ph.prototype,"updating",null),h([f()],Ph.prototype,"disableQueries",void 0),h([f()],Ph.prototype,"_disableWeather",void 0),h([f()],Ph.prototype,"weatherEnabled",null),h([f()],Ph.prototype,"weatherVisible",null),h([f()],Ph.prototype,"referencePositionWGS84Comparable",null),h([f()],Ph.prototype,"_renderer",void 0),h([f()],Ph.prototype,"_referencePosWGS84Comparable",void 0),Ph=h([F("esri.views.3d.environment.SceneViewEnvironmentManager")],Ph);const QUe=new Jfe,e8e=new Jfe,t8e=new Date,GJ={hours:0,minutes:0,seconds:0},r8e=Ce(.22,.22,.33),i8e=Ce(.22,.22,.22);var wi;(function(e){e[e.NONE=0]="NONE",e[e.TILT=1]="TILT",e[e.ALTITUDE=2]="ALTITUDE",e[e.DISTANCE=4]="DISTANCE",e[e.COLLISION=8]="COLLISION",e[e.ALL=15]="ALL",e[e.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(wi||(wi={}));var Ut;(function(e){e[e.NONE=0]="NONE",e[e.ZOOM=1]="ZOOM",e[e.TUMBLE=2]="TUMBLE",e[e.LOOK_AROUND=3]="LOOK_AROUND",e[e.PAN=4]="PAN",e[e.ASCEND=5]="ASCEND"})(Ut||(Ut={}));var Un;(function(e){e[e.TUMBLE=0]="TUMBLE",e[e.LOOK_AROUND=1]="LOOK_AROUND"})(Un||(Un={}));function BA(e,t){return(e&t)!=0}function TL(e,t,r,i,s,n){e!==0&&(r?(n.min=Math.min(n.min,t),n.max=Math.max(n.max,t)):i!=null?(n.min-=Math.max(0,(t-n.min)*(1-i)),n.max+=Math.max(0,(t-n.max)*(1-i))):s&&(n.min-=Math.max(0,t-n.min-s),n.max+=Math.max(0,t-n.max-s)))}const Ey={selection:wi.NONE,interactionType:Ut.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Un.TUMBLE};function Qfe(e,t,r,i){return t=t||e.viewForward,re(i,t),te(i,i,Math.sign(de(t,r))),i}function s8e(e,t,r,i){return c8e(e,t,r,a8e(i,t,r,!0))}function n8e(e,t,r,i){const s=de(r,ce(e,i,t));return oe(e,t,te(e,r,s))}const o8e={dir:C(),len:0,clip:Ne()};function a8e(e,t,r,i){const s=o8e;return e?(r&&i&&(s.len=ni(t,r)),re(s.dir,e)):i?(s.len=ni(t,r),ce(s.dir,r,t),te(s.dir,s.dir,1/s.len)):(ce(s.dir,r,t),pe(s.dir,s.dir)),s}function l8e(e,t,r){const i=de(e,r.dir),s=-ri(e,t);if(s<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return s>0;if((s<0||i<0)&&!(s<0&&i<0))return!0;const n=s/i;return i>0?n<r.clip[1]&&(r.clip[1]=n):n>r.clip[0]&&(r.clip[0]=n),r.clip[0]<=r.clip[1]}function c8e(e,t,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(let s=0;s<e.length;s++)if(!l8e(e[s],t,i))return!1;return!0}function u8e(e,t,r=Ey){const i=$j(e,t,r);if(i===0)return!1;const s=e.renderCoordsHelper,n=s.getAltitude(t.eye)+i,o=Qfe(t,r.interactionDirection,p8e(e,t,Math.sign(i),y8e),g8e),a=re(_8e,t.viewForward),l=s.intersectInfiniteManifold(Fc(t.eye,o),n,KF);return t.eye=l??s.setAltitude(KF,n,t.eye),t.center=n8e(KF,t.eye,a,t.center),!0}function $j(e,t,r=Ey){if(!h8e(e,r)||!e.state.constraints.altitude)return 0;const i=f8e(e.state.constraints.altitude,m8e);d8e(e,r,i);const s=e.renderCoordsHelper.getAltitude(t.eye),n=fe(s,i.min,i.max)-s;return Math.abs(n)<=1e-6?0:n}function h8e(e,t){const r=e.state.constraints.altitude;return!(!e.state.isGlobal||!r)&&(t.interactionType!==Ut.TUMBLE||!BA(t.selection,wi.TILT))}function d8e(e,t,r){const i=t.interactionType;if(i===Ut.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=t;if(!o)return;const l=i===Ut.TUMBLE||i===Ut.ZOOM,c=$j(e,o),u=c===0?0:e.renderCoordsHelper.getAltitude(o.eye);r.min=s,r.max=n,TL(c,u,l,a,.05*u,r)}function p8e(e,t,r,i){return e.renderCoordsHelper.worldUpAtPosition(t.eye,i),te(i,i,r),i}function f8e(e,t){return t.min=e.min,t.max=e.max,t}const m8e={min:0,max:0},g8e=C(),y8e=C(),_8e=C(),KF=C();function Lj(e,t,r=Ey){if(!e.state.isLocal)return 0;const i=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||i===1/0)return 0;yR.min=0,yR.max=i,b8e(e,r,yR);const s=Dj(e,t),n=yR.max-s;return n>=-1e-6?0:n}function v8e(e,t,r=Ey){const i=Lj(e,t,r);if(i===0)return!1;const s=e.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;const n=Dj(e,t)+i,o=re(x8e,t.eye),a=Qfe(t,r.interactionDirection,w8e(t,s.renderLocation,E8e),S8e);if(!Dy(Ide(s.renderLocation,n),Fc(t.eye,a),_R))return!1;t.eye=_R;const l=ce(T8e,t.eye,o);t.center=oe(_R,t.center,l);const c=e.renderCoordsHelper.getAltitude(t.center),u=e.renderCoordsHelper.intersectInfiniteManifold(t.ray,c,_R);return u!=null&&(t.center=u),!0}function b8e(e,t,r){const i=t.interactionType;if(i===Ut.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=t;if(!o)return;const l=i===Ut.ZOOM||i===Ut.PAN,c=Lj(e,o),u=c===0?0:Dj(e,o);r.min=s,r.max=n,TL(c,u,l,a,.05*u,r)}function Dj(e,t){const r=e.pointsOfInterest.surfaceOrigin;return r.renderLocation?ni(t.eye,r.renderLocation):0}function w8e(e,t,r){return Hm(r,e.eye,t)}const yR={min:0,max:0},x8e=C(),T8e=C(),S8e=C(),E8e=C(),_R=C();var Ii,so;(function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL"})(Ii||(Ii={}));class C8e{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=so.ALL}}(function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"})(so||(so={}));class A8e{constructor(t,r,i){this.object=t,this.geometryId=r,this.triangleNr=i}}class O8e extends A8e{constructor(t,r,i,s){super(t,r,i),this.center=s!=null?Ts(s):null}}class eme{constructor(t){this.layerUid=t}}class qN extends eme{constructor(t,r){super(t),this.graphicUid=r}}function Cd(e){return e!=null&&e.dist!=null}function jJ(e){return(t,r,i)=>(Lr(HJ,t,r,i),!kG(e,HJ))}function XN(e){return Cd(e)&&e.intersector===Ii.OBJECT&&!!e.target}function ZN(e){return Cd(e)&&e.intersector===Ii.HUD&&!!e.target&&"center"in e.target&&e.target.center!=null}const HJ=C();class R8e{constructor(){this._transform=be(),this._transformInverse=new vR({value:this._transform},Fn,be),this._transformInverseTranspose=new vR(this._transformInverse,Bl,be),this._transformTranspose=new vR({value:this._transform},Bl,be),this._transformInverseRotation=new vR({value:this._transform},dfe,$i)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){Ss(this._transform,t)}multiplyTransform(t){Jr(this._transform,this._transform,t)}set(t){Ss(this._transform,t),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,r){this.setTransformMatrix(t),this.multiplyTransform(r),this._invalidateLazyTransforms()}}class vR{constructor(t,r,i){this._original=t,this._update=r,this._dirty=!0,this._transform=i()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}}class P8e{constructor(t=0){this.offset=t,this.tmpVertex=C()}applyToVertex(t,r,i){const s=t+this.localOrigin[0],n=r+this.localOrigin[1],o=i+this.localOrigin[2],a=this.offset/Math.sqrt(s*s+n*n+o*o);return this.tmpVertex[0]=t+s*a,this.tmpVertex[1]=r+n*a,this.tmpVertex[2]=i+o*a,this.tmpVertex}applyToAabb(t){for(let n=0;n<3;++n)bg[n]=t[0+n]+this.localOrigin[n],bR[n]=t[3+n]+this.localOrigin[n],Q2[n]=bg[n];const r=this.applyToVertex(bg[0],bg[1],bg[2]);for(let n=0;n<3;++n)t[n]=r[n],t[n+3]=r[n];const i=n=>{const o=this.applyToVertex(n[0],n[1],n[2]);for(let a=0;a<3;++a)t[a]=Math.min(t[a],o[a]),t[a+3]=Math.max(t[a+3],o[a])};for(let n=1;n<8;++n){for(let o=0;o<3;++o)Q2[o]=(n&1<<o)==0?bg[o]:bR[o];i(Q2)}let s=0;for(let n=0;n<3;++n)bg[n]*bR[n]<0&&(s|=1<<n);if(s!==0&&s!==7){for(let n=0;n<8;++n)if((s&n)==0){for(let o=0;o<3;++o)Q2[o]=(s&1<<o)!=0?0:(n&1<<o)!=0?bg[o]:bR[o];i(Q2)}}for(let n=0;n<3;++n)t[n]-=this.localOrigin[n],t[n+3]-=this.localOrigin[n];return t}}const bg=C(),bR=C(),Q2=C();class M8e{constructor(t=0){this.componentLocalOriginLength=0,this._tmpVertex=C(),this._mbs=ls(),this._obb={center:C(),halfSize:Yi(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(t)}_resetOffset(t){this._offset=t,this._totalOffset=t}set offset(t){this._resetOffset(t)}get offset(){return this._offset}set componentOffset(t){this._totalOffset=this._offset+t}set localOrigin(t){this.componentLocalOriginLength=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}applyToVertex(t,r,i){const s=t,n=r,o=i+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(s*s+n*n+o*o);return this._tmpVertex[0]=t+s*a,this._tmpVertex[1]=r+n*a,this._tmpVertex[2]=i+o*a,this._tmpVertex}applyToAabb(t){const r=t[0],i=t[1],s=t[2]+this.componentLocalOriginLength,n=t[3],o=t[4],a=t[5]+this.componentLocalOriginLength,l=r*n<0?0:Math.min(Math.abs(r),Math.abs(n)),c=i*o<0?0:Math.min(Math.abs(i),Math.abs(o)),u=s*a<0?0:Math.min(Math.abs(s),Math.abs(a)),d=Math.sqrt(l*l+c*c+u*u);if(d<this._totalOffset)return t[0]-=r<0?this._totalOffset:0,t[1]-=i<0?this._totalOffset:0,t[2]-=s<0?this._totalOffset:0,t[3]+=n>0?this._totalOffset:0,t[4]+=o>0?this._totalOffset:0,t[5]+=a>0?this._totalOffset:0,t;const p=Math.max(Math.abs(r),Math.abs(n)),g=Math.max(Math.abs(i),Math.abs(o)),y=Math.max(Math.abs(s),Math.abs(a)),_=Math.sqrt(p*p+g*g+y*y),v=this._totalOffset/_,w=this._totalOffset/d;return t[0]+=r*(r>0?v:w),t[1]+=i*(i>0?v:w),t[2]+=s*(s>0?v:w),t[3]+=n*(n<0?v:w),t[4]+=o*(o<0?v:w),t[5]+=a*(a<0?v:w),t}applyToMbs(t){const r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),i=this._totalOffset/r;return this._mbs[0]=t[0]+t[0]*i,this._mbs[1]=t[1]+t[1]*i,this._mbs[2]=t[2]+t[2]*i,this._mbs[3]=t[3]+t[3]*this._totalOffset/r,this._mbs}applyToObb(t){const r=t.center,i=this._totalOffset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);this._obb.center[0]=r[0]+r[0]*i,this._obb.center[1]=r[1]+r[1]*i,this._obb.center[2]=r[2]+r[2]*i,Uu(this._obb.halfSize,t.halfSize,t.quaternion),oe(this._obb.halfSize,this._obb.halfSize,t.center);const s=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*s,this._obb.halfSize[1]+=this._obb.halfSize[1]*s,this._obb.halfSize[2]+=this._obb.halfSize[2]*s,ce(this._obb.halfSize,this._obb.halfSize,t.center),Sy(ZJ,t.quaternion),Uu(this._obb.halfSize,this._obb.halfSize,ZJ),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=t.quaternion,this._obb}}class I8e{constructor(t=0){this.offset=t,this.sphere=ls(),this.tmpVertex=C()}applyToVertex(t,r,i){const s=this.objectTransform.transform;let n=s[0]*t+s[4]*r+s[8]*i+s[12],o=s[1]*t+s[5]*r+s[9]*i+s[13],a=s[2]*t+s[6]*r+s[10]*i+s[14];const l=this.offset/Math.sqrt(n*n+o*o+a*a);n+=n*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*n+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*n+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(t,r){const i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*i,t[1]+=t[1]*i,t[2]+=t[2]*i;const s=this.offset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);r[0]+=r[0]*s,r[1]+=r[1]*s,r[2]+=r[2]*s}applyToAabb(t){const r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r;const i=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*i,t[4]+=t[4]*i,t[5]+=t[5]*i,t}applyToBoundingSphere(t){const r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),i=this.offset/r;return this.sphere[0]=t[0]+t[0]*i,this.sphere[1]=t[1]+t[1]*i,this.sphere[2]=t[2]+t[2]*i,this.sphere[3]=t[3]+t[3]*this.offset/r,this.sphere}}const WJ=new I8e;function Dz(e){return e!=null?(WJ.offset=e,WJ):null}const qJ=new M8e;function $8e(e){return e!=null?(qJ.offset=e,qJ):null}const XJ=new P8e;function L8e(e){return e!=null?(XJ.offset=e,XJ):null}const R0="terrain",ZJ=rh(),FT=1e-5;class D8e{constructor(t){this.options=new C8e,this._results=new N8e,this.transform=new R8e,this.tolerance=FT,this.verticalOffset=null,this._ray=Dn(),this._rayEnd=C(),this._rayBeginTransformed=C(),this._rayEndTransformed=C(),this.viewingMode=t??Ie.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(t,r,i){this.resetWithRay(I$e(t,r,this._ray),i)}resetWithRay(t,r){this.camera=r,t!==this._ray&&rL(t,this._ray),this.options.verticalOffset!==0?this.viewingMode===Ie.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,oe(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(t=null,r,i,s,n){this.point=r,this.filterPredicate=s,this.tolerance=i??FT;const o=Dz(this.verticalOffset);if(t&&t.length>0){const a=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of t){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();c!=null?(o!=null?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(u=>a(u))}}this.sortResults()}intersectObject(t){const r=t.geometries;if(!r)return;const i=t.shaderTransformation,s=Dz(this.verticalOffset);for(const n of r){if(!n.visible)continue;const{material:o,id:a}=n;this.transform.setAndInvalidateLazyTransforms(i,n.shaderTransformation),Ue(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Ue(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;s!=null&&(s.objectTransform=this.transform),o.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,u,d,p,g,y)=>{if(c>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const _=p?this._results.hud:this._results,v=p?w=>{const T=new O8e(t,a,d,y);w.set(Ii.HUD,T,c,u,Ks,g)}:w=>w.set(Ii.OBJECT,{object:t,geometryId:a,triangleNr:d},c,u,l,g);if((_.min.drapedLayerOrder==null||g>=_.min.drapedLayerOrder)&&(_.min.dist==null||c<_.min.dist)&&v(_.min),this.options.store!==so.MIN&&(_.max.drapedLayerOrder==null||g<_.max.drapedLayerOrder)&&(_.max.dist==null||c>_.max.dist)&&v(_.max),this.options.store===so.ALL)if(p){const w=new Nz(this._ray);v(w),this._results.hud.all.push(w)}else{const w=new Ux(this._ray);v(w),this._results.all.push(w)}}})}}sortResults(t=this._results.all){t.sort((r,i)=>r.dist!==i.dist?(r.dist??0)-(i.dist??0):r.drapedLayerOrder!==i.drapedLayerOrder?(r.drapedLayerOrder??Number.MAX_VALUE)-(i.drapedLayerOrder??Number.MAX_VALUE):(i.drapedLayerGraphicOrder??Number.MIN_VALUE)-(r.drapedLayerGraphicOrder??Number.MIN_VALUE))}}function eh(e){return new D8e(e)}class N8e{constructor(){this.min=new Ux(Dn()),this.max=new Ux(Dn()),this.hud={min:new Nz(Dn()),max:new Nz(Dn()),all:new Array},this.ground=new Ux(Dn()),this.all=[]}init(t){this.min.init(t),this.max.init(t),this.ground.init(t),this.all.length=0,this.hud.min.init(t),this.hud.max.init(t),this.hud.all.length=0}}class Ux{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(te(wR,this.ray.direction,this.dist),Se(wR)):null}getIntersectionPoint(t){return!!Cd(this)&&(te(wR,this.ray.direction,this.dist),oe(t,this.ray.origin,wR),!0)}getTransformedNormal(t){return re(eS,this.normal),eS[3]=0,xc(eS,eS,this.transformation),re(t,eS),pe(t,t)}constructor(t){this.intersector=Ii.OBJECT,this.normal=C(),this.transformation=be(),this._ray=Dn(),this.init(t)}init(t){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Ii.OBJECT,rL(t,this._ray)}set(t,r,i,s,n,o,a){this.intersector=t,this.dist=i,re(this.normal,s??CV),Ss(this.transformation,n??Ks),this.target=r,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(t){rL(t.ray,this._ray),this.intersector=t.intersector,this.dist=t.dist,this.target=t.target,this.drapedLayerOrder=t.drapedLayerOrder,this.drapedLayerGraphicOrder=t.drapedLayerGraphicOrder,re(this.normal,t.normal),Ss(this.transformation,t.transformation)}}class Nz extends Ux{constructor(){super(...arguments),this.intersector=Ii.HUD}}function Nj(e){return new Ux(e)}const wR=C(),eS=Ht();function tme(e,t,r,i){return e.renderCoordsHelper.fromRenderCoords(t.eye,SL,i)!=null&&Qce(r,SL)}function YN(e,t){return e.elevationProvider?e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground")??0:0}function ob(e,t,r,i){const s=e.state.camera.clone();t&&r&&i&&(s.eye=t,s.center=r,s.up=i),F8e(e,s.ray,wg)||re(wg,s.center);const n=e.state.constraints,o=n.minimumPoiDistance;if(gn(s.eye,wg)<o){const a=n.collision.enabled;re(Qy,s.viewForward),te(Qy,Qy,o),a?s.eye=ce(SL,wg,Qy):oe(wg,s.eye,Qy);const l=e.renderCoordsHelper,c=l.getAltitude(s.eye),u=n.collision.elevationMargin;a&&c<u&&(ce(Qy,wg,s.eye),s.eye=l.setAltitude(SL,u,s.eye),oe(wg,s.eye,Qy))}return s.center=wg,s}function YJ(e,t,r){if(!e.state.isGlobal||!e.stateManager.constraintsManager)return!1;const i=YN(e,t),s=e.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(t,r,e.renderDataExtent,i,k8e),o=n*n;return gn(t,r)>o}function F8e(e,t,r){let i=JJ[e.viewingMode];i||(i=eh(e.state.viewingMode),i.options.backfacesTerrain=!e.state.isGlobal,i.options.invisibleTerrain=!0,JJ[e.viewingMode]=i);const{isGlobal:s}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,i,r)||YJ(e,t.origin,r))||!(!e.renderCoordsHelper.intersectManifold(t,0,r)||YJ(e,t.origin,r))||!!s&&U8e(t,r,Mr(e.spatialReference).radius)}function U8e(e,t,r){const i=de(e.origin,e.origin)-r*r,s=i>0?Math.sqrt(i)/3:1;return te(t,e.direction,s/Se(e.direction)),oe(t,t,e.origin),!0}const JJ={},SL=C(),wg=C(),Qy=C(),k8e={near:0,far:0};function E2(e,t,r=Fu.EYE){const i=e.state.constraints;if(!i.collision.enabled)return!1;const s=YN(e,t.eye),n=e.renderCoordsHelper.getAltitude(t.eye),o=s+i.collision.elevationMargin;if(n>=o)return!1;const a=Se(t.eye);if(ce(xR,t.center,t.eye),t.eye=e.renderCoordsHelper.setAltitude(z8e,o,t.eye),r===Fu.EYE_AND_CENTER)t.center=oe(xR,t.eye,xR);else if(r===Fu.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;t.center=te(xR,t.center,l)}return!0}var Fu;(function(e){e[e.EYE=0]="EYE",e[e.EYE_AND_CENTER=1]="EYE_AND_CENTER",e[e.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(Fu||(Fu={}));const xR=C(),z8e=C();function Cy(e,t,r){e.worldUpAtPosition(t,KJ),ce(QF,r,t);const i=Se(QF);return i===0?0:_n(de(QF,KJ)/i)}const KJ=C(),QF=C();function rme(e,t,r=Ey,i=!0){tS.eyeCenterDistance=0,tS.requiresTwoSteps=!1;const s=Fj(e,t,r,void 0,tS);if(s===0)return!1;switch(Nc(TR,-s,t.viewRight),r.tiltMode){case Un.LOOK_AROUND:Ue(xg,t.viewForward,TR),te(xg,xg,tS.eyeCenterDistance),t.center=oe(P0,t.eye,xg);break;case Un.TUMBLE:ce(xg,t.center,t.eye),Ue(xg,xg,TR),t.eye=ce(P0,t.center,xg);break;default:r.tiltMode}return t.up=Ue(P0,t.up,TR),!tS.requiresTwoSteps||!i||rme(e,t,r,!1)}function Fj(e,t,r=Ey,i=Ey,s){if(!e.state.constraints.tilt)return 0;const n=t.distance,o=e.state.constraints.tilt(n,Y8e);return Z8e(e,r,o),i.interactionType===Ut.TUMBLE&&BA(i.selection,wi.ALTITUDE)&&ime(e,i.interactionStartCamera,o),r.tiltMode===Un.LOOK_AROUND||i.tiltMode===Un.LOOK_AROUND?V8e(e,t,o,s):B8e(e,t,o)}function B8e(e,t,r){const i=Cy(e.renderCoordsHelper,t.center,t.eye),s=i-fe(i,r.min,r.max);return VA(s)?s:0}function V8e(e,t,r,i){switch(i&&(i.requiresTwoSteps=!1),e.viewingMode){case"global":return j8e(e,t,r,i);case"local":return G8e(e,t,r,i)}}function G8e(e,t,r,i){const s=Cy(e.renderCoordsHelper,t.center,t.eye),n=fe(s,r.min,r.max),o=s-n;if(!VA(o))return 0;if(i){const a=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=e.renderCoordsHelper.getAltitude(t.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?i.eyeCenterDistance=l/c:i.eyeCenterDistance=t.distance}return o}function j8e(e,t,r,i){const s=H8e(e,t,J8e),n=fe(s.tiltAtCenter,r.min,r.max);if(!VA(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=W8e(s),a=q8e(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),i&&o<Math.PI/2&&(i.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=X8e(s,o)),i&&(i.eyeCenterDistance=Fz(s,o)),a}function H8e(e,t,r){const i=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=i+Mr(e.spatialReference).radius,n=e.renderCoordsHelper.intersectManifold(t.ray,i,P0);return r.eyeCenterDistance=t.distance,r.centerIsOnSurface=!1,n!=null?(r.eyeCenterDistance=ni(t.eye,n),r.tiltAtCenter=Cy(e.renderCoordsHelper,n,t.eye),r.centerIsOnSurface=!0):e.state.isLocal?r.tiltAtCenter=Cy(e.renderCoordsHelper,t.center,t.eye):(_2(EN(CN,s),t.ray,P0),r.eyeCenterDistance=ni(t.eye,P0),r.tiltAtCenter=_n(-de(t.viewForward,pe(P0,P0)))),r.radius=s,r.eyeRadius=Se(t.eye),r.constraints=e.state.constraints,r}function VA(e){return Math.abs(e)>1e-9}function W8e(e){const{constraints:t,eyeCenterDistance:r,tiltAtCenter:i}=e;let s=i,n=t.clampTilt(r,i);const o=Fz(e,n);if(t.clampTilt(o,i)===n)return n;let a=0;for(;a<10&&VA(n-s);){const l=(s+n)/2,c=Fz(e,l);VA(t.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function Fz(e,t){if(!e.centerIsOnSurface)return e.eyeCenterDistance;const r=Math.PI-fe(t,0,Math.PI),i=Hu(e.radius/e.eyeRadius*Math.sin(r)),s=Math.PI-r-i,n=Math.sin(s)/Math.sin(r);if(e.eyeRadius<e.radius&&n>1){const o=Math.PI-i,a=Math.PI-r-o;return Math.sin(a)/Math.sin(r)*e.eyeRadius}return n*e.eyeRadius}function q8e(e,t){const r=Hu(e.radius/e.eyeRadius*Math.sin(e.tiltAtCenter)),i=Hu(e.radius/e.eyeRadius*Math.sin(t));return e.eyeRadius>e.radius?r-i:i-r}function X8e(e,t){return e.tiltAtCenter-Math.PI/2-(t-Math.PI/2)}function Z8e(e,t,r){if(t.interactionType===Ut.NONE)return;const{interactionStartCamera:i,interactionFactor:s}=t;if(!i)return;const{min:n,max:o}=r,a=Fj(e,i,Ey,t),l=a===0?0:Cy(e.renderCoordsHelper,i.center,i.eye);r.min=n,r.max=o,t.interactionType===Ut.TUMBLE?(BA(t.selection,wi.ALTITUDE)&&ime(e,i,r),TL(a,l,!0,s,QJ,r)):TL(a,l,!1,s,QJ,r)}function ime(e,t,r){const i=e.state.constraints;if(e.state.isLocal||!i.altitude||!t)return;const s=Bo(t.center),n=Math.sqrt(s),o=t.distance,a=Mr(e.spatialReference).radius,l=i.altitude.min+a,c=i.altitude.max+a,u=(l*l-o*o-s)/(-2*n*o),d=(c*c-o*o-s)/(-2*n*o);r.min=Math.max(r.min,Math.min(Math.PI-_n(d),r.max)),r.max=Math.min(r.max,Math.PI-_n(u))}const xg=C(),TR=be(),P0=C(),QJ=Ot(5),Y8e={min:0,max:0},J8e={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},tS={eyeCenterDistance:0,requiresTwoSteps:!1};function K8e(e){return e}const JN=e=>e*e,Uj=e=>1-JN(1-e),Q8e=e=>e<.5?JN(2*e)/2:(Uj(2*(e-.5))+1)/2,kj=e=>e*e*e,sme=e=>1-kj(1-e),nme=e=>e<.5?kj(2*e)/2:(sme(2*(e-.5))+1)/2,zj=e=>e*e*e*e,ome=e=>1-zj(1-e),e9e=e=>e<.5?zj(2*e)/2:(ome(2*(e-.5))+1)/2,Bj=e=>e*e*e*e*e,ame=e=>1-Bj(1-e),t9e=e=>e<.5?Bj(2*e)/2:(ame(2*(e-.5))+1)/2,Vj=e=>1-Math.cos(e*Math.PI/2),lme=e=>1-Vj(1-e),r9e=e=>e<.5?Vj(2*e)/2:(lme(2*(e-.5))+1)/2,Gj=e=>2**(10*(e-1)),X3=e=>1-Gj(1-e),i9e=e=>e<.5?Gj(2*e)/2:(X3(2*(e-.5))+1)/2,jj=e=>-(Math.sqrt(1-e*e)-1),cme=e=>1-jj(1-e),s9e=e=>e<.5?jj(2*e)/2:(cme(2*(e-.5))+1)/2;function nh(e){const t=2*(e-Math.sqrt((e-1)*e)),r=t/2/e;return i=>i<r?e*i*i:t*i-t+1}function oh(e,t){return(r,i)=>r<t?t*e(r/t,i):1-e((1-r)/(1-t),i)*(1-t)}const n9e=oh(nh(1),1),o9e=oh(nh(1),0),ume=oh(nh(1),.5),a9e=oh(nh(2),1),l9e=oh(nh(2),0),c9e=oh(nh(2),.5),u9e=oh(nh(3),1),h9e=oh(nh(3),0),d9e=oh(nh(3),.5),p9e=oh(nh(4),1),f9e=oh(nh(4),0),m9e=oh(nh(4),.5),g9e={linear:K8e,"in-quad":JN,"out-quad":Uj,"in-out-quad":Q8e,"in-coast-quad":n9e,"out-coast-quad":o9e,"in-out-coast-quad":ume,"in-cubic":kj,"out-cubic":sme,"in-out-cubic":nme,"in-coast-cubic":a9e,"out-coast-cubic":l9e,"in-out-coast-cubic":c9e,"in-quart":zj,"out-quart":ome,"in-out-quart":e9e,"in-coast-quart":u9e,"out-coast-quart":h9e,"in-out-coast-quart":d9e,"in-quint":Bj,"out-quint":ame,"in-out-quint":t9e,"in-coast-quint":p9e,"out-coast-quint":f9e,"in-out-coast-quint":m9e,"in-sine":Vj,"out-sine":lme,"in-out-sine":r9e,"in-expo":Gj,"out-expo":X3,"in-out-expo":i9e,"in-circ":jj,"out-circ":cme,"in-out-circ":s9e};function bs(e,t,r=b9e,i=t){i!==t&&i.copyFrom(t),i.computeUp(e.state.viewingMode);let s=!1;for(let a=0;a<w9e;a++){let l=0;for(const c of v9e)if(BA(r.selection,c.type)){const u=Math.abs(c.error(e,i,r));c.apply(e,i,r)&&(s=!0,l+=u)}if(l===0)break}const n=BA(r.selection,wi.COLLISION),o=y9e(r.interactionType,e);return n&&E2(e,i,o)&&(s=!0),s&&i.computeUp(e.state.viewingMode),s}function y9e(e,t){switch(e){case Ut.PAN:return Fu.EYE_AND_CENTER;case Ut.ASCEND:return t.state.isGlobal?Fu.EYE_AND_CENTER_SCALE:Fu.EYE_AND_CENTER;default:return Fu.EYE}}function Jh(e){const t=Math.min(1,e/150);return nme(t)}function _9e(e,t,r){return Fj(e,t,r)*t.distance}const v9e=[{type:wi.TILT,error:_9e,apply:rme},{type:wi.ALTITUDE,error:$j,apply:u8e},{type:wi.DISTANCE,error:Lj,apply:v8e}],b9e={selection:wi.ALL,interactionType:Ut.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Un.TUMBLE},w9e=5,Xl=C(),il=C(),Tg=C(),Oo=C(),e_=C(),x9e=C(),Zl={upward:Ce(0,0,1),forward:Ce(0,1,0),sideway:Ce(1,0,0)},eK=$i();class tK{constructor(t=Ie.Global){this.viewingMode=t,this.center=C(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=Ts(Zl.forward)}pixelsPerPanAtZoom(t){return this.size/2/(this._zoomToPanScale*t)}zoomAtPixelsPerPan(t){return this.size/2/(this._zoomToPanScale*t)}pixelsPerRotateAtZoom(){const t=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/t}compareTo(t,r){if(r||(r={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===Ie.Global){const n=(Se(this.center)+Se(t.center))/2;r.pan=WM(this.center,t.center)*n}else r.pan=ni(this.center,t.center);let i=Math.abs(t.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const s=Math.abs(t.pitch-this.pitch);return r.rotate=Math.max(i,s),r.sourceZoom=this.distance,r.targetZoom=t.distance,r}interpolate(t,r,i){this.viewingMode===Ie.Global?Y$e(t.center,r.center,i.pan,this.center):Lr(this.center,t.center,r.center,i.pan),this.distance=isFinite(r.distance)?yt(t.distance,r.distance,i.zoom):t.distance,this.pitch=yt(t.pitch,r.pitch,i.rotate);let s=t.yaw;const n=r.yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this.yaw=yt(s,n,i.rotate)}copyFrom(t){re(this.center,t.center),this.pitch=t.pitch,this.yaw=t.yaw,this.distance=t.distance,re(this.lookAtDirection,t.lookAtDirection),this.size=t.size,this.copyFromCommon(t),this.viewingMode=t.viewingMode}copyFromRenderCamera(t){const r=this._lookAtOrientation(t.center,eK);re(this.center,t.center),ce(Oo,t.center,t.eye),Il(Oo,Oo,r),Il(e_,t.up,r),this.distance=Se(Oo),this.distance!==0&&(Oo[0]/=this.distance,Oo[1]/=this.distance,Oo[2]/=this.distance),this.pitch=this._eyeUpToPitch(Oo),this.yaw=this._eyeUpToYaw(Oo,e_),this.size=Math.sqrt(t.width*t.width+t.height*t.height),this.copyFromCommon(t)}copyFromCommon(t){this.fov=t.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(t){const r=this._lookAtOrientation(this.center,eK);Qu(r,r),this._axisAngleVec3(Zl.sideway,this.pitch-Math.PI/2,Zl.forward,Oo),this._axisAngleVec3(Zl.upward,this.yaw,Oo),this._axisAngleVec3(Zl.sideway,this.pitch-Math.PI/2,Zl.upward,e_),this._axisAngleVec3(Zl.upward,this.yaw,e_),te(Oo,Oo,this.distance),Il(Oo,Oo,r),Il(e_,e_,r),t.center=this.center,t.eye=ce(Oo,this.center,Oo),t.up=e_}_axisAngleVec3(t,r,i,s=i){const n=Math.cos(r),o=Math.sin(r);return te(Xl,i,n),rt(il,t,i),te(il,il,o),te(Tg,t,(1-n)*de(t,i)),oe(s,oe(s,Xl,il),Tg)}_lookAtOrientation(t,r=$i()){return this._upAtLookAt(t,Tg),rt(Xl,this.lookAtDirection,Tg),pe(Xl,Xl),Xl[0]===0&&Xl[1]===0&&Xl[2]===0&&re(Xl,Zl.sideway),rt(il,Tg,Xl),pe(il,il),r[0]=Xl[0],r[1]=il[0],r[2]=Tg[0],r[3]=Xl[1],r[4]=il[1],r[5]=Tg[1],r[6]=Xl[2],r[7]=il[2],r[8]=Tg[2],r}_upAtLookAt(t,r){return this.viewingMode===Ie.Local?re(r,Zl.upward):pe(r,t)}_eyeUpToPitch(t){return Math.PI-WM(Zl.upward,t)}_eyeUpToYaw(t,r){const i=x9e;return Math.abs(r[2])<.5?(re(i,r),t[2]>0&&te(i,i,-1)):re(i,t),rt(il,i,Zl.upward),pe(il,il),WM(Zl.sideway,il,Zl.upward)}}const EL={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};class Hj{constructor(t){this._createCamera=t,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:EL.desiredScreenFlow},this.source=t(),this.target=t()}clone(){const t=new Hj(this._createCamera);return t.copyFrom(this),t}copyFrom(t){this.update(t.source,t.target,t.settings)}update(t,r,i){this.source!==t&&this.source.copyFrom(t),this.target!==r&&this.target.copyFrom(r),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=i.desiredScreenFlow!=null?i.desiredScreenFlow:EL.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(t){const r=this.target.pixelsPerPanAtZoom(t);return this.halfWindowSize/r}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}}let T9e=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,t)=>e+t.time,0)}interpolateComponentsAt(e,t){e=Math.min(Math.max(e,0),1),e*=this.time;let r=0,i=0;const s=this.definition;for(let n=0;n<this.segments.length;n++){const o=this.segments[n],a=o.definition;if(e<=o.time||n===this.segments.length-1){if(t=this.segmentInterpolateComponentsAt(o,o.time===0?0:e/o.time,t),s.hasPan&&!isNaN(t.pan)&&isFinite(s.compared.pan)?t.pan=(r+a.compared.pan*t.pan)/s.compared.pan:t.pan=1,s.hasRotate&&!isNaN(t.rotate)&&isFinite(s.compared.rotate)?t.rotate=(i+a.compared.rotate*t.rotate)/s.compared.rotate:t.rotate=1,s.hasZoom&&!isNaN(t.zoom)&&isFinite(a.compared.targetZoom)){const l=t.zoom*(a.compared.targetZoom-a.compared.sourceZoom)+a.compared.sourceZoom,c=this.segments[0].definition.compared.sourceZoom,u=this.segments[this.segments.length-1].definition.compared.targetZoom;t.zoom=(l-c)/(u-c)}else t.zoom=1;return t}e-=o.time,r+=a.compared.pan,i+=a.compared.rotate}}segmentInterpolateComponentsAt(e,t,r){return e.interpolateComponentsAt(t,r)}};class e6{get time(){return this._time}constructor(t){t&&this.update(t)}update(t){t&&(this.definition?this.definition.copyFrom(t):this.definition=t.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const t=this.definition,r=t.compared,i=r.sourceZoom,s=r.targetZoom;this._zoomSign=i>s?1:-1,this._panPixelsAtSource=r.pan*t.source.pixelsPerPanAtZoom(i);const n=(t.source.pixelsPerRotateAtZoom(i)+t.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=r.rotate*n}_updatePixelFlow(){const t=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom,{hasZoom:i,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;i&&(s&&(o=(r/t-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(t/r)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(i&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(i&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(i&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,u=1+c;this._panPixelFlow=c/u*l,this._rotatePixelFlow=1/u*l}else s?this._panPixelFlow=l:i?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=n?this.rotateTime:i?this.zoomTime:s?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const t=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,r=t*this._panPixelsAtSource;return Math.log(r*(this._zoomPixelFlow/this._panPixelFlow)+1)/(t*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(t){if(t===0||t===1)return t;if(this.definition.hasZoom){const r=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom;return(r*(r/i)**-t-r)/(i-r)}return t}_interpolateComponentsPan(t){if(t===0||t===1)return t;if(this.definition.hasPan&&this.definition.hasZoom){const r=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(r*t*this._time)-1))/(r*Math.LN2)}return t}_interpolateComponentsRotate(t){return t}interpolateComponentsAt(t,r){t=Math.min(Math.max(t,0),1);const i=this._interpolateComponentsZoom(t),s=this._interpolateComponentsPan(t),n=this._interpolateComponentsRotate(t);return r?(r.zoom=i,r.pan=s,r.rotate=n):r={zoom:i,pan:s,rotate:n},r}}function S9e(e,t,r){const i=t-e.compared.sourceZoom,s=e.halfWindowPanAtZoom(i);return-e.halfWindowSize*(r.ascensionFactor*Math.LN2*e.compared.pan+s)*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2*s)}function E9e(e,t,r){const i=1/t,s=Math.log(e.compared.sourceZoom*i),n=1/e.desiredPixelFlow,o=1/Math.LN2,a=t-e.compared.sourceZoom,l=1/a,c=(r.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(a))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*i*n*o*l*c-e.halfWindowSize*s*n*o*l+e.halfWindowSize*s*n*o*c/(a*a)}function C9e(e,t,r){const i=t-e.compared.sourceZoom,s=1/i,n=1/t,o=Math.log(e.compared.sourceZoom*n),a=(r.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(i))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(i*i)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function A9e(e,t){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2)}function O9e(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function R9e(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function P9e(e,t,r){return-e.compared.pan*e.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t))}function M9e(e,t,r){return e.compared.pan*e.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t))}function I9e(e,t,r){return-2*e.compared.pan*e.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t*t))}function $9e(e,t,r){return e.halfWindowSize*(-e.halfWindowPanAtZoom(t)-r.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-t+e.compared.targetZoom))}function L9e(e,t,r){const i=Math.log(t/e.compared.targetZoom),s=1/e.desiredPixelFlow,n=1/Math.LN2,o=-t+e.compared.targetZoom,a=1/o,l=(-e.halfWindowPanAtZoom(t)-r.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*i*s*n*a+e.halfWindowSize*i*s*n*l/(o*o)+e.halfWindowSize*s*n*a*l/t}function D9e(e,t,r){const i=t-e.compared.targetZoom,s=1/i,n=1/t,o=Math.log(t/e.compared.targetZoom),a=(e.halfWindowPanAtZoom(t)+r.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(i*i)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function N9e(e,t){return e.halfWindowSize*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2)}function F9e(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function U9e(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function k9e(e){const t=Math.LN2*e.compared.pan,r=e.compared.sourceZoom-e.compared.targetZoom,i=e.halfWindowPanAtZoom(r),s=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*i);return e.compared.sourceZoom<=e.compared.targetZoom?s*(t-i):s*(t+i)}function z9e(e,t){let r=B9e(e,t);const i={ascensionFactor:t.ascensionFactor!=null?t.ascensionFactor:.5,descensionFactor:t.descensionFactor!=null?t.descensionFactor:.5},s=i.ascensionFactor===0,n=i.descensionFactor===0,o=s?A9e:S9e,a=s?O9e:E9e,l=s?R9e:C9e,c=n?N9e:$9e,u=n?F9e:L9e,d=n?U9e:D9e,p=S=>o(e,S,i)+P9e(e,S,i)+c(e,S,i),g=S=>a(e,S,i)+M9e(e,S,i)+u(e,S,i),y=S=>l(e,S,i)+I9e(e,S,i)+d(e,S,i);let _=p(r);const v=k9e(e);let w;const T=t.maximumIterations||20,x=t.maximumDistance!=null?t.maximumDistance:1/0;for(w=0;w<T;w++){const O=(g(r)+1e-6)/y(r);if(isNaN(O)||r>=x&&O<0){if(!isFinite(x))return null;r=x,_=p(r);break}if(r-=O,r<e.compared.sourceZoom||r<e.compared.targetZoom)return null;const A=p(r);if(Math.abs(A-_)/_<=.005)break;_=A}return _>v*(1-.3)||r<e.compared.sourceZoom||r<e.compared.targetZoom?null:r}function B9e(e,t){const r=Math.max(e.compared.sourceZoom,e.compared.targetZoom),i=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return i<r?t.maximumDistance!=null?r+(t.maximumDistance-r)/2:1.5*r:t.maximumDistance?Math.min(t.maximumDistance,i):i}class V9e extends T9e{constructor(t,r){super(),this._preallocSegments=[new e6,new e6,new e6],this._ascensionSegment=null,this._descensionSegment=null,this.update(t,r)}update(t,r){if(!t)return;this.definition?this.definition.copyFrom(t):this.definition=t.clone();let i=null;r&&r.apex&&(i=z9e(t,r.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,i==null?this._updateWithoutApex():this._updateWithApex(i,r?.apex)}segmentInterpolateComponentsAt(t,r,i){return i=t.interpolateComponentsAt(r,i),t===this._ascensionSegment?i.zoom=Uj(i.zoom):t===this._descensionSegment&&(i.zoom=JN(i.zoom)),i}_updateWithApex(t,r){const[i,s,n]=this._preallocSegments,o=r?.ascensionFactor??.5,a=Math.min(1-o,r?.ascensionFactor!=null&&r.descensionFactor!=null?r.descensionFactor:.5),l=1-o-a;i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.compared.targetZoom=t,i.definition.compared.pan=this.definition.compared.pan*o,i.definition.compared.rotate=this.definition.compared.rotate*o,i.update(),this._ascensionSegment=i,this.segments.push(i),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=t,s.definition.compared.targetZoom=t,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=t,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[t]=this._preallocSegments;t.update(this.definition),this.segments.push(t)}}const G9e={zoom:0,pan:0,rotate:0};let j9e=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=0,this.definition=new Hj(e),this.path=new V9e}update(e,t,r){this.definition.update(e,t,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(ioe(isFinite(this.path.time)?this.path.time:0),r),this._easing=r.easing??(this._time>=1e3?ume:X3)}cameraAt(e,t){t=t||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const r=this.path.interpolateComponentsAt(e,G9e);return t.interpolate(this.definition.source,this.definition.target,r),t}_normalizedEasing(e){const t=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(e,this._time)-t)/(r-t)}_applyTimeSettings(e,t){const r=t.speedFactor!=null?t.speedFactor:1;t.duration!=null?e=t.duration:t.speedFactor!=null&&(e=e/r);const i=t.minDuration!=null?t.minDuration:EL.minDuration/r,s=t.maxDuration!=null?t.maxDuration:EL.maxDuration/r;return Math.min(Math.max(i,e),s)}};const H9e=C();class W9e{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(t){this.currentTime=0,this._animation=new j9e(()=>new tK(t)),this._current=new tK(t)}update(t,r,i){const s=this._animation.definition.source,n=this._animation.definition.target,o=ce(H9e,r.center,t.center),a=Se(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),re(s.lookAtDirection,o),re(n.lookAtDirection,o),s.copyFromRenderCamera(t),n.copyFromRenderCamera(r),this._current.copyFrom(s),this._animation.update(s,n,i),this.currentTime=0,t.almostEquals(r)&&(this.currentTime=this._animation.time)}cameraAt(t,r){return this._animation.cameraAt(t,this._current),r=r||new lt,this._current.copyToRenderCamera(r),r}step(t,r){return this.finished||(this.currentTime=this.currentTime+ioe(t),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,r)}}var Ui;(function(e){e.Ready="ready",e.Rejected="rejected",e.Running="running",e.Stopped="stopped",e.Finished="finished"})(Ui||(Ui={}));let sm=class extends xe{constructor(e){super(e),this.state=Ui.Ready}get active(){return this.state===Ui.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Ui.Stopped,!0)}finishController(){this.state=Ui.Finished}get steppingFinished(){return!1}};h([f({constructOnly:!0})],sm.prototype,"view",void 0),h([f({readOnly:!0})],sm.prototype,"active",null),h([f()],sm.prototype,"state",void 0),h([f({readOnly:!0})],sm.prototype,"isInteractive",null),sm=h([F("esri.views.3d.state.controllers.CameraController")],sm);let GA=class extends sm{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(Cr()),this._asyncResult=null),this.state===Ui.Finished||this.state===Ui.Stopped?(LD(e),this.state===Ui.Finished?e.resolve():e.reject(Cr())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Ui.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){this.viewAnimation==null||this.state!==Ui.Ready&&this.state!==Ui.Running||(this.viewAnimation.state===xT.State.FINISHED?this.finish():this.viewAnimation.state===xT.State.STOPPED&&(this.state=Ui.Stopped))}onControllerEnd(){this.viewAnimation==null||this.viewAnimation.done||(this.state===Ui.Finished?this.viewAnimation.finish():this.state===Ui.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Ui.Finished?this._asyncResult.resolve():this._asyncResult.reject(Cr()))}finish(){this.finishController()}};GA=h([F("esri.views.3d.state.controllers.AnimationController")],GA);let fm=class extends GA{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new W9e(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new xT}get isInteractive(){return this.mode==="interaction"}begin(e,t){this._hasTarget=!0;const r=this.animationSettings(t);SR.copyFrom(this.view.state.camera);const i=eh(this.view.state.viewingMode);this.intersectionHelper.intersectRay(SR.ray,i,rK)&&(SR.center=rK),this.animation.update(SR,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,t){this._hasTarget&&this.animation.step(e,t)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?g9e[e.easing]:e.easing}}};h([f({constructOnly:!0})],fm.prototype,"mode",void 0),h([f({readOnly:!0})],fm.prototype,"isInteractive",null),fm=h([F("esri.views.3d.state.controllers.PointToPointAnimationController")],fm);const SR=new lt,rK=C();function KN(e=X9e){return[e[0],e[1],e[2],e[3]]}function jA(e,t){return q9e(e[0],e[1],e[2],t,IG.get())}function q9e(e,t,r,i,s=KN()){return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s}function Wj(e,t,r){return rt(r,e,t),pe(r,r),r[3]=SN(e,t),r}const X9e=[0,0,1,0];function hme(e,t,r){return Z9e(e,e.screenToRender(t,Le.get()),r)}function Z9e(e,t,r){const i=en(Le.get(),t);if(i[2]=0,!e.unprojectFromRenderScreen(i,r.origin))return null;const s=en(Le.get(),t);s[2]=1;const n=e.unprojectFromRenderScreen(s,Le.get());return n==null?null:(ce(r.direction,n,r.origin),r)}function C2(e,t,r){return qj(e,e.screenToRender(t,Le.get()),r)}function qj(e,t,r){re(r.origin,e.eye);const i=se(Le.get(),t[0],t[1],1),s=e.unprojectFromRenderScreen(i,Le.get());return s==null?null:(ce(r.direction,s,r.origin),r)}function Xj(e,t,r,i){const s=C2(t,r,Y9e);return Dy(e,s,i)}const Y9e=Dn();var UT;(function(e){e[e.Ellipsoid=0]="Ellipsoid",e[e.Silhouette=1]="Silhouette"})(UT||(UT={}));const dme=30,CL=[1,3e8],QN=80,pme=8,fme=200,mme=1508e5,gme=5,yme=50,J9e=5,K9e=10,t6=90,ab={exclude:new Set([R0])};function jv(e,t,r){return r[0]=t[0]/(e.fullWidth/e.pixelRatio),r[1]=t[1]/(e.fullHeight/e.pixelRatio),r}function Uz(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;return e}function Ay(e,t,r){const i=Nc($G.get(),r[3],r);i==null||Lhe(i,Ks)||(ce(zr,e.eye,t),Ue(zr,zr,i),e.eye=oe(zr,zr,t),ce(zr,e.center,t),Ue(zr,zr,i),e.center=oe(zr,zr,t),e.up=Ue(zr,e.up,i))}function Q9e(e,t,r,i){return ib(e,hme(t,r,Jj),i)}function kz(e,t,r,i){return ib(e,C2(t,r,Jj),i)}function Zj(e,t,r,i){const s=Le.get();let n=1-r;ce(s,t,e.eye);const o=Se(s);let a=o*(1-n);n>=0&&a<i&&(a=i,n=-(a-o)/o),Math.abs(o-a)<1e-6||(te(s,s,n),e.eye=oe(zr,e.eye,s),e.center=Lr(zr,e.center,t,n))}function _me(e,t,r){t.getScreenCenter(iK),Xj(e,t,iK,zr)&&(t.center=zr);const i=t.distance,s=i*r;if(Math.abs(i-s)<1e-6)return;const n=te(Le.get(),t.viewForward,s);t.eye=ce(zr,t.center,n)}const iK=zi();function r6(e,t){se(t,0,0,0);for(const r of e)oe(t,t,r);te(t,t,1/e.length)}function hI(e,t,r,i){return Math.sin(e/Se(t))*(r+i.radius)}function sK(e,t,r,i){return hI(Math.PI/2,t,r,i)+(e-Math.PI/2)}var Nn;(function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"})(Nn||(Nn={}));const nK={Elevation:3e4,Angle:Ot(16)},ER={Pole:.95,Angle:Ot(18),Tilt:45},vme=Ot(80);function bme(e,t,r,i,s,n){const o=C(),a=ls();let l=!0,c=!0;return e.intersectScreen(r,o,n)?a[3]=Se(o):(c=!1,t.aboveGround&&s!==UT.Ellipsoid?a[3]=Math.max(Se(t.center),.9*i.radius):a[3]=Se(t.eye)-t.relativeElevation,s===UT.Silhouette?HA(a,t,r,o):l=Xj(a,t,r,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function e4(e,t,r){return Se(e.eye)-r.radius>nK.Elevation?Nn.Horizontal:(C2(e,t,pK),-Math.sign(e.relativeElevation)*(.5*Math.PI+SN(e.eye,pK.direction))<nK.Angle?Nn.Vertical:Nn.Horizontal)}function wme(e,t,r){ce(i6,r,t),e.eye=ce(zr,e.eye,i6),e.center=ce(zr,e.center,i6)}const i6=C();function HA(e,t,r,i){const s=C2(t,r,Jj);return s!=null&&(_2(e,s,CR),Dy(e,s,i)?!(gn(CR,s.origin)<gn(i,s.origin))||(re(i,CR),!1):(ce(Ab,t.eye,t.center),pe(Ab,Ab),kde(Ab,-de(pe(Ab,Ab),CR),oK),ib(oK,s,i),!1))}const CR=C(),Ab=C(),oK=Sr();function xme(e,t,r,i,s,n){let o=0;if(rt(RL,e,t),ce(PR,e,t),Se(e)<=s||!i.aboveGround){rt(r,PR,i.eye);const a=de(e,t)/(Se(e)*Se(t));if(a<.9999)o=_n(a);else{const c=Se(rt(C(),e,t))/(Se(e)*Se(t));o=Hu(c)}const l=Math.cos(fe(dy.normalize(Ot(n)),0,vme));o=-o-Math.max(0,Se(t)-s)/(l*s)}else ce(aK,i.eye,i.center),rt(r,PR,aK),o=-Se(PR)/s;return pe(r,r),te(r,r,Se(RL)),o}const aK=C();function lK(e,t,r,i){let s,n;const o=Math.cos(fe(dy.normalize(Ot(i)),0,vme));return s=t>r?-(t-r)/(o*r):t<-r?Math.PI-(t+r)/(o*r):_n(t/r),n=e>r?-(e-r)/(o*r):e<-r?Math.PI-(e+r)/(o*r):_n(e/r),(n-s)*r}function eke(e,t,r,i,s,n,o,a,l,c){const u=lK(e[2],t[2],n[3],a),d=l?lK(e[0],t[0],n[3],180):t[0]-e[0],p=Math.sin(o)*d-Math.cos(o)*u,g=Math.cos(o)*d+Math.sin(o)*u;pe(zr,s);const y=l?p/Math.sqrt(Math.abs(n[3]**2-de(r,zr)**2)):p/n[3],_=g/Math.sqrt(Math.abs(n[3]**2-de(r,i)**2));Qt(c,y,_)}function Tme(e,t,r,i,s,n,o,a,l,c){rt(RL,e,t),Wk(n.up,n.eye,AR,OR,RR),Wk([0,0,1],n.eye,bm,ny,Ame),re(r,ny),re(i,bm),pe(r,r),te(r,r,Se(RL)),kZ(e,pe(OR,OR),pe(RR,RR),pe(AR,AR),cK),kZ(t,OR,RR,AR,uK),eke(cK,uK,e,bm,ny,o,a,l,c,s)}function tke(e,t,r,i,s,n,o){Nc(AL,s,i),Nc(OL,o,n),Jr(hx,AL,OL),ce(t,e,r),Ue(t,t,hx),oe(t,t,r)}function Sme(e,t,r,i,s,n){Nc(AL,i,r),Nc(OL,n,s),Jr(hx,AL,OL),ce(zr,e.eye,t),Ue(zr,zr,hx),e.eye=oe(zr,zr,t),ce(zr,e.center,t),Ue(zr,zr,hx),e.center=oe(zr,zr,t),ce(zr,e.up,t),Ue(zr,zr,hx),e.up=oe(zr,zr,t)}function Yj(e,t,r,i,s,n){return(Math.abs(i)>Math.PI-ER.Angle||Math.abs(i)<ER.Angle)&&(Math.abs(e[2])<r*ER.Pole||Math.abs(t)>r)&&n.aboveGround&&s<ER.Tilt}function Eme(e,t,r,i,s,n){if(n)Wj(r,i,hK),Ay(t,e,hK);else{const o=xme(r,i,dK,t,e[3],s);Ay(t,e,jA(dK,o))}}function Cme(e,t,r,i,s,n,o){const a=o?20:1,l=1e-12;let c,u;re(t_,i),MR.copyFrom(t);for(let d=0;d<a&&gn(r,t_)>l&&(c=gn(r,t_),Tme(r,t_,ny,bm,rS,MR,e,s,n,o),Sme(MR,e,bm,rS[1],ny,rS[0]),tke(t_,t_,e,bm,rS[1],ny,rS[0]),u=gn(r,t_),u<c||d===0);d++)t.copyFrom(MR)}function rke(e,t,r,i,s,n,o){Yj(r,de(t.up,r),e[3],-dy.normalize(Ot(s)),n,t)?Cme(e,t,r,i,-dy.normalize(Ot(s)),n,o):Eme(e,t,r,i,n,o)}function ike(e,t,r,i,s,n){const{eye:o}=e;Wk([0,0,1],o,bm,ny,Ame);const a=t.translation[0]*r.pan,l=s.mode==="zoom"?0:t.translation[1]*r.pan,c=Math.max(Math.sqrt(Math.abs(1-de(e.center,bm)**2/Se(e.center)**2)),.5),u=(Math.sin(n)*l+Math.cos(n)*a)/c,d=-Math.cos(n)*l+Math.sin(n)*a;switch($l(i.pan.matrix,i.pan.matrix,u,bm),i.pan.enabled=!0,s.mode){case"pan":$l(i.pan.matrix,i.pan.matrix,d,ny),i.pan.enabled=!0;break;case"zoom":i.zoom=-t.translation[1]*r.zoom}}function ske(e,t,r,i,s){const{eye:n,viewRight:o}=e,a=rt(Le.get(),o,n),l=t.translation[0]*r.pan;switch(l!==0&&($l(i.pan.matrix,i.pan.matrix,-l,a),i.pan.enabled=!0),s.mode){case"pan":{const c=t.translation[1]*r.pan;c!==0&&($l(i.pan.matrix,i.pan.matrix,c,o),i.pan.enabled=!0);break}case"zoom":i.zoom=-t.translation[1]*r.zoom}}function nke(e,t,r,i,s,n,o,a,l){Yj(e.center,de(e.up,e.center),Se(e.center),-dy.normalize(Ot(n)),o,t)?ike(t,r,i,a,l,-dy.normalize(Ot(s))):ske(t,r,i,a,l)}const bm=C(),ny=C(),Ame=C(),AR=C(),OR=C(),RR=C(),cK=C(),uK=C(),rS=Ne(),hK=KN(),AL=be(),OL=be(),hx=be(),t_=C(),zr=C(),PR=C(),MR=new lt,RL=C(),dK=C(),Jj={origin:C(),direction:C()},pK={origin:C(),direction:C()},fK=.6,s6=4,oke=60;let PL=class extends fm{constructor(){super(...arguments),this._zoomLocation=C(),this._tmpCamera=new lt,this._tmpViewDir=C(),this._tmpRayDir={origin:C(),direction:C()},this._targetOnSphere=C(),this._tmpCenter=C(),this._constraintOptions={selection:wi.ALL_EXCEPT_COLLISION,interactionType:Ut.ZOOM,interactionFactor:null,interactionStartCamera:new lt,interactionDirection:null,tiltMode:Un.TUMBLE},this._sphere=ls()}initialize(){this._intersector=eh(this.view.state.viewingMode)}zoomStep(e,t){if(!this.active)return;const r=this.view.state,{interactionStartCamera:i}=this._constraintOptions;i&&(this.animation.finished?i.copyFrom(r.camera):this.animation.cameraAt(1,i));let s=!1,n=!1;this.intersectionHelper.intersectScreen(t,this._zoomLocation,this.view.map.ground.opacity===0?ab:{})&&(s=e>0,n=!0),this._tmpCamera.copyFrom(r.camera),s?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:re(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,t,n),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:X3}}_updateCamera(e,t,r,i,s){const n=Mr(this.view.spatialReference),o=e4(e,i,n),a=Math.abs(this.view.camera.position.z);pe($R,e.eye),te($R,$R,-1),C2(e,i,this._tmpRayDir),pe(this._tmpRayDir.direction,this._tmpRayDir.direction);const l=fe(Math.min(pme,1/Math.abs(de($R,this._tmpRayDir.direction)))*a,fme,mme);if(o===Nn.Horizontal){let c=fK**t;this._sphere[3]=Se(r),ce(this._tmpViewDir,e.center,e.eye);const u=Math.min(Se(this._tmpViewDir),l);let d=u*c;if(c<=1&&d<s6&&(d=s6,c=d/u),Math.abs(u-d)<1e-6)return;const p=Se(e.center);if(this._sphere[3]!==p){const g=this._sphere[3]+c*(p-this._sphere[3]);e.center=te(IR,e.center,g/p)}te(this._tmpViewDir,this._tmpViewDir,-c),e.eye=oe(IR,e.center,this._tmpViewDir),bs(this.view,e,this._constraintOptions),gn(r,e.center)>1e-12&&Xj(this._sphere,e,i,this._targetOnSphere)&&rke(this._sphere,e,r,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let c=fK**Math.abs(t);const u=t>0?1:-1;ce(this._tmpViewDir,r,e.eye);const d=Se(this._tmpViewDir),p=this.view._stage.renderView.getMinimalDepthForArea(null,i[0],i[1],this.view.state.camera,oke);let g=p??l;g=s&&t>0?Math.min(g,d):g,te(this._tmpRayDir.direction,this._tmpRayDir.direction,g),oe(r,this._tmpRayDir.origin,this._tmpRayDir.direction);let y=g*c;const _=Math.max(s6,1.01*e.nearFar[0]);if(t>0&&y<_&&(y=_,c=y/g),Math.abs(g-y)<1e-6)return;te(this._tmpRayDir.direction,this._tmpRayDir.direction,u*(1-c)),e.eye=oe(IR,e.eye,this._tmpRayDir.direction),e.center=oe(IR,e.center,this._tmpRayDir.direction)}E2(this.view,e)}};PL=h([F("esri.views.3d.state.controllers.global.ZoomStepController")],PL);const IR=C(),$R=C(),ake=.6,lke=4,cke=60;let ML=class extends fm{constructor(){super(...arguments),this._zoomLocation=C(),this._tmpCamera=new lt,this._tmpRayDir=C(),this._tmpCenter=C(),this._constraintOptions={selection:wi.ALL,interactionType:Ut.ZOOM,interactionFactor:null,interactionStartCamera:new lt,interactionDirection:null,tiltMode:Un.TUMBLE}}zoomStep(e,t){if(!this.active)return;const r=this.view.state,{interactionStartCamera:i}=this._constraintOptions;i&&(this.animation.finished?i.copyFrom(r.camera):this.animation.cameraAt(1,i)),this._tmpCamera.copyFrom(r.camera);const s=eh(this.view.state.viewingMode);let n=!1;e>0?(n=this.intersectionHelper.intersectScreenFreePointFallback(t,this._zoomLocation,this.view.map.ground.opacity===0?ab:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:re(this._zoomLocation,this._tmpCamera.center);const o=ake**e;let a=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,t[0],t[1],this.view.state.camera,cke);ce(LR,this._tmpCamera.eye,this._zoomLocation),pe(LR,LR);const l=fe(Math.min(pme,1/Math.abs(de(uke,LR)))*Math.abs(this.view.camera.position.z),fme,mme);if(a=a??l,a){const c=C();ce(c,this._zoomLocation,this._tmpCamera.eye),(a<Se(c)||!n)&&(pe(c,c),oe(this._zoomLocation,this._tmpCamera.eye,te(c,c,a)))}this._updateCamera(this._tmpCamera,o,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:X3}}_updateCamera(e,t,r){ce(this._tmpRayDir,r,e.eye);const i=Se(this._tmpRayDir);let s=i*t;const n=t<=1,o=Math.max(lke,1.01*e.nearFar[0]);s!==0&&(n&&s<o&&(s=o,t=s/i),Math.abs(i-s)<1e-6||(te(this._tmpRayDir,this._tmpRayDir,t),e.eye=ce(mK,r,this._tmpRayDir),e.center=Lr(mK,e.center,r,1-t),bs(this.view,e,this._constraintOptions)))}};ML=h([F("esri.views.3d.state.controllers.local.ZoomStepController")],ML);const mK=C(),uke=Ce(0,0,1),LR=C();function hke(e,t){switch(t){case"primary":return e.pointerType==="touch"||e.button===0;case"secondary":return e.pointerType!=="touch"&&e.button===2;case"tertiary":return e.pointerType!=="touch"&&e.button===1}}function Kj(e,t){if(e.pointerType==="touch")return!1;switch(t){case"primary":return e.button===0;case"secondary":return e.button===2;case"tertiary":return e.button===1}}class dke extends ao{constructor(t,r){super(!0),this._view=t,this.registerIncoming("double-click",r,i=>this._handleDoubleClick(i))}_handleDoubleClick(t){const r=t.data;if(hke(r,"primary")){const i=this._view.state.isGlobal?new PL({view:this._view,mode:"animation"}):new ML({view:this._view,mode:"animation"});this._view.state.switchCameraController(i),i.zoomStep(Math.log(.5)/Math.log(.6),zi(r.x,r.y)),t.stopPropagation()}}}function pke(e,t,r){return e===Ie.Global?new mke(r):new fke(t,r)}class fke{constructor(t,r){this._elevationProvider=t,this._referenceEllipsoid=Mr(r),this._unitInMeters=Sa(r,this._referenceEllipsoid.metersPerDegree)}compute(t,r,i,s,n){n||(n={near:0,far:0});let o=t[2]*this._unitInMeters;const a=o,l=o-s,c=this._elevationProvider?.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const u={x:(i=i??new Pr({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},d=Math.max(u.x,u.y,u.z);ce(r_,r,t),Ob[0]=r_[0]>0?i.xmax:i.xmin,Ob[1]=r_[1]>0?i.ymax:i.ymin,Ob[2]=r_[2]>0?d/2:-d/2,ce(Ob,Ob,t),pe(r_,r_);const p=1.1*de(Ob,r_)*this._unitInMeters,g=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),y=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),_=y*_ke*this._unitInMeters,v=y*vke*this._unitInMeters,w=fe((o-v)/(_-v),0,1)**3,T=Math.min(yt(g,p,w),g)*Math.max(Math.log(Math.abs(l)),1);return Ome(Math.min(T,Math.max(34064e4,d))/this._unitInMeters,gke,this._unitInMeters,n)}}class mke{constructor(t){this._referenceEllipsoid=Mr(t)}compute(t,r,i,s,n){n||(n={near:0,far:0});const o=Se(t),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),c=Math.abs(a-s),u=Math.max(c,Math.abs(a)),d=Math.sqrt(u*(u+2*l)),p=o+this._referenceEllipsoid.radius;return Ome(1.2*yt(d,p,nj(u)),fe(2e4-(Math.log(u)-7.983)/9.011*19e3,1e3,2e4),1,n)}}function Ome(e,t,r,i){const s=yke/r;return e/t>s?(i.far=e,i.near=i.far/t):(i.near=s,i.far=i.near*t),i}const gke=2e4,yke=2,_ke=.001,vke=1e-4,Ob=C(),r_=C();let dI=class extends xe{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const t=this.view.state.camera;e.spatialReference!=null&&tme(this.view,t,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>E2(this.view,e,Fu.EYE_AND_CENTER))}};h([f({constructOnly:!0})],dI.prototype,"view",void 0),dI=h([F("esri.views.3d.state.ElevationCollisionConstraint")],dI);let IE=class extends xe{constructor(e){super(e),this.nearFarHeuristic=pke(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([le(()=>[this.view.constraints?.clipDistance?.near,this.view.constraints?.clipDistance?.far],()=>this._clipDistanceNearFarChanged()),le(()=>this.view.constraints?.clipDistance?.mode,()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),le(()=>this.view.renderDataExtent,()=>this._updateNearFar(),Vr),le(()=>[this.view.constraints?.altitude?.min,this.view.constraints?.altitude?.max],()=>this._updateAltitude(),Vr),le(()=>this.view.constraints?.tilt?.max,()=>this._updateTiltMax(),Vr),le(()=>this.view.constraints?.tilt?.mode,()=>this._updateTilt(),Vr),le(()=>this.view.state?.camera,()=>this._updateTiltAutoMax(),Vr),le(()=>[this.view.map?.ground?.navigationConstraint?.type,this.view.state?.constraints?.collision?.enabled],()=>this._updateCollision(),Vr)]),this.view.state.isLocal&&this.addHandles(le(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Rr)),this._updateNearFar(),this.view.state.viewingMode!==Ie.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new dI({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){const e=this.view.constraints?.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(t=>this._updateCameraNearFarManual(t,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const t=this.view.constraints&&this.view.constraints.clipDistance;(t?t.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,t):this._updateCameraNearFarAuto(e,t)}_updateCameraNearFarAuto(e,t){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,YN(this.view,e.eye),e),t&&t.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,t){t&&(e.near=t.near,e.far=t.far)}_updateCollision(){const e=this.view.map?.ground?.navigationConstraint?.type,t=!e||e==="stay-above",r=this.view.state.constraints.collision;if(t!==r.enabled){r.enabled=t,t&&this._reapplyConstraints(wi.COLLISION);const i=this.view.constraints&&this.view.constraints.tilt;i&&i.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Ie.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const t=this.view.state.constraints;t.tilt=t.createConstantMaxTilt(Ot(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const t=this.view.state.constraints;if(t.tilt){const r=t.tilt(this.view.state.camera.distance).max;e.autoUpdate(xa(r))}}_updateLocalSurfaceDistance(e){if(e==null)return;let t=Math.max(e.width,e.height);if(t<=0)return;e.zmax!=null&&e.zmin!=null&&(t=Math.max(t,e.zmax-e.zmin));const r=this.view.state,i=3*t/Math.atan(r.camera.fov/2);i!==r.constraints.distance&&(r.constraints.distance=i)}_reapplyConstraints(e=wi.ALL){this.view.state.updateCamera(t=>bs(this.view,t,{selection:e,interactionType:Ut.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:Un.TUMBLE}))}};h([f({constructOnly:!0})],IE.prototype,"view",void 0),h([f({readOnly:!0})],IE.prototype,"surfaceCollisionConstraint",void 0),IE=h([F("esri.views.3d.state.ConstraintsManager")],IE);class M0{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(t){this.renderCoordsHelper=t,this.frustum=OA(),this._points=Sfe(),this.lines=new Array(12),this._origin=C(),this._direction=C(),this._altitude=null;for(let r=0;r<12;r++)this.lines[r]={origin:null,direction:C(),endpoint:null}}update(t){Efe(t.viewMatrix,t.projectionMatrix,this.frustum,this._points),re(this._origin,t.eye),re(this._direction,t.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(t){for(let r=0;r<this._points.length;r++)re(this._points[r],t[r]);Cfe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(t){return Z0(this.frustum,t)}intersectsRay(t){return bFe(this.frustum,t)}intersectsLineSegment(t,r){return wFe(this.frustum,t,r)}intersectsPoint(t){return Afe(this.frustum,t)}_updateLines(){const t=this._points;for(let r=0;r<4;r++){const i=r+4;n6(this.lines[r],t[r],t[i]),n6(this.lines[r+4],t[r],r===3?t[0]:t[r+1]),n6(this.lines[r+8],t[i],r===3?t[4]:t[i+1])}}}function n6(e,t,r){e.origin=t,e.endpoint=r,Hm(e.direction,t,r)}M0.planePointIndices=xFe,M0.nearFarLineIndices=[[We.NEAR_BOTTOM_LEFT,We.FAR_BOTTOM_LEFT],[We.NEAR_BOTTOM_RIGHT,We.FAR_BOTTOM_RIGHT],[We.NEAR_TOP_RIGHT,We.FAR_TOP_RIGHT],[We.NEAR_TOP_LEFT,We.FAR_TOP_LEFT]];let TC=class extends sm{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Ui.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||tme(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),E2(this.view,e,Fu.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Ui.Stopped)})}};h([f({constructOnly:!0})],TC.prototype,"desiredCamera",null),TC=h([F("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],TC);const bke=C(),DR=C();function Qj(){return{direction:C(),up:C()}}function Rme(e,t,r,i,s){let n=pe(bke,e),o=de(n,i);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(de(t,i)),o<.99?(re(n,t),a&&te(n,n,-1)):n=null);let l=0;if(n){te(DR,i,de(i,n)),ce(n,n,DR);const u=de(n,s)/(Se(n)*Se(s));rt(DR,n,s),l=(de(DR,i)>0?1:-1)*xa(_n(u))}const c=xa(_n(-de(i,e)/Se(e)));return r?(r.heading=l,r.tilt=c,r):{heading:l,tilt:c}}const Pme=Ce(0,1,0),Mme=Ce(0,0,1),iS=be(),vf=C(),bf=C();function Ime(e,t,r,i=Qj()){const{direction:s,up:n}=i;return Ahe(iS,-Ot(t)),pT(iS,iS,Ot(r)),Ue(s,Mme,iS),te(s,s,-1),Ue(n,Pme,iS),i}function wke(e,t,r,i){return Rme(t,r,i,Mme,Pme)}function xke(e,t,r,i){const s=Ime(e,r,i),n=C();return te(n,s.direction,-t),oe(n,n,e),{up:s.up,eye:n,heading:r,tilt:i}}function Tke(e){return xa(e)}function Ske(e){return Ot(e)}function $me(e,t,r,i,s){const n=e.renderSpatialReference,o=e.map&&e.spatialReference||t.spatialReference;return no(t,vf,n),no(t,bf,n),vf[0]-=r/2,bf[0]+=r/2,vf[1]-=i/2,bf[1]+=i/2,yn(vf,n,vf,o),yn(bf,n,bf,o),s?(s.xmin=vf[0],s.ymin=vf[1],s.xmax=bf[0],s.ymax=bf[1],s.spatialReference=o):s=new Pr(vf[0],vf[1],bf[0],bf[1],o),s}const Eke=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:wke,eyeForCenterWithHeadingTilt:xke,eyeTiltToLookAtTilt:Ske,headingTiltToDirectionUp:Ime,lookAtTiltToEyeTilt:Tke,toExtent:$me},Symbol.toStringTag,{value:"Module"})),Lme=Ce(0,0,1),Dme=pe(C(),Ce(1,1,1)),Cke=new hy(-180,180),sS=be(),x0=C(),Rb=C();function Nme(e,t,r,i=Qj()){rt(x0,e,Lme),de(x0,x0)===0&&rt(x0,e,Dme),Nc(sS,-Ot(t),e),$l(sS,sS,-Ot(r),x0);const{up:s,direction:n}=i;return rt(s,x0,e),pe(s,s),Ue(s,s,sS),pe(n,e),Wo(n,n),Ue(n,n,sS),i}function Ake(e,t,r,i){const s=x0,n=Rb;return pe(s,e),rt(Rb,s,Lme),de(Rb,Rb)===0&&rt(Rb,s,Dme),rt(n,Rb,s),Rme(t,r,i,s,n)}function Oke(e,t,r,i){const s={eye:C(),up:null,tilt:i,heading:r},n=x0;n[0]=e[0],n[1]=e[2],n[2]=-e[1];const o=t,a=Ot(r),l=Ot(i),c=Math.sin(a),u=Math.cos(a),d=Math.sin(l),p=Math.cos(l),g=Se(n);let y;if(Math.abs(l)<1e-8)y=o+g;else{const J=g/d,R=Hu(o/J),k=Math.PI-l-R;y=J*Math.sin(k)}const _=p*o,v=o*o*(d*d),w=u*u*v,T=y-_,x=T*T,S=w*(w+x-n[1]*n[1]);if(S<0)return te(s.eye,n,y/g),s.tilt=0,NR(s,e);const O=Math.sqrt(S),A=n[1]*T,$=w+x;let P;if(P=u>0?-O+A:O+A,Math.abs($)<1e-8)return g<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):te(s.eye,n,y/g),s.tilt=0,o6(s.eye),NR(s,e);s.eye[1]=P/$;const U=c*c*v,I=d*o,L=u*I*s.eye[1],N=s.eye[1]*s.eye[1],Z=1-N,W=Math.sqrt(Z),V=w*N+U-2*L*W*T+Z*x;return Math.abs(V)<1e-8?(te(s.eye,n,y/g),s.tilt=0,o6(s.eye),NR(s,e)):(s.eye[0]=(Z*(y*n[0]-_*n[0])-I*W*(n[0]*s.eye[1]*u+n[2]*c))/V,s.eye[2]=(Z*(y*n[2]-_*n[2])-I*W*(n[2]*s.eye[1]*u-n[0]*c))/V,te(s.eye,s.eye,y),o6(s.eye),NR(s,e))}function o6(e){const t=e[1];e[1]=-e[2],e[2]=t}function NR(e,t){const r=Nme(t,e.heading,e.tilt);return e.up=r.up,e}function Rke(e,t,r){const i=Se(t),s=Math.sqrt(r*r+i*i-2*r*i*Math.cos(Math.PI-e)),n=Hu(r/(s/Math.sin(e)));return xa(e-n)}function Pke(e,t,r){const i=Ot(e),s=Se(t);return Hu(r/(s/Math.sin(i)))+i}function Fme(e,t,r,i,s){let n,o,a,l;const c=t.latitude,u=Mr(e.spatialReference).radius,d=t.longitude,p=BUe(c,r,u)/2;n=d-p,o=d+p;const g=Ot(c),y=(1+Math.sin(g))/(1-Math.sin(g)),_=(y+1)*Math.tan(i/u/2),v=_*_;function w(x){const S=Math.PI/2;return(x=ROe.normalize(x,-S))>S&&(x=Math.PI-x),x}if(a=1.5*Math.PI-2*Math.atan(.5*(_+Math.sqrt(4*y+v))),l=a+i/u,a=w(a),l=w(l),l<a){const x=l;l=a,a=x}if(a=Math.max(xa(a),-90),l=Math.min(xa(l),90),o=Cke.monotonic(n,o),o-n>180){const x=(o-n-180)/2;n+=x,o-=x}const T=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:st.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=T):s=new Pr(n,a,o,l,T),e.spatialReference&&e.spatialReference.isWebMercator&&uC(s,!1,s),s}const Mke=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:Ake,eyeForCenterWithHeadingTilt:Oke,eyeTiltToLookAtTilt:Pke,headingTiltToDirectionUp:Nme,lookAtTiltToEyeTilt:Rke,toExtent:Fme},Symbol.toStringTag,{value:"Module"}));function IL(e){return e.type==="point"}class eH{constructor(t,r=null,i=0){this.array=t,this.spatialReference=r,this.offset=i}}function Ume(e){return"array"in e}function Mp(e,t,r="ground"){if(IL(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,r);if(Ume(t)){let i=t.offset;return e.getElevation(t.array[i++],t.array[i++],t.array[i]||0,t.spatialReference??e.spatialReference,r)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,r)}function WA(e,t){return e!=null&&(t==null||(t===Ie.Local?!e.isGeographic||e.isWGS84||e.wkid===Pu.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===Pu.CGCS2000||e.wkid===Pu.GCSMARS2000||e.wkid===Pu.GCSMARS2000_SPHERE||e.wkid===Pu.GCSMOON2000))}const kme=K.getLogger("esri.views.3d.support.cameraUtils"),zme=39.37,Bme=96,zz=1,Ike=8,$ke=5,Vme=1,gK=C(),Lke={heading:0,tilt:0},I0=new ut,Dke=new hy(-20037508342788905e-9,20037508342788905e-9),Nke=new hy(-180,180);var So;function Z3(e){return e.spatialReference||st.WGS84}function A2(e){return e.viewingMode==="global"?Mke:Eke}function Fke(e,t,r,i,s){return A2(e).headingTiltToDirectionUp(t,r,i,s)}function em(e,t){if(t==null)return null;const r=e.renderSpatialReference,i=A2(e).headingTiltToDirectionUp,s=C();if(!no(t.position,s,r))return null;const n=i(s,t.heading,t.tilt);te(n.direction,n.direction,e.state.camera.distance),oe(n.direction,n.direction,s);const o=ob(e,s,n.direction,n.up);return o.fov=Ot(t.fov),o}(function(e){e[e.LOCKED=0]="LOCKED",e[e.ADJUST=1]="ADJUST"})(So||(So={}));const Pb=C();function kT(e,t,r){const i=e.renderSpatialReference,s=t4(e,t.eye,t.viewForward,t.up,Lke);let n=Z3(e);return yn(t.eye,i,Pb,n)||(n=st.WGS84,yn(t.eye,i,Pb,n)),r==null?new Wu(new ut(Pb,n),s.heading,s.tilt,xa(t.fov)):(r.position.x=Pb[0],r.position.y=Pb[1],r.position.z=Pb[2],r.position.spatialReference=n,r.heading=s.heading,r.tilt=s.tilt,r.fov=xa(t.fov),r)}function tH(e,t,r){const i=e.state.camera,s=i.width/2/i.pixelRatio;return e.renderCoordsHelper.viewingMode===Ie.Global&&r!=null&&(t*=Math.cos(Ot(r))),t/=e.renderCoordsHelper.unitInMeters,s/(Bme*zme/t)/Math.tan(i.fovX/2)}function D1(e,t,r){const i=e.state.camera,s=t*Math.tan(i.fovX/2),n=i.width/2/i.pixelRatio;let o=Bme*zme/(n/s);return e.renderCoordsHelper.viewingMode===Ie.Global&&r!=null&&(o/=Math.cos(Ot(r))),o*e.renderCoordsHelper.unitInMeters}function Gme(e,t,r,i,s,n){return jme(e,t,tH(e,r,t.latitude),i,s,n)}function jme(e,t,r,i,s,n){if(Hv(n)){const a=new O2(n.signal);return qA(e,i.heading,i.tilt,t,r,s,a),void a.resolver.promise.then(l=>{const c=LL(e,l,i.fov);if(c!=null)return n.resolver.resolve(c);n.resolver.reject()},l=>n.resolver.reject(l))}const o=qA(e,i.heading,i.tilt,t,r,s);return LL(e,o,i.fov,n)}function t4(e,t,r,i,s){return A2(e).directionToHeadingTilt(t,r,i,s)}function Uke(e,t){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,I0,e.spatialReference)&&e.elevationProvider&&(Mp(e.elevationProvider,I0)??0)>(I0.z??0)-Vme)}async function kke(e,t,r){if(!e.renderCoordsHelper.fromRenderCoords(t,I0,e.spatialReference)||!e.elevationProvider)return!1;const i=I0.z??0;return(await e.elevationProvider.queryElevation(I0.x,I0.y,i,I0.spatialReference,"ground",r)??0)>i-Vme}async function zke(e,t,r){const i=C();if(t)if(t instanceof ut){if(no(t,i,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null&&e.elevationProvider!=null){const s=await e.elevationProvider.queryElevation(t.x,t.y,t.z??0,t.spatialReference,"ground",r);return s!=null&&e.renderCoordsHelper.setAltitude(i,s),i}}else re(i,t);else re(i,e.state.camera.center);return i}function Bke(e,t){const r=C();if(t&&t instanceof ut){if(no(t,r,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null&&e.elevationProvider!=null){const i=Mp(e.elevationProvider,t);i!=null&&e.renderCoordsHelper.setAltitude(r,i)}}else re(r,t||e.state.camera.center);return r}function qA(e,t,r,i,s,n,o){const a=i&&i instanceof ut?i:null;if(Hv(o))return zke(e,i,o.signal).then(c=>{Bz(e,t,r,a,c,s,n,o)},c=>o.resolver.reject(c)),null;const l=Bke(e,i);return Bz(e,t,r,a,l,s,n,o)}function Bz(e,t,r,i,s,n,o,a){if(i==null){const d=e.renderSpatialReference;if((i=Nm(s,d,Z3(e)))==null)return null}n=Math.max(n,e.state.constraints.minimumPoiDistance);const l=jke(e,t,r,s,n,o),c=(0,A2(e).eyeForCenterWithHeadingTilt)(s,n,l.heading,l.tilt);if(o===So.ADJUST&&e.viewingMode==="global"&&r>0){const d=()=>{const g=Hme(e,s,n,Wke(e,n,r,s));return o=r-g<1?So.LOCKED:So.ADJUST,Bz(e,t,g,i,s,n,o,a)},p=e.map.ground.navigationConstraint;if(!p||p.type==="stay-above"){if(Uke(e,c.eye))return d();if(Hv(a))return kke(e,c.eye,a.signal).then(g=>g?d():(a.resolver.resolve({eye:c.eye,up:c.up,center:Ts(s),heading:c.heading,tilt:c.tilt}),null)),null}}const u=!a||Hv(a)?{center:C(),eye:C(),up:C(),tilt:0,heading:0}:a;return u.eye=c.eye,u.up=c.up,u.center=Ts(s),u.heading=c.heading,u.tilt=c.tilt,Hv(a)&&a.resolver.resolve(u),u}function SC(e,t,r,i,s,n=null){let o,a,l;if(e.state.isGlobal){if(!WA(t.spatialReference,Ie.Global))return Hv(n)&&n.resolver.reject(),null;const v=new ut(t.xmin,t.ymin,t.spatialReference),w=new ut(t.xmax,t.ymax,t.spatialReference),T=t.spatialReference.isGeographic?Nke:Dke;o=new ut({x:T.center(v.x,w.x),y:(w.y+v.y)/2,z:t.zmax!=null&&t.zmin!=null?(t.zmax+t.zmin)/2:void 0,spatialReference:t.spatialReference});const x=Mr(t.spatialReference),S=zUe(o,v,w);a=S.lon,l=S.lat,T.diff(v.x,w.x)>T.range/2&&(a+=x.halfCircumference),a=Math.min(a,x.halfCircumference),l=Math.min(l,x.halfCircumference)}else{const v=e.renderSpatialReference??t.spatialReference;v.equals(t.spatialReference)||(t=g2(t,v)),a=t.xmax-t.xmin,l=t.ymax-t.ymin;const w=t.zmax!=null&&t.zmin!=null?(t.zmax+t.zmin)/2:void 0;o=new ut({x:t.xmin+.5*a,y:t.ymin+.5*l,z:w,spatialReference:v})}const c=t.zmax!=null&&t.zmin!=null?t.zmax-t.zmin:0,u=e.state.camera,d=1/Math.tan(u.fovX/2),p=1/Math.tan(u.fovY/2),g=1/Math.tan(u.fov/2),y=Math.max(.5*a*d,.5*l*p,.5*c*g)/zz;if(Hv(n)){const v=new O2(n.signal);return qA(e,r,i,o,y,s,v),void v.resolver.promise.then(w=>{const T=LL(e,w,e.camera.fov);if(T!=null)return n.resolver.resolve(T);n.resolver.reject()},w=>n.resolver.reject(w))}const _=qA(e,r,i,o,y,s);return LL(e,_,e.camera.fov,n)}function Vke(e,t,r){const i=e.renderSpatialReference,s=Nm(r,i,Z3(e));if(s==null)return null;const n=Math.tan(t.fovX/2),o=Math.tan(t.fovY/2),a=_3(t.eye,r),l=2*a*n*zz,c=2*a*o*zz;return e.viewingMode==="global"?Fme(e,s,l,c):$me(e,s,l,c)}function Gke(e,t,r){const i=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(r/i)/Math.LN2>Ike)return!0;const s=e.renderSpatialReference,n=Z3(e),o=Nm(t,s,n),a=Nm(e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,n);if(o==null||a==null)return!1;const l=Math.tan(.5*e.state.camera.fov)*i;return a.distance(o)/l>$ke}function jke(e,t,r,i,s,n){let o=0;return n===So.ADJUST&&Gke(e,i,s)?(t=0,o=Hke(e,s,r,i)):o=rH(e,i,s,r),o=e.state.constraints.clampTilt(s,o),{heading:t,tilt:r=Hme(e,i,s,o)}}const $L=.7;function Hke(e,t,r,i){const s=rH(e,i,t,r);if(!e.state.constraints.tilt)return s;const n=e.state.constraints.tilt(t);n.max=Math.min(n.max,.5*Math.PI);const o=n.min*(1-$L)+n.max*$L;return Math.min(s,o)}function Wke(e,t,r,i){let s=rH(e,i,t,r);if(!e.state.constraints.tilt)return s;const n=e.state.constraints.tilt(t);return s=Math.min(s,.5*Math.PI),n.min*(1-$L)+s*$L}function Hme(e,t,r,i){return A2(e).lookAtTiltToEyeTilt(i,t,r)}function rH(e,t,r,i){return A2(e).eyeTiltToLookAtTilt(i,t,r)}function LL(e,t,r,i){if(t==null)return null;const s=e.renderSpatialReference,n=Nm(t.eye,s,Z3(e));return n==null?null:i!=null?(i.position=n,i.heading=t.heading,i.tilt=t.tilt,i.fov=r,i):new Wu(n,t.heading,t.tilt,r)}function qke(e,t){const r=e.basemapTerrain?.tilingScheme;if(r)return r.levelAtScale(t);kme.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function Wme(e,t){const r=e.basemapTerrain?.tilingScheme;if(r)return r.scaleAtLevel(t);kme.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function qme(e,t){return yn(t.center,e.renderSpatialReference,gK,st.WGS84),D1(e,t.distance,gK[1])}class O2{constructor(t){this.signal=t,this.resolver=Ys()}}function Hv(e){return e&&"resolver"in e}const Xke=.66;function Xme(e){return 360-R7.normalize(e)}function r4(e){return R7.normalize(360-e)}function nS(e){return e!=null&&e.resolver&&e.resolver.reject(),null}function Zke(e,t){return e!=null&&e.resolver&&e.resolver.resolve(t),t}function iH(e,t,r,i=null){if(!t)return nS(i);const s=e.spatialReference||st.WGS84;if(t.camera!=null){const c=Y1(t.camera.position,s);if(c==null)return nS(i);const u=t.camera.clone();return u.position=c.clone(),Zke(i,u)}if(t.targetGeometry==null)return nS(i);const n=t.get("targetGeometry.spatialReference");if(n&&!ty(n,s))return nS(i);const o=kT(e,e.state.camera);let a=So.ADJUST;if(t.rotation!=null&&(o.heading=Xme(t.rotation),a=So.LOCKED),r!=null&&(o.tilt=r),t.targetGeometry.type==="point"){const c=t.targetGeometry;let u;const d=t.targetGeometry.clone();return u=t.scale!=null?tH(e,t.scale,c.latitude):e.state.camera.distance,jme(e,d,u,o,a,i)}const l=t.targetGeometry.extent;return l?SC(e,l,o.heading,o.tilt,a,i):nS(i)}function Yke(e,t,r=null){return r==null&&(r=new zl),oH(e,null,t.clone(),r)}async function Jke(e,t,r){const i=aze(e,t);if(!i)throw new G("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new Wu({fov:e.camera.fov}),n=new zl({camera:s});if(i.target instanceof zl)return i_(await eze(e,i.target,i,r,n));if(i.target instanceof Wu)return i_(Yme(e,i.target,n));const o=i.scale!=null||i.zoom!=null;if(i.target instanceof Pr){const c=i.target.xmin===i.target.xmax||i.target.ymin===i.target.ymax;return i_(o||c?await Vz(e,i,i.target.center,s,r,n):await sze(e,i,i.target,s,r,n))}const a={boundingBox:mi(),hasZ:!1,screenSpaceObjects:[]},l=o?Kke(e,i):void 0;if(await Zme(e,i.target,l,a),isFinite(a.boundingBox[0])){let c;if(td(a.boundingBox,ys),hc.x=ys[0],hc.y=ys[1],hc.z=ys[2],hc.spatialReference=e.spatialReference,isFinite(hc.z)&&a.hasZ?c=lG(a.boundingBox):(hc.z=void 0,c=IRe(aG(a.boundingBox,cze))),o||c)return i_(await Vz(e,i,hc,s,r,n));const u=lze(e,a.screenSpaceObjects);return i_(await oze(e,i,hc,a.boundingBox,u,s,r,n))}return i.position?i_(rze(e,i,s,n)):i_(await ize(e,i,s,r,n))}function sH(e,t){return t.scale==null&&t.zoom!=null?Wme(e,t.zoom):t.scale}function Kke(e,t){const r=sH(e,t);return r?NLe(r):void 0}function nH(e,t){let r=!1;return t.heading!=null?(e.heading=t.heading,r=!0):t.rotation!=null&&(e.heading=Xme(t.rotation),r=!0),t.tilt!=null&&(e.tilt=t.tilt,r=!0),t.fov!=null&&(e.fov=t.fov),r}function oH(e,t,r,i){const s=e.spatialReference||st.WGS84;return(t=t??em(e,r))==null||(i.targetGeometry=Nm(t.center,e.renderSpatialReference,s),i.scale=qme(e,t),i.rotation=r4(r.heading),i.camera=r),i}function DL(e,t,r){const i=()=>new G("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!t)throw i();if(!ty(t.spatialReference,e.spatialReference))throw new G("viewpointutils:incompatible-spatialreference",`Spatial reference (${t.spatialReference?t.spatialReference.wkid:"unknown"}) is incompatible with the view (${e.spatialReference?.wkid})`,{geometry:t});const s=[];if(!t.hasZ&&e.basemapTerrain){let a;switch(t.type){case"point":a=t;break;case"multipoint":case"polyline":a=t.extent?.center;break;case"mesh":a=t.origin;break;case"extent":a=t.center;break;case"polygon":a=t.centroid}a&&e.basemapTerrain.spatialReference!=null&&ty(a,e.basemapTerrain.spatialReference)&&e.elevationProvider?ys[2]=Mp(e.elevationProvider,a)??0:ys[2]=0}(0,uze[t.type])(t,a=>{s.push(a[0],a[1],a[2])},ys);const n=s.length/3;if(n===0)throw i();const o=new Array(s.length);if(ji(s,t.spatialReference,0,o,e.spatialReference,0,n)){t.hasZ&&(r.hasZ=!0);for(let a=0;a<o.length;a+=3)t.hasZ?(ys[0]=o[a],ys[1]=o[a+1],ys[2]=o[a+2]):(ys[0]=o[a],ys[1]=o[a+1]),Zp(r.boundingBox,ys)}}async function Qke(e,t,r,i){const s=await Yu(e.whenViewForGraphic(t));if(s.ok===!1||s.value==null||!("whenGraphicBounds"in s.value))return void DL(e,t.geometry,i);const n=s.value,o=await Yu(n.whenGraphicBounds(t,{minDemResolution:r}));if(o.ok===!1)return void DL(e,t.geometry,i);const{screenSpaceObjects:a,boundingBox:l}=o.value;hT(i.boundingBox,l),a&&a.forEach(c=>{i.screenSpaceObjects.push(c)}),isFinite(l[2])&&(i.hasZ=!0)}async function Zme(e,t,r,i){if(Array.isArray(t)&&t.length===2){const s=t[0],n=t[1];if(typeof s=="number"&&typeof n=="number")return hc.x=s,hc.y=n,hc.z=void 0,hc.spatialReference=e.spatialReference?.isGeographic?e.spatialReference:st.WGS84,void DL(e,hc,i)}t&&"map"in t&&typeof t.map=="function"?await Sc(t.map(s=>Zme(e,s,r,i))):t instanceof Iy?DL(e,t,i):t instanceof v1&&await Qke(e,t,r,i)}async function eze(e,t,r,i,s){if(t.camera!=null)return Yme(e,t.camera,s);s.scale=t.scale,s.rotation=t.rotation,s.targetGeometry=t.targetGeometry!=null?t.targetGeometry.clone():null,s.camera=null,r.heading!=null?s.rotation=r4(r.heading):r.rotation!=null&&(s.rotation=r.rotation);const n=sH(e,r);n!=null&&(s.scale=n);const o=new O2(i);return iH(e,s,r.tilt,o),s.camera=await o.resolver.promise,s}function Yme(e,t,r){const i=e.spatialReference,s=Y1(t.position,i);return s==null?null:((t=t.clone()).fov=e.camera.fov,t.position=s,oH(e,null,t,r))}function tze(e,t,r,i,s,n){const o=e.renderSpatialReference;return no(r,UR,o),no(t,a6,o),n.targetGeometry=new ut(t),s.position=new ut(r),ce(NL,a6,UR),t4(e,UR,NL,i.up,s),n.scale=D1(e,ni(UR,a6),n.targetGeometry.latitude),n.rotation=r4(s.heading),n.camera=s,n}async function Vz(e,t,r,i,s,n){if(r==null)throw new G("createfromcenter","invalid point");n.targetGeometry=r.clone();const o=ob(e);if(t.position)return tze(e,n.targetGeometry,t.position,o,i,n);if(t.zoomFactor){const l=o.distance/t.zoomFactor,c=te(ys,o.viewForward,-l);o.eye=oe(ys,o.center,c),n.scale=D1(e,l,r.latitude)}kT(e,o,i);const a=nH(i,t)?So.LOCKED:So.ADJUST;if(!t.zoomFactor){const l=sH(e,t);l==null?(no(r,ys,e.renderSpatialReference),Afe(o.frustum,ys)?n.scale=D1(e,ni(o.eye,ys),r.latitude):n.scale=qme(e,o)):n.scale=l;const c=new O2(s);Gme(e,n.targetGeometry,n.scale,i,a,c),n.camera=await c.resolver.promise}return n}function rze(e,t,r,i){const s=ob(e);return re(NL,s.viewForward),t4(e,s.eye,NL,s.up,l6),r.position=new ut(t.position),r.heading=t.heading!=null?t.heading:l6.heading,r.tilt=t.tilt!=null?t.tilt:l6.tilt,oH(e,null,r,i)}async function ize(e,t,r,i,s){const n=ob(e);return Vz(e,t,Nm(n.center,e.renderSpatialReference,e.spatialReference),r,i,s)}async function sze(e,t,r,i,s,n){n.targetGeometry=r.clone();const o=ob(e);kT(e,o,i);const a=nH(i,t)?So.LOCKED:So.ADJUST,l=new O2(s);return SC(e,r,i.heading,i.tilt,a,l),n.camera=await l.resolver.promise,n}function nze(e,t,r,i,s){let n=0;r.z!=null?n=r.z:e.basemapTerrain&&e.elevationProvider&&(n=Mp(e.elevationProvider,r)),se(ys,r.x,r.y,n),Oc(e.spatialReference,ys,yK,e.renderSpatialReference),Ku(FR,yK),Qu(FR,FR),mi(oS);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let y=0;y<o.length;y++){const _=o[y];let v=i[_[2]];isFinite(v)||(v=n),se(ys,i[_[0]],i[_[1]],v),yn(ys,e.spatialReference,ys,e.renderSpatialReference),Zp(oS,Il(ys,ys,FR))}const a=Q1(oS),l=Ly(oS),c=eb(oS),u=1/Math.tan(t.fovX/2),d=1/Math.tan(t.fovY/2),p=.5*Math.sqrt(a*a+c*c)*Math.max(d,u)+.5*l,g=.5*l*d+.5*Math.max(a,c);return Math.max(p,g)/s}async function oze(e,t,r,i,s,n,o,a){a.targetGeometry=r.clone();const l=ob(e),c=nze(e,l,r,i,s);kT(e,l,n);const u=nH(n,t)?So.LOCKED:So.ADJUST;a.scale=D1(e,c,a.targetGeometry.latitude);const d=new O2(o);return Gme(e,a.targetGeometry,a.scale,n,u,d),a.camera=await d.resolver.promise,a}function aze(e,t){if(!t||!e.spatialReference)return null;const r={target:void 0};return"declaredClass"in t||Array.isArray(t)?r.target=t:(Object.assign(r,t),t.center&&!r.target&&(r.target=t.center)),r}function i_(e){return e&&e.camera!=null&&(e.rotation=r4(e.camera.heading)),e}function lze(e,t){const r=Xke;if(!t.length)return r;let i=Number.NEGATIVE_INFINITY;for(let s=0;s<t.length;s++){const n=t[s].screenSpaceBoundingRect;i=Math.max(i,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return r-i/Math.min(e.width,e.height)*2}const ys=C(),yK=be(),FR=$i(),oS=Qs(),cze=Nt(),NL=C(),UR=C(),a6=C(),l6={heading:0,tilt:0},hc=new ut,uze={point(e,t,r){r[0]=e.x,r[1]=e.y,e.z!=null&&(r[2]=e.z),t(r)},polygon(e,t,r){const i=e.hasZ;for(let s=0;s<e.rings.length;s++){const n=e.rings[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),t(r)}},polyline(e,t,r){const i=e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),t(r)}},multipoint(e,t,r){const i=e.points,s=e.hasZ;for(let n=0;n<i.length;n++)r[0]=i[n][0],r[1]=i[n][1],s&&(r[2]=i[n][2]),t(r)},extent(e,t,r){e.zmin!=null&&e.zmax!=null?(t(se(r,e.xmin,e.ymin,e.zmin)),t(se(r,e.xmax,e.ymin,e.zmin)),t(se(r,e.xmin,e.ymax,e.zmin)),t(se(r,e.xmax,e.ymax,e.zmin)),t(se(r,e.xmin,e.ymin,e.zmax)),t(se(r,e.xmax,e.ymin,e.zmax)),t(se(r,e.xmin,e.ymax,e.zmax)),t(se(r,e.xmax,e.ymax,e.zmax))):(t(se(r,e.xmin,e.ymin,r[2])),t(se(r,e.xmax,e.ymin,r[2])),t(se(r,e.xmin,e.ymax,r[2])),t(se(r,e.xmax,e.ymax,r[2])))},mesh(e,t,r){const i=e.vertexAttributes&&e.vertexAttributes.position;if(i)for(let s=0;s<i.length;s+=3)t(se(r,i[s],i[s+1],i[s+2]))}};class hze{constructor(t,r,i){this.target=t,this.options=r,this.view=i,this.state="pending",this._animationController=null,this._promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;const o=new AbortController;this.options.signal!=null&&Ws(this.options.signal,()=>{this.abort()}),this._abortController=o,this.waitForReady()})}then(t,r){return this._promise.then(t,r)}catch(t){return this._promise.catch(t)}resolve(t){if(this.state!=="finished")return this.state="finished",this._resolveCallback(t)}reject(t){if(this.state!=="finished")return this.state="finished",this._rejectCallback(t)}abort(t=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!t&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(Cr())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await eT(()=>this.view.ready,this._abortController.signal)}catch(t){return this.reject(t)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null,Jke(this.view,this.target,this._abortController.signal).then(t=>{if(this.state==="finished")return;const r=t?this._getCameraFromViewpoint(t):null;if(r!=null)if(this.options.animate){if(this._animationController==null)return;this.startAnimation(r,this._animationController)}else this.view.stateManager.setStateCamera(r.camera,{applyConstraints:!r.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},t=>{this.reject(t)}))}_getCameraFromViewpoint(t){const r=!!(this.target instanceof zl&&this.target.camera||this.target instanceof Wu),i=t.camera;if(i==null)return null;if(!this.view.stateManager.isCompatible(i)){const n=i.position,o=n&&n.spatialReference,a=o?o.wkid:"none",l=this.view.spatialReference?.wkid;return this.reject(new G("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${a}, view: ${l})`,{camera:i})),null}const s=em(this.view,i);return s==null?(this.reject(new G("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:t,camera:s,isFullySpecified:r}}startAnimation(t,r){this.state="wait-for-animation-finish";const i=r.viewAnimation;if(i==null)return void this.reject(new G("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(i.update(t.viewpoint,"running"),!r.active||r.viewAnimation==null||r.viewAnimation.target!==t.viewpoint||this.view.state.cameraController!==r)return this.abort();let s;t.isFullySpecified?(s=new TC({view:this.view,desiredCamera:t.camera}),E2(this.view,t.camera,Fu.EYE_AND_CENTER)):bs(this.view,t.camera),r.begin(t.camera,this.options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof fm&&a.viewAnimation!=null&&a.viewAnimation.target===t.viewpoint&&(this.view.state.cameraController=s):r.viewAnimation!=null&&r.viewAnimation.target===t.viewpoint&&r.state==="finished"&&(this.view.state.cameraController=s))},o=a=>{if(this.view.state!=null)switch(r.state){case Ui.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case Ui.Ready:case Ui.Rejected:case Ui.Running:case Ui.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};i.when(n,a=>o(a)),r.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let t=null,r=null;const i=this.view.state.cameraController;return i instanceof fm&&(i.updateStateFromViewAnimation(),i.active&&(t=i,r=t.viewAnimation)),t!=null||(t=new fm({view:this.view,mode:"animation"}),r=t.viewAnimation,this.view.state.switchCameraController(t))?t:(r?.stop(),this.reject(new G("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}}let on=class extends xe{get camera(){const e=this._get("camera");if(!this.ready)return e;const t=kT(this.view,this.view.state.camera,c6);return t&&e&&t.equals(e)?e:t.clone()}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider?.enableElevationCache(!0),this.setStateCamera(em(this.view,e),{applyConstraints:!1})||K.getLogger(this).error("#camera=","Invalid camera",e),this.view.elevationProvider?.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const t=kT(this.view,this.view.state.contentCamera,c6);return t&&e&&t.equals(e)?e:t.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const t=em(this.view,e);t!=null?(this._updateElevation(t),this.view.state.contentCamera=t):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(u6),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const t=this.zoom,r=this.view.state.camera.distance**2,i=fa(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.addHandles([le(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(u6),this.test.contentCameraResetState.clear())}),le(()=>this.zoom,n=>{n!==void 0&&t!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(n-t)/2),Math.abs(n-t)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s))}),le(()=>this.view.state.camera,n=>{const o=gn(i,n.center);this.test.contentCameraResetState.set("camera.center",o/r),o>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],u6),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():K.getLogger(this).error("#center=","Invalid center",e):K.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):K.getLogger(this).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,t=Vke(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return t??this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||K.getLogger(this).error("#extent=","Invalid extent",e):K.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e):K.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return D1(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||K.getLogger(this).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,t=e.padding,r=e.pixelRatio,i=this._get("padding"),s=Math.round(t[Gt.TOP]/r),n=Math.round(t[Gt.RIGHT]/r),o=Math.round(t[Gt.BOTTOM]/r),a=Math.round(t[Gt.LEFT]/r);return i!=null&&i.top===s&&i.right===n&&i.bottom===o&&i.left===a?i:{top:s,right:n,bottom:o,left:a}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,kR),this.view.state.updateCamera(t=>t.padding=kR))}_paddingToArray(e,t,r){e?pi(r,e.top||0,e.right||0,e.bottom||0,e.left||0):pi(r,0,0,0,0);for(let i=0;i<4;i++)r[i]=Math.round(r[i]*t)}get screenCenter(){const e=this.padding;return Xu((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?Yke(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||K.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const t=e.camera!=null?e.camera.position:e.targetGeometry,r=t!=null&&t.spatialReference;K.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(r?r.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",e)}else K.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?qke(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||K.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),t=this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*t),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*t);const r=this.view._stage.renderView.renderingContext.parameters.maxTextureSize;return Iv(this._tmpCanvasSize,r)?this._tmpCanvasSize.pixelRatio=t:this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth:t,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){return this.view?._stage?.renderer.isFeatureEnabled(Fs.PhysicalPixelRendering)??!1}get _usePhysicalPixelRenderingAny(){const e=this.view?._stage?.renderer;return e&&(e.isFeatureEnabled(Fs.PhysicalPixelRendering,Er.IDLE)||e.isFeatureEnabled(Fs.PhysicalPixelRendering,Er.INTERACTING)||e.isFeatureEnabled(Fs.PhysicalPixelRendering,Er.ANIMATING))}constructor(e){super(e),this.constraintsManager=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._updatingIgnoreRenderState=!1,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:t=>this._devicePixelRatioOverride=t,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},set updatingIgnoreRenderState(t){this.viewStateManager._updatingIgnoreRenderState=t},get updatingIgnoreRenderState(){return this.viewStateManager._updatingIgnoreRenderState||this.renderState!=null}},this._propertiesPool=new Um({frustum:M0},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new dze}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([qo(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),le(()=>this.view.state?.camera,(e,t)=>this._cameraChangedHandler(e,t),Vr)]),Dc(()=>this.view.state?.camera,e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([Qx({prepare:()=>this._prepareFrame()}),le(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(zR)}),qo(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=Re(this._propertiesPool)}init(){this.constraintsManager=new IE({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const t of e)this.set(t.name,t.value);if(!this._cameraSetByUser){const t=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;t&&this.isCompatible(t)?this._setInitialView(t):this.view.state.viewingMode===Ie.Local&&this.addHandles(Dc(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(zR),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),zR)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(zR),this.constraintsManager=Re(this.constraintsManager))}async goTo(e,t){const r={animate:!0,...t};return this._gotoOperation!=null&&this._gotoOperation.abort(r.animate),this._gotoOperation=new hze(e,r,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation}debugSetCameraOnContent(){this.setStateCamera(ob(this.view),{applyConstraints:!1})}step(e){const t=this.view.state,r=t?.cameraController;r&&(t.updateCamera(i=>r.stepController(e,i)),r.steppingFinished&&r.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,t=[];for(const{propertyName:r,overrides:i}of fze){const s=e.has(r),n=this._isOverridden(r);!s&&n&&t.push({name:r,value:this._get(r)}),this._clearOverride(r),(s||n)&&i.forEach(o=>e.add(o))}return t}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof Wu)return void this.setStateCamera(em(this.view,e),{applyConstraints:!1});if(e instanceof zl){if(e.targetGeometry instanceof Pr){const s=SC(this.view,e.targetGeometry,0,.5,So.LOCKED);return void(s!=null&&this.setStateCamera(em(this.view,s),{applyConstraints:!0}))}const r={applyConstraints:!e.camera},i=this._viewpointToCamera(e);return void this.setStateCamera(i,r)}const t=SC(this.view,e,0,.5,So.LOCKED);t!=null&&this.setStateCamera(em(this.view,t),{applyConstraints:!0})}_updatePropertyBeforeReady(e,t){return!this.ready&&(this._override(e,t),t&&pze.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof zl?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof Wu?this.isCompatible(e.position):e.spatialReference&&ty(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=mze){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,t,r=Sg){const{heading:i,tilt:s}=this._getPreservingHeadingTilt(),n=qA(this.view,i,s,e,t,So.ADJUST);return n==null?null:(r.copyFrom(this.view.state.camera),r.eye=n.eye,r.center=n.center,r.up=n.up,r)}_centerToCamera(e){const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const r=t.distance;return this._centerPointAtDistanceToCamera(e,r)}_extentToCamera(e){const{heading:t,tilt:r}=this._getPreservingHeadingTilt(),i=SC(this.view,e,t,r,So.ADJUST,c6);return i?em(this.view,i):null}_scaleToCamera(e){if(e==null)return null;const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const r=t.renderLocation,i=t.location.latitude;if(i==null)return null;const s=tH(this.view,e,i);return this._centerPointAtDistanceToCamera(r,s)}_zoomToCamera(e){return this._scaleToCamera(Wme(this.view,e))}_viewpointToCamera(e){return em(this.view,iH(this.view,e))}setStateCamera(e,t){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,t.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(r=>{t.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up):r.copyFrom(e),t.applyConstraints&&bs(this.view,r)}),t.applyConstraints||(this.view.state.cameraController=new TC({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:t}=this.view;if(!e||!t)return;this._windowDevicePixelRatio=window.devicePixelRatio;const r=this._computeCanvasSize();if(r.width!==0&&r.height!==0&&(t.width===r.width&&t.height===r.height||(t.width=r.width,t.height=r.height),this.view.state)){const i=this.view.state.camera;i.fullWidth===r.width&&i.fullHeight===r.height&&i.pixelRatio===r.pixelRatio||(Sg.copyFrom(i),Sg.pixelRatio!==r.pixelRatio&&(this._paddingToArray(this.padding,r.pixelRatio,kR),Sg.padding=kR),Sg.fullWidth=r.width,Sg.fullHeight=r.height,Sg.pixelRatio=r.pixelRatio,this.view.state.camera=Sg),this._updateViewState()}}_updateElevation(e){const t=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,r=this.view.renderCoordsHelper?.getAltitude(e.eye)??0,i=t?YN(this.view,e.eye):0;e.relativeElevation=r-i}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Er.ANIMATING:this.view.interacting?this.view.state.mode=Er.INTERACTING:(this.view.state.mode===Er.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=gze?this.view.state.mode=Er.INTERACTING:this.view.state.mode=Er.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,t){e&&t&&e.almostEquals(t)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};h([f({type:Wu,dependsOn:["view.state.camera","ready"]})],on.prototype,"camera",null),h([f({type:Wu,dependsOn:["view.state.contentCamera","ready"]})],on.prototype,"contentCamera",null),h([f({type:ut})],on.prototype,"center",null),h([f({type:Pr})],on.prototype,"extent",null),h([f({readOnly:!0})],on.prototype,"frustum",null),h([f({readOnly:!0})],on.prototype,"hasInitialView",null),h([f({readOnly:!0,type:Boolean})],on.prototype,"ready",void 0),h([f({type:Number})],on.prototype,"scale",null),h([f()],on.prototype,"padding",null),h([f({readOnly:!0})],on.prototype,"screenCenter",null),h([f({constructOnly:!0})],on.prototype,"view",void 0),h([f({type:zl})],on.prototype,"viewpoint",null),h([f({type:Number})],on.prototype,"zoom",null),h([f({readOnly:!0})],on.prototype,"_rasterPixelRatio",null),h([f({readOnly:!0})],on.prototype,"_usePhysicalPixelRendering",null),h([f({readOnly:!0})],on.prototype,"_usePhysicalPixelRenderingAny",null),h([f()],on.prototype,"_windowDevicePixelRatio",void 0),h([f()],on.prototype,"_devicePixelRatioOverride",void 0),on=h([F("esri.views.3d.state.ViewStateManager")],on);class dze{constructor(){this.width=0,this.height=0,this.pixelRatio=1}}const pze=["camera","viewpoint","extent","scale","center","zoom"],fze=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],mze={heading:0,tilt:0},c6=new Wu,Sg=new lt,kR=Ht(),zR="pending-initial-view",u6="content-camera-reset",gze=300,_K=100;let Ip=class extends sm{constructor(){super(...arguments),this.startCamera=new lt,this.currentCamera=new lt,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<_K}stepController(e,t){t.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(t)}onControllerStart(e){this.state=Ui.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),_K),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};h([f({readOnly:!0})],Ip.prototype,"isInteractive",null),h([f()],Ip.prototype,"_lastInteraction",void 0),Ip=h([F("esri.views.3d.state.controllers.InteractiveController")],Ip);var Tl;(function(e){e[e.CENTER=0]="CENTER",e[e.EYE=1]="EYE"})(Tl||(Tl={}));let EC=class extends Ip{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=Tl.CENTER,this._rotScale=0,this._lastPoint=Ne(),this._tmpWorldUp=C(),this._tmpViewDir=C(),this._tmpRotCurPoint=Ne(),this._tmpTransf=be(),this._tmpAxis=C(),this._tmpPivotPoint=C(),this._pivotPos=C(),this._constraintOptions={selection:wi.ALL,interactionType:Ut.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Un.TUMBLE}}initialize(){this._rotScale=this.pivot===Tl.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case Tl.EYE:re(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=Ut.LOOK_AROUND,this._constraintOptions.tiltMode=Un.LOOK_AROUND,this._constraintOptions.selection=wi.NONE;break;case Tl.CENTER:{const t=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?ab:{});t||re(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,t),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=Ut.TUMBLE,this._constraintOptions.tiltMode=Un.TUMBLE,this._constraintOptions.selection=wi.ALL&~wi.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,jv(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,t){const r=this.startCamera,i=C();ce(i,this._pivotPos,r.eye);const s=Se(i),n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(r.eye,vK);let o=Math.max(Math.min(J9e,1/Math.abs(de(vK,r.viewForward)))*n,K9e);t&&(o=Math.min(s,o));const a=Mr(this.view.spatialReference),l=zi(r.width/r.pixelRatio*.5,r.height/r.pixelRatio*.5),c=e4(this.startCamera,l,a);let u=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,r.fullWidth/r.pixelRatio*.5,r.fullHeight/r.pixelRatio*.5,r,2.5*t6,t6),d=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],r,t6);u==null&&d==null||(u=u??d??0,d=d==null||c===Nn.Horizontal?u:d,o=u>d?d:u,o=t?Math.min(o,s):o),pe(i,i),re(this._pivotPos,oe(this._tmpPivotPoint,r.eye,te(this._tmpPivotPoint,i,o)))}update(e){if(this.active){switch(this.pivot){case Tl.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case Tl.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}bs(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,t,r,i){this.view.renderCoordsHelper.worldUpAtPosition(i,this._tmpWorldUp),jv(e,t,this._tmpRotCurPoint);let s=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,n=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;ce(this._tmpViewDir,r,i);const o=Se(this._tmpViewDir),a=_n(de(this._tmpViewDir,this._tmpWorldUp)/o);if(this.pivot===Tl.EYE){s*=-.5;const l=.5*Math.PI-a,c=.5*Math.PI*.99;s=l-Math.max(-c,Math.min(c,l+s))}return s=fe(s+a,go.min,go.max)-a,rt(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===Tl.CENTER&&(n=-n),Nc(this._tmpTransf,n,this._tmpWorldUp),$l(this._tmpTransf,this._tmpTransf,s,this._tmpAxis),Ue(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=Ue(h6,e.up,this._tmpTransf),oe(h6,i,this._tmpViewDir),en(this._lastPoint,this._tmpRotCurPoint),h6}};h([f()],EC.prototype,"pivot",void 0),EC=h([F("esri.views.3d.state.controllers.RotateController")],EC);const h6=C(),vK=C();class d6 extends ao{constructor(t,r,i,s){super(!0),this._view=t,this.pointerAction=r,this._pivot=i,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(t){const r=t.data;if(r.pointers.size>1||!Kj(t.data,this.pointerAction))return;const i=zi(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new EC({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}t.stopPropagation()}}let Gz=class extends Ip{constructor(){super(...arguments),this._pickPoint=C(),this._tmpP0=Ne(),this._panAxisAngle=KN(),this._tmpRayDir=C(),this._tmpRayDirPick=C(),this._targetOnSphere=C(),this._navMode=Nn.Horizontal,this._tmpRay={origin:C(),direction:C()},this.dragBeginPoint=zi(),this._normalizedAnchorPoint=Ne(),this._constraintOptions={selection:wi.ALL_EXCEPT_COLLISION,interactionType:Ut.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Un.TUMBLE},this._sphere=ls(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;en(this.dragBeginPoint,e),jv(this.startCamera,e,this._normalizedAnchorPoint);const t=Mr(this.view.spatialReference),r=bme(this._intersectionHelper,this.startCamera,e,t,UT.Ellipsoid,this.view.map.ground.opacity===0?ab:{});if(this._navMode=e4(this.startCamera,e,t),this._navMode===Nn.Horizontal)this._hasPickPoint=!!r.scenePickPoint,this._pickPoint=r.scenePickPoint??this._pickPoint,this._sphere=r.sphere;else{let i;C2(this.startCamera,e,this._tmpRay),pe(this._tmpRay.direction,this._tmpRay.direction),r.scenePickPoint!=null&&(ce(this._tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),i=Se(this._tmpRayDirPick));const s=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,bK);let n=fe(Math.min(dme,1/Math.abs(de(bK,this._tmpRay.direction)))*s,CL[0],CL[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,QN);n=o??n,n=i!=null?Math.min(n,i):n,this._hasPickPoint=!0,te(this._tmpRay.direction,this._tmpRay.direction,n),oe(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===Nn.Horizontal){ce(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const t=Se(this._tmpRayDir);jv(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let i=t*2**r;const s=this.view.state.constraints.minimumPoiDistance;if(r<0&&i<s&&(i=s),Math.abs(t-i)<1e-6)return;if(this._hasPickPoint&&i<t){const n=1-(1-i/t)*(1-this._sphere[3]/Se(this.currentCamera.center));this.currentCamera.center=te(BR,this.currentCamera.center,n)}te(this._tmpRayDir,this._tmpRayDir,-i/t),this.currentCamera.eye=oe(BR,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=Jh(x1(this.dragBeginPoint,e)),bs(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(HA(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),Wj(this._pickPoint,this._targetOnSphere,this._panAxisAngle),Ay(this.currentCamera,this._sphere,this._panAxisAngle))}else{const t=Se(this._tmpRay.direction);jv(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let i=t*2**r;const s=this.view.state.constraints.minimumPoiDistance;if(r<0&&i<s&&(i=s),Math.abs(t-i)<1e-6)return;te(this._tmpRayDir,this._tmpRay.direction,1-i/t),this.currentCamera.eye=oe(BR,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=oe(BR,this.currentCamera.center,this._tmpRayDir)}E2(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};Gz=h([F("esri.views.3d.state.controllers.global.ZoomController")],Gz);const BR=C(),bK=C();let jz=class extends Ip{constructor(){super(...arguments),this._tmpP=C(),this._tmpDir=C(),this._tmpN=C(),this._tmpP0=Ne(),this._tmpPoi=C(),this._tmpRayDir=C(),this.dragBeginPoint=zi(),this._normalizedAnchorPoint=Ne(),this._constraintOptions={selection:wi.ALL,interactionType:Ut.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:C(),tiltMode:Un.TUMBLE},this._plane=Sr()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;en(this.dragBeginPoint,e),jv(this.startCamera,e,this._normalizedAnchorPoint);const t=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?ab:{});ce(this._tmpDir,this._tmpP,this.startCamera.eye);const r=Se(this._tmpDir);pe(this._tmpDir,this._tmpDir);const i=Math.abs(this.view.camera.position.z);let s=fe(Math.min(dme,1/Math.abs(de(yze,this._tmpDir)))*i,CL[0],CL[1]);const n=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,QN);s=n??s,s=t?Math.min(s,r):s,te(this._tmpDir,this._tmpDir,s),oe(this._tmpP,this.startCamera.eye,this._tmpDir),ce(this._tmpN,this.startCamera.eye,this.startCamera.center),pe(this._tmpN,this._tmpN),this._tmpN[1]<0&&Wo(this._tmpN,this._tmpN),B3(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;Q9e(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||re(this._tmpPoi,this.currentCamera.center),jv(this.currentCamera,e,this._tmpP0);let t=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);en(this._normalizedAnchorPoint,this._tmpP0),ce(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const r=Se(this._tmpRayDir);let i=r*(1-t);this._constraintOptions.interactionDirection&&(re(this._constraintOptions.interactionDirection,this._tmpRayDir),te(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(t)/r));const s=this.view.state.constraints.minimumPoiDistance;t>=0&&i<s&&(i=s,t=-(i-r)/r),Math.abs(r-i)<1e-6||(te(this._tmpRayDir,this._tmpRayDir,t),this.currentCamera.eye=oe(s_,this.currentCamera.eye,this._tmpRayDir),Lr(s_,this.currentCamera.center,this._tmpPoi,t),this._tmpPoi[2]>this.startCamera.center[2]?s_[2]=Math.max(this.startCamera.center[2],s_[2]):s_[2]=Math.min(this.startCamera.center[2],s_[2]),this.currentCamera.center=s_,this._constraintOptions.interactionFactor=Jh(x1(this.dragBeginPoint,e)),bs(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};jz=h([F("esri.views.3d.state.controllers.local.ZoomController")],jz);const s_=C(),yze=Ce(0,0,1);class _ze extends ao{constructor(t,r,i){super(!0),this._view=t,this.pointerAction=r,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(t){const r=t.data;if(r.pointers.size>1||!Kj(t.data,this.pointerAction))return;const i=zi(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new Gz({view:this._view}):this._cameraController=new jz({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}t.stopPropagation()}}function fh(e){let t=e*e;return e<0&&(t*=-1),t}function wK(e,t,r){const i=r,s=e.state,n=e.device,o=t.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(i.translation[0]=fh(s.axes[0]),i.translation[1]=fh(s.axes[1]),i.translation[2]=fh(s.buttons[7])-fh(s.buttons[6]),i.heading=fh(s.axes[2]),i.tilt=fh(s.axes[3])):n.deviceType==="spacemouse"&&(i.translation[0]=1.2*fh(s.axes[0]),i.translation[1]=1.2*fh(s.axes[1]),i.translation[2]=2*-fh(s.axes[2]),i.heading=1.2*fh(s.axes[5]),i.tilt=1.2*fh(s.axes[3])),i.tilt*=o,te(i.translation,i.translation,a),i}function xK(e,t){const r=t;return r.translation[0]=e[1]-e[0],r.translation[1]=e[3]-e[2],r.translation[2]=e[4]-e[5],r.heading=e[7]-e[6],r.tilt=e[8]-e[9],r.zoom=e[10]-e[11],r}function p6(e){return e.translation[0]===0&&e.translation[1]===0&&e.translation[2]===0&&e.heading===0&&e.tilt===0&&e.zoom===0}let $v=class extends Ip{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new lt,this._headingStart=0,this._constraintOptions={selection:wi.ALL,interactionType:Ut.NONE,interactionStartCamera:new lt,interactionFactor:0,interactionDirection:null,tiltMode:Un.LOOK_AROUND}}handleEventGamepad(e){const t=wK(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||p6(t))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,xK(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const t=xK(this._keysButtonState,this._transformation);p6(t)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const t=this.view.pointsOfInterest.cameraOnSurface.location.z,r=1;this._filteredSurfaceElevation+=r*(t-this._filteredSurfaceElevation)*e}stepController(e,t){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(t),this._updateCameraCenter(),this._constraintOptions.interactionStartCamera?.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,n_),this._applyDisabledMovementTypes(n_),this._applyPan(n_.pan),this._applyRotate(n_.rotate),this._applyZoom(n_.zoom),this._applyAscend(n_.ascend),this._constraintOptions.interactionType=Ut.NONE,this._constraintOptions.selection=wi.COLLISION,bs(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,t)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const t=this.currentCamera;ce(Aa,t.center,t.eye),Ue(Aa,Aa,e.matrix),t.center=oe(Aa,Aa,t.eye),t.up=Ue(Aa,t.up,e.matrix),this._constraintOptions.interactionType=Ut.LOOK_AROUND,this._constraintOptions.selection=wi.ALL_EXCEPT_COLLISION,bs(this.view,t,this._constraintOptions)}_applyPan(e,t=this.currentCamera){!e.enabled||(t.eye=Ue(Aa,t.eye,e.matrix),t.center=Ue(Aa,t.center,e.matrix),this.view.state.isGlobal&&(t.up=Ue(Aa,t.up,e.matrix)),this._constraintOptions.interactionType=Ut.PAN,this._constraintOptions.selection=wi.ALL,bs(this.view,t,this._constraintOptions))}_applyZoom(e){if(!e)return;const t=this.currentCamera.viewForward;this.currentCamera.eye=oe(Aa,this.currentCamera.eye,te(Le.get(),t,e)),re(aS,t),Wo(aS,aS),this._constraintOptions.interactionDirection=aS,this._constraintOptions.interactionType=Ut.ZOOM,this._constraintOptions.selection=wi.ALL_EXCEPT_COLLISION,bs(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const t=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Le.get());if(this._constraintOptions.interactionDirection=re(aS,t),this.view.state.isGlobal){const r=Se(this.currentCamera.eye),i=(r+e)/r;this.currentCamera.eye=te(Aa,this.currentCamera.eye,i),this.currentCamera.center=te(Aa,this.currentCamera.center,i)}else{const r=te(Le.get(),t,e);this.currentCamera.eye=oe(Aa,this.currentCamera.eye,r),this.currentCamera.center=oe(Aa,this.currentCamera.center,r)}this._updateCameraCenter(),this._constraintOptions.interactionType=Ut.ASCEND,this._constraintOptions.selection=wi.COLLISION,bs(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=wi.ALL_EXCEPT_COLLISION,bs(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,t,r){Eze(r);const i=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(i,t,r):this._calculateControlTransformationGlobal(i,t,r)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,t=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=t.intersectManifoldClosestSilhouette(r,e,Aa)}_calculateControlTransformationLocal(e,t,r){const{viewRight:i,viewForward:s}=t,n=this._transformation,o=this.view.navigation.gamepad,a=se(Le.get(),s[0],s[1],0);pe(a,a);const l=n.translation[0]*e.pan;if(l!==0){const y=te(Le.get(),i,l);Ja(r.pan.matrix,r.pan.matrix,y),r.pan.enabled=!0}switch(o.mode){case"pan":{const y=-n.translation[1]*e.pan;if(y!==0){const _=te(Le.get(),a,y);Ja(r.pan.matrix,r.pan.matrix,_),r.pan.enabled=!0}r.zoom=n.zoom*e.zoom;break}case"zoom":r.zoom=(-n.translation[1]+n.zoom)*e.zoom;break;default:o.mode}const c=n.translation[2]*e.ascend;r.ascend=c;const u=-n.heading*e.rotate;u!==0&&($l(r.rotate.matrix,r.rotate.matrix,u,this.view.renderCoordsHelper.worldUpAtPosition(t.eye,Le.get())),r.rotate.enabled=!0);const d=n.tilt*e.rotate,p=Cy(this.view.renderCoordsHelper,t.center,t.eye),g=fe(p+d,go.min,go.max)-p;g&&($l(r.rotate.matrix,r.rotate.matrix,g,i),r.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,t,r){const{eye:i,viewRight:s}=t,n=this._transformation,o=this.view.navigation.gamepad,a=rt(Le.get(),s,i);pe(a,a),Wo(a,a),nke(this.startCamera,t,n,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,r,o),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(n_.pan,this._tmpCamera);const l=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,c=n.translation[2]*e.ascend;r.ascend=c;const u=-n.heading*e.rotate;u!==0&&($l(r.rotate.matrix,r.rotate.matrix,u,this._tmpCamera.eye),r.rotate.enabled=!0);const d=n.tilt*e.rotate,p=this._clampTiltDeltaGlobalToValidRange(d,t.ray,l);p!==0&&($l(r.rotate.matrix,r.rotate.matrix,p,this._tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=n.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,t,r){const i=Mr(this.view.spatialReference),s=hI(go.min,t.origin,r,i);let n=0,o=0;const a=Le.get();if(this.view.renderCoordsHelper.intersectManifold(t,r,a)){const l=Cy(this.view.renderCoordsHelper,a,t.origin);n=hI(l,t.origin,r,i),o=hI(go.max,t.origin,r,i)}else{_2(EN(CN,r+i.radius),t,a);const l=Math.PI+SN(t.direction,a);n=sK(l,t.origin,r,i),o=sK(go.max,t.origin,r,i)}return fe(n+e,s,o)-n}_getPointAbsoluteSurfaceElevation(e,t,r){const{renderCoordsHelper:i}=this.view,s=i.getAltitude(e),n=t+Math.abs(s-t);return i.setAltitude(r,n,e),n}_clampedDistanceToSurface(e,t){const{renderCoordsHelper:r}=this.view,{camera:i}=this.view.state,{direction:s}=Fke(this.view,t,0,Jme,Sze),n=r.intersectManifoldClosestSilhouette(Fc(t,s),e,Le.get()),o=ni(t,n),a=r.intersectManifoldClosestSilhouette(Fc(t,Hm(Le.get(),t,i.center)),e,Le.get()),l=ni(t,a);return Math.min(o,l)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:t,state:r}=this.view,{camera:i,isGlobal:s}=r,n=t.intersectManifoldClosestSilhouette(i.ray,this._filteredSurfaceElevation,Le.get());if(s){const o=ce(Le.get(),e,n),a=Se(o);te(o,o,1/a);const l=pe(Le.get(),e),c=_n(de(l,o));return a*Math.sin(Math.min(bze,c))}{const o=re(Le.get(),e);return t.setAltitude(o,this._filteredSurfaceElevation),ni(n,o)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:wze}_computeVelocities(e){const t=this._filteredSurfaceElevation,r=t+Mr(this.view.spatialReference).radius,{camera:i,isGlobal:s}=this.view.state,n=Le.get(),o=this._getPointAbsoluteSurfaceElevation(i.eye,t,n),a=this._clampedDistanceToSurface(t,n),l=i.width/2,c=TK*i.width,u=TK*i.width,d=a*Math.tan(.5*i.fovX)/l,p=d/r,g=d/this._computeHeadingRotateRadius(n),y=o-t;return{pan:(s?p:d)*c*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(c*e/l)*y-y),zoom:2**(c*e/l)*a-a,rotate:fe(g*u,xze,Tze)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&Zu(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&Zu(e.rotate.matrix))}static activatesFor(e,t){const r=wK(t,e.navigation.gamepad,vze);return!(t.action==="end"||p6(r))}};h([f({constructOnly:!0})],$v.prototype,"gamepadDevice",void 0),h([f({constructOnly:!0})],$v.prototype,"disableMovements",void 0),$v=h([F("esri.views.3d.state.controllers.GamepadKeyboardController")],$v);const vze={translation:[0,0,0],heading:0,tilt:0,zoom:0},Jme=80,bze=Ot(Jme),TK=.75,wze=5,xze=Ot(30),Tze=Ot(80),n_={zoom:0,ascend:0,pan:{enabled:!1,matrix:be()},rotate:{enabled:!1,matrix:be()}},Aa=C(),aS=C(),Sze=Qj();function Eze(e){e.zoom=0,e.ascend=0,e.pan.enabled=!1,Zu(e.pan.matrix),e.rotate.enabled=!1,Zu(e.rotate.matrix)}class Cze extends ao{constructor(t){super(!0),this._view=t,this._watchHandles=new gi,this._handle=this.registerIncoming("gamepad",r=>this._handleEventGamepad(r)),this._handle.pause()}onInstall(t){super.onInstall(t),this._watchHandles.add([le(()=>this._view.navigation.gamepad.enabled,r=>{r?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},Rr),le(()=>this._view.navigation.gamepad.device,r=>{this._cameraControllerGamepad&&r&&this._cameraControllerGamepad.gamepadDevice!==r&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(t){const r=this._view.navigation.gamepad.device;if(r&&t.data.device!==r)return;const i=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(i||$v.activatesFor(this._view,t.data)){if(!i){const s=new $v({view:this._view,gamepadDevice:t.data.device});this._view.state.switchCameraController(s)&&(this._cameraControllerGamepad=s)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===t.data.device&&this._cameraControllerGamepad.handleEventGamepad(t.data)}}}var ml;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.FORWARD=2]="FORWARD",e[e.BACKWARD=3]="BACKWARD",e[e.UP=4]="UP",e[e.DOWN=5]="DOWN",e[e.HEADINGLEFT=6]="HEADINGLEFT",e[e.HEADINGRIGHT=7]="HEADINGRIGHT",e[e.TILTUP=8]="TILTUP",e[e.TILTDOWN=9]="TILTDOWN",e[e.ZOOMIN=10]="ZOOMIN",e[e.ZOOMOUT=11]="ZOOMOUT"})(ml||(ml={}));class Aze extends ao{constructor(t,r){super(!0),this._view=t,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Ie.Local},this._keyToNumber={[r.left]:ml.LEFT,[r.right]:ml.RIGHT,[r.forward]:ml.FORWARD,[r.backward]:ml.BACKWARD,[r.up]:ml.UP,[r.down]:ml.DOWN,[r.headingLeft]:ml.HEADINGLEFT,[r.headingRight]:ml.HEADINGRIGHT,[r.tiltUp]:ml.TILTUP,[r.tiltDown]:ml.TILTDOWN,[r.zoomIn]:ml.ZOOMIN,[r.zoomOut]:ml.ZOOMOUT},this.registerIncoming("key-down",null,i=>this._handleKeyDown(i)),this.registerIncoming("key-up",null,i=>this._handleKeyUp(i)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const r=this._keyToNumber[t.data.key];r!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new $v({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(r),t.stopPropagation()))}_handleBlur(){this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const r=this._keyToNumber[t.data.key];r!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(r),t.stopPropagation())}}class Oze extends ao{constructor(t,r){super(!0),this._view=t,this.registerIncoming("mouse-wheel",r,i=>this._handleMouseWheel(i))}_handleMouseWheel(t){if(!this._view.navigation.mouseWheelZoomEnabled)return;const r=t.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new PL({view:this._view,mode:"interaction"}):new ML({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*r.deltaY,zi(r.x,r.y)),t.preventDefault(),t.stopPropagation()}}class FL{constructor(t){this._gain=t}reset(t){this._value=t}set gain(t){this._gain=t}get value(){return this._value===void 0?0:this._value}update(t){this._value===void 0?this._value=t:this._value=this._gain*t+(1-this._gain)*this._value}}let N1=class extends GA{constructor(){super(...arguments),this._beginCamera=new lt,this._elapsedTimeSec=0,this.constraintOptions={selection:wi.ALL,interactionType:Ut.PAN,interactionFactor:0,interactionStartCamera:new lt,interactionDirection:null,tiltMode:Un.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new xT}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(e)}stepController(e,t){t.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,t),bs(this.view,t,this.constraintOptions)}};N1=h([F("esri.views.3d.state.controllers.momentum.MomentumController")],N1);let CC=class extends N1{constructor(e){super(e),this.interactionType=Ut.PAN,this._tmpPan=C()}momentumStep(e,t){const r=this.momentum.value(e);te(this._tmpPan,this.momentum.direction,r),t.eye=ce(SK,t.eye,this._tmpPan),t.center=ce(SK,t.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};h([f({constructOnly:!0})],CC.prototype,"momentum",void 0),CC=h([F("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],CC);const SK=C(),Rze=C(),VR=C();let pI=class extends N1{constructor(e){super(e),this.interactionType=Ut.PAN}momentumStep(e,t){const r=this.momentum.value1(e),i=this.momentum.value2(e);re(VR,t.eye),pe(VR,VR),rt(this.momentum.axis2,VR,this.momentum.axis1),Sme(t,Rze,this.momentum.axis1,r,this.momentum.axis2,i)}};h([f({constructOnly:!0})],pI.prototype,"momentum",void 0),pI=h([F("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],pI);let _v=class extends N1{set center(e){this._set("center",Ts(e))}set axis(e){this._set("axis",Ts(e))}constructor(e){super(e),this.interactionType=Ut.TUMBLE}momentumStep(e,t){const r=this.momentum.value(e);Ay(t,this.center,jA(this.axis,r))}};h([f({constructOnly:!0})],_v.prototype,"momentum",void 0),h([f({constructOnly:!0})],_v.prototype,"center",null),h([f({constructOnly:!0})],_v.prototype,"axis",null),_v=h([F("esri.views.3d.state.controllers.momentum.MomentumController")],_v);let dx=class extends N1{set zoomCenter(e){this._set("zoomCenter",Ts(e))}constructor(e){super(e),this.interactionType=Ut.ZOOM,this.constraintOptions.interactionDirection=C()}momentumStep(e,t){const{interactionDirection:r}=this.constraintOptions;if(!r)return;re(r,t.eye);const i=this.momentum.valueDelta(0,e);Zj(t,this.zoomCenter,i,this.view.state.constraints.minimumPoiDistance),Hm(r,t.eye,r)}};h([f({constructOnly:!0})],dx.prototype,"momentum",void 0),h([f({constructOnly:!0})],dx.prototype,"zoomCenter",null),dx=h([F("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],dx);let K_=class extends N1{set screenCenter(e){this._set("screenCenter",zi(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",Ts(e))}constructor(e){super(e),this.interactionType=Ut.ZOOM,this.radius=0,this._tmpSceneCenter=C(),this._tmpZoomAxisAngle=KN(),this._sphere=ls()}initialize(){this._sphere[3]=this.radius}momentumStep(e,t){const r=this.momentum.valueDelta(0,e);_me(this._sphere,t,r),this.constraintOptions.interactionType=Ut.ZOOM,bs(this.view,t,this.constraintOptions),HA(this._sphere,t,this.screenCenter,this._tmpSceneCenter),Wj(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),Ay(t,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=Ut.PAN}};h([f({constructOnly:!0})],K_.prototype,"momentum",void 0),h([f({constructOnly:!0})],K_.prototype,"screenCenter",null),h([f({constructOnly:!0})],K_.prototype,"sceneCenter",null),h([f({constructOnly:!0})],K_.prototype,"radius",void 0),K_=h([F("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],K_);class Kh{constructor(t){this._gain=t,this.lastValue=void 0,this.filteredDelta=void 0}update(t){if(this.hasLastValue()){const r=this.computeDelta(t);this._updateDelta(r)}this.lastValue=t}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(t){return this.lastValue===void 0?NaN:t-this.lastValue}_updateDelta(t){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*t:this.filteredDelta=t}}class i4{constructor(t,r,i){this._initialVelocity=t,this._stopVelocity=r,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(t){return t>this.duration}get friction(){return this._friction}value(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}valueDelta(t,r){const i=this.value(t);return this.value(t+r)-i}valueFromInitialVelocity(t,r){r=Math.min(r,this.duration);const i=1-this.friction;return t*(i**r-1)/Math.log(i)}}class Pze extends i4{constructor(t,r,i,s,n){super(t,r,i),this._sceneVelocity=s,this.direction=n}value(t){return super.valueFromInitialVelocity(this._sceneVelocity,t)}}class Kme{constructor(t=300,r=12,i=.84){this._minimumInitialVelocity=t,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._time=new Kh(.6),this._screen=[new Kh(.4),new Kh(.4)],this._scene=[new Kh(.6),new Kh(.6),new Kh(.6)],this._tmpDirection=C()}add(t,r,i){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(i)<.015)return;this._screen[0].update(t[0]),this._screen[1].update(t[1]),this._scene[0].update(r[0]),this._scene[1].update(r[1]),this._scene[2].update(r[2]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const t=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=t==null||r==null?0:Math.sqrt(t*t+r*r),s=this._time.filteredDelta,n=s==null||i==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(t,r,i){se(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const s=Se(this._tmpDirection);s>0&&te(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new Pze(t,r,i,n==null?0:s/n,this._tmpDirection)}}class EK{constructor(t){this._gain=t}update(t){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*t:this.filteredValue=t}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}}const CK=1e-5;class Mze extends i4{constructor(t,r,i,s,n,o=0,a){super(t,r,i),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(t){return super.valueFromInitialVelocity(this._angularVelocity1,t)}value2(t){return super.valueFromInitialVelocity(this.angularVelocity2,t)}}class Ize{constructor(t=300,r=12,i=.84){this._minimumInitialVelocity=t,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._tmpAxis1=C(),this._tmpAxis2=C(),this._tmpAngles=Ne(),this._time=new Kh(.3),this._screen=[new Kh(.4),new Kh(.4)],this._angle1=new EK(.6),this._angle2=new EK(.6),this._axis1=C(),this._axis2=C(),this._lastScene=C()}addMomentumDirectRotation(t,r,i,s,n,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;let a=xme(this._lastScene,r,this._tmpAxis2,s,n,o);this._angle2.update(0),Bo(this._tmpAxis2)<CK?a=0:pe(this._axis1,this._tmpAxis2),this._angle1.update(a),re(this._lastScene,r)}this._screen[0].update(t[0]),this._screen[1].update(t[1]),this._time.update(i)}}addMomentumPreserveHeading(t,r,i,s,n,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;Tme(this._lastScene,r,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,o,a,!1),Bo(this._tmpAxis2)<CK?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),pe(this._axis1,this._tmpAxis1),pe(this._axis2,this._tmpAxis2)),re(this._lastScene,r)}this._screen[0].update(t[0]),this._screen[1].update(t[1]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const t=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=t==null||r==null?null:Math.sqrt(t*t+r*r),s=this._time.filteredDelta,n=i==null||s==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(t,r,i){const s=this._time.filteredDelta,n=this._angle1.filteredValue,o=this._angle2.filteredValue,a=s==null||o==null?0:o/s;return new Mze(t,r,i,s==null||n==null?0:n/s,this._axis1,a,this._axis2)}}class Qme{constructor(t=2.5,r=.01,i=.95,s=12){this._minimumInitialVelocity=t,this._stopVelocity=r,this._friction=i,this._maxVelocity=s,this.enabled=!0,this.value=new Kh(.8),this.time=new Kh(.3)}add(t,r){if(this.enabled&&r!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(r)<.01)return;if(this.value.hasFilteredDelta()){const i=this.value.computeDelta(t);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(r),this.value.update(t)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let t=this.value.filteredDelta/this.time.filteredDelta;return t=fe(t,-this._maxVelocity,this._maxVelocity),Math.abs(t)<this._minimumInitialVelocity?null:this.createMomentum(t,this._stopVelocity,this._friction)}createMomentum(t,r,i){return new i4(t,r,i)}}class ege extends Qme{constructor(t=3,r=.01,i=.95,s=12){super(t,r,i,s)}add(t,r){const i=this.value.lastValue;if(i!=null){let s=t-i;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;t=i+s}super.add(t,r)}}class $ze extends i4{constructor(t,r,i){super(t,r,i)}value(t){const r=super.value(t);return Math.exp(r)}valueDelta(t,r){const i=super.value(t),s=super.value(t+r)-i;return Math.exp(s)}}class tge extends Qme{constructor(t=2.5,r=.01,i=.95,s=12){super(t,r,i,s)}add(t,r){super.add(Math.log(t),r)}createMomentum(t,r,i){return new $ze(t,r,i)}}let Hz=class extends Ip{constructor(){super(...arguments),this._smoothRotation=new FL(.05),this._rotationAxis=C(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=Sr(),this._beginRadius=0,this._smoothScaling=new FL(.05),this._zoomCenterScreen=zi(),this._zoomMomentumEstimator=new tge,this._rotationMomentumEstimator=new ege,this._panSphericalMomentumEstimator=new Ize,this._panPlanarMomentumEstimator=new Kme,this._adjustedSphere=ls(),this._tmp3d=C(),this._tmpScreenPointArray=zi(),this._beginScreenPoint=zi(),this._beginScenePoint=C(),this._screenPickPoint=zi(),this._scenePickPoint=C(),this._mode=Nn.Horizontal,this._sphere=ls(),this._pointerCount=0,this._tmpInteractionDirection=C(),this._constraintOptions={selection:wi.ALL,interactionType:Ut.NONE,interactionFactor:0,interactionStartCamera:new lt,interactionDirection:null,tiltMode:Un.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=t,this._rotationMomentumEstimator.enabled=t,this._panPlanarMomentumEstimator.enabled=t,this._panSphericalMomentumEstimator.enabled=t,this._beginHeading=-dy.normalize(Ot(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),Sp(e.center,this._screenPickPoint),en(this._beginScreenPoint,this._screenPickPoint);const r=Mr(this.view.spatialReference),i=bme(this._intersectionHelper,this.startCamera,this._screenPickPoint,r,UT.Silhouette,this.view.map.ground.opacity===0?ab:{});i.scenePickPoint!=null&&(this._scenePickPoint=i.scenePickPoint,this._sphere=i.sphere,re(this._beginScenePoint,this._scenePickPoint),this._mode=e4(this.startCamera,this._screenPickPoint,r),this._mode===Nn.Vertical&&this._preparePlanarPanMode(e,i.hasGeometryIntersection),this._constraintOptions.interactionStartCamera?.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1;this._mode===Nn.Horizontal?(t&&this._zoomSpherical(e),this._panningSpherical(e),t&&this._rotateSpherical(e)):(t&&this._zoomPlanar(e),this._panningPlanar(e),t&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const t=this._zoomMomentumEstimator.evaluateMomentum();if(t)return this._mode===Nn.Horizontal?new K_({view:this.view,momentum:t,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new dx({view:this.view,momentum:t,zoomCenter:this._beginScenePoint});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new _v({view:this.view,momentum:r,center:this._sphere,axis:this._rotationAxis});if(this._mode===Nn.Horizontal){const i=this._panSphericalMomentumEstimator.evaluateMomentum();if(i)return new pI({view:this.view,momentum:i})}else{const i=this._panPlanarMomentumEstimator.evaluateMomentum();if(i)return new CC({view:this.view,momentum:i})}return null}_preparePlanarPanMode(e,t){const r=Wo(this._tmp3d,this.startCamera.viewForward);B3(this._scenePickPoint,r,this._panningPlane);const i=zi(this._screenPickPoint[0],0),s=C(),n=Se(this.startCamera.eye);this._adjustedSphere[3]=n<this._sphere[3]?n-100:this._sphere[3],HA(this._adjustedSphere,this.startCamera,i,s);const o=xo();this.startCamera.projectToRenderScreen(s,o);const a=C(),l=C(),c=C();ce(a,this._scenePickPoint,this.currentCamera.eye);const u=Se(a);pe(a,a);const d=gme*Math.max(Math.abs(this.view.camera.position.z),yme),p=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,QN);let g=p??d;g=t?Math.min(g,u):g,re(c,oe(l,this.currentCamera.eye,te(l,a,g))),this._panningPlane[3]=-de(this._panningPlane,c),this.startCamera.center=oe(l,this.startCamera.eye,te(l,this.startCamera.viewForward,g));const y=Sp(e.center,this._tmpScreenPointArray);kz(this._panningPlane,this.startCamera,y,this._beginScenePoint)}_zoomSpherical(e){const t=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(t),_me(this._sphere,this.currentCamera,this._smoothScaling.value),Sp(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=Ut.ZOOM,this._constraintOptions.interactionFactor=Jh(e.radius-this._beginRadius),bs(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const t=Sp(e.center,this._tmpScreenPointArray);HA(this._sphere,this.currentCamera,t,this._tmp3d),Yj(this._beginScenePoint,de(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(Cme(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(t,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(Eme(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(t,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=Ut.PAN,this._constraintOptions.interactionFactor=Jh(x1(this._screenPickPoint,t)),bs(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){pe(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||Wo(this._rotationAxis,this._rotationAxis);const t=this._smoothRotation.value,r=t+Uz(e.angle-t),i=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=i,this._smoothRotation.update(r);const s=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(s,.001*e.timestamp),Ay(this.currentCamera,this._sphere,jA(this._rotationAxis,s)),this._constraintOptions.interactionType=Ut.TUMBLE,this._constraintOptions.interactionFactor=Jh(e.radius*r),bs(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const t=Sp(e.center,this._tmpScreenPointArray);kz(this._panningPlane,this.currentCamera,t,this._tmp3d)&&(wme(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(t,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=Ut.PAN,this._constraintOptions.interactionFactor=Jh(x1(this._beginScreenPoint,t)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),bs(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const t=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(t),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),Zj(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=Ut.ZOOM,this._constraintOptions.interactionFactor=Jh(e.radius-this._beginRadius),bs(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){re(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||Wo(this._rotationAxis,this._rotationAxis);const t=this._smoothRotation.value;let r=e.angle-t;r=Uz(r);const i=t+r,s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(i);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),Ay(this.currentCamera,this._sphere,jA(this._rotationAxis,n)),this._constraintOptions.interactionType=Ut.TUMBLE,this._constraintOptions.interactionFactor=Jh(e.radius*n),bs(this.view,this.currentCamera,this._constraintOptions)}};Hz=h([F("esri.views.3d.state.controllers.global.PinchAndPanController")],Hz);const AK=Ce(0,0,1),Lze={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let Wz=class extends Ip{constructor(){super(...arguments),this._rotationValueSmooth=new FL(.05),this._scalingValueSmooth=new FL(.05),this._planeHorizontal=Sr(),this._planeVertical=Sr(),this._rotationMomentumEstimator=new ege,this._panMomentumEstimator=new Kme(300,12,.9),this._zoomMomentumEstimator=new tge,this._beginRadius=0,this._beginCenter=C(),this._beginAngle=0,this._tmpPoints=[],this._panMode=Nn.Horizontal,this._beginCenterScreen=zi(),this._tmpCentroid3d=C(),this._tmpCentroid2d=zi(),this._tmp2d=zi(),this._pointerCount=0,this._constraintOptions={selection:wi.ALL,interactionType:Ut.NONE,interactionFactor:0,interactionStartCamera:new lt,interactionDirection:null,tiltMode:Un.TUMBLE}}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=t,this._rotationMomentumEstimator.enabled=t,this._panMomentumEstimator.enabled=t,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),Sp(e.center,this._beginCenterScreen),kde(AK,0,this._planeHorizontal);const r=C(),i=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,r,this.view.map.ground.opacity===0?ab:{}),s=C();Wo(s,this.startCamera.viewForward);const n=C();re(n,AK);const o=de(s,n),a=Hu(o<0?-o:o);this._panMode=a>=Lze.ANGLE_THRESHOLD?Nn.Horizontal:Nn.Vertical;const l=Math.min(gme,1/Math.abs(de(n,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),yme);Gk(this._planeHorizontal,this._planeHorizontal,r),this.startCamera.aboveGround||jk(this._planeHorizontal,this._planeHorizontal);const c=C(),u=C(),d=C();ce(c,r,this.currentCamera.eye);const p=Se(c);if(pe(c,c),this._panMode===Nn.Vertical){te(n,n,o),ce(this._planeVertical,s,n),pe(this._planeVertical,this._planeVertical),Gk(this._planeVertical,this._planeVertical,r);const g=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,QN);let y=g??l;y=i?Math.min(y,p):y,re(d,oe(u,this.currentCamera.eye,te(u,c,y))),this._planeVertical[3]=-de(this._planeVertical,d),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),r6(this._tmpPoints,this._beginCenter)}else{const g=i?p:l;re(d,oe(u,this.currentCamera.eye,te(u,c,g))),this._planeHorizontal[3]=-de(this._planeHorizontal,d),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),r6(this._tmpPoints,this._beginCenter)}this._constraintOptions.interactionStartCamera?.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1,r=this._panMode===Nn.Horizontal?this._planeHorizontal:this._planeVertical,i=this._beginCenter;if(t){const s=this._beginRadius/e.radius,n=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=n,this._scalingValueSmooth.update(s),Zj(this.currentCamera,i,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=Ut.ZOOM,this._constraintOptions.interactionFactor=Jh(Math.abs(e.radius-this._beginRadius)),bs(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,r,this.currentCamera,this._tmpPoints),r6(this._tmpPoints,this._tmpCentroid3d),Sp(e.center,this._tmpCentroid2d),wme(this.currentCamera,i,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=Ut.PAN,this._constraintOptions.interactionFactor=Jh(x1(this._beginCenterScreen,this._tmpCentroid2d)),bs(this.view,this.currentCamera,this._constraintOptions),t){const s=this._planeHorizontal,n=i,o=this._rotationValueSmooth.value,a=o+Uz(e.angle-o),l=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=l,this._rotationValueSmooth.update(a);const c=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(c,.001*e.timestamp),Ay(this.currentCamera,n,jA(s,c)),this._constraintOptions.interactionType=Ut.TUMBLE,this._constraintOptions.interactionFactor=Jh(Math.abs(e.radius*c)),bs(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const t=this._zoomMomentumEstimator.evaluateMomentum();if(t)return new dx({view:this.view,momentum:t,zoomCenter:this._beginCenter});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new _v({view:this.view,momentum:r,center:this._beginCenter,axis:this._planeHorizontal});const i=this._panMomentumEstimator.evaluateMomentum();return i?new CC({view:this.view,momentum:i}):null}_computePlanePoints(e,t,r,i){i.length=e.size;const s=this._tmp2d;let n=0;return e.forEach(o=>{s[0]=o.x,s[1]=o.y,i[n]===void 0&&(i[n]=C()),kz(t,r,s,i[n]),n+=1}),i}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};Wz=h([F("esri.views.3d.state.controllers.local.PinchAndPanController")],Wz);class OK extends ao{constructor(t,r,i){super(!0),this._view=t,this.pointerAction=r,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(t){if(t.data.pointerType==="mouse"&&!Kj(t.data,this.pointerAction))return;const r=t.timestamp-this._lastEndTimestamp,i=40,s=this._momentum&&this._momentum.active&&r<i;switch(t.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.active?t.data.timestamp-this._lastTimestamp>2&&(this._controller.update(t.data),this._lastTimestamp=t.timestamp):this._startController(t);break;case"end":case"removed":this._endController(t,!0);break;case"added":this._endController(t,!1),this._startController(t)}t.stopPropagation()}_endController(t,r){if(this._controller&&this._controller.active){this._lastEndTimestamp=t.timestamp;const i=this._controller.end(t.data);r&&i&&(this._momentum=i,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(t){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(t.data),this._lastTimestamp=t.timestamp}_createController(){return this._view.state.isGlobal?new Hz({view:this._view}):new Wz({view:this._view})}}class Dze extends ao{constructor(t,r){super(!0),this.view=t,this.registerIncoming("pointer-down",r,()=>this.view.state.stopActiveCameraController())}}class rge extends ao{constructor(t,r){super(!0),this.key=t,this.registerIncoming("key-down",r,i=>this._handleKeyDown(i))}_handleKeyDown(t){t.data.key===this.key&&(this.activate(),t.stopPropagation())}}class Nze extends rge{constructor(t,r,i){super(r,i),this.view=t}activate(){this.view.goTo({heading:0}).catch(()=>{})}}class Fze extends rge{constructor(t,r,i){super(r,i),this.view=t}activate(){this.view.goTo({tilt:0}).catch(()=>{})}}class Uze extends ao{constructor(t,r=!1){super(!0),this._view=t,this._invert=r,this.registerIncoming("vertical-two-finger-drag",i=>this._handleTwoFinger(i))}_handleTwoFinger(t){const r=this._invert?-1:1,i=zi(0,t.data.delta*r);switch(t.data.action){case"begin":this._cameraController?.end(),this._cameraController=new EC({view:this._view,pivot:Tl.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController?.update(i);break;case"end":this._cameraController?.end(),this._cameraController=null}}}function RK(e){const t=e.native;return t?{buttons:t.buttons.map(r=>r.pressed?r.value||1:0),axes:t.axes.map(r=>Bze(r,e.axisThreshold))}:{buttons:[],axes:[]}}function kze(e,t){if(e.axes.length!==t.axes.length||e.buttons.length!==t.buttons.length)return!1;for(let r=0;r<e.axes.length;r++)if(e.axes[r]!==t.axes[r])return!1;for(let r=0;r<e.buttons.length;r++)if(e.buttons[r]!==t.buttons[r])return!1;return!0}function zze(e){for(let t=0;t<e.axes.length;t++)if(e.axes[t]!==0)return!1;for(let t=0;t<e.buttons.length;t++)if(e.buttons[t]!==0)return!1;return!0}function Bze(e,t){const r=Math.abs(e);return r<t?0:Math.sign(e)*(r-t)/(1-t)}class Vze{constructor(t,r){this._element=t,this._input=r,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,RK(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const i="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=i&&s,this.supported&&(this._forEachGamepad(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(t){this._hasEventListeners!==t&&(this._hasEventListeners=t,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(t){this._callback=t}_connectGamepad(t){const r=new QG(t);r.deviceType!=="unknown"&&(this._inputDevices[t.index]=r,this._input.gamepad.devices.add(r)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=Qx({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const t=document.hasFocus(),r=this._element.contains(document.activeElement),i=this._input.gamepad.enabledFocusMode==="document"&&!t||this._input.gamepad.enabledFocusMode==="view"&&!r;this._forEachGamepad(s=>{const n=this._inputDevices[s.index];if(!n)return;const o=this._latestUpdate[s.index],a=RK(n),l=i||zze(a);o&&(o.timestamp===s.timestamp||!o.active&&l||kze(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_forEachGamepad(t){const r=window.navigator.getGamepads();for(let i=0;i<r.length;i++){const s=r[i];this._validate(s)&&t(s)}}_emitGamepadEvent(t,r,i){const s=this._latestUpdate[t.index],n=s&&s.active;if(!n&&!i)return;const o=!n&&i?"start":n&&i?"update":"end";this._latestUpdate[t.index]={timestamp:t.timestamp,state:r,active:i},this._callback&&this._callback({device:this._inputDevices[t.index],state:r,action:o})}_validate(t){if(!t||!t.connected)return!1;for(let r=0;r<t.axes.length;r++)if(isNaN(t.axes[r]))return!1;return!0}}const PK=ne("edge"),Gze=ne("chrome"),jze=ne("ff"),Hze=ne("safari"),MK="esri-view-surface",Mb={touchNone:`${MK}--touch-none`,touchPan:`${MK}--touch-pan`};class s4{constructor(t,r){this._input=r,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=t,t.getAttribute("tabindex")||t.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new Vze(t,this._input),this._gamepadSource.onEvent=i=>this._callback("gamepad",i)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(t=>{this._releasePointerCaptureSafe(t)}),this._gamepadSource=Re(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(t){this._browserTouchPanningEnabled=t,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(t){this._callback=t}set activeEvents(t){for(const r in this._active)if(!t||!t.has(r)){const i=this._active[r];this._element.removeEventListener(f6[r],i),delete this._active[r]}t&&t.forEach(r=>{if(!this._active[r]&&f6[r]){const i=(this._eventHandlers[r]||this._handleDefault).bind(this,r);this._element.addEventListener(f6[r],i),this._active[r]=i}}),this._gamepadSource.hasEventListeners=t?.has("gamepad")??!1}setPointerCapture(t,r){r?this._setPointerCatpureSafe(t.pointerId):(this._releasePointerCaptureSafe(t.pointerId),this._activePointerCaptures.delete(t.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?Mb.touchNone:Mb.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?Mb.touchPan:Mb.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(Mb.touchNone),this._element.classList.remove(Mb.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(t){try{this._element.setPointerCapture(t),this._activePointerCaptures.add(t)}catch{}}_releasePointerCaptureSafe(t){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(t))return;this._element.releasePointerCapture(t)}catch{}}_updateNormalizedPointerLikeEvent(t,r){const i=vpe(this._element,t);return s4.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),r.x=i.x,r.y=i.y,r}_handleKey(t,r){const i=yDe(r);i&&t==="key-up"&&this._keyDownState.delete(i);const s={native:r,key:i,repeat:!!i&&this._keyDownState.has(i)};i&&t==="key-down"&&this._keyDownState.add(s.key),this._callback(t,s)}_handlePointer(t,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});this._callback(t,i)}_handlePointerPreventDefault(t,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});r.preventDefault(),this._callback(t,i)}_handleMouseWheel(t,r){let i=r.deltaY;switch(r.deltaMode){case 0:PK&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}PK?i*=.7:Gze||Hze?i*=.6:jze&&(i*=1.375);const s=100,n=Math.abs(i);n>s&&(i=i/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,deltaY:i});this._callback(t,o)}_handlePointerCaptureLost(t,r){this._activePointerCaptures.delete(r.pointerId),this._handleDefault(t,r)}_handleDefault(t,r){const i={native:r};r.preventDefault(),this._callback(t,i)}_preventAltKeyDefault(t){t.key==="Alt"&&t.preventDefault()}_preventMultiTouchPanning(t){t.touches.length>1&&t.preventDefault()}}s4.test={disableSubpixelCoordinates:!1};const f6={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};class Wze extends ao{constructor(){super(!0),this.registerIncoming("context-menu",t=>{t.data.native.preventDefault()})}}function ige(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function qze(e,t){const r=t.x-e.x,i=t.y-e.y;return Math.sqrt(r*r+i*i)}function Xze(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:Xu()},e.length===0)return t;if(e.length===1)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(e.length===2){const[x,S]=e,[O,A]=[S.x-x.x,S.y-x.y];return t.radius=Math.sqrt(O*O+A*A)/2,t.center.x=(x.x+S.x)/2,t.center.y=(x.y+S.y)/2,t}let r=0,i=0;for(let x=0;x<e.length;x++)r+=e[x].x,i+=e[x].y;r/=e.length,i/=e.length;const s=e.map(x=>x.x-r),n=e.map(x=>x.y-i);let o=0,a=0,l=0,c=0,u=0,d=0,p=0;for(let x=0;x<s.length;x++){const S=s[x],O=n[x],A=S*S,$=O*O;o+=A,a+=$,l+=S*O,c+=A*S,u+=$*O,d+=S*$,p+=O*A}const g=.5*(c+d),y=.5*(u+p),_=o*a-l*l,v=(g*a-y*l)/_,w=(o*y-l*g)/_,T=Xu(v+r,w+i);return{radius:Math.sqrt(v*v+w*w+(o+a)/e.length),center:T}}function AC(e){const{native:t}=e,{pointerId:r,button:i,pointerType:s}=t;return s==="mouse"?`${r}:${i}`:`${s}`}class Zze extends ao{constructor(t){super(!1),this._navigationTouch=t,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(t,r,i,s){return{action:t,pointerType:this._pointerType,button:this._mouseButton,buttons:r.buttons,timestamp:s,pointers:Yze(this._activePointerMap),pointer:r,angle:i.angle,radius:i.radius,center:i.center}}_addPointer(t){const r=t.native.pointerId,i=GR(this._activePointerMap).angle,s={event:t,initialAngle:0,lastAngle:0};this._activePointerMap.set(r,s);const n=fI(s,sge(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(i)}_updatePointer(t){if(t&&t.x==null&&t.y==null)return;const r=t.native.pointerId,i=this._activePointerMap.get(r);i?i.event=t:this._addPointer(t)}_removePointer(t){const r=GR(this._activePointerMap).angle;this._activePointerMap.delete(t),this._updatePointerAngles(r)}_updatePointerAngles(t){const r=GR(this._activePointerMap);this._activePointerMap.forEach(i=>{i.initialAngle=fI(i,r)-t,i.lastAngle=fI(i,r)-t})}_emitEvent(t,r,i){const s=GR(this._activePointerMap);this._drag.emit(this._createPayload(t,r,s,i),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(t){const r=t.data.native.pointerId,i=t.timestamp;this._activePointerMap.get(r)&&(this._activePointerMap.size===1?(this._updatePointer(t.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",t.data,i),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(r)):(this._removePointer(r),this._emitEvent("removed",t.data,t.timestamp)))}_handlePointerDrag(t){const r=t.data,i=r.currentEvent,s=t.timestamp;switch(r.action){case"start":case"update":this._isDragging?this._activePointerMap.has(i.native.pointerId)?(this._updatePointer(i),!this._isCurrentDragSuppressed&&this._emitEvent("update",i,s)):(this._addPointer(i),this._emitEvent("added",i,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(i),this._pointerType=t.data.startEvent.pointerType,this._mouseButton=t.data.startEvent.button,this._startStateModifiers=t.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",i,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}}function sge(e){const t=[];return e.forEach(r=>{t.push(Xu(r.event.x,r.event.y))}),Xze(t)}function GR(e){const t=sge(e);let r=0;return e.forEach(i=>{let s=fI(i,t),n=s-i.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=i.lastAngle+n,i.lastAngle=s,r+=s-i.initialAngle}),r/=e.size||1,{angle:r,radius:t.radius,center:t.center}}function Yze(e){const t=new Map;return e.forEach((r,i)=>t.set(i,r.event)),t}function fI(e,t){const r=e.event,i=r.x-t.center.x,s=r.y-t.center.y;return Math.atan2(s,i)}var IK;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"})(IK||(IK={}));const Y0={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};class Jze extends ao{constructor(t=Y0.maximumDoubleClickDelay,r=Y0.maximumDoubleClickDistance,i=Y0.maximumDoubleTouchDelay,s=Y0.maximumDoubleTouchDistance,n=b3){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(t=>t.doubleClickTimer=xi(t.doubleClickTimer))}get hasPendingInputs(){return _o(this._pointerState,t=>t.doubleClickTimer!=null)}_clearDoubleClickTimer(t,r){const i=this._pointerState.get(t);i&&(i.doubleClickTimer=xi(i.doubleClickTimer),r&&this._click.emit(i.event.data,void 0,i.event.modifiers),this._pointerState.delete(t),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(t){const r=this._pointerState.get(t);r.pointerDownCount===1&&this._click.emit(r.event.data,void 0,r.event.modifiers),r.doubleClickTimer=null,this._pointerState.delete(t),this.refreshHasPendingInputs()}_getPointerId(t){const{pointerId:r,pointerType:i,button:s}=t.native;return i==="mouse"?`${r}:${s}`:`${i}`}_handleImmediateClick(t){const r=t.data,{pointerType:i}=r.native,s=this._getPointerId(r);if(!this._pointerState.has(s))return void this._startClick(t);const n=this._pointerState.get(s),{data:o,modifiers:a}=n.event,l=i==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;ige(o,r)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(t)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(t){const r=AC(t.data),i=this._pointerState.get(r);i&&(i.pointerDownCount+=1)}_startClick(t){const{data:r}=t,{native:{pointerType:i}}=r,s=AC(r),n=i==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n),a=1;this._pointerState.set(s,{event:t,doubleClickTimer:o,pointerDownCount:a}),this.refreshHasPendingInputs()}}class Kze extends ao{constructor(t=Y0.maximumDoubleClickDelay,r=Y0.maximumDoubleClickDistance,i=Y0.maximumDoubleTouchDelay,s=Y0.maximumDoubleTouchDistance,n=b3){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(t=>{t.immediateDoubleClick&&t.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(t){const r=t.data,i=AC(r);if(!this._pointerState.has(i)){const s={downButton:r.native.button,immediateDoubleClick:null};this._pointerState.set(i,s),this.startCapturingPointer(r.native)}}_handlePointerUp(t){const r=t.data,i=AC(r),s=this._pointerState.get(i);if(s&&s.downButton===r.native.button){const n=s.immediateDoubleClick;if(n){n.timeoutHandle.remove();const o=t.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;ige(n,t.data)>o?this._startImmediateDoubleClick(t,s):(this._immediateDoubleClick.emit(t.data,void 0,n.modifiers),this._removeState(r))}else this._startImmediateDoubleClick(t,s)}}_startImmediateDoubleClick(t,r){const i=t.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;r.immediateDoubleClick={x:t.data.x,y:t.data.y,modifiers:t.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(t.data),i)}}_removeState(t){const r=AC(t);this._pointerState.delete(r),this.stopCapturingPointer(t.native),this.refreshHasPendingInputs()}}const lS={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};class Qze extends ao{constructor(t=lS.maximumClickDelay,r=lS.movementUntilMouseDrag,i=lS.movementUntilPenDrag,s=lS.movementUntilTouchDrag,n=lS.holdDelay,o=b3){super(!1),this._maximumClickDelay=t,this._movementUntilMouseDrag=r,this._movementUntilPenDrag=i,this._movementUntilTouchDrag=s,this._holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(t=>{t.holdTimeout=xi(t.holdTimeout)}),super.onUninstall()}_handlePointerDown(t){const r=t.data,i=r.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(i);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,t.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const n={startEvent:r,previousEvent:r,startTimestamp:t.timestamp,isDragging:!1,downButton:r.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(i,n),this.startCapturingPointer(r.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(t)}_createPointerDragData(t,r,i){return{action:t,startEvent:r.startEvent,previousEvent:r.previousEvent,currentEvent:i}}_handlePointerMove(t){const r=t.data,i=r.native.pointerId,s=this._pointerState.get(i);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,r),void 0,s.modifiers):qze(r,s.startEvent)>this._getDragThreshold(r.native.pointerType)&&this._startDragging(t),s.previousEvent=r)}_getDragThreshold(t){switch(t){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(t){const r=t.data,i=r.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=t.modifiers,s.isDragging=!0,i===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,r)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),t.timestamp))})}_handlePointerLoss(t,r){const i=t.data,s=i.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,r==="pointer-up"?i:n.previousEvent),void 0,n.modifiers):r==="pointer-up"&&n.downButton===i.native.button&&t.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(s),this.stopCapturingPointer(i.native),this._pointerState.size===0&&this._moveHandle.pause())}}class eBe{constructor(t){this._callbacks=t,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(t){const r=t.data,i=r.pointers.size;switch(r.action){case"start":this._currentCount=i,this._emitStart(t);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(t);break;case"update":this._emitUpdate(t);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(t);break;case"end":this._emitEnd(t),this._currentCount=0}this._previousEvent=t}_emitStart(t){this._startEvent=t,this._callbacks.condition?.(this._currentCount,t)&&this._callbacks.start(this._currentCount,t,this._startEvent)}_emitUpdate(t){this._callbacks.condition?.(this._currentCount,t)&&this._callbacks.update(this._currentCount,t,this._startEvent)}_emitEnd(t){this._callbacks.condition?.(this._currentCount,t)&&this._callbacks.end(this._currentCount,t,this._startEvent),this._startEvent=null}}class tBe extends ao{constructor(t=20,r=40){super(!1),this._threshold=t,this._maxDelta=r,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new eBe({start:(i,s)=>this._observeStart(i,s),update:(i,s,n)=>this._observeUpdate(i,s,n),end:(i,s)=>this._observeEnd(s)}),this.registerIncoming("drag",i=>this._dragEventSeparator.handle(i))}get failed(){return this._state==="failed"}_observeStart(t,r){t===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),r.stopPropagation()),this._state=t===2?"ready":"failed"}_observeUpdate(t,r,i){if(this._state!=="failed"&&t===2)return this._state==="active"?(this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void r.stopPropagation()):void(this._checkMovementWithinLimits(r.data,i.data)?this._checkVerticalThresholdReached(r.data,i.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=r.data.center,this._artificalDrag.emit({action:"end",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),r.stopPropagation()):this._state="failed")}_observeEnd(t){this._state==="active"&&(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",t.stopPropagation())}_checkMovementWithinLimits(t,r){let i=-1/0,s=1/0,n=-1/0,o=1/0;for(const{x:_,y:v}of r.pointers.values())i=Math.max(i,_),s=Math.min(s,_),n=Math.max(n,v),o=Math.min(o,v);let a=-1/0,l=1/0,c=-1/0,u=1/0;for(const{x:_,y:v}of t.pointers.values())a=Math.max(a,_),l=Math.min(l,_),c=Math.max(c,v),u=Math.min(u,v);const d=i-s,p=n-o,g=a-l,y=c-u;return Math.abs(t.center.x-r.center.x)<this._threshold&&Math.abs(g-d)<=this._maxDelta&&Math.abs(y-p)<=this._maxDelta}_checkVerticalThresholdReached(t,r){let i=Math.abs(t.center.y-r.center.y);return t.pointers.forEach((s,n)=>{const o=r.pointers.get(n);i=Math.min(i,Math.abs(s.y-o.y))}),i>=this._threshold}}let Mh=class extends xe{constructor(){super(...arguments),this._handles=new gi}destroy(){this._handles=Re(this._handles),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){return!!this._inputManager?.updating}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=Re(this._inputManager)}connect(){const e=this.view;this._source=new s4(this.view.surface,e.input);const t=[new Kze,new Qze,new Jze,new Zze(this.view.navigation),new tBe],r=new ou({eventSource:this._source,recognizers:t});this._inputManager=r,r.installHandlers("prevent-context-menu",[new Wze],iy.INTERNAL),this._modeDragPan=new OK(e,"primary"),this._modeDragRotate=new d6(e,"secondary",Tl.CENTER),this._modeDragZoom=new _ze(e,"tertiary");const i={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};r.installHandlers("navigation",[new Dze(e),new dke(e),new Cze(e),new Aze(e,i.pan),new Oze(e),new Fze(e,i.resetTilt),new Nze(e,i.resetHeading),new d6(e,"primary",Tl.EYE,[i.lookAround]),new d6(e,"secondary",Tl.CENTER,[i.lookAround]),new OK(e,"tertiary",[i.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new Uze(e)],iy.INTERNAL),this.view.viewEvents.connect(r),this._updateMode(),this._handles.add(le(()=>this.view.navigation?.browserTouchPanEnabled,s=>{this._source.browserTouchPanningEnabled=!s},Rr))}_updateMode(){const e=this.mode,t=this.primaryDragAction,r=qz.get(e)?.get(t);r&&(this._modeDragPan&&(this._modeDragPan.pointerAction=r.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=r.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=r.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};h([f()],Mh.prototype,"view",void 0),h([f({value:"pan"})],Mh.prototype,"primaryDragAction",null),h([f({value:"default"})],Mh.prototype,"mode",null),h([f({readOnly:!0})],Mh.prototype,"updating",null),h([f()],Mh.prototype,"latestPointerType",null),h([f()],Mh.prototype,"latestPointerLocation",null),h([f()],Mh.prototype,"multiTouchActive",null),h([f()],Mh.prototype,"_inputManager",void 0),Mh=h([F("esri.views.3d.input.SceneInputManager")],Mh);const qz=new Map,m6=new Map,g6=new Map;m6.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),m6.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),g6.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),g6.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),qz.set("default",m6),qz.set("pro",g6);const rBe=Mh;let ds=class extends xe{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};h([f()],ds.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),h([f()],ds.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),h([f()],ds.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),h([f()],ds.prototype,"DECONFLICTOR_SHOW_GRID",void 0),h([f()],ds.prototype,"LABELS_SHOW_BORDER",void 0),h([f()],ds.prototype,"TEXT_SHOW_BASELINE",void 0),h([f()],ds.prototype,"TEXT_SHOW_BORDER",void 0),h([f()],ds.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),h([f()],ds.prototype,"OVERLAY_SHOW_CENTER",void 0),h([f()],ds.prototype,"SHOW_POI",void 0),h([f()],ds.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),h([f()],ds.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),h([f()],ds.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),h([f()],ds.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),h([f()],ds.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),h([f()],ds.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),h([f()],ds.prototype,"I3S_TREE_SHOW_TILES",void 0),h([f()],ds.prototype,"I3S_SHOW_MODIFICATIONS",void 0),h([f()],ds.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),h([f()],ds.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),h([f()],ds.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),h([f()],ds.prototype,"LINE_WIREFRAMES",void 0),ds=h([F("esri.views.3d.support.DebugFlags")],ds);const Kr=new ds;let dc,kx,Xz=!1,Zz=!1,Yz=!1,Jz=!1,OC=null;function iBe(e,t){if(!Zz||!kx)return;nge();const r=kx;let i=0;for(let s=0;s<e.accBinsNumX;s++)for(let n=0;n<e.accBinsNumY;n++){const o=e.accBins[s][e.accBinsNumY-1-n];i+=o.length;const a=s*e.accBinsSizeX,l=(s+1)*e.accBinsSizeX,c=n*e.accBinsSizeY,u=(n+1)*e.accBinsSizeY;r.fillText(o.length.toFixed(),a+5,c+15),oge(a,l,c,u,"blue")}r.fillText("total totalShownLabels: "+i,70,40),r.fillText("total visible labels: "+t.size,70,50),r.fillText("total numTests: "+e.accNumTests,70,30)}function sBe(e){Yz=Kr.DECONFLICTOR_SHOW_VISIBLE,Jz=Kr.DECONFLICTOR_SHOW_INVISIBLE,Xz=Yz||Jz,Zz=Kr.DECONFLICTOR_SHOW_GRID,OC=null,Xz||Zz?OC=()=>nBe(e):dc&&(dc.parentElement.removeChild(dc),dc=null)}function nge(){OC&&(OC(),OC=null)}function nBe(e){dc==null&&(dc=document.createElement("canvas"),dc.setAttribute("id","debugCanvas2d"),e.surface.parentElement.style.position="relative",e.surface.parentElement.appendChild(dc));const{state:t}=e,{camera:r,pixelRatio:i}=t,{width:s,height:n}=r,o=s*i,a=n*i;dc.setAttribute("width",`${o}px`),dc.setAttribute("height",`${a}px`),dc.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),kx=dc.getContext("2d"),kx.clearRect(0,0,s,n),kx.font="12px Arial"}function oge(e,t,r,i,s){nge();const n=dc.height,o=kx;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(e,n-r),o.lineTo(t,n-r),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.closePath()}function oBe(e,t){Xz&&(t&&Yz||!t&&Jz)&&oge(e.aabr[0],e.aabr[2],e.aabr[1],e.aabr[3],t?"green":"red")}var wo,$n;(function(e){e[e.USER=1]="USER",e[e.SCALE_RANGE=2]="SCALE_RANGE",e[e.FILTER=4]="FILTER",e[e.DECONFLICTION=8]="DECONFLICTION",e[e.ALL_GRAPHIC=15]="ALL_GRAPHIC",e[e.ALL_LABEL=255]="ALL_LABEL"})(wo||(wo={})),function(e){e[e.GRAPHIC=1]="GRAPHIC",e[e.LABEL=16]="LABEL"}($n||($n={}));function age(e,t){return new n4(e,hge,t)}function aBe(e,t){const{curvatureDependent:r,scaleStart:i,scaleFallOffRange:s}=hge;return new n4(e,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:y6.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:y6.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:s,minPixelSize:y6.minPixelSize},t)}function lBe(e){return Math.abs(e*e*e)}function lge(e,t,r){const i=r.parameters,s=r.paddingPixelsOverride;return cS.scale=Math.min(i.divisor/(t-i.offset),1),cS.factor=lBe(e),cS.minPixelSize=i.minPixelSize,cS.paddingPixels=s,cS}function cge(e,t){return e===0?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function aH(e,t){return Math.max(yt(e*t.scale,e,t.factor),cge(e,t))}function cBe(e,t,r){const i=lge(e,t,r);return i.minPixelSize=0,i.paddingPixels=0,aH(1,i)}function $K(e,t,r,i){i.scale=cBe(e,t,r),i.factor=0,i.minPixelSize=r.parameters.minPixelSize,i.paddingPixels=r.paddingPixelsOverride}function uge(e,t,r=[0,0]){const i=Math.min(Math.max(t.scale,cge(e[1],t)/Math.max(1e-5,e[1])),1);return r[0]=e[0]*i,r[1]=e[1]*i,r}function uBe(e,t,r,i){return aH(e,lge(t,r,i))}class n4{get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}constructor(t,r,i,s=hBe(),n){this._viewingMode=t,this._description=r,this._ellipsoidRadius=i,this.parameters=s,this._paddingPixelsOverride=n,this._viewingMode===Ie.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(t){return(!this.parameters||this.parameters.camera.fovY!==t.fovY||this.parameters.camera.distance!==t.distance)&&(this._calculateParameters(t,this._ellipsoidRadius,this.parameters),!0)}overridePadding(t){return t!==this.paddingPixelsOverride?new n4(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,t):this}_calculateParameters(t,r,i){const{scaleStart:s,scaleFallOffRange:n,minPixelSize:o}=this._description,{fovY:a,distance:l}=t,c=this._calculateCurvatureDependentParameters(t,r),u=this._coverageCompensation(t,r,c),{tiltAngle:d,scaleFallOffFactor:p}=c,g=Math.sin(d)*l,y=.5*Math.PI-d-a*(.5-s*u),_=g/Math.cos(y),v=y+a*n*u,w=(_-p*(g/Math.cos(v)))/(1-p);return i.camera.fovY=t.fovY,i.camera.distance=t.distance,i.offset=w,i.divisor=_-w,i.minPixelSize=o,i}_calculateCurvatureDependentParametersLocal(t,r,i=LK){return i.tiltAngle=this._description.curvatureDependent.min.tiltAngle,i.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,i}_calculateCurvatureDependentParametersGlobal(t,r,i=LK){const s=this._description.curvatureDependent,n=1+t.distance/r,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=fe((o-a)/(l-a),0,1),[u,d]=[s.min,s.max];return i.tiltAngle=yt(u.tiltAngle,d.tiltAngle,c),i.scaleFallOffFactor=yt(u.scaleFallOffFactor,d.scaleFallOffFactor,c),i}_surfaceCoverageCompensationLocal(t,r,i){return(t.fovY-i.tiltAngle)/t.fovY}_surfaceCoverageCompensationGlobal(t,r,i){const s=r*r,n=i.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=t,l=a*a+s-2*Math.cos(n)*a*r,c=Math.sqrt(l),u=Math.sqrt(l-s);return(Math.acos(u/c)-Math.asin(r/(c/Math.sin(n)))+.5*o)/o}}const hge={curvatureDependent:{min:{curvature:Ot(10),tiltAngle:Ot(12),scaleFallOffFactor:.5},max:{curvature:Ot(70),tiltAngle:Ot(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},y6={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function hBe(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const cS={scale:0,factor:0,minPixelSize:0,paddingPixels:0},LK={tiltAngle:0,scaleFallOffFactor:0};function dBe(e){return e instanceof Float32Array&&e.length>=16}function pBe(e){return Array.isArray(e)&&e.length>=16}function fBe(e){return dBe(e)||pBe(e)}function lH(e){e.vertex.code.add(b`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),e.vertex.code.add(b`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(b`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),e.vertex.code.add(b`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),e.vertex.code.add(b`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(b`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),e.vertex.code.add(b`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function mBe(e){e.uniforms.add(new Zt("screenSizePerspective",t=>dge(t.screenSizePerspective)))}function o4(e){e.uniforms.add(new Zt("screenSizePerspectiveAlignment",t=>dge(t.screenSizePerspectiveAlignment||t.screenSizePerspective)))}function dge(e){return pi(gBe,e.parameters.divisor,e.parameters.offset,e.parameters.minPixelSize,e.paddingPixelsOverride)}const gBe=Ht();var Si,Eu,RC,Zi,js;(function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"})(Si||(Si={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(Eu||(Eu={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(RC||(RC={})),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.Water=3]="Water",e[e.Occluded=4]="Occluded",e[e.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(Zi||(Zi={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(js||(js={}));class yBe{constructor(t,r){this.vec3=t,this.id=r}}function UL(e,t,r,i){return new yBe(Ce(e,t,r),i)}var da;(function(e){e[e.None=0]="None",e[e.ColorAndWater=1]="ColorAndWater",e[e.Highlight=2]="Highlight",e[e.Occluded=3]="Occluded",e[e.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"})(da||(da={}));const cH=1.3;class DK{get extent(){return this._extent}constructor(t,r){this.index=t,this.renderTargets=r,this._extent=Nt(),this.resolution=0,this.renderLocalOrigin=UL(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new _Be,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=t,this.validTargets=new Array(r.renderTargets.length).fill(!1)}getValidTexture(t){return this.validTargets[t]?this.renderTargets.getTarget(t).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(t){const r=t===da.ColorAndWater?this.renderTargets.getTarget(Zi.Color):t===da.Highlight?this.renderTargets.getTarget(Zi.Highlight):t===da.ObjectAndLayerIdColor?this.renderTargets.getTarget(Zi.ObjectAndLayerIdColor):this.renderTargets.getTarget(Zi.Occluded);return r?r.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(Zi.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(Zi.Color):null}getNormalTexture(t){const r=t===da.ColorAndWater?this.renderTargets.getTarget(Zi.Water):null;return r?r.getTexture():null}draw(t,r){const i=this.computeRenderTargetValidityBitfield();for(const s of this.renderTargets.renderTargets)s.type!==Zi.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[s.type]=t.drawTarget(this,s,r):this.validTargets[s.type]=!1;return i^this.computeRenderTargetValidityBitfield()?CT.CHANGED:CT.UNCHANGED}computeRenderTargetValidityBitfield(){const t=this.validTargets;return+t[Zi.Color]|+t[Zi.ColorNoRasterImage]<<1|+t[Zi.Highlight]<<2|+t[Zi.Water]<<3|+t[Zi.Occluded]<<4}setupGeometryViewsCyclical(t){this.setupGeometryViewsDirect();const r=.001*t.range;if(this._extent[0]-r<=t.min){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];B$(this._extent,t.range,0,i)}if(this._extent[2]+r>=t.max){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];B$(this._extent,-t.range,0,i)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,Im(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let t=0;t<this.canvasGeometries.numViews;t++){const r=this.canvasGeometries.extents[t];if(r[0]!==r[2]&&r[1]!==r[3])return!0}return!1}applyViewport(t){t.setViewport(this.index===Si.INNER?0:this.resolution,0,this.resolution,this.resolution)}}class _Be{constructor(){this.extents=[Nt(),Nt(),Nt()],this.numViews=0}}class pge extends es{constructor(t,r){super(t,"mat4",jr.Draw,(i,s,n)=>i.setUniformMatrix4fv(t,r(s,n)))}}function xd(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",wa):e.uniforms.add(new Rc("cameraPosition",(r,i)=>se(fge,i.camera.viewInverseTransposeMatrix[3]-r.origin[0],i.camera.viewInverseTransposeMatrix[7]-r.origin[1],i.camera.viewInverseTransposeMatrix[11]-r.origin[2])))}function Fl(e,t){if(!t.instancedDoublePrecision)return void e.uniforms.add(new Ci("proj",(i,s)=>s.camera.projectionMatrix),new pge("view",(i,s)=>Ja(NK,s.camera.viewMatrix,i.origin)),new Rc("localOrigin",i=>i.origin));const r=i=>se(fge,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]);e.uniforms.add(new Ci("proj",(i,s)=>s.camera.projectionMatrix),new Ci("view",(i,s)=>Ja(NK,s.camera.viewMatrix,r(s))),new Rt("localOrigin",(i,s)=>r(s)))}const NK=be(),fge=C();function zT(e){e.uniforms.add(new Ci("viewNormal",(t,r)=>r.camera.viewInverseTransposeMatrix))}function R2(e,t){e.uniforms.add(new Ae("pixelRatio",(r,i)=>i.camera.pixelRatio/(t.draped?cH:1)))}function mge(e,t){const r=e.vertex;t.hasVerticalOffset?(gge(r),t.hasScreenSizePerspective&&(e.include(lH),o4(r),xd(e.vertex,t)),r.code.add(b`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?b`vec3 worldNormal = normalize(worldPos + localOrigin);`:b`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?b`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:b`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(b`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const vBe=Ht();function gge(e){e.uniforms.add(new Zt("verticalOffset",(t,r)=>{const{minWorldLength:i,maxWorldLength:s,screenLength:n}=t.verticalOffset,o=Math.tan(.5*r.camera.fovY)/(.5*r.camera.fullViewport[3]),a=r.camera.pixelRatio||1;return pi(vBe,n*a,o,i,s)}))}function a4(e){e.uniforms.add(new Bp("alignPixelEnabled",(t,r)=>r.alignPixelEnabled)),e.code.add(b`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),e.code.add(b`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}var vl;(function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"})(vl||(vl={}));var Ha;function yge(e,t){e.include(lH),e.attributes.add(E.POSITION,"vec3"),e.attributes.add(E.NORMAL,"vec3"),e.attributes.add(E.AUXPOS1,"vec4");const r=e.vertex;Fl(r,t),xd(r,t),r.uniforms.add(new Zt("viewport",(i,s)=>s.camera.fullViewport),new Ae("polygonOffset",i=>i.shaderPolygonOffset),new Ae("cameraGroundRelative",(i,s)=>s.camera.aboveGround?1:-1),new Ae("renderTransparentlyOccludedHUD",(i,s)=>s.renderTransparentlyOccludedHUD===vl.Occluded?1:s.renderTransparentlyOccludedHUD===vl.NotOccluded?0:.75),new qe("hudVisibilityTexture",(i,s)=>s.hudVisibilityTexture)),t.hasVerticalOffset&&gge(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(b`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(b`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),t.draped&&!t.hasVerticalOffset||zT(r),t.draped||(r.uniforms.add(new Ae("perDistancePixelRatio",(i,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),r.code.add(b`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),t.screenCenterOffsetUnitsEnabled===Ha.Screen&&R2(r,t),t.hasScreenSizePerspective&&o4(r),r.code.add(b`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled===Ha.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?b`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled!==Ha.Screen?b`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled===Ha.Screen?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled===Ha.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),r.include(a4),r.code.add(b`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(e){e[e.World=0]="World",e[e.Screen=1]="Screen",e[e.COUNT=2]="COUNT"})(Ha||(Ha={}));const jR=Qs();function _ge(e,t,r,i,s,n){if(e.visible)if(e.boundingInfo){Ye(e.type===Ki.Mesh);const o=t.tolerance;vge(e.boundingInfo,r,i,o,s,n)}else{const o=e.indices.get(E.POSITION),a=e.vertexAttributes.get(E.POSITION);Y3(r,i,0,o.length/3,o,a,void 0,s,n)}}const bBe=C();function vge(e,t,r,i,s,n){if(e==null)return;const o=wge(t,r,bBe);if(Wue(jR,e.bbMin),que(jR,e.bbMax),s?.applyToAabb(jR),hH(jR,t,o,i)){const{primitiveIndices:a,indices:l,position:c}=e,u=a?a.length:l.length/3;if(u>SBe){const d=e.getChildren();if(d!==void 0){for(const p of d)vge(p,t,r,i,s,n);return}}Y3(t,r,0,u,l,c,a,s,n)}}const bge=C();function Y3(e,t,r,i,s,n,o,a,l){if(o)return wBe(e,t,r,i,s,n,o,a,l);const{data:c,stride:u}=n,d=e[0],p=e[1],g=e[2],y=t[0]-d,_=t[1]-p,v=t[2]-g;for(let w=r,T=3*r;w<i;++w){let x=u*s[T++],S=c[x++],O=c[x++],A=c[x];x=u*s[T++];let $=c[x++],P=c[x++],U=c[x];x=u*s[T++];let I=c[x++],L=c[x++],N=c[x];a!=null&&([S,O,A]=a.applyToVertex(S,O,A,w),[$,P,U]=a.applyToVertex($,P,U,w),[I,L,N]=a.applyToVertex(I,L,N,w));const Z=$-S,W=P-O,V=U-A,J=I-S,R=L-O,k=N-A,z=_*k-R*v,H=v*J-k*y,X=y*R-J*_,Y=Z*z+W*H+V*X;if(Math.abs(Y)<=Number.EPSILON)continue;const ee=d-S,me=p-O,$e=g-A,pt=ee*z+me*H+$e*X;if(Y>0){if(pt<0||pt>Y)continue}else if(pt>0||pt<Y)continue;const St=me*V-W*$e,it=$e*Z-V*ee,ft=ee*W-Z*me,ge=y*St+_*it+v*ft;if(Y>0){if(ge<0||pt+ge>Y)continue}else if(ge>0||pt+ge<Y)continue;const Ee=(J*St+R*it+k*ft)/Y;Ee>=0&&l(Ee,uH(Z,W,V,J,R,k,bge),w,!1)}}function wBe(e,t,r,i,s,n,o,a,l){const{data:c,stride:u}=n,d=e[0],p=e[1],g=e[2],y=t[0]-d,_=t[1]-p,v=t[2]-g;for(let w=r;w<i;++w){const T=o[w];let x=3*T,S=u*s[x++],O=c[S++],A=c[S++],$=c[S];S=u*s[x++];let P=c[S++],U=c[S++],I=c[S];S=u*s[x];let L=c[S++],N=c[S++],Z=c[S];a!=null&&([O,A,$]=a.applyToVertex(O,A,$,w),[P,U,I]=a.applyToVertex(P,U,I,w),[L,N,Z]=a.applyToVertex(L,N,Z,w));const W=P-O,V=U-A,J=I-$,R=L-O,k=N-A,z=Z-$,H=_*z-k*v,X=v*R-z*y,Y=y*k-R*_,ee=W*H+V*X+J*Y;if(Math.abs(ee)<=Number.EPSILON)continue;const me=d-O,$e=p-A,pt=g-$,St=me*H+$e*X+pt*Y;if(ee>0){if(St<0||St>ee)continue}else if(St>0||St<ee)continue;const it=$e*J-V*pt,ft=pt*W-J*me,ge=me*V-W*$e,Ee=y*it+_*ft+v*ge;if(ee>0){if(Ee<0||St+Ee>ee)continue}else if(Ee>0||St+Ee<ee)continue;const _t=(R*it+k*ft+z*ge)/ee;_t>=0&&l(_t,uH(W,V,J,R,k,z,bge),T,!1)}}const FK=C(),UK=C();function uH(e,t,r,i,s,n,o){return se(FK,e,t,r),se(UK,i,s,n),rt(o,FK,UK),pe(o,o),o}function wge(e,t,r){return se(r,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function hH(e,t,r,i){return dH(e,t,r,i,1/0)}function dH(e,t,r,i,s){const n=(e[0]-i-t[0])*r[0],o=(e[3]+i-t[0])*r[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(e[1]-i-t[1])*r[1],u=(e[4]+i-t[1])*r[1];if(l=Math.min(l,Math.max(c,u)),l<0||(a=Math.max(a,Math.min(c,u)),a>l))return!1;const d=(e[2]-i-t[2])*r[2],p=(e[5]+i-t[2])*r[2];return l=Math.min(l,Math.max(d,p)),!(l<0)&&(a=Math.max(a,Math.min(d,p)),!(a>l)&&a<s)}function xge(e,t,r,i,s){let n=(r.screenLength||0)*e.pixelRatio;s!=null&&(n=uBe(n,i,t,s));const o=n*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return fe(o*t,r.minWorldLength||0,r.maxWorldLength!=null?r.maxWorldLength:1/0)}function Tge(e,t){const r=t?Tge(t):{};for(const i in e){let s=e[i];s&&s.forEach&&(s=TBe(s)),s==null&&i in r||(r[i]=s)}return r}function xBe(e,t){let r=!1;for(const i in t){const s=t[i];s!==void 0&&(Array.isArray(s)?e[i]===null?(e[i]=s.slice(),r=!0):$V(e[i],s)&&(r=!0):e[i]!==s&&(r=!0,e[i]=s))}return r}function TBe(e){const t=[];return e.forEach(r=>t.push(r)),t}const Sge={multiply:1,ignore:2,replace:3,tint:4},SBe=1e3;class Fy extends W3{constructor(t,r){super(),this.type=Ki.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=dr,this._pp0=Ce(0,0,1),this._pp1=Ce(0,0,0),this._parameters=Tge(t,r),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(t){return!1}setParameters(t,r=!0){xBe(this._parameters,t)&&(this.validateParameters(this._parameters),r&&this.parametersChanged())}validateParameters(t){}get visible(){return this._visible}set visible(t){t!==this._visible&&(this._visible=t,this.parametersChanged())}shouldRender(t){return this.isVisible()&&this.isVisibleForOutput(t.output)&&(this.renderOccluded&t.renderOccludedMask)!=0}isVisibleForOutput(t){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(t){t!==this._renderPriority&&(this._renderPriority=t,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(t){t!==this._insertOrder&&(this._insertOrder=t,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){this.repository!=null&&this.repository.materialChanged(this)}intersectDraped(t,r,i,s,n,o){return this._pp0[0]=this._pp1[0]=s[0],this._pp0[1]=this._pp1[1]=s[1],this.intersect(t,r,i,this._pp0,this._pp1,n)}}class Ege extends W6e{constructor(t,r,i){super(r,i),this.camera=t}}var Ei;(function(e){e[e.None=0]="None",e[e.Occlude=1]="Occlude",e[e.Transparent=2]="Transparent",e[e.OccludeAndTransparent=4]="OccludeAndTransparent",e[e.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",e[e.Opaque=16]="Opaque"})(Ei||(Ei={}));class pH extends Wr{constructor(){super(...arguments),this.renderOccluded=Ei.Occlude}}class Cge{constructor(){this.factor=new kK,this.factorAlignment=new kK}}class kK{constructor(){this.scale=0,this.factor=0,this.minPixelSize=0,this.paddingPixels=0}}function fft(e,t,r,i,s=1){const n=r.typedBuffer,o=r.typedBufferStride,a=e.length;if(i*=o,s===1)for(let l=0;l<a;++l)n[i]=t[e[l]],i+=o;else for(let l=0;l<a;++l){const c=t[e[l]];for(let u=0;u<s;u++)n[i]=c,i+=o}}function zK(e,t,r,i){const s=r.typedBuffer,n=r.typedBufferStride,o=e.length;i*=n;for(let a=0;a<o;++a){const l=2*e[a];s[i]=t[l],s[i+1]=t[l+1],i+=n}}function Age(e,t,r,i,s){const n=r.typedBuffer,o=r.typedBufferStride,a=e.length;if(i*=o,s==null||s===1)for(let l=0;l<a;++l){const c=3*e[l];n[i]=t[c],n[i+1]=t[c+1],n[i+2]=t[c+2],i+=o}else for(let l=0;l<a;++l){const c=3*e[l];for(let u=0;u<s;++u)n[i]=t[c],n[i+1]=t[c+1],n[i+2]=t[c+2],i+=o}}function BT(e,t,r,i,s=1){const n=r.typedBuffer,o=r.typedBufferStride,a=e.length;if(i*=o,s===1)for(let l=0;l<a;++l){const c=4*e[l];n[i]=t[c],n[i+1]=t[c+1],n[i+2]=t[c+2],n[i+3]=t[c+3],i+=o}else for(let l=0;l<a;++l){const c=4*e[l];for(let u=0;u<s;++u)n[i]=t[c],n[i+1]=t[c+1],n[i+2]=t[c+2],n[i+3]=t[c+3],i+=o}}function BK(e,t,r){const i=e.typedBuffer,s=e.typedBufferStride;t*=s;for(let n=0;n<r;++n)i[t]=0,i[t+1]=0,i[t+2]=0,i[t+3]=0,t+=s}function fH(e,t,r,i,s,n=1){if(!r)return void Age(e,t,i,s,n);const o=i.typedBuffer,a=i.typedBufferStride,l=e.length,c=r[0],u=r[1],d=r[2],p=r[4],g=r[5],y=r[6],_=r[8],v=r[9],w=r[10],T=r[12],x=r[13],S=r[14];s*=a;let O=0,A=0,$=0;const P=vN(r)?U=>{O=t[U]+T,A=t[U+1]+x,$=t[U+2]+S}:U=>{const I=t[U],L=t[U+1],N=t[U+2];O=c*I+p*L+_*N+T,A=u*I+g*L+v*N+x,$=d*I+y*L+w*N+S};if(n===1)for(let U=0;U<l;++U)P(3*e[U]),o[s]=O,o[s+1]=A,o[s+2]=$,s+=a;else for(let U=0;U<l;++U){P(3*e[U]);for(let I=0;I<n;++I)o[s]=O,o[s+1]=A,o[s+2]=$,s+=a}}function mH(e,t,r,i,s,n=1){if(!r)return void Age(e,t,i,s,n);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=e.length,u=o[0],d=o[1],p=o[2],g=o[4],y=o[5],_=o[6],v=o[8],w=o[9],T=o[10],x=!xG(o),S=1e-6,O=1-S;s*=l;let A=0,$=0,P=0;const U=vN(o)?I=>{A=t[I],$=t[I+1],P=t[I+2]}:I=>{const L=t[I],N=t[I+1],Z=t[I+2];A=u*L+g*N+v*Z,$=d*L+y*N+w*Z,P=p*L+_*N+T*Z};if(n===1)if(x)for(let I=0;I<c;++I){U(3*e[I]);const L=A*A+$*$+P*P;if(L<O&&L>S){const N=1/Math.sqrt(L);a[s]=A*N,a[s+1]=$*N,a[s+2]=P*N}else a[s]=A,a[s+1]=$,a[s+2]=P;s+=l}else for(let I=0;I<c;++I)U(3*e[I]),a[s]=A,a[s+1]=$,a[s+2]=P,s+=l;else for(let I=0;I<c;++I){if(U(3*e[I]),x){const L=A*A+$*$+P*P;if(L<O&&L>S){const N=1/Math.sqrt(L);A*=N,$*=N,P*=N}}for(let L=0;L<n;++L)a[s]=A,a[s+1]=$,a[s+2]=P,s+=l}}function EBe(e,t,r,i,s,n=1){if(!r)return void BT(e,t,i,s,n);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=e.length,u=o[0],d=o[1],p=o[2],g=o[4],y=o[5],_=o[6],v=o[8],w=o[9],T=o[10],x=!xG(o),S=1e-6,O=1-S;if(s*=l,n===1)for(let A=0;A<c;++A){const $=4*e[A],P=t[$],U=t[$+1],I=t[$+2],L=t[$+3];let N=u*P+g*U+v*I,Z=d*P+y*U+w*I,W=p*P+_*U+T*I;if(x){const V=N*N+Z*Z+W*W;if(V<O&&V>S){const J=1/Math.sqrt(V);N*=J,Z*=J,W*=J}}a[s]=N,a[s+1]=Z,a[s+2]=W,a[s+3]=L,s+=l}else for(let A=0;A<c;++A){const $=4*e[A],P=t[$],U=t[$+1],I=t[$+2],L=t[$+3];let N=u*P+g*U+v*I,Z=d*P+y*U+w*I,W=p*P+_*U+T*I;if(x){const V=N*N+Z*Z+W*W;if(V<O&&V>S){const J=1/Math.sqrt(V);N*=J,Z*=J,W*=J}}for(let V=0;V<n;++V)a[s]=N,a[s+1]=Z,a[s+2]=W,a[s+3]=L,s+=l}}function Oge(e,t,r,i,s,n=1){const o=i.typedBuffer,a=i.typedBufferStride,l=e.length;if(s*=a,r!==t.length||r!==4)if(n!==1)if(r!==4)for(let c=0;c<l;++c){const u=3*e[c];for(let d=0;d<n;++d)o[s]=t[u],o[s+1]=t[u+1],o[s+2]=t[u+2],o[s+3]=255,s+=a}else for(let c=0;c<l;++c){const u=4*e[c];for(let d=0;d<n;++d)o[s]=t[u],o[s+1]=t[u+1],o[s+2]=t[u+2],o[s+3]=t[u+3],s+=a}else{if(r===4){for(let c=0;c<l;++c){const u=4*e[c];o[s]=t[u],o[s+1]=t[u+1],o[s+2]=t[u+2],o[s+3]=t[u+3],s+=a}return}for(let c=0;c<l;++c){const u=3*e[c];o[s]=t[u],o[s+1]=t[u+1],o[s+2]=t[u+2],o[s+3]=255,s+=a}}else{o[s]=t[0],o[s+1]=t[1],o[s+2]=t[2],o[s+3]=t[3];const c=new Uint32Array(i.typedBuffer.buffer,i.start),u=a/4,d=c[s/=4];s+=u;const p=l*n;for(let g=1;g<p;++g)c[s]=d,s+=u}}function CBe(e,t,r,i){const s=r.typedBuffer,n=r.typedBufferStride,o=e.length,a=t[0];i*=n;for(let l=0;l<o;++l)s[i]=a,i+=n}function Rge(e,t,r,i,s=1){const n=t.typedBuffer,o=t.typedBufferStride;if(i*=o,s===1)for(let a=0;a<r;++a)n[i]=e[0],n[i+1]=e[1],n[i+2]=e[2],n[i+3]=e[3],i+=o;else for(let a=0;a<r;++a)for(let l=0;l<s;++l)n[i]=e[0],n[i+1]=e[1],n[i+2]=e[2],n[i+3]=e[3],i+=o}function Pge(e,t,r,i,s,n){for(const o of t.fields.keys()){const a=e.vertexAttributes.get(o),l=e.indices.get(o);if(a&&l)Mge(o,a,l,r,i,s,n);else if(o===E.OBJECTANDLAYERIDCOLOR&&e.objectAndLayerIdColor!=null){const c=e.indices.get(E.POSITION);if(Ye(!!c,`No buffer view for ${o}`),c){const u=c.length,d=s.getField(o,zn);Rge(e.objectAndLayerIdColor,d,u,n)}}}}function Mge(e,t,r,i,s,n,o){switch(e){case E.POSITION:{Ye(t.size===3);const a=n.getField(e,Es);Ye(!!a,`No buffer view for ${e}`),a&&fH(r,t.data,i,a,o);break}case E.NORMAL:{Ye(t.size===3);const a=n.getField(e,Es);Ye(!!a,`No buffer view for ${e}`),a&&mH(r,t.data,s,a,o);break}case E.NORMALCOMPRESSED:{Ye(t.size===2);const a=n.getField(e,Ty);Ye(!!a,`No buffer view for ${e}`),a&&zK(r,t.data,a,o);break}case E.UV0:{Ye(t.size===2);const a=n.getField(e,bd);Ye(!!a,`No buffer view for ${e}`),a&&zK(r,t.data,a,o);break}case E.COLOR:case E.SYMBOLCOLOR:{const a=n.getField(e,zn);Ye(!!a,`No buffer view for ${e}`),Ye(t.size===3||t.size===4),!a||t.size!==3&&t.size!==4||Oge(r,t.data,t.size,a,o);break}case E.COLORFEATUREATTRIBUTE:{const a=n.getField(e,x2);Ye(!!a,`No buffer view for ${e}`),Ye(t.size===1),a&&t.size===1&&CBe(r,t.data,a,o);break}case E.TANGENT:{Ye(t.size===4);const a=n.getField(e,Gl);Ye(!!a,`No buffer view for ${e}`),a&&EBe(r,t.data,s,a,o);break}case E.PROFILERIGHT:case E.PROFILEUP:case E.PROFILEVERTEXANDNORMAL:case E.FEATUREVALUE:{Ye(t.size===4);const a=n.getField(e,Gl);Ye(!!a,`No buffer view for ${e}`),a&&BT(r,t.data,a,o)}}}function XA(e,t,r=0){const i=fe(e,0,RBe);for(let s=0;s<4;s++)t[r+s]=Math.floor(256*PBe(i*ABe[s]))}function gH(e,t=0){let r=0;for(let i=0;i<4;i++)r+=e[t+i]*OBe[i];return r}const ABe=[1,256,65536,16777216],OBe=[1/256,1/65536,1/16777216,1/4294967296],RBe=gH(new Uint8ClampedArray([255,255,255,255]));function PBe(e){return e-Math.floor(e)}async function Vm(e,t){const{data:r}=await ii(e,{responseType:"image",...t});return r}function MBe(){if(_6==null){const e=t=>$r(`esri/libs/basisu/${t}`);_6=ue(()=>import("./basis_transcoder.a89e9ff9.js"),[]).then(t=>t.b).then(({default:t})=>t({locateFile:e}).then(r=>(r.initializeBasis(),delete r.then,r)))}return _6}let _6;var vv;(function(e){e[e.ETC1_RGB=0]="ETC1_RGB",e[e.ETC2_RGBA=1]="ETC2_RGBA",e[e.BC1_RGB=2]="BC1_RGB",e[e.BC3_RGBA=3]="BC3_RGBA",e[e.BC4_R=4]="BC4_R",e[e.BC5_RG=5]="BC5_RG",e[e.BC7_M6_RGB=6]="BC7_M6_RGB",e[e.BC7_M5_RGBA=7]="BC7_M5_RGBA",e[e.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",e[e.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",e[e.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",e[e.ATC_RGB=11]="ATC_RGB",e[e.ATC_RGBA=12]="ATC_RGBA",e[e.FXT1_RGB=17]="FXT1_RGB",e[e.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",e[e.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",e[e.ETC2_EAC_R11=20]="ETC2_EAC_R11",e[e.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",e[e.RGBA32=13]="RGBA32",e[e.RGB565=14]="RGB565",e[e.BGR565=15]="BGR565",e[e.RGBA4444=16]="RGBA4444"})(vv||(vv={}));let dd=null,HR=null;async function Ige(){return HR==null&&(HR=MBe(),dd=await HR),HR}function IBe(e,t){if(dd==null)return e.byteLength;const r=new dd.BasisFile(new Uint8Array(e)),i=Lge(r)?$ge(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),t):0;return r.close(),r.delete(),i}function $Be(e,t){if(dd==null)return e.byteLength;const r=new dd.KTX2File(new Uint8Array(e)),i=Dge(r)?$ge(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),t):0;return r.close(),r.delete(),i}function $ge(e,t,r,i,s){const n=uj(t?is.COMPRESSED_RGBA8_ETC2_EAC:is.COMPRESSED_RGB8_ETC2),o=s&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(r*i*n*o)}function Lge(e){return e.getNumImages()>=1&&!e.isUASTC()}function Dge(e){return e.getFaces()>=1&&e.isETC1S()}async function LBe(e,t,r){dd==null&&(dd=await Ige());const i=new dd.BasisFile(new Uint8Array(r));if(!Lge(i))return null;i.startTranscoding();const s=Nge(e,t,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),(n,o)=>i.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>i.transcodeImage(a,0,n,o,0,0));return i.close(),i.delete(),s}async function DBe(e,t,r){dd==null&&(dd=await Ige());const i=new dd.KTX2File(new Uint8Array(r));if(!Dge(i))return null;i.startTranscoding();const s=Nge(e,t,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),(n,o)=>i.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>i.transcodeImage(a,n,0,0,o,0,-1,-1));return i.close(),i.delete(),s}function Nge(e,t,r,i,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=e.capabilities,[u,d]=l?i?[vv.ETC2_RGBA,is.COMPRESSED_RGBA8_ETC2_EAC]:[vv.ETC1_RGB,is.COMPRESSED_RGB8_ETC2]:c?i?[vv.BC3_RGBA,is.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[vv.BC1_RGB,is.COMPRESSED_RGB_S3TC_DXT1_EXT]:[vv.RGBA32,vt.RGBA],p=t.hasMipmap?r:Math.min(1,r),g=[];for(let y=0;y<p;y++)g.push(new Uint8Array(o(y,u))),a(y,u,g[y]);return t.internalFormat=d,t.hasMipmap=g.length>1,t.samplingMode=t.hasMipmap?xt.LINEAR_MIPMAP_LINEAR:xt.LINEAR,t.width=s,t.height=n,new wt(e,t,{type:"compressed",levels:g})}const WR=K.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),NBe=542327876,FBe=131072,UBe=4;function yH(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function kBe(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}const zBe=yH("DXT1"),BBe=yH("DXT3"),VBe=yH("DXT5"),GBe=31,jBe=0,HBe=1,WBe=2,qBe=3,XBe=4,ZBe=7,YBe=20,JBe=21;function KBe(e,t,r){const i=QBe(r,t.hasMipmap??!1);if(i==null)throw new Error("DDS texture data is null");const{textureData:s,internalFormat:n,width:o,height:a}=i;return t.samplingMode=s.levels.length>1?xt.LINEAR_MIPMAP_LINEAR:xt.LINEAR,t.hasMipmap=s.levels.length>1,t.internalFormat=n,t.width=o,t.height=a,new wt(e,t,s)}function QBe(e,t){const r=new Int32Array(e,0,GBe);if(r[jBe]!==NBe)return WR.error("Invalid magic number in DDS header"),null;if(!(r[YBe]&UBe))return WR.error("Unsupported format, must contain a FourCC code"),null;const i=r[JBe];let s,n;switch(i){case zBe:s=8,n=is.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case BBe:s=16,n=is.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case VBe:s=16,n=is.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return WR.error("Unsupported FourCC code:",kBe(i)),null}let o=1,a=r[XBe],l=r[qBe];(3&a)==0&&(3&l)==0||(WR.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,u=l;let d,p;r[WBe]&FBe&&t!==!1&&(o=Math.max(1,r[ZBe]));let g=r[HBe]+4;const y=[];for(let _=0;_<o;++_)p=(a+3>>2)*(l+3>>2)*s,d=new Uint8Array(e,g,p),y.push(d),g+=p,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:y},internalFormat:n,width:c,height:u}}class lb extends W3{constructor(t,r){super(),this._data=t,this.type=Ki.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new cs,this.parameters=r||{},this.parameters.mipmap=this.parameters.mipmap!==!1,this.parameters.noUnpackFlip=this.parameters.noUnpackFlip||!1,this.parameters.preMultiplyAlpha=this.parameters.preMultiplyAlpha||!1,this.parameters.wrap=this.parameters.wrap||{s:Ct.REPEAT,t:Ct.REPEAT},this._startPreload(t)}_startPreload(t){t!=null&&(t instanceof HTMLVideoElement?this._startPreloadVideoElement(t):t instanceof HTMLImageElement&&this._startPreloadImageElement(t))}_startPreloadVideoElement(t){if(!(tT(t.src)||t.preload==="auto"&&t.crossOrigin)){t.preload="auto",t.crossOrigin="anonymous";const r=!t.paused;if(t.src=t.src,r&&t.autoplay){const i=()=>{t.removeEventListener("canplay",i),t.play()};t.addEventListener("canplay",i)}}}_startPreloadImageElement(t){nf(t.src)||tT(t.src)||t.crossOrigin||(t.crossOrigin="anonymous",t.src=t.src)}dispose(){this._data=void 0}_createDescriptor(t){const r=new hr;return r.wrapMode=this.parameters.wrap??Ct.REPEAT,r.flipped=!this.parameters.noUnpackFlip,r.samplingMode=this.parameters.mipmap?xt.LINEAR_MIPMAP_LINEAR:xt.LINEAR,r.hasMipmap=!!this.parameters.mipmap,r.preMultiplyAlpha=!!this.parameters.preMultiplyAlpha,r.maxAnisotropy=this.parameters.maxAnisotropy??(this.parameters.mipmap?t.parameters.maxMaxAnisotropy:1),r}get glTexture(){return this._glTexture}get memoryEstimate(){return this._glTexture?.gpuMemoryUsage||eVe(this._data,this.parameters)}load(t){if(this._glTexture!=null)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const r=this._data;return r==null?(this._glTexture=new wt(t,this._createDescriptor(t),null),this._glTexture):typeof r=="string"?this._loadFromURL(t,r):r instanceof Image?this._loadFromImageElement(t,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(t,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(t,r):(BS(r)||D0(r))&&this.parameters.encoding===vm.DDS_ENCODING?(this._data=void 0,this._loadFromDDSData(t,r)):(BS(r)||D0(r))&&this.parameters.encoding===vm.KTX2_ENCODING?(this._data=void 0,this._loadFromKTX2(t,r)):(BS(r)||D0(r))&&this.parameters.encoding===vm.BASIS_ENCODING?(this._data=void 0,this._loadFromBasis(t,r)):D0(r)?this._loadFromPixelData(t,r):BS(r)?this._loadFromPixelData(t,new Uint8Array(r)):null}get requiresFrameUpdates(){return this._data instanceof HTMLVideoElement}frameUpdate(t){return this._data instanceof HTMLVideoElement&&this._glTexture!=null?this._data.readyState<PC.HAVE_CURRENT_DATA||t===this._data.currentTime?t:(this._glTexture.setData(this._data),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.parameters.updateCallback&&this.parameters.updateCallback(),this._data.currentTime):t}_loadFromDDSData(t,r){return this._glTexture=KBe(t,this._createDescriptor(t),r),this._glTexture}_loadFromKTX2(t,r){return this._loadAsync(()=>DBe(t,this._createDescriptor(t),r).then(i=>(this._glTexture=i,i)))}_loadFromBasis(t,r){return this._loadAsync(()=>LBe(t,this._createDescriptor(t),r).then(i=>(this._glTexture=i,i)))}_loadFromPixelData(t,r){Ye(this.parameters.width>0&&this.parameters.height>0);const i=this._createDescriptor(t);return i.pixelFormat=this.parameters.components===1?vt.LUMINANCE:this.parameters.components===3?vt.RGB:vt.RGBA,i.width=this.parameters.width??0,i.height=this.parameters.height??0,this._glTexture=new wt(t,i,r),this._glTexture}_loadFromURL(t,r){return this._loadAsync(async i=>{const s=await Vm(r,{signal:i});return Jt(i),this._loadFromImage(t,s)})}_loadFromImageElement(t,r){return r.complete?this._loadFromImage(t,r):this._loadAsync(async i=>{const s=await Foe(r,r.src,!1,i);return Jt(i),this._loadFromImage(t,s)})}_loadFromVideoElement(t,r){return r.readyState>=PC.HAVE_CURRENT_DATA?this._loadFromImage(t,r):this._loadFromVideoElementAsync(t,r)}_loadFromVideoElementAsync(t,r){return this._loadAsync(i=>new Promise((s,n)=>{const o=()=>{r.removeEventListener("loadeddata",a),r.removeEventListener("error",l),xi(c)},a=()=>{r.readyState>=PC.HAVE_CURRENT_DATA&&(o(),s(this._loadFromImage(t,r)))},l=u=>{o(),n(u||new G("Failed to load video"))};r.addEventListener("loadeddata",a),r.addEventListener("error",l);const c=Ws(i,()=>l(Cr()))}))}_loadFromImage(t,r){const i=Fge(r);this.parameters.width=i.width,this.parameters.height=i.height;const s=this._createDescriptor(t);return s.pixelFormat=this.parameters.components===3?vt.RGB:vt.RGBA,s.width=i.width,s.height=i.height,this._glTexture=new wt(t,s,r),this._glTexture}_loadAsync(t){const r=new AbortController;this._loadingController=r;const i=t(r.signal);this._loadingPromise=i;const s=()=>{this._loadingController===r&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(s,s),i}unload(){if(this._glTexture=De(this._glTexture),this._loadingController!=null){const t=this._loadingController;this._loadingController=null,this._loadingPromise=null,t.abort()}this.events.emit("unloaded")}}function eVe(e,t){if(e==null)return 0;if(BS(e)||D0(e))return t.encoding===vm.KTX2_ENCODING?$Be(e,!!t.mipmap):t.encoding===vm.BASIS_ENCODING?IBe(e,!!t.mipmap):e.byteLength;const{width:r,height:i}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?Fge(e):t;return(t.mipmap?4/3:1)*r*i*(t.components||4)||0}function Fge(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}var PC;(function(e){e[e.HAVE_NOTHING=0]="HAVE_NOTHING",e[e.HAVE_METADATA=1]="HAVE_METADATA",e[e.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",e[e.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",e[e.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(PC||(PC={}));const ZA=128,_H=.5;function tVe(e,t=ZA,r=t*_H,i=0){const s=Uge(e,t,r,i);return new lb(s,{mipmap:!1,wrap:{s:Ct.CLAMP_TO_EDGE,t:Ct.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0})}function Uge(e,t=ZA,r=t*_H,i=0){switch(e){case"circle":default:return rVe(t,r);case"square":return iVe(t,r);case"cross":return nVe(t,r,i);case"x":return oVe(t,r,i);case"kite":return sVe(t,r);case"triangle":return aVe(t,r);case"arrow":return lVe(t,r)}}function rVe(e,t){const r=e/2-.5;return J3(e,Bge(r,r,t/2))}function iVe(e,t){return kge(e,t,!1)}function sVe(e,t){return kge(e,t,!0)}function nVe(e,t,r=0){return zge(e,t,!1,r)}function oVe(e,t,r=0){return zge(e,t,!0,r)}function aVe(e,t){return J3(e,Vge(e/2,t,t/2))}function lVe(e,t){const r=t,i=t/2,s=e/2,n=.8*r,o=Bge(s,(e-t)/2-n,Math.sqrt(n*n+i*i)),a=Vge(s,r,i);return J3(e,(l,c)=>Math.max(a(l,c),-o(l,c)))}function kge(e,t,r){return r&&(t/=Math.SQRT2),J3(e,(i,s)=>{let n=i-.5*e+.25,o=.5*e-s-.75;if(r){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*t})}function zge(e,t,r,i=0){t-=i,r&&(t*=Math.SQRT2);const s=.5*t;return J3(e,(n,o)=>{let a,l=n-.5*e,c=.5*e-o-1;if(r){const u=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=u}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=i/2,a})}function Bge(e,t,r){return(i,s)=>{const n=i-e,o=s-t;return Math.sqrt(n*n+o*o)-r}}function Vge(e,t,r){const i=Math.sqrt(t*t+r*r);return(s,n)=>{const o=Math.abs(s-e)-r,a=n-e+t/2+.75,l=(t*o+r*a)/i,c=-a;return Math.max(l,c)}}function J3(e,t){const r=new Uint8Array(4*e*e);for(let i=0;i<e;i++)for(let s=0;s<e;s++){const n=s+e*i;let o=t(s,i);o=o/e+.5,XA(o,r,4*n)}return r}class mft extends Wr{constructor(t){super(),this.slicePlaneLocalOrigin=t}}function cVe(e,t){Gge(e,t,new Rt("slicePlaneOrigin",(r,i)=>qge(t,r,i)),new Rt("slicePlaneBasis1",(r,i)=>kL(t,r,i,i.slicePlane?.basis1)),new Rt("slicePlaneBasis2",(r,i)=>kL(t,r,i,i.slicePlane?.basis2)))}function os(e,t){Gge(e,t,new Rc("slicePlaneOrigin",(r,i)=>qge(t,r,i)),new Rc("slicePlaneBasis1",(r,i)=>kL(t,r,i,i.slicePlane?.basis1)),new Rc("slicePlaneBasis2",(r,i)=>kL(t,r,i,i.slicePlane?.basis2)))}function Gge(e,t,...r){if(!t.hasSlicePlane){const o=b`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return t.hasSliceInVertexProgram&&e.vertex.code.add(o),void e.fragment.code.add(o)}t.hasSliceInVertexProgram&&e.vertex.uniforms.add(...r),e.fragment.uniforms.add(...r);const i=b`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=b`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=t.hasSliceHighlight?b`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:b`#define highlightSlice(_color_, _pos_) (_color_)`;t.hasSliceInVertexProgram&&e.vertex.code.add(i),e.fragment.code.add(i),e.fragment.code.add(n)}function jge(e,t,r){return e.instancedDoublePrecision?se(uVe,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function Hge(e,t){return e!=null?ce(zL,t.origin,e):t.origin}function Wge(e,t,r){return e.hasSliceTranslatedView?t!=null?Ja(hVe,r.camera.viewMatrix,t):r.camera.viewMatrix:null}function qge(e,t,r){if(r.slicePlane==null)return wa;const i=jge(e,t,r),s=Hge(i,r.slicePlane),n=Wge(e,i,r);return n!=null?Ue(zL,s,n):s}function kL(e,t,r,i){if(i==null||r.slicePlane==null)return wa;const s=jge(e,t,r),n=Hge(s,r.slicePlane),o=Wge(e,s,r);return o!=null?(oe(uS,i,n),Ue(zL,n,o),Ue(uS,uS,o),ce(uS,uS,zL)):i}const uVe=C(),zL=C(),uS=C(),hVe=be();function K3(e,t){const r=t.output===D.ObjectAndLayerIdColor,i=t.objectAndLayerIdColorInstanced;r&&(e.varyings.add("objectAndLayerIdColorVarying","vec4"),i?e.attributes.add(E.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):e.attributes.add(E.OBJECTANDLAYERIDCOLOR,"vec4")),e.vertex.code.add(b`
     void forwardObjectAndLayerIdColor() {
      ${r?i?b`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:b`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:b``} }`),e.fragment.code.add(b`
      void outputObjectAndLayerIdColor() {
        ${r?b`fragColor = objectAndLayerIdColorVarying;`:b``} }`)}function dVe(e,t){const{vertex:r,fragment:i}=e;r.include(a4),t.hasMultipassGeometry&&r.include(xfe),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.code.add(b`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.hasMultipassGeometry?b`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${t.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.hasMultipassTerrain&&i.include(Uc),t.hasMultipassTerrain&&i.uniforms.add(new qe("terrainDepthTexture",(s,n)=>n.multipassTerrain.linearDepthTexture),new yr("nearFar",(s,n)=>n.camera.nearFar)),i.include(Hl),i.code.add(b`
  void main() {
    fragColor = vec4(1);
    ${t.hasMultipassTerrain?b`
          // Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          // Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            fragColor.g = 0.5;
          }`:""}
  }
  `)}const pVe=At(1,1,0,1),Xge=At(1,0,1,1);function ig(e){e.fragment.uniforms.add(new qe("depthTexture",(t,r)=>r.highlightDepthTexture)),e.fragment.constants.add("occludedHighlightFlag","vec4",pVe).add("unoccludedHighlightFlag","vec4",Xge),e.fragment.code.add(b`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}class Zge extends es{constructor(t,r,i){super(t,"vec4",jr.Pass,(s,n,o)=>s.setUniform4fv(t,r(n,o)),i)}}class Wa extends es{constructor(t,r,i){super(t,"float",jr.Pass,(s,n,o)=>s.setUniform1fv(t,r(n,o)),i)}}const VT={unknown:1,inches:mo(1,"meters","inches"),feet:mo(1,"meters","feet"),"us-feet":mo(1,"meters","us-feet"),yards:mo(1,"meters","yards"),miles:mo(1,"meters","miles"),"nautical-miles":mo(1,"meters","nautical-miles"),millimeters:mo(1,"meters","millimeters"),centimeters:mo(1,"meters","centimeters"),decimeters:mo(1,"meters","decimeters"),meters:mo(1,"meters","meters"),kilometers:mo(1,"meters","kilometers"),"decimal-degrees":1/qOe(1,"meters",Kt.radius)};var zo,VK;(function(e){e[e.Undefined=0]="Undefined",e[e.DefinedSize=1]="DefinedSize",e[e.DefinedScale=2]="DefinedScale"})(zo||(zo={})),function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle"}(VK||(VK={}));class vH{constructor(t){this.field=t}}class fVe extends vH{constructor(t){super(t),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[zo.Undefined,zo.Undefined,zo.Undefined]}}class mVe extends vH{constructor(t){super(t),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}}class gVe extends vH{constructor(t){super(t),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}}class yVe{}function hS(e){return e!=null}function Ib(e){return typeof e=="number"}function l4(e){return typeof e=="string"}function _Ve(e){return e==null||l4(e)}function qs(e,t){e&&e.push(t)}function vVe(e,t,r,i=be()){const s=e||0,n=t||0,o=r||0;return s!==0&&fT(i,i,-s/180*Math.PI),n!==0&&pT(i,i,n/180*Math.PI),o!==0&&yN(i,i,o/180*Math.PI),i}function Eg(e,t,r,i,s){const n=e.minSize,o=e.maxSize;if(e.expression)return qs(s,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){const a=i.symbolSize[r];return t.minSize[r]=a,t.maxSize[r]=a,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=zo.DefinedSize,!0}if(hS(e.field))return hS(e.stops)?e.stops.length===2&&Ib(e.stops[0].size)&&Ib(e.stops[1].size)?(GK(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,r),t.type[r]=zo.DefinedSize,!0):(qs(s,"Could not convert size info: stops only supported with 2 elements"),!1):Ib(n)&&Ib(o)&&hS(e.minDataValue)&&hS(e.maxDataValue)?(GK(n,o,e.minDataValue,e.maxDataValue,t,r),t.type[r]=zo.DefinedSize,!0):e.valueUnit==="unknown"?(qs(s,"Could not convert size info: proportional size not supported"),!1):VT[e.valueUnit]!=null?(t.minSize[r]=-1/0,t.maxSize[r]=1/0,t.offset[r]=0,t.factor[r]=1/VT[e.valueUnit],t.type[r]=zo.DefinedSize,!0):(qs(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!hS(e.field)){if(e.stops&&e.stops[0]&&Ib(e.stops[0].size))return t.minSize[r]=e.stops[0].size,t.maxSize[r]=e.stops[0].size,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=zo.DefinedSize,!0;if(Ib(n))return t.minSize[r]=n,t.maxSize[r]=n,t.offset[r]=n,t.factor[r]=0,t.type[r]=zo.DefinedSize,!0}return qs(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function GK(e,t,r,i,s,n){const o=Math.abs(i-r)>0?(t-e)/(i-r):0;s.minSize[n]=o>0?e:t,s.maxSize[n]=o>0?t:e,s.offset[n]=e-r*o,s.factor[n]=o}function bVe(e,t,r,i){if(e.normalizationField||e.valueRepresentation)return qs(i,"Could not convert size info: unsupported property"),null;if(!_Ve(e.field))return qs(i,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return qs(i,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size=new fVe(e.field);let s;switch(e.axis){case"width":return s=Eg(e,t.size,0,r,i),s?t:null;case"height":return s=Eg(e,t.size,2,r,i),s?t:null;case"depth":return s=Eg(e,t.size,1,r,i),s?t:null;case"width-and-depth":return s=Eg(e,t.size,0,r,i),s&&Eg(e,t.size,1,r,i),s?t:null;case null:case void 0:case"all":return s=Eg(e,t.size,0,r,i),s=s&&Eg(e,t.size,1,r,i),s=s&&Eg(e,t.size,2,r,i),s?t:null;default:return qs(i,`Could not convert size info: unknown axis "${e.axis}""`),null}}function wVe(e,t,r){for(let s=0;s<3;++s){let n=t.unitInMeters;e.type[s]===zo.DefinedSize&&(n*=t.modelSize[s],e.type[s]=zo.DefinedScale),e.minSize[s]=e.minSize[s]/n,e.maxSize[s]=e.maxSize[s]/n,e.offset[s]=e.offset[s]/n,e.factor[s]=e.factor[s]/n}let i;if(e.type[0]!==zo.Undefined)i=0;else if(e.type[1]!==zo.Undefined)i=1;else{if(e.type[2]===zo.Undefined)return qs(r,"No size axis contains a valid size or scale"),!1;i=2}for(let s=0;s<3;++s)e.type[s]===zo.Undefined&&(e.minSize[s]=e.minSize[i],e.maxSize[s]=e.maxSize[i],e.offset[s]=e.offset[i],e.factor[s]=e.factor[i],e.type[s]=e.type[i]);return!0}function jK(e,t,r){e[4*t]=r.r/255,e[4*t+1]=r.g/255,e[4*t+2]=r.b/255,e[4*t+3]=r.a}function xVe(e,t,r){if(e.normalizationField)return qs(r,"Could not convert color info: unsupported property"),null;if(l4(e.field)){if(!e.stops)return qs(r,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return qs(r,"Could not convert color info: too many color stops"),null;t.color=new mVe(e.field);const i=e.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];t.color.values[s]=n.value,jK(t.color.colors,s,n.color)}}}else{if(!(e.stops&&e.stops.length>=0))return qs(r,"Could not convert color info: no field and no colors/stops"),null;{const i=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.color.values[s]=1/0,jK(t.color.colors,s,i)}}return t}function TVe(e,t,r){if(e.normalizationField)return qs(r,"Could not convert opacity info: unsupported property"),null;if(l4(e.field)){if(!e.stops)return qs(r,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return qs(r,"Could not convert opacity info: too many opacity stops"),null;t.opacity=new gVe(e.field);const i=e.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];t.opacity.values[s]=n.value,t.opacity.opacityValues[s]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return qs(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=e.stops&&e.stops.length>=0?e.stops[0].opacity:0;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.opacity.values[s]=1/0,t.opacity.opacityValues[s]=i}}return t}function v6(e,t,r){const i=r===2&&e.rotationType==="arithmetic";t.offset[r]=i?90:0,t.factor[r]=i?-1:1,t.type[r]=1}function SVe(e,t,r){if(!l4(e.field))return qs(r,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return qs(r,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return v6(e,t.rotation,0),t;case"roll":return v6(e,t.rotation,1),t;case null:case void 0:case"heading":return v6(e,t.rotation,2),t;default:return qs(r,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}class Q3{constructor(t,r=[1,1,1],i=[1,1,1],s=1,n=[0,0,0],o=[1,1,1],a=[0,0,0]){this.supports=t,this.modelSize=r,this.symbolSize=i,this.unitInMeters=s,this.anchor=n,this.scale=o,this.rotation=a}}function Yge(e,t,r){if(!e)return null;const i=e.reduce((s,n)=>{if(!s)return s;if(n.valueExpression)return qs(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(n.type){case"size":return t.supports.size?bVe(n,s,t,r):s;case"color":return t.supports.color?xVe(n,s,r):s;case"opacity":return t.supports.opacity?TVe(n,s,r):null;case"rotation":return t.supports.rotation?SVe(n,s,r):s;default:return null}},new yVe);return!(e.length>0&&i)||i.size||i.color||i.opacity||i.rotation?i&&i.size&&!wVe(i.size,t,r)?null:i:null}class EVe{constructor(t,r,i){this.visualVariables=t,this.materialParameters=r,this.requiresShaderTransformation=i}}function GT(e,t){if(!e||Kr.TESTS_DISABLE_FAST_UPDATES)return null;const r=Yge(e.visualVariables,t);return r?new EVe(r,Kge(r,t),!!r.size):null}function jT(e,t,r){if(!t||!e)return!1;const i=e.visualVariables,s=Yge(t.visualVariables,r);return!!s&&!!(qR(i.size,s.size,"size")&&qR(i.color,s.color,"color")&&qR(i.rotation,s.rotation,"rotation")&&qR(i.opacity,s.opacity,"opacity"))&&(e.visualVariables=s,e.materialParameters=Kge(s,r),e.requiresShaderTransformation=!!s.size,!0)}function qR(e,t,r){if(!!e!=!!t||e&&e.field!==t?.field)return!1;if(e&&r==="rotation"){const i=e,s=t;for(let n=0;n<3;n++)if(i.type[n]!==s.type[n]||i.offset[n]!==s.offset[n]||i.factor[n]!==s.factor[n])return!1}return!0}class Jge extends Wr{constructor(t){super(),this.vvSize=t?.size??null,this.vvColor=t?.color??null,this.vvOpacity=t?.opacity??null}}function Kge(e,t){const r=new Jge(e);return r.vvSize&&(r.vvSymbolAnchor=t.anchor,Zu(MC),vVe(t.rotation[2],t.rotation[0],t.rotation[1],MC),r.vvSymbolRotationMatrix=r.vvSymbolRotationMatrix||$i(),Ku(r.vvSymbolRotationMatrix,MC)),r}function Kz(e,t,r){if(!e.vvSize)return r;Ss(Cg,r);const i=e.vvSymbolRotationMatrix;uf(MC,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),Jr(Cg,Cg,MC);for(let s=0;s<3;++s){const n=e.vvSize.offset[s]+t[0]*e.vvSize.factor[s];HK[s]=fe(n,e.vvSize.minSize[s],e.vvSize.maxSize[s])}return gN(Cg,Cg,HK),Ja(Cg,Cg,e.vvSymbolAnchor),Cg}function CVe(e,t,r){if(t.vvSize)for(let i=0;i<3;++i){const s=t.vvSize.offset[i]+r[0]*t.vvSize.factor[i];e[i]=fe(s,t.vvSize.minSize[i],t.vvSize.maxSize[i])}else se(e,1,1,1)}function pd(e,t){const r=e==null?0:t.attributes[e];return typeof r=="number"&&isFinite(r)?r:0}const Cg=be(),HK=C(),MC=be();class eO extends Jge{constructor(){super(...arguments),this.renderOccluded=Ei.Occlude}}const zx=8;function wm(e,t){const{vertex:r,attributes:i}=e;t.hasVvInstancing&&(t.vvSize||t.vvColor)&&i.add(E.INSTANCEFEATUREATTRIBUTE,"vec4"),t.vvSize?(r.uniforms.add(new Rt("vvSizeMinSize",s=>s.vvSize.minSize)),r.uniforms.add(new Rt("vvSizeMaxSize",s=>s.vvSize.maxSize)),r.uniforms.add(new Rt("vvSizeOffset",s=>s.vvSize.offset)),r.uniforms.add(new Rt("vvSizeFactor",s=>s.vvSize.factor)),r.uniforms.add(new sh("vvSymbolRotationMatrix",s=>s.vvSymbolRotationMatrix)),r.uniforms.add(new Rt("vvSymbolAnchor",s=>s.vvSymbolAnchor)),r.code.add(b`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),r.code.add(b`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.hasVvInstancing?b`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.code.add(b`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(r.constants.add("vvColorNumber","int",zx),r.uniforms.add(new Wa("vvColorValues",s=>s.vvColor.values,zx),new Zge("vvColorColors",s=>s.vvColor.colors,zx)),r.code.add(b`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${t.hasVvInstancing?b`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):r.code.add(b`vec4 vvColor() { return vec4(1.0); }`)}const BL=.1,to=.001;function AVe(e){const t=new pr,r=e.signedDistanceFieldEnabled;if(t.include(yge,e),t.include(os,e),e.occlusionPass)return t.include(dVe,e),t;const{vertex:i,fragment:s}=t;t.include(lH),s.include(Hl),s.include(df),t.include(wm,e),t.include(K3,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),i.uniforms.add(new Zt("viewport",(c,u)=>u.camera.fullViewport),new yr("screenOffset",(c,u)=>Qt(Qge,2*c.screenOffset[0]*u.camera.pixelRatio,2*c.screenOffset[1]*u.camera.pixelRatio)),new yr("anchorPosition",c=>VL(c)),new Zt("materialColor",c=>c.color)),R2(i,e),r&&(i.uniforms.add(new Zt("outlineColor",c=>c.outlineColor)),s.uniforms.add(new Zt("outlineColor",c=>WK(c)?c.outlineColor:Up),new Ae("outlineSize",c=>WK(c)?c.outlineSize:0))),e.hasScreenSizePerspective&&(mBe(i),o4(i)),(e.debugDrawLabelBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(E.UV0,"vec2"),t.attributes.add(E.COLOR,"vec4"),t.attributes.add(E.SIZE,"vec2"),t.attributes.add(E.AUXPOS2,"vec4"),i.code.add(b`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.hasScreenSizePerspective?b`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:b`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const n=b`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`;e.pixelSnappingEnabled&&i.include(a4);const o=e.pixelSnappingEnabled?r?b`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:b`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:b`posProj += quadOffset;`;i.code.add(b`
    ${e.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${e.vvColor?"vcolor = interpolateVVColor(auxpos2.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${e.output===D.ObjectAndLayerIdColor?b`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${b.float(to)};
    ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${b.float(to)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv;

    ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${e.occlusionTestEnabled?b`} else { vtc = vec2(0.0);
      ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new qe("tex",c=>c.texture));const a=e.debugDrawLabelBorder?b`(isBorder > 0.0 ? 0.0 : ${b.float(BL)})`:b.float(BL),l=b`
    ${e.debugDrawLabelBorder?b`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${r?b`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${b.float(ZA)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${b.float(to)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:b`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${e.debugDrawLabelBorder?b`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return e.output===D.Alpha&&s.code.add(b`
      void main() {
        ${l}
        fragColor = vec4(fragColor.a);
      }
      `),e.output===D.ObjectAndLayerIdColor&&s.code.add(b`
      void main() {
        ${l}
        outputObjectAndLayerIdColor();
      }
      `),e.output===D.Color&&s.code.add(b`
    void main() {
      ${l}
      ${e.transparencyPassType===tt.FrontFace?"fragColor.rgb /= fragColor.a;":""}
    }
    `),e.output===D.Highlight&&(t.include(ig,e),s.code.add(b`
    void main() {
      ${l}
      ${e.binaryHighlightOcclusionEnabled?b`
          if (voccluded == 1.0) {
            fragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            fragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function WK(e){return e.outlineColor[3]>0&&e.outlineSize>0}function VL(e,t=Qge){return e.textureIsSignedDistanceField?OVe(e.anchorPosition,e.distanceFieldBoundingBox,t):en(t,e.anchorPosition),t}function OVe(e,t,r){t!=null?Qt(r,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):Qt(r,0,0)}const Qge=Ne(),RVe=Object.freeze(Object.defineProperty({__proto__:null,build:AVe,calculateAnchorPosForRendering:VL},Symbol.toStringTag,{value:"Module"})),Pc=oo(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),PVe=Vl(ve.ONE,ve.ONE),e0e=Vl(ve.ZERO,ve.ONE_MINUS_SRC_ALPHA);function sg(e){return e===tt.FrontFace?null:e===tt.Alpha?e0e:PVe}function c4(e){return e===tt.FrontFace?Ka:null}const u4=5e5,h4={factor:-1,units:-2};function d4(e){return e?h4:null}function Uy(e,t=Hr.LESS){return e===tt.NONE||e===tt.FrontFace?t:Hr.LEQUAL}class p4 extends xr{initializeConfiguration(t,r){r.spherical=t.viewingMode===Ie.Global}initializeProgram(t){return new vr(t.rctx,p4.shader.get().build(this.configuration),dr)}_setPipelineState(t){const r=this.configuration,i=t===tt.NONE,s=t===tt.FrontFace,n=this.configuration.hasPolygonOffset?MVe:null,o=(i||s)&&r.output!==D.Highlight&&(r.depthEnabled||r.occlusionPass)?Ka:null;return Tt({blending:r.output===D.Color||r.output===D.Alpha||r.output===D.Highlight?i?IVe:sg(t):null,depthTest:{func:Hr.LEQUAL},depthWrite:o,colorWrite:It,polygonOffset:n})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.occlusionPass?bt.POINTS:bt.TRIANGLES}}p4.shader=new _r(RVe,()=>ue(()=>import("./HUDMaterial.glsl.6695c522.js"),[]));const MVe={factor:0,units:-4},IVe=Vl(ve.ONE,ve.ONE_MINUS_SRC_ALPHA);class ps extends bo{constructor(){super(...arguments),this.output=D.Color,this.screenCenterOffsetUnitsEnabled=Ha.World,this.transparencyPassType=tt.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}}h([B({count:D.COUNT})],ps.prototype,"output",void 0),h([B({count:Ha.COUNT})],ps.prototype,"screenCenterOffsetUnitsEnabled",void 0),h([B({count:tt.COUNT})],ps.prototype,"transparencyPassType",void 0),h([B()],ps.prototype,"spherical",void 0),h([B()],ps.prototype,"occlusionTestEnabled",void 0),h([B()],ps.prototype,"signedDistanceFieldEnabled",void 0),h([B()],ps.prototype,"vvSize",void 0),h([B()],ps.prototype,"vvColor",void 0),h([B()],ps.prototype,"hasVerticalOffset",void 0),h([B()],ps.prototype,"hasScreenSizePerspective",void 0),h([B()],ps.prototype,"debugDrawLabelBorder",void 0),h([B()],ps.prototype,"binaryHighlightOcclusionEnabled",void 0),h([B()],ps.prototype,"hasSlicePlane",void 0),h([B()],ps.prototype,"hasPolygonOffset",void 0),h([B()],ps.prototype,"depthEnabled",void 0),h([B()],ps.prototype,"pixelSnappingEnabled",void 0),h([B()],ps.prototype,"draped",void 0),h([B()],ps.prototype,"hasMultipassGeometry",void 0),h([B()],ps.prototype,"hasMultipassTerrain",void 0),h([B()],ps.prototype,"cullAboveGround",void 0),h([B()],ps.prototype,"occlusionPass",void 0),h([B()],ps.prototype,"objectAndLayerIdColorInstanced",void 0),h([B({constValue:!0})],ps.prototype,"hasSliceInVertexProgram",void 0),h([B({constValue:!1})],ps.prototype,"hasVvInstancing",void 0);class HT extends Fy{constructor(t){super(t,new VVe),this._configuration=new ps}getConfiguration(t,r){return this._configuration.output=t,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Ha.Screen:Ha.World,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=r.slot===ae.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(t===D.Color||t===D.Alpha),t===D.Color&&(this._configuration.debugDrawLabelBorder=!!Kr.LABELS_SHOW_BORDER),t===D.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(t,r,i,s,n,o){if(!i.options.selectionMode||!i.options.hud||!t.visible)return;const a=this.parameters;let l=1,c=1;if(Ku(w6,r),t.shaderTransformer!=null){const T=t.shaderTransformer(ZK);l=T[0],c=T[5],DVe(w6)}const u=t.vertexAttributes.get(E.POSITION),d=t.vertexAttributes.get(E.SIZE),p=t.vertexAttributes.get(E.NORMAL),g=t.vertexAttributes.get(E.AUXPOS1);Ye(u.size>=3);const y=i.point,_=i.camera,v=VL(a);l*=_.pixelRatio,c*=_.pixelRatio;const w=this.parameters.centerOffsetUnits==="screen";for(let T=0;T<u.data.length/u.size;T++){const x=T*u.size;se(Ro,u.data[x],u.data[x+1],u.data[x+2]),Ue(Ro,Ro,r);const S=T*d.size;Ag[0]=d.data[S]*l,Ag[1]=d.data[S+1]*c,Ue(Ro,Ro,_.viewMatrix);const O=T*g.size;if(se(Yl,g.data[O],g.data[O+1],g.data[O+2]),!w&&(Ro[0]+=Yl[0],Ro[1]+=Yl[1],Yl[2]!==0)){const $=Yl[2];pe(Yl,Ro),ce(Ro,Ro,te(Yl,Yl,$))}const A=T*p.size;if(se(dS,p.data[A],p.data[A+1],p.data[A+2]),this._normalAndViewAngle(dS,w6,_,x6),this._applyVerticalOffsetTransformationView(Ro,x6,_,b6),_.applyProjection(Ro,ta),ta[0]>-1){ta[0]=Math.floor(ta[0]),ta[1]=Math.floor(ta[1]),w&&(Yl[0]||Yl[1])&&(ta[0]+=Yl[0],Yl[1]!==0&&(ta[1]+=aH(Yl[1],b6.factorAlignment)),_.unapplyProjection(ta,Ro)),ta[0]+=this.parameters.screenOffset[0],ta[1]+=this.parameters.screenOffset[1],uge(Ag,b6.factor,Ag);const $=kVe*_.pixelRatio;let P=0;if(a.textureIsSignedDistanceField&&(P=a.outlineSize*_.pixelRatio/2),y&&qK(y,ta[0],ta[1],Ag,$,P,a,v)){const U=i.ray;if(Ue(XK,Ro,Fn(UVe,_.viewMatrix)),ta[0]=y[0],ta[1]=y[1],_.unprojectFromRenderScreen(ta,Ro)){const I=C();re(I,U.direction);const L=1/Se(I);te(I,I,L),o(ni(U.origin,Ro)*L,I,-1,!0,1,XK)}}}}}intersectDraped(t,r,i,s,n,o){const a=t.vertexAttributes.get(E.POSITION),l=t.vertexAttributes.get(E.SIZE),c=this.parameters,u=VL(c);let d=1,p=1;if(t.shaderTransformer!=null){const y=t.shaderTransformer(ZK);d=y[0],p=y[5]}d*=t.screenToWorldRatio,p*=t.screenToWorldRatio;const g=zVe*t.screenToWorldRatio;for(let y=0;y<a.data.length/a.size;y++){const _=y*a.size,v=a.data[_],w=a.data[_+1],T=y*l.size;Ag[0]=l.data[T]*d,Ag[1]=l.data[T+1]*p;let x=0;c.textureIsSignedDistanceField&&(x=c.outlineSize*t.screenToWorldRatio/2),qK(s,v,w,Ag,g,x,c,u)&&n(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new jVe(this)}_normalAndViewAngle(t,r,i,s){return fBe(r)&&(r=Ku(FVe,r)),Il(s.normal,t,r),Ue(s.normal,s.normal,i.viewInverseTransposeMatrix),s.cosAngle=de(t0e,BVe),s}_updateScaleInfo(t,r,i){const s=this.parameters;s.screenSizePerspective!=null?$K(i,r,s.screenSizePerspective,t.factor):(t.factor.scale=1,t.factor.factor=0,t.factor.minPixelSize=0,t.factor.paddingPixels=0),s.screenSizePerspectiveAlignment!=null?$K(i,r,s.screenSizePerspectiveAlignment,t.factorAlignment):(t.factorAlignment.factor=t.factor.factor,t.factorAlignment.scale=t.factor.scale,t.factorAlignment.minPixelSize=t.factor.minPixelSize,t.factorAlignment.paddingPixels=t.factor.paddingPixels)}applyShaderOffsetsView(t,r,i,s,n,o,a){const l=this._normalAndViewAngle(r,i,n,x6);return this._applyVerticalGroundOffsetView(t,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(t,r,i,s,n){return this._applyCenterOffsetNDC(t,r,i,s),n!=null&&re(n,s),this._applyPolygonOffsetNDC(s,r,i,s),s}_applyPolygonOffsetView(t,r,i,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(i);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return re(n,t);const c=fe(Math.abs(r.cosAngle),.01,1),u=1-Math.sqrt(1-c*c)/c/s.viewport[2];return te(n,t,l>0?u:1/u),n}_applyVerticalGroundOffsetView(t,r,i,s){const n=Se(t),o=i.aboveGround?1:-1,a=.5*i.computeRenderPixelSizeAtDist(n),l=te(Ro,r.normal,o*a);return oe(s,t,l),s}_applyVerticalOffsetTransformationView(t,r,i,s){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const c=Se(t);this._updateScaleInfo(s,c,r.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return t}const o=Se(t),a=n.screenSizePerspectiveAlignment??n.screenSizePerspective,l=xge(i,o,n.verticalOffset,r.cosAngle,a);return this._updateScaleInfo(s,o,r.cosAngle),te(r.normal,r.normal,l),oe(t,t,r.normal)}_applyCenterOffsetView(t,r,i){const s=this.parameters.centerOffsetUnits!=="screen";return i!==t&&re(i,t),s&&(i[0]+=r[0],i[1]+=r[1],r[2]&&(pe(dS,i),oe(i,i,te(dS,dS,r[2])))),i}_applyCenterOffsetNDC(t,r,i,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==t&&re(s,t),n||(s[0]+=r[0]/i.fullWidth*2,s[1]+=r[1]/i.fullHeight*2),s}_applyPolygonOffsetNDC(t,r,i,s){const n=this.parameters.shaderPolygonOffset;if(t!==s&&re(s,t),n){const o=i.aboveGround?1:-1,a=o*Math.sign(r[3]);s[2]-=(a||o)*n}return s}requiresSlot(t,r){if(r===D.Color||r===D.Alpha||r===D.Highlight||r===D.ObjectAndLayerIdColor){if(t===ae.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:i,occlusionTest:s}=this.parameters;return t===(i?ae.LABEL_MATERIAL:ae.HUD_MATERIAL)||s&&t===ae.OCCLUSION_PIXELS}return!1}createGLMaterial(t){return new $Ve(t)}calculateRelativeScreenBounds(t,r,i=Nt()){return LVe(this.parameters,t,r,i),i[2]=i[0]+t[0],i[3]=i[1]+t[1],i}}class $Ve extends pj{constructor(t){super({...t,...t.material.parameters})}selectProgram(t){return this.ensureTechnique(p4,t)}beginSlot(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(t)}}function LVe(e,t,r,i=NVe){return en(i,e.anchorPosition),i[0]*=-t[0],i[1]*=-t[1],i[0]+=e.screenOffset[0]*r,i[1]+=e.screenOffset[1]*r,i}function DVe(e){const t=e[0],r=e[1],i=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=1/Math.sqrt(t*t+r*r+i*i),d=1/Math.sqrt(s*s+n*n+o*o),p=1/Math.sqrt(a*a+l*l+c*c);return e[0]=t*u,e[1]=r*u,e[2]=i*u,e[3]=s*d,e[4]=n*d,e[5]=o*d,e[6]=a*p,e[7]=l*p,e[8]=c*p,e}function qK(e,t,r,i,s,n,o,a){let l=t-s-(a[0]>0?i[0]*a[0]:0),c=l+i[0]+2*s,u=r-s-(a[1]>0?i[1]*a[1]:0),d=u+i[1]+2*s;const p=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&p!=null&&(l+=i[0]*p[0],u+=i[1]*p[1],c-=i[0]*(1-p[2]),d-=i[1]*(1-p[3]),l-=n,c+=n,u-=n,d+=n),e[0]>l&&e[0]<c&&e[1]>u&&e[1]<d}const b6=new Cge,NVe=Ne(),Ro=C(),dS=C(),ta=Ht(),t0e=C(),XK=C(),w6=$i(),FVe=$i(),UVe=be(),Yl=C(),x6={normal:t0e,cosAngle:0},ZK=be(),kVe=1,zVe=2,Ag=[0,0],BVe=Ce(0,0,1);class VVe extends ufe{constructor(){super(...arguments),this.renderOccluded=Ei.Occlude,this.color=At(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=or(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=At(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}}const r0e=Li().vec3f(E.POSITION).vec3f(E.NORMAL).vec2f(E.UV0).vec4u8(E.COLOR).vec2f(E.SIZE).vec4f(E.AUXPOS1).vec4f(E.AUXPOS2),GVe=r0e.clone().vec4u8(E.OBJECTANDLAYERIDCOLOR);class jVe{constructor(t){this._material=t,this.vertexBufferLayout=ne("enable-feature:objectAndLayerId-rendering")?GVe:r0e}elementCount(t){return 6*t.indices.get(E.POSITION).length}write(t,r,i,s,n){fH(i.indices.get(E.POSITION),i.vertexAttributes.get(E.POSITION).data,t,s.position,n,6),mH(i.indices.get(E.NORMAL),i.vertexAttributes.get(E.NORMAL).data,r,s.normal,n,6);const o=i.vertexAttributes.get(E.UV0).data;let a,l,c,u;if(o==null||o.length<4){const w=this._material.parameters;a=0,l=0,c=w.texCoordScale[0],u=w.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],u=o[3];c=Math.min(1.99999,c+1),u=Math.min(1.99999,u+1);let d=i.indices.get(E.POSITION).length,p=n;const g=s.uv0;for(let w=0;w<d;++w)g.set(p,0,a),g.set(p,1,l),p+=1,g.set(p,0,c),g.set(p,1,l),p+=1,g.set(p,0,c),g.set(p,1,u),p+=1,g.set(p,0,c),g.set(p,1,u),p+=1,g.set(p,0,a),g.set(p,1,u),p+=1,g.set(p,0,a),g.set(p,1,l),p+=1;Oge(i.indices.get(E.COLOR),i.vertexAttributes.get(E.COLOR).data,4,s.color,n,6);const y=i.indices.get(E.SIZE),_=i.vertexAttributes.get(E.SIZE).data;d=y.length;const v=s.size;p=n;for(let w=0;w<d;++w){const T=_[2*y[w]],x=_[2*y[w]+1];for(let S=0;S<6;++S)v.set(p,0,T),v.set(p,1,x),p+=1}if(i.indices.get(E.AUXPOS1)&&i.vertexAttributes.get(E.AUXPOS1)?BT(i.indices.get(E.AUXPOS1),i.vertexAttributes.get(E.AUXPOS1).data,s.auxpos1,n,6):BK(s.auxpos1,n,6*d),i.indices.get(E.AUXPOS2)&&i.vertexAttributes.get(E.AUXPOS2)?BT(i.indices.get(E.AUXPOS2),i.vertexAttributes.get(E.AUXPOS2).data,s.auxpos2,n,6):BK(s.auxpos2,n,6*d),i.objectAndLayerIdColor!=null&&i.indices.get(E.POSITION)){const w=i.indices.get(E.POSITION).length,T=s.getField(E.OBJECTANDLAYERIDCOLOR,zn);Rge(i.objectAndLayerIdColor,T,w,n,6)}}}const Nd=C(),$b=Ht(),pS=Ht(),T6=C(),HVe=be(),WVe=ls(),S6=Dn(),qVe=C(),XVe=Nt();class ZVe{constructor(){this.aabr=Nt(),this.distance=0,this.culled=!1,this.visible=!1}}class YVe{constructor(t,r){this.graphics3DGraphic=t,this.slicePlaneEnabled=r,this.info={}}}var _l;(function(e){e[e.Idle=0]="Idle",e[e.Process=1]="Process",e[e.Sort=2]="Sort",e[e.Deconflict=3]="Deconflict",e[e.NumStates=4]="NumStates"})(_l||(_l={}));class i0e{constructor(){this.camera=new lt,this.slicePlane=Xm(),this.slicePlaneEnabled=!1}copyFrom(t){this.camera.copyFrom(t.camera),sb(t.slicePlane,this.slicePlane),this.slicePlaneEnabled=t.slicePlaneEnabled}}let px=class extends xe{get dirty(){return this._dirty}get state(){return this._state}constructor(e){super(e),this._dirty=!1,this._runningViewState=new i0e,this._state=_l.Idle,this._active=new Map,this._visible=new Map,this._iterators=new e7e,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==_l.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const e=this._state/_l.NumStates;return this._dirty?.5*e:e}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(e){switch(this._state){case _l.Idle:this._startUpdate(),e.madeProgress();case _l.Process:if(this._state=_l.Process,!this._processActiveGraphics(e))return;case _l.Sort:if(this._state=_l.Sort,!this._sortVisibleGraphics(e))return;case _l.Deconflict:if(this._state=_l.Deconflict,!this._deconflictVisibleGraphics(e))return;default:iBe(this,this._visible),this._state=_l.Idle,this.notifyChange("updating")}}modifyGraphics(e,t){t?e.forEach(r=>this.addToActiveGraphics(r)):e.forEach(r=>this.removeFromActiveGraphics(r)),this.setDirty()}layerSupportsDeconfliction(e){if(e==null||e.type!=="object3d")return!1;const t=e.stageObject;return(t?t.geometries.length:0)!==1?!1:t?.geometries[0]?.material instanceof HT}_startUpdate(){sBe(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:e,fullHeight:t}=this._runningViewState.camera;this._initBins(e,t),this._resetIterators()}addToActiveGraphics(e){e.info[this.visibilityGroup]=new ZVe,this._active.set(e.graphics3DGraphic.graphic.uid,e),this.setDirty()}removeFromActiveGraphics(e){this._visible.delete(e.graphics3DGraphic.graphic.uid),JVe(e,this.visibilityGroup),delete e.info[this.visibilityGroup],this._active.delete(e.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(e){const t=this._ensureActiveGraphicsIterator(),r=m2(HVe,this._runningViewState.camera.projectionMatrix),i=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?WVe:null;let s=0;for(i!=null&&(Ue(i,wa,this._runningViewState.camera.viewMatrix),i[3]=Mr(this.view.spatialReference).radius,s=Dde(i,wa));!e.done;){e.madeProgress();const n=t.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,r,i,s),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(e){const t=this._ensureSortGraphicsIterator();for(;!e.done;){const r=t.next();if(e.madeProgress(),r.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(e){const t=this._ensureVisibleGraphicsIterator(),r=this.visibilityGroup===$n.LABEL;for(;!e.done;){e.madeProgress();const i=t.next();if(i.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=i.value,n=s.info[this.visibilityGroup];if(!n||n.culled)continue;const o=s.graphics3DGraphic,a=!r||o.isVisible();n.visible=a&&!this._isConflicted(s),n.visible&&this._addToBins(s),this._setGraphicVisibility(s,n.visible),oBe(n,n.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=YK(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=YK(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=KVe(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(e,t,r,i){const s=e.graphics3DGraphic;if(s.destroyed)return;const n=e.info[this.visibilityGroup];if(!s.isVisible($n.GRAPHIC,wo.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);qu(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(a==null&&(a=i7e,this._getProjectionInfo(l,t,a),a.isOutsideScreen||this._isCulledBySlice(e,Nd)||r!=null&&this._isCulledByHorizon(a,r,i)))return void(n.culled=!0);this._expandBoundingRect(n,l,c,a)}a==null?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(e,t,r){const i=this._runningViewState.camera,s=e.stageObject,n=s.geometries[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;Ue(Nd,a,i.viewMatrix);const l=n.vertexAttributes,c=l.get(E.NORMAL).data,u=l.get(E.AUXPOS1).data;o.applyShaderOffsetsView(Nd,c,s.transformation,u,i,r.scaleInfo,Nd),pi($b,Nd[0],Nd[1],Nd[2],1),xc(pS,$b,i.projectionMatrix),te(r.positionNDC,pS,1/pS[3]),o.applyShaderOffsetsNDC(r.positionNDC,u,i,r.positionNDC,T6),r.distanceWithoutPolygonOffset=i.depthNDCToWorld(T6[2]),r.distance=T6[2]===r.positionNDC[2]?r.distanceWithoutPolygonOffset:i.depthNDCToWorld(r.positionNDC[2]),pi(pS,r.positionNDC[0],r.positionNDC[1],r.positionNDC[2],1),xc($b,pS,t),t1($b,$b,1/$b[3]),se(r.positionView,Nd[0],Nd[1],Nd[2])}_isCulledByHorizon(e,t,r){return re(S6.direction,e.positionView),se(S6.origin,0,0,0),!!Dy(t,S6,qVe)&&e.distanceWithoutPolygonOffset>r}_isCulledBySlice(e,t){return e.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&kG(this._runningViewState.slicePlane,t)}_expandBoundingRect(e,t,r,{positionNDC:i,scaleInfo:s}){const n=this._runningViewState.camera,o=t.getScreenSize(t7e);uge(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=B$(r.calculateRelativeScreenBounds(o,s.factorAlignment.scale,XVe),yt(0,n.fullWidth,.5+.5*i[0]),yt(0,n.fullHeight,.5+.5*i[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(bc(a),yd(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}ry(e.aabr,a,e.aabr)}_isConflicted(e){const t=e.graphics3DGraphic.graphic.uid,r=e.info[this.visibilityGroup];for(let i=Math.floor(r.aabr[0]/this._accBinsSizeX);i<=Math.floor(r.aabr[2]/this._accBinsSizeX);i++)if(!(i<0||i>=this._accBinsNumX))for(let s=Math.floor(r.aabr[1]/this._accBinsSizeY);s<=Math.floor(r.aabr[3]/this._accBinsSizeY);s++){if(s<0||s>=this._accBinsNumY)continue;const n=this._accBins[i][s];for(let o=0;o<n.length;o++){const a=n.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==t&&(this.accNumTests++,tN(l.aabr,r.aabr)))return!0}}return!1}_initBins(e,t){if(this._accBins==null){this._accBins=[];for(let r=0;r<this._accBinsNumX;r++){this._accBins.push([]);const i=this._accBins[this._accBins.length-1];for(let s=0;s<this._accBinsNumY;s++)i.push(new Mt)}}else for(let r=0;r<this._accBinsNumX;r++)for(let i=0;i<this._accBinsNumY;i++)this._accBins[r][i].clear();this._accBinsSizeX=e/this._accBinsNumX,this._accBinsSizeY=t/this._accBinsNumY,this.accNumTests=0}_addToBins(e){const t=e.info[this.visibilityGroup],r=Math.floor(t.aabr[0]/this._accBinsSizeX),i=Math.floor(t.aabr[2]/this._accBinsSizeX),s=Math.floor(t.aabr[1]/this._accBinsSizeY),n=Math.floor(t.aabr[3]/this._accBinsSizeY);for(let o=r;o<=i;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(e)}_setGraphicVisibility(e,t){const r=e.graphics3DGraphic;r.destroyed||(r.setVisibilityFlag(this.visibilityGroup,wo.DECONFLICTION,t),this.visibilityGroup===$n.LABEL&&this.view.labeler.setLabelGraphicVisibility(r,t))}};function JVe(e,t){const r=e.graphics3DGraphic;r.destroyed||r.setVisibilityFlag(t,wo.DECONFLICTION,!0)}function*YK(e){if(Map.prototype.entries){const t=e.entries();for(let r=t.next();!r.done;r=t.next())yield r.value[1]}else yield*e.values()}function*KVe(e,t,r){t.clear(),e.forEach((s,n)=>{const o=t.pushNew();o.id=n,o.visible=s.graphics3DGraphic.getVisibilityFlag(r,wo.DECONFLICTION);const a=s.info&&s.info[r];o.prio=s.graphics3DGraphic.deconflictionPriority,o.distance=a?a.distance:Number.MAX_VALUE}),yield;const i=t.iterableSort((s,n)=>s.prio!==n.prio?n.prio-s.prio:s.distance!==n.distance?s.distance-n.distance:s.visible!==n.visible?s.visible?-1:1:s.id-n.id);for(let s=i.next();!s.done;s=i.next())yield;t.forAll(s=>{const n=e.get(s.id);n&&(e.delete(s.id),e.set(s.id,n))}),t.clear()}h([f({constructOnly:!0})],px.prototype,"view",void 0),h([f({type:Boolean,readOnly:!0})],px.prototype,"updating",null),px=h([F("esri.views.3d.layers.graphics.Deconflictor")],px);class QVe{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}}class e7e{constructor(t=null,r=null,i=null){this.active=t,this.visible=r,this.sort=i,this.sortArray=new Mt({allocator:s=>s||new QVe})}}const t7e=Ne();class r7e{constructor(){this.positionView=C(),this.positionNDC=C(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new Cge}get isOutsideScreen(){const t=this.positionNDC;return t[0]<-1||t[1]<-1||t[2]<-1||t[0]>=1||t[1]>=1}}const i7e=new r7e,s7e=2e3;let mI=class extends px{constructor(e){super(e),this.visibilityGroup=$n.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return Eo.YIELD;const t=performance.now();if(e.state!==Er.IDLE&&t-this._lastDeconfliction<s7e)return Eo.YIELD;super.runTask(e),this.state===_l.Idle&&(this._lastDeconfliction=t)}enabledChanged(e,t){this.modifyGraphics(t,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};h([f({constructOnly:!0})],mI.prototype,"parent",void 0),mI=h([F("esri.views.3d.layers.graphics.LabelDeconflictor")],mI);let Qz=class extends px{constructor(){super(...arguments),this._handles=new gi,this._contexts=new Map,this._viewState=new i0e,this.visibilityGroup=$n.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([le(()=>this.view?.state?.camera,()=>{this._updateViewState(),this.setDirty()}),le(()=>this.view?.map?.ground?.opacity,(e,t)=>{e!==1&&t!==1||this.setDirty()}),le(()=>this.view?.slicePlane,()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Rr)]),this._frameTask=this.view.resourceController.scheduler.registerTask(at.GRAPHICS_DECONFLICTOR,this),this._labels=new mI({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,t){const r=!(this._graphicSupportsDeconfliction(t)&&E6(e));t.setVisibilityFlag($n.GRAPHIC,wo.DECONFLICTION,r)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&Yde(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){_o(this._contexts,(e,t)=>t.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const t=this._getGraphicsContext(e);return{addGraphic:r=>this._addGraphic(e,t,r),removeGraphic:r=>this._removeGraphic(t,r),labelingInfoChange:()=>this._labels.enabledChanged(e,t),featureReductionChange:()=>this.enabledChanged(e,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,t),clear:()=>t.forEach(r=>this._removeGraphic(t,r.graphics3DGraphic))}}removeGraphicsOwner(e){const t=this._contexts.get(e);t&&(t.forEach(r=>this._removeGraphic(t,r.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,t,r){const i=r.graphic.uid,s=new YVe(r,e.symbolCreationContext.slicePlaneEnabled);t.set(i,s),E6(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s)}_removeGraphic(e,t){const r=t.graphic.uid,i=e.get(r);i&&(this.removeFromActiveGraphics(i),this._labels.removeFromActiveGraphics(i),e.delete(r),this.setDirty())}enabledChanged(e,t){const r=E6(e);r||n7e(e),this.modifyGraphics(t,r)}_slicePlaneEnabledChanged(e,t){const r=e.symbolCreationContext.slicePlaneEnabled;t.forEach(i=>i.slicePlaneEnabled=r),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const t=e.layers;if(!t||!t.length)return!1;for(const r of t)if(this.layerSupportsDeconfliction(r))return!0;return!1}_getGraphicsContext(e){const t=this._contexts.get(e);if(t)return t;const r=new Map;return this._contexts.set(e,r),this.setDirty(),r}};function E6(e){const t=e.layer;return!(!t||!t.featureReduction||t.featureReduction.type!=="selection")}function n7e(e){const t=e.graphics3DGraphics;t&&t.forEach(r=>r.setVisibilityFlag($n.GRAPHIC,wo.DECONFLICTION,!0))}Qz=h([F("esri.views.3d.layers.graphics.GraphicsDeconflictor")],Qz);function s0e(e){return 32+e.length}function n0e(e){return 16}function o0e(e){if(!e)return 0;let t=c0e;for(const r in e)if(e.hasOwnProperty(r)){const i=e[r];switch(typeof i){case"string":t+=s0e(i);break;case"number":t+=n0e();break;case"boolean":t+=4}}return t}function a0e(e){if(!e)return 0;if(Array.isArray(e))return o7e(e);let t=c0e;for(const r in e)e.hasOwnProperty(r)&&(t+=l0e(e[r]));return t}function o7e(e){const t=e.length;if(t===0||typeof e[0]=="number")return 32+8*t;let r=u0e;for(let i=0;i<t;i++)r+=l0e(e[i]);return r}function l0e(e){switch(typeof e){case"object":return a0e(e);case"string":return s0e(e);case"number":return n0e();case"boolean":return 4;default:return 8}}function gft(e,t){return u0e+e.length*t}const c0e=32,u0e=32,bH=(e,t,r)=>[t,r],WT=(e,t,r)=>[t,r,e[2]],wH=(e,t,r)=>[t,r,e[2],e[3]];function yft(e){return e?{originPosition:e.originPosition==="upper-left"?"upperLeft":e.originPosition==="lower-left"?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:e.extent!=null?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function a7e({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function l7e({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function h0e({scale:e,translate:t},r){return r*e[0]+t[0]}function d0e({scale:e,translate:t},r){return t[1]-r*e[1]}function p0e(e,t,r){const i=new Array(r.length);if(!r.length)return i;const[s,n]=e.scale;let o=h0e(e,r[0][0]),a=d0e(e,r[0][1]);i[0]=t(r[0],o,a);for(let l=1;l<r.length;l++){const c=r[l];o+=c[0]*s,a-=c[1]*n,i[l]=t(c,o,a)}return i}function f0e(e,t,r){const i=new Array(r.length);for(let s=0;s<r.length;s++)i[s]=p0e(e,t,r[s]);return i}function c7e(e,t,r,i){return p0e(e,r?i?wH:WT:i?WT:bH,t)}function u7e(e,t,r,i){return f0e(e,r?i?wH:WT:i?WT:bH,t)}function h7e(e,t,r,i){return f0e(e,r?i?wH:WT:i?WT:bH,t)}function _ft(e,t,r,i,s){return t.x=a7e(e,r.x),t.y=l7e(e,r.y),t!==r&&(i&&(t.z=r.z),s&&(t.m=r.m)),t}function m0e(e,t,r,i,s){return r!=null&&(t.points=c7e(e,r.points,i,s)),t}function g0e(e,t,r,i,s){return r==null||(t.x=h0e(e,r.x),t.y=d0e(e,r.y),t!==r&&(i&&(t.z=r.z),s&&(t.m=r.m))),t}function y0e(e,t,r,i,s){return r!=null&&(t.rings=h7e(e,r.rings,i,s)),t}function _0e(e,t,r,i,s){return r!=null&&(t.paths=u7e(e,r.paths,i,s)),t}var eB;let $E=eB=class extends Pe{constructor(e){super(e),this.name=null,this.code=null}clone(){return new eB({name:this.name,code:this.code})}};h([f({type:String,json:{write:!0}})],$E.prototype,"name",void 0),h([f({type:[String,Number],json:{write:!0}})],$E.prototype,"code",void 0),$E=eB=h([F("esri.layers.support.CodedValue")],$E);const d7e=new kl({inherited:"inherited",codedValue:"coded-value",range:"range"});let LE=class extends Pe{constructor(e){super(e),this.name=null,this.type=null}};h([f({type:String,json:{write:!0}})],LE.prototype,"name",void 0),h([Wt(d7e)],LE.prototype,"type",void 0),LE=h([F("esri.layers.support.Domain")],LE);const f4=LE;var tB;let DE=tB=class extends f4{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let t=null;if(this.codedValues){const r=String(e);this.codedValues.some(i=>(String(i.code)===r&&(t=i.name),!!t))}return t}clone(){return new tB({codedValues:ye(this.codedValues),name:this.name})}};h([f({type:[$E],json:{write:!0}})],DE.prototype,"codedValues",void 0),h([Wt({codedValue:"coded-value"})],DE.prototype,"type",void 0),DE=tB=h([F("esri.layers.support.CodedValueDomain")],DE);const v0e=DE;var rB;let gI=rB=class extends f4{constructor(e){super(e),this.type="inherited"}clone(){return new rB}};h([Wt({inherited:"inherited"})],gI.prototype,"type",void 0),gI=rB=h([F("esri.layers.support.InheritedDomain")],gI);const b0e=gI;var iB;let Uw=iB=class extends f4{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new iB({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};h([f({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(e,t,r){t[r]=[this.minValue||0,e]}}}})],Uw.prototype,"maxValue",void 0),h([f({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[0]},write:{target:"range",writer(e,t,r){t[r]=[e,this.maxValue||0]}}}})],Uw.prototype,"minValue",void 0),h([Wt({range:"range"})],Uw.prototype,"type",void 0),Uw=iB=h([F("esri.layers.support.RangeDomain")],Uw);const w0e=Uw,p7e={key:"type",base:f4,typeMap:{range:w0e,"coded-value":v0e,inherited:b0e}};function f7e(e){if(!e||!e.type)return null;switch(e.type){case"range":return w0e.fromJSON(e);case"codedValue":return v0e.fromJSON(e);case"inherited":return b0e.fromJSON(e)}return null}const xH=new kl({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var sB;const m7e=new kl({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let sa=sB=class extends Pe{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(e,{description:t}){let r=null;try{r=t?JSON.parse(t):null}catch{}return r?.value??null}readValueType(e,{description:t}){let r=null;try{r=t?JSON.parse(t):null}catch{}return r?m7e.fromJSON(r.fieldValueType):null}clone(){return new sB({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};h([f({type:String,json:{write:!0}})],sa.prototype,"alias",void 0),h([f({type:[String,Number],json:{write:{allowNull:!0}}})],sa.prototype,"defaultValue",void 0),h([f()],sa.prototype,"description",void 0),h([br("description")],sa.prototype,"readDescription",null),h([f({types:p7e,json:{read:{reader:f7e},write:!0}})],sa.prototype,"domain",void 0),h([f({type:Boolean,json:{write:!0}})],sa.prototype,"editable",void 0),h([f({type:Ps,json:{write:!0}})],sa.prototype,"length",void 0),h([f({type:String,json:{write:!0}})],sa.prototype,"name",void 0),h([f({type:Boolean,json:{write:!0}})],sa.prototype,"nullable",void 0),h([Wt(xH)],sa.prototype,"type",void 0),h([f()],sa.prototype,"valueType",void 0),h([br("valueType",["description"])],sa.prototype,"readValueType",null),h([f({type:Boolean,json:{read:!1}})],sa.prototype,"visible",void 0),sa=sB=h([F("esri.layers.support.Field")],sa);const g7e=sa;class vft{constructor(t,r,i){this.uid=t,this.geometry=r,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}}function bft(e){return e.geometry!=null}class wft{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function xft(e){const t=GRe.fromJSON(e.geometryType),r=st.fromJSON(e.spatialReference),i=e.transform,s=e.features.map(n=>{const o=y7e(n,t,r,e.objectIdFieldName),a=o.geometry;if(a!=null&&i)switch(a.type){case"point":o.geometry=g0e(i,a,a,a.hasZ,a.hasM);break;case"multipoint":o.geometry=m0e(i,a,a,!!a.hasZ,!!a.hasM);break;case"polygon":o.geometry=y0e(i,a,a,!!a.hasZ,!!a.hasM);break;case"polyline":o.geometry=_0e(i,a,a,!!a.hasZ,!!a.hasM);break;case"extent":case"mesh":o.geometry=a}return o});return{geometryType:t,features:s,spatialReference:r,fields:e.fields?.map(n=>g7e.fromJSON(n))??[],objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null}}function y7e(e,t,r,i){return{uid:Nl(),objectId:i&&e.attributes?e.attributes[i]:null,attributes:e.attributes,geometry:_7e(e.geometry,t,r),visible:!0}}function _7e(e,t,r){if(e==null)return null;switch(t){case"point":{const i=e;return{x:i.x,y:i.y,z:i.z,m:i.m,hasZ:i.z!=null,hasM:i.m!=null,type:"point",spatialReference:r}}case"polyline":{const i=e;return{paths:i.paths,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polyline",spatialReference:r}}case"polygon":{const i=e;return{rings:i.rings,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polygon",spatialReference:r}}case"multipoint":{const i=e;return{points:i.points,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"multipoint",spatialReference:r}}}}function cb(e,t,r,i){return{x:e,y:t,z:r,hasZ:r!=null,hasM:!1,spatialReference:i,type:"point"}}function v7e(e){if(e==null)return 0;let t=32;switch(e.type){case"point":t+=42;break;case"polyline":case"polygon":{let r=0;const i=2+(e.hasZ?1:0)+(e.hasM?1:0),s=e.type==="polyline"?e.paths:e.rings;for(const n of s)r+=n.length;t+=8*r*i+64,t+=128*r,t+=34,t+=32*(s.length+1);break}case"multipoint":{const r=2+(e.hasZ?1:0)+(e.hasM?1:0),i=e.points.length;t+=8*i*r+64,t+=128*i,t+=34,t+=32;break}case"extent":t+=98,e.hasM&&(t+=32),e.hasZ&&(t+=32);break;case"mesh":t+=N0(e.vertexAttributes.position),t+=N0(e.vertexAttributes.normal),t+=N0(e.vertexAttributes.uv),t+=N0(e.vertexAttributes.tangent)}return t}function Tft(e){let t=32;return t+=o0e(e.attributes),t+=3,t+=8+v7e(e.geometry),t}function b7e(e){if(e==null)return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const r of e.paths)t+=r.length;return t}case"polygon":{let t=0;for(const r of e.rings)t+=r.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function Sft(e){if(e==null)return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(const t of e.paths)if(t.length>0)return!0;return!1;case"polygon":for(const t of e.rings)if(t.length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return!e.loaded||e.vertexAttributes.position.length>0}}function Eft(e,t){switch(mi(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let r=0;r<e.paths.length;r++)oF(t,e.paths[r],!!e.hasZ);break;case"polygon":for(let r=0;r<e.rings.length;r++)oF(t,e.rings[r],!!e.hasZ);break;case"multipoint":oF(t,e.points,!!e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,e.zmin!=null&&(t[2]=e.zmin),e.zmax!=null&&(t[5]=e.zmax)}}function w7e(e,t){switch(qu(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let r=0;r<e.paths.length;r++)K5(t,e.paths[r]);break;case"polygon":for(let r=0;r<e.rings.length;r++)K5(t,e.rings[r]);break;case"multipoint":K5(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function Cft(e,t){return e.objectId!=null?e.objectId:e.attributes&&t?e.attributes[t]:null}function x0e(e){return"declaredClass"in e}function JK(e){return"declaredClass"in e}function x7e(e){return"declaredClass"in e}function T7e(e,t){return e?x7e(e)?e:new v1({layer:t,sourceLayer:t,visible:e.visible,symbol:ye(e.symbol),attributes:ye(e.attributes),geometry:T0e(e.geometry)}):null}function T0e(e){return e==null?null:x0e(e)?e:cT(S7e(e))}function S7e(e){const{wkid:t,wkt:r,latestWkid:i}=e.spatialReference,s={wkid:t,wkt:r,latestWkid:i};switch(e.type){case"point":{const{x:n,y:o,z:a,m:l}=e;return{x:n,y:o,z:a,m:l,spatialReference:s}}case"polygon":{const{rings:n,hasZ:o,hasM:a}=e;return{rings:KK(n),hasZ:o,hasM:a,spatialReference:s}}case"polyline":{const{paths:n,hasZ:o,hasM:a}=e;return{paths:KK(n),hasZ:o,hasM:a,spatialReference:s}}case"extent":{const{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:u,mmin:d,mmax:p,hasZ:g,hasM:y}=e;return{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:u,mmin:d,mmax:p,hasZ:g,hasM:y,spatialReference:s}}case"multipoint":{const{points:n,hasZ:o,hasM:a}=e;return{points:E0e(n)?S0e(n):n,hasZ:o,hasM:a,spatialReference:s}}default:return}}function KK(e){return E7e(e)?e.map(t=>S0e(t)):e}function S0e(e){return e.map(t=>Array.from(t))}function E7e(e){for(const t of e)if(t.length!==0)return E0e(t);return!1}function E0e(e){return e.length>0&&(t2(e[0])||r2(e[0]))}function C7e(e,t){if(!e)return null;let r;if(JK(e)){if(t==null)return e.clone();if(JK(t))return t.copy(e)}return t!=null?(r=t,r.x=e.x,r.y=e.y,r.spatialReference=e.spatialReference,e.hasZ?(r.z=e.z,r.hasZ=e.hasZ):(r.z=void 0,r.hasZ=!1),e.hasM?(r.m=e.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=cb(e.x,e.y,e.z,e.spatialReference),e.hasM&&(r.m=e.m,r.hasM=!0)),r}function Aft(e){const{wkid:t,wkt:r,latestWkid:i}=e,s={wkid:t,wkt:r,latestWkid:i};return st.fromJSON(s)}const TH="__begin__",SH="__end__",A7e=new RegExp(TH,"ig"),O7e=new RegExp(SH,"ig"),QK=new RegExp("^"+TH,"i"),eQ=new RegExp(SH+"$","i"),GL='"',R7e=GL+" + ",P7e=" + "+GL;function M7e(e){return e.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function Oft(e){return e.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function EH(e){const t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):e.labelExpression!=null&&(t.expression=M7e(e.labelExpression),t.type="conventional"),t}function Rft(e){const t=EH(e);if(!t)return null;switch(t.type){case"conventional":return I7e(t.expression);case"arcade":return t.expression}return null}function Pft(e){const t=EH(e);if(!t)return null;switch(t.type){case"conventional":return L7e(t.expression);case"arcade":return C0e(t.expression)}return null}function I7e(e){let t;return e?(t=MD(e,r=>TH+'$feature["'+r+'"]'+SH),t=QK.test(t)?t.replace(QK,""):GL+t,t=eQ.test(t)?t.replace(eQ,""):t+GL,t=t.replaceAll(A7e,R7e).replaceAll(O7e,P7e)):t='""',t}const $7e=/^\s*\{([^}]+)\}\s*$/i;function L7e(e){const t=e?.match($7e);return t&&t[1].trim()||null}const D7e=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,N7e=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,F7e=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function C0e(e){if(!e)return null;let t=D7e.exec(e)||N7e.exec(e);return t?t[1]||t[3]:(t=F7e.exec(e),t?t[2]:null)}const C6=K.getLogger("esri.layers.support.labelFormatUtils"),A6={type:"simple",evaluate:()=>null},U7e={getAttribute:(e,t)=>e.field(t)};async function A0e(e,t,r){if(!e||!e.symbol||!t)return A6;const i=e.where,s=EH(e),n=i?await ue(()=>import("./WhereClause.c0b1e923.js").then(function(a){return a.W}),["assets/WhereClause.c0b1e923.js","assets/executionError.10e29c03.js"]):null;let o;if(s.type==="arcade"){const a=await KRe(s.expression,r,t);if(a==null)return A6;o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l},a.services);if(c!=null)return c.toString()}catch(c){C6.error(new G("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:c,feature:l,expression:s}))}return null},needsHydrationToEvaluate:()=>C0e(s.expression)==null}}else o={type:"simple",evaluate:a=>s.expression.replaceAll(/{[^}]*}/g,l=>{const c=l.slice(1,-1),u=t.get(c);if(!u)return l;let d=null;return"attributes"in a?a&&a.attributes&&(d=a.attributes[u.name]):d=a.field(u.name),d==null?"":O0e(d,u)})};if(i){let a;try{a=n.WhereClause.create(i,t)}catch(c){return C6.error(new G("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:i,error:c})),A6}const l=o.evaluate;o.evaluate=c=>{const u="attributes"in c?void 0:U7e;try{if(a.testFeature(c,u))return l(c)}catch(d){C6.error(new G("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:i,feature:c,error:d}))}return null}}return o}function O0e(e,t){if(e==null)return"";const r=t.domain;if(r){if(r.type==="codedValue"||r.type==="coded-value"){const s=e;for(const n of r.codedValues)if(n.code===s)return n.name}else if(r.type==="range"){const s=+e,n="range"in r?r.range[0]:r.minValue,o="range"in r?r.range[1]:r.maxValue;if(n<=s&&s<=o)return r.name}}let i=e;return t.type==="date"||t.type==="esriFieldTypeDate"?i=uy(i,HS("short-date")):Tue(t)&&(i=iT(+i)),i||""}var Mft=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:A0e,formatField:O0e},Symbol.toStringTag,{value:"Module"}));class R0e{constructor(t=null,r="center",i="center",s=null,n=[0,0,0],o=0,a=[0,0,0,1],l=[0,0],c="world",u=0,d=0){this.verticalOffset=t,this.horizontalPlacement=r,this.verticalPlacement=i,this.text=s,this.translation=n,this.elevationOffset=o,this.centerOffset=a,this.screenOffset=l,this.centerOffsetUnits=c,this.displayWidth=u,this.displayHeight=d}}function CH(e,t){if(e.type==="point")return Og(e,t,!1);if(x0e(e))switch(e.type){case"extent":return Og(e.center,t,!1);case"polygon":return Og(e.centroid,t,!1);case"polyline":return Og(tQ(e),t,!0);case"mesh":return Og(e.origin,t,!1)}else switch(e.type){case"extent":return Og(k7e(e),t,!0);case"polygon":return Og(z7e(e),t,!0);case"polyline":return Og(tQ(e),t,!0)}}function tQ(e){const t=e.paths[0];if(!t||t.length===0)return null;const r=Wce(t,Hce(t)/2);return cb(r[0],r[1],r[2],e.spatialReference)}function k7e(e){return cb(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),e.zmin!=null&&e.zmax!=null&&isFinite(e.zmin)&&isFinite(e.zmax)?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}function z7e(e){const t=e.rings[0];if(!t||t.length===0)return null;const r=Zce(e.rings,!!e.hasZ);return cb(r[0],r[1],r[2],e.spatialReference)}function Og(e,t,r){const i=r?e:C7e(e);return t&&e?Ghe(e,i,t)?i:null:i}function Ift(e,t,r,i=0){if(e){t||(t=Nt());const s=e;let n=.5*s.width*(r-1),o=.5*s.height*(r-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),pi(t,s.xmin-n-i,s.ymin-o-i,s.xmax+n+i,s.ymax+o+i),t}return null}function P0e(e,t){for(let r=0;r<e.geometries.length;++r){const i=e.geometries[r].getMutableAttribute(E.AUXPOS1);i&&i.data[3]!==t&&(i.data[3]=t,e.geometryVertexAttrsUpdated(e.geometries[r]))}}function IC(e,t,r=null){const i=z3(Mu);return e!=null&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),t!=null?i[3]=t:e!=null&&e.length>3&&(i[3]=e[3]),r&&(i[0]*=r,i[1]*=r,i[2]*=r,i[3]*=r),i}function $ft(e,t,r,i,s,n=[0,0,0,0]){for(let o=0;o<3;++o)e!=null&&e[o]!=null?n[o]=e[o]:r!=null&&r[o]!=null?n[o]=r[o]:n[o]=s[o];return n[3]=t??i??s[3],n}function rQ(e=cm,t,r,i=1){const s=new Array(3);if(t==null||r==null)s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=e[a];let c;const u=l!=null,d=a===0&&!n&&!u,p=r[a];l==="symbol-value"||d?c=p!==0?t[a]/p:1:u&&l!=="proportional"&&isFinite(l)&&(c=p!==0?l/p:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=i;return fa(s)}function B7e(e){return e.isPrimitive!=null}function m4(e){return nB(B7e(e)?[e.width,e.depth,e.height]:e)?null:"Symbol sizes may not be negative values"}function nB(e){const t=r=>r==null||r>=0;return Array.isArray(e)?e.every(t):t(e)}function V7e(e,t,r,i=be()){return e&&fT(i,i,-e/180*Math.PI),t&&pT(i,i,t/180*Math.PI),r&&yN(i,i,r/180*Math.PI),i}function AH(e,t,r){if(r.minDemResolution!=null)return r.minDemResolution;const i=Sa(t),s=Q1(e)*i,n=eb(e)*i,o=Ly(e)*(t.isGeographic?1:i);return s===0&&n===0&&o===0?r.minDemResolutionForPoints:.01*Math.max(s,n,o)}function M0e(e,t,r,i,s,n,o,a,l,c,u){const d=Y7e[u.mode];let p,g,y=0;if(ji(e,t,r,i,l.spatialReference,s,a))return d.requiresAlignment(u)?(y=d.applyElevationAlignmentBuffer(i,s,n,o,a,l,c,u),p=n,g=o):(p=i,g=s),ji(p,l.spatialReference,g,n,c.spatialReference,o,a)?y:void 0}function Oy(e,t,r,i,s){const n=(IL(e)?e.z:Ume(e)?e.array[e.offset+2]:e[2])||0;switch(r.mode){case"on-the-ground":{const o=Mp(t,e,"ground")??0;return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=Mp(t,e,"ground")??0,a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=Mp(t,e,"scene")??0,a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=r.geometryZWithOffset(n,i),a=Mp(t,e,"ground")??0;return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return void(s.z=0)}}function G7e(e,t,r,i){return Oy(e,t,r,i,fx),fx.z}function tO(e,t,r){return t==null||r==null?e.definedChanged:t==="on-the-ground"&&r==="on-the-ground"?e.staysOnTheGround:t===r||t!=="on-the-ground"&&r!=="on-the-ground"?Qi.UPDATE:e.onTheGroundChanged}function th(e){return e==="relative-to-ground"||e==="relative-to-scene"}function Ry(e){return e!=="absolute-height"}function j7e(e,t,r,i,s){Oy(t,r,s,i,fx),P0e(e,fx.verticalDistanceToGround);const n=fx.sampledElevation,o=Ss(J7e,e.transformation);return XR[0]=t.x,XR[1]=t.y,XR[2]=fx.z,Oc(t.spatialReference,XR,o,i.spatialReference)?e.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function H7e(e,t,r,i,s,n){let o=0;const a=n.spatialReference;t*=3,i*=3;for(let l=0;l<s;++l){const c=e[t],u=e[t+1],d=e[t+2],p=n.getElevation(c,u,d,a,"ground")??0;o+=p,r[i]=c,r[i+1]=u,r[i+2]=p,t+=3,i+=3}return o/s}function W7e(e,t,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,d=n.spatialReference;t*=3,i*=3;for(let p=0;p<s;++p){const g=e[t],y=e[t+1],_=e[t+2],v=n.getElevation(g,y,_,d,"ground")??0;l+=v,r[i]=g,r[i+1]=y,r[i+2]=u==null?_+v+c:v+c,t+=3,i+=3}return l/s}function q7e(e,t,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,d=n.spatialReference;t*=3,i*=3;for(let p=0;p<s;++p){const g=e[t],y=e[t+1],_=e[t+2],v=n.getElevation(g,y,_,d,"scene")??0;l+=v,r[i]=g,r[i+1]=y,r[i+2]=u==null?_+v+c:v+c,t+=3,i+=3}return l/s}function X7e(e){const t=e.meterUnitOffset,r=e.featureExpressionInfoContext;return t!==0||r!=null}function Z7e(e,t,r,i,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;t*=3,i*=3;for(let u=0;u<s;++u){const d=e[t],p=e[t+1],g=e[t+2];r[i]=d,r[i+1]=p,r[i+2]=c==null?g+l:l,t+=3,i+=3}return 0}class rO{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}var Qi;(function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"})(Qi||(Qi={}));const Y7e={"absolute-height":{applyElevationAlignmentBuffer:Z7e,requiresAlignment:X7e},"on-the-ground":{applyElevationAlignmentBuffer:H7e,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:W7e,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:q7e,requiresAlignment:()=>!0}},J7e=be(),fx=new rO,XR=C();function OH(e){return e.mapPositions!=null}function I0e(e,t,r,i,s){const n=e.stageObject,o=n.geometries;let a=0;for(const l of o){if(!OH(l))continue;const{update:c,averageGeometrySampledElevation:u}=L0e(l,t,r,i,s);a+=u,c&&n.geometryVertexAttrsUpdated(l)}return a/o.length}function Wv(e,t,r,i,s,n){const o=e.stageObject,a=t.centerPointInElevationSR;let l=0;o.usesVerticalDistanceToGround?(i(a,Ga),P0e(o,Ga.verticalDistanceToGround),l=Ga.sampledElevation):(i(a,Ga),t.mode!=="absolute-height"&&(l=Ga.sampledElevation));const c=Ss(K7e,n??o.transformation),u=se($0e,c[12],c[13],c[14]);Kr.TESTS_DISABLE_OPTIMIZATIONS?(Va[0]=a.x,Va[1]=a.y,Va[2]=Ga.z,Oc(a.spatialReference,Va,c,s.spatialReference)&&(n?Ss(n,c):o.transformation=c)):s.setAltitudeOfTransformation(Ga.z,c);const d=RH/s.unitInMeters;return(Math.abs(c[12]-u[0])>=d||Math.abs(c[13]-u[1])>=d||Math.abs(c[14]-u[2])>=d)&&(n?Ss(n,c):o.transformation=c),l}const K7e=be();function Q7e(e,t,r,i,s){const n=e.graphics3DSymbolLayer.lodRenderer;if(n==null)return 0;const o=t.centerPointInElevationSR;i(o,Ga);const a=t.mode!=="absolute-height"?Ga.sampledElevation:0,l=n.instanceData,c=e.instanceIndex,u=tGe;l.getGlobalTransform(c,u);const d=se($0e,u[12],u[13],u[14]);Kr.TESTS_DISABLE_OPTIMIZATIONS?(Va[0]=o.x,Va[1]=o.y,Va[2]=Ga.z,Oc(o.spatialReference,Va,u,s.spatialReference)&&l.setGlobalTransform(c,u)):s.setAltitudeOfTransformation(Ga.z,u);const p=RH/s.unitInMeters;return(Kr.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(u[12]-d[0])>=p||Math.abs(u[13]-d[1])>=p||Math.abs(u[14]-d[2])>=p)&&l.setGlobalTransform(c,u),a}function eGe(e,t,r,i,s){const n=e.stageObject,o=n.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,u=!1;for(const d of o){if(!OH(d))continue;const p=d.vertexAttributes.get(E.POSITION);if(p!==l){const{update:g,averageGeometrySampledElevation:y}=L0e(d,t,r,i,s);c=y,l=p,u=g}u&&n.geometryVertexAttrsUpdated(d),a+=c}return a/o.length}const RH=.01,Va=C(),Hc=C(),Lb=C(),tGe=be(),$0e=C(),Ga=new rO;function L0e(e,t,r,i,s){let n=!1;const o=e.shaderTransformation,a=t.requiresSampledElevationInfo;Hc[0]=o[12],Hc[1]=o[13],Hc[2]=o[14],e.invalidateBoundingInfo();const l=e.getMutableAttribute(E.POSITION),c=l.data,u=l.size,d=c.length/u,p=new eH(e.mapPositions,r);let g=0,y=0;for(let _=0;_<d;_++){if(Lb[0]=c[g],Lb[1]=c[g+1],Lb[2]=c[g+2],i(p,Ga),a&&(y+=Ga.sampledElevation),Kr.TESTS_DISABLE_OPTIMIZATIONS)c[g]=p.array[p.offset],c[g+1]=p.array[p.offset+1],c[g+2]=Ga.z,ji(c,r,g,c,s.spatialReference,g,1),c[g]-=Hc[0],c[g+1]-=Hc[1],c[g+2]-=Hc[2],n=!0;else{Va[0]=c[g]+Hc[0],Va[1]=c[g+1]+Hc[1],Va[2]=c[g+2]+Hc[2],s.setAltitude(Va,Ga.z),c[g]=Va[0]-Hc[0],c[g+1]=Va[1]-Hc[1],c[g+2]=Va[2]-Hc[2];const v=RH/s.unitInMeters;(Math.abs(Lb[0]-c[g])>=v||Math.abs(Lb[1]-c[g+1])>=v||Math.abs(Lb[2]-c[g+2])>=v)&&(n=!0)}g+=u,p.offset+=3}return y/=d,{update:n,averageGeometrySampledElevation:y}}function rGe(e){return!!e&&VT[e]!=null}function iGe(e){return 1/(VT[e]||1)}function sGe(){const e=Object.keys(VT);return e.sort(),e}const nGe=sGe(),oGe=K.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function aGe(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function Lft(e){const t=e&&e.expression;if(typeof t=="string"){const r=F0e(t);if(r!=null)return{cachedResult:r}}return null}async function Dft(e,t,r,i){const s=e&&e.expression;if(typeof s!="string")return null;const n=F0e(s);if(n!=null)return{cachedResult:n};const o=await J7();Jt(r);const a=o.arcadeUtils,l=a.createSyntaxTree(s);return a.dependsOnView(l)?(i?.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:t}),modules:o}}}function D0e(e,t,r){return e.arcadeUtils.createFeature(t.attributes,t.geometry,r)}function g4(e,t){if(e!=null&&!N0e(e)){if(!t||!e.arcade)return void oGe.errorOncePerTick("Arcade support required but not provided");const r=t;r._geometry&&(r._geometry=T0e(r._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function lGe(e){if(e!=null){if(N0e(e))return e.cachedResult;const t=e.arcade;let r=t?.modules.arcadeUtils.executeFunction(t.func,t.context);return typeof r!="number"&&(e.cachedResult=0,r=0),r}return 0}function Nft(e,t=!1){let r=e&&e.featureExpressionInfo;const i=r&&r.expression;return t||i==="0"||(r=null),r??null}const cGe={cachedResult:0};function N0e(e){return e.cachedResult!=null}function F0e(e){return e==="0"?0:null}class Vc{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(t){this._unit=t,this._metersPerElevationInfoUnit=iGe(t)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(t){this._meterUnitOffset=t,this._renderUnitOffset=0}set offsetElevationInfoUnits(t){this._meterUnitOffset=t*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(t){this._renderUnitOffset+=t}geometryZWithOffset(t,r){const i=this.calculateOffsetRenderUnits(r);return this.featureExpressionInfoContext!=null?i:t+i}calculateOffsetRenderUnits(t){let r=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return i!=null&&(r+=lGe(i)*this._metersPerElevationInfoUnit),r/t.unitInMeters+this._renderUnitOffset}setFromElevationInfo(t){this.mode=t.mode,this.unit=rGe(t.unit)?t.unit:"meters",this.offsetElevationInfoUnits=t.offset??0}updateFeatureExpressionInfoContext(t,r,i){if(t==null)return void(this._featureExpressionInfoContext=null);const s=t&&t.arcade;s&&r!=null&&i!=null?(this._featureExpressionInfoContext=aGe(t),g4(this._featureExpressionInfoContext,D0e(s.modules,r,i))):this._featureExpressionInfoContext=t}static fromElevationInfo(t){const r=new Vc;return t!=null&&r.setFromElevationInfo(t),r}}class uGe{constructor(t,r,i){this.graphic=t,this.renderingInfo=r,this.layer=i}}var Lt;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OPAQUE=2]="OPAQUE"})(Lt||(Lt={}));class hGe{constructor(t,r,i){this.baseMaterial=t,this.edgeMaterials=r,this.properties=i}}class pf{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(t,r,i,s,n,o,a,l=null){this.graphics3DSymbolLayer=t,this.stageObject=r,this._uniqueGeometries=i,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(t){this._stageLayer=t;const r=t.stage;r.addMany(this._uniqueMaterials),r.addMany(this._uniqueGeometries),r.add(this.stageObject)}destroy(){if(!this._stageLayer)return;const t=this._stageLayer.stage;t.removeMany(this._uniqueMaterials),t.removeMany(this._uniqueGeometries),t.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const r=t.renderer.ensureEdgeView();r.hasObject(this.stageObject)&&r.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource!=null&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(t,r){if(this._edgeState==null)return;const i=iQ(this._edgeState.baseMaterial);let s=!1;for(const n of this._edgeState.edgeMaterials)n.objectTransparency!==i&&(n.objectTransparency=i,s=!0);s&&this.resetEdgeObject(r),this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[t])}slicePlaneEnabledChanged(t,r){this._edgeState!=null&&(this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:t},!r),this._edgeState.properties.hasSlicePlane=t)}setVisibility(t){if(this._stageLayer!=null&&this._visible!==t&&(this._visible=t,this.stageObject.visible=t,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),this._edgeState)){const r=this._stageLayer.stage.renderer.ensureEdgeView();r.hasObject(this.stageObject)?r.updateObjectVisibility(this.stageObject,t):t&&this._addOrUpdateEdgeObject(r,!1)}}get visible(){return this._visible}alignWithElevation(t,r,i,s){if(this.elevationAligner==null)return;i!=null&&g4(this.elevationContext.featureExpressionInfoContext,i);const n=(o,a)=>Oy(o,t,this.elevationContext,r,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,t.spatialReference,n,r),this.resetEdgeObject(s)}alignWithAbsoluteElevation(t,r,i){const s=(n,o)=>{o.sampledElevation=t,o.verticalDistanceToGround=0,o.z=t};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,s,r),this.resetEdgeObject(i)}getCenterObjectSpace(t=C()){return re(t,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(t=Qs()){const r=this.stageObject.boundingVolumeObjectSpace;return Wue(t,r.min),que(t,r.max),t}computeAttachmentOrigin(t){if(this.useObjectOriginAsAttachmentOrigin){const r=this.stageObject.shaderTransformation;t.render.origin[0]+=r[12],t.render.origin[1]+=r[13],t.render.origin[2]+=r[14],t.render.num++}else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(wf)&&(Ue(wf,wf,this.stageObject.shaderTransformation),oe(t.render.origin,t.render.origin,wf),t.render.num++)}async getProjectedBoundingBox(t,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=dGe,l=lG(o)?1:a.length;for(let u=0;u<l;u++){const d=a[u];Rg[0]=o[d[0]],Rg[1]=o[d[1]],Rg[2]=o[d[2]],Ue(Rg,Rg,this.stageObject.transformation),o_[3*u]=Rg[0],o_[3*u+1]=Rg[1],o_[3*u+2]=Rg[2]}if(!t(o_,0,l))return null;mi(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],o_[u+d]),o[d+3]=Math.max(o[d+3],o_[u+d]);c&&i.push({location:o_.slice(u,u+3),screenSpaceBoundingRect:c})}if(r&&r.service&&this.elevationContext.mode!=="absolute-height"){td(o,wf);const u=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let d=0;if(r.useViewElevation)d=r.service.getElevation(wf[0],wf[1],u)??0;else try{const p=AH(o,r.service.spatialReference,r);d=await r.service.queryElevation(wf[0],wf[1],s,p,u)??0}catch{}Hue(o,0,0,-this.alignedSampledElevation+d)}return o}addObjectState(t,r){t===km.Highlight&&r.addObject(this.stageObject,this.stageObject.highlight()),t===km.MaskOccludee&&r.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(t){t.removeObject(this.stageObject)}resetEdgeObject(t){if(this._edgeState==null)return;const r=this._stageLayer.stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(r,t):r.removeObject(this.stageObject)}_addOrUpdateEdgeObject(t,r){const i=this._edgeState;if(i==null)return;const s=iQ(i.baseMaterial);for(const n of i.edgeMaterials)n.objectTransparency=s;t.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!r).then(()=>this._stageLayer?.sync())}}function iQ(e){return e.isVisible()?e.parameters.transparent?Lt.TRANSPARENT:Lt.OPAQUE:Lt.INVISIBLE}const o_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Rg=C(),wf=C(),dGe=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];class U0e{constructor(t,r=null){this.labelText=r,this.elevationOffset=t??0}}var xs;(function(e){e[e.RecreateSymbol=0]="RecreateSymbol",e[e.RecreateGraphics=1]="RecreateGraphics",e[e.FastUpdate=2]="FastUpdate"})(xs||(xs={}));class PH{constructor(t){this.schedule=t,this._abortController=null,this._loadStatus=mc.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(t,r){return this._loadStatus===mc.LOADED?(t&&t(),this._loader??Promise.resolve()):this._loadStatus===mc.FAILED?(r&&r(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=mc.LOADED},i=>{throw this._loadError=i,this._abortController=null,this._loadStatus=mc.FAILED,!$s(i)&&this.logger&&i.message&&this.logger.warn(i.message),i})),this._loader.then(t,r).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=$c(this._abortController):this._loadStatus===mc.LOADING&&(this._loadStatus=mc.FAILED),this._loader=null}}var mc;(function(e){e[e.LOADING=0]="LOADING",e[e.LOADED=1]="LOADED",e[e.FAILED=2]="FAILED"})(mc||(mc={}));const k0e=3,oB=3,z0e=10;class B0e{constructor(t,r=null){this.geometry=t,this.textures=r}}function ZR(e){const t=[];return e.levels.forEach(r=>r.components.forEach(i=>t.push(i.geometry.material))),AD(t)}function sQ(e){const t=new Array;return e.levels.forEach(r=>{r.components.forEach(i=>{i.textures!=null&&t.push(...i.textures)})}),AD(t)}function V0e(e){const t=e.components.map(r=>r.geometry);return AD(t)}function nQ(e){const t=[];return e.levels.forEach(r=>{r.components.forEach(i=>{t.push(i.geometry)})}),AD(t)}function pGe(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function G0e(e,t){const r=(i,s,n=!1)=>({levels:i.map(o=>{const a=s(o.tesselation);return n&&P6e(a),{components:[new B0e(a)],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(e){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],i=>A6e(t,.5,i,!0));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>_6e(t,1));case"cone":return r(O6,i=>rJ(t,1,.5,i,!1),!0);case"inverted-cone":return r(O6,i=>rJ(t,1,.5,i,!0),!0);case"cylinder":return r(O6,i=>R6e(t,1,.5,i,[0,0,1],[0,0,.5]));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>C6e(t,1),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>x6e(t,1),!0);default:return}}const O6=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function fGe(e){return e.type==="fill"}function mGe(e){return e.type==="extrude"}function gGe(e){return e&&e.enabled&&(mGe(e)||fGe(e))&&e.edges!=null}function yGe(e){return e&&e.enabled&&e.edges||null}function j0e(e,t){return _Ge(yGe(e),t)}function _Ge(e,t){if(e==null)return null;const r=e.color!=null?MG(ot.toUnitRGBA(e.color)):At(0,0,0,0),i=Ho(e.size),s=Ho(e.extensionLength);switch(e.type){case"solid":return vGe({color:r,size:i,extensionLength:s,...t});case"sketch":return bGe({color:r,size:i,extensionLength:s,...t});default:return}}function vGe(e){return{...wGe,...e,type:"solid"}}function bGe(e){return{...xGe,...e,type:"sketch"}}const wGe={color:At(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Lt.OPAQUE,hasSlicePlane:!1},xGe={color:At(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Lt.OPAQUE,hasSlicePlane:!1},MH={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function Fft(e){return e.type==="web-style"?MH:IH(e.symbolLayers.toArray().map(t=>H0e(e,t)))}function IH(e){let t=0,r=0,i=0,s=!1,n=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of e)a!=null&&(t+=a.primitivesPerFeature,r+=a.primitivesPerCoordinate,i+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,s=s||a.estimated,++n);return{primitivesPerFeature:t,primitivesPerCoordinate:r,drawCallsPerFeature:i,estimated:s,memory:o,numComplexities:n}}function Uft(e){const t=IH(e);return t.numComplexities>0&&(t.primitivesPerFeature/=t.numComplexities,t.primitivesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.bytesPerCoordinate/=t.numComplexities,t.memory.resourceBytes/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities,t.memory.draped.bytesPerCoordinate/=t.numComplexities),t}const oQ={};function H0e(e,t){const r=W0e(e,t),i=gGe(t)?2:0;switch(t.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:i,estimated:!1,memory:r};case"fill":return e.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:i,estimated:!1,memory:r}:t.outline!=null&&t.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:r}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:r};case"object":return t.resource?.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:r}:{...TGe(t.resource&&t.resource.primitive||she),memory:r};case"path":{let s=0,n=0;switch(t.profile){case"circle":s=z0e;break;case"quad":s=4;break;default:return void(t.profile,void 0)}switch(t.join??"simple"){case"round":n=k0e;break;case"miter":case"bevel":n=1;break;default:return}const o=2*s,a=s*n*2;let l=-2*a-o;switch(t.cap){case"none":break;case"butt":case"square":l+=2*(s-1);break;case"round":l+=2*(s*(oB-1)*2+s);break;default:return}return{primitivesPerFeature:l,primitivesPerCoordinate:a+o,drawCallsPerFeature:0,estimated:!1,memory:r}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:r};default:return}}function W0e(e,t){const r=e.type==="point-3d";switch(t.type){case"extrude":return t.edges&&t.edges.size>0?Oa.EXTRUDE_EDGES:Oa.EXTRUDE;case"fill":return t.outline!=null&&t.outline.size>0?Oa.FILL_OUTLINE:Oa.FILL;case"water":return Oa.FILL;case"line":return t.join==="round"?Oa.LINE_ROUND:Oa.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return Oa.PATH_ROUND_CIRCLE;case"quad":return Oa.PATH_ROUND_QUAD;default:return void(t.profile,void 0)}case"miter":case"bevel":switch(t.profile){case"circle":return Oa.PATH_MITER_CIRCLE;case"quad":return Oa.PATH_MITER_QUAD;default:return void(t.profile,void 0)}default:return}case"object":return r?Oa.OBJECT_POINT:Oa.OBJECT_POLYGON;case"icon":case"text":return r?Oa.ICON_POINT:Oa.ICON_POLYGON;default:return}}function TGe(e){let t=oQ[e];if(t)return t;const r=G0e(e,null);return t={primitivesPerFeature:V0e(r.levels[0]).reduce((i,s)=>i+s.indices.get(E.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},oQ[e]=t,t}const Oa={ICON_POINT:{bytesPerFeature:2321.5204640676384,bytesPerFeatureLabel:990.45722,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2169.5155951150787,bytesPerFeatureLabel:999.2598599999999,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:3822.4566594216512,bytesPerFeatureLabel:1004.4288266666666,bytesPerCoordinate:3.8232947206245864,resourceBytes:0,draped:{bytesPerFeature:3656.161389156324,bytesPerFeatureLabel:994.9227800000001,bytesPerCoordinate:3.836714603517761}},OBJECT_POINT:{bytesPerFeature:1286.2669145138564,bytesPerFeatureLabel:1011.4901900000001,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:1286.2669145138564,bytesPerFeatureLabel:1011.4901900000001,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:2796.828455517831,bytesPerFeatureLabel:1012.9951500000002,bytesPerCoordinate:4.051546356517487,resourceBytes:0,draped:{bytesPerFeature:2796.828455517831,bytesPerFeatureLabel:1012.9951500000002,bytesPerCoordinate:4.051546356517487}},LINE_MITER:{bytesPerFeature:4906.045480276492,bytesPerFeatureLabel:1002.8815266666666,bytesPerCoordinate:24.04850207798191,resourceBytes:0,draped:{bytesPerFeature:4315.785832179941,bytesPerFeatureLabel:998.7028333333334,bytesPerCoordinate:19.457038722015074}},LINE_ROUND:{bytesPerFeature:4893.576398024015,bytesPerFeatureLabel:1015.8812866666666,bytesPerCoordinate:24.039686621147293,resourceBytes:0,draped:{bytesPerFeature:4321.076505943878,bytesPerFeatureLabel:1008.7058400000001,bytesPerCoordinate:19.522527447599565}},PATH_MITER_CIRCLE:{bytesPerFeature:27475.37385725739,bytesPerFeatureLabel:945.1915,bytesPerCoordinate:1936.190695268645,resourceBytes:0,draped:{bytesPerFeature:27475.37385725739,bytesPerFeatureLabel:945.1915,bytesPerCoordinate:1936.190695268645}},PATH_ROUND_CIRCLE:{bytesPerFeature:13432.532036888486,bytesPerFeatureLabel:949.8167000000001,bytesPerCoordinate:4250.913048917402,resourceBytes:0,draped:{bytesPerFeature:13432.532036888486,bytesPerFeatureLabel:949.8167000000001,bytesPerCoordinate:4250.913048917402}},PATH_MITER_QUAD:{bytesPerFeature:17083.041162790672,bytesPerFeatureLabel:1006.4104,bytesPerCoordinate:1543.9135284683243,resourceBytes:0,draped:{bytesPerFeature:17083.041162790672,bytesPerFeatureLabel:1006.4104,bytesPerCoordinate:1543.9135284683243}},PATH_ROUND_QUAD:{bytesPerFeature:24054.406240577355,bytesPerFeatureLabel:976.0122999999999,bytesPerCoordinate:2683.863857257418,resourceBytes:0,draped:{bytesPerFeature:24054.406240577355,bytesPerFeatureLabel:976.0122999999999,bytesPerCoordinate:2683.863857257418}},FILL:{bytesPerFeature:5336.950602511737,bytesPerFeatureLabel:993.6785799999999,bytesPerCoordinate:9.558162275921951,resourceBytes:0,draped:{bytesPerFeature:4643.732435264264,bytesPerFeatureLabel:1003.6394400000001,bytesPerCoordinate:8.123952159573538}},FILL_OUTLINE:{bytesPerFeature:8210.8457089066,bytesPerFeatureLabel:1006.2871066666667,bytesPerCoordinate:14.496686428135353,resourceBytes:0,draped:{bytesPerFeature:6982.149803527473,bytesPerFeatureLabel:1005.1158800000001,bytesPerCoordinate:11.034666572000932}},EXTRUDE:{bytesPerFeature:16336.386002724352,bytesPerFeatureLabel:1013.2957066666665,bytesPerCoordinate:40.50904192903909,resourceBytes:0,draped:{bytesPerFeature:16336.386002724352,bytesPerFeatureLabel:1013.2957066666665,bytesPerCoordinate:40.50904192903909}},EXTRUDE_EDGES:{bytesPerFeature:18251.260762353977,bytesPerFeatureLabel:1044.1864133333333,bytesPerCoordinate:40.594518397678755,resourceBytes:0,draped:{bytesPerFeature:18251.260762353977,bytesPerFeatureLabel:1044.1864133333333,bytesPerCoordinate:40.594518397678755}}},Db=K.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class ff extends PH{constructor(t,r,i,s){super(i.schedule),this.symbol=t,this.symbolLayer=r,this._context=i,this._elevationInfoOverride=null,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=Db,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new Vc,this.complexity=this.computeComplexity(),this.ignoreDrivers=s.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=aQ(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(t){if(this.ignoreDrivers)return!1;const r=this._drivenProperties,i=aQ(t);return i.color!==r.color||i.opacity!==r.opacity||i.opacityAlwaysOpaque!==r.opacityAlwaysOpaque||i.size!==r.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(t,r,i,s){const n=t.projectionSuccess,o="polygons"in t?t.polygons:null,a=`${s} geometry failed to be created`;let l=null;n?!this._logGeometryValidationWarnings(r,i,s)&&o&&o.length===0&&i==="rings"&&r.length>0&&r[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (failed to project geometry to view spatial reference)`,l&&Db.warnOncePerTick(l)}_logGeometryValidationWarnings(t,r,i){const s=`${i} geometry failed to be created`;return!t.length||t.length===1&&!t[0].length?(Db.warnOncePerTick(`${s} (no ${r} were defined)`),!0):(!Array.isArray(t)||!Array.isArray(t[0]))&&(Db.warnOncePerTick(`${s} (${r} should be defined as a 2D array)`),!0)}_validateGeometry(t,r=null,i=null){if(r!=null&&!r.includes(t.type))return this.logger.warn("unsupported geometry type for "+i+` symbol: ${t.type}`),!1;if(t.type==="point"){const s=t;if(!isFinite(s.x)||!isFinite(s.y))return Db.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return SGe}_defaultElevationInfoZ(){return EGe}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(t){return t.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(t,r=this.getDefaultElevationInfo(t)){return this._elevationContext.mode||r.mode}setElevationInfoOverride(t){this._elevationInfoOverride=t,this._updateElevationContext()}setGraphicElevationContext(t,r){const i=t.geometry,s=this.getDefaultElevationInfo(i);r.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,r.mode=this.getGeometryElevationMode(i,s),r.offsetMeters=this._elevationContext.meterUnitOffset??s.offset??0;const n=!this._elevationOptions.supportsOnTheGround&&r.mode==="on-the-ground";n&&(r.mode="relative-to-ground",r.offsetMeters=0);const o=n?cGe:this._elevationContext.featureExpressionInfoContext;return r.updateFeatureExpressionInfoContext(o,t,this._context.layer),r}prepareSymbolLayerPatch(t){}updateGeometry(t,r){return!1}updateTransform(t,r,i,s){return!1}onRemoveGraphic(t){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(t,r=lQ){let i=1;return this.draped||(i*=this._getLayerOpacity()),this._drivenProperties.opacity||(t!=null?i*=t.a:r.hasIntrinsicColor||(i=0)),i}_getCombinedOpacityAndColor(t,r=lQ){const i=this._getCombinedOpacity(t,r);if(this._drivenProperties.color)return IC(null,i);const s=t!=null?ot.toUnitRGB(t):cm;return IC(s,i)}_getVertexOpacityAndColor(t,r=null){const i=this._drivenProperties.color?t.color:null,s=this._drivenProperties.opacity?t.opacity:null,n=IC(i,s);return r&&(n[0]*=r,n[1]*=r,n[2]*=r,n[3]*=r),n}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return H0e(this.symbol,this.symbolLayer)}globalPropertyChanged(t,r,i){switch(t){case"opacity":return this.layerOpacityChanged(r,i),!0;case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(r,i,s)!==Qi.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(r,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(t,r,i){let s=Qi.UPDATE;return t.forEach(n=>{const o=r(n);if(o!=null){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=i(o.elevationContext.mode)}else s=Qi.RECREATE}),s}applyRendererDiff(t,r){return xs.RecreateSymbol}getFastUpdateAttrValues(t){if(!this._fastUpdates)return null;const r=this._fastUpdates.visualVariables,i=r.size?pd(r.size.field,t):0,s=r.color?pd(r.color.field,t):0,n=r.opacity?pd(r.opacity.field,t):0;return At(i,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(t){return this._draped==null?(this._draped=t,!0):(t!==this.draped&&Db.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const t=()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null});return{drivenProperties:this._drivenProperties,getVisVarFields:t}}}function aQ(e){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach(r=>{switch(r.type){case"color":if(t.color=!0,r.stops)for(let i=0;i<r.stops.length;i++){const s=r.stops[i].color;s&&(t.opacity=!0,s.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0}}),t}const SGe={mode:"on-the-ground",offset:0,unit:"meters"},EGe={mode:"absolute-height",offset:0,unit:"meters"},lQ={hasIntrinsicColor:!1};class ng extends W3{get geometries(){return this._geometries}get transformation(){return this._transformation??Ks}set transformation(t){this._transformation=Ss(this._transformation??be(),t),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}get shaderTransformation(){return this._shaderTransformation??this.transformation}set shaderTransformation(t){this._shaderTransformation=Ss(this._shaderTransformation??be(),t),this._invalidateBoundingVolume(),this._emit("objectShaderTransformation",this)}clearShaderTransformation(){this._shaderTransformation=void 0,this._invalidateBoundingVolume(),this._emit("objectShaderTransformation",this)}constructor(t={}){super(),this.type=Ki.Object,this._hasVolatileTransformation=!1,this._parentLayer=null,this._visible=!0,this.castShadow=t.castShadow??!0,this.usesVerticalDistanceToGround=t.usesVerticalDistanceToGround??!1,this.graphicUid=t.graphicUid,this.layerUid=t.layerUid,t.isElevationSource&&(this.lastValidElevationBB=new q0e),this._geometries=t.geometries?Array.from(t.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(t){Ye(this._parentLayer==null||t==null,"Object3D can only be added to a single Layer"),this._parentLayer=t}addGeometry(t){t.visible=this._visible,this._geometries.push(t),this._hasVolatileTransformation=this._hasVolatileTransformation||t.hasVolatileTransformation,this._emit("objectGeometryAdded",{object:this,geometry:t}),this._invalidateBoundingVolume()}removeGeometry(t){const r=this._geometries.splice(t,1)[0];r&&(this._emit("objectGeometryRemoved",{object:this,geometry:r}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(t){this._emit("objectGeometryUpdated",{object:this,geometry:t}),this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(t){if(this._visible!==t){this._visible=t;for(const r of this._geometries)r.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const t=new bL(km.MaskOccludee);for(const r of this._geometries)r.occludees=Tz(r.occludees,t);return this._emit("occlusionChanged",this),t}removeOcclude(t){for(const r of this._geometries)r.occludees=Sz(r.occludees,t);this._emit("occlusionChanged",this)}highlight(){const t=new bL(km.Highlight);for(const r of this._geometries)r.highlights=Tz(r.highlights,t);return this._emit("highlightChanged",this),t}removeHighlight(t){for(const r of this._geometries)r.highlights=Sz(r.highlights,t);this._emit("highlightChanged",this)}getCombinedStaticTransformation(t,r){return Jr(r,this.transformation,t.transformation)}getCombinedShaderTransformation(t,r=be()){return Jr(r,this.shaderTransformation,t.shaderTransformation)}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._bvWorldSpace&&!this._hasVolatileTransformation||(this._bvWorldSpace=this._bvWorldSpace||new cQ,this._validateBoundingVolume(this._bvWorldSpace,$C.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace&&!this._hasVolatileTransformation||(this._bvObjectSpace=this._bvObjectSpace||new cQ,this._validateBoundingVolume(this._bvObjectSpace,$C.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(t,r){const i=r===$C.ObjectSpace;for(const s of this._geometries){const n=s.boundingInfo;n&&CGe(n,t,i?s.shaderTransformation:this.getCombinedShaderTransformation(s))}Lr(t.bounds,t.min,t.max,.5);for(const s of this._geometries){const n=s.boundingInfo;if(n==null)continue;const o=i?s.shaderTransformation:this.getCombinedShaderTransformation(s),a=_T(o);Ue(uQ,n.center,o);const l=ni(uQ,t.bounds),c=n.radius*a;t.bounds[3]=Math.max(t.bounds[3],l+c)}}_invalidateBoundingVolume(){const t=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&t&&this._parentLayer.notifyObjectBBChanged(this,t)}_emit(t,r){this._parentLayer&&this._parentLayer.events.emit(t,r)}get test(){const t=this;return{hasGeometry:r=>t._geometries.includes(r),getGeometryIndex:r=>t._geometries.indexOf(r)}}}class q0e{constructor(){this.min=Ce(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Ce(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class cQ extends q0e{constructor(){super(...arguments),this.bounds=ls()}}function CGe(e,t,r){const i=e.bbMin,s=e.bbMax;if(vN(r)){const n=se(AGe,r[12],r[13],r[14]);oe(Jl,i,n),oe(mh,s,n);for(let o=0;o<3;++o)t.min[o]=Math.min(t.min[o],Jl[o]),t.max[o]=Math.max(t.max[o],mh[o])}else if(Ue(Jl,i,r),Go(i,s))for(let n=0;n<3;++n)t.min[n]=Math.min(t.min[n],Jl[n]),t.max[n]=Math.max(t.max[n],Jl[n]);else{Ue(mh,s,r);for(let n=0;n<3;++n)t.min[n]=Math.min(t.min[n],Jl[n],mh[n]),t.max[n]=Math.max(t.max[n],Jl[n],mh[n]);for(let n=0;n<3;++n){re(Jl,i),re(mh,s),Jl[n]=s[n],mh[n]=i[n],Ue(Jl,Jl,r),Ue(mh,mh,r);for(let o=0;o<3;++o)t.min[o]=Math.min(t.min[o],Jl[o],mh[o]),t.max[o]=Math.max(t.max[o],Jl[o],mh[o])}}}const AGe=C(),Jl=C(),mh=C(),uQ=C();var $C;(function(e){e[e.WorldSpace=0]="WorldSpace",e[e.ObjectSpace=1]="ObjectSpace"})($C||($C={}));function $H(e,t,r,i,s,n){const o=e.clippingExtent;if(no(t,J0,e.elevationProvider.spatialReference),o!=null&&!oG(o,J0))return null;no(t,J0,e.renderCoordsHelper.spatialReference),r.shaderTransformer=n,r.localOrigin=e.localOriginFactory.getOrigin(J0);const a=new ng({geometries:[r],castShadow:!1,layerUid:e.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0});return{object:a,sampledElevation:j7e(a,t,e.elevationProvider,e.renderCoordsHelper,i)}}function YA(e,t,r){const i=e.elevationContext,s=r.spatialReference;no(t,J0,s),i.centerPointInElevationSR=cb(J0[0],J0[1],t.hasZ?J0[2]:0,s??null)}function JA(e){switch(e.type){case"point":return e;case"polygon":case"extent":return CH(e);case"polyline":{const t=e.paths[0];if(!t||t.length===0)return null;const r=Wce(t,Hce(t)/2);return cb(r[0],r[1],r[2],e.spatialReference)}case"mesh":return e.origin}return null}const J0=C();function X0e(){return new Float32Array(2)}function OGe(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t}function Cu(e,t){const r=new Float32Array(2);return r[0]=e,r[1]=t,r}function RGe(e,t){return new Float32Array(e,t,2)}function Z0e(){return X0e()}function Y0e(){return Cu(1,1)}function J0e(){return Cu(1,0)}function K0e(){return Cu(0,1)}const Q0e=Z0e(),eye=Y0e(),PGe=J0e(),MGe=K0e();Object.freeze(Object.defineProperty({__proto__:null,ONES:eye,UNIT_X:PGe,UNIT_Y:MGe,ZEROS:Q0e,clone:OGe,create:X0e,createView:RGe,fromValues:Cu,ones:Y0e,unitX:J0e,unitY:K0e,zeros:Z0e},Symbol.toStringTag,{value:"Module"}));function IGe(e){const t=new pr,{vertex:r,fragment:i}=t;return r.include(a4),t.include(yge,e),t.include(os,e),t.attributes.add(E.UV0,"vec2"),r.uniforms.add(new Zt("viewport",(s,n)=>n.camera.fullViewport),new Ae("lineSize",(s,n)=>s.size>0?Math.max(1,s.size)*n.camera.pixelRatio:0),new yr("pixelToNDC",(s,n)=>Qt(dQ,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new Ae("borderSize",(s,n)=>s.borderColor!=null?n.camera.pixelRatio:0),new yr("screenOffset",(s,n)=>Qt(dQ,s.screenOffset[0]*n.camera.pixelRatio,s.screenOffset[1]*n.camera.pixelRatio))),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),e.hasMultipassGeometry&&t.varyings.add("depth","float"),e.hasScreenSizePerspective&&o4(r),r.code.add(b`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${e.occlusionTestEnabled?b`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${e.hasScreenSizePerspective?b`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:b`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${e.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${e.depthHudEnabled?e.depthHudAlignStartEnabled?b`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:b`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${e.hasScreenSizePerspective?b`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:b`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),i.uniforms.add(new Zt("uColor",s=>hQ(s.color)),new Zt("borderColor",s=>hQ(s.borderColor))),e.hasMultipassGeometry&&(i.include(xfe,e),i.uniforms.add(new yr("inverseViewport",(s,n)=>n.inverseViewport))),i.code.add(b`
    void main() {
      ${e.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${e.depthHudEnabled?b`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:b`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),t}function hQ(e){return e??Up}const dQ=Ne(),$Ge=Object.freeze(Object.defineProperty({__proto__:null,build:IGe},Symbol.toStringTag,{value:"Module"}));class y4 extends xr{initializeConfiguration(t,r){r.spherical=t.viewingMode===Ie.Global}initializeProgram(t){return new vr(t.rctx,y4.shader.get().build(this.configuration),dr)}setPipelineState(t){const r=t?Hr.ALWAYS:Hr.LESS;return this.configuration.depthHudEnabled?Tt({depthTest:{func:r},depthWrite:Ka}):Tt({blending:oo(ve.ONE,ve.SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),depthTest:{func:r},colorWrite:It})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}}y4.shader=new _r($Ge,()=>ue(()=>import("./LineCallout.glsl.8c713588.js"),[]));class uu extends bo{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=Ha.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}}h([B({count:Ha.COUNT})],uu.prototype,"screenCenterOffsetUnitsEnabled",void 0),h([B()],uu.prototype,"spherical",void 0),h([B()],uu.prototype,"occlusionTestEnabled",void 0),h([B()],uu.prototype,"hasVerticalOffset",void 0),h([B()],uu.prototype,"hasScreenSizePerspective",void 0),h([B()],uu.prototype,"depthHudEnabled",void 0),h([B()],uu.prototype,"depthHudAlignStartEnabled",void 0),h([B()],uu.prototype,"hasSlicePlane",void 0),h([B()],uu.prototype,"hasMultipassGeometry",void 0),h([B({constValue:!0})],uu.prototype,"hasSliceInVertexProgram",void 0),h([B({constValue:!1})],uu.prototype,"draped",void 0);class Lv extends Fy{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(t){super(t,new tye),this._configuration=new uu,this._uniqueMaterialIdentifier=Lv.uniqueMaterialIdentifier(this.parameters)}getPassParameters(){return this.parameters}getConfiguration(t,r){const i=r?.slot!==ae.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.depthHudEnabled=i,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Ha.Screen:Ha.World,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration}intersect(){}requiresSlot(t,r){if(r===D.Color)switch(t){case ae.LINE_CALLOUTS:case ae.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(t){return new LGe(t)}createBufferWriter(){return new NGe}validateParameters(t){const r=Lv.uniqueMaterialIdentifier(t);r!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=r)}static uniqueMaterialIdentifier(t){return JSON.stringify({screenOffset:t.screenOffset||[0,0],centerOffsetUnits:t.centerOffsetUnits||"world"})}}class LGe extends Ny{beginSlot(t){return this.ensureTechnique(y4,t)}}class tye extends pH{constructor(){super(...arguments),this.screenOffset=vd,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}const DGe=Li().vec3f(E.POSITION).vec3f(E.NORMAL).vec2f(E.UV0).vec4f(E.AUXPOS1),pQ=[Cu(0,0),Cu(1,0),Cu(0,1),Cu(1,0),Cu(1,1),Cu(0,1)];class NGe{constructor(){this.vertexBufferLayout=DGe}elementCount(t){return 6*t.indices.get(E.POSITION).length}write(t,r,i,s,n){fH(i.indices.get(E.POSITION),i.vertexAttributes.get(E.POSITION).data,t,s.position,n,6),mH(i.indices.get(E.NORMAL),i.vertexAttributes.get(E.NORMAL).data,r,s.normal,n,6),BT(i.indices.get(E.AUXPOS1),i.vertexAttributes.get(E.AUXPOS1).data,s.auxpos1,n,6);for(let o=0;o<pQ.length;++o)s.uv0.setVec(n+o,pQ[o])}}class _4 extends ff{constructor(t,r){super(t,null,r,kGe),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new Lv(this._materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(t){const r=this._materialParameters;return r.screenOffset=t.screenOffset||vd,r.centerOffsetUnits=t.centerOffsetUnits||"world",r}get _materialParameters(){const t=new tye,r=this.symbol,i=r.callout;if(t.color=i.color!=null?ot.toUnitRGBA(i.color):[0,0,0,0],t.color[3]*=this._getLayerOpacity(),t.size=Ho(i.size||0),r.verticalOffset){const{screenLength:o,minWorldLength:a,maxWorldLength:l}=r.verticalOffset;t.verticalOffset={screenLength:Ho(o),minWorldLength:a||0,maxWorldLength:l??1/0}}t.borderColor=i.border!=null&&i.border.color!=null?ot.toUnitRGBA(i.border.color):null;const s=r.symbolLayers.at(0).type==="object",n=r.type==="label-3d";return t.occlusionTest=!s,t.shaderPolygonOffset=s?0:void 0,t.depthHUDAlignStart=n,t.hasSlicePlane=this._context.slicePlaneEnabled,t.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,t}_defaultElevationInfoNoZ(){return UGe}createGraphics3DGraphic(t){const r=t.renderingInfo,i=t.graphic,s=this.setGraphicElevationContext(i,new Vc,r.elevationOffset||0),n=r.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!uhe(l)))return null;const a=CH(i.geometry);return a==null?null:this._createAs3DShape(a,s,r,i.uid)}layerOpacityChanged(){this._material?.setParameters(this._materialParameters)}layerElevationInfoChanged(t,r,i){const s=this._elevationContext.mode,n=tO(_4.elevationModeChangeTypes,i,s);return n!==Qi.UPDATE||t.forEach(o=>{const a=r(o);a!=null&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){return this._material?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(t,r,i=0){const s=super.setGraphicElevationContext(t,r);return s.addOffsetRenderUnits(i),s}updateGraphicElevationContext(t,r){this.setGraphicElevationContext(t,r.elevationContext,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=th(r.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:MH.memory}}_createVertexData(t){const{translation:r,centerOffset:i}=t,s=new Fe(r?[r[0],r[1],r[2]]:[0,0,0],3,!0),n=new Fe(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],4,!0);return[[E.POSITION,s],[E.NORMAL,new Fe([0,0,1],3,!0)],[E.AUXPOS1,n]]}_getOrCreateMaterial(t){const r=this._perInstanceMaterialParameters(t),i=Lv.uniqueMaterialIdentifier(r);if(this._material&&i===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(t.materialCollection!=null){let s=t.materialCollection.get(i);return s==null&&(s=new Lv(r),t.materialCollection.add(i,s)),{material:s,isUnique:!1}}return{material:new Lv(r),isUnique:!0}}_createAs3DShape(t,r,i,s){const n=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:n}),a=this._getOrCreateMaterial(i),l=new Cs(a.material,this._createVertexData(i),FGe,null,Ki.Point,o),c=$H(this._context,t,l,r,s);if(c==null)return null;const u=new pf(this,c.object,[l],a.isUnique?[a.material]:null,null,Wv,r);return u.metadata=new U0e(i.elevationOffset),u.alignedSampledElevation=c.sampledElevation,u.needsElevationUpdates=th(r.mode),YA(u,t,this._context.elevationProvider),u}}_4.elevationModeChangeTypes={definedChanged:Qi.UPDATE,staysOnTheGround:Qi.UPDATE,onTheGroundChanged:Qi.RECREATE};const R6=[0],FGe=[[E.POSITION,R6],[E.NORMAL,R6],[E.AUXPOS1,R6]],UGe={mode:"relative-to-ground",offset:0},kGe={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};class zGe{constructor(t,r,i=C(),s=Ht(),n=Ne(),o="world",a=0,l=null){this.renderer=t,this.symbol=r,this.translation=i,this.centerOffset=s,this.screenOffset=n,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}}class BGe extends uGe{}const fQ=K.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function VGe(e,t){if(!mG(e))return fQ.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const r=GGe[e.callout.type];return r?new r(e,t):(fQ.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${e.callout.type}`),null)}const GGe={line:_4};class Gm{constructor(t=null,r={},i,s){this.geometry=t,this.attributes=r,this.centroid=i,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const t=new Gm(this.geometry,this.attributes,this.centroid,this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}}function kft(e){return!(e.geometry==null||!e.geometry.coords||!e.geometry.coords.length)}class zft extends Gm{}class LH{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const t=new LH;return t.objectIdFieldName=this.objectIdFieldName,t.globalIdFieldName=this.globalIdFieldName,t.geohashFieldName=this.geohashFieldName,t.geometryProperties=this.geometryProperties,t.geometryType=this.geometryType,t.spatialReference=this.spatialReference,t.hasZ=this.hasZ,t.hasM=this.hasM,t.features=this.features,t.fields=this.fields,t.transform=this.transform,t.exceededTransferLimit=this.exceededTransferLimit,t.uniqueIdField=this.uniqueIdField,t.queryGeometry=this.queryGeometry,t.queryGeometryType=this.queryGeometryType,t}}class Vu{constructor(t=[],r=[],i=!1){this.lengths=t??[],this.coords=r??[],this.hasIndeterminateRingOrder=i}static fromRect(t){const[r,i,s,n]=t,o=s-r,a=n-i;return new Vu([5],[r,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((t,r)=>t+r)}forEachVertex(t){let r=0;this.lengths.length||t(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const s=this.lengths[i];for(let n=0;n<s;n++)t(this.coords[2*(n+r)],this.coords[2*(n+r)+1]);r+=s}}clone(t){return t?(t.set(this.coords),new Vu(this.lengths.slice(),t,this.hasIndeterminateRingOrder)):new Vu(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}function Zo(e,t){return e?t?4:3:t?3:2}const iO=K.getLogger("esri.layers.graphics.featureConversionUtils"),rye={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},jGe=(e,t,r,i,s,n)=>{e[r]=s,e[r+1]=n},mQ=(e,t,r,i,s,n)=>{e[r]=s,e[r+1]=n,e[r+2]=t[i+2]},HGe=(e,t,r,i,s,n)=>{e[r]=s,e[r+1]=n,e[r+2]=t[i+3]},WGe=(e,t,r,i,s,n)=>{e[r]=s,e[r+1]=n,e[r+2]=t[i+2],e[r+3]=t[i+3]};function DH(e,t,r,i){if(e){if(r)return t&&i?WGe:mQ;if(t&&i)return HGe}else if(t&&i)return mQ;return jGe}function P6({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function M6({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function I6({scale:e,translate:t},r,i){return r*e[i]+t[i]}function Bft(e,t,r){return e?t?r?UH(e):NH(e):r?FH(e):v4(e):null}function v4(e){const t=e.coords;return{x:t[0],y:t[1]}}function iye(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function NH(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function qGe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function FH(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function XGe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function UH(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function ZGe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function YGe(e,t,r,i){let s=v4;r&&i?s=UH:r?s=NH:i&&(s=FH);for(const n of t){const{geometry:o,attributes:a}=n,l=o!=null?s(o):null;e.push({attributes:a,geometry:l})}return e}function kH(e,t){return e&&t?ZGe:e?qGe:t?XGe:iye}function JGe(e,t,r,i,s){const n=kH(r,i);for(const{geometry:o,attributes:a}of t){const l=o!=null?n(new Vu,o):null;e.push(new Gm(l,a,null,s?a[s]:void 0))}return e}function Vft(e,t,r=kH(t.z!=null,t.m!=null)){return r(e,t)}function KGe(e,t,r,i){for(const{geometry:s,attributes:n}of t)e.push({attributes:n,geometry:s!=null?sye(s,r,i):null});return e}function sye(e,t,r){if(e==null)return null;const i=Zo(t,r),s=[];for(let n=0;n<e.coords.length;n+=i){const o=[];for(let a=0;a<i;a++)o.push(e.coords[n+a]);s.push(o)}return t?r?{points:s,hasZ:t,hasM:r}:{points:s,hasZ:t}:r?{points:s,hasM:r}:{points:s}}function QGe(e,t,r,i,s){const n=Zo(r,i);for(const{geometry:o,attributes:a}of t){const l=o!=null?nye(new Vu,o,n):null;e.push(new Gm(l,a,null,s?a[s]:void 0))}return e}function nye(e,t,r=Zo(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const i=e.coords;let s=0;for(const n of t.points)for(let o=0;o<r;o++)i[s++]=n[o];return e}function eje(e,t,r,i){for(const{geometry:s,attributes:n}of t)e.push({attributes:n,geometry:s!=null?oye(s,r,i):null});return e}function oye(e,t,r){if(!e)return null;const i=Zo(t,r),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const c=[];for(let u=0;u<l;u++){const d=[];for(let p=0;p<i;p++)d.push(s[a++]);c.push(d)}o.push(c)}return t?r?{paths:o,hasZ:t,hasM:r}:{paths:o,hasZ:t}:r?{paths:o,hasM:r}:{paths:o}}function tje(e,t,r,i,s){const n=Zo(r,i);for(const{geometry:o,attributes:a}of t){const l=o!=null?aye(new Vu,o,n):null;e.push(new Gm(l,a,null,s?a[s]:void 0))}return e}function aye(e,t,r=Zo(t.hasZ,t.hasM)){const{lengths:i,coords:s}=e;let n=0;for(const o of t.paths){for(const a of o)for(let l=0;l<r;l++)s[n++]=a[l];i.push(o.length)}return e}function rje(e,t,r,i){for(const{geometry:s,attributes:n,centroid:o}of t){const a=s!=null?lye(s,r,i):null;if(o!=null){const l=v4(o);e.push({attributes:n,centroid:l,geometry:a})}else e.push({attributes:n,geometry:a})}return e}function lye(e,t,r){if(!e)return null;const i=Zo(t,r),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const c=[];for(let u=0;u<l;u++){const d=[];for(let p=0;p<i;p++)d.push(s[a++]);c.push(d)}o.push(c)}return t?r?{rings:o,hasZ:t,hasM:r}:{rings:o,hasZ:t}:r?{rings:o,hasM:r}:{rings:o}}function ije(e,t,r,i,s){for(const{geometry:n,centroid:o,attributes:a}of t){const l=n!=null?cye(new Vu,n,r,i):null,c=s?a[s]:void 0;o!=null?e.push(new Gm(l,a,iye(new Vu,o),c)):e.push(new Gm(l,a,null,c))}return e}function cye(e,t,r=t.hasZ,i=t.hasM){return sje(e,t.rings,r,i)}function sje(e,t,r,i){const s=Zo(r,i),{lengths:n,coords:o}=e;let a=0;xm(e);for(const l of t){for(const c of l)for(let u=0;u<s;u++)o[a++]=c[u];n.push(l.length)}return e}const Bx=[],LC=[];function Gft(e,t,r,i,s){Bx[0]=e;const[n]=uye(LC,Bx,t,r,i,s);return Td(Bx),Td(LC),n}function uye(e,t,r,i,s,n){if(Td(e),!r){for(const o of t){const a=n?o.attributes[n]:void 0;e.push(new Gm(null,o.attributes,null,a))}return e}switch(r){case"esriGeometryPoint":return JGe(e,t,i,s,n);case"esriGeometryMultipoint":return QGe(e,t,i,s,n);case"esriGeometryPolyline":return tje(e,t,i,s,n);case"esriGeometryPolygon":return ije(e,t,i,s,n);default:iO.error("convertToFeatureSet:unknown-geometry",new G(`Unable to parse unknown geometry type '${r}'`)),Td(e)}return e}function jft(e,t,r,i){LC[0]=e,hye(Bx,LC,t,r,i);const s=Bx[0];return Td(Bx),Td(LC),s}function nje(e,t,r){if(e==null)return null;const i=new Vu;return"hasZ"in e&&t==null&&(t=e.hasZ),"hasM"in e&&r==null&&(r=e.hasM),W7(e)?kH(t??e.z!=null,r??e.m!=null)(i,e):X7(e)?cye(i,e,t,r):q7(e)?aye(i,e,Zo(t,r)):H7(e)?nye(i,e,Zo(t,r)):void iO.error("convertFromGeometry:unknown-geometry",new G(`Unable to parse unknown geometry type '${e}'`))}function oje(e,t,r,i){const s=e&&("coords"in e?e:e.geometry);if(s==null)return null;switch(t){case"esriGeometryPoint":{let n=v4;return r&&i?n=UH:r?n=NH:i&&(n=FH),n(s)}case"esriGeometryMultipoint":return sye(s,r,i);case"esriGeometryPolyline":return oye(s,r,i);case"esriGeometryPolygon":return lye(s,r,i);default:return iO.error("convertToGeometry:unknown-geometry",new G(`Unable to parse unknown geometry type '${t}'`)),null}}function aje(e,t){for(const r of t)e.push({attributes:r.attributes});return e}function hye(e,t,r,i,s){if(Td(e),r==null)return aje(e,t);switch(r){case"esriGeometryPoint":return YGe(e,t,i,s);case"esriGeometryMultipoint":return KGe(e,t,i,s);case"esriGeometryPolyline":return eje(e,t,i,s);case"esriGeometryPolygon":return rje(e,t,i,s);default:iO.error("convertToFeatureSet:unknown-geometry",new G(`Unable to parse unknown geometry type '${r}'`))}return e}function Hft(e){const{objectIdFieldName:t,spatialReference:r,transform:i,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:d,queryGeometryType:p}=e,g={features:hye([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:t,spatialReference:r,uniqueIdField:u,queryGeometry:oje(d,p,!1,!1)};return i&&(g.transform=i),c&&(g.exceededTransferLimit=c),n&&(g.hasM=n),o&&(g.hasZ=o),g}function Wft(e,t){const r=new LH,{hasM:i,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:u,fields:d}=e;return d&&(r.fields=d),r.geometryType=l??null,r.objectIdFieldName=o??t??null,r.spatialReference=a??null,r.objectIdFieldName?(n&&uye(r.features,n,l,s,i,r.objectIdFieldName),c&&(r.exceededTransferLimit=c),i&&(r.hasM=i),s&&(r.hasZ=s),u&&(r.transform=u),r):(iO.error(new G("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function qft(e){const{transform:t,features:r,hasM:i,hasZ:s}=e;if(!t)return e;for(const n of r)n.geometry!=null&&yQ(n.geometry,n.geometry,i,s,t),n.centroid!=null&&yQ(n.centroid,n.centroid,i,s,t);return e.transform=null,e}function Xft(e,t){const{geometryType:r,features:i,hasM:s,hasZ:n}=t;if(!e)return t;for(let o=0;o<i.length;o++){const a=i[o],l=a.weakClone();l.geometry=new Vu,gQ(l.geometry,a.geometry,s,n,r,e),a.centroid&&(l.centroid=new Vu,gQ(l.centroid,a.centroid,s,n,"esriGeometryPoint",e)),i[o]=l}return t.transform=e,t}function gQ(e,t,r,i,s,n,o=r,a=i){if(xm(e),t==null||!t.coords.length)return null;const l=rye[s],{coords:c,lengths:u}=t,d=Zo(r,i),p=Zo(r&&o,i&&a),g=DH(r,i,o,a);if(!u.length)return g(e.coords,c,0,0,P6(n,c[0]),M6(n,c[1])),xm(e,d,0),e;let y,_,v,w,T=0,x=0,S=x;for(const O of u){if(O<l)continue;let A=0;x=S,v=y=P6(n,c[T]),w=_=M6(n,c[T+1]),g(e.coords,c,x,T,v,w),A++,T+=d,x+=p;for(let $=1;$<O;$++,T+=d)v=P6(n,c[T]),w=M6(n,c[T+1]),v===y&&w===_||(g(e.coords,c,x,T,v-y,w-_),x+=p,A++,y=v,_=w);A>=l&&(e.lengths.push(A),S=x)}return Td(e.coords,S),e.coords.length?e:null}function Zft(e,t,r,i,s,n,o=r,a=i){if(xm(e),!t||!t.coords.length)return null;const l=rye[s],{coords:c,lengths:u}=t,d=Zo(r,i),p=Zo(r&&o,i&&a),g=DH(r,i,o,a);if(!u.length)return g(e.coords,c,0,0,c[0],c[1]),xm(e,d,0),e;let y=0;const _=n*n;for(const v of u){if(v<l){y+=v*d;continue}const w=e.coords.length/p,T=y,x=y+(v-1)*d;g(e.coords,c,e.coords.length,T,c[T],c[T+1]),aB(e.coords,c,d,_,g,T,x),g(e.coords,c,e.coords.length,x,c[x],c[x+1]);const S=e.coords.length/p-w;S>=l?e.lengths.push(S):Td(e.coords,w*p),y+=v*d}return e.coords.length?e:null}function lje(e,t,r,i){const s=e[t],n=e[t+1],o=e[r],a=e[r+1],l=e[i],c=e[i+1];let u=o,d=a,p=l-u,g=c-d;if(p!==0||g!==0){const y=((s-u)*p+(n-d)*g)/(p*p+g*g);y>1?(u=l,d=c):y>0&&(u+=p*y,d+=g*y)}return p=s-u,g=n-d,p*p+g*g}function aB(e,t,r,i,s,n,o){let a,l=i,c=0;for(let u=n+r;u<o;u+=r)a=lje(t,u,n,o),a>l&&(c=u,l=a);l>i&&(c-n>r&&aB(e,t,r,i,s,n,c),s(e,t,e.length,c,t[c],t[c+1]),o-c>r&&aB(e,t,r,i,s,c,o))}function Yft(e,t,r,i){if(t==null||!t.coords||!t.coords.length)return null;const s=Zo(r,i);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(t&&t.coords){const c=t.coords;for(let u=0;u<c.length;u+=s){const d=c[u],p=c[u+1];n=Math.min(n,d),a=Math.max(a,d),o=Math.min(o,p),l=Math.max(l,p)}}return W9(e)?dMe(e,n,o,a,l):k7(n,o,a,l,e),e}function yQ(e,t,r,i,s){const{coords:n,lengths:o}=t,a=Zo(r,i);if(!n.length)return e!==t&&xm(e),e;LD(s);const{originPosition:l,scale:c,translate:u}=s,d=uje;d.originPosition=l;const p=d.scale;p[0]=c[0]??1,p[1]=-(c[1]??1),p[2]=c[2]??1,p[3]=c[3]??1;const g=d.translate;if(g[0]=u[0]??0,g[1]=u[1]??0,g[2]=u[2]??0,g[3]=u[3]??0,!o.length){for(let _=0;_<a;++_)e.coords[_]=I6(d,n[_],_);return e!==t&&xm(e,a,0),e}let y=0;for(let _=0;_<o.length;_++){const v=o[_];e.lengths[_]=v;for(let x=0;x<a;++x)e.coords[y+x]=I6(d,n[y+x],x);let w=e.coords[y],T=e.coords[y+1];y+=a;for(let x=1;x<v;x++,y+=a){w+=n[y]*p[0],T+=n[y+1]*p[1],e.coords[y]=w,e.coords[y+1]=T;for(let S=2;S<a;++S)e.coords[y+S]=I6(d,n[y+S],S)}}return e!==t&&xm(e,n.length,o.length),e}function Jft(e,t,r,i,s,n){if(xm(e),e.lengths.push(...t.lengths),r===s&&i===n)for(let o=0;o<t.coords.length;o++)e.coords.push(t.coords[o]);else{const o=Zo(r,i),a=DH(r,i,s,n),l=t.coords;for(let c=0;c<l.length;c+=o)a(e.coords,l,e.coords.length,c,l[c],l[c+1])}return e}function cje(e,t,r,i){let s=0,n=e[i*t],o=e[i*(t+1)];for(let a=1;a<r;a++){const l=n+e[i*(t+a)],c=o+e[i*(t+a)+1],u=(l-n)*(c+o);n=l,o=c,s+=u}return .5*s}function Kft(e,t){const{coords:r,lengths:i}=e;let s=0,n=0;for(let o=0;o<i.length;o++){const a=i[o];n+=cje(r,s,a,t),s+=a}return Math.abs(n)}function xm(e,t=0,r=0){Td(e.lengths,r),Td(e.coords,t)}function Td(e,t=0){e.length!==t&&(e.length=t)}const uje={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},_Q=new fn(Array,e=>aN(e,Xue),null,10,5),hje=Nt();class dje{get labelLayers(){return this._labelLayers||Swe}get extent(){return this._extent}get isElevationSource(){return this.layers.some(t=>t?.isElevationSource)}constructor(t,r,i,s,n){this.graphic=t,this.graphics3DSymbol=r,this.layers=i,this._visibleFlags=wo.ALL_LABEL,this.deconflictionPriority=0,++r.referenced,this._featureExpressionFeature=n?D0e(n,t,s):null}initialize(t){this._layer=t,this._forEachSymbolLayerGraphic(r=>{r.initialize(t),r.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(t=>t.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(t=>t.destroy()),this._labelLayers=null}addLabelGraphic(t,r){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(t),t.initialize(r),t.setVisibility(this.isVisible($n.LABEL))}setCalloutGraphic(t){this._calloutLayer=t,this._layer&&(t.initialize(this._layer),t.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let t=!1;return this._forEachSymbolLayerGraphic(r=>{r.type==="draped"&&(t=!0)}),t}isVisible(t=$n.GRAPHIC,r){const i=r?this._visibleFlags|r|$n.LABEL*r:this._visibleFlags;return t===$n.GRAPHIC?(i&wo.ALL_GRAPHIC)===wo.ALL_GRAPHIC:(i&wo.ALL_LABEL)===wo.ALL_LABEL}setVisibilityFlag(t,r,i){const s=this.isVisible(t);i?this._visibleFlags|=t*r:this._visibleFlags&=~(t*r);const n=this.isVisible(t);if(s===n)return!1;if(t===$n.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible($n.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}getVisibilityFlag(t,r){return(this._visibleFlags&t*r)!=0}computeExtent(t){if(!this._extent){const r=this.graphic.geometry;if(r==null)return!1;this._extent=Nt(),w7e(r,this._extent);const i=r.spatialReference;if(!kn(i,t)&&!k3(this._extent,i,this._extent,t))return this._extent=null,!1}return!0}getAsOptimizedGeometry(t,r){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,t,r)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(t,r,i){let s=t.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=J1.fromExtent(s.type==="mesh"?s.extent:s)),nje(s,r,i)}get usedMemory(){let t=o0e(this.graphic.attributes);return this._forEachSymbolLayerGraphic(r=>{const i=r.graphics3DSymbolLayer.complexity;if(i==null)return;const s=r.type==="draped"?i.memory.draped:i.memory;t+=s.bytesPerFeature,s.bytesPerCoordinate&&(t+=b7e(this.graphic.geometry)*s.bytesPerCoordinate)}),t}computeAttachmentOrigin(){const t={render:{origin:C(),num:0},draped:{origin:Ne(),num:0}};for(const r of this.layers)r?.computeAttachmentOrigin(t);return t.render.num>1&&te(t.render.origin,t.render.origin,1/t.render.num),t.draped.num>1&&Pl(t.draped.origin,t.draped.origin,1/t.draped.num),t}async getProjectedBoundingBox(t,r,i,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?mi(n.boundingBox):n.boundingBox=mi(),n.requiresDrapedElevation=!1,await IN(this.layers,async o=>{if(o==null)return;const a=o.type==="draped"?r:t,l=_Q.acquire(),c=await o.getProjectedBoundingBox(a,i,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&hT(n.boundingBox,l),_Q.release(l)}),uMe(n.boundingBox)||l9(aG(n.boundingBox,hje))?n:null}needsElevationUpdates(){for(const t of this.layers)if(t!=null&&(t.type==="object3d"||t.type==="lod-instance")&&t.needsElevationUpdates)return!0;return this._labelLayers?.some(t=>t?.needsElevationUpdates??!1)??!1}alignWithElevation(t,r,i){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(t,r,this._featureExpressionFeature,i)})}alignWithAbsoluteElevation(t,r,i){this._forEachRenderedGraphic(s=>{s.type==="object3d"&&s.alignWithAbsoluteElevation(t,r,i)})}addObjectStateSet(t,r){this._forEachSymbolLayerGraphic(i=>i.addObjectState(t,r))}removeObjectState(t){this._forEachSymbolLayerGraphic(r=>r.removeObjectState(t))}_forEachGraphicList(t,r){t?.forEach(i=>i&&r(i))}_forEachSymbolLayerGraphic(t){this._forEachGraphicList(this.layers,t),this._calloutLayer&&t(this._calloutLayer)}_forEachLabelGraphic(t){this._forEachGraphicList(this._labelLayers,t)}_forEachRenderedGraphic(t){this._forEachSymbolLayerGraphic(t),this._forEachLabelGraphic(t)}get test(){const t=this;return{addLabelLayer:r=>{t._labelLayers||(t._labelLayers=new Array),t._labelLayers.push(r)}}}}class Qft{constructor(t,r){this.scheduler=t,this.schedule=r,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}}class pje{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}}var vQ,bQ,wQ,lB={exports:{}};lB.exports,vQ=lB,bQ=function(){function e(R,k,z){z=z||2;var H,X,Y,ee,me,$e,pt,St=k&&k.length,it=St?k[0]*z:R.length,ft=t(R,0,it,z,!0),ge=[];if(!ft||ft.next===ft.prev)return ge;if(St&&(ft=l(R,k,ft,z)),R.length>80*z){H=Y=R[0],X=ee=R[1];for(var Ee=z;Ee<it;Ee+=z)(me=R[Ee])<H&&(H=me),($e=R[Ee+1])<X&&(X=$e),me>Y&&(Y=me),$e>ee&&(ee=$e);pt=(pt=Math.max(Y-H,ee-X))!==0?1/pt:0}return i(ft,ge,z,H,X,pt),ge}function t(R,k,z,H,X){var Y,ee;if(X===J(R,k,z,H)>0)for(Y=k;Y<z;Y+=H)ee=Z(Y,R[Y],R[Y+1],ee);else for(Y=z-H;Y>=k;Y-=H)ee=Z(Y,R[Y],R[Y+1],ee);if(ee&&O(ee,ee.next)){var me=ee.next;W(ee),ee=me}return ee}function r(R,k){if(!R)return R;k||(k=R);var z,H=R;do if(z=!1,H.steiner||!O(H,H.next)&&S(H.prev,H,H.next)!==0)H=H.next;else{var X=H.prev;if(W(H),(H=k=X)===H.next)break;z=!0}while(z||H!==k);return k}function i(R,k,z,H,X,Y,ee){if(R){!ee&&Y&&y(R,H,X,Y);for(var me,$e,pt=R;R.prev!==R.next;)if(me=R.prev,$e=R.next,Y?n(R,H,X,Y):s(R))k.push(me.i/z),k.push(R.i/z),k.push($e.i/z),W(R),R=$e.next,pt=$e.next;else if((R=$e)===pt){ee?ee===1?i(R=o(r(R),k,z),k,z,H,X,Y,2):ee===2&&a(R,k,z,H,X,Y):i(r(R),k,z,H,X,Y,1);break}}}function s(R){var k=R.prev,z=R,H=R.next;if(S(k,z,H)>=0)return!1;for(var X=R.next.next;X!==R.prev;){if(T(k.x,k.y,z.x,z.y,H.x,H.y,X.x,X.y)&&S(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function n(R,k,z,H){var X=R.prev,Y=R,ee=R.next;if(S(X,Y,ee)>=0)return!1;for(var me=X.x<Y.x?X.x<ee.x?X.x:ee.x:Y.x<ee.x?Y.x:ee.x,$e=X.y<Y.y?X.y<ee.y?X.y:ee.y:Y.y<ee.y?Y.y:ee.y,pt=X.x>Y.x?X.x>ee.x?X.x:ee.x:Y.x>ee.x?Y.x:ee.x,St=X.y>Y.y?X.y>ee.y?X.y:ee.y:Y.y>ee.y?Y.y:ee.y,it=v(me,$e,k,z,H),ft=v(pt,St,k,z,H),ge=R.prevZ,Ee=R.nextZ;ge&&ge.z>=it&&Ee&&Ee.z<=ft;){if(ge!==R.prev&&ge!==R.next&&T(X.x,X.y,Y.x,Y.y,ee.x,ee.y,ge.x,ge.y)&&S(ge.prev,ge,ge.next)>=0||(ge=ge.prevZ,Ee!==R.prev&&Ee!==R.next&&T(X.x,X.y,Y.x,Y.y,ee.x,ee.y,Ee.x,Ee.y)&&S(Ee.prev,Ee,Ee.next)>=0))return!1;Ee=Ee.nextZ}for(;ge&&ge.z>=it;){if(ge!==R.prev&&ge!==R.next&&T(X.x,X.y,Y.x,Y.y,ee.x,ee.y,ge.x,ge.y)&&S(ge.prev,ge,ge.next)>=0)return!1;ge=ge.prevZ}for(;Ee&&Ee.z<=ft;){if(Ee!==R.prev&&Ee!==R.next&&T(X.x,X.y,Y.x,Y.y,ee.x,ee.y,Ee.x,Ee.y)&&S(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.nextZ}return!0}function o(R,k,z){var H=R;do{var X=H.prev,Y=H.next.next;!O(X,Y)&&A(X,H,H.next,Y)&&I(X,Y)&&I(Y,X)&&(k.push(X.i/z),k.push(H.i/z),k.push(Y.i/z),W(H),W(H.next),H=R=Y),H=H.next}while(H!==R);return r(H)}function a(R,k,z,H,X,Y){var ee=R;do{for(var me=ee.next.next;me!==ee.prev;){if(ee.i!==me.i&&x(ee,me)){var $e=N(ee,me);return ee=r(ee,ee.next),$e=r($e,$e.next),i(ee,k,z,H,X,Y),void i($e,k,z,H,X,Y)}me=me.next}ee=ee.next}while(ee!==R)}function l(R,k,z,H){var X,Y,ee,me=[];for(X=0,Y=k.length;X<Y;X++)(ee=t(R,k[X]*H,X<Y-1?k[X+1]*H:R.length,H,!1))===ee.next&&(ee.steiner=!0),me.push(w(ee));for(me.sort(c),X=0;X<me.length;X++)z=r(z=d(me[X],z),z.next);return z}function c(R,k){return R.x-k.x}function u(R){if(R.next.prev===R)return R;let k=R;for(;;){const z=k.next;if(z.prev===k||z===k||z===R)break;k=z}return k}function d(R,k){var z=p(R,k);if(!z)return k;var H=N(z,R),X=r(z,z.next);let Y=u(H);return r(Y,Y.next),X=u(X),u(k===z?X:k)}function p(R,k){var z,H=k,X=R.x,Y=R.y,ee=-1/0;do{if(Y<=H.y&&Y>=H.next.y&&H.next.y!==H.y){var me=H.x+(Y-H.y)*(H.next.x-H.x)/(H.next.y-H.y);if(me<=X&&me>ee){if(ee=me,me===X){if(Y===H.y)return H;if(Y===H.next.y)return H.next}z=H.x<H.next.x?H:H.next}}H=H.next}while(H!==k);if(!z)return null;if(X===ee)return z;var $e,pt=z,St=z.x,it=z.y,ft=1/0;H=z;do X>=H.x&&H.x>=St&&X!==H.x&&T(Y<it?X:ee,Y,St,it,Y<it?ee:X,Y,H.x,H.y)&&($e=Math.abs(Y-H.y)/(X-H.x),I(H,R)&&($e<ft||$e===ft&&(H.x>z.x||H.x===z.x&&g(z,H)))&&(z=H,ft=$e)),H=H.next;while(H!==pt);return z}function g(R,k){return S(R.prev,R,k.prev)<0&&S(k.next,R,R.next)<0}function y(R,k,z,H){var X=R;do X.z===null&&(X.z=v(X.x,X.y,k,z,H)),X.prevZ=X.prev,X.nextZ=X.next,X=X.next;while(X!==R);X.prevZ.nextZ=null,X.prevZ=null,_(X)}function _(R){var k,z,H,X,Y,ee,me,$e,pt=1;do{for(z=R,R=null,Y=null,ee=0;z;){for(ee++,H=z,me=0,k=0;k<pt&&(me++,H=H.nextZ);k++);for($e=pt;me>0||$e>0&&H;)me!==0&&($e===0||!H||z.z<=H.z)?(X=z,z=z.nextZ,me--):(X=H,H=H.nextZ,$e--),Y?Y.nextZ=X:R=X,X.prevZ=Y,Y=X;z=H}Y.nextZ=null,pt*=2}while(ee>1);return R}function v(R,k,z,H,X){return(R=1431655765&((R=858993459&((R=252645135&((R=16711935&((R=32767*(R-z)*X)|R<<8))|R<<4))|R<<2))|R<<1))|(k=1431655765&((k=858993459&((k=252645135&((k=16711935&((k=32767*(k-H)*X)|k<<8))|k<<4))|k<<2))|k<<1))<<1}function w(R){var k=R,z=R;do(k.x<z.x||k.x===z.x&&k.y<z.y)&&(z=k),k=k.next;while(k!==R);return z}function T(R,k,z,H,X,Y,ee,me){return(X-ee)*(k-me)-(R-ee)*(Y-me)>=0&&(R-ee)*(H-me)-(z-ee)*(k-me)>=0&&(z-ee)*(Y-me)-(X-ee)*(H-me)>=0}function x(R,k){return R.next.i!==k.i&&R.prev.i!==k.i&&!U(R,k)&&(I(R,k)&&I(k,R)&&L(R,k)&&(S(R.prev,R,k.prev)||S(R,k.prev,k))||O(R,k)&&S(R.prev,R,R.next)>0&&S(k.prev,k,k.next)>0)}function S(R,k,z){return(k.y-R.y)*(z.x-k.x)-(k.x-R.x)*(z.y-k.y)}function O(R,k){return R.x===k.x&&R.y===k.y}function A(R,k,z,H){var X=P(S(R,k,z)),Y=P(S(R,k,H)),ee=P(S(z,H,R)),me=P(S(z,H,k));return X!==Y&&ee!==me||!(X!==0||!$(R,z,k))||!(Y!==0||!$(R,H,k))||!(ee!==0||!$(z,R,H))||!(me!==0||!$(z,k,H))}function $(R,k,z){return k.x<=Math.max(R.x,z.x)&&k.x>=Math.min(R.x,z.x)&&k.y<=Math.max(R.y,z.y)&&k.y>=Math.min(R.y,z.y)}function P(R){return R>0?1:R<0?-1:0}function U(R,k){var z=R;do{if(z.i!==R.i&&z.next.i!==R.i&&z.i!==k.i&&z.next.i!==k.i&&A(z,z.next,R,k))return!0;z=z.next}while(z!==R);return!1}function I(R,k){return S(R.prev,R,R.next)<0?S(R,k,R.next)>=0&&S(R,R.prev,k)>=0:S(R,k,R.prev)<0||S(R,R.next,k)<0}function L(R,k){var z=R,H=!1,X=(R.x+k.x)/2,Y=(R.y+k.y)/2;do z.y>Y!=z.next.y>Y&&z.next.y!==z.y&&X<(z.next.x-z.x)*(Y-z.y)/(z.next.y-z.y)+z.x&&(H=!H),z=z.next;while(z!==R);return H}function N(R,k){var z=new V(R.i,R.x,R.y),H=new V(k.i,k.x,k.y),X=R.next,Y=k.prev;return R.next=k,k.prev=R,z.next=X,X.prev=z,H.next=z,z.prev=H,Y.next=H,H.prev=Y,H}function Z(R,k,z,H){var X=new V(R,k,z);return H?(X.next=H.next,X.prev=H,H.next.prev=X,H.next=X):(X.prev=X,X.next=X),X}function W(R){R.next.prev=R.prev,R.prev.next=R.next,R.prevZ&&(R.prevZ.nextZ=R.nextZ),R.nextZ&&(R.nextZ.prevZ=R.prevZ)}function V(R,k,z){this.i=R,this.x=k,this.y=z,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function J(R,k,z,H){for(var X=0,Y=k,ee=z-H;Y<z;Y+=H)X+=(R[ee]-R[Y])*(R[Y+1]+R[ee+1]),ee=Y;return X}return e.deviation=function(R,k,z,H){var X=k&&k.length,Y=X?k[0]*z:R.length,ee=Math.abs(J(R,0,Y,z));if(X)for(var me=0,$e=k.length;me<$e;me++){var pt=k[me]*z,St=me<$e-1?k[me+1]*z:R.length;ee-=Math.abs(J(R,pt,St,z))}var it=0;for(me=0;me<H.length;me+=3){var ft=H[me]*z,ge=H[me+1]*z,Ee=H[me+2]*z;it+=Math.abs((R[ft]-R[Ee])*(R[ge+1]-R[ft+1])-(R[ft]-R[ge])*(R[Ee+1]-R[ft+1]))}return ee===0&&it===0?0:Math.abs((it-ee)/ee)},e.flatten=function(R){for(var k=R[0][0].length,z={vertices:[],holes:[],dimensions:k},H=0,X=0;X<R.length;X++){for(var Y=0;Y<R[X].length;Y++)for(var ee=0;ee<k;ee++)z.vertices.push(R[X][Y][ee]);X>0&&(H+=R[X-1].length,z.holes.push(H))}return z},e},(wQ=bQ())!==void 0&&(vQ.exports=wQ);const qT=q3(lB.exports),b4=K.getLogger("esri.views.3d.support.buffer.math");function fje(e,t,r){XT(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)}function XT(e,t,r,i=3,s=i){if(e.length/i!==Math.ceil(t.length/s))return b4.error("source and destination buffers need to have the same number of elements"),e;const n=e.length/i,o=r[0],a=r[1],l=r[2],c=r[4],u=r[5],d=r[6],p=r[8],g=r[9],y=r[10],_=r[12],v=r[13],w=r[14];let T=0,x=0;for(let S=0;S<n;S++){const O=t[T],A=t[T+1],$=t[T+2];e[x]=o*O+c*A+p*$+_,e[x+1]=a*O+u*A+g*$+v,e[x+2]=l*O+d*A+y*$+w,T+=s,x+=i}return e}function dye(e,t,r){F1(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)}function F1(e,t,r,i=3,s=i){if(e.length/i!==Math.ceil(t.length/s))return void b4.error("source and destination buffers need to have the same number of elements");const n=e.length/i,o=r[0],a=r[1],l=r[2],c=r[3],u=r[4],d=r[5],p=r[6],g=r[7],y=r[8];let _=0,v=0;for(let w=0;w<n;w++){const T=t[_],x=t[_+1],S=t[_+2];e[v]=o*T+c*x+p*S,e[v+1]=a*T+u*x+g*S,e[v+2]=l*T+d*x+y*S,_+=s,v+=i}}function mje(e,t,r){jL(e.typedBuffer,t,r,e.typedBufferStride)}function jL(e,t,r,i=3){const s=Math.min(e.length/i,t.count),n=t.typedBuffer,o=t.typedBufferStride;let a=0,l=0;for(let c=0;c<s;c++)e[l]=r*n[a],e[l+1]=r*n[a+1],e[l+2]=r*n[a+2],a+=o,l+=i}function gje(e,t){w4(e.typedBuffer,t.typedBuffer,e.typedBufferStride,t.typedBufferStride)}function w4(e,t,r=3,i=r){const s=Math.min(e.length/r,t.length/i);let n=0,o=0;for(let a=0;a<s;a++){const l=t[n],c=t[n+1],u=t[n+2],d=l*l+c*c+u*u;if(d>0){const p=1/Math.sqrt(d);e[o]=p*l,e[o+1]=p*c,e[o+2]=p*u}n+=i,o+=r}}function yje(e,t,r){const i=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;let l=0,c=0;for(let u=0;u<i;u++)s[c]=o[l]>>r,s[c+1]=o[l+1]>>r,s[c+2]=o[l+2]>>r,l+=a,c+=n}Object.freeze(Object.defineProperty({__proto__:null,normalize:w4,normalizeView:gje,scale:jL,scaleView:mje,shiftRight:yje,transformMat3:F1,transformMat3View:dye,transformMat4:XT,transformMat4View:fje},Symbol.toStringTag,{value:"Module"}));function _je(e,t,r){return{objectId:e,target:t,distance:r,type:"vertex"}}function xQ(e,t,r,i,s,n=!1){return{objectId:e,target:t,distance:r,type:"edge",start:i,end:s,draped:n}}var Tm,Fo;function vje(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function KA(e){return e!=null&&!isNaN(e)&&isFinite(e)}function bje(e){return e.valueExpression?Tm.Expression:e.field&&typeof e.field=="string"?Tm.Field:Tm.Unknown}function emt(e,t){const r=t||bje(e),i=e.valueUnit||"unknown";return r===Tm.Unknown?Fo.Constant:e.stops?Fo.Stops:e.minSize!=null&&e.maxSize!=null&&e.minDataValue!=null&&e.maxDataValue!=null?Fo.ClampedLinear:i==="unknown"?e.minSize!=null&&e.minDataValue!=null?e.minSize&&e.minDataValue?Fo.Proportional:Fo.Additive:Fo.Identity:Fo.RealWorldSize}(function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"})(Tm||(Tm={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(Fo||(Fo={}));const Py=K.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),TQ=new v1,yI=Math.PI,wje=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function pye(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find(y=>y.type==="color"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void Py.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s=typeof t=="number",n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=i.field,{ipData:c,hasExpression:u}=i.cache;let d=i.cache.compiledFunc;if(!l&&!u){const y=i.stops;return y&&y[0]&&y[0].color}if(typeof a!="number")if(u){if(r==null||r.arcade==null)return void Py.error("Use of arcade expressions requires an arcade context");const y={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,v=_.getViewInfo(y),w=_.createExecContext(n,v);if(!d){const T=_.createSyntaxTree(i.valueExpression);d=_.createFunction(T),i.cache.compiledFunc=d}a=_.executeFunction(d,w)}else o&&(a=o[l]);const p=i.normalizationField,g=o!=null&&p!=null?parseFloat(o[p]):void 0;if(a!=null&&(!p||s||!isNaN(g)&&g!==0)){isNaN(g)||s||(a/=g);const y=BH(a,c);if(y){const _=y[0],v=y[1],w=_===v?i.stops[_].color:ot.blendColors(i.stops[_].color,i.stops[v].color,y[2],r?.color);return new ot(w)}}}function fye(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find(y=>y.type==="opacity"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void Py.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s=typeof t=="number",n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=i.field,{ipData:c,hasExpression:u}=i.cache;let d=i.cache.compiledFunc;if(!l&&!u){const y=i.stops;return y&&y[0]&&y[0].opacity}if(typeof a!="number")if(u){if(r==null||r.arcade==null)return void Py.error("Use of arcade expressions requires an arcade context");const y={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,v=_.getViewInfo(y),w=_.createExecContext(n,v);if(!d){const T=_.createSyntaxTree(i.valueExpression);d=_.createFunction(T),i.cache.compiledFunc=d}a=_.executeFunction(d,w)}else o&&(a=o[l]);const p=i.normalizationField,g=o!=null&&p!=null?parseFloat(o[p]):void 0;if(a!=null&&(!p||s||!isNaN(g)&&g!==0)){isNaN(g)||s||(a/=g);const y=BH(a,c);if(y){const _=y[0],v=y[1];if(_===v)return i.stops[_].opacity;{const w=i.stops[_].opacity;return w+(i.stops[v].opacity-w)*y[2]}}}}function mye(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find(g=>g.type==="rotation"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void Py.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=i.axis||"heading",n=s==="heading"&&i.rotationType==="arithmetic"?90:0,o=s==="heading"&&i.rotationType==="arithmetic"?-1:1,a=typeof t=="number"?null:t,l=a&&a.attributes,c=i.field,{hasExpression:u}=i.cache;let d=i.cache.compiledFunc,p=0;if(!c&&!u)return p;if(u){if(r==null||r.arcade==null)return void Py.error("Use of arcade expressions requires an arcade context");const g={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},y=r.arcade.arcadeUtils,_=y.getViewInfo(g),v=y.createExecContext(a,_);if(!d){const w=y.createSyntaxTree(i.valueExpression);d=y.createFunction(w),i.cache.compiledFunc=d}p=y.executeFunction(d,v)}else l&&(p=l[c]||0);return p=typeof p!="number"||isNaN(p)?null:n+o*p,p}function xje(e,t,r){const i=typeof t=="number",s=i?null:t,n=s&&s.attributes;let o=i?t:null;const{isScaleDriven:a}=e.cache;let l=e.cache.compiledFunc;if(a){const u=r?.scale,d=r?.view;o=u==null||d==="3d"?Tje(e):u}else if(!i)switch(e.inputValueType){case Tm.Expression:{if(r==null||r.arcade==null)return void Py.error("Use of arcade expressions requires an arcade context");const u={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},d=r.arcade.arcadeUtils,p=d.getViewInfo(u),g=d.createExecContext(s,p);if(!l){const y=d.createSyntaxTree(e.valueExpression);l=d.createFunction(y),e.cache.compiledFunc=l}o=d.executeFunction(l,g);break}case Tm.Field:n&&(o=n[e.field]);break;case Tm.Unknown:o=null}if(!KA(o))return null;if(i||!e.normalizationField)return o;const c=n?parseFloat(n[e.normalizationField]):null;return KA(c)&&c!==0?o/c:null}function Tje(e){let t=null,r=null;const i=e.stops;return i?(t=i[0].value,r=i[i.length-1].value):(t=e.minDataValue||0,r=e.maxDataValue||0),(t+r)/2}function x4(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find(n=>n.type==="size"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void Py.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=yye(xje(i,t,r),i,t,r,i.cache.ipData);return s==null||isNaN(s)?0:s}function Ul(e,t,r){return e==null?null:vje(e)?x4(e,t,r):KA(e)?e:null}function gye(e,t,r){return KA(r)&&e>r?r:KA(t)&&e<t?t:e}function Sje(e,t,r,i){return e+((Ul(t.minSize,r,i)||t.minDataValue)??0)}function Eje(e,t,r){const i=e.stops;let s=i&&i.length&&i[0].size;return s==null&&(s=e.minSize),Ul(s,t,r)}function Cje(e,t,r,i){const s=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),n=Ul(t.minSize,r,i),o=Ul(t.maxSize,r,i),a=i?.shape;if(e<=t.minDataValue)return n;if(e>=t.maxDataValue)return o;if(n==null||o==null)return null;if(t.scaleBy==="area"&&a){const l=a==="circle",c=l?yI*(n/2)**2:n*n,u=c+s*((l?yI*(o/2)**2:o*o)-c);return l?2*Math.sqrt(u/yI):Math.sqrt(u)}return n+s*(o-n)}function Aje(e,t,r,i){const s=i?.shape,n=e/t.minDataValue,o=Ul(t.minSize,r,i),a=Ul(t.maxSize,r,i);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,gye(l,o,a)}function Oje(e,t,r,i,s){const[n,o,a]=BH(e,s);if(n===o)return Ul(t.stops?.[n].size,r,i);{const l=Ul(t.stops?.[n].size,r,i);return l+(Ul(t.stops?.[o].size,r,i)-l)*a}}function Rje(e,t,r,i){const s=(i!=null&&i.resolution?i.resolution:1)*VT[t.valueUnit],n=Ul(t.minSize,r,i),o=Ul(t.maxSize,r,i),{valueRepresentation:a}=t;let l=null;return l=a==="area"?2*Math.sqrt(e/yI)/s:a==="radius"||a==="distance"?2*e/s:e/s,gye(l,n,o)}function yye(e,t,r,i,s){switch(t.transformationType){case Fo.Additive:return Sje(e,t,r,i);case Fo.Constant:return Eje(t,r,i);case Fo.ClampedLinear:return Cje(e,t,r,i);case Fo.Proportional:return Aje(e,t,r,i);case Fo.Stops:return Oje(e,t,r,i,s);case Fo.RealWorldSize:return Rje(e,t,r,i);case Fo.Identity:return e;case Fo.Unknown:return null}}function Pje(e,t,r){const{isScaleDriven:i}=e.cache;if(!(i&&r==="3d"||t))return null;const s={scale:t,view:r};let n=Ul(e.minSize,TQ,s),o=Ul(e.maxSize,TQ,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function zH(e,t,r){if(!e.visualVariables)return;const i=[],s=[],n=[],o=[],a=[];for(const l of e.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=pye(l,t,r);i.push({variable:l,value:c})}),n.forEach(l=>{const c=fye(l,t,r);i.push({variable:l,value:c})}),a.forEach(l=>{const c=mye(l,t,r);i.push({variable:l,value:c})}),o.forEach(l=>{const c=x4(l,t,r);i.push({variable:l,value:c})}),i.filter(l=>l.value!=null)}function BH(e,t){if(!t)return;let r=0,i=t.length-1;return t.some((s,n)=>e<s?(i=n,!0):(r=n,!1)),[r,i,(e-t[r])/(t[i]-t[r])]}function Mje(e,t,r){const i=["proportional","proportional","proportional"];for(const s of e){const n=s.useSymbolValue?"symbol-value":x4(s,t,r);switch(s.axis){case"width":i[0]=n;break;case"depth":i[1]=n;break;case"height":i[2]=n;break;case"width-and-depth":i[0]=n,i[1]=n;break;case"all":case void 0:case null:i[0]=n,i[1]=n,i[2]=n;break;default:s.axis}}return i}var tmt=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:Mje,getColor:pye,getOpacity:fye,getRotationAngle:mye,getSize:x4,getSizeForValue:yye,getSizeFromNumberOrVariable:Ul,getSizeRangeAtScale:Pje,getVisualVariableValues:zH,viewScaleRE:wje},Symbol.toStringTag,{value:"Module"}));function T4(e,t){if(!e||e.symbol)return null;const r=t&&t.renderer;return e&&r!=null&&r.getObservationRenderer?r.getObservationRenderer(e):r}function Ije(e,t){if(e.symbol!=null)return e.symbol;const r=T4(e,t);return r!=null&&r.type!=="dot-density"?r.getSymbol(e,t):null}function rmt(e,t){const r=T4(e,t),i=Ije(e,t);if(i==null)return null;const s={renderer:r,symbol:i};if(r==null||!("visualVariables"in r)||!r.visualVariables)return s;const n=zH(r,e,t)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=u;break;case"depth":o[1]=u;break;case"height":o[2]=u;break;case"width-and-depth":o[0]=o[1]=u;break;default:o[0]=o[1]=o[2]=u}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function $je(e,t){if(e.symbol!=null)return e.symbol;const r=T4(e,t);return r!=null?r.getSymbolAsync(e,t):null}async function imt(e,t){const r=T4(e,t),i=await $je(e,t);if(!i)return null;const s={renderer:r,symbol:i};if(!r||!("visualVariables"in r)||!r.visualVariables)return s;const n=zH(r,e,t)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=ot.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=u:c==="depth"?o[1]=u:c==="height"?o[2]=u:o[0]=o[1]=c==="width-and-depth"?u:o[2]=u}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function Lje(e,t=0){const r=e[t];return typeof r=="number"&&isFinite(r)?r:null}function Dje(e){for(let t=0;t<3;t++){const r=e[t];if(typeof r=="number")return isFinite(r)?r:0}return 0}function SQ(e){const t=[[E.POSITION,e.indices]],r=[[E.POSITION,new Fe(e.attributeData.position,3,!0)]];return e.attributeData.colorFeature!=null?(r.push([E.COLORFEATUREATTRIBUTE,new Fe([e.attributeData.colorFeature],1,!0)]),t.push([E.COLORFEATUREATTRIBUTE,new Array(e.indices.length).fill(0)])):e.attributeData.color&&(r.push([E.COLOR,new Fe(e.attributeData.color,4,!0)]),t.push([E.COLOR,T2(e.indices.length)])),e.attributeData.uvMapSpace&&(r.push([E.UVMAPSPACE,new Fe(e.attributeData.uvMapSpace,4,!0)]),t.push([E.UVMAPSPACE,e.indices])),e.attributeData.boundingRect&&(r.push([E.BOUNDINGRECT,new Fe(e.attributeData.boundingRect,9,!0)]),t.push([E.BOUNDINGRECT,e.indices])),new Cs(e.material,r,t,e.mapPositions,Ki.Mesh,e.attributeData.objectAndLayerIdColor)}function EQ(e,t=null){const r=[[E.POSITION,e.indices],[E.UV0,e.indices]],i=[[E.POSITION,new Fe(e.attributeData.position,3,!0)],[E.UV0,new Fe(e.attributeData.uv0,2,!0)]];return new Cs(e.material,i,r,e.mapPositions,Ki.Mesh,t)}function QA(e){switch(e.type){case"extent":if(e instanceof Pr)return J1.fromExtent(e);break;case"polygon":return e}return null}class S4{constructor(t,r,i){this.renderData=t,this.layerUid=r,this.graphicUid=i,this.outGeometries=new Array}}function cB(e,t,r){const i=Array.isArray(e),s=i?e.length/t:e.byteLength/(4*t),n=i?e:new Uint32Array(e,0,s*t),o=r?.minReduction??0,a=r?.originalIndices||null,l=a?a.length:0,c=r?.componentOffsets||null;let u=0;if(c)for(let A=0;A<c.length-1;A++){const $=c[A+1]-c[A];$>u&&(u=$)}else u=s;const d=Math.floor(1.1*u)+1;(Fd==null||Fd.length<2*d)&&(Fd=new Uint32Array(cwe(2*d)));for(let A=0;A<2*d;A++)Fd[A]=0;let p=0;const g=!!c&&!!a,y=g?l:s;let _=vL(s);const v=new Uint32Array(l),w=1.96;let T=o!==0?Math.ceil(4*w*w/(o*o)*o*(1-o)):y,x=1,S=c?c[1]:y;for(let A=0;A<y;A++){if(A===T){const N=1-p/A;if(N+w*Math.sqrt(N*(1-N)/A)<o)return null;T*=2}if(A===S){for(let N=0;N<2*d;N++)Fd[N]=0;if(a)for(let N=c[x-1];N<c[x];N++)v[N]=_[a[N]];S=c[++x]}const $=g?a[A]:A,P=$*t,U=Uje(n,P,t);let I=U%d,L=p;for(;Fd[2*I+1]!==0;){if(Fd[2*I]===U){const N=Fd[2*I+1]-1;if(Nje(n,P,N*t,t)){L=_[N];break}}I++,I>=d&&(I-=d)}L===p&&(Fd[2*I]=U,Fd[2*I+1]=$+1,p++),_[$]=L}if(o!==0&&1-p/s<o)return null;if(g){for(let A=c[x-1];A<v.length;A++)v[A]=_[a[A]];_=Vp(v)}const O=i?new Array(p):new Uint32Array(p*t);p=0;for(let A=0;A<y;A++)_[A]===p&&(Fje(n,(g?a[A]:A)*t,O,p*t,t),p++);if(a&&!g){const A=new Uint32Array(l);for(let $=0;$<A.length;$++)A[$]=_[a[$]];_=Vp(A)}return{buffer:Array.isArray(O)?O:O.buffer,indices:_,uniqueCount:p}}function Nje(e,t,r,i){for(let s=0;s<i;s++)if(e[t+s]!==e[r+s])return!1;return!0}function Fje(e,t,r,i,s){for(let n=0;n<s;n++)r[i+n]=e[t+n]}function Uje(e,t,r){let i=0;for(let s=0;s<r;s++)i=e[t+s]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let Fd=null;function smt(e){const t=sO(e.rings,e.hasZ,Qp.CCW_IS_HOLE),r=new Array;let i=0,s=0;for(const a of t.polygons){const l=a.count,c=a.index,u=Bu(t.position,3*c,3*l),d=a.holeIndices.map(g=>g-c),p=Vp(qT(u,d,3));r.push({position:u,faces:p}),i+=u.length,s+=p.length}const n=kje(r,i,s),o=Array.isArray(n.position)?cB(n.position,3,{originalIndices:n.faces}):cB(n.position.buffer,6,{originalIndices:n.faces});return n.position=Bfe(new Float64Array(o.buffer)),n.faces=o.indices,n}function kje(e,t,r){if(e.length===1)return e[0];const i=To(t),s=new Array(r);let n=0,o=0,a=0;for(const l of e){for(let c=0;c<l.position.length;c++)i[n++]=l.position[c];for(const c of l.faces)s[o++]=c+a;a=n/3}return{position:i,faces:Vp(s)}}function sO(e,t,r){const i=e.length,s=new Array(i),n=new Array(i),o=new Array(i);let a=0,l=0,c=0,u=0;for(let g=0;g<i;++g)u+=e[g].length;const d=To(3*u);let p=0;for(let g=i-1;g>=0;g--){const y=e[g],_=r===Qp.CCW_IS_HOLE&&zje(y);if(_&&i!==1)s[a++]=y;else{let v=y.length;for(let T=0;T<a;++T)v+=s[T].length;const w={index:p,pathLengths:new Array(a+1),count:v,holeIndices:new Array(a)};w.pathLengths[0]=y.length,y.length>0&&(o[c++]={index:p,count:y.length}),p=_?YR(y,y.length-1,-1,d,p,y.length,t):YR(y,0,1,d,p,y.length,t);for(let T=0;T<a;++T){const x=s[T];w.holeIndices[T]=p,w.pathLengths[T+1]=x.length,x.length>0&&(o[c++]={index:p,count:x.length}),p=YR(x,0,1,d,p,x.length,t)}a=0,w.count>0&&(n[l++]=w)}}for(let g=0;g<a;++g){const y=s[g];y.length>0&&(o[c++]={index:p,count:y.length}),p=YR(y,0,1,d,p,y.length,t)}return n.length=l,o.length=c,{position:d,polygons:n,outlines:o}}function YR(e,t,r,i,s,n,o){s*=3;for(let a=0;a<n;++a){const l=e[t];i[s++]=l[0],i[s++]=l[1],i[s++]=o?l[2]:0,t+=r}return s/3}function zje(e){return!qce(e,!1,!1)}var Qp;(function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(Qp||(Qp={}));var DC,HL,uB;(function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"})(DC||(DC={})),function(e){e[e.MapLayer=0]="MapLayer",e[e.ViewLayer=1]="ViewLayer",e[e.Outline=2]="Outline",e[e.SnappingHint=3]="SnappingHint"}(HL||(HL={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(uB||(uB={}));class _ye{constructor(t,r){this._fbo=null;const i=new hr;i.wrapMode=Ct.CLAMP_TO_EDGE,i.samplingMode=xt.LINEAR_MIPMAP_LINEAR,i.hasMipmap=r,i.maxAnisotropy=8,this._fbo=new Bi(t,i)}dispose(){this._fbo=De(this._fbo)}getTexture(){return this._fbo?.colorTexture}isValid(){return this._fbo!=null}resize(t,r){this._fbo?.resize(t,r)}bind(t){t.bindFramebuffer(this._fbo)}generateMipMap(){const t=this._fbo?.colorTexture;t?.descriptor.hasMipmap&&t.generateMipmap()}disposeRenderTargetMemory(){this._fbo?.resize(0,0)}get gpuMemoryUsage(){return this._fbo?.gpuMemoryUsage??0}}class Nb{constructor(t,r,i,s=!0){this.output=r,this.type=i,this.valid=!1,this.lastUsed=1/0,this.fbo=new _ye(t,s)}}class Bje{constructor(t){this.renderTargets=[new Nb(t,D.Color,Zi.Color),new Nb(t,D.Color,Zi.ColorNoRasterImage),new Nb(t,D.Highlight,Zi.Highlight,!1),new Nb(t,D.Normal,Zi.Water),new Nb(t,D.Color,Zi.Occluded)],ne("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new Nb(t,D.ObjectAndLayerIdColor,Zi.ObjectAndLayerIdColor))}getTarget(t){return this.renderTargets[t].fbo}dispose(){for(const t of this.renderTargets)t.fbo.dispose()}disposeRenderTargetMemory(){for(const t of this.renderTargets)t.fbo.disposeRenderTargetMemory()}validateUsageForTarget(t,r,i){return t?(r.lastUsed=i,!1):i-r.lastUsed>Vje?(r.fbo.disposeRenderTargetMemory(),r.lastUsed=1/0,!1):r.lastUsed<1/0}get gpuMemoryUsage(){return this.renderTargets.reduce((t,r)=>t+r.fbo.gpuMemoryUsage,0)}}const Vje=1e3;class vye extends Wr{constructor(){super(...arguments),this.color=At(1,1,1,1)}}function Gje(){const e=new pr;return e.include(ih),e.fragment.uniforms.add(new qe("tex",t=>t.texture),new Zt("uColor",t=>t.color)),e.fragment.code.add(b`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * uColor;
}`),e}const jje=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:vye,build:Gje},Symbol.toStringTag,{value:"Module"}));class bye{constructor(t){this._context=t,this._perConstructorInstances=new S2,this._frameCounter=0,this._keepAliveFrameCount=CQ}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(t=>t.forEach(r=>r.technique.destroy())),this._perConstructorInstances.clear()}acquire(t,r=Wje){const i=r.key;let s=this._perConstructorInstances.get(t,i);if(s==null){const n=new t(this._context,r,()=>this.release(n));s=new Hje(n),this._perConstructorInstances.set(t,i,s)}return++s.refCount,s.technique}releaseAndAcquire(t,r,i){if(i!=null){if(r.key===i.key)return i;this.release(i)}return this.acquire(t,r)}release(t){if(t==null||this._perConstructorInstances.empty)return;const r=this._perConstructorInstances.get(t.constructor,t.key);r!=null&&(--r.refCount,r.refCount===0&&(r.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==CQ&&this._perConstructorInstances.forEach((t,r)=>{t.forEach((i,s)=>{i.refCount===0&&i.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(i.technique.destroy(),this._perConstructorInstances.delete(r,s))})})}async reloadAll(){const t=new Array;this._perConstructorInstances.forEach((r,i)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>l.technique.reload(this._context)))};t.push(s(r,i))}),await Promise.all(t)}}class Hje{constructor(t){this.technique=t,this.refCount=0,this.refZeroFrame=0}}const CQ=-1,Wje=new Yo;class wye{constructor(t,r,i,s){this._textureRepository=t,this._techniqueRepository=r,this.materialChanged=i,this.requestRender=s,this._id2glMaterialRef=new S2}dispose(){this._textureRepository.destroy()}acquire(t,r,i){if(this._ownMaterial(t),!t.requiresSlot(r,i))return null;let s=this._id2glMaterialRef.get(i,t.id);if(s==null){const n=t.createGLMaterial({material:t,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:i});s=new qje(n),this._id2glMaterialRef.set(i,t.id,s)}return s.ref(),s.glMaterial}release(t,r){const i=this._id2glMaterialRef.get(r,t.id);i!=null&&(i.unref(),i.referenced||(De(i.glMaterial),this._id2glMaterialRef.delete(r,t.id)))}_ownMaterial(t){t.repository!=null&&t.repository!==this&&K.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),t.repository=this}}class qje{constructor(t){this.glMaterial=t,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,Ye(this._refCnt>=0)}get referenced(){return this._refCnt>0}}const Xje={orderedRepackingEnabled:!1},Zje=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","objectGeometryUpdated"];class qv{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(t,r){this.objectToBoundingSphere=t,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new rs,this._objectCount=0,r&&(r.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=r.maximumObjectsPerNode),r.maximumDepth!==void 0&&(this._maximumDepth=r.maximumDepth))}destroy(){this._degenerateObjects.clear(),rs.clearPool(),hB[0]=null,a_.prune(),Q_.prune()}add(t,r=t.length){this._objectCount+=r,this._grow(t,r);const i=rs.acquire();for(let s=0;s<r;s++){const n=t[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(i.init(this._root),this._add(n,i))}rs.release(i)}remove(t,r=null){this._objectCount-=t.length;const i=rs.acquire();for(const s of t){const n=r??yT(this.objectToBoundingSphere(s),eHe);NE(n[3])?(i.init(this._root),this._remove(s,n,i)):this._degenerateObjects.delete(s)}rs.release(i),this._shrink()}update(t,r){if(!NE(r[3])&&this._isDegenerate(t))return;const i=Qje(t);this.remove(i,r),this.add(i)}forEachAlongRay(t,r,i){const s=Fc(t,r);this._forEachNode(this._root,n=>{if(!this._intersectsNode(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),!0})}forEachAlongRayWithVerticalOffset(t,r,i,s){const n=Fc(t,r);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),!0})}forEach(t){this._forEachNode(this._root,r=>{const i=r.node;return i.terminals.forAll(t),i.residents!==null&&i.residents.forAll(t),!0}),this._degenerateObjects.forEach(t)}forEachDegenerateObject(t){this._degenerateObjects.forEach(t)}findClosest(t,r,i,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=$6(t,r),u=d=>{if(--n,!s(d))return;const p=this.objectToBoundingSphere(d);if(!Z0(i,p))return;const g=T0(t,r,p),y=g-p[3],_=g+p[3];y<o&&(o=y,a=_,l=d)};return this._forEachNodeDepthOrdered(this._root,d=>{if(n<=0||!Z0(i,d.bounds)||(te(Wc,c,d.halfSize),oe(Wc,Wc,d.bounds),T0(t,r,Wc)>a))return!1;const p=d.node;return p.terminals.forAll(g=>u(g)),p.residents!==null&&p.residents.forAll(g=>u(g)),!0},t,r),l}forEachInDepthRange(t,r,i,s,n,o,a){let l=-1/0,c=1/0;const u={setRange:_=>{i===qv.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,_.near),c=Math.min(c,_.far)):(l=Math.max(l,-_.far),c=Math.min(c,-_.near))}};u.setRange(s);const d=T0(r,i,t),p=$6(r,i),g=$6(r,-i),y=_=>{if(!a(_))return;const v=this.objectToBoundingSphere(_),w=v,T=T0(r,i,w)-d,x=T-v[3],S=T+v[3];x>c||S<l||!Z0(o,v)||n(_,u)};this._forEachNodeDepthOrdered(this._root,_=>{if(!Z0(o,_.bounds)||(te(Wc,p,_.halfSize),oe(Wc,Wc,_.bounds),T0(r,i,Wc)-d>c)||(te(Wc,g,_.halfSize),oe(Wc,Wc,_.bounds),T0(r,i,Wc)-d<l))return!1;const v=_.node;return v.terminals.forAll(w=>y(w)),v.residents!==null&&v.residents.forAll(w=>y(w)),!0},r,i)}forEachNode(t){this._forEachNode(this._root,r=>t(r.node,r.bounds,r.halfSize,r.depth))}forEachNeighbor(t,r){const i=ym(r),s=r,n=l=>{const c=this.objectToBoundingSphere(l),u=ym(c),d=i+u;return!(gn(c,s)-d*d<=0)||t(l)};let o=!0;const a=l=>{o&&(o=n(l))};this._forEachNode(this._root,l=>{const c=ym(l.bounds),u=i+c;if(gn(l.bounds,s)-u*u>0)return!1;const d=l.node;return d.terminals.forAll(a),o&&d.residents!==null&&d.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsNode(t,r){return JR(r.bounds,2*-r.halfSize,pc),JR(r.bounds,2*r.halfSize,fc),PY(t.origin,t.direction,pc,fc)}_intersectsNodeWithOffset(t,r,i){return JR(r.bounds,2*-r.halfSize,pc),JR(r.bounds,2*r.halfSize,fc),i.applyToMinMax(pc,fc),PY(t.origin,t.direction,pc,fc)}_intersectsObject(t,r){const i=this.objectToBoundingSphere(r);return!(i[3]>0)||Bk(i,t)}_intersectsObjectWithOffset(t,r,i){const s=this.objectToBoundingSphere(r);return!(s[3]>0)||Bk(i.applyToBoundingSphere(s),t)}_forEachNode(t,r){let i=rs.acquire().init(t);const s=[i];for(;s.length!==0;){if(i=s.pop(),r(i)&&!i.isLeaf())for(let n=0;n<i.node.children.length;n++)i.node.children[n]&&s.push(rs.acquire().init(i).advance(n));rs.release(i)}}_forEachNodeDepthOrdered(t,r,i,s=qv.DepthOrder.FRONT_TO_BACK){let n=rs.acquire().init(t);const o=[n];for(Kje(i,s,RQ);o.length!==0;){if(n=o.pop(),r(n)&&!n.isLeaf())for(let a=7;a>=0;--a){const l=RQ[a];n.node.children[l]&&o.push(rs.acquire().init(n).advance(l))}rs.release(n)}}_remove(t,r,i){a_.clear();const s=i.advanceTo(r,(n,o)=>{a_.push(n.node),a_.push(o)})?i.node.terminals:i.node.residents;if(s.removeUnordered(t),s.length===0)for(let n=a_.length-2;n>=0;n-=2){const o=a_.data[n],a=a_.data[n+1];if(!this._purge(o,a))break}}_nodeIsEmpty(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let r=0;r<t.children.length;r++)if(t.children[r])return!1;return!0}_purge(t,r){return r>=0&&(t.children[r]=null),!!this._nodeIsEmpty(t)&&(t.residents===null&&(t.residents=new Mt({shrink:!0})),!0)}_add(t,r){r.advanceTo(this.objectToBoundingSphere(t))?r.node.terminals.push(t):(r.node.residents.push(t),r.node.residents.length>this._maximumObjectsPerNode&&r.depth<this._maximumDepth&&this._split(r))}_split(t){const r=t.node.residents;t.node.residents=null;for(let i=0;i<r.length;i++){const s=rs.acquire().init(t);this._add(r.at(i),s),rs.release(s)}}_grow(t,r){if(r!==0&&(AQ(t,r,i=>this.objectToBoundingSphere(i),xf),NE(xf[3])&&!this._fitsInsideTree(xf)))if(this._nodeIsEmpty(this._root.node))yT(xf,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const i=this._rootBoundsForRootAsSubNode(xf);this._placingRootViolatesMaxDepth(i)?this._rebuildTree(xf,i):this._growRootAsSubNode(i),rs.release(i)}}_rebuildTree(t,r){re(D6,r.bounds),D6[3]=r.halfSize,AQ([t,D6],2,s=>s,N6);const i=rs.acquire().init(this._root);this._root.initFrom(null,N6,N6[3]),this._root.increaseHalfSize(1.25),this._forEachNode(i,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),rs.release(i)}_placingRootViolatesMaxDepth(t){const r=Math.log(t.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,s=>(i=Math.max(i,s.depth),i+r<=this._maximumDepth)),i+r>this._maximumDepth}_rootBoundsForRootAsSubNode(t){const r=t[3],i=t;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=n[l]-o-(i[l]-r),u=i[l]+r-(n[l]+o),d=Math.max(0,Math.ceil(c/(2*o))),p=Math.max(0,Math.ceil(u/(2*o)))+1,g=2**Math.ceil(Math.log(d+p)*Math.LOG2E);s=Math.max(s,g),KR[l].min=d,KR[l].max=p}for(let l=0;l<3;l++){let c=KR[l].min,u=KR[l].max;const d=(s-(c+u))/2;c+=Math.ceil(d),u+=Math.floor(d);const p=n[l]-o-c*o*2;L6[l]=p+(u+c)*o}const a=s*o;return L6[3]=a*Tye,rs.acquire().initFrom(null,L6,a,0)}_growRootAsSubNode(t){const r=this._root.node;re(xf,this._root.bounds),xf[3]=this._root.halfSize,this._root.init(t),t.advanceTo(xf,null,!0),t.node.children=r.children,t.node.residents=r.residents,t.node.terminals=r.terminals}_shrink(){for(;;){const t=this._findShrinkIndex();if(t===-1)break;this._root.advance(t),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let t=null;const r=this._root.node.children;let i=0,s=0;for(;s<r.length&&t==null;)i=s++,t=r[i];for(;s<r.length;)if(r[s++])return-1;return i}_isDegenerate(t){return!NE(this.objectToBoundingSphere(t)[3])}_fitsInsideTree(t){const r=this._root.bounds,i=this._root.halfSize;return t[3]<=i&&t[0]>=r[0]-i&&t[0]<=r[0]+i&&t[1]>=r[1]-i&&t[1]<=r[1]+i&&t[2]>=r[2]-i&&t[2]<=r[2]+i}toJSON(){const{maximumDepth:t,maximumObjectsPerNode:r,_objectCount:i}=this,s=this._nodeToJSON(this._root.node);return{maximumDepth:t,maximumObjectsPerNode:r,objectCount:i,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:s}}}_nodeToJSON(t){const r=t.children.map(n=>n?this._nodeToJSON(n):null),i=t.residents?.map(n=>this.objectToBoundingSphere(n)),s=t.terminals?.map(n=>this.objectToBoundingSphere(n));return{children:r,residents:i,terminals:s}}static fromJSON(t){const r=new qv(i=>i,{maximumDepth:t.maximumDepth,maximumObjectsPerNode:t.maximumObjectsPerNode});return r._objectCount=t.objectCount,r._root.initFrom(t.root.node,t.root.bounds,t.root.halfSize,t.root.depth),r}}class rs{constructor(){this.bounds=ls(),this.halfSize=0,this.initFrom(null,null,0,0)}init(t){return this.initFrom(t.node,t.bounds,t.halfSize,t.depth)}initFrom(t,r,i,s=this.depth){return this.node=t??rs.createEmptyNode(),r!=null&&yT(r,this.bounds),this.halfSize=i,this.depth=s,this}increaseHalfSize(t){this.halfSize*=t,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*Tye}advance(t){let r=this.node.children[t];r||(r=rs.createEmptyNode(),this.node.children[t]=r),this.node=r,this.halfSize/=2,this.depth++;const i=xye[t];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(t,r,i=!1){for(;;){if(this.isTerminalFor(t))return r&&r(this,-1),!0;if(this.isLeaf()){if(!i)return r&&r(this,-1),!1;this.node.residents=null}const s=this._childIndex(t);r&&r(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(t){return t[3]>this.halfSize/2}_childIndex(t){const r=this.bounds;return(r[0]<t[0]?1:0)+(r[1]<t[1]?2:0)+(r[2]<t[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Mt({shrink:!0}),residents:new Mt({shrink:!0})}}static acquire(){return rs._pool.acquire()}static release(t){rs._pool.release(t)}static clearPool(){rs._pool.prune()}}function Yje(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function Jje(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function JR(e,t,r){r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t}function AQ(e,t,r,i){if(t===1){const s=r(e[0]);yT(s,i)}else{pc[0]=1/0,pc[1]=1/0,pc[2]=1/0,fc[0]=-1/0,fc[1]=-1/0,fc[2]=-1/0;for(let s=0;s<t;s++){const n=r(e[s]);NE(n[3])&&(Yje(pc,n),Jje(fc,n))}Lr(i,pc,fc,.5),i[3]=Math.max(fc[0]-pc[0],fc[1]-pc[1],fc[2]-pc[2])/2}}function Kje(e,t,r){if(!Q_.length)for(let i=0;i<8;++i)Q_.push({index:0,distance:0});for(let i=0;i<8;++i){const s=xye[i];Q_.data[i].index=i,Q_.data[i].distance=T0(e,t,s)}Q_.sort((i,s)=>i.distance-s.distance);for(let i=0;i<8;++i)r[i]=Q_.data[i].index}function $6(e,t){let r,i=1/0;for(let s=0;s<8;++s){const n=T0(e,t,OQ[s]);n<i&&(i=n,r=OQ[s])}return r}function T0(e,t,r){return t*(e[0]*r[0]+e[1]*r[1]+e[2]*r[2])}function NE(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}rs._pool=new fn(rs),function(e){var t;(t=e.DepthOrder||(e.DepthOrder={}))[t.FRONT_TO_BACK=1]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(qv||(qv={}));const xye=[Ce(-1,-1,-1),Ce(1,-1,-1),Ce(-1,1,-1),Ce(1,1,-1),Ce(-1,-1,1),Ce(1,-1,1),Ce(-1,1,1),Ce(1,1,1)],OQ=[Ce(-1,-1,-1),Ce(-1,-1,1),Ce(-1,1,-1),Ce(-1,1,1),Ce(1,-1,-1),Ce(1,-1,1),Ce(1,1,-1),Ce(1,1,1)],Tye=Math.sqrt(3),hB=[null];function Qje(e){return hB[0]=e,hB}const L6=ls(),Wc=C(),pc=C(),fc=C(),a_=new Mt,eHe=ls(),xf=ls(),D6=ls(),N6=ls(),KR=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],Q_=new Mt,RQ=[0,0,0,0,0,0,0,0],nd=qv;var oy;(function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"})(oy||(oy={}));class Sye extends W3{get objects(){return this._objects}constructor(t,r,i=""){super(),this.stage=t,this.apiLayerUid=i,this.type=Ki.Layer,this.events=new cs,this.sliceable=!1,this._objects=new Mt,this._objectsAdded=new Mt,this._handles=new gi,this.apiLayerUid=i,this.visible=r?.visible??!0,this.pickable=r?.pickable??!0,this.updatePolicy=r?.updatePolicy??oy.ASYNC,this._disableOctree=r?.disableOctree??!1,t.add(this);for(const s of Zje)this._handles.add(this.events.on(s,n=>t.handleEvent(s,n)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(t){this._objects.push(t),t.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:t}),this._octree!=null&&this._objectsAdded.push(t)}remove(t){this._objects.removeUnordered(t)&&(t.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:t}),this._octree!=null&&(this._objectsAdded.removeUnordered(t)||this._octree.remove([t])))}addMany(t){this._objects.pushArray(t);for(const r of t)r.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:t}),this._octree!=null&&this._objectsAdded.pushArray(t)}removeMany(t){const r=new Array;if(this._objects.removeUnorderedMany(t,t.length,r),r.length!==0){for(const i of r)i.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:r}),this._octree!=null){for(let i=0;i<r.length;)this._objectsAdded.removeUnordered(r[i])?(r[i]=r[r.length-1],r.length-=1):++i;this._octree.remove(r)}}}sync(){this.updatePolicy!==oy.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(t,r){this._octree==null||this._objectsAdded.includes(t)||this._octree.update(t,r)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new nd(t=>t.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=Re(this._octree),this._objectsAdded.clear()}}function WL(e){return e!=null&&e.type===Ki.Layer}var Mc,U1;(function(e){e[e.Draped=0]="Draped",e[e.Screen=1]="Screen",e[e.World=2]="World",e[e.COUNT=3]="COUNT"})(Mc||(Mc={})),function(e){e[e.Center=0]="Center",e[e.Tip=1]="Tip",e[e.COUNT=2]="COUNT"}(U1||(U1={}));class Yn extends bo{constructor(){super(...arguments),this.output=D.Color,this.transparencyPassType=tt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=Mc.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=U1.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}get draped(){return this.space===Mc.Draped}}h([B({count:D.COUNT})],Yn.prototype,"output",void 0),h([B({count:tt.COUNT})],Yn.prototype,"transparencyPassType",void 0),h([B()],Yn.prototype,"occluder",void 0),h([B()],Yn.prototype,"hasSlicePlane",void 0),h([B()],Yn.prototype,"writeDepth",void 0),h([B({count:Mc.COUNT})],Yn.prototype,"space",void 0),h([B()],Yn.prototype,"hideOnShortSegments",void 0),h([B()],Yn.prototype,"hasCap",void 0),h([B({count:U1.COUNT})],Yn.prototype,"anchor",void 0),h([B()],Yn.prototype,"hasTip",void 0),h([B()],Yn.prototype,"vvSize",void 0),h([B()],Yn.prototype,"vvColor",void 0),h([B()],Yn.prototype,"vvOpacity",void 0),h([B()],Yn.prototype,"hasOccludees",void 0),h([B()],Yn.prototype,"hasMultipassTerrain",void 0),h([B()],Yn.prototype,"cullAboveGround",void 0),h([B({constValue:!0})],Yn.prototype,"hasVvInstancing",void 0),h([B({constValue:!0})],Yn.prototype,"hasSliceTranslatedView",void 0);const PQ=8;function Eye(e,t){const r=e.vertex;r.uniforms.add(new Ae("intrinsicWidth",i=>i.width)),t.vvSize?(e.attributes.add(E.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new Rt("vvSizeMinSize",i=>i.vvSize.minSize),new Rt("vvSizeMaxSize",i=>i.vvSize.maxSize),new Rt("vvSizeOffset",i=>i.vvSize.offset),new Rt("vvSizeFactor",i=>i.vvSize.factor)),r.code.add(b`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add(E.SIZE,"float"),r.code.add(b`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add(E.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add(new Wa("vvOpacityValues",i=>i.vvOpacity.values,PQ),new Wa("vvOpacityOpacities",i=>i.vvOpacity.opacityValues,PQ)),r.code.add(b`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):r.code.add(b`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.include(wm,t),e.attributes.add(E.COLORFEATUREATTRIBUTE,"float"),r.code.add(b`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(e.attributes.add(E.COLOR,"vec4"),r.code.add(b`vec4 getColor(){
return applyOpacity(color);
}`))}function jm(e,t){switch(e.fragment.include(Hl),t.output){case D.Shadow:case D.ShadowHighlight:case D.ShadowExcludeHighlight:e.fragment.code.add(b`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
fragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`);break;case D.Depth:e.fragment.code.add(b`void outputDepth(float _linearDepth) {
fragColor = float2rgba(_linearDepth);
}`)}}class Cye{constructor(t,r,i){this._createTexture=t,this._parametersKey=r,this._repository=new Map,this._orphanCache=i.newCache(`procedural-texture-repository:${Nl()}`,s=>s.dispose())}destroy(){for(const[t,{texture:r}]of this._repository)r.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(t,r=null){const i=this._acquire(t);return this.release(r),i}release(t){if(t==null)return;const r=this._parametersKey(t),i=this._repository.get(r);if(i&&(i.refCount--,i.refCount===0)){this._repository.delete(r);const{texture:s}=i,n=s.gpuMemoryUsage;this._orphanCache.put(r,s,n)}}_acquire(t){if(t==null)return null;const r=this._parametersKey(t),i=this._repository.get(r);if(i)return i.refCount++,i.texture;const s=this._orphanCache.pop(r)??this._createTexture(t),n=new tHe(s);return this._repository.set(r,n),s}}class tHe{constructor(t){this.texture=t,this.refCount=1}}function rHe(e,t){return new Cye(r=>{const{encodedData:i,paddedPixels:s}=iHe(r),n=new hr;return n.internalFormat=vt.RGBA,n.width=s,n.height=1,n.wrapMode=Ct.CLAMP_TO_EDGE,new wt(e,n,i)},r=>`${r.pattern.join(",")}-r${r.pixelRatio}`,t)}function iHe(e){const t=VH(e),r=1/e.pixelRatio,i=Aye(e),s=Oye(e),n=(Math.floor(.5*(s-1))+.5)*r,o=[];let a=1;for(const g of t){for(let y=0;y<g;y++){const _=a*(Math.min(y,g-1-y)+.5)*r/n*.5+.5;o.push(_)}a=-a}const l=Math.round(t[0]/2),c=[...o.slice(l),...o.slice(0,l)],u=i+Rye,d=new Uint8Array(4*u);let p=4;for(const g of c)XA(g,d,p),p+=4;return d.copyWithin(0,p-4,p),d.copyWithin(p,4,8),{encodedData:d,paddedPixels:u}}function VH(e){return e.pattern.map(t=>Math.round(t*e.pixelRatio))}function Aye(e){if(e==null)return 1;const t=VH(e);return Math.floor(t.reduce((r,i)=>r+i))}function Oye(e){return VH(e).reduce((t,r)=>Math.max(t,r))}const Rye=2;function sHe(e){return e==null?Up:e.length===4?e:pi(nHe,e[0],e[1],e[2],1)}const nHe=Ht();function Pye(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?oHe(e,t):aHe(e)}function oHe(e,t){const r=!(t.draped&&t.stipplePreferContinuous),{vertex:i,fragment:s}=e;s.include(Hl),t.draped||(xd(i,t),i.uniforms.add(new Ae("worldToScreenPerDistanceRatio",(n,o)=>1/o.camera.perScreenPixelRatio)),i.code.add(b`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),t.stippleRequiresStretchMeasure&&e.varyings.add("vStipplePatternStretch","float"),i.code.add(b`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${cHe};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),i.code.add(b`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),i.code.add(b`
    if (segmentLengthPseudoScreen >= ${r?"patternLength":"1e4"}) {
  `),R2(i,t),i.code.add(b`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${t.stippleRequiresStretchMeasure?b`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),s.constants.add("stippleTexturePadding","float",Rye),s.uniforms.add(new qe("stipplePatternTexture",n=>n.stippleTexture),new Ae("stipplePatternSDFNormalizer",n=>lHe(n.stipplePattern)),new Ae("stipplePatternPixelSizeInv",n=>1/GH(n))),s.code.add(b`float padStippleTexture(float u) {
float paddedTextureSize = float(textureSize(stipplePatternTexture, 0).x);
float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;
return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;
}`),s.code.add(b`
    float getStippleSDF(out bool isClamped) {
      ${t.stippleRequiresClamp?b`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:b`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${t.stippleScaleWithLineWidth?b`u *= vLineSizeInv;`:""}
      u = padStippleTexture(fract(u));

      float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${t.stippleRequiresStretchMeasure?b`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:b`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${t.stippleScaleWithLineWidth?b`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:b`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),t.stippleOffColorEnabled?(s.uniforms.add(new Zt("stippleOffColor",n=>sHe(n.stippleOffColor))),s.code.add(b`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(b`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function aHe(e){e.fragment.code.add(b`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function lHe(e){return e?(Math.floor(.5*(Oye(e)-1))+.5)/e.pixelRatio:1}function GH(e){const t=e.stipplePattern;return t?Aye(e.stipplePattern)/t.pixelRatio:1}const cHe=b.float(.4),Xv=64,jH=Xv/2,Mye=jH/5,uHe=Xv/Mye,hHe=.25;function dHe(e,t){const r=Uge(e,Xv,jH,Mye),i=new hr;return i.internalFormat=vt.RGBA,i.width=Xv,i.height=Xv,i.wrapMode=Ct.CLAMP_TO_EDGE,new wt(t,i,r)}function Iye(e,t){const{vertex:r,constants:i}=e;i.add("markerSizePerLineWidth","float",uHe),R2(r,t),r.uniforms.get("markerScale")==null&&r.constants.add("markerScale","float",1),r.code.add(b`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),t.space===Mc.World&&(r.constants.add("maxSegmentLengthFraction","float",.45),r.uniforms.add(new Ae("perRenderPixelRatio",(s,n)=>n.camera.perRenderPixelRatio)),r.code.add(b`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}var Gu;(function(e){e[e.BUTT=0]="BUTT",e[e.SQUARE=1]="SQUARE",e[e.ROUND=2]="ROUND",e[e.COUNT=3]="COUNT"})(Gu||(Gu={}));class Ri extends bo{constructor(){super(...arguments),this.output=D.Color,this.capType=Gu.BUTT,this.transparencyPassType=tt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}}h([B({count:D.COUNT})],Ri.prototype,"output",void 0),h([B({count:Gu.COUNT})],Ri.prototype,"capType",void 0),h([B({count:tt.COUNT})],Ri.prototype,"transparencyPassType",void 0),h([B()],Ri.prototype,"occluder",void 0),h([B()],Ri.prototype,"hasSlicePlane",void 0),h([B()],Ri.prototype,"hasPolygonOffset",void 0),h([B()],Ri.prototype,"writeDepth",void 0),h([B()],Ri.prototype,"draped",void 0),h([B()],Ri.prototype,"stippleEnabled",void 0),h([B()],Ri.prototype,"stippleOffColorEnabled",void 0),h([B()],Ri.prototype,"stippleScaleWithLineWidth",void 0),h([B()],Ri.prototype,"stipplePreferContinuous",void 0),h([B()],Ri.prototype,"roundJoins",void 0),h([B()],Ri.prototype,"applyMarkerOffset",void 0),h([B()],Ri.prototype,"vvSize",void 0),h([B()],Ri.prototype,"vvColor",void 0),h([B()],Ri.prototype,"vvOpacity",void 0),h([B()],Ri.prototype,"falloffEnabled",void 0),h([B()],Ri.prototype,"innerColorEnabled",void 0),h([B()],Ri.prototype,"hasOccludees",void 0),h([B()],Ri.prototype,"hasMultipassTerrain",void 0),h([B()],Ri.prototype,"cullAboveGround",void 0),h([B()],Ri.prototype,"wireframe",void 0),h([B({constValue:!0})],Ri.prototype,"stippleRequiresClamp",void 0),h([B({constValue:!0})],Ri.prototype,"stippleRequiresStretchMeasure",void 0),h([B({constValue:!0})],Ri.prototype,"hasVvInstancing",void 0),h([B({constValue:!0})],Ri.prototype,"hasSliceTranslatedView",void 0),h([B()],Ri.prototype,"objectAndLayerIdColorInstanced",void 0);const qL=1;function pHe(e){const t=new pr,{vertex:r,fragment:i}=t,s=e.hasMultipassTerrain&&(e.output===D.Color||e.output===D.Alpha);t.include(j3),t.include(Eye,e),t.include(Pye,e);const n=e.applyMarkerOffset&&!e.draped;n&&(r.uniforms.add(new Ae("markerScale",g=>g.markerScale)),t.include(Iye,{space:Mc.World,draped:!1})),e.output===D.Depth&&t.include(jm,e),t.include(K3,e),Fl(r,e),r.uniforms.add(new Ci("inverseProjectionMatrix",(g,y)=>y.camera.inverseProjectionMatrix),new yr("nearFar",(g,y)=>y.camera.nearFar),new Ae("miterLimit",g=>g.join!=="miter"?0:g.miterLimit),new Zt("viewport",(g,y)=>y.camera.fullViewport)),r.constants.add("LARGE_HALF_FLOAT","float",65500),t.attributes.add(E.POSITION,"vec3"),t.attributes.add(E.SUBDIVISIONFACTOR,"float"),t.attributes.add(E.UV0,"vec2"),t.attributes.add(E.AUXPOS1,"vec3"),t.attributes.add(E.AUXPOS2,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),by(t),s&&t.varyings.add("depth","float");const o=e.stippleEnabled&&e.stippleScaleWithLineWidth;o&&t.varyings.add("vLineSizeInv","float");const a=e.capType===Gu.ROUND,l=o||a;l&&t.varyings.add("vLineWidth","float");const c=e.innerColorEnabled||a;c&&t.varyings.add("vLineDistance","float");const u=e.stippleEnabled&&a,d=e.falloffEnabled||u;d&&t.varyings.add("vLineDistanceNorm","float"),a&&(t.varyings.add("vSegmentSDF","float"),t.varyings.add("vReverseSegmentSDF","float")),r.code.add(b`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),r.code.add(b`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),GN(t),r.code.add(b`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${s?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),R2(r,e),r.code.add(b`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${l?b`vLineWidth = lineWidth;`:""}
      ${o?b`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `),n&&r.code.add(b`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),r.code.add(b`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(e.stippleEnabled||a)&&r.code.add(b`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${a?b`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),r.code.add(b`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?r.code.add(b`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${e.stippleEnabled?b`min(1.0, subdivisionFactor * ${b.float((qL+2)/(qL+1))})`:b`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):r.code.add(b`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const p=e.capType!==Gu.BUTT;return r.code.add(b`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${p?b`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),r.code.add(b`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${d||c?b`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${c?b`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${d?b`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),a&&r.code.add(b`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),e.stippleEnabled&&(e.draped?r.uniforms.add(new Ae("worldToScreenRatio",(g,y)=>1/y.screenToPCSRatio)):r.code.add(b`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(b`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),e.draped?r.code.add(b`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):r.code.add(b`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new Ae("stipplePatternPixelSize",g=>GH(g))),r.code.add(b`
      float patternLength = ${e.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),r.code.add(b`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),s&&t.include(kc,e),t.include(os,e),i.include(df),i.code.add(b`
  void main() {
    discardBySlice(vpos);
    ${s?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),e.wireframe?i.code.add(b`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(a&&i.code.add(b`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${b.float(to)}) {
        discard;
      }
    `),u?i.code.add(b`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${b.float(to)}, stippleCoverage);
      `):i.code.add(b`float stippleAlpha = getStippleAlpha();`),i.uniforms.add(new Zt("intrinsicColor",g=>g.color)),e.output!==D.ObjectAndLayerIdColor&&i.code.add(b`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),i.code.add(b`vec4 color = intrinsicColor * vColor;`),e.innerColorEnabled&&(i.uniforms.add(new Zt("innerColor",g=>g.innerColor??g.color),new Ae("innerWidth",(g,y)=>g.innerWidth*y.camera.pixelRatio)),i.code.add(b`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),i.code.add(b`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&(i.uniforms.add(new Ae("falloff",g=>g.falloff)),i.code.add(b`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),i.code.add(b`
    ${e.output===D.ObjectAndLayerIdColor?b`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${b.float(to)}) {
      discard;
    }

    ${e.output===D.Alpha?b`fragColor = vec4(finalColor.a);`:""}
    ${e.output===D.Color?b`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===D.Color&&e.transparencyPassType===tt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${e.output===D.Highlight?b`fragColor = vec4(1.0);`:""}
    ${e.output===D.Depth?b`outputDepth(linearDepth);`:""}
    ${e.output===D.ObjectAndLayerIdColor?b`outputObjectAndLayerIdColor();`:""}
  }
  `),t}const fHe=Object.freeze(Object.defineProperty({__proto__:null,RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS:qL,build:pHe},Symbol.toStringTag,{value:"Module"})),HH={func:Hr.LESS},XL={func:Hr.ALWAYS},ef={mask:255},$ye={mask:0},mHe=e=>({function:{func:Hr.NOTEQUAL,ref:e,mask:e},operation:{fail:as.KEEP,zFail:as.KEEP,zPass:as.KEEP}}),gHe=e=>({function:{func:Hr.ALWAYS,ref:e,mask:e},operation:{fail:as.KEEP,zFail:as.KEEP,zPass:as.REPLACE}}),ky={function:{func:Hr.ALWAYS,ref:Za.OutlineVisualElementMask,mask:Za.OutlineVisualElementMask},operation:{fail:as.KEEP,zFail:as.KEEP,zPass:as.ZERO}},My={function:{func:Hr.ALWAYS,ref:Za.OutlineVisualElementMask,mask:Za.OutlineVisualElementMask},operation:{fail:as.KEEP,zFail:as.KEEP,zPass:as.REPLACE}},Lye={function:{func:Hr.EQUAL,ref:Za.OutlineVisualElementMask,mask:Za.OutlineVisualElementMask},operation:{fail:as.KEEP,zFail:as.KEEP,zPass:as.KEEP}},Dye={function:{func:Hr.NOTEQUAL,ref:Za.OutlineVisualElementMask,mask:Za.OutlineVisualElementMask},operation:{fail:as.KEEP,zFail:as.KEEP,zPass:as.KEEP}},Nye=new Map([[E.POSITION,0],[E.SUBDIVISIONFACTOR,1],[E.UV0,2],[E.AUXPOS1,3],[E.AUXPOS2,4],[E.COLOR,5],[E.COLORFEATUREATTRIBUTE,5],[E.SIZE,6],[E.SIZEFEATUREATTRIBUTE,6],[E.OPACITYFEATUREATTRIBUTE,7],[E.OBJECTANDLAYERIDCOLOR,8]]);class E4 extends xr{initializeProgram(t){return new vr(t.rctx,E4.shader.get().build(this.configuration),Nye)}_makePipelineState(t,r){const i=this.configuration,s=t===tt.NONE,n=t===tt.FrontFace;return Tt({blending:i.output===D.Color||i.output===D.Alpha?s?Pc:sg(t):null,depthTest:{func:Uy(t)},depthWrite:s?i.writeDepth?Ka:null:c4(t),colorWrite:It,stencilWrite:i.hasOccludees?ef:null,stencilTest:i.hasOccludees?r?My:ky:null,polygonOffset:s||n?i.hasPolygonOffset?MQ:null:h4})}initializePipeline(){const t=this.configuration;if(t.occluder){const r=t.hasPolygonOffset?MQ:null;this._occluderPipelineTransparent=Tt({blending:Pc,polygonOffset:r,depthTest:XL,depthWrite:null,colorWrite:It,stencilWrite:null,stencilTest:Dye}),this._occluderPipelineOpaque=Tt({blending:Pc,polygonOffset:r,depthTest:XL,depthWrite:null,colorWrite:It,stencilWrite:$ye,stencilTest:Lye}),this._occluderPipelineMaskWrite=Tt({blending:null,polygonOffset:r,depthTest:HH,depthWrite:null,colorWrite:null,stencilWrite:ef,stencilTest:My})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?bt.LINES:bt.TRIANGLE_STRIP}getPipelineState(t,r){return r?this._occludeePipelineState:this.configuration.occluder?t===ae.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===ae.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,r)}}E4.shader=new _r(fHe,()=>ue(()=>import("./RibbonLine.glsl.03ecc2db.js"),[]));const MQ={factor:0,units:-4};var gl;(function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(gl||(gl={}));class mx extends Fy{constructor(t){super(t,new _He),this._configuration=new Ri,this._vertexAttributeLocations=Nye}isClosed(t,r){return Uye(this.parameters,t,r)}getConfiguration(t,r){this._configuration.output=t,this._configuration.draped=r.slot===ae.DRAPED_MATERIAL;const i=this.parameters.stipplePattern!=null&&t!==D.Highlight;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&this.parameters.stippleOffColor!=null,this._configuration.stippleScaleWithLineWidth=i&&this.parameters.stippleScaleWithLineWidth,this._configuration.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&bHe(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===Ei.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(t,r,i,s,n,o){if(!i.options.selectionMode)return;const a=t.vertexAttributes.get(E.POSITION).data,l=t.vertexAttributes.get(E.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const _=t.vertexAttributes.get(E.SIZEFEATUREATTRIBUTE).data[0];c*=fe(this.parameters.vvSize.offset[0]+_*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const u=s[0],d=s[1],p=(c/2+4)*t.screenToWorldRatio;let g=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],w=a[_+1],T=u-v,x=d-w,S=a[_+3]-v,O=a[_+4]-w,A=fe((S*T+O*x)/(S*S+O*O),0,1),$=S*A-T,P=O*A-x,U=$*$+P*P;U<g&&(g=U,y=_/3)}g<p*p&&n(o.dist,o.normal,y,!1)}intersect(t,r,i,s,n,o){if(!i.options.selectionMode||!t.visible)return;if(!Wpe(r))return void K.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=t.vertexAttributes,l=a.get(E.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSize){const T=a.get(E.SIZEFEATUREATTRIBUTE).data[0];c*=fe(this.parameters.vvSize.offset[0]+T*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else a.has(E.SIZE)&&(c*=a.get(E.SIZE).data[0]);const u=i.camera,d=wHe;en(d,i.point);const p=c*u.pixelRatio/2+4*u.pixelRatio;se(fS[0],d[0]-p,d[1]+p,0),se(fS[1],d[0]+p,d[1]+p,0),se(fS[2],d[0]+p,d[1]-p,0),se(fS[3],d[0]-p,d[1]-p,0);for(let T=0;T<4;T++)if(!u.unprojectFromRenderScreen(fS[T],Tf[T]))return;ko(u.eye,Tf[0],Tf[1],U6),ko(u.eye,Tf[1],Tf[2],k6),ko(u.eye,Tf[2],Tf[3],z6),ko(u.eye,Tf[3],Tf[0],B6);let g=Number.MAX_VALUE,y=0;const _=Fye(this.parameters,a,t.indices)?l.length-2:l.length-5;for(let T=0;T<_;T+=3){Ra[0]=l[T]+r[12],Ra[1]=l[T+1]+r[13],Ra[2]=l[T+2]+r[14];const x=(T+3)%l.length;if(Pa[0]=l[x]+r[12],Pa[1]=l[x+1]+r[13],Pa[2]=l[x+2]+r[14],ri(U6,Ra)<0&&ri(U6,Pa)<0||ri(k6,Ra)<0&&ri(k6,Pa)<0||ri(z6,Ra)<0&&ri(z6,Pa)<0||ri(B6,Ra)<0&&ri(B6,Pa)<0)continue;if(u.projectToRenderScreen(Ra,c_),u.projectToRenderScreen(Pa,u_),c_[2]<0&&u_[2]>0){ce(Ud,Ra,Pa);const O=u.frustum,A=-ri(O[ti.NEAR],Ra)/de(Ud,O[ti.NEAR]);te(Ud,Ud,A),oe(Ra,Ra,Ud),u.projectToRenderScreen(Ra,c_)}else if(c_[2]>0&&u_[2]<0){ce(Ud,Pa,Ra);const O=u.frustum,A=-ri(O[ti.NEAR],Pa)/de(Ud,O[ti.NEAR]);te(Ud,Ud,A),oe(Pa,Pa,Ud),u.projectToRenderScreen(Pa,u_)}else if(c_[2]<0&&u_[2]<0)continue;c_[2]=0,u_[2]=0;const S=LG(Vv(c_,u_,LQ),d);S<g&&(g=S,re(IQ,Ra),re($Q,Pa),y=T/3)}const v=i.rayBegin,w=i.rayEnd;if(g<p*p){let T=Number.MAX_VALUE;if(Ade(Vv(IQ,$Q,LQ),Vv(v,w,xHe),l_)){ce(l_,l_,v);const x=Se(l_);te(l_,l_,1/x),T=x/ni(v,w)}o(T,l_,y,!1)}}get _layout(){const t=Li().vec3f(E.POSITION).f32(E.SUBDIVISIONFACTOR).vec2f(E.UV0).vec3f(E.AUXPOS1).vec3f(E.AUXPOS2);return this.parameters.vvSize?t.f32(E.SIZEFEATUREATTRIBUTE):t.f32(E.SIZE),this.parameters.vvColor?t.f32(E.COLORFEATUREATTRIBUTE):t.vec4f(E.COLOR),this.parameters.vvOpacity&&t.f32(E.OPACITYFEATUREATTRIBUTE),ne("enable-feature:objectAndLayerId-rendering")&&t.vec4u8(E.OBJECTANDLAYERIDCOLOR),t}createBufferWriter(){return new vHe(this._layout,this.parameters)}requiresSlot(t,r){return r===D.Color||r===D.Alpha||r===D.Highlight||r===D.Depth||r===D.ObjectAndLayerIdColor?t===ae.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Ei.OccludeAndTransparentStencil?t===ae.OPAQUE_MATERIAL||t===ae.OCCLUDER_MATERIAL||t===ae.TRANSPARENT_OCCLUDER_MATERIAL:r===D.Color||r===D.Alpha?t===(this.parameters.writeDepth?ae.TRANSPARENT_MATERIAL:ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===ae.OPAQUE_MATERIAL:!1}createGLMaterial(t){return new yHe(t)}validateParameters(t){t.join!=="miter"&&(t.miterLimit=0),t.markerParameters!=null&&(t.markerScale=t.markerParameters.width/t.width)}}class yHe extends Ny{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){this._output!==D.Color&&this._output!==D.Alpha||this._updateOccludeeState(t);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(r,this._stipplePattern)}),this._stipplePattern=r),this.ensureTechnique(E4,t)}}class _He extends eO{constructor(){super(...arguments),this.width=0,this.color=Mu,this.join="miter",this.cap=Gu.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class vHe{constructor(t,r){this._parameters=r,this.numJoinSubdivisions=0,this.vertexBufferLayout=t;const i=r.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=qL+i}}_isClosed(t){return Fye(this._parameters,t.vertexAttributes,t.indices)}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){const i=t.indices.get(E.POSITION).length/2+1,s=this._isClosed(t);let n=s?2:2*2;return n+=((s?i:i-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(t,r,i,s,n){const o=THe,a=SHe,l=EHe,c=i.vertexAttributes.get(E.POSITION).data,u=i.indices&&i.indices.get(E.POSITION),d=i.vertexAttributes.get(E.DISTANCETOSTART)?.data;u&&u.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let p=1,g=0;this._parameters.vvSize?g=i.vertexAttributes.get(E.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(E.SIZE)&&(p=i.vertexAttributes.get(E.SIZE).data[0]);let y=[1,1,1,1],_=0;this._parameters.vvColor?_=i.vertexAttributes.get(E.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(E.COLOR)&&(y=i.vertexAttributes.get(E.COLOR).data);const v=ne("enable-feature:objectAndLayerId-rendering")?i.objectAndLayerIdColor:null;let w=0;this._parameters.vvOpacity&&(w=i.vertexAttributes.get(E.OPACITYFEATUREATTRIBUTE).data[0]);const T=c.length/3,x=new Float32Array(s.buffer),S=ne("enable-feature:objectAndLayerId-rendering")?new Uint8Array(s.buffer):null,O=this.vertexBufferLayout.stride/4;let A=n*O;const $=A;let P=0;const U=d?(V,J,R)=>P=d[R]:(V,J,R)=>P+=ni(V,J),I=ne("enable-feature:objectAndLayerId-rendering"),L=(V,J,R,k,z,H,X)=>{if(x[A++]=J[0],x[A++]=J[1],x[A++]=J[2],x[A++]=k,x[A++]=X,x[A++]=z,x[A++]=V[0],x[A++]=V[1],x[A++]=V[2],x[A++]=R[0],x[A++]=R[1],x[A++]=R[2],x[A++]=this._parameters.vvSize?g:p,this._parameters.vvColor)x[A++]=_;else{const Y=Math.min(4*H,y.length-4);x[A++]=y[Y],x[A++]=y[Y+1],x[A++]=y[Y+2],x[A++]=y[Y+3]}this._parameters.vvOpacity&&(x[A++]=w),I&&(v!=null&&(S[4*A]=v[0],S[4*A+1]=v[1],S[4*A+2]=v[2],S[4*A+3]=v[3]),A++)};A+=O,se(a,c[0],c[1],c[2]),t&&Ue(a,a,t);const N=this._isClosed(i);if(N){const V=c.length-3;se(o,c[V],c[V+1],c[V+2]),t&&Ue(o,o,t)}else se(l,c[3],c[4],c[5]),t&&Ue(l,l,t),L(a,a,l,1,gl.LEFT_CAP_START,0,0),L(a,a,l,1,gl.RIGHT_CAP_START,0,0),re(o,a),re(a,l);const Z=N?0:1,W=N?T:T-1;for(let V=Z;V<W;V++){const J=(V+1)%T*3;se(l,c[J],c[J+1],c[J+2]),t&&Ue(l,l,t),U(o,a,V),L(o,a,l,0,gl.LEFT_JOIN_END,V,P),L(o,a,l,0,gl.RIGHT_JOIN_END,V,P);const R=this.numJoinSubdivisions;for(let k=0;k<R;++k){const z=(k+1)/(R+1);L(o,a,l,z,gl.LEFT_JOIN_END,V,P),L(o,a,l,z,gl.RIGHT_JOIN_END,V,P)}L(o,a,l,1,gl.LEFT_JOIN_START,V,P),L(o,a,l,1,gl.RIGHT_JOIN_START,V,P),re(o,a),re(a,l)}N?(se(l,c[3],c[4],c[5]),t&&Ue(l,l,t),P=U(o,a,W),L(o,a,l,0,gl.LEFT_JOIN_END,Z,P),L(o,a,l,0,gl.RIGHT_JOIN_END,Z,P)):(P=U(o,a,W),L(o,a,a,0,gl.LEFT_CAP_END,W,P),L(o,a,a,0,gl.RIGHT_CAP_END,W,P)),F6(x,$+O,x,$,O),A=F6(x,A-O,x,A,O),this._parameters.wireframe&&this._addWireframeVertices(s,$,A,O)}_addWireframeVertices(t,r,i,s){const n=new Float32Array(t.buffer,i*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(t.buffer,r*Float32Array.BYTES_PER_ELEMENT,i-r);let a=0;const l=c=>a=F6(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}}function F6(e,t,r,i,s){for(let n=0;n<s;n++)r[i++]=e[t++];return i}function Fye(e,t,r){return Uye(e,t.get(E.POSITION).data,r?r.get(E.POSITION):null)}function Uye(e,t,r){return!!e.isClosed&&(r?r.length>2:t.length>6)}function bHe(e){return e.anchor===U1.Tip&&e.hideOnShortSegments&&e.placement==="begin-end"&&e.worldSpace}const Ra=C(),Pa=C(),Ud=C(),l_=C(),wHe=C(),c_=xo(),u_=xo(),IQ=C(),$Q=C(),LQ=Sd(),xHe=Sd(),THe=C(),SHe=C(),EHe=C(),fS=[xo(),xo(),xo(),xo()],Tf=[C(),C(),C(),C()],U6=Sr(),k6=Sr(),z6=Sr(),B6=Sr();class WH{constructor(t){this._originSR=t,this._origins=new Map,this._objects=new Map,this._gridSize=5e5,this._rootOriginId="root/"+Nl()}getOrigin(t){const r=this._origins.get(this._rootOriginId);if(r==null){const u=UL(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,u),u}const i=this._gridSize,s=Math.round(t[0]/i),n=Math.round(t[1]/i),o=Math.round(t[2]/i),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*i;if(ce(Gn,t,r.vec3),Gn[0]=Math.abs(Gn[0]),Gn[1]=Math.abs(Gn[1]),Gn[2]=Math.abs(Gn[2]),Gn[0]<c&&Gn[1]<c&&Gn[2]<c){if(l){const u=Math.max(...Gn);if(ce(Gn,t,l.vec3),Gn[0]=Math.abs(Gn[0]),Gn[1]=Math.abs(Gn[1]),Gn[2]=Math.abs(Gn[2]),Math.max(...Gn)<u)return l}return r}return l||(l=UL(s*i,n*i,o*i,a),this._origins.set(a,l)),l}_drawOriginBox(t,r=At(1,1,0,1)){const i=window.view,s=i._stage,n=r.toString();if(!this._objects.has(n)){this._material=new mx({width:2,color:r}),s.add(this._material);const g=new Sye(s,{pickable:!1}),y=new ng({castShadow:!1});s.add(y),g.add(y),this._objects.set(n,y)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),u=new Array,d=.5*this._gridSize;for(let g=0;g<l;g++)c[3*g]=t[0]+(1&a[g]?d:-d),c[3*g+1]=t[1]+(2&a[g]?d:-d),c[3*g+2]=t[2]+(4&a[g]?d:-d),g>0&&u.push(g-1,g);ji(c,this._originSR,0,c,i.renderSpatialReference,0,l);const p=new Cs(this._material,[[E.POSITION,new Fe(c,3,!0)]],[[E.POSITION,u]],null,Ki.Line);s.add(p),o.addGeometry(p)}get test(){const t=this;return{set gridSize(r){t._gridSize=r}}}}const Gn=C();class kye{constructor(t,r,i,s=null){this.rctx=t,this.sliceHelper=s,this.lastFrameCamera=new lt,this.output=D.Color,this.renderOccludedMask=DQ,this.bindParameters=new BN(r,i,s!=null?s.plane:null),this.bindParameters.alignPixelEnabled=!0}resetRenderOccludedMask(){this.renderOccludedMask=DQ}}class CHe extends kye{constructor(t,r,i,s,n){super(t,i,s,n),this.offscreenRenderingHelper=r,this.sliceHelper=n,this.time=0}}const DQ=Ei.Occlude|Ei.OccludeAndTransparent|Ei.OccludeAndTransparentStencil;let FE=class extends lt{constructor(){super(...arguments),this._projectionMatrix=be()}get projectionMatrix(){return this._projectionMatrix}};h([f()],FE.prototype,"_projectionMatrix",void 0),h([f({readOnly:!0})],FE.prototype,"projectionMatrix",null),FE=h([F("esri.views.3d.webgl-engine.lib.CascadeCamera")],FE);const NQ=16;function qH(e){return Math.ceil(e/NQ)*NQ}var ZT;(function(e){e[e.Highlight=0]="Highlight",e[e.Default=1]="Default"})(ZT||(ZT={}));class QR{constructor(){this.camera=new FE,this.lightMat=be()}}class AHe{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}}class XH{get depthTexture(){return this._fbo?.colorTexture}get textureSize(){return this._textureSize}get numCascades(){return this._numCascades}get cascadeDistances(){return pi(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(t,r){this._rctx=t,this._viewingMode=r,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this._numCascades=1,this.settings=new AHe,this._projectionView=be(),this._projectionViewInverse=be(),this._modelViewLight=be(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Ht(),this._cascades=[new QR,new QR,new QR,new QR],this._lastOrigin=null,this._maxTextureSize=Math.min(ne("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._fbo=De(this._fbo),this._discardAllSnapshots()}set maxCascades(t){this.settings.maxNumCascadesHighQuality=fe(Math.floor(t),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(t){this._enabled=t,t||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}getSnapshot(t){return this.enabled?this._snapshots[t]:null}get cascades(){for(let t=0;t<this._numCascades;++t)G6[t]=this._cascades[t];return G6.length=this._numCascades,G6}start(t,r,i,s,n){Ye(this.enabled),this._textureSize=this._computeTextureSize(t,n,s),this._ensureDepthTexture();const{near:o,far:a}=this._clampNearFar(i);this._computeCascadeDistances(a,o,s),this._setupMatrices(t,r);const{viewMatrix:l,projectionMatrix:c}=t;for(let u=0;u<this._numCascades;++u)this._constructCascade(u,c,l,r);this._lastOrigin=null,this.clear()}finish(t){Ye(this.enabled),this._rctx.bindFramebuffer(t)}getShadowMapMatrices(t){if(!this._lastOrigin||!Go(t,this._lastOrigin)){this._lastOrigin=this._lastOrigin||C(),re(this._lastOrigin,t);for(let r=0;r<this._numCascades;++r){Ja(VQ,this._cascades[r].lightMat,t);for(let i=0;i<16;++i)GQ[16*r+i]=VQ[i]}}return GQ}takeCascadeSnapshotTo(t,r){Ye(this.enabled);const i=this._ensureSnapshot(r);this._bindFbo();const s=this._rctx,n=s.bindTexture(i,wt.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(Ji.TEXTURE_2D,0,t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[2],t.camera.viewport[3]),s.bindTexture(n,wt.TEXTURE_UNIT_FOR_UPDATES)}clear(){const t=this._rctx;this._bindFbo(),t.setClearColor(1,1,1,1),t.clearSafe(fi.COLOR_BUFFER_BIT|fi.DEPTH_BUFFER_BIT)}_computeTextureSize(t,r,i){const s=Math.min(window.devicePixelRatio,r)/t.pixelRatio,n=Math.max(t.fullWidth,t.fullHeight)*s,o=i?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality;return Math.floor(Math.min(this._maxTextureSize,qH((this.numCascades===1?1:2)*n*o)))}_ensureDepthTexture(){if(this._fbo?.width===this._textureSize)return;const t=new hr(this._textureSize);t.wrapMode=Ct.CLAMP_TO_EDGE,t.samplingMode=xt.NEAREST,this._fbo?.dispose(),this._fbo=new Bi(this._rctx,t,new pL(Ns.DEPTH_COMPONENT16,this._textureSize))}_ensureSnapshot(t){let r=this._snapshots[t];if(r!=null&&r.descriptor.width===this._textureSize)return r;this._discardSnapshot(t);const i=new hr;return i.wrapMode=Ct.CLAMP_TO_EDGE,i.samplingMode=xt.NEAREST,i.width=this._textureSize,i.height=this._textureSize,r=new wt(this._rctx,i),this._snapshots[t]=r,r}_discardSnapshot(t){this._snapshots[t]=De(this._snapshots[t])}_discardAllSnapshots(){for(let t=0;t<this._snapshots.length;++t)this._discardSnapshot(t);this._snapshots.length=0}_bindFbo(){const t=this._rctx;t.unbindTexture(this.depthTexture),t.bindFramebuffer(this._fbo)}_constructCascade(t,r,i,s){const n=this._cascades[t],o=-this._cascadeDistances[t],a=-this._cascadeDistances[t+1],l=(r[10]*o+r[14])/Math.abs(r[11]*o+r[15]),c=(r[10]*a+r[14])/Math.abs(r[11]*a+r[15]);Ye(l<c);for(let g=0;g<8;++g){pi(FQ,g%4==0||g%4==3?-1:1,g%4==0||g%4==1?-1:1,g<4?l:c,1);const y=vu[g];xc(y,FQ,this._projectionViewInverse),y[0]/=y[3],y[1]/=y[3],y[2]/=y[3]}Wo(V6,vu[0]),n.camera.viewMatrix=Ja(OHe,this._modelViewLight,V6);for(let g=0;g<8;++g)Ue(vu[g],vu[g],n.camera.viewMatrix);let u=vu[0][2],d=vu[0][2];for(let g=1;g<8;++g)u=Math.min(u,vu[g][2]),d=Math.max(d,vu[g][2]);u-=200,d+=200,n.camera.near=-d,n.camera.far=-u,IHe(i,s,u,d,n.camera),Jr(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const p=this._textureSize/(this.numCascades===1?1:2);n.camera.viewport=[t%2==0?0:p,Math.floor(t/2)===0?0:p,p,p]}_setupMatrices(t,r){Jr(this._projectionView,t.projectionMatrix,t.viewMatrix),Fn(this._projectionViewInverse,this._projectionView);const i=this._viewingMode===Ie.Global?t.eye:se(V6,0,0,1);_N(this._modelViewLight,[0,0,0],[-r[0],-r[1],-r[2]],i)}_clampNearFar(t){let{near:r,far:i}=t;return r<2&&(r=2),i<2&&(i=2),r>=i&&(r=2,i=4),{near:r,far:i}}_computeCascadeDistances(t,r,i){const s=i?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor($4e(t/r,4)),s);const n=(t-r)/this._numCascades,o=(t/r)**(1/this._numCascades);let a=r,l=r;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=yt(a,l,this.settings.splitSchemeLambda),a*=o,l+=n}get gpuMemoryUsage(){return this._snapshots.reduce((t,r)=>t+(r?.gpuMemoryUsage??0),this._fbo?.gpuMemoryUsage??0)}get test(){return{cascades:this._cascades,textureSize:this._textureSize}}}const OHe=be(),FQ=Ht(),vu=[];for(let e=0;e<8;++e)vu.push(Ht());const UQ=Ne(),kQ=Ne(),RHe=Ne(),zQ=Ne(),BQ=Ne(),V6=C(),G6=[],VQ=be(),GQ=new Array(64),Kl=Ne(),Fb=Ne(),h_=[Ne(),Ne(),Ne(),Ne()],nn=Ne(),j6=Ne(),Pg=Ne(),mS=Ne(),Ub=Ne(),kb=Ne(),eP=Ne();function PHe(e,t,r,i,s,n,o,a){Qt(Kl,0,0);for(let O=0;O<4;++O)Hh(Kl,Kl,e[O]);Pl(Kl,Kl,.25),Qt(Fb,0,0);for(let O=4;O<8;++O)Hh(Fb,Fb,e[O]);Pl(Fb,Fb,.25),Su(h_[0],e[4],e[5],.5),Su(h_[1],e[5],e[6],.5),Su(h_[2],e[6],e[7],.5),Su(h_[3],e[7],e[4],.5);let l=0,c=aL(h_[0],Kl);for(let O=1;O<4;++O){const A=aL(h_[O],Kl);A<c&&(c=A,l=O)}Ap(nn,h_[l],e[l+4]);const u=nn[0];let d,p;nn[0]=-nn[1],nn[1]=u,Ap(j6,Fb,Kl),Bs(j6,nn)<0&&sj(nn,nn),Su(nn,nn,j6,r),EA(nn,nn),d=p=Bs(Ap(Pg,e[0],Kl),nn);for(let O=1;O<8;++O){const A=Bs(Ap(Pg,e[O],Kl),nn);A<d?d=A:A>p&&(p=A)}en(i,Kl),Pl(Pg,nn,d-t),Hh(i,i,Pg);let g=-1,y=1,_=0,v=0;for(let O=0;O<8;++O){Ap(mS,e[O],i),EA(mS,mS);const A=nn[0]*mS[1]-nn[1]*mS[0];A>0?A>g&&(g=A,_=O):A<y&&(y=A,v=O)}_b(g>0,"leftArea"),_b(y<0,"rightArea"),Pl(Ub,nn,d),Hh(Ub,Ub,Kl),Pl(kb,nn,p),Hh(kb,kb,Kl),eP[0]=-nn[1],eP[1]=nn[0];const w=oR(i,e[v],kb,Hh(Pg,kb,eP),1,s),T=oR(i,e[_],kb,Pg,1,n),x=oR(i,e[_],Ub,Hh(Pg,Ub,eP),1,o),S=oR(i,e[v],Ub,Pg,1,a);_b(w,"rayRay"),_b(T,"rayRay"),_b(x,"rayRay"),_b(S,"rayRay")}function cr(e,t){return 3*t+e}const jQ=Ne();function sl(e,t){return Qt(jQ,e[t],e[t+3]),jQ}const Ma=Ne(),Ge=$i();function MHe(e,t,r,i,s){Ap(Ma,r,i),Pl(Ma,Ma,.5),Ge[0]=Ma[0],Ge[1]=Ma[1],Ge[2]=0,Ge[3]=Ma[1],Ge[4]=-Ma[0],Ge[5]=0,Ge[6]=Ma[0]*Ma[0]+Ma[1]*Ma[1],Ge[7]=Ma[0]*Ma[1]-Ma[1]*Ma[0],Ge[8]=1,Ge[cr(0,2)]=-Bs(sl(Ge,0),e),Ge[cr(1,2)]=-Bs(sl(Ge,1),e);let n=Bs(sl(Ge,0),r)+Ge[cr(0,2)],o=Bs(sl(Ge,1),r)+Ge[cr(1,2)],a=Bs(sl(Ge,0),i)+Ge[cr(0,2)],l=Bs(sl(Ge,1),i)+Ge[cr(1,2)];n=-(n+a)/(o+l),Ge[cr(0,0)]+=Ge[cr(1,0)]*n,Ge[cr(0,1)]+=Ge[cr(1,1)]*n,Ge[cr(0,2)]+=Ge[cr(1,2)]*n,n=1/(Bs(sl(Ge,0),r)+Ge[cr(0,2)]),o=1/(Bs(sl(Ge,1),r)+Ge[cr(1,2)]),Ge[cr(0,0)]*=n,Ge[cr(0,1)]*=n,Ge[cr(0,2)]*=n,Ge[cr(1,0)]*=o,Ge[cr(1,1)]*=o,Ge[cr(1,2)]*=o,Ge[cr(2,0)]=Ge[cr(1,0)],Ge[cr(2,1)]=Ge[cr(1,1)],Ge[cr(2,2)]=Ge[cr(1,2)],Ge[cr(1,2)]+=1,n=Bs(sl(Ge,1),t)+Ge[cr(1,2)],o=Bs(sl(Ge,2),t)+Ge[cr(2,2)],a=Bs(sl(Ge,1),r)+Ge[cr(1,2)],l=Bs(sl(Ge,2),r)+Ge[cr(2,2)],n=-.5*(n/o+a/l),Ge[cr(1,0)]+=Ge[cr(2,0)]*n,Ge[cr(1,1)]+=Ge[cr(2,1)]*n,Ge[cr(1,2)]+=Ge[cr(2,2)]*n,n=Bs(sl(Ge,1),t)+Ge[cr(1,2)],o=Bs(sl(Ge,2),t)+Ge[cr(2,2)],a=-o/n,Ge[cr(1,0)]*=a,Ge[cr(1,1)]*=a,Ge[cr(1,2)]*=a,s[0]=Ge[0],s[1]=Ge[1],s[2]=0,s[3]=Ge[2],s[4]=Ge[3],s[5]=Ge[4],s[6]=0,s[7]=Ge[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=Ge[6],s[13]=Ge[7],s[14]=0,s[15]=Ge[8]}function IHe(e,t,r,i,s){const n=1/vu[0][3],o=1/vu[4][3];Ye(n<o);let a=n+Math.sqrt(n*o);const l=Math.sin(_n(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));a/=l,PHe(vu,a,l,UQ,kQ,RHe,zQ,BQ),MHe(UQ,kQ,zQ,BQ,s.projectionMatrix),s.projectionMatrix[10]=2/(r-i),s.projectionMatrix[14]=-(r+i)/(r-i)}function $He(e){return Cd(e)&&e.intersector===Ii.TERRAIN&&!!e.target}class LHe extends qN{constructor(t,r,i){super(t,r),this.triangleNr=i}}function zye(e){return Cd(e)&&e.intersector===Ii.OVERLAY&&!!e.target}class dB{constructor(){this.adds=new Mt,this.removes=new Mt,this.updates=new Mt({allocator:t=>t||new DHe,deallocator:t=>(t.renderGeometry=null,t)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}}class DHe{}class NHe{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}var Fi,hn;(function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"})(Fi||(Fi={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITY=1]="VISIBILITY",e[e.GEOMETRY=2]="GEOMETRY",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.OCCLUDEE=16]="OCCLUDEE"}(hn||(hn={}));function Bye(e){const t=new Map,r=i=>{let s=t.get(i);return s||(s=new NHe,t.set(i,s)),s};return e.removes.forAll(i=>{H6(i)&&r(i.material).removes.push(i)}),e.adds.forAll(i=>{H6(i)&&r(i.material).adds.push(i)}),e.updates.forAll(i=>{H6(i.renderGeometry)&&r(i.renderGeometry.material).updates.push(i)}),t}function H6(e){return e.geometry.indexCount>=1}class Vye{constructor(t,r){this._material=t,this._repository=r,this._map=new Map}destroy(){this._map.forEach((t,r)=>{t!=null&&this._repository.release(this._material,r)})}load(t,r,i){if(!this._material.requiresSlot(r,i))return null;this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,r,i));const s=this._map.get(i);if(s!=null){if(s.ensureResources(t)===_m.LOADED)return s;this._repository.requestRender()}return null}}function nO(e,t){switch(t.normalType){case wr.Compressed:e.attributes.add(E.NORMALCOMPRESSED,"vec2"),e.vertex.code.add(b`vec3 normalModel() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
return vec3(normalCompressed + sign(normalCompressed) * min(z, 0.0), z);
}`);break;case wr.Attribute:e.attributes.add(E.NORMAL,"vec3"),e.vertex.code.add(b`vec3 normalModel() {
return normal;
}`);break;case wr.ScreenDerivative:e.fragment.code.add(b`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:t.normalType;case wr.COUNT:case wr.Ground:}}var wr;(function(e){e[e.Attribute=0]="Attribute",e[e.Compressed=1]="Compressed",e[e.Ground=2]="Ground",e[e.ScreenDerivative=3]="ScreenDerivative",e[e.COUNT=4]="COUNT"})(wr||(wr={}));function C4(e,t){switch(t.normalType){case wr.Attribute:case wr.Compressed:e.include(nO,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add(new CA("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel),new sh("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)),e.vertex.code.add(b`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case wr.Ground:e.include($x,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(b`
        void forwardNormal() {
          vNormalWorld = ${t.spherical?b`normalize(vPositionWorldCameraRelative);`:b`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case wr.ScreenDerivative:e.vertex.code.add(b`void forwardNormal() {}`);break;default:t.normalType;case wr.COUNT:}}class Gye extends Nfe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=$i()}}class jye extends Ffe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=$i(),this.toMapSpace=Ht()}}class pB extends jye{constructor(t=C()){super(),this.origin=t,this.slicePlaneLocalOrigin=this.origin}}class P2{constructor(t){this.vertexBufferLayout=t}elementCount(t){return t.indices.get(E.POSITION).length}write(t,r,i,s,n){Pge(i,this.vertexBufferLayout,t,r,s,n)}}const FHe=Li().vec3f(E.POSITION),UHe=Li().vec3f(E.POSITION).vec2f(E.UV0),kHe=Li().vec3f(E.POSITION).vec4u8(E.COLOR);Li().vec3f(E.POSITION).vec4u8(E.OBJECTANDLAYERIDCOLOR);const zHe=Li().vec3f(E.POSITION).vec2f(E.UV0).vec4u8(E.OBJECTANDLAYERIDCOLOR);Li().vec3f(E.POSITION).vec4u8(E.COLOR).vec4u8(E.OBJECTANDLAYERIDCOLOR);class ZH extends Fy{intersect(t,r,i,s,n,o){return _ge(t,i,s,n,void 0,o)}}function BHe(e){e.fragment.code.add(b`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function VHe(e){e.fragment.code.add(b`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}class oO extends es{constructor(t,r){super(t,"int",jr.Pass,(i,s,n)=>i.setUniform1i(t,r(s,n)))}}class GHe extends es{constructor(t,r,i){super(t,"mat4",jr.Draw,(s,n,o,a)=>s.setUniformMatrix4fv(t,r(n,o,a)),i)}}class jHe extends es{constructor(t,r,i){super(t,"mat4",jr.Pass,(s,n,o)=>s.setUniformMatrix4fv(t,r(n,o)),i)}}class HHe extends Wr{constructor(){super(...arguments),this.origin=C()}}class WHe extends HHe{}class qHe extends Wr{constructor(){super(...arguments),this.modelTransformation=Ks}}class YH extends qHe{constructor(){super(...arguments),this.origin=C()}}function A4(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new jHe("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),Hye(e))}function k1(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new GHe("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),Hye(e))}function Hye(e){const t=e.fragment;t.include(Hl),t.uniforms.add(new qe("shadowMapTex",(r,i)=>i.shadowMap.depthTexture),new oO("numCascades",(r,i)=>i.shadowMap.numCascades),new Zt("cascadeDistances",(r,i)=>i.shadowMap.cascadeDistances)),t.code.add(b`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + (numCascades == 1 ? 1.0 : 0.5) * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float texSize, sampler2D _depthTex) {
float halfPixelSize = 0.5 / texSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, float(textureSize(shadowMapTex, 0).x), shadowMapTex);
}`)}function HQ(e){e.fragment.uniforms.add(new qe("texWaveNormal",t=>t.waveNormal),new qe("texWavePerturbation",t=>t.wavePertubation),new Zt("waveParams",t=>pi(XHe,t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset)),new yr("waveDirection",t=>Qt(ZHe,t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity))),e.include(BHe),e.fragment.code.add(b`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const XHe=Ht(),ZHe=Ne();function e3(e,t){t.spherical?e.vertex.code.add(b`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(b`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),t.spherical?e.vertex.code.add(b`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(b`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function YHe(e){const t=e.fragment.code;t.add(b`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(b`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(b`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function JH(e,t){const r=e.fragment.code;e.include(j3),t.pbrMode!==Qe.Normal&&t.pbrMode!==Qe.Schematic&&t.pbrMode!==Qe.Terrain&&t.pbrMode!==Qe.TerrainWithWater||(r.add(b`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(b`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),t.pbrMode!==Qe.Normal&&t.pbrMode!==Qe.Schematic||(e.include(YHe),r.add(b`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(b`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(b`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(b`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function JHe(e,t){const r=e.fragment.code;e.include(j3),r.add(b`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),r.add(b`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(b`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(b`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(b`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function Wye(e,t){e.include(JHe,t),e.include(NN),e.include(VHe),t.hasCloudsReflections&&e.include(hfe,t),t.hasScreenSpaceReflections&&e.include(gFe,t);const r=e.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add(b`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),r.uniforms.add(new Ae("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new Ae("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)),r.code.add(b`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),t.hasCloudsReflections&&r.code.add(b`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),t.hasScreenSpaceReflections?(r.uniforms.add(new Ci("view",(i,s)=>s.ssr.camera.viewMatrix),new qe("lastFrameColorTexture",(i,s)=>s.ssr.lastFrameColorTexture),new Ae("fadeFactorSSR",(i,s)=>s.ssr.fadeFactor)),r.code.add(b`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):r.code.add(b`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),t.hasCloudsReflections?t.hasScreenSpaceReflections?r.code.add(b`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):r.code.add(b`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):r.code.add(b`return waterRenderedColor;
}`)}function KHe(e){const t=new pr,{vertex:r,fragment:i}=t;Fl(r,e),t.include(Xa,e),t.attributes.add(E.POSITION,"vec3"),t.attributes.add(E.UV0,"vec2");const s=new Zt("waterColor",n=>n.color);if(e.output===D.Color&&e.isDraped)return t.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(b`
        void main(void) {
          if (waterColor.a < ${b.float(to)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(s),i.code.add(b`void main() {
fragColor = waterColor;
}`),t;switch(e.output!==D.Color&&e.output!==D.Alpha||(t.include(e3,e),t.include(w2,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.uniforms.add(s),r.code.add(b`
      void main(void) {
        if (waterColor.a < ${b.float(to)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${e.output===D.Color?"forwardLinearDepth();":""}
      }
    `)),t.include(kc,e),e.output){case D.Alpha:t.include(os,e),i.uniforms.add(s),i.code.add(b`
        void main() {
          discardBySlice(vpos);
          ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          fragColor = vec4(waterColor.a);
        }
      `);break;case D.Color:t.include(lL),t.include(mj,{pbrMode:Qe.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(HQ),t.include(os,e),t.include(k1,e),t.include(Wye,e),i.uniforms.add(s,new Ae("timeElapsed",n=>n.timeElapsed),r.uniforms.get("view"),r.uniforms.get("localOrigin")),xd(i,e),i.include(df),Zm(i),hf(i),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${e.receiveShadows?b`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${e.transparencyPassType===tt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `);break;case D.Normal:t.include(e3,e),t.include(HQ,e),t.include(os,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),r.uniforms.add(s),r.code.add(b`
        void main(void) {
          if (waterColor.a < ${b.float(to)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(new Ae("timeElapsed",n=>n.timeElapsed)),i.code.add(b`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case D.Highlight:t.include(ig,e),t.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(b`
      void main(void) {
        if (waterColor.a < ${b.float(to)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(os,e),i.code.add(b`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case D.ObjectAndLayerIdColor:t.include(K3,e),t.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(b`
      void main(void) {
        if (waterColor.a < ${b.float(to)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),t.include(os,e),i.code.add(b`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return t}const QHe=Object.freeze(Object.defineProperty({__proto__:null,build:KHe},Symbol.toStringTag,{value:"Module"}));class O4 extends xr{initializeConfiguration(t,r){r.spherical=t.viewingMode===Ie.Global,r.doublePrecisionRequiresObfuscation=t.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(t){return new vr(t.rctx,O4.shader.get().build(this.configuration),dr)}_setPipelineState(t){const r=this.configuration,i=t===tt.NONE,s=t===tt.FrontFace;return Tt({blending:r.output!==D.Normal&&r.output!==D.Highlight&&r.output!==D.ObjectAndLayerIdColor&&r.transparent?i?Pc:sg(t):null,depthTest:{func:Uy(t)},depthWrite:i?r.writeDepth?Ka:null:c4(t),colorWrite:It,polygonOffset:i||s?null:d4(r.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}O4.shader=new _r(QHe,()=>ue(()=>import("./WaterSurface.glsl.c9f788cd.js"),[]));class Sn extends bo{constructor(){super(...arguments),this.output=D.Color,this.transparencyPassType=tt.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}h([B({count:D.COUNT})],Sn.prototype,"output",void 0),h([B({count:tt.COUNT})],Sn.prototype,"transparencyPassType",void 0),h([B()],Sn.prototype,"spherical",void 0),h([B()],Sn.prototype,"receiveShadows",void 0),h([B()],Sn.prototype,"hasSlicePlane",void 0),h([B()],Sn.prototype,"transparent",void 0),h([B()],Sn.prototype,"enableOffset",void 0),h([B()],Sn.prototype,"writeDepth",void 0),h([B()],Sn.prototype,"hasScreenSpaceReflections",void 0),h([B()],Sn.prototype,"doublePrecisionRequiresObfuscation",void 0),h([B()],Sn.prototype,"hasCloudsReflections",void 0),h([B()],Sn.prototype,"objectAndLayerIdColorInstanced",void 0),h([B()],Sn.prototype,"isDraped",void 0),h([B()],Sn.prototype,"hasMultipassTerrain",void 0),h([B()],Sn.prototype,"cullAboveGround",void 0),h([B({constValue:Qe.Water})],Sn.prototype,"pbrMode",void 0),h([B({constValue:!0})],Sn.prototype,"useCustomDTRExponentForWater",void 0),h([B({constValue:!0})],Sn.prototype,"highStepCount",void 0),h([B({constValue:!1})],Sn.prototype,"useFillLights",void 0);class eWe extends Ny{_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:t.shadowMap.enabled})}_updateSSRState(t){t.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:t.ssr.enabled})}_updateCloudsReflectionState(t){const r=t.cloudsFade.data!=null;r!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:r})}ensureResources(t){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(t)}beginSlot(t){return this._output===D.Color&&(this._updateShadowState(t),this._updateSSRState(t),this._updateCloudsReflectionState(t)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(O4,t)}}class qye extends ZH{constructor(t){super(t,new Xye),this._configuration=new Sn,this.animation=new Hfe}getConfiguration(t,r){return this._configuration.output=t,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<u4,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}update(t){const r=Math.min(t.camera.relativeElevation,t.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*r<tWe;const i=this.animation.advance(t);return this.setParameters({timeElapsed:BV(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&i}requiresSlot(t,r){switch(r){case D.Normal:return t===ae.DRAPED_WATER;case D.Color:if(this.parameters.isDraped)return t===ae.DRAPED_MATERIAL;break;case D.Alpha:break;case D.Highlight:case D.ObjectAndLayerIdColor:return t===ae.OPAQUE_MATERIAL||t===ae.DRAPED_MATERIAL;default:return!1}let i=ae.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?ae.TRANSPARENT_MATERIAL:ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),t===i}createGLMaterial(t){return new eWe(t)}createBufferWriter(){return new P2(ne("enable-feature:objectAndLayerId-rendering")?zHe:UHe)}}class Xye extends pH{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=or(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=At(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=C(),this.modelTransformation=null}}const tWe=35e3;class KH{constructor(t=0,r=0){this.from=t,this.to=r}get numElements(){return this.to-this.from}}function WQ(e){const t=new Map;e.forAll(i=>t.set(i.from,i));let r=!0;for(;r;)r=!1,e.forEach(i=>{const s=t.get(i.to);s&&(i.to=s.to,t.delete(s.from),e.removeUnordered(s),r=!0)})}class qQ extends KH{constructor(t,r,i){super(r,i),this.geometry=t}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.geometry.highlights!=null&&this.isVisible}get hasOccludees(){return this.geometry.occludees!=null}}class rWe{constructor(){this.first=0,this.count=0}}class iWe{constructor(){this._numElements=0,this._instances=new Map,this.holes=new Mt({allocator:t=>t||new KH,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=tP(),this.drawCommandsHighlight=tP(),this.drawCommandsOccludees=tP(),this.drawCommandsShadowHighlightRest=tP()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(t,r){this.deleteInstance(t),this._instances.set(t,r),this._numElements+=r.numElements}deleteInstance(t){const r=this._instances.get(t);r&&(this._numElements-=r.numElements,this._instances.delete(t))}updateInstance(t,r,i){const s=this._instances.get(t);s&&(this._numElements-=s.numElements,s.from=r,s.to=i,this._numElements+=s.numElements)}updateDrawState(t){t.isVisible?(t.hasHighlights&&(this.hasHighlights=!0),t.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(t){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const i=this.drawCommandsDefault.pushNew(),s=this.holes.front();return this.vao!=null&&this.holes.length===1&&s.to===Math.floor(this.vao.byteSize/t)?(i.first=0,void(i.count=s.from)):(i.first=1/0,i.count=0,this._instances.forEach(n=>{i.first=Math.min(i.first,n.from),i.count=Math.max(i.count,n.to)}),void(i.count-=i.first))}const r=Array.from(this._instances.values()).sort((i,s)=>i.from===s.from?i.to-s.to:i.from-s.from);for(const i of r)i.isVisible&&(XQ(i.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,i),XQ(i.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,i))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}}function sWe(e){return e.vao!=null}function tP(){return new Mt({allocator:e=>e||new rWe,deallocator:e=>e})}function XQ(e,t){const r=e.back();if(r==null){const i=e.pushNew();return i.first=t.from,void(i.count=t.numElements)}if(nWe(r,t)){const i=t.from-r.first+t.numElements;r.count=i}else{const i=e.pushNew();i.first=t.from,i.count=t.numElements}}function nWe(e,t){return e.first+e.count>=t.from}class oWe{constructor(t){this.origin=t,this.buffers=new Array}dispose(){this.buffers.forEach(t=>t.vao.dispose()),this.buffers.length=0}findBuffer(t){return this.buffers.find(r=>r.instances.has(t))}}const _I=-3;var nm;(function(e){e[e.ALL=0]="ALL",e[e.SOME=1]="SOME"})(nm||(nm={}));class aWe{constructor(t,r,i){this.name=t,this._storage=r,this.id=lWe+++":",this.size=0,this.maxSize=0,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),i&&(this._storage.registerRemoveFunc(this.id,i),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get sizeAll(){return this._storage.size}resetHitRate(){this._hit=this._miss=0}put(t,r,i,s=0){this._storage.put(this,t,r,i,s)}get(t){const r=this._storage.get(this,t);return r===void 0?++this._miss:++this._hit,r}pop(t){const r=this._storage.pop(this,t);return r===void 0?++this._miss:++this._hit,r}updateSize(t,r,i){this._storage.updateSize(this,t,r,i)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}class Zye{get size(){return this._size}constructor(t=10485760){this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Mt,this._users=new Mt}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(t){this._users.push(t)}deregister(t){this._users.removeUnordered(t)}registerRemoveFunc(t,r){this._removeFuncs.push([t,r])}deregisterRemoveFunc(t){this._removeFuncs.filterInPlace(r=>r[0]!==t)}get maxSize(){return this._maxSize}set maxSize(t){this._maxSize=Math.max(t,0),this._checkSizeLimits()}put(t,r,i,s,n){r=t.id+r;const o=this._db.get(r);if(o&&(this._size-=o.size,t.size-=o.size,this._db.delete(r),o.entry!==i&&this._notifyRemove(r,o.entry,nm.ALL)),s>this._maxSize)return void this._notifyRemove(r,i,nm.ALL);if(i===void 0)return void console.warn("Refusing to cache undefined entry ");if(!s||s<0)return void console.warn("Refusing to cache entry with invalid size "+s);const a=1+Math.max(n,_I)-_I;this._db.set(r,{entry:i,size:s,lifetime:a,lives:a}),this._size+=s,t.size+=s,this._checkSizeLimits()}updateSize(t,r,i,s){r=t.id+r;const n=this._db.get(r);if(n&&n.entry===i){for(this._size-=n.size,t.size-=n.size;s>this._maxSize;){const o=this._notifyRemove(r,i,nm.SOME);if(!(o!=null&&o>0))return void this._db.delete(r);s=o}n.size=s,this._size+=s,t.size+=s,this._checkSizeLimits()}}pop(t,r){r=t.id+r;const i=this._db.get(r);if(i)return this._size-=i.size,t.size-=i.size,this._db.delete(r),++this._hit,i.entry;++this._miss}get(t,r){r=t.id+r;const i=this._db.get(r);if(i!==void 0)return this._db.delete(r),i.lives=i.lifetime,this._db.set(r,i),++this._hit,i.entry;++this._miss}get performanceInfo(){const t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},r={},i=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;i[l]=(i[l]||0)+o.size,this._users.forAll(c=>{const{id:u,name:d}=c;if(a.startsWith(u)){const p=r[d]||0;r[d]=p+o.size}})});const s={};this._users.forAll(o=>{const a=o.name;if("hitRate"in o&&typeof o.hitRate=="number"&&!isNaN(o.hitRate)&&o.hitRate>0){const l=r[a]||0;r[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(r);n.sort((o,a)=>r[a]-r[o]),n.forEach(o=>t[o]=Math.round(r[o]/2**20)+"MB / "+s[o]);for(let o=i.length-1;o>=0;--o){const a=i[o];a&&(t["Priority "+(o+_I-1)]=Math.round(a/this._size*100)+"%")}return t}resetStats(){this._hit=this._miss=0,this._users.forAll(t=>t.resetHitRate())}clear(t){const r=t.id;this._db.forEach((i,s)=>{s.startsWith(r)&&(this._size-=i.size,this._db.delete(s),this._notifyRemove(s,i.entry,nm.ALL))}),t.size=0}clearAll(){this._db.forEach((t,r)=>this._notifyRemove(r,t.entry,nm.ALL)),this._users.forEach(t=>t.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(t,r,i){let s;return this._removeFuncs.some(n=>{if(t.startsWith(n[0])){const o=n[1](r,i);return typeof o=="number"&&(s=o),!0}return!1}),s}_checkSizeLimits(){if(this._size>this._maxSize){for(const[t,r]of this._db)if(this._purgeItem(t,r),this._size<=.9*this.maxSize)return}this._users.forEach(t=>{if(t.maxSize>0&&t.size>t.maxSize){for(const[r,i]of this._db)if(r.startsWith(t.id)&&(this._purgeItem(r,i,t),t.size<=.9*t.maxSize))return}})}_purgeItem(t,r,i=this._users.find(s=>t.startsWith(s.id))){if(this._db.delete(t),r.lives<=1){this._size-=r.size,i&&(i.size-=r.size);const s=this._notifyRemove(t,r.entry,nm.SOME);s!=null&&s>0&&(this._size+=s,i&&(i.size+=s),r.lives=r.lifetime,r.size=s,this._db.set(t,r))}else--r.lives,this._db.set(t,r)}}let lWe=0;const cWe=_I+1;class uWe{constructor(t,r,i){this._rctx=t,this._locations=r,this._layout=i,this._cache=t.newCache("VaoCache",hWe)}dispose(){this._cache.destroy()}newVao(t){const r=t.toString(),i=this._cache.pop(r);if(i!=null){const n=i.pop();return i.length>0&&this._cache.put(r,i,t*i.length,cWe),n}const s=new Ed(this._rctx,this._locations,{geometry:this._layout},{geometry:rr.createVertex(this._rctx,gr.STATIC_DRAW)});return s.vertexBuffers.geometry.setSize(t),s}deleteVao(t){if(t==null)return null;const r=t.byteSize,i=r.toString(),s=this._cache.pop(i);return s!=null?(s.push(t),this._cache.put(i,s,r*s.length,-1)):this._cache.put(i,[t],r,-1),null}}function hWe(e,t){if(t===nm.ALL)return void e.forEach(s=>s.dispose());const r=e.pop(),i=e.length*r.byteSize;return r.dispose(),i}class Yye{constructor(t,r,i){this._rctx=t,this._materialRepository=r,this.material=i,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new Vye(this.material,this._materialRepository),this._bufferWriter=i.createBufferWriter(),this._vaoCache=new uWe(t,i.vertexAttributeLocations,Wl(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(t=>t.dispose()),this._dataByOrigin.clear(),this._vaoCache.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof qye}get rendersOccluded(){return!this.isEmpty&&this.material.renderOccluded!==Ei.Occlude}get numGeometries(){let t=0;return this._dataByOrigin.forEach(r=>t+=r.buffers.reduce((i,s)=>i+s.instances.size,0)),t}forEachGeometry(t){this._dataByOrigin.forEach(r=>r.buffers.forEach(i=>i.instances.forEach(s=>t(s.geometry))))}modify(t){this._updateGeometries(t.updates),this._addAndRemoveGeometries(t.adds,t.removes),this._updateDrawCommands()}_updateGeometries(t){const r=this._bufferWriter,i=r.vertexBufferLayout.stride/4;for(const s of t){const n=s.renderGeometry,o=this._dataByOrigin.get(n.localOrigin.id),a=o?.findBuffer(n.id);if(a==null)return;const l=a.instances.get(n.id);if(s.updateType&(hn.GEOMETRY|hn.TRANSFORMATION)){const c=nP(r.elementCount(l.geometry.geometry)*i),u=r.vertexBufferLayout.createView(c.buffer);this._writeGeometry(n,u,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*i,0,l.numElements*i),oP()}s.updateType&(hn.HIGHLIGHT|hn.OCCLUDEE|hn.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(t,r){const i=new S2;for(const s of t){const n=s.localOrigin;if(n==null)continue;let o=i.get(n.id,null);o==null&&(o=new ZQ(n.vec3),i.set(n.id,null,o)),o.changes.push(s)}for(const s of r){const n=s.localOrigin;if(n==null)continue;const o=this._dataByOrigin.get(n.id),a=o?.findBuffer(s.id);if(a==null)continue;let l=i.get(n.id,a);l==null&&(l=new ZQ(n.vec3),i.set(n.id,a,l)),l.changes.push(s)}return i}_addAndRemoveGeometries(t,r){const{_bufferWriter:i,_dataByOrigin:s}=this,n=i.vertexBufferLayout.stride/4,o=this._computeDeltas(t,r);o.forEach((a,l)=>{const c=a.get(null),u=c!=null?c.changes:[];o.delete(l,null);let d=s.get(l);if(a.forEach((p,g)=>{if(o.delete(l,g),g==null)return void Ye(!1,"No VAO for removed geometries");if(g.instances.size===p.changes.length)return this._vaoCache.deleteVao(g.vao),eA(d.buffers,g),void(d.buffers.length===0&&u.length===0&&s.delete(l));const y=g.numElements,_=g.vao.byteSize/4,v=u.reduce((S,O)=>S+i.elementCount(O.geometry),0),w=p.changes.reduce((S,O)=>S+i.elementCount(O.geometry),0),T=Math.min((y+v-w)*n,sP),x=T>_;T>ZL&&T<_/2?(p.changes.forEach(({id:S})=>g.deleteInstance(S)),g.instances.forEach(({geometry:S})=>u.push(S)),this._vaoCache.deleteVao(g.vao),eA(d.buffers,g)):x?this._applyAndRebuild(g,u,p):this._applyRemoves(g,p)}),u.length>0)for(d==null&&(d=new oWe(c.origin),s.set(l,d)),d.buffers.forEach(p=>this._applyAdds(p,u));u.length>0;)d.buffers.push(this._applyAndRebuild(new iWe,u,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(t=>{t.buffers.forEach(r=>{r.drawCommandsDirty&&(r.hasHiddenInstances=!1,r.hasHighlights=!1,r.hasOccludees=!1,_o(r.instances,i=>(r.updateDrawState(i),r.hasHiddenInstances&&r.hasHighlights&&r.hasOccludees)),r.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||r.hasHighlights,this._hasOccludees=this._hasOccludees||r.hasOccludees})})}_applyAndRebuild(t,r,i){if(i!=null)for(const y of i.changes)t.deleteInstance(y.id);const s=this._bufferWriter,n=s.vertexBufferLayout.stride,o=n/4,a=Math.floor(sP/o);let l=t.numElements;for(;r.length>0;){const y=r.pop(),_=s.elementCount(y.geometry);if(l+_>a&&l>0){r.push(y);break}l+=_;const v=new qQ(y,0,0);Ye(t.instances.get(y.id)==null),t.addInstance(y.id,v)}const c=l*o,u=nP(c),d=s.vertexBufferLayout.createView(u.buffer);let p=0;t.hasHiddenInstances=!1,t.hasHighlights=!1,t.hasOccludees=!1,t.instances.forEach((y,_)=>{this._writeGeometry(y.geometry,d,p);const v=p;p+=s.elementCount(y.geometry.geometry),t.updateInstance(_,v,p),t.updateDrawState(y)}),this._vaoCache.deleteVao(t.vao),t.vao=this._vaoCache.newVao(KQ(c)),t.vao.vertexBuffers.geometry.setSubData(u,0,0,p*o),oP(),t.holes.clear();const g=t.holes.pushNew();return g.from=p,g.to=Math.floor(t.vao.byteSize/n),t.updateDrawCommands(n),t}_applyRemoves(t,r){if(r.changes.length===0)return;for(const a of r.changes){const l=a.id,c=t.instances.get(l);if(!c)continue;t.deleteInstance(l);const u=kd.back();if(u){if(u.to===c.from){u.to=c.to;continue}if(u.from===c.to){u.from=c.from;continue}}const d=kd.pushNew();d.from=c.from,d.to=c.to}WQ(kd);const i=this._bufferWriter.vertexBufferLayout.stride/4,s=kd.reduce((a,l)=>Math.max(a,l.numElements),0)*i,n=nP(s);n.fill(0,0,s);const o=t.vao.vertexBuffers.geometry;kd.forAll(a=>o.setSubData(n,a.from*i,0,a.numElements*i)),oP(),t.holes.pushArray(kd.data,kd.length),kd.forAll((a,l)=>kd.data[l]=null),kd.clear(),t.drawCommandsDirty=!0}_applyAdds(t,r){if(r.length===0)return;if(!sWe(t))return void this._applyAndRebuild(t,r,null);const i=this._bufferWriter,s=i.vertexBufferLayout.stride/4,n=t.numElements,o=r.reduce((w,T)=>w+i.elementCount(T.geometry),0),a=Math.min((n+o)*s,sP),l=4*a;if(t.vao.byteSize<KQ(sP-ZL)&&l>t.vao.byteSize)return void this._applyAndRebuild(t,r,null);WQ(t.holes);const c=new Array;for(const w of r){const T=i.elementCount(w.geometry),x=dWe(t.holes,T);c.push(x)}const u=t.vao.vertexBuffers.geometry;let d=0,p=0,g=0;const y=nP(a),_=i.vertexBufferLayout.createView(y.buffer);r.forEach((w,T)=>{const x=c[T];if(x==null)return;if(g!==x){const A=g-p;A>0&&u.setSubData(y,p*s,0,A*s),p=x,d=0}const S=i.elementCount(w.geometry);this._writeGeometry(w,_,d),d+=S,g=x+S;const O=new qQ(w,x,x+S);Ye(t.instances.get(w.id)==null),t.addInstance(w.id,O),t.drawCommandsDirty=!0});const v=g-p;v>0&&u.setSubData(y,p*s,0,v*s),xwe(r,(w,T)=>c[T]==null),oP()}_writeGeometry(t,r,i){const s=t.localOrigin.vec3;L4e(YQ,-s[0],-s[1],-s[2]);const n=Jr(pWe,YQ,t.transformation);Fn(rP,n),Bl(rP,rP),this._bufferWriter.write(n,rP,t.geometry,r,i)}updateAnimation(t){return this.material.update(t)}requiresSlot(t,r){return this.material.requiresSlot(t,r)}prepareTechnique(t){const{output:r,bindParameters:i}=t;if(!this.requiresSlot(i.slot,r))return null;const s=r===D.Highlight||r===D.ShadowHighlight;if(s&&!this._hasHighlights)return null;const n=r===D.ShadowExcludeHighlight,o=!(s||n);for(const a of this._dataByOrigin.values())for(const l of a.buffers){if(s&&!l.hasHighlights)continue;const c=(s?l.drawCommandsHighlight:n&&l.needsMultipleCommands()?l.drawCommandsShadowHighlightRest:l.drawCommandsDefault)||null,u=o&&l.drawCommandsOccludees||null;if(c?.length||u?.length){const d=this._glMaterials.load(t.rctx,i.slot,r),p=d!=null?d.beginSlot(i):null;if(p!=null)return p}}return null}render(t,r){const{output:i,bindParameters:s}=t,n=i===D.Highlight||i===D.ShadowHighlight,o=i===D.ShadowExcludeHighlight,a=!(n||o),l=this._rctx;l.appleAmdDriverHelper?.resetIndicesType(),l.bindTechnique(r,this.material.parameters,s);for(const c of this._dataByOrigin.values())for(const u of c.buffers){if(n&&!u.hasHighlights)continue;const d=(n?u.drawCommandsHighlight:o&&u.needsMultipleCommands()?u.drawCommandsShadowHighlightRest:u.drawCommandsDefault)||null,p=a&&u.drawCommandsOccludees||null;(d?.length||p?.length)&&(r.program.bindDraw(new pB(c.origin),s,this.material.parameters),r.ensureAttributeLocations(u.vao),l.bindVAO(u.vao),d?.length&&(r.bindPipelineState(l,s.slot,!1),d.forAll(g=>l.drawArrays(r.primitiveType,g.first,g.count))),p?.length&&(r.bindPipelineState(l,s.slot,!0),p.forAll(g=>l.drawArrays(r.primitiveType,g.first,g.count))))}}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}class ZQ{constructor(t){this.origin=t,this.changes=new Array}}function dWe(e,t){let r;if(!e.some(s=>!(s.numElements<t)&&(r=s,!0)))return null;const i=r.from;return r.from+=t,r.from>=r.to&&e.removeUnordered(r),i}const YQ=be(),pWe=be(),rP=be(),kd=new Mt({allocator:e=>e||new KH,deallocator:null}),ZL=65536,iP=4*ZL,JQ=1024,Jye=16777216,sP=Jye/4;let vI=new Float32Array(ZL);function nP(e){return vI.length<e&&(vI=new Float32Array(e)),vI}function KQ(e){const t=4*e;return t<=JQ?JQ:t<iP?iP:Math.max(Math.min(Math.ceil(1.5*t/iP)*iP,Jye),t)}function oP(){vI=new Float32Array(2)}let ac=class extends xe{constructor(e){super(e),this._pending=new fWe,this._changes=new dB,this._materialRenderers=new Map,this._sortedMaterialRenderers=new Mt,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return _o(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=Bye(this._changes);let t=!1,r=!1,i=!1;return e.forEach((s,n)=>{let o=this._materialRenderers.get(n);if(!o&&s.adds.length>0&&(o=new Yye(this.rctx,this._materialRepository,n),this._materialRenderers.set(n,o),t=!0,r=!0,i=!0),!o)return;const a=r||o.hasHighlights,l=i||o.hasWater;o.modify(s),r=r||a!==o.hasHighlights,i=i||l!==o.hasWater,o.isEmpty&&(this._materialRenderers.delete(n),o.dispose(),t=!0)}),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),r&&(this._hasHighlights=_o(this._materialRenderers,s=>s.hasHighlights)),i&&(this._hasWater=_o(this._materialRenderers,s=>s.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,t){if(e.length===0)return;const r=this._validateRenderGeometries(e);for(const s of r)this._geometries.set(s.id,s);const i=this._pending.empty;for(const s of r)this._pending.adds.add(s);i&&this.notifyChange("updating"),t===Fi.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const r=this._pending.empty,i=this._pending.adds;for(const s of e)i.has(s)?(this._pending.removed.add(s),i.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id);r&&!this._pending.empty&&this.notifyChange("updating"),t===Fi.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const r=this._changes.updates.length===0;for(const i of e){const s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(i),s.updateType=t}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case hn.TRANSFORMATION:case hn.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case hn.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll(r=>t=r.updateAnimation(e)||t),t}render(e){this._sortedMaterialRenderers.forAll(t=>{if(t.material.shouldRender(e)){const r=t.prepareTechnique(e);r!=null&&t.render(e,r)}})}intersect(e,t,r,i,s){return this._geometries.forEach(n=>{if(i&&!i(n))return;this._intersectRenderGeometry(n,r,t,0,e,s);const o=this.rendererContext.longitudeCyclical;o&&(n.boundingSphere[0]-n.boundingSphere[3]<o.min&&this._intersectRenderGeometry(n,r,t,o.range,e,s),n.boundingSphere[0]+n.boundingSphere[3]>o.max&&this._intersectRenderGeometry(n,r,t,-o.range,e,s)),s++}),s}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((t,r)=>{r.insertOrder=e++,this._sortedMaterialRenderers.push(t)}),this._sortedMaterialRenderers.sort((t,r)=>{const i=r.material.renderPriority-t.material.renderPriority;return i!==0?i:t.material.insertOrder-r.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,r,i,s,n){if(!e.visible)return;let o=0;i+=e.transformation[12],o=e.transformation[13],W6[0]=r[0]-i,W6[1]=r[1]-o,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,s,W6,(a,l,c)=>{mWe(t,c,e.material.renderPriority,n,s,e.layerUid,e.graphicUid)},t)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let t;for(const r of e){const i=r.graphicUid;i!=null&&i!==t&&(this.drapeSource.notifyGraphicGeometryChanged(i),t=i)}}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let t;for(const r of e){const i=r.graphicUid;i!=null&&i!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(i),t=i)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};h([f()],ac.prototype,"drapeSource",void 0),h([f()],ac.prototype,"updating",null),h([f()],ac.prototype,"rctx",null),h([f()],ac.prototype,"rendererContext",void 0),h([f()],ac.prototype,"_materialRepository",null),h([f()],ac.prototype,"_localOriginFactory",null),h([f({readOnly:!0})],ac.prototype,"isEmpty",null),h([f()],ac.prototype,"_materialRenderers",void 0),h([f()],ac.prototype,"_geometries",void 0),ac=h([F("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],ac);class fWe{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(t){return this.adds.has(t)||this.removes.has(t)||this.removed.has(t)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}function mWe(e,t,r,i,s,n,o){const a=new LHe(n,o,t),l=c=>{c.set(Ii.OVERLAY,a,e.dist,e.normal,e.transformation,r,i)};if((s.results.min.drapedLayerOrder==null||r>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==so.MIN&&(s.results.max.drapedLayerOrder==null||r<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===so.ALL){const c=Nj(s.ray);l(c),s.results.all.push(c)}}const W6=Ne();class QH extends es{constructor(t,r){super(t,"vec2",jr.Draw,(i,s,n,o)=>i.setUniform2fv(t,r(s,n,o)))}}const q6=4;function gWe(){const e=new pr,t=e.fragment;e.include(ih);const r=(q6+1)/2,i=1/(2*r*r);return t.include(Uc),t.uniforms.add(new qe("depthMap",s=>s.depthTexture),new zu("tex",s=>s.colorTexture),new QH("blurSize",s=>s.blurSize),new Ae("projScale",(s,n)=>{const o=ni(n.camera.eye,n.camera.center);return o>5e4?Math.max(0,s.projScale-(o-5e4)):s.projScale}),new yr("nearFar",(s,n)=>n.camera.nearFar)),t.code.add(b`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${b.float(i)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),t.code.add(b`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${b.int(q6)}; r <= ${b.int(q6)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragColor = vec4(b / w_total);
    }
  `),e}const yWe=Object.freeze(Object.defineProperty({__proto__:null,build:gWe},Symbol.toStringTag,{value:"Module"}));class R4 extends xr{initializeProgram(t){return new vr(t.rctx,R4.shader.get().build(),dr)}initializePipeline(){return Tt({colorWrite:It})}}R4.shader=new _r(yWe,()=>ue(()=>import("./SSAOBlur.glsl.2f508075.js"),[]));const _We="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";function P4(e){e.fragment.uniforms.add(new Zt("projInfo",(t,r)=>vWe(r))),e.fragment.uniforms.add(new yr("zScale",(t,r)=>Kye(r))),e.fragment.code.add(b`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function vWe(e){const t=e.camera.projectionMatrix;return t[11]===0?pi(QQ,2/(e.camera.fullWidth*t[0]),2/(e.camera.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):pi(QQ,-2/(e.camera.fullWidth*t[0]),-2/(e.camera.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}const QQ=Ht();function Kye(e){return e.camera.projectionMatrix[11]===0?Qt(eee,0,1):Qt(eee,1,0)}const eee=Ne(),tee=16;function bWe(){const e=new pr,t=e.fragment;return e.include(ih),t.include(Uc),e.include(P4),t.uniforms.add(new Ae("radius",(r,i)=>eW(i.camera))),t.code.add(b`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),t.code.add(b`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.uniforms.add(new yr("nearFar",(r,i)=>i.camera.nearFar),new qe("normalMap",r=>r.normalTexture),new qe("depthMap",r=>r.depthTexture),new yr("zScale",(r,i)=>Kye(i)),new Ae("projScale",r=>r.projScale),new qe("rnm",r=>r.noiseTexture),new yr("rnmScale",(r,i)=>Qt(ree,i.camera.fullWidth/r.noiseTexture.descriptor.width,i.camera.fullHeight/r.noiseTexture.descriptor.height)),new Ae("intensity",r=>r.intensity),new yr("screenSize",(r,i)=>Qt(ree,i.camera.fullWidth,i.camera.fullHeight))),t.code.add(b`
    void main(void) {
      fillSphere();
      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        fragColor = vec4(0);
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w < 0.5;

      float sum = 0.0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${b.int(tee)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          if (texture(normalMap, tcTap).w < 0.5) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${b.int(tee)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
      fragColor = vec4(A);
    }
  `),e}function eW(e){return Math.max(10,20*e.computeScreenPixelSizeAtDist(Math.abs(4*e.relativeElevation)))}const ree=Ne(),wWe=Object.freeze(Object.defineProperty({__proto__:null,build:bWe,getRadius:eW},Symbol.toStringTag,{value:"Module"}));class M4 extends xr{initializeProgram(t){return new vr(t.rctx,M4.shader.get().build(),dr)}initializePipeline(){return Tt({colorWrite:It})}}M4.shader=new _r(wWe,()=>ue(()=>import("./SSAO.glsl.88ad36bb.js"),[]));class xWe extends Wr{constructor(){super(...arguments),this.projScale=1}}class TWe extends xWe{constructor(){super(...arguments),this.intensity=1}}class SWe extends Wr{}class EWe extends SWe{constructor(){super(...arguments),this.blurSize=Ne()}}const UE=2;class Qye{constructor(t,r,i,s){this._view=t,this._techniqueRepository=r,this._rctx=i,this._requestRender=s,this._quadVAO=null,this._passParameters=new TWe,this._drawParameters=new EWe}dispose(){this.enabled=!1,this._quadVAO=De(this._quadVAO)}destroy(){this.dispose()}disposeOffscreenBuffers(){this._ssaoFBO?.resize(0,0),this._blurFBO?.resize(0,0)}set enabled(t){t?this._enable():this._disable()}get enabled(){return this._enableTime!=null}get active(){return this.enabled&&this._ssaoTechnique.compiled&&this._blurTechnique.compiled}get colorTexture(){return this._ssaoFBO?.colorTexture}render(t,r,i,s){if(this._enableTime==null||i==null||s==null||this._ssaoFBO==null||this._blurFBO==null)return;if(!this.active)return this._enableTime=r,void this._requestRender();this._enableTime===0&&(this._enableTime=r);const n=this._rctx,o=t.camera,a=this._view.qualitySettings.fadeDuration,l=a>0?Math.min(a,r-this._enableTime)/a:1;this._passParameters.normalTexture=s,this._passParameters.depthTexture=i,this._passParameters.projScale=1/o.computeRenderPixelSizeAtDist(1),this._passParameters.intensity=4*CWe/eW(o)**6*l;const c=o.fullViewport,u=c[2],d=c[3],p=u/UE,g=d/UE;this._ssaoFBO.resize(u,d),this._blurFBO.resize(p,g),this._quadVAO==null&&(this._quadVAO=el(this._rctx)),n.bindFramebuffer(this._ssaoFBO),n.setViewport(0,0,u,d),n.bindTechnique(this._ssaoTechnique,this._passParameters,t).bindDraw(this._drawParameters,t,this._passParameters),n.bindVAO(this._quadVAO);const y=vo(this._quadVAO,"geometry");n.drawArrays(bt.TRIANGLE_STRIP,0,y);const _=n.bindTechnique(this._blurTechnique,this._passParameters,t);n.setViewport(0,0,p,g),n.bindFramebuffer(this._blurFBO),this._drawParameters.colorTexture=this._ssaoFBO.colorTexture,Qt(this._drawParameters.blurSize,0,UE/d),_.bindDraw(this._drawParameters,t,this._passParameters),n.setViewport(0,0,p,g),n.drawArrays(bt.TRIANGLE_STRIP,0,y),n.bindFramebuffer(this._ssaoFBO),n.setViewport(0,0,u,d),n.setClearColor(1,1,1,0),n.clear(fi.COLOR_BUFFER_BIT),n.setViewport(0,0,p,g),this._drawParameters.colorTexture=this._blurFBO.colorTexture,Qt(this._drawParameters.blurSize,UE/u,0),_.bindDraw(this._drawParameters,t,this._passParameters),n.drawArrays(bt.TRIANGLE_STRIP,0,y),n.setViewport(c[0],c[1],c[2],c[3]),l<1&&this._requestRender()}_enable(){if(this._enableTime!=null)return;const t=new hr;t.wrapMode=Ct.CLAMP_TO_EDGE,this._ssaoFBO=new Bi(this._rctx,t),this._blurFBO=new Bi(this._rctx,t);const r=Uint8Array.from(atob(_We),i=>i.charCodeAt(0));t.pixelFormat=vt.RGB,t.wrapMode=Ct.REPEAT,t.hasMipmap=!0,t.width=32,t.height=32,this._passParameters.noiseTexture=new wt(this._rctx,t,r),this._ssaoTechnique==null&&(this._ssaoTechnique=this._techniqueRepository.acquire(M4)),this._blurTechnique==null&&(this._blurTechnique=this._techniqueRepository.acquire(R4)),this._enableTime=0,this._requestRender()}_disable(){this._enableTime=null,this._passParameters.noiseTexture=De(this._passParameters.noiseTexture),this._blurFBO=De(this._blurFBO),this._ssaoFBO=De(this._ssaoFBO)}get gpuMemoryUsage(){return(this._blurFBO?.gpuMemoryUsage??0)+(this._ssaoFBO?.gpuMemoryUsage??0)}}const CWe=.5;class aO extends xr{initializeProgram(t){return new vr(t.rctx,aO.shader.get().build(),dr)}initializePipeline(){return this.configuration.hasAlpha?Tt({blending:oo(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),colorWrite:It}):Tt({colorWrite:It})}}aO.shader=new _r(jje,()=>ue(()=>import("./TextureOnly.glsl.cc05aa4a.js"),[]));class tW extends Yo{constructor(){super(...arguments),this.hasAlpha=!1}}h([B()],tW.prototype,"hasAlpha",void 0);let cp=class extends xe{get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new gi,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new Mt,this._passParameters=new vye,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this._camera=new lt,this.worldToPCSRatio=1,this.events=new cs,this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView,{waterTextureRepository:t,stippleTextureRepository:r,markerTextureRepository:i}=e;this._shaderTechniqueRepository=new bye({rctx:this._rctx,viewingMode:Ie.Local,stippleTextureRepository:r,markerTextureRepository:i,waterTextureRepository:t}),this._renderContext=new kye(this._rctx,new XH(this._rctx,this.view.state.viewingMode),new Qye(this.view,this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([le(()=>t.updating,()=>this.events.emit("content-changed"),_s),le(()=>this.spatialReference,s=>this._localOriginFactory=new WH(s),_s),qo(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new wye(e.textureRepository,this._shaderTechniqueRepository,s=>{(s.renderOccluded&YL)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=ae.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=lfe(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=tt.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new Sj(Ce(1,1,1))]),this._handles.add(this.view.resourceController.scheduler.registerTask(at.STAGE,this))}destroy(){this._handles.destroy(),this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=Mi(this._debugTextureTechnique),this._passParameters.texture=De(this._passParameters.texture),this._bindParameters.highlightDepthTexture=De(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Re(this._shaderTechniqueRepository),this._temporaryFBO=De(this._temporaryFBO),this._quadVAO=De(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||_o(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._overlayRenderTarget!=null}get gpuMemoryUsage(){return this._overlayRenderTarget!=null?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,ac)}createDrapeSourceRenderer(e,t,r){const i=this._renderers.get(e);i?.destroy();const s=new t({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(le(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),s}removeDrapeSourceRenderer(e){if(e==null)return;const t=this._renderers.get(e);t!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this._handles.remove(e),t.destroy())}collectUnusedRenderTargetMemory(){let e=!1;const t=exe();if(this._overlayRenderTarget!=null)for(const r of this._overlayRenderTarget.renderTargets){const i=this.overlays[Si.INNER].validTargets[r.type];e=this._overlayRenderTarget.validateUsageForTarget(i,r,t)||e}return e}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._overlays!=null&&this._overlays.forEach(t=>t.hasTargetWithoutRasterImage=hM(e,r=>r.drapeTargetType===uB.WithoutRasterImage))}ensureDrapeSources(e){this._overlays!=null&&this._overlays.forEach(t=>{t.hasDrapedFeatureSource=hM(e,r=>r.drapeSourceType===DC.Features),t.hasDrapedRasterSource=hM(e,r=>r.drapeSourceType===DC.RasterImage)})}ensureOverlays(e,t){this._overlays==null&&(this._overlayRenderTarget=new Bje(this._rctx),this._overlays=[new DK(Si.INNER,this._overlayRenderTarget),new DK(Si.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=De(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,t){let r=!1;for(const[i,s]of this._renderers){if(e.done)break;(i.destroyed||t(i))&&s.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(_a,e=>e.updatePolicy===oy.SYNC)}get isEmpty(){return!Kr.OVERLAY_DRAW_DEBUG_TEXTURE&&!_o(this._renderers,e=>!e.isEmpty)}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let t=!1;return this._renderers.forEach(r=>t=r.updateAnimation(e)||t),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,t,r){const i=e.canvasGeometries;if(i.numViews===0)return!1;const{alignPixelEnabled:s,contentPixelRatio:n}=r;this._screenToWorldRatio=n*e.mapUnitsPerPixel/cH;const o=t.output;if(this.isEmpty||o===D.Highlight&&!this.hasHighlights||o===D.Normal&&!this.hasWater||!e.hasSomeSizedView())return!1;const a=t.fbo;if(!a.isValid())return!1;const l=2*e.resolution,c=e.resolution;a.resize(l,c);const u=this._rctx;if(this._camera.pixelRatio=e.pixelRatio*n,this._renderContext.output=o,this._bindParameters.alignPixelEnabled=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=o===D.Normal?ae.DRAPED_WATER:ae.DRAPED_MATERIAL,e.applyViewport(this._rctx),a.bind(u),e.index===Si.INNER&&(u.setClearColor(0,0,0,0),u.clearSafe(fi.COLOR_BUFFER_BIT)),t.type===Zi.Occluded&&(this._renderContext.renderOccludedMask=YL),Kr.OVERLAY_DRAW_DEBUG_TEXTURE&&t.type!==Zi.Occluded)for(let d=0;d<i.numViews;d++)this._setViewParameters(i.extents[d],e),this._drawDebugTexture(e.resolution,OWe[e.index]);return this._renderers.size>0&&this._sortedRenderers.forAll(({drapeSource:d,renderer:p})=>{if(t.type===Zi.ColorNoRasterImage&&d.drapeSourceType===DC.RasterImage)return;const{fullOpacity:g}=d,y=g!=null&&g<1&&o===D.Color;y&&(this.bindTemporaryFramebuffer(this._rctx,l,c),u.clearSafe(fi.COLOR_BUFFER_BIT));for(let _=0;_<i.numViews;_++)this._setViewParameters(i.extents[_],e),p.render(this._renderContext);y&&this._temporaryFBO!=null&&(a.bind(u),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),g,e.index))}),u.bindFramebuffer(null),a.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,r){this._temporaryFBO==null&&(this._temporaryFBO=new _ye(e,!1)),this._temporaryFBO.resize(t,r),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,r,i){let s=0;for(const n of this._renderers.values())s=n.intersect?.(e,t,r,i,s)??s}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers;this._renderers.forEach((t,r)=>{const i=e.indexOf(r.layer),s=i>=0,n=this._renderers.size*(r.renderGroup??(s?HL.MapLayer:HL.ViewLayer))+(s?i:0);this._sortedRenderers.push(new AWe(r,t,n))}),this._sortedRenderers.sort((t,r)=>t.index-r.index)}_setViewParameters(e,t){const r=this._camera;r.viewport=[0,0,t.resolution,t.resolution],Mhe(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),U3(r.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=_o(this._renderers,t=>t.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=_o(this._renderers,t=>t.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=_o(this._renderers,t=>t.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,t){this._ensureDebugPatternResources(e,t);const r=this._rctx;r.bindTechnique(this._debugTextureTechnique,this._passParameters,null),r.bindVAO(this._quadVAO),r.drawArrays(bt.TRIANGLE_STRIP,0,vo(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,t){if(se(this._passParameters.color,t[0],t[1],t[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let i=0;for(let o=0;o<e;o++)for(let a=0;a<e;a++){const l=Math.floor(a/10),c=Math.floor(o/10);l<2||c<2||10*l>e-20||10*c>e-20?(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=255):(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=1&l&&1&c?1&a^1&o?0:255:1&l^1&c?0:128)}const s=new hr(e);s.samplingMode=xt.NEAREST,this._passParameters.texture=new wt(this._rctx,s,r);const n=new tW;n.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(aO,n),this._quadVAO=el(this._rctx)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};h([f()],cp.prototype,"_sortedDrapeSourceRenderersDirty",void 0),h([f({autoDestroy:!0})],cp.prototype,"_shaderTechniqueRepository",void 0),h([f({constructOnly:!0})],cp.prototype,"view",void 0),h([f()],cp.prototype,"worldToPCSRatio",void 0),h([f()],cp.prototype,"spatialReference",void 0),h([f({type:Boolean,readOnly:!0})],cp.prototype,"updating",null),h([f()],cp.prototype,"isEmpty",null),cp=h([F("esri.views.3d.terrain.OverlayRenderer")],cp);class AWe{constructor(t,r,i){this.drapeSource=t,this.renderer=r,this.index=i}}const OWe=[[1,.5,.5],[.5,.5,1]],rW=-2,YL=Ei.OccludeAndTransparent;function iW(e,t,r,i){const s=sO(e.rings,!!e.hasZ,Qp.CCW_IS_HOLE),n=To(s.position.length),o=M0e(s.position,e.spatialReference,0,n,0,s.position,0,s.position.length/3,t,r,i),a=o!=null;return new MWe(s.position,n,r_e(s.polygons,s.position,n),t_e(s.outlines,s.position,n),a,o)}function e_e(e,t){const r=sO(e.rings,!1,Qp.CCW_IS_HOLE),i=ji(r.position,e.spatialReference,0,r.position,t,0,r.position.length/3);for(let s=2;s<r.position.length;s+=3)r.position[s]=rW;return{position:r.position,polygons:r_e(r.polygons,r.position),outlines:t_e(r.outlines,r.position),projectionSuccess:i}}function t_e(e,t,r=null){return e.filter(({count:i})=>i>1).map(({index:i,count:s})=>{const n=3*i,o=3*s;return r!=null?new i_e(i,s,Bu(t,n,o),Bu(r,n,o)):new sW(i,s,Bu(t,n,o))})}function r_e(e,t,r=null){const i=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of e){if(n<=1)continue;const l=3*s,c=3*n,u=o.map(p=>p-s),d=r!=null?new RWe(s,n,Bu(t,3*s,3*n),Bu(r,l,c),u,a):new PWe(s,n,Bu(t,3*s,3*n),u,a);i.push(d)}return i}class sW{constructor(t,r,i){this.index=t,this.count=r,this.position=i}}class i_e extends sW{constructor(t,r,i,s){super(t,r,i),this.mapPositions=s}}class RWe extends i_e{constructor(t,r,i,s,n,o){super(t,r,i,s),this.holeIndices=n,this.pathLengths=o}}class PWe extends sW{constructor(t,r,i,s,n){super(t,r,i),this.holeIndices=s,this.pathLengths=n}}class MWe{constructor(t,r,i,s,n,o){this.position=t,this.mapPositions=r,this.polygons=i,this.outlines=s,this.projectionSuccess=n,this.sampledElevation=o}}function z1(e,t,r,i,s,n=2){const o=1/(Math.abs(r)+Math.abs(i)+Math.abs(s)),a=r*o,l=i*o,c=s<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,u=s<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,d=t*n;e[d]=iee(c),e[d+1]=iee(u)}function IWe(e){const t=e.length/3,r=new Int16Array(2*t);let i=0;for(let s=0;s<t;++s)z1(r,s,e[i++],e[i++],e[i++]);return r}function $We(e,t,r,i=2){const s=r*i,n=see(t[s]),o=see(t[s+1]),a=1-Math.abs(n)-Math.abs(o);e[2]=a,a<0?(e[0]=(n>=0?1:-1)*(1-Math.abs(o)),e[1]=(o>=0?1:-1)*(1-Math.abs(n))):(e[0]=n,e[1]=o),pe(e,e)}function iee(e){return fe(Math.round(32767*e),-32767,32767)}function see(e){return fe(e/32767,-1,1)}function s_e(e,t){const r=e.fragment;switch(r.code.add(b`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),t.doubleSidedMode){case Gi.None:r.code.add(b`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case Gi.View:r.code.add(b`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case Gi.WindingOrder:r.code.add(b`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:t.doubleSidedMode;case Gi.COUNT:}}var Gi;(function(e){e[e.None=0]="None",e[e.View=1]="View",e[e.WindingOrder=2]="WindingOrder",e[e.COUNT=3]="COUNT"})(Gi||(Gi={}));function n_e({normalTexture:e,metallicRoughnessTexture:t,metallicFactor:r,roughnessFactor:i,emissiveTexture:s,emissiveFactor:n,occlusionTexture:o}){return e==null&&t==null&&s==null&&(n==null||Go(n,wa))&&o==null&&(i==null||i===1)&&(r==null||r===1||r===0)}const I4=[1,1,.5],nW=[0,.6,.2],LWe=[0,1,.2];function o_e(e){e.vertex.code.add(b`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}class DWe extends Yo{constructor(){super(...arguments),this.instancedDoublePrecision=!1}}function a_e(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add(E.MODELORIGINHI,"vec3"),e.attributes.add(E.MODELORIGINLO,"vec3"),e.attributes.add(E.MODEL,"mat3"),e.attributes.add(E.MODELNORMAL,"mat3"));const r=e.vertex;t.instancedDoublePrecision&&(r.include(gL,t),r.uniforms.add(new Rc("viewOriginHi",(i,s)=>u6e(se(aP,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),aP)),new Rc("viewOriginLo",(i,s)=>h6e(se(aP,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),aP)))),r.code.add(b`
    vec3 calculateVPos() {
      ${t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),r.code.add(b`
    vec3 subtractOrigin(vec3 _pos) {
      ${t.instancedDoublePrecision?b`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),r.code.add(b`
    vec3 dpNormal(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),t.output===D.Normal&&(zT(r),r.code.add(b`
    vec3 dpNormalView(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),t.hasVertexTangents&&r.code.add(b`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}h([B()],DWe.prototype,"instancedDoublePrecision",void 0);const aP=C();var Xs;function NWe(e){switch(e){case"multiply":default:return Xs.Multiply;case"ignore":return Xs.Ignore;case"replace":return Xs.Replace;case"tint":return Xs.Tint}}function l_e(e,t,r){if(e==null||t===Xs.Ignore)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);const i=fe(Math.round(e[3]*JL),0,JL),s=i===0||t===Xs.Tint?0:t===Xs.Replace?FWe:UWe;r[0]=fe(Math.round(e[0]*zb),0,zb),r[1]=fe(Math.round(e[1]*zb),0,zb),r[2]=fe(Math.round(e[2]*zb),0,zb),r[3]=i+s}(function(e){e[e.Multiply=1]="Multiply",e[e.Ignore=2]="Ignore",e[e.Replace=3]="Replace",e[e.Tint=4]="Tint"})(Xs||(Xs={}));const zb=255,JL=85,FWe=JL,UWe=2*JL;function c_e(e){e.vertex.code.add(b`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${b.int(Xs.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${b.int(Xs.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${b.int(Xs.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${b.int(Xs.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function u_e(e,t){t.hasSymbolColors?(e.include(c_e),e.attributes.add(E.SYMBOLCOLOR,"vec4"),e.varyings.add("colorMixMode","mediump float"),e.vertex.code.add(b`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(e.fragment.uniforms.add(new oO("colorMixMode",r=>Sge[r.colorMixMode])),e.vertex.code.add(b`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function ub(e,t){t.hasVertexColors?(e.attributes.add(E.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(b`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(b`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(b`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function kWe(e){e.fragment.code.add(b`
    #define discardOrAdjustAlpha(color) { if (color.a < ${b.float(to)}) { discard; } }
  `)}class Zv extends es{constructor(t,r){super(t,"float",jr.Draw,(i,s,n)=>i.setUniform1f(t,r(s,n)))}}function Yv(e,t){h_e(e,t,new Ae("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function zWe(e,t){h_e(e,t,new Zv("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function h_e(e,t,r){const i=e.fragment;switch(t.alphaDiscardMode!==Gr.Mask&&t.alphaDiscardMode!==Gr.MaskBlend||i.uniforms.add(r),t.alphaDiscardMode){case Gr.Blend:return e.include(kWe);case Gr.Opaque:i.code.add(b`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case Gr.Mask:i.code.add(b`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case Gr.MaskBlend:e.fragment.code.add(b`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function d_e(e,t){const{vertex:r,fragment:i}=e,s=t.hasModelTransformation;if(s){const o=$i();r.uniforms.add(new Ci("model",a=>a.modelTransformation??Ks)),r.uniforms.add(new sh("normalTransform",a=>(vy(o,a.modelTransformation??Ks),o)))}const n=t.hasColorTexture&&t.alphaDiscardMode!==Gr.Opaque;switch(t.output){case D.Depth:case D.Shadow:case D.ShadowHighlight:case D.ShadowExcludeHighlight:case D.ObjectAndLayerIdColor:Fl(r,t),e.include(Xa,t),e.include(zp,t),e.include(wm,t),e.include(jm,t),e.include(os,t),e.include(K3,t),C1(e),e.varyings.add("depth","float"),n&&i.uniforms.add(new qe("tex",o=>o.texture)),r.code.add(b`
          void main(void) {
            vpos = calculateVPos();
            ${s?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
            forwardTextureCoordinates();
            forwardObjectAndLayerIdColor();
          }
        `),e.include(Yv,t),i.code.add(b`
          void main(void) {
            discardBySlice(vpos);
            ${n?b`
                    vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${t.output===D.ObjectAndLayerIdColor?b`outputObjectAndLayerIdColor();`:b`outputDepth(depth);`}
          }
        `);break;case D.Normal:{Fl(r,t),e.include(Xa,t),e.include(nO,t),e.include(C4,t),e.include(zp,t),e.include(wm,t),n&&i.uniforms.add(new qe("tex",a=>a.texture)),t.normalType===wr.ScreenDerivative&&e.varyings.add("vPositionView","vec3");const o=t.normalType===wr.Attribute||t.normalType===wr.Compressed;r.code.add(b`
          void main(void) {
            vpos = calculateVPos();
            ${s?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}

            ${o?b`vNormalWorld = ${s?"normalize(normalTransform * dpNormal(vvLocalNormal(normalModel())))":"dpNormalView(vvLocalNormal(normalModel()))"};`:b`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),e.include(os,t),e.include(Yv,t),i.code.add(b`
          void main() {
            discardBySlice(vpos);
            ${n?b`
                    vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${t.normalType===wr.ScreenDerivative?b`vec3 normal = screenDerivativeNormal(vPositionView);`:b`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break}case D.Highlight:Fl(r,t),e.include(Xa,t),e.include(zp,t),e.include(wm,t),n&&i.uniforms.add(new qe("tex",o=>o.texture)),r.code.add(b`
          void main(void) {
            vpos = calculateVPos();
            ${s?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),e.include(os,t),e.include(Yv,t),e.include(ig,t),i.code.add(b`
          void main() {
            discardBySlice(vpos);
            ${n?b`
                    vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function p_e(e,t){const r=e.fragment;t.hasVertexTangents?(e.attributes.add(E.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),t.doubleSidedMode===Gi.WindingOrder?r.code.add(b`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):r.code.add(b`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):r.code.add(b`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),t.textureCoordinateType!==ws.None&&(e.include(dj,t),r.uniforms.add(t.pbrTextureBindType===jr.Pass?new qe("normalTexture",i=>i.textureNormal):new zu("normalTexture",i=>i.textureNormal)),r.code.add(b`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;
return tangentSpace * rawNormal;
}`))}function lO(e,t){const r=e.fragment;t.receiveAmbientOcclusion?(r.uniforms.add(new qe("ssaoTex",(i,s)=>s.ssaoHelper.colorTexture)),r.constants.add("blurSizePixelsInverse","float",1/UE),r.code.add(b`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).a;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):r.code.add(b`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function cO(e){e.constants.add("ambientBoostFactor","float",Lfe)}function M2(e){e.uniforms.add(new Ae("lightingGlobalFactor",(t,r)=>r.lighting.globalFactor))}function B1(e,t){const r=e.fragment;switch(e.include(lO,t),t.pbrMode!==Qe.Disabled&&e.include(JH,t),e.include(mj,t),e.include(j3),r.code.add(b`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${t.pbrMode===Qe.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),cO(r),M2(r),Zm(r),r.code.add(b`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${t.spherical?b`normalize(vPosWorld)`:b`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),hf(r),r.code.add(b`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),t.pbrMode){case Qe.Disabled:case Qe.WaterOnIntegratedMesh:case Qe.Water:e.include(lL),r.code.add(b`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case Qe.Normal:case Qe.Schematic:r.code.add(b`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(b`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),t.useFillLights?r.uniforms.add(new Bp("hasFillLights",(i,s)=>s.enableFillLights)):r.constants.add("hasFillLights","bool",!1),r.code.add(b`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.uniforms.add(new Ae("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new Ae("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)),r.code.add(b`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(b`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${t.pbrMode===Qe.Schematic?b`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:b`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case Qe.Terrain:case Qe.TerrainWithWater:e.include(lL),r.code.add(b`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:t.pbrMode;case Qe.COUNT:}}function Ya(){const e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function f_e(e){const t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function bI(e,t,r,i,s,n,o,a,l){const c=new Float32Array(9);return c[0]=e,c[1]=t,c[2]=r,c[3]=i,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function BWe(e,t){return new Float32Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:f_e,create:Ya,createView:BWe,fromValues:bI},Symbol.toStringTag,{value:"Module"}));function VWe(e){e.vertex.uniforms.add(new sh("colorTextureTransformMatrix",t=>t.colorTextureTransformMatrix!=null?t.colorTextureTransformMatrix:Ya())),e.varyings.add("colorUV","vec2"),e.vertex.code.add(b`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function GWe(e){e.vertex.uniforms.add(new sh("normalTextureTransformMatrix",t=>t.normalTextureTransformMatrix!=null?t.normalTextureTransformMatrix:Ya())),e.varyings.add("normalUV","vec2"),e.vertex.code.add(b`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function jWe(e){e.vertex.uniforms.add(new sh("emissiveTextureTransformMatrix",t=>t.emissiveTextureTransformMatrix!=null?t.emissiveTextureTransformMatrix:Ya())),e.varyings.add("emissiveUV","vec2"),e.vertex.code.add(b`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function HWe(e){e.vertex.uniforms.add(new sh("occlusionTextureTransformMatrix",t=>t.occlusionTextureTransformMatrix!=null?t.occlusionTextureTransformMatrix:Ya())),e.varyings.add("occlusionUV","vec2"),e.vertex.code.add(b`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function WWe(e){e.vertex.uniforms.add(new sh("metallicRoughnessTextureTransformMatrix",t=>t.metallicRoughnessTextureTransformMatrix!=null?t.metallicRoughnessTextureTransformMatrix:Ya())),e.varyings.add("metallicRoughnessUV","vec2"),e.vertex.code.add(b`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function t3(e){e.include(df),e.code.add(b`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${b.int(Xs.Multiply)}) {
        return allMixed;
      }
      if (mode == ${b.int(Xs.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${b.int(Xs.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${b.int(Xs.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${b.int(Xs.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function qWe(e){const t=new pr,{vertex:r,fragment:i,varyings:s}=t;if(Fl(r,e),t.include(H3),s.add("vpos","vec3"),t.include(wm,e),t.include(a_e,e),t.include(mge,e),e.hasColorTextureTransform&&t.include(VWe),e.output===D.Color||e.output===D.Alpha){e.hasNormalTextureTransform&&t.include(GWe),e.hasEmissionTextureTransform&&t.include(jWe),e.hasOcclusionTextureTransform&&t.include(HWe),e.hasMetallicRoughnessTextureTransform&&t.include(WWe),xd(r,e),t.include(nO,e),t.include(Xa,e);const n=e.normalType===wr.Attribute||e.normalType===wr.Compressed;n&&e.offsetBackfaces&&t.include(o_e),t.include(p_e,e),t.include(C4,e),e.instancedColor&&t.attributes.add(E.INSTANCECOLOR,"vec4"),s.add("vPositionLocal","vec3"),t.include(zp,e),t.include(w2,e),t.include(u_e,e),t.include(ub,e),r.uniforms.add(new Zt("externalColor",a=>a.externalColor)),s.add("vcolorExt","vec4"),e.hasMultipassTerrain&&s.add("depth","float");const o=e.hasModelTransformation;if(o){const a=$i();r.uniforms.add(new Ci("model",l=>l.modelTransformation??Ks)),r.uniforms.add(new sh("normalTransform",l=>(vy(a,l.modelTransformation??Ks),a)))}r.code.add(b`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${e.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${b.float(to)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          ${o?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${n?b`vNormalWorld = ${o?"normalize(normalTransform * dpNormal(vvLocalNormal(normalModel())))":"dpNormal(vvLocalNormal(normalModel()))"};`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${e.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${n&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${e.hasColorTextureTransform?b`forwardColorUV();`:""}
        ${e.hasNormalTextureTransform?b`forwardNormalUV();`:""}
        ${e.hasEmissionTextureTransform?b`forwardEmissiveUV();`:""}
        ${e.hasOcclusionTextureTransform?b`forwardOcclusionUV();`:""}
        ${e.hasMetallicRoughnessTextureTransform?b`forwardMetallicRoughnessUV();`:""}
      }
    `)}switch(e.output){case D.Alpha:t.include(os,e),t.include(Yv,e),t.include(kc,e),i.uniforms.add(new Ae("opacity",n=>n.opacity),new Ae("layerOpacity",n=>n.layerOpacity)),e.hasColorTexture&&i.uniforms.add(new qe("tex",n=>n.texture)),i.include(t3),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?b`
                vec4 texColor = texture(tex, ${e.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?b`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        fragColor = vec4(opacity_);
      }
    `);break;case D.Color:t.include(os,e),t.include(B1,e),t.include(lO,e),t.include(Yv,e),t.include(e.instancedDoublePrecision?A4:k1,e),t.include(kc,e),xd(i,e),i.uniforms.add(r.uniforms.get("localOrigin"),new Rt("ambient",n=>n.ambient),new Rt("diffuse",n=>n.diffuse),new Ae("opacity",n=>n.opacity),new Ae("layerOpacity",n=>n.layerOpacity)),e.hasColorTexture&&i.uniforms.add(new qe("tex",n=>n.texture)),t.include(fj,e),t.include(JH,e),i.include(t3),t.include(s_e,e),cO(i),M2(i),hf(i),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?b`
                vec4 texColor = texture(tex, ${e.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${e.normalType===wr.ScreenDerivative?b`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:b`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${e.pbrMode===Qe.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${e.receiveShadows?"readShadowMap(vpos, linearDepth)":e.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?b`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.hasNormalTexture?b`
                mat3 tangentSpace = ${e.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${e.hasNormalTextureTransform?b`normalUV`:"vuv0"});`:b`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${e.spherical?b`normalize(posWorld);`:b`vec3(0.0, 0.0, 1.0);`}

        ${e.snowCover?b`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${e.pbrMode===Qe.Normal||e.pbrMode===Qe.Schematic?b`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${e.snowCover?b`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:b`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===tt.Color?b`fragColor = premultiplyAlpha(fragColor);`:""}
      }
    `)}return t.include(d_e,e),t}const XWe=Object.freeze(Object.defineProperty({__proto__:null,build:qWe},Symbol.toStringTag,{value:"Module"}));class ZWe extends Gye{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=fa(I4),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=oi.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=Ce(0,0,0),this.instancedDoublePrecision=!1,this.normalType=wr.Attribute,this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Ce(.2,.2,.2),this.diffuse=Ce(.8,.8,.8),this.externalColor=At(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=C(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=T1.Less,this.textureAlphaMode=Gr.Blend,this.textureAlphaCutoff=BL,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=Ei.Occlude}}class YWe extends jye{constructor(){super(...arguments),this.origin=C(),this.slicePlaneLocalOrigin=this.origin}}class uO extends xr{initializeConfiguration(t,r){r.spherical=t.viewingMode===Ie.Global,r.doublePrecisionRequiresObfuscation=t.rctx.driverTest.doublePrecisionRequiresObfuscation.result,r.textureCoordinateType=r.hasColorTexture||r.hasMetallicRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture?ws.Default:ws.None,r.objectAndLayerIdColorInstanced=r.instanced}initializeProgram(t){return this._initializeProgram(t,uO.shader)}_initializeProgram(t,r){return new vr(t.rctx,r.get().build(this.configuration),dr)}_convertDepthTestFunction(t){return t===T1.Lequal?Hr.LEQUAL:Hr.LESS}_makePipeline(t,r){const i=this.configuration,s=t===tt.NONE,n=t===tt.FrontFace;return Tt({blending:i.output!==D.Color&&i.output!==D.Alpha||!i.transparent?null:s?Pc:sg(t),culling:JWe(i)?FN(i.cullFace):null,depthTest:{func:Uy(t,this._convertDepthTestFunction(i.customDepthTest))},depthWrite:(s||n)&&i.writeDepth?Ka:null,colorWrite:It,stencilWrite:i.hasOccludees?ef:null,stencilTest:i.hasOccludees?r?My:ky:null,polygonOffset:s||n?null:d4(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,r){return r?this._occludeePipelineState:super.getPipelineState(t,r)}}function JWe(e){return e.cullFace!==oi.None||!e.hasSlicePlane&&!e.transparent&&!e.doubleSidedMode}uO.shader=new _r(XWe,()=>ue(()=>import("./DefaultMaterial.glsl.5e569aa6.js"),[]));class $t extends bo{constructor(){super(...arguments),this.output=D.Color,this.alphaDiscardMode=Gr.Opaque,this.doubleSidedMode=Gi.None,this.pbrMode=Qe.Disabled,this.cullFace=oi.None,this.transparencyPassType=tt.NONE,this.normalType=wr.Attribute,this.textureCoordinateType=ws.None,this.customDepthTest=T1.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}}h([B({count:D.COUNT})],$t.prototype,"output",void 0),h([B({count:Gr.COUNT})],$t.prototype,"alphaDiscardMode",void 0),h([B({count:Gi.COUNT})],$t.prototype,"doubleSidedMode",void 0),h([B({count:Qe.COUNT})],$t.prototype,"pbrMode",void 0),h([B({count:oi.COUNT})],$t.prototype,"cullFace",void 0),h([B({count:tt.COUNT})],$t.prototype,"transparencyPassType",void 0),h([B({count:wr.COUNT})],$t.prototype,"normalType",void 0),h([B({count:ws.COUNT})],$t.prototype,"textureCoordinateType",void 0),h([B({count:T1.COUNT})],$t.prototype,"customDepthTest",void 0),h([B()],$t.prototype,"spherical",void 0),h([B()],$t.prototype,"hasVertexColors",void 0),h([B()],$t.prototype,"hasSymbolColors",void 0),h([B()],$t.prototype,"hasVerticalOffset",void 0),h([B()],$t.prototype,"hasSlicePlane",void 0),h([B()],$t.prototype,"hasSliceHighlight",void 0),h([B()],$t.prototype,"hasColorTexture",void 0),h([B()],$t.prototype,"hasMetallicRoughnessTexture",void 0),h([B()],$t.prototype,"hasEmissionTexture",void 0),h([B()],$t.prototype,"hasOcclusionTexture",void 0),h([B()],$t.prototype,"hasNormalTexture",void 0),h([B()],$t.prototype,"hasScreenSizePerspective",void 0),h([B()],$t.prototype,"hasVertexTangents",void 0),h([B()],$t.prototype,"hasOccludees",void 0),h([B()],$t.prototype,"hasMultipassTerrain",void 0),h([B()],$t.prototype,"hasModelTransformation",void 0),h([B()],$t.prototype,"offsetBackfaces",void 0),h([B()],$t.prototype,"vvSize",void 0),h([B()],$t.prototype,"vvColor",void 0),h([B()],$t.prototype,"receiveShadows",void 0),h([B()],$t.prototype,"receiveAmbientOcclusion",void 0),h([B()],$t.prototype,"textureAlphaPremultiplied",void 0),h([B()],$t.prototype,"instanced",void 0),h([B()],$t.prototype,"instancedColor",void 0),h([B()],$t.prototype,"objectAndLayerIdColorInstanced",void 0),h([B()],$t.prototype,"instancedDoublePrecision",void 0),h([B()],$t.prototype,"doublePrecisionRequiresObfuscation",void 0),h([B()],$t.prototype,"writeDepth",void 0),h([B()],$t.prototype,"transparent",void 0),h([B()],$t.prototype,"enableOffset",void 0),h([B()],$t.prototype,"cullAboveGround",void 0),h([B()],$t.prototype,"snowCover",void 0),h([B()],$t.prototype,"hasColorTextureTransform",void 0),h([B()],$t.prototype,"hasEmissionTextureTransform",void 0),h([B()],$t.prototype,"hasNormalTextureTransform",void 0),h([B()],$t.prototype,"hasOcclusionTextureTransform",void 0),h([B()],$t.prototype,"hasMetallicRoughnessTextureTransform",void 0),h([B({constValue:!0})],$t.prototype,"hasVvInstancing",void 0),h([B({constValue:!1})],$t.prototype,"useCustomDTRExponentForWater",void 0),h([B({constValue:!1})],$t.prototype,"supportsTextureAtlas",void 0),h([B({constValue:!0})],$t.prototype,"useFillLights",void 0);function KWe(e){const t=new pr,{vertex:r,fragment:i,varyings:s}=t;return Fl(r,e),t.include(H3),s.add("vpos","vec3"),t.include(wm,e),t.include(a_e,e),t.include(mge,e),e.output!==D.Color&&e.output!==D.Alpha||(xd(t.vertex,e),t.include(nO,e),t.include(Xa,e),e.offsetBackfaces&&t.include(o_e),e.instancedColor&&t.attributes.add(E.INSTANCECOLOR,"vec4"),s.add("vNormalWorld","vec3"),s.add("localvpos","vec3"),e.hasMultipassTerrain&&s.add("depth","float"),t.include(zp,e),t.include(w2,e),t.include(u_e,e),t.include(ub,e),r.uniforms.add(new Zt("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),r.code.add(b`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${e.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${b.float(to)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${e.hasMultipassTerrain?b`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),e.output===D.Alpha&&(t.include(os,e),t.include(Yv,e),t.include(kc,e),i.uniforms.add(new Ae("opacity",n=>n.opacity),new Ae("layerOpacity",n=>n.layerOpacity)),e.hasColorTexture&&i.uniforms.add(new qe("tex",n=>n.texture)),i.include(t3),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?b`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?b`
                vec4 texColor = texture(tex, ${e.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?b`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        fragColor = vec4(opacity_);
      }
    `)),e.output===D.Color&&(t.include(os,e),t.include(B1,e),t.include(lO,e),t.include(Yv,e),t.include(e.instancedDoublePrecision?A4:k1,e),t.include(kc,e),xd(t.fragment,e),Zm(i),cO(i),M2(i),i.uniforms.add(r.uniforms.get("localOrigin"),r.uniforms.get("view"),new Rt("ambient",n=>n.ambient),new Rt("diffuse",n=>n.diffuse),new Ae("opacity",n=>n.opacity),new Ae("layerOpacity",n=>n.layerOpacity)),e.hasColorTexture&&i.uniforms.add(new qe("tex",n=>n.texture)),t.include(fj,e),t.include(JH,e),i.include(t3),hf(i),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?b`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?b`
                vec4 texColor = texture(tex, ${e.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${e.pbrMode===Qe.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?b`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.snowCover?b`albedo = mix(albedo, vec3(1), 0.9);`:b``}
        ${b`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${e.pbrMode===Qe.Normal||e.pbrMode===Qe.Schematic?e.spherical?b`vec3 normalGround = normalize(vpos + localOrigin);`:b`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:b``}
        ${e.pbrMode===Qe.Normal||e.pbrMode===Qe.Schematic?b`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${e.snowCover?b`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:b`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===tt.Color?b`fragColor = premultiplyAlpha(fragColor);`:b``}
      }
    `)),t.include(d_e,e),t}const QWe=Object.freeze(Object.defineProperty({__proto__:null,build:KWe},Symbol.toStringTag,{value:"Module"}));class $4 extends uO{initializeConfiguration(t,r){super.initializeConfiguration(t,r),r.hasMetallicRoughnessTexture=!1,r.hasEmissionTexture=!1,r.hasOcclusionTexture=!1,r.hasNormalTexture=!1,r.hasModelTransformation=!1,r.normalType=wr.Attribute,r.doubleSidedMode=Gi.WindingOrder,r.hasVertexTangents=!1}initializeProgram(t){return this._initializeProgram(t,$4.shader)}}$4.shader=new _r(QWe,()=>ue(()=>import("./RealisticTree.glsl.1d7c8c5d.js"),[]));class tf extends Fy{constructor(t){super(t,rqe),this.supportsEdges=!0,this._configuration=new $t,this._vertexBufferLayout=iqe(this.parameters)}isVisibleForOutput(t){return t!==D.Shadow&&t!==D.ShadowExcludeHighlight&&t!==D.ShadowHighlight||this.parameters.castShadows}isVisible(){const t=this.parameters;if(!super.isVisible()||t.layerOpacity===0)return!1;const{hasInstancedColor:r,hasVertexColors:i,hasSymbolColors:s,vvColor:n}=t,o=t.colorMixMode==="replace",a=t.opacity>0,l=t.externalColor&&t.externalColor[3]>0,c=r||n||s;return i&&c?o||a:i?o?l:a:c?o||a:o?l:a}getConfiguration(t,r){return this._configuration.output=t,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this.parameters.customDepthTest!=null&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?oi.None:this.parameters.cullFace,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=this.parameters.modelTransformation!=null,t!==D.Color&&t!==D.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=Gi.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Gi.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Gi.WindingOrder:Gi.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?Qe.Schematic:Qe.Normal:Qe.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<u4,this._configuration.snowCover=this.hasSnowCover(r),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(t){return t.weather!=null&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}intersect(t,r,i,s,n,o){if(this.parameters.verticalOffset!=null){const a=i.camera;se(Z6,r[12],r[13],r[14]);let l=null;switch(i.viewingMode){case Ie.Global:l=pe(nee,Z6);break;case Ie.Local:l=re(nee,oqe)}let c=0;const u=ce(aqe,Z6,a.eye),d=Se(u),p=te(u,u,1/d);let g=null;this.parameters.screenSizePerspective&&(g=de(l,p)),c+=xge(a,d,this.parameters.verticalOffset,g??0,this.parameters.screenSizePerspective),te(l,l,c),Il(X6,l,i.transform.inverseRotation),s=ce(sqe,s,X6),n=ce(nqe,n,X6)}_ge(t,i,s,n,Dz(i.verticalOffset),o)}requiresSlot(t,r){return r===D.Color||r===D.Alpha||r===D.Depth||r===D.Normal||r===D.Shadow||r===D.ShadowHighlight||r===D.ShadowExcludeHighlight||r===D.Highlight||r===D.ObjectAndLayerIdColor?t===(this.parameters.transparent?this.parameters.writeDepth?ae.TRANSPARENT_MATERIAL:ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:ae.OPAQUE_MATERIAL)||t===ae.DRAPED_MATERIAL:!1}createGLMaterial(t){return new eqe(t)}createBufferWriter(){return new P2(this._vertexBufferLayout)}}class eqe extends pj{constructor(t){super({...t,...t.material.parameters})}_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:t.shadowMap.enabled})}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){this._output!==D.Color&&this._output!==D.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t));const r=this._material.parameters;this.updateTexture(r.textureId);const i=t.camera.viewInverseTransposeMatrix;return se(r.origin,i[3],i[7],i[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(r.treeRendering?$4:uO,t)}}class tqe extends ZWe{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}}const rqe=new tqe;function iqe(e){const t=Li().vec3f(E.POSITION);return e.normalType===wr.Compressed?t.vec2i16(E.NORMALCOMPRESSED,{glNormalized:!0}):t.vec3f(E.NORMAL),e.hasVertexTangents&&t.vec4f(E.TANGENT),(e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId)&&t.vec2f(E.UV0),e.hasVertexColors&&t.vec4u8(E.COLOR),e.hasSymbolColors&&t.vec4u8(E.SYMBOLCOLOR),ne("enable-feature:objectAndLayerId-rendering")&&t.vec4u8(E.OBJECTANDLAYERIDCOLOR),t}const sqe=C(),nqe=C(),oqe=Ce(0,0,1),nee=C(),X6=C(),Z6=C(),aqe=C(),lqe=["polygon","extent"];class cqe extends ff{constructor(t,r,i,s){super(t,r,i,s),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const a=m4(this._getSymbolSize());if(a)throw new G("graphics3dextrudesymbollayer:invalid-size",a)}const t=this.symbolLayer?.material?.color,r=this._getCombinedOpacityAndColor(t),i=fa(r),s=r[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:i,ambient:i,opacity:s,transparent:n,cullFace:n?oi.None:oi.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:wr.Compressed};this._material=new tf(o),this._bottomMaterial=new tf({...o,cullFace:oi.Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,lqe,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(r,new Vc);return this._createAs3DShape(r,t.renderingInfo,i,s,r.uid)}layerOpacityChanged(t,r){const i=this.symbolLayer?.material?.color,s=this._getCombinedOpacity(i),n=s<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:s,transparent:n}),this._bottomMaterial.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();t.forEach(a=>{const l=r(a);l?.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(t,r){return this.updateGraphics3DGraphicElevationInfo(t,r,Ry)}slicePlaneEnabledChanged(t,r){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),t.forEach(i=>{const s=r(i);s?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}_getExtrusionSize(t){let r;return r=t.size&&this._drivenProperties.size?Lje(t.size,2)??0:this._getSymbolSize(),r/=this._context.renderCoordsHelper.unitInMeters,r}applyRendererDiff(t,r){return this._drivenPropertiesChanged(r)?xs.RecreateSymbol:xs.RecreateGraphics}async queryForSnapping(t,r,i,s){const n=this._getExtrusionSize(i)*this._context.renderCoordsHelper.unitInMeters/s9(r),{objectId:o,target:a}=t,l=ye(a);switch(l.z=(l.z??0)+n,t.type){case"edge":{const{start:c,end:u}=t,d=ye(c),p=ye(u);return d.z=(d.z??0)+n,p.z=(p.z??0)+n,[xQ(o,l,1/0,d,p)]}case"vertex":return[_je(o,l,1/0),xQ(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(t,r,i,s,n){const o=QA(t.geometry);if(o==null)return null;if(o.rings.length===0||!o.rings.some(P=>P.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=iW(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=CH(o);if(l==null)return null;const c=new Array,u=new Array,d=Qs(),p=be(),g=C(),y=this._context.renderCoordsHelper.viewingMode===Ie.Global;y||this._context.renderCoordsHelper.worldUpAtPosition(null,g),Oc(o.spatialReference,[l.x,l.y,0],p,this._context.renderCoordsHelper.spatialReference);const _=be();Fn(_,p);const v=$i();vy(v,_);const{polygons:w,mapPositions:T,position:x}=a;for(const P of w){const U=P.count;if(this._context.clippingExtent&&(mi(d),Tc(d,P.mapPositions),!rd(d,this._context.clippingExtent)))continue;const I=qT(P.mapPositions,P.holeIndices,3);if(I.length===0)continue;const L=I.length,N=6*U,Z=vL(N+L),W=vL(L),V=To(3*N),J=To(3*N),R=To(3*N),k=To(N);uqe(x,T,I,P,V,R,J,k,Z,W,this._getExtrusionSize(r),g,y),XT(V,V,_);const z=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),H=new mqe(V,R,IWe(J),k);c.push(oee(this._material,Z,Z.length-W.length,H,i,z),oee(this._bottomMaterial,W,0,H,i,z)),u.push(H.heights)}if(c.length===0)return null;const S=new ng({geometries:c,layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0});S.transformation=p;const O=j0e(this.symbolLayer,{opacity:this._getLayerOpacity()}),A=O!=null?{baseMaterial:this._material,edgeMaterials:[O],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,$=new pf(this,S,c,null,null,(P,U,I,L,N)=>pqe(P,U,I,L,N,u),s,A);return $.alignedSampledElevation=a.sampledElevation,$.needsElevationUpdates=Ry(s.mode),$}}function oee(e,t,r,i,s,n){const o=T2(t.length),a=[[E.POSITION,new Fe(i.positions,3,!0)],[E.NORMALCOMPRESSED,new Fe(i.normals,2,!0)],[E.COLOR,new Fe(s,4,!0)]],l=[[E.POSITION,t],[E.NORMALCOMPRESSED,t],[E.COLOR,o]];return new Cs(e,a,l,i.elevation,Ki.Mesh,n,r)}function uqe(e,t,r,i,s,n,o,a,l,c,u,d,p){const g=r.length/3;let y=0,_=2*i.count;hqe(e,t,i.index,i.count,r,0,g,s,n,o,a,l,c,_,u,d,p);let v=2*i.count;_=0,aee(s,n,a,o,y,i.pathLengths[0],i.count,v,l,_,u),v+=4*i.pathLengths[0],_+=2*i.pathLengths[0],y+=i.pathLengths[0];for(let w=1;w<i.pathLengths.length;++w)aee(s,n,a,o,y,i.pathLengths[w],i.count,v,l,_,u),v+=4*i.pathLengths[w],_+=2*i.pathLengths[w],y+=i.pathLengths[w]}function hqe(e,t,r,i,s,n,o,a,l,c,u,d,p,g,y,_,v){re(Ia,_);const w=y>0?1:-1;let T=3*r,x=0,S=3*x,O=i,A=3*O;for(let U=0;U<i;++U)v&&(Ia[0]=e[T],Ia[1]=e[T+1],Ia[2]=e[T+2],pe(Ia,Ia)),a[S]=e[T],a[S+1]=e[T+1],a[S+2]=e[T+2],l[S]=t[T],l[S+1]=t[T+1],l[S+2]=t[T+2],c[S]=-w*Ia[0],c[S+1]=-w*Ia[1],c[S+2]=-w*Ia[2],u[x]=0,a[A]=e[T]+y*Ia[0],a[A+1]=e[T+1]+y*Ia[1],a[A+2]=e[T+2]+y*Ia[2],l[A]=t[T],l[A+1]=t[T+1],l[A+2]=t[T+2],c[A]=w*Ia[0],c[A+1]=w*Ia[1],c[A+2]=w*Ia[2],u[O]=y,S+=3,A+=3,T+=3,x+=1,O+=1;T=3*n,S=0,A=3*g;const $=y<0?pee:dee,P=y<0?dee:pee;for(let U=0;U<o;++U)p[S]=s[T+$[0]],p[S+1]=s[T+$[1]],p[S+2]=s[T+$[2]],d[A]=s[T+P[0]]+i,d[A+1]=s[T+P[1]]+i,d[A+2]=s[T+P[2]]+i,S+=3,A+=3,T+=3}function lP(e,t,r,i,s,n,o){i[n]=i[o],o*=3,e[n*=3]=e[o],e[n+1]=e[o+1],e[n+2]=e[o+2],t[n]=t[o],t[n+1]=t[o+1],t[n+2]=t[o+2],r[n]=s[0],r[n+1]=s[1],r[n+2]=s[2]}const gS=C();function aee(e,t,r,i,s,n,o,a,l,c,u){let d=s,p=s+1,g=s+o,y=s+o+1,_=a,v=a+1,w=a+2*n,T=a+2*n+1;u<0&&(d=s+o+1,y=s),c*=3;for(let x=0;x<n;++x)x===n-1&&(u>0?(p=s,y=s+o):(p=s,d=s+o)),dqe(e,d,p,g,gS),lP(e,t,i,r,gS,_,d),lP(e,t,i,r,gS,v,p),lP(e,t,i,r,gS,w,g),lP(e,t,i,r,gS,T,y),l[c++]=_,l[c++]=w,l[c++]=T,l[c++]=_,l[c++]=T,l[c++]=v,d++,p++,g++,y++,_+=2,v+=2,w+=2,T+=2}const Y6=C(),lee=C(),cee=C(),uee=C(),hee=C();function dqe(e,t,r,i,s){t*=3,r*=3,i*=3,se(Y6,e[t++],e[t++],e[t++]),se(lee,e[r++],e[r++],e[r++]),se(cee,e[i++],e[i++],e[i++]),ce(uee,lee,Y6),ce(hee,cee,Y6),rt(s,hee,uee),pe(s,s)}const Bb=C();function pqe(e,t,r,i,s,n){const o=e.stageObject,a=o.geometries,l=a.length,c=t.mode!=="absolute-height";let u=0;const d=o.transformation,p=m2(be(),d);for(let g=0;g<l;g+=2){const y=a[g];if(!OH(y))continue;const _=y.getMutableAttribute(E.POSITION).data,v=n[g/2],w=new eH(y.mapPositions),T=_.length/3;let x=0,S=!1,O=0;for(let A=0;A<T;A++){Bb[0]=_[x],Bb[1]=_[x+1],Bb[2]=_[x+2],i(w,cP),c&&(O+=cP.sampledElevation),Kr.TESTS_DISABLE_OPTIMIZATIONS?(se(nl,w.array[w.offset],w.array[w.offset+1],cP.z+v[x/3]),r!=null&&s.toRenderCoords(nl,r,nl),Ue(nl,nl,p)):(se(nl,_[x],_[x+1],_[x+2]),Ue(nl,nl,d),s.setAltitude(nl,cP.z+v[x/3]),Ue(nl,nl,p)),_[x]=nl[0],_[x+1]=nl[1],_[x+2]=nl[2];const $=fqe/s.unitInMeters;(Math.abs(Bb[0]-_[x])>=$||Math.abs(Bb[1]-_[x+1])>=$||Math.abs(Bb[2]-_[x+2])>=$)&&(S=!0),w.offset+=3,x+=3}S&&(y.invalidateBoundingInfo(),o.geometryVertexAttrsUpdated(a[g]),a[g+1].invalidateBoundingInfo(),o.geometryVertexAttrsUpdated(a[g+1])),u+=O/T}return u/l}const nl=C(),Ia=C(),cP=new rO,dee=[0,2,1],pee=[0,1,2],fqe=.01;class mqe{constructor(t,r,i,s){this.positions=t,this.elevation=r,this.normals=i,this.heights=s}}function L4(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function gqe(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function yqe(e,t,r,i,s,n,o,a,l,c,u,d,p,g,y,_){const v=new Float32Array(16);return v[0]=e,v[1]=t,v[2]=r,v[3]=i,v[4]=s,v[5]=n,v[6]=o,v[7]=a,v[8]=l,v[9]=c,v[10]=u,v[11]=d,v[12]=p,v[13]=g,v[14]=y,v[15]=_,v}function _qe(e,t){return new Float32Array(e,t,16)}const vqe=L4();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:vqe,clone:gqe,create:L4,createView:_qe,fromValues:yqe},Symbol.toStringTag,{value:"Module"}));const bqe=(e,t)=>{const r=uf(e,t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1);return Bl(r,r)},wqe=(e,t)=>{const r=uf(e,t,0,0,.5-.5*t,0,t,0,.5-.5*t,0,0,t,.5-.5*t,0,0,0,1);return Bl(r,r)},xqe=(e,t)=>{const r=1-t,i=uf(e,.2126+.7874*r,.7152-.7152*r,.0722-.0722*r,0,.2126-.2126*r,.7152+.2848*r,.0722-.0722*r,0,.2126-.2126*r,.7152-.7152*r,.0722+.9278*r,0,0,0,0,1);return Bl(i,i)},Tqe=(e,t)=>{const r=Math.sin(t*Math.PI/180),i=Math.cos(t*Math.PI/180),s=uf(e,.213+.787*i-.213*r,.715-.715*i-.715*r,.072-.072*i+.928*r,0,.213-.213*i+.143*r,.715+.285*i+.14*r,.072-.072*i-.283*r,0,.213-.213*i-.787*r,.715-.715*i+.715*r,.072+.928*i+.072*r,0,0,0,0,1);return Bl(s,s)},Sqe=(e,t)=>{const r=1-2*t,i=uf(e,r,0,0,t,0,r,0,t,0,0,r,t,0,0,0,1);return Bl(i,i)},Eqe=(e,t)=>{const r=uf(e,.213+.787*t,.715-.715*t,.072-.072*t,0,.213-.213*t,.715+.285*t,.072-.072*t,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,1);return Bl(r,r)},Cqe=(e,t)=>{const r=1-t,i=uf(e,.393+.607*r,.769-.769*r,.189-.189*r,0,.349-.349*r,.686+.314*r,.168-.168*r,0,.272-.272*r,.534-.534*r,.131+.869*r,0,0,0,0,1);return Bl(i,i)};class D4{constructor(t,r,i){this.strength=t,this.radius=r,this.threshold=i,this.type="bloom"}interpolate(t,r,i){this.strength=Cl(t.strength,r.strength,i),this.radius=Cl(t.radius,r.radius,i),this.threshold=Cl(t.threshold,r.threshold,i)}clone(){return new D4(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:NC(this.radius),strength:this.strength,threshold:this.threshold}}}class N4{constructor(t){this.radius=t,this.type="blur"}interpolate(t,r,i){this.radius=Math.round(Cl(t.radius,r.radius,i))}clone(){return new N4(this.radius)}toJSON(){return{type:"blur",radius:NC(this.radius)}}}class r3{constructor(t,r){this.type=t,this.amount=r,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,r,i){this.amount=Cl(t.amount,r.amount,i),this._updateMatrix()}clone(){return new r3(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const t=this._colorMatrix||L4();switch(this.type){case"brightness":this._colorMatrix=bqe(t,this.amount);break;case"contrast":this._colorMatrix=wqe(t,this.amount);break;case"grayscale":this._colorMatrix=xqe(t,this.amount);break;case"invert":this._colorMatrix=Sqe(t,this.amount);break;case"saturate":this._colorMatrix=Eqe(t,this.amount);break;case"sepia":this._colorMatrix=Cqe(t,this.amount)}}}class F4{constructor(t,r,i,s){this.offsetX=t,this.offsetY=r,this.blurRadius=i,this.color=s,this.type="drop-shadow"}interpolate(t,r,i){this.offsetX=Cl(t.offsetX,r.offsetX,i),this.offsetY=Cl(t.offsetY,r.offsetY,i),this.blurRadius=Cl(t.blurRadius,r.blurRadius,i),this.color[0]=Math.round(Cl(t.color[0],r.color[0],i)),this.color[1]=Math.round(Cl(t.color[1],r.color[1],i)),this.color[2]=Math.round(Cl(t.color[2],r.color[2],i)),this.color[3]=Cl(t.color[3],r.color[3],i)}clone(){return new F4(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const t=[...this.color];return t[3]*=255,{type:"drop-shadow",xoffset:NC(this.offsetX),yoffset:NC(this.offsetY),blurRadius:NC(this.blurRadius),color:t}}}class U4{constructor(t){this.angle=t,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,r,i){this.angle=Cl(t.angle,r.angle,i),this._updateMatrix()}clone(){return new U4(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const t=this._colorMatrix||L4();this._colorMatrix=Tqe(t,this.angle)}}class k4{constructor(t){this.amount=t,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(t,r,i){this.amount=Cl(t.amount,r.amount,i)}clone(){return new k4(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function Cl(e,t,r){return e+(t-e)*r}function NC(e){return Math.round(1e3*_d(e))/1e3}function Aqe(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new r3(e.type,0);case"saturate":case"brightness":case"contrast":return new r3(e.type,1);case"opacity":return new k4(1);case"hue-rotate":return new U4(0);case"blur":return new N4(0);case"drop-shadow":return new F4(0,0,0,[...TV("transparent")]);case"bloom":return new D4(0,0,1)}}function Oqe(e,t){const r=e.length>t.length?e:t;return(e.length>t.length?t:e).every((i,s)=>i.type===r[s].type)}function Rqe(e,t){const r=e.length>t.length?e:t,i=e.length>t.length?t:e;for(let s=i.length;s<r.length;s++)i.push(Aqe(r[s]))}function nmt(e){const t=e[0];return!!t&&"type"in t}var fee,mee,fB={exports:{}};fB.exports,mee=function(){function e(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function t(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,t.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function r(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function i(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:gf},u=gf,d="none",p=")",g=",",y="(",_="%",v="px",w="cm",T="mm",x="in",S="pt",O="pc",A="deg",$="rad",P="grad",U="turn",I="#",L=".",N="e",Z=/^[ \t\n\r]/,W=/^[a-z\-]/,V=/^[0-9a-fA-F]/,J=/^[+\-]/,R=/^[0-9]/,k=Ea("none"),z=wn("none",!1),H=wn(")",!1),X=wn(",",!1),Y=Ea("whitespace"),ee=zy([" ","	",`
`,"\r"],!1,!1),me=Ea("function"),$e=wn("(",!1),pt=Ea("identifier"),St=zy([["a","z"],"-"],!1,!1),it=Ea("percentage"),ft=wn("%",!1),ge=Ea("length"),Ee=wn("px",!1),_t=wn("cm",!1),_e=wn("mm",!1),ke=wn("in",!1),Ve=wn("pt",!1),ct=wn("pc",!1),nt=Ea("angle"),ze=wn("deg",!1),mt=wn("rad",!1),ir=wn("grad",!1),qt=wn("turn",!1),ai=Ea("number"),Je=Ea("color"),Ke=wn("#",!1),ht=zy([["0","9"],["a","f"],["A","F"]],!1,!1),kt=zy(["+","-"],!1,!1),Xt=zy([["0","9"]],!1,!1),Fr=wn(".",!1),li=wn("e",!1),zt=function(){return[]},ci=function(j,he){return{type:"function",name:j,parameters:he||[]}},Ai=function(j,he){return he.length>0?L2(j,he,3):[j]},Ir=function(j){return{type:"quantity",value:j.value,unit:j.unit}},fr=function(j){return{type:"color",colorType:j.type,value:j.value}},Di=function(j){return j},us=function(){return tl()},Tr=function(j){return{value:j,unit:"%"}},qr=function(j){return{value:j,unit:"px"}},Ur=function(j){return{value:j,unit:"cm"}},lr=function(j){return{value:j,unit:"mm"}},Qr=function(j){return{value:j,unit:"in"}},Ls=function(j){return{value:j,unit:"pt"}},Bn=function(j){return{value:j,unit:"pc"}},Vn=function(j){return{value:j,unit:"deg"}},tn=function(j){return{value:j,unit:"rad"}},rn=function(j){return{value:j,unit:"grad"}},Ni=function(j){return{value:j,unit:"turn"}},sn=function(j){return{value:j,unit:null}},kr=function(){return{type:"hex",value:tl()}},vn=function(j){return{type:"function",value:j}},lo=function(){return{type:"named",value:tl()}},Jo=function(){return parseFloat(tl())},ie=0,yi=0,ah=[{line:1,column:1}],bn=0,lh=[],Xe=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');u=c[n.startRule]}function tl(){return s.substring(yi,ie)}function wn(j,he){return{type:"literal",text:j,ignoreCase:he}}function zy(j,he,Te){return{type:"class",parts:j,inverted:he,ignoreCase:Te}}function By(){return{type:"end"}}function Ea(j){return{type:"other",description:j}}function mf(j){var he,Te=ah[j];if(Te)return Te;for(he=j-1;!ah[he];)he--;for(Te={line:(Te=ah[he]).line,column:Te.column};he<j;)s.charCodeAt(he)===10?(Te.line++,Te.column=1):Te.column++,he++;return ah[j]=Te,Te}function Vy(j,he,Te){var sr=mf(j),Ds=mf(he),ui={source:l,start:{offset:j,line:sr.line,column:sr.column},end:{offset:he,line:Ds.line,column:Ds.column}};return Te&&l&&typeof l.offset=="function"&&(ui.start=l.offset(ui.start),ui.end=l.offset(ui.end)),ui}function Bt(j){ie<bn||(ie>bn&&(bn=ie,lh=[]),lh.push(j))}function og(j,he,Te){return new t(t.buildMessage(j,he),j,he,Te)}function gf(){var j;return(j=ag())===a&&(j=Ko()),j}function ag(){var j,he;return Xe++,j=ie,Hi(),s.substr(ie,4)===d?(he=d,ie+=4):(he=a,Xe===0&&Bt(z)),he!==a?(Hi(),yi=j,j=zt()):(ie=j,j=a),Xe--,j===a&&Xe===0&&Bt(k),j}function Ko(){var j,he;if(j=[],(he=rl())!==a)for(;he!==a;)j.push(he),he=rl();else j=a;return j}function rl(){var j,he,Te,sr;return j=ie,Hi(),(he=lg())!==a?(Hi(),(Te=Od())===a&&(Te=null),Hi(),s.charCodeAt(ie)===41?(sr=p,ie++):(sr=a,Xe===0&&Bt(H)),sr!==a?(Hi(),yi=j,j=ci(he,Te)):(ie=j,j=a)):(ie=j,j=a),j}function Od(){var j,he,Te,sr,Ds,ui,Qo,Wy;if(j=ie,(he=xn())!==a){for(Te=[],sr=ie,Ds=Hi(),s.charCodeAt(ie)===44?(ui=g,ie++):(ui=a,Xe===0&&Bt(X)),ui===a&&(ui=null),Qo=Hi(),(Wy=xn())!==a?sr=Ds=[Ds,ui,Qo,Wy]:(ie=sr,sr=a);sr!==a;)Te.push(sr),sr=ie,Ds=Hi(),s.charCodeAt(ie)===44?(ui=g,ie++):(ui=a,Xe===0&&Bt(X)),ui===a&&(ui=null),Qo=Hi(),(Wy=xn())!==a?sr=Ds=[Ds,ui,Qo,Wy]:(ie=sr,sr=a);yi=j,j=Ai(he,Te)}else ie=j,j=a;return j}function xn(){var j,he;return j=ie,(he=jy())===a&&(he=hb())===a&&(he=Hy())===a&&(he=cg()),he!==a&&(yi=j,he=Ir(he)),(j=he)===a&&(j=ie,(he=mO())!==a&&(yi=j,he=fr(he)),j=he),j}function Hi(){var j,he;for(Xe++,j=[],Z.test(s.charAt(ie))?(he=s.charAt(ie),ie++):(he=a,Xe===0&&Bt(ee));he!==a;)j.push(he),Z.test(s.charAt(ie))?(he=s.charAt(ie),ie++):(he=a,Xe===0&&Bt(ee));return Xe--,he=a,Xe===0&&Bt(Y),j}function lg(){var j,he,Te;return Xe++,j=ie,(he=Gy())!==a?(s.charCodeAt(ie)===40?(Te=y,ie++):(Te=a,Xe===0&&Bt($e)),Te!==a?(yi=j,j=Di(he)):(ie=j,j=a)):(ie=j,j=a),Xe--,j===a&&(he=a,Xe===0&&Bt(me)),j}function Gy(){var j,he,Te;if(Xe++,j=ie,he=[],W.test(s.charAt(ie))?(Te=s.charAt(ie),ie++):(Te=a,Xe===0&&Bt(St)),Te!==a)for(;Te!==a;)he.push(Te),W.test(s.charAt(ie))?(Te=s.charAt(ie),ie++):(Te=a,Xe===0&&Bt(St));else he=a;return he!==a&&(yi=j,he=us()),Xe--,(j=he)===a&&(he=a,Xe===0&&Bt(pt)),j}function jy(){var j,he,Te;return Xe++,j=ie,Hi(),(he=Ca())!==a?(s.charCodeAt(ie)===37?(Te=_,ie++):(Te=a,Xe===0&&Bt(ft)),Te!==a?(yi=j,j=Tr(he)):(ie=j,j=a)):(ie=j,j=a),Xe--,j===a&&Xe===0&&Bt(it),j}function hb(){var j,he,Te;return Xe++,j=ie,Hi(),(he=Ca())!==a?(s.substr(ie,2)===v?(Te=v,ie+=2):(Te=a,Xe===0&&Bt(Ee)),Te!==a?(yi=j,j=qr(he)):(ie=j,j=a)):(ie=j,j=a),j===a&&(j=ie,Hi(),(he=Ca())!==a?(s.substr(ie,2)===w?(Te=w,ie+=2):(Te=a,Xe===0&&Bt(_t)),Te!==a?(yi=j,j=Ur(he)):(ie=j,j=a)):(ie=j,j=a),j===a&&(j=ie,Hi(),(he=Ca())!==a?(s.substr(ie,2)===T?(Te=T,ie+=2):(Te=a,Xe===0&&Bt(_e)),Te!==a?(yi=j,j=lr(he)):(ie=j,j=a)):(ie=j,j=a),j===a&&(j=ie,Hi(),(he=Ca())!==a?(s.substr(ie,2)===x?(Te=x,ie+=2):(Te=a,Xe===0&&Bt(ke)),Te!==a?(yi=j,j=Qr(he)):(ie=j,j=a)):(ie=j,j=a),j===a&&(j=ie,Hi(),(he=Ca())!==a?(s.substr(ie,2)===S?(Te=S,ie+=2):(Te=a,Xe===0&&Bt(Ve)),Te!==a?(yi=j,j=Ls(he)):(ie=j,j=a)):(ie=j,j=a),j===a&&(j=ie,Hi(),(he=Ca())!==a?(s.substr(ie,2)===O?(Te=O,ie+=2):(Te=a,Xe===0&&Bt(ct)),Te!==a?(yi=j,j=Bn(he)):(ie=j,j=a)):(ie=j,j=a)))))),Xe--,j===a&&Xe===0&&Bt(ge),j}function Hy(){var j,he,Te;return Xe++,j=ie,(he=Ca())!==a?(s.substr(ie,3)===A?(Te=A,ie+=3):(Te=a,Xe===0&&Bt(ze)),Te!==a?(yi=j,j=Vn(he)):(ie=j,j=a)):(ie=j,j=a),j===a&&(j=ie,(he=Ca())!==a?(s.substr(ie,3)===$?(Te=$,ie+=3):(Te=a,Xe===0&&Bt(mt)),Te!==a?(yi=j,j=tn(he)):(ie=j,j=a)):(ie=j,j=a),j===a&&(j=ie,(he=Ca())!==a?(s.substr(ie,4)===P?(Te=P,ie+=4):(Te=a,Xe===0&&Bt(ir)),Te!==a?(yi=j,j=rn(he)):(ie=j,j=a)):(ie=j,j=a),j===a&&(j=ie,(he=Ca())!==a?(s.substr(ie,4)===U?(Te=U,ie+=4):(Te=a,Xe===0&&Bt(qt)),Te!==a?(yi=j,j=Ni(he)):(ie=j,j=a)):(ie=j,j=a)))),Xe--,j===a&&(he=a,Xe===0&&Bt(nt)),j}function cg(){var j,he;return Xe++,j=ie,Hi(),(he=Ca())!==a?(yi=j,j=sn(he)):(ie=j,j=a),Xe--,j===a&&Xe===0&&Bt(ai),j}function mO(){var j,he,Te,sr;if(Xe++,j=ie,s.charCodeAt(ie)===35?(he=I,ie++):(he=a,Xe===0&&Bt(Ke)),he!==a){if(Te=[],V.test(s.charAt(ie))?(sr=s.charAt(ie),ie++):(sr=a,Xe===0&&Bt(ht)),sr!==a)for(;sr!==a;)Te.push(sr),V.test(s.charAt(ie))?(sr=s.charAt(ie),ie++):(sr=a,Xe===0&&Bt(ht));else Te=a;Te!==a?(yi=j,j=kr()):(ie=j,j=a)}else ie=j,j=a;return j===a&&(j=ie,(he=rl())!==a&&(yi=j,he=vn(he)),(j=he)===a&&(j=ie,(he=Gy())!==a&&(yi=j,he=lo()),j=he)),Xe--,j===a&&(he=a,Xe===0&&Bt(Je)),j}function Ca(){var j,he,Te,sr,Ds,ui,Qo;for(j=ie,J.test(s.charAt(ie))?(s.charAt(ie),ie++):Xe===0&&Bt(kt),he=ie,Te=[],R.test(s.charAt(ie))?(sr=s.charAt(ie),ie++):(sr=a,Xe===0&&Bt(Xt));sr!==a;)Te.push(sr),R.test(s.charAt(ie))?(sr=s.charAt(ie),ie++):(sr=a,Xe===0&&Bt(Xt));if(s.charCodeAt(ie)===46?(sr=L,ie++):(sr=a,Xe===0&&Bt(Fr)),sr!==a){if(Ds=[],R.test(s.charAt(ie))?(ui=s.charAt(ie),ie++):(ui=a,Xe===0&&Bt(Xt)),ui!==a)for(;ui!==a;)Ds.push(ui),R.test(s.charAt(ie))?(ui=s.charAt(ie),ie++):(ui=a,Xe===0&&Bt(Xt));else Ds=a;Ds!==a?he=Te=[Te,sr,Ds]:(ie=he,he=a)}else ie=he,he=a;if(he===a)if(he=[],R.test(s.charAt(ie))?(Te=s.charAt(ie),ie++):(Te=a,Xe===0&&Bt(Xt)),Te!==a)for(;Te!==a;)he.push(Te),R.test(s.charAt(ie))?(Te=s.charAt(ie),ie++):(Te=a,Xe===0&&Bt(Xt));else he=a;if(he!==a){if(Te=ie,s.charCodeAt(ie)===101?(sr=N,ie++):(sr=a,Xe===0&&Bt(li)),sr!==a){if(J.test(s.charAt(ie))?(Ds=s.charAt(ie),ie++):(Ds=a,Xe===0&&Bt(kt)),Ds===a&&(Ds=null),ui=[],R.test(s.charAt(ie))?(Qo=s.charAt(ie),ie++):(Qo=a,Xe===0&&Bt(Xt)),Qo!==a)for(;Qo!==a;)ui.push(Qo),R.test(s.charAt(ie))?(Qo=s.charAt(ie),ie++):(Qo=a,Xe===0&&Bt(Xt));else ui=a;ui!==a?Te=sr=[sr,Ds,ui]:(ie=Te,Te=a)}else ie=Te,Te=a;Te===a&&(Te=null),yi=j,j=Jo()}else ie=j,j=a;return j}function $2(j,he){return j.map(function(Te){return Te[he]})}function L2(j,he,Te){return[j].concat($2(he,Te))}if((o=u())!==a&&ie===s.length)return o;throw o!==a&&ie<s.length&&Bt(By()),og(lh,bn<s.length?s.charAt(bn):null,bn<s.length?Vy(bn,bn+1):Vy(bn,bn))}return e(t,Error),t.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(l):l,u=this.location.source+":"+c.line+":"+c.column;if(a){var d=this.location.end,p=r("",c.line.toString().length," "),g=a[l.line-1],y=(l.line===d.line?d.column:g.length+1)-l.column||1;n+=`
 --> `+u+`
`+p+` |
`+c.line+" | "+g+`
`+p+" | "+r("",l.column-1," ")+r("",y,"^")}else n+=`
 at `+u}return n},t.buildMessage=function(s,n){var o={literal:function(g){return'"'+l(g.text)+'"'},class:function(g){var y=g.parts.map(function(_){return Array.isArray(_)?c(_[0])+"-"+c(_[1]):c(_)});return"["+(g.inverted?"^":"")+y.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(g){return g.description}};function a(g){return g.charCodeAt(0).toString(16).toUpperCase()}function l(g){return g.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function c(g){return g.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function u(g){return o[g.type](g)}function d(g){var y,_,v=g.map(u);if(v.sort(),v.length>0){for(y=1,_=1;y<v.length;y++)v[y-1]!==v[y]&&(v[_]=v[y],_++);v.length=_}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function p(g){return g?'"'+l(g)+'"':"end of input"}return"Expected "+d(s)+" but "+p(n)+" found."},{SyntaxError:t,parse:i}},(fee=fB).exports&&(fee.exports=mee());var Pqe=fB.exports;function omt(e){if(!e||e.length===0)return null;if(typeof e=="string"){const r=gee(e);return r&&r.length!==0?r:null}const t=e.map(r=>{if(!Number.isFinite(r.scale)||r.scale<=0)throw new G("effect:invalid-scale","scale must be finite and greater than 0",{stop:r});return{scale:r.scale,effects:gee(r.value)}});t.sort((r,i)=>i.effects.length-r.effects.length);for(let r=0;r<t.length-1;r++){if(!Oqe(t[r].effects,t[r+1].effects))throw new G("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:t[r].effects,b:t[r+1].effects});Rqe(t[r].effects,t[r+1].effects)}return t.sort((r,i)=>i.scale-r.scale),t}function gee(e){let t;if(!e)return[];try{t=Pqe.parse(e)}catch(r){throw new G("effect:invalid-syntax","Invalid effect syntax",{value:e,error:r})}return t.map(r=>Mqe(r))}function Mqe(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return Iqe(e);case"opacity":return $qe(e);case"hue-rotate":return Lqe(e);case"blur":return Dqe(e);case"drop-shadow":return Nqe(e);case"bloom":return Fqe(e)}}catch(t){throw t.details.filter=e,t}throw new G("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}function Iqe(e){let t=1;return I2(e.parameters,1),e.parameters.length===1&&(t=Wh(e.parameters[0])),new r3(e.name,t)}function $qe(e){let t=1;return I2(e.parameters,1),e.parameters.length===1&&(t=Wh(e.parameters[0])),new k4(t)}function Lqe(e){let t=0;return I2(e.parameters,1),e.parameters.length===1&&(t=Gqe(e.parameters[0])),new U4(t)}function Dqe(e){let t=0;return I2(e.parameters,1),e.parameters.length===1&&(t=lW(e.parameters[0]),hO(t,e.parameters[0])),new N4(t)}function Nqe(e){const t=[];let r=null;for(const i of e.parameters)if(i.type==="color"){if(t.length&&Object.freeze(t),r)throw new G("effect:type-error","Accepts only one color",{});r=jqe(i)}else{const s=lW(i);if(Object.isFrozen(t))throw new G("effect:type-error","<length> parameters not consecutive",{lengths:t});t.push(s),t.length===3&&hO(s,i)}if(t.length<2||t.length>3)throw new G("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${t.length}}`,{lengths:t});return new F4(t[0],t[1],t[2]||0,r||m_e("black"))}function Fqe(e){let t=1,r=0,i=0;return I2(e.parameters,3),e.parameters[0]&&(t=Wh(e.parameters[0])),e.parameters[1]&&(r=lW(e.parameters[1]),hO(r,e.parameters[1])),e.parameters[2]&&(i=Wh(e.parameters[2])),new D4(t,r,i)}function I2(e,t){if(e.length>t)throw new G("effect:type-error",`Function supports up to ${t} parameters, Actual: ${e.length}`,{parameters:e})}function z4(e){if(e.type==="color")return"<color>";if(e.unit){if(e.unit in aW)return"<length>";if(e.unit in oW)return"<angle>";if(e.unit==="%")return"<percentage>"}return"<double>"}function hO(e,t){if(e<0)throw new G("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:t})}function Uqe(e){if(e.type!=="quantity"||e.unit!==null)throw new G("effect:type-error",`Expected <double>, Actual: ${z4(e)}`,{term:e})}function kqe(e){if(e.type!=="quantity"||e.unit!==null&&e.unit!=="%")throw new G("effect:type-error",`Expected <double> or <percentage>, Actual: ${z4(e)}`,{term:e})}const oW={deg:1,grad:.9,rad:180/Math.PI,turn:360};function zqe(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&oW[e.unit]!=null))throw new G("effect:type-error",`Expected <angle>, Actual: ${z4(e)}`,{term:e})}const aW={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function Bqe(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&aW[e.unit]!=null))throw new G("effect:type-error",`Expected <length>, Actual: ${z4(e)}`,{term:e})}function Wh(e){kqe(e);const t=e.value;return hO(t,e),e.unit==="%"?.01*t:t}function Vqe(e){return Uqe(e),hO(e.value,e),e.value}function Gqe(e){return zqe(e),e.value*oW[e.unit]||0}function lW(e){return Bqe(e),e.value*aW[e.unit]||0}function jqe(e){switch(e.colorType){case"hex":return Cbe(e.value);case"named":return m_e(e.value);case"function":return qqe(e.value)}}function m_e(e){if(!yne(e))throw new G("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return Ebe(e)}const Hqe=/^rgba?/i,Wqe=/^hsla?/i;function qqe(e){if(I2(e.parameters,4),Hqe.test(e.name))return[Wh(e.parameters[0]),Wh(e.parameters[1]),Wh(e.parameters[2]),e.parameters[3]?Wh(e.parameters[3]):1];if(Wqe.test(e.name))return _ne(Vqe(e.parameters[0]),Wh(e.parameters[1]),Wh(e.parameters[2]),e.parameters[3]?Wh(e.parameters[3]):1);throw new G("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}function Xqe(e){return typeof e=="function"}function amt(e,t,r,i){return Xqe(e)?e(t,r,i):e}function lmt(e){return[e.r,e.g,e.b,e.a]}const Zqe=` /-,
`;function yee(e){let t=e.length;for(;t--;)if(!Zqe.includes(e.charAt(t)))return!1;return!0}function Yqe(e,t){const r=[];let i=0,s=-1;do if(s=e.indexOf("[",i),s>=i){if(s>i){const n=e.substr(i,s-i);r.push([n,null,yee(n)])}if(i=s+1,s=e.indexOf("]",i),s>=i){if(s>i){const n=t[e.substr(i,s-i)];n&&r.push([null,n,!1])}i=s+1}}while(s!==-1);if(i<e.length-1){const n=e.substr(i);r.push([n,null,yee(n)])}return r}function Jqe(e,t,r){let i="",s=null;for(const n of t){const[o,a,l]=n;if(o)l?s=o:(s&&(i+=s,s=null),i+=o);else{const c=e.attributes[a];c&&(s&&(i+=s,s=null),i+=c)}}return Kqe(i,r)}function cmt(e,t,r){const i=Yqe(t,e);return s=>Jqe(s,i,r)}function Kqe(e,t){switch(typeof e!="string"&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}function umt(e,t,r,i,s,n,o=!0){const a=t/s,l=r/n,c=Math.ceil(a/2),u=Math.ceil(l/2);for(let d=0;d<n;d++)for(let p=0;p<s;p++){const g=4*(p+(o?n-d-1:d)*s);let y=0,_=0,v=0,w=0,T=0,x=0,S=0;const O=(d+.5)*l;for(let A=Math.floor(d*l);A<(d+1)*l;A++){const $=Math.abs(O-(A+.5))/u,P=(p+.5)*a,U=$*$;for(let I=Math.floor(p*a);I<(p+1)*a;I++){let L=Math.abs(P-(I+.5))/c;const N=Math.sqrt(U+L*L);N>=-1&&N<=1&&(y=2*N*N*N-3*N*N+1,y>0&&(L=4*(I+A*t),S+=y*e[L+3],v+=y,e[L+3]<255&&(y=y*e[L+3]/250),w+=y*e[L],T+=y*e[L+1],x+=y*e[L+2],_+=y))}}i[g]=w/_,i[g+1]=T/_,i[g+2]=x/_,i[g+3]=S/v}}function g_e(e){return e?{r:e[0],g:e[1],b:e[2],a:e[3]/255}:{r:0,g:0,b:0,a:0}}function Qqe(e){return e.data?.symbol??null}function eXe(e){return e.type==="CIMVectorMarker"||e.type==="CIMPictureMarker"||e.type==="CIMBarChartMarker"||e.type==="CIMCharacterMarker"||e.type==="CIMPieChartMarker"||e.type==="CIMStackedBarChartMarker"}function tXe(e){return e.type==="CIMGradientStroke"||e.type==="CIMPictureStroke"||e.type==="CIMSolidStroke"}function y_e(e){return e!=null&&(e.type==="CIMMarkerPlacementAlongLineRandomSize"||e.type==="CIMMarkerPlacementAlongLineSameSize"||e.type==="CIMMarkerPlacementAlongLineVariableSize"||e.type==="CIMMarkerPlacementAtExtremities"||e.type==="CIMMarkerPlacementAtMeasuredUnits"||e.type==="CIMMarkerPlacementAtRatioPositions"||e.type==="CIMMarkerPlacementOnLine"||e.type==="CIMMarkerPlacementOnVertices")}const hmt=(e,t=0)=>e==null||isNaN(e)?t:e,dmt=e=>e.tintColor?g_e(e.tintColor):{r:255,g:255,b:255,a:1},pmt=e=>{if(!e)return!1;for(const t of e)switch(t.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function fmt(){return ue(()=>import("./geometryEngineJSON.70954d4c.js"),["assets/geometryEngineJSON.70954d4c.js","assets/geometryEngineBase.d1b13217.js","assets/geometryEngineJSON.e71e98d1.js","assets/json.7bed7e43.js"])}function mmt(e){if(!e)return"normal";switch(e.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function gmt(e){if(!e)return"normal";switch(e.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function ymt(e){let t="normal",r="normal";if(e){const i=e.toLowerCase();i.includes("italic")?t="italic":i.includes("oblique")&&(t="oblique"),i.includes("bold")?r="bold":i.includes("light")&&(r="lighter")}return{style:t,weight:r}}function _mt(e){return e.underline?"underline":e.strikethrough?"line-through":"none"}function _ee(e){if(!e)return null;switch(e.type){case"CIMPolygonSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const r=_ee(t);if(r!=null)return r}break;case"CIMTextSymbol":return _ee(e.symbol);case"CIMSolidFill":return e.color}}function vee(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const t=e.symbolLayers;if(t)for(const r of t){const i=vee(r);if(i!=null)return i}break}case"CIMTextSymbol":return vee(e.symbol);case"CIMSolidStroke":return e.color}}function bee(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const r=bee(t);if(r!==void 0)return r}break;case"CIMTextSymbol":return bee(e.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return e.width}}function vmt(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function bmt(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function wmt(e){return(e?Object.keys(e):[]).map(t=>({name:t,alias:t,type:typeof e[t]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const xmt=e=>e.includes("data:image/svg+xml");function Tmt(e){if(!e)return null;switch(e.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function __e(e,t,r,i){if(e)if(e.type!=="CIMTextSymbol"){if(r&&e.effects)for(const s of e.effects)sXe(s,t);if(e.symbolLayers)for(const s of e.symbolLayers)switch(s.type){case"CIMPictureMarker":case"CIMVectorMarker":rXe(s,t,i);break;case"CIMPictureStroke":case"CIMSolidStroke":!i?.preserveOutlineWidth&&s.width&&(s.width*=t);break;case"CIMPictureFill":s.height&&(s.height*=t),s.offsetX&&(s.offsetX*=t),s.offsetY&&(s.offsetY*=t);break;case"CIMHatchFill":__e(s.lineSymbol,t,!0,{...i,preserveOutlineWidth:!1}),s.offsetX&&(s.offsetX*=t),s.offsetY&&(s.offsetY*=t),s.separation&&(s.separation*=t)}}else e.height!=null&&(e.height*=t)}function rXe(e,t,r){if(e&&(e.markerPlacement&&iXe(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&e.anchorPointUnits==="Absolute"&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size=e.size!=null?e.size*t:0,e.type==="CIMVectorMarker"&&e.markerGraphics))for(const i of e.markerGraphics)e.scaleSymbolsProportionally||__e(i.symbol,t,!0,r)}function iXe(e,t){switch(y_e(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const r=e.placementTemplate.map(i=>i*t);e.placementTemplate=r}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const r=e.placementTemplate.map(i=>i*t);e.placementTemplate=r}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}function sXe(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const r=e.dashTemplate.map(i=>i*t);e.dashTemplate=r}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}function nXe(e){const t=[];return mB(Qqe(e),t),t.length?new ot(g_e(t[0])):null}function mB(e,t){if(!e)return;let r;r=e.type==="CIMTextSymbol"?e.symbol:e;const i=e.type==="CIMPolygonSymbol";if(r?.symbolLayers){for(const s of r.symbolLayers)if(!(s.colorLocked||i&&(tXe(s)||eXe(s)&&s.markerPlacement&&y_e(s.markerPlacement))))switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":s.tintColor&&wee(t,s.tintColor);break;case"CIMVectorMarker":s.markerGraphics?.forEach(n=>{mB(n.symbol,t)});break;case"CIMSolidStroke":case"CIMSolidFill":wee(t,s.color);break;case"CIMHatchFill":mB(s.lineSymbol,t)}}}function wee(e,t){for(const r of e)if(r.join(".")===t.join("."))return;e.push(t)}class oXe{constructor(t,r){this._storage=new Zye,this.id="",this.name="",this.size=0,this._storage.maxSize=t,this._storage.register(this),r&&this._storage.registerRemoveFunc("",r)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(t,r,i=1){this._storage.put(this,t,r,i,1)}pop(t){return this._storage.pop(this,t)}get(t){return this._storage.get(this,t)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(t){this._storage.maxSize=t}resetHitRate(){}}new oXe(1e3);new ot([128,128,128]);const aXe=new ot("white");function lXe(e){return Sl(e.resource).href}function Smt(e,t){if(!e)return null;let r=null;return _1(e)?r=cXe(e):mN(e)&&(r=e.type==="cim"?nXe(e):e.color?new ot(e.color):null),r?i3(r,t):null}function cXe(e){const t=e.symbolLayers;if(!t)return null;let r=null;return t.forEach(i=>{i.type==="object"&&i.resource?.href||(r=i.type==="water"?i.color:i.material?i.material.color:null)}),r?new ot(r):null}function i3(e,t){if(t==null||e==null)return e;const r=e.toRgba();return r[3]=r[3]*t,new ot(r)}function uXe(e,t,r){const i=e.symbolLayers;if(!i)return;const s=n=>i3(t=t??n??(r!=null?aXe:null),r);i.forEach(n=>{if(n.type!=="object"||!n.resource?.href||t)if(n.type==="water")n.color=s(n.color);else{const o=n.material!=null?n.material.color:null,a=s(o);n.material==null?n.material=new Ac({color:a}):n.material.color=a,r!=null&&"outline"in n&&n.outline!=null&&n.outline.color!=null&&(n.outline.color=i3(n.outline.color,r))}})}function hXe(e,t,r){(t=t??e.color)&&(e.color=i3(t,r)),r!=null&&"outline"in e&&e.outline&&e.outline.color&&(e.outline.color=i3(e.outline.color,r))}function Emt(e,t,r){e&&(t||r!=null)&&(t&&(t=new ot(t)),_1(e)?uXe(e,t,r):mN(e)&&hXe(e,t,r))}async function dXe(e,t){const r=e.symbolLayers;r&&await IN(r,async i=>pXe(i,t))}async function pXe(e,t){switch(e.type){case"extrude":mXe(e,t);break;case"icon":case"line":case"text":fXe(e,t);break;case"path":yXe(e,t);break;case"object":await gXe(e,t)}}function fXe(e,t){const r=v_e(t);r!=null&&(e.size=r)}function v_e(e){for(const t of e)if(typeof t=="number")return t;return null}function mXe(e,t){e.size=typeof t[2]=="number"?t[2]:0}async function gXe(e,t){const{resourceSize:r,symbolSize:i}=await _Xe(e),s=b_e(t,r,i);e.width=FC(t[0],i[0],r[0],s),e.depth=FC(t[1],i[1],r[1],s),e.height=FC(t[2],i[2],r[2],s)}function yXe(e,t){const r=b_e(t,cm,[e.width,void 0,e.height]);e.width=FC(t[0],e.width,1,r),e.height=FC(t[2],e.height,1,r)}function b_e(e,t,r){for(let i=0;i<3;i++){const s=e[i];switch(s){case"symbol-value":{const n=r[i];return n!=null?n/t[i]:1}case"proportional":break;default:if(s&&t[i])return s/t[i]}}return 1}async function _Xe(e){const{computeObjectLayerResourceSize:t}=await ue(()=>import("./symbolLayerUtils.1b2ae9ce.js"),[]),r=await t(e,10),{width:i,height:s,depth:n}=e,o=[i,n,s];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/r[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=r[l]*a);return{resourceSize:r,symbolSize:o}}function FC(e,t,r,i){switch(e){case"proportional":return r*i;case"symbol-value":return t??r;default:return e}}function vXe(e,t){const r=v_e(t);if(r!=null)switch(e.type){case"simple-marker":e.size=r;break;case"picture-marker":{const i=e.width/e.height;i>1?(e.width=r,e.height=r*i):(e.width=r*i,e.height=r);break}case"simple-line":e.width=r;break;case"text":e.font.size=r}}async function Cmt(e,t){if(e&&t)return _1(e)?dXe(e,t):void(mN(e)&&vXe(e,t))}function Amt(e,t,r){if(e&&t!=null)if(_1(e)){const i=e.symbolLayers;i&&i.forEach(s=>{if(s&&s.type==="object")switch(r){case"tilt":s.tilt=t;break;case"roll":s.roll=t;break;default:s.heading=t}})}else mN(e)&&(e.type!=="simple-marker"&&e.type!=="picture-marker"&&e.type!=="text"||(e.angle=t))}function Omt(e){return e!=null&&e.type==="polygon-3d"&&e.symbolLayers.some(t=>t.type==="extrude")}async function Rmt(e,t){return await e.fetchSymbol(t)||e.fetchCIMSymbol(t)}function bXe(e,t,r,i,s){if(e==null)return null;const n=e.referencesGeometry()&&s?wXe(t,i,s):t,o=e.repurposeFeature(n);try{return e.evaluate({...r,$feature:o},e.services)}catch(a){return K.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const J6=new Map;function wXe(e,t,r){const{transform:i,hasZ:s,hasM:n}=r;J6.has(t)||J6.set(t,xXe(t));const o=J6.get(t)(e.geometry,i,s,n);return{...e,geometry:o}}function xXe(e){const t={};switch(e){case"esriGeometryPoint":return(r,i,s,n)=>g0e(i,t,r,s,n);case"esriGeometryPolygon":return(r,i,s,n)=>y0e(i,t,r,s,n);case"esriGeometryPolyline":return(r,i,s,n)=>_0e(i,t,r,s,n);case"esriGeometryMultipoint":return(r,i,s,n)=>m0e(i,t,r,s,n);default:return K.getLogger("esri.views.2d.support.arcadeOnDemand").error(new G("mapview-arcade",`Unable to handle geometryType: ${e}`)),r=>r}}const Pmt=1.2,TXe=Up;class B4{constructor(t,r,i,s){this.graphics3DSymbolLayer=t,this.renderGeometries=r,this.boundingBox=i,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(t){this.stage=t.stage}setVisibility(t){if(this.stage!=null&&this._visible!==t){if(this._visible=t,t&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,Fi.ADD);if(t||this._addedToStage){for(const r of this.renderGeometries)r.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,hn.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,Fi.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(t=C()){return se(t,0,0,0)}getBoundingBoxObjectSpace(t=Qs()){return mi(t)}addObjectState(t,r){t===km.Highlight&&(this.renderGeometries.forEach(i=>{const s=i.geometry.addHighlight();r.addRenderGeometry(i,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,hn.HIGHLIGHT))}removeObjectState(t){this.renderGeometries.forEach(r=>{t.removeRenderGeometry(r)})}removeRenderGeometryObjectState(t,r){t.geometry.removeHighlight(r),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,hn.HIGHLIGHT)}computeAttachmentOrigin(t){for(const r of this.renderGeometries)r.geometry.computeAttachmentOrigin(Vb)&&(t.draped.origin[0]+=Vb[0],t.draped.origin[1]+=Vb[1],t.draped.num++)}async getProjectedBoundingBox(t,r,i,s,n){mi(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,t,xee,i),cMe(n,xee)}if(r){let o;td(n,Vb);const a=AH(n,r.service.spatialReference,r);try{o=await r.service.queryElevation(Vb[0],Vb[1],s,a,"ground")}catch{}o!=null&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(t,r,i,s){if(this.boundingBox)aN(zd,this.boundingBox);else{const n=t.boundingSphere,o=n[3];zd[0]=n[0]-o,zd[1]=n[1]-o,zd[2]=n[2]-o,zd[3]=n[0]+o,zd[4]=n[1]+o,zd[5]=n[2]+o}return r(zd,0,2),this.calculateRelativeScreenBounds&&s.push({location:td(zd),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),aG(zd,i)}}const xee=Nt(),zd=Qs(),Vb=C();class w_e{constructor(t,r,i,s=2048){this.text=t,this._alignment=r,this._parameters=i,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${t}`,this._lines=t.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._backgroundHorizontalPadding)}get displayHeight(){const t=this._lineSpacing*(this._lines.length-1),r=this._lineHeight;return Math.ceil(t+r+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}get _firstLineYOffset(){return this._backgroundTopPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const t=gB(Tee,uP,uP).getContext("2d");this._setFontProperties(t,this._fontSize);let r=2*this._haloSize;const i=this._parameters.definition.font;i.style!=="italic"&&i.style!=="oblique"&&i.weight!=="bold"&&i.weight!=="bolder"||(r+=.3*t.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s,n,o=0,a=0,l=0;this._lines.forEach((y,_)=>{const v=t.measureText(y),w=v.width,T=w+r;this._textWidths.push(w),this._lineWidths.push(T),o=Math.max(o,T),a=Math.max(a,v.actualBoundingBoxAscent),l=Math.max(l,v.actualBoundingBoxDescent),_===0&&(s=v),_===this._lines.length-1&&(n=v)});const c=t.font;let u=Eee.get(c);if(!u){const y=t.measureText(EXe);u=new AXe(y.actualBoundingBoxAscent,y.actualBoundingBoxDescent),Eee.set(c,u)}a=Math.max(a,u.actualBoundingBoxAscent),l=Math.max(l,u.actualBoundingBoxDescent);const d=a+l,p=this._hasBackground?s.actualBoundingBoxAscent:a,g=this._hasBackground?n.actualBoundingBoxDescent:l;this._metricsCached=new CXe(a-p,l-g,d,o,a)}return this._metricsCached}get _lineSpacing(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _lineHeight(){return this._metrics.lineHeight}get _linePadding(){return this._lineHeight*SXe}get _baselinePosition(){return this._metrics.baselinePosition}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _backgroundHorizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _backgroundVerticalPadding(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}get _backgroundTopPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingTop)}get _backgroundBottomPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingBottom)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const t=this._parameters.definition.pixelRatio;this._maxSize>0?this._renderPixelRatio=Math.min(t,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):this._renderPixelRatio=t}return this._renderPixelRatio}_getLineXOffset(t){switch(this._alignment){case ay.Left:return this._backgroundHorizontalPadding;case ay.Center:return(this.displayWidth-this._lineWidths[t])/2;case ay.Right:return this.displayWidth-this._backgroundHorizontalPadding-this._lineWidths[t]}}render(t,r=0,i=0){t.save();const s=r/=this.renderPixelRatio,n=i/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset;r+=o,i+=a+this._baselinePosition;const l=this._haloSize>0;l&&this._renderHalo(t,s,n,o,a),this._setFontProperties(t,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const u=this._lines[c],d=this._getLineXOffset(c);l&&(t.globalCompositeOperation="destination-out",t.fillStyle="rgb(0, 0, 0)",this._fillText(t,u,r+d,i),this._renderLineDecoration(t,r+d,i,this._textWidths[c])),t.globalCompositeOperation="source-over",t.fillStyle=this._parameters.textStyle,this._fillText(t,u,r+this._getLineXOffset(c),i),this._renderLineDecoration(t,r+d,i,this._textWidths[c]),i+=this._lineSpacing}if(Kr.TEXT_SHOW_BASELINE){t.strokeStyle=See,t.setLineDash([2,2]),t.lineWidth=1;let c=n+a;for(let u=0;u<this._lines.length;++u){const d=c+this._baselinePosition;this._drawLine(t,[s,d],[s+this.displayWidth,d]),c+=this._lineSpacing}}if(Kr.TEXT_SHOW_BORDER&&(t.strokeStyle=See,t.setLineDash([]),t.lineWidth=1,this._drawBox(t,[s,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(t,s,n,c),t.globalCompositeOperation="destination-over",t.fillStyle=this._parameters.backgroundStyle,t.fill()}t.restore()}_renderLineDecoration(t,r,i,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":i+=2*a;break;case"line-through":i-=.33*this._baselinePosition}const l=n?this._haloSize:0;t.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,t.lineWidth=this._toRenderUnit(a+2*l),t.beginPath(),t.moveTo(this._toRenderUnit(r-l),this._toRenderUnit(i)),t.lineTo(this._toRenderUnit(r+s+l),this._toRenderUnit(i)),t.stroke()}_roundedRect(t,r,i,s){r=this._toRenderUnit(r),i=this._toRenderUnit(i);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=fe(s,0,Math.floor(o/2)),t.beginPath(),t.moveTo(r,i+s),t.arcTo(r,i,r+s,i,s),t.lineTo(r+n-s,i),t.arcTo(r+n,i,r+n,i+s,s),t.lineTo(r+n,i+o-s),t.arcTo(r+n,i+o,r+n-s,i+o,s),t.lineTo(r+s,i+o),t.arcTo(r,i+o,r,i+o-s,s),t.closePath()):t.rect(r,i,n,o)}_renderHalo(t,r,i,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=gB(Tee,Math.max(o,uP),Math.max(a,uP)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const u=this._renderedHaloSize<3;c.lineJoin=u?"miter":"round",u?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let d=n+this._baselinePosition;for(let p=0;p<this._lines.length;++p){const g=this._getLineXOffset(p);this._renderLineDecoration(c,s+g,d,this._textWidths[p],!0),d+=this._lineSpacing}t.globalAlpha=this._parameters.definition.halo.color[3],t.drawImage(l,0,0,o,a,this._toRenderUnit(r),this._toRenderUnit(i),o,a),t.globalAlpha=1}_renderHaloEmulated(t,r,i){i+=this._baselinePosition;for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of x_e)this._fillText(t,n,r+o+this._haloSize*a,i+this._haloSize*l);i+=this._lineSpacing}}_renderHaloNative(t,r,i){const s=2*this._haloSize;i+=this._baselinePosition;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let u=0;u<l;u++){const d=1-(l-1)*c+u*c;t.lineWidth=this._toRenderUnit(d*s),this._strokeText(t,o,r+a,i)}i+=this._lineSpacing}}_setFontProperties(t,r){t.font=this._parameters.fontString(r),t.textAlign="left",t.textBaseline="alphabetic"}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(t){return t*this.renderPixelRatio}_toRoundedRenderUnit(t){return Math.round(t*this.renderPixelRatio)}_fillText(t,r,i,s){t.fillText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_strokeText(t,r,i,s){t.strokeText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_drawLine(t,r,i){t.beginPath(),t.moveTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),t.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),t.stroke()}_drawBox(t,r,i){const s=this._toRenderUnit(r[0]),n=this._toRenderUnit(r[1]),o=this._toRenderUnit(i[0]),a=this._toRenderUnit(i[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,u=Math.floor(n)+.5,d=Math.ceil(n+a)-.5;t.beginPath(),t.moveTo(l,u),t.lineTo(c,u),t.lineTo(c,d),t.lineTo(l,d),t.lineTo(l,u),t.stroke()}}const x_e=[];for(let t=0;t<360;t+=360/16)x_e.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)]);var ay;function gB(e,t,r){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=r,e.canvas}(function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right"})(ay||(ay={}));const Tee={canvas:null},SXe=.2,uP=512,See="rgb(255, 0, 255, 0.5)",EXe=(()=>{let e="";for(let t=32;t<127;t++)e+=String.fromCharCode(t);return e})();class CXe{constructor(t,r,i,s,n){this.paddingTop=t,this.paddingBottom=r,this.lineHeight=i,this.displayWidth=s,this.baselinePosition=n}}class AXe{constructor(t,r){this.actualBoundingBoxAscent=t,this.actualBoundingBoxDescent=r}}const Eee=new Map,OXe=Object.freeze({left:0,center:.5,right:1}),wI=Object.freeze({"bottom-left":or(0,0),bottom:or(.5,0),"bottom-right":or(1,0),left:or(0,.5),center:or(.5,.5),right:or(1,.5),"top-left":or(0,1),top:or(.5,1),"top-right":or(1,1)});function T_e(e){switch(e){case"left":return ay.Left;case"right":return ay.Right;default:return ay.Center}}function Cee(e){switch(e){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function RXe(e){switch(e){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function PXe(e,t){switch(t){case"bottom":return e==="left"?"bottom-left":e==="right"?"bottom-right":"bottom";case"center":return e;case"top":return e==="left"?"top-left":e==="right"?"top-right":"top"}}function MXe(e){return e==="middle"?"center":e}class YT{constructor(t,r={}){this.geometry=t,this.screenToWorldRatio=1,this._transformation=be(),this._shaderTransformation=null,this._boundingSphere=null,this.id=Nl(),this.layerUid=r.layerUid,this.graphicUid=r.graphicUid,this.shaderTransformer=r.shaderTransformer,this.castShadow=r.castShadow??!1}get transformation(){return this._transformation}get boundingInfo(){return this.geometry.boundingInfo}updateTransformation(t){t(this._transformation),this._shaderTransformation=this._boundingSphere=null}shaderTransformationChanged(){this._shaderTransformation=null}get boundingSphere(){return this._boundingSphere?this._boundingSphere:this.boundingInfo?(this._boundingSphere=Ue(ls(),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*_T(this.shaderTransformation),this._boundingSphere):Mde}get hasShaderTransformation(){return this.shaderTransformer!=null}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this.shaderTransformer==null?this.transformation:(this._shaderTransformation||(this._shaderTransformation=Ss(be(),this.shaderTransformer(this.transformation))),this._shaderTransformation)}get indices(){return this.geometry.indices}get vertexAttributes(){return this.geometry.vertexAttributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(t){this.geometry.visible=t}}const IXe=be(),Aee=Ce(0,0,1),$Xe=16,LXe=1.5,Dv=_H,DXe=[Dv/2,Dv/2,1-Dv/2,1-Dv/2],NXe=[ZA*Dv,ZA*Dv];class s3 extends ff{getCachedSize(){return{size:this._getIconSize()}}constructor(t,r,i,s){super(t,r,i,s),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(t){this._validateOrThrow();const r=this._prepareMaterialParameters(),i=this._getPrimitive();if(i!=null)this._prepareResourcesPrimitive(r,i);else{const s=lXe(this.symbolLayer),n=n1(s);n&&n.mediaType==="application/json"?await this._prepareResourcesCIM(r,JSON.parse(n.data),t):await this._prepareResourcesHref(r,s,t)}}_validateOrThrow(){if(this._drivenProperties.size)return;const t=m4(this._getIconSize());if(t)throw new G("graphics3diconsymbollayer:invalid-size",t)}_getIconSize(){const t=this.symbolLayer,r=Math.round(t.size!=null?Ho(t.size):$Xe);return this._drivenProperties.size?Math.max(r,64):r}_generateTextureCIM(t){const r=this._getGraphicHash(t);let i=r===""?null:this._cimSymbolTextures.get(r);if(!i){const s={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,t,"esriGeometryPoint",s,void 0,void 0);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",n.anchorPosition);const o={width:n.imageData.width,height:n.imageData.height};i=new lb(n.imageData,o),this._cimSymbolTextures.set(r,i),this._context.stage.add(i)}return i}_prepareMaterialParameters(){const t={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},r=this.symbol;if(FXe(r)){const{screenLength:i,minWorldLength:s,maxWorldLength:n}=r.verticalOffset;t.verticalOffset={screenLength:Ho(i),minWorldLength:s||0,maxWorldLength:n??1/0}}return this._context.screenSizePerspectiveEnabled&&(t.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),t.occlusionTest=!0,t.hasSlicePlane=this._context.slicePlaneEnabled,t}_prepareResourcesPrimitive(t,r){const i=this._getOutlineSize();if(K6(r)&&i===0)throw new Error("Nothing to render");if(this._outlineSize=i,t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize,this._context.sharedResources.textures!=null){const n=this._context.sharedResources.textures.fromData(`${r}-icon`,()=>tVe(r));this._texture=n.texture,this._releaseTexture=n,t.textureId=this._texture.id}t.textureIsSignedDistanceField=!0,t.distanceFieldBoundingBox=DXe;const s=this._getIconSize();this._size=[s,s],this._symbolTextureRatio=1/Dv,this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesHref(t,r,i){this._outlineSize=this._getOutlineSize(),t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize,t.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(this._context.sharedResources.textures!=null){const o=await Yu(this._context.sharedResources.textures.fromUrl(r,n,{signal:i}));if(o.ok===!1)throw W1(o.error),new G("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${r})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.parameters.width/a.parameters.height;this._size=l>1?[s,Math.round(s/l)]:[Math.round(s*l),s],t.textureId=a.id}this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesCIM(t,r,i){const s=new L3({data:r});if(!this._context.sharedResources.cimSymbolRasterizer){const u=(await ue(()=>import("./CIMSymbolRasterizer.e9561f43.js"),["assets/CIMSymbolRasterizer.e9561f43.js","assets/cimAnalyzer.067ae81b.js","assets/BidiEngine.725a17e4.js","assets/TileClipper.f7503fb7.js","assets/definitions.c3f2bf92.js","assets/number.bbe84298.js","assets/imageutils.ac822326.js","assets/rasterizingUtils.53560362.js"])).CIMSymbolRasterizer;Jt(i),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new u(this._context.renderCoordsHelper.spatialReference,!0))}const n=this._context.layer.fields?this._context.layer.fields.map(u=>u.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol3D(s,n,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:i}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const u=this._context.renderer;if(isNaN(u.scaleExpression)){const d=u.scaleExpression,p=await QRe(d,this._context.layer.spatialReference,n);a=(g,y,_)=>{const v=bXe(p,g,{$view:_},"esriGeometryPoint",y);return v!==null?v:1}}else o=Number(u.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];Jt(i);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(u=>c.get(u).name),this._cimMaterialParametersInfo=t,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||RMe}_getOutlineSize(){let t=0;const r=this.symbolLayer;return r.outline!=null&&r.outline.size!=null?Math.max(Ho(r.outline.size),0):(t=K6(this._getPrimitive())?LXe:0,Math.max(t,0))}_getOutlineColor(){const t=this._getLayerOpacity(),r=this.symbolLayer,i=r?.outline?.color;if(i!=null){const s=ot.toUnitRGB(i),n=i.a*t;return[s[0],s[1],s[2],n]}return[0,0,0,0]}_getFillColor(){if(K6(this._getPrimitive()))return TXe;const t=this._getPrimitive()==null,r=this.symbolLayer?.material?.color;return this._getCombinedOpacityAndColor(r,{hasIntrinsicColor:t})}_getAnchorPos(t,r){return t==="relative"?or((r.x||0)+.5,.5-(r.y||0)):t in wI?wI[t]:wI.center}_createMaterialAndAddToStage(t,r){if(this._cimLayers){this._fastUpdates=null;let i=t.textureId?this._cimSymbolMaterials.get(t.textureId):null;return i||(i=new HT(t),this._cimSymbolMaterials.set(t.textureId??0,i),r.add(i)),i}return this._fastUpdates=GT(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(t={...t,...this._fastUpdates.materialParameters}),this._material=new HT(t),r.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(t=>{t.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(t=>this._context.stage.remove(t)),this._cimSymbolTextures.clear(),this._releaseTexture=Mi(this._releaseTexture)}_getScaleFactor(t,r){if(this._drivenProperties.size&&t.size){for(let i=0;i<3;i++){const s=t.size[i];s&&s!=="symbol-value"&&s!=="proportional"&&(t.size[i]=Ho(s))}if(t.size[0]==="symbol-value")return 1;if(isFinite(+t.size[0]))return+t.size[0]/r;if(isFinite(+t.size[2]))return+t.size[2]/r}return 1}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry))return null;let i,s=[0,0];if(this._cimLayers){if(!this._cimLayers.length)return null;const d=this._generateTextureCIM(r),p={textureId:d.id,...this._cimMaterialParametersInfo};i=this._createMaterialAndAddToStage(p,this._context.stage),s=[d.parameters.width,d.parameters.height]}else s=this._size,i=this._material;const n=JA(r.geometry);if(n==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const o=t.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates?.visualVariables.size){const d=s[0]>s[1]?s[0]:s[1];l=this._getScaleFactor(o,d)}l*=this._symbolTextureRatio;const c=or(s[0]*l,s[1]*l),u=this.setGraphicElevationContext(r,new Vc);return this.ensureDrapedStatus(u.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(r,n,i,a,c,t.layer.uid):this._createAs3DShape(r,n,i,a,c,u,r.uid)}layerOpacityChanged(){const t=this._getFillColor(),r=this._getOutlineColor();this._forEachMaterial(i=>{i.setParameters({color:t}),i.setParameters({outlineColor:r})})}layerElevationInfoChanged(t,r,i){const s=this._elevationContext.mode,n=tO(s3.elevationModeChangeTypes,i,s);if(n!==Qi.UPDATE)return n;const o=th(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(t,r,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(t=>{t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return this._getPrimitive()!=null}applyRendererDiff(t,r){for(const i in t.diff){if(i!=="visualVariables"||!jT(this._fastUpdates,r,this._fastVisualVariableConvertOptions()))return xs.RecreateSymbol;this._material!=null&&this._material.setParameters(this._fastUpdates.materialParameters)}return xs.FastUpdate}_defaultElevationInfoNoZ(){return UXe}_createAs3DShape(t,r,i,s,n,o,a){const l=this.getFastUpdateAttrValues(t),c=l&&this._fastUpdates?_=>Kz(this._fastUpdates.materialParameters,l,_):void 0,u=this._context.layer.uid,d=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:u}),p=Ez(i,Aee,null,s,n,kXe,null,l,d),g=$H(this._context,r,p,o,a,c);if(g==null)return null;const y=new pf(this,g.object,[p],null,null,Wv,o);return y.alignedSampledElevation=g.sampledElevation,y.needsElevationUpdates=th(o.mode)||o.mode==="absolute-height",y.getScreenSize=this._createScreenSizeGetter(n,c),y.calculateRelativeScreenBounds=_=>i.calculateRelativeScreenBounds(y.getScreenSize(),1,_),YA(y,r,this._context.elevationProvider),y}_createAsOverlay(t,r,i,s,n,o){i.renderPriority=this._renderPriority;const a=Ht();no(r,a,this._context.overlaySR),a[2]=rW;const l=this._context.clippingExtent;if(l!=null&&!oG(l,a))return null;const c=this.getFastUpdateAttrValues(t),u=c&&this._fastUpdates?_=>Kz(this._fastUpdates.materialParameters,c,_):void 0,d=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:t.uid,layerUid:this._context.layer.uid}),p=Ez(i,Aee,a,s,n,null,null,c,d),g=new YT(p,{layerUid:o,graphicUid:t.uid,shaderTransformer:u}),y=new B4(this,[g],null,this._context.drapeSourceRenderer);return y.getScreenSize=this._createScreenSizeGetter(n,u),y.calculateRelativeScreenBounds=_=>i.calculateRelativeScreenBounds(y.getScreenSize(),1,_),y}_createScreenSizeGetter(t,r){const i=this._outlineSize+2;if(this._fastUpdates&&r){const s=t[0]/this._symbolTextureRatio,n=t[1]/this._symbolTextureRatio;return(o=Ne())=>{const a=r(IXe);return o[0]=a[0]*s+i,o[1]=a[5]*n+i,o}}{const s=t[0]/this._symbolTextureRatio+i,n=t[1]/this._symbolTextureRatio+i;return(o=Ne())=>(o[0]=s,o[1]=n,o)}}_fastVisualVariableConvertOptions(){const t=Math.max(this._size[0],this._size[1]),r=Ce(t,t,t),i=_d(1),s=t*i,n=Ce(s,s,s);return new Q3({size:!0,color:!0,rotation:!0,opacity:!1},r,n,i)}_getGraphicHash(t){let r="";for(const i of this._cimRequiredFields)r+=i+t.attributes[i];return r}_forEachMaterial(t){this._material!=null&&t(this._material),this._cimSymbolMaterials.forEach(t)}test(){return{...super.test(),material:this._material}}}function FXe(e){return e&&e.type==="point-3d"&&e.hasVisibleVerticalOffset()}function K6(e){return e!=null&&(e==="cross"||e==="x")}s3.PRIMITIVE_SIZE=NXe,s3.elevationModeChangeTypes={definedChanged:Qi.UPDATE,staysOnTheGround:Qi.NONE,onTheGroundChanged:Qi.RECREATE};const UXe={mode:"relative-to-ground",offset:0},kXe=At(0,0,0,1);function yB(e){switch(e){case"butt":return Gu.BUTT;case"square":return Gu.SQUARE;case"round":return Gu.ROUND;default:return null}}function Oee(e){return e==="diamond"?"kite":e}function _B(e,t,r=null){const i=[],s=[],n=t.mapPositions;zXe(t,s,i);const o=s[0][1].data,a=i[0][1].length,l=T2(a);return BXe(t,s,i,l),jXe(t,s,i,l),VXe(t,s,i,l),GXe(t,s,i,l),HXe(t,s,i,l),WXe(t,s,i,l),qXe(t,s,i,o),new Cs(e,s,i,n,Ki.Line,r)}function zXe(e,t,r){const{attributeData:{position:i},removeDuplicateStartEnd:s}=e,n=XXe(i)&&s,o=i.length/3-(n?1:0),a=new Array(2*(o-1)),l=n?i.slice(0,i.length-3):i;let c=0;for(let u=0;u<o-1;u++)a[c++]=u,a[c++]=u+1;t.push([E.POSITION,new Fe(l,3,n)]),r.push([E.POSITION,a])}function BXe(e,t,r,i){if(e.attributeData.colorFeature!=null)return;const s=e.attributeData.color;t.push([E.COLOR,new Fe(s??Mu,4)]),r.push([E.COLOR,i])}function VXe(e,t,r,i){if(e.attributeData.normal==null)return;const s=e.attributeData.normal;t.push([E.NORMAL,new Fe(s,3)]),r.push([E.NORMAL,i])}function GXe(e,t,r,i){e.attributeData.colorFeature!=null&&(t.push([E.COLORFEATUREATTRIBUTE,new Fe([e.attributeData.colorFeature],1,!0)]),r.push([E.COLOR,i]))}function jXe(e,t,r,i){e.attributeData.sizeFeature==null&&(t.push([E.SIZE,new Fe([e.attributeData.size??1],1,!0)]),r.push([E.SIZE,i]))}function HXe(e,t,r,i){e.attributeData.sizeFeature!=null&&(t.push([E.SIZEFEATUREATTRIBUTE,new Fe([e.attributeData.sizeFeature],1,!0)]),r.push([E.SIZEFEATUREATTRIBUTE,i]))}function WXe(e,t,r,i){const s=e.attributeData.opacityFeature;s!=null&&(t.push([E.OPACITYFEATUREATTRIBUTE,new Fe([s],1,!0)]),r.push([E.OPACITYFEATUREATTRIBUTE,i]))}function qXe(e,t,r,i){if(e.overlayInfo==null||e.overlayInfo.renderCoordsHelper.viewingMode!==Ie.Global||!e.overlayInfo.spatialReference.isGeographic)return;const s=To(i.length),n=Mr(e.overlayInfo.spatialReference);for(let p=0;p<s.length;p+=3)xN(i,p,s,p,n);const o=i.length/3,a=Vi(o+1);let l=ZXe,c=YXe,u=0,d=0;se(l,s[d++],s[d++],s[d++]),a[0]=0;for(let p=1;p<o+1;++p)p===o&&(d=0),se(c,s[d++],s[d++],s[d++]),u+=Hpe(l,c),a[p]=u,[l,c]=[c,l];t.push([E.DISTANCETOSTART,new Fe(a,1,!0)]),r.push([E.DISTANCETOSTART,r[0][1]])}function XXe(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}const ZXe=C(),YXe=C();function Mmt(e,t){if(e==null||e.length===0)return[];const r=[];return e.forEach(i=>{const s=i.length,n=To(3*s);i.forEach((a,l)=>{n[3*l]=a[0],n[3*l+1]=a[1],n[3*l+2]=a[2]});const o={attributeData:{position:n,normal:t},removeDuplicateStartEnd:!1};r.push(o)}),r}function JXe(e,t,r,i){const s=e.type==="polygon"?Qp.CCW_IS_HOLE:Qp.NONE,n=e.type==="polygon"?e.rings:e.paths,{position:o,outlines:a}=sO(n,!!e.hasZ,s),l=To(o.length),c=M0e(o,e.spatialReference,0,l,0,o,0,o.length/3,t,r,i),u=c!=null;return{lines:u?S_e(a,o,l):[],projectionSuccess:u,sampledElevation:c}}function KXe(e,t){const r=e.type==="polygon"?Qp.CCW_IS_HOLE:Qp.NONE,i=e.type==="polygon"?e.rings:e.paths,{position:s,outlines:n}=sO(i,!1,r),o=ji(s,e.spatialReference,0,s,t,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=rW;return{lines:o?S_e(n,s):[],projectionSuccess:o}}function S_e(e,t,r=null){const i=new Array;for(const{index:s,count:n}of e){if(n<=1)continue;const o=3*s,a=3*n;i.push({position:Bu(t,3*s,3*n),mapPositions:r!=null?Bu(r,o,a):void 0})}return i}function QXe(e){const t=new pr,r=e.hasMultipassTerrain&&(e.output===D.Color||e.output===D.Alpha),i=e.space===Mc.World;t.include(Eye,e),t.include(Iye,e),e.output===D.Depth&&t.include(jm,e);const{vertex:s,fragment:n}=t;return n.include(Hl),Fl(s,e),t.attributes.add(E.POSITION,"vec3"),t.attributes.add(E.UV0,"vec2"),t.attributes.add(E.AUXPOS1,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vUV","vec2"),t.varyings.add("vSize","float"),by(t),r&&t.varyings.add("depth","float"),e.hasTip&&t.varyings.add("vLineWidth","float"),s.uniforms.add(new yr("nearFar",(o,a)=>a.camera.nearFar),new Zt("viewport",(o,a)=>a.camera.fullViewport)),s.code.add(b`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),s.code.add(b`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),i?(t.attributes.add(E.NORMAL,"vec3"),zT(s),s.constants.add("tiltThreshold","float",.7),s.code.add(b`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):s.code.add(b`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),s.code.add(b`
      #define vecN ${i?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${i?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${e.anchor===U1.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),e.space===Mc.Screen&&(s.uniforms.add(new Ci("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),s.code.add(b`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),s.code.add(b`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),s.uniforms.add(new Ae("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),s.code.add(b`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${e.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),R2(s,e),GN(t),s.code.add(b`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`),i?(e.hideOnShortSegments&&s.code.add(b`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),s.code.add(b`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(s.code.add(b`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),e.space===Mc.Screen&&s.code.add(b`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),s.code.add(b`
        ${r?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${i?"":"vUV *= displacedPosScreen.w;"}

        ${e.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),r&&t.include(kc,e),t.include(os,e),n.uniforms.add(new Zt("intrinsicColor",o=>o.color),new qe("tex",o=>o.markerTexture)),n.include(df),t.constants.add("texelSize","float",1/Xv),n.code.add(b`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),e.hasTip&&(t.constants.add("relativeMarkerSize","float",jH/Xv),t.constants.add("relativeTipLineWidth","float",hHe),n.code.add(b`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${i?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),t.constants.add("symbolAlphaCutoff","float",to),n.code.add(b`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${i?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${e.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${e.output===D.ObjectAndLayerIdColor?b`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${e.output===D.Alpha?b`fragColor = vec4(finalColor.a);`:""}
    ${e.output===D.Color?b`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===D.Color&&e.transparencyPassType===tt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${e.output===D.Highlight?b`fragColor = vec4(1.0);`:""}
    ${e.output===D.Depth?b`outputDepth(linearDepth);`:""}
  }
  `),t}const eZe=Object.freeze(Object.defineProperty({__proto__:null,build:QXe},Symbol.toStringTag,{value:"Module"})),E_e=new Map([[E.POSITION,0],[E.UV0,2],[E.AUXPOS1,3],[E.NORMAL,4],[E.COLOR,5],[E.COLORFEATUREATTRIBUTE,5],[E.SIZE,6],[E.SIZEFEATUREATTRIBUTE,6],[E.OPACITYFEATUREATTRIBUTE,7]]);class V4 extends xr{initializeProgram(t){return new vr(t.rctx,V4.shader.get().build(this.configuration),E_e)}_makePipelineState(t,r){const i=this.configuration,s=t===tt.NONE;return Tt({blending:i.output===D.Color||i.output===D.Alpha?s?Pc:sg(t):null,depthTest:{func:Uy(t)},depthWrite:s?i.writeDepth?Ka:null:c4(t),colorWrite:It,stencilWrite:i.hasOccludees?ef:null,stencilTest:i.hasOccludees?r?My:ky:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Tt({blending:Pc,depthTest:XL,depthWrite:null,colorWrite:It,stencilWrite:null,stencilTest:Dye}),this._occluderPipelineOpaque=Tt({blending:Pc,depthTest:XL,depthWrite:null,colorWrite:It,stencilWrite:$ye,stencilTest:Lye}),this._occluderPipelineMaskWrite=Tt({blending:null,depthTest:HH,depthWrite:null,colorWrite:null,stencilWrite:ef,stencilTest:My})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,r){return r?this._occludeePipelineState:this.configuration.occluder?t===ae.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===ae.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,r)}}V4.shader=new _r(eZe,()=>ue(()=>import("./LineMarker.glsl.582b25bc.js"),[]));class tZe extends Fy{constructor(t){super(t,new iZe),this._vertexAttributeLocations=E_e,this._configuration=new Yn,this._layout=this.createLayout()}dispose(){}getConfiguration(t,r){return this._configuration.output=t,this._configuration.space=r.slot===ae.DRAPED_MATERIAL?Mc.Draped:this.parameters.worldSpace?Mc.World:Mc.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==Gu.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===Ei.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const t=Li().vec3f(E.POSITION).vec2f(E.UV0).vec3f(E.AUXPOS1);return this.parameters.worldSpace&&t.vec3f(E.NORMAL),this.parameters.vvSize?t.f32(E.SIZEFEATUREATTRIBUTE):t.f32(E.SIZE),this.parameters.vvColor?t.f32(E.COLORFEATUREATTRIBUTE):t.vec4f(E.COLOR),this.parameters.vvOpacity&&t.f32(E.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new sZe(this._layout,this.parameters)}requiresSlot(t,r){return r===D.Color||r===D.Alpha||r===D.Highlight||r===D.Depth?t===ae.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Ei.OccludeAndTransparentStencil?t===ae.OPAQUE_MATERIAL||t===ae.OCCLUDER_MATERIAL||t===ae.TRANSPARENT_OCCLUDER_MATERIAL:r===D.Color||r===D.Alpha?t===(this.parameters.writeDepth?ae.TRANSPARENT_MATERIAL:ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===ae.OPAQUE_MATERIAL:!1}createGLMaterial(t){return new rZe(t)}}class rZe extends pj{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextureRepository.release(this._markerPrimitive),this._markerPrimitive=null}_updateParameters(t){const r=this._material.parameters.markerPrimitive;return r!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextureRepository.swap(r,this._markerPrimitive)}),this._markerPrimitive=r),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(V4,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==D.Color&&this._output!==D.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class iZe extends eO{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=Gu.BUTT,this.anchor=U1.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1,this.markerTexture=null}}class sZe{constructor(t,r){this.vertexBufferLayout=t,this._parameters=r}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(t,r,i,s,n){const o=i.vertexAttributes.get(E.POSITION).data,a=o.length/3;let l=[1,0,0];const c=i.vertexAttributes.get(E.NORMAL);this._parameters.worldSpace&&c!=null&&(l=c.data);let u=1,d=0;this._parameters.vvSize?d=i.vertexAttributes.get(E.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(E.SIZE)&&(u=i.vertexAttributes.get(E.SIZE).data[0]);let p=[1,1,1,1],g=0;this._parameters.vvColor?g=i.vertexAttributes.get(E.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(E.COLOR)&&(p=i.vertexAttributes.get(E.COLOR).data);let y=0;this._parameters.vvOpacity&&(y=i.vertexAttributes.get(E.OPACITYFEATUREATTRIBUTE).data[0]);const _=new Float32Array(s.buffer);let v=n*(this.vertexBufferLayout.stride/4);const w=(O,A,$,P)=>{if(_[v++]=O[0],_[v++]=O[1],_[v++]=O[2],_[v++]=$[0],_[v++]=$[1],_[v++]=A[0],_[v++]=A[1],_[v++]=A[2],this._parameters.worldSpace&&(_[v++]=l[0],_[v++]=l[1],_[v++]=l[2]),this._parameters.vvSize?_[v++]=d:_[v++]=u,this._parameters.vvColor)_[v++]=g;else{const U=Math.min(4*P,p.length-4);_[v++]=p[U],_[v++]=p[U+1],_[v++]=p[U+2],_[v++]=p[U+3]}this._parameters.vvOpacity&&(_[v++]=y)};let T;(function(O){O[O.ASCENDING=1]="ASCENDING",O[O.DESCENDING=-1]="DESCENDING"})(T||(T={}));const x=(O,A)=>{const $=se(nZe,o[3*O],o[3*O+1],o[3*O+2]),P=oZe;let U=O+A;do se(P,o[3*U],o[3*U+1],o[3*U+2]),U+=A;while(ly($,P)&&U>=0&&U<a);t&&(Ue($,$,t),Ue(P,P,t)),w($,P,[-1,-1],O),w($,P,[1,-1],O),w($,P,[1,1],O),w($,P,[-1,-1],O),w($,P,[1,1],O),w($,P,[-1,1],O)},S=this._parameters.placement;S!=="begin"&&S!=="begin-end"||x(0,T.ASCENDING),S!=="end"&&S!=="begin-end"||x(a-1,T.DESCENDING)}}const nZe=C(),oZe=C(),Po={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},aZe={dash:Po.dash,"dash-dot":[...Po.dash,...Po.dot],dot:Po.dot,"long-dash":Po["long-dash"],"long-dash-dot":[...Po["long-dash"],...Po.dot],"long-dash-dot-dot":[...Po["long-dash"],...Po.dot,...Po.dot],none:null,"short-dash":Po["short-dash"],"short-dash-dot":[...Po["short-dash"],...Po["short-dot"]],"short-dash-dot-dot":[...Po["short-dash"],...Po["short-dot"],...Po["short-dot"]],"short-dot":Po["short-dot"],solid:null},lZe=8;function cZe(e,t){return e==null?e:{pattern:e.slice(),pixelRatio:t}}function Imt(e){return{pattern:[e,e],pixelRatio:2}}function C_e(e){return e!=null&&e.type==="style"?uZe(e.style):null}function uZe(e){return e!=null?cZe(aZe[e],lZe):null}const hZe=["polyline","polygon","extent"],Ree=new Q3({size:!0,color:!0,rotation:!1,opacity:!0});class G4 extends ff{constructor(t,r,i,s){super(t,r,i,s)}async doLoad(){if(this._fastUpdates=GT(this._context.renderer,Ree),!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:_d(1))<0)throw new G("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(t,r=!1){const i=this._getCombinedOpacityAndColor(r&&this._markerColor||this._materialColor);this._patternHidesLine&&!r&&(i[3]=0);const s={width:this._computeMaterialWidth(this.symbolLayer?.size),color:i,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:yB(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:t,stipplePattern:C_e(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates?.visualVariables?{...s,...this._fastUpdates.materialParameters}:s}get _materialColor(){return this.symbolLayer.material?.color}get _markerColor(){return this.symbolLayer.marker?.color}get _lineMaterial(){return this._lineMaterialCached==null&&(this._lineMaterialCached=new mx(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached)),this._lineMaterialCached}get _ringMaterial(){return this._ringMaterialCached==null&&(this._ringMaterialCached=new mx(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached)),this._ringMaterialCached}get _wireframeLineMaterial(){return this._wireframeLineMaterialCached==null&&(this._wireframeLineMaterialCached=new mx({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterialCached)),this._wireframeLineMaterialCached}get _wireframeRingMaterial(){return this._wireframeRingMaterialCached==null&&(this._wireframeRingMaterialCached=new mx({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterialCached)),this._wireframeRingMaterialCached}get _markerMaterial(){return this._markerMaterialCached==null&&this.symbolLayer.marker!=null&&(this._markerMaterialCached=new tZe({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:Oee(this.symbolLayer.marker.style)}),this._context.stage.add(this._markerMaterialCached)),this._markerMaterialCached}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._lineMaterialCached=null,this._ringMaterialCached=null,this._wireframeLineMaterialCached=null,this._wireframeRingMaterialCached=null,this._markerMaterialCached=null}_getDrivenSize(t){return this._drivenProperties.size&&t.size?Ho(Dje(t.size)):1}_getDrivenColor(t){const r=At(1,1,1,1);return this._drivenProperties.color&&t.color&&(r[0]=t.color[0],r[1]=t.color[1],r[2]=t.color[2],t.color.length>0&&(r[3]=t.color[3])),this._drivenProperties.opacity&&t.opacity&&(r[3]=t.opacity),r}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,hZe,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new Vc);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.draped?this._createAsOverlay(t,this._context.layer.uid):this._createAs3DShape(t,i,r.uid)}applyRendererDiff(t,r){for(const i in t.diff){if(i!=="visualVariables")return xs.RecreateSymbol;{const s=this._fastUpdates;if(!jT(s,r,Ree))return xs.RecreateSymbol;this._forEachMaterial(n=>n.setParameters(s.materialParameters))}}return xs.FastUpdate}prepareSymbolLayerPatch(t){if(t.diff.type!=="partial")return;const r=t.diff.diff,i={};r.size?.type==="complete"&&(i.width=this._computeMaterialWidth(r.size.newValue),delete r.size),r.cap?.type==="complete"&&(i.cap=yB(r.cap.newValue??"butt"),delete r.cap);const s=this._prepareMarkerPatch(t,r);this._prepareMaterialPatch(t,r,s),t.symbolLayerStatePatches.push(()=>this._forEachMaterial(n=>n.setParameters(i)))}layerOpacityChanged(){this._forEachMaterial((t,r)=>this._updateMaterialLayerOpacity(t,r))}_forEachMaterial(t){this._lineMaterialCached!=null&&t(this._lineMaterialCached),this._ringMaterialCached!=null&&t(this._ringMaterialCached),this._wireframeLineMaterialCached!=null&&t(this._wireframeLineMaterialCached),this._wireframeRingMaterialCached!=null&&t(this._wireframeRingMaterialCached),this._markerMaterialCached!=null&&t(this._markerMaterialCached,!0)}_updateMaterialLayerOpacity(t,r=!1){const i=t.parameters.color,s=this.symbolLayer?.material?.color,n=this._patternHidesLine&&!r?0:this._getCombinedOpacity(s),o=At(i[0],i[1],i[2],n);t.setParameters({color:o})}layerElevationInfoChanged(t,r,i){const s=this._elevationContext.mode,n=tO(G4.elevationModeChangeTypes,i,s);if(n!==Qi.UPDATE)return n;const o=th(s);return this.updateGraphics3DGraphicElevationInfo(t,r,()=>o)}slicePlaneEnabledChanged(){const t={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(r=>r.setParameters(t)),!0}physicalBasedRenderingChanged(){return!0}_getGeometryAsPolygonOrPolyline(t){switch(t.type){case"extent":if(t instanceof Pr)return J1.fromExtent(t);break;case"polygon":case"polyline":return t}return null}_createAs3DShape(t,r,i){const s=t.graphic,n=this._getGeometryAsPolygonOrPolyline(s.geometry),o=n.type==="polygon"?n.rings:n.paths,a=new Array,l=Qs(),c=JXe(n,this._context.elevationProvider,this._context.renderCoordsHelper,r),u=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(c,o,u,"LineSymbol3DLayer");for(let g=0;g<c.lines.length;g++){const y=c.lines[g],_=y.position,v=y.mapPositions;if(this._context.clippingExtent!=null&&(mi(l),Tc(l,v),!rd(l,this._context.clippingExtent)))continue;const w=this._createGeometry(n.type==="polygon"?this._ringMaterial:this._lineMaterial,t,_,v,n.type,UC.ELEVATED,i);a.push(w),Kr.LINE_WIREFRAMES&&a.push(w.instantiate({material:n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),this._markerMaterial!=null&&a.push(w.instantiate({material:this._markerMaterial}))}if(a.length===0)return null;const d=new ng({geometries:a,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),p=new pf(this,d,a,null,null,eGe,r);return p.alignedSampledElevation=c.sampledElevation,p.needsElevationUpdates=th(r.mode),p}_createGeometry(t,r,i,s,n,o,a){const l=o===UC.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,c=n==="polygon",u=this._fastUpdates?.visualVariables.color,d=this._fastUpdates?.visualVariables.size,p=this._fastUpdates?.visualVariables.opacity,g=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid}),y={position:i,size:d?null:this._getDrivenSize(r.renderingInfo),color:u?null:this._getDrivenColor(r.renderingInfo),sizeFeature:d?pd(d.field,r.graphic):null,colorFeature:u?pd(u.field,r.graphic):null,opacityFeature:p?pd(p.field,r.graphic):null};return _B(t,{overlayInfo:l,removeDuplicateStartEnd:c,mapPositions:s,attributeData:y},g)}_createAsOverlay(t,r){const i=t.graphic,s=this._getGeometryAsPolygonOrPolyline(i.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=Kr.LINE_WIREFRAMES?s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;a!=null&&(a.renderPriority=this._renderPriority-.001),l!=null&&(l.renderPriority=this._renderPriority-.002);const c=new Array,u=Qs(),d=mi(),p=KXe(s,this._context.overlaySR),g=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(p,n,g,"LineSymbol3DLayer");for(const y of p.lines){if(mi(u),Tc(u,y.position),!rd(u,this._context.clippingExtent))continue;hT(d,u);const _=v=>{const w=this._createGeometry(v,t,y.position,void 0,s.type,UC.DRAPED,i.uid),T=new YT(w,{layerUid:r,graphicUid:i.uid});c.push(T)};if(l!=null){_(l);const v=this.symbolLayer.marker.placement;v!=="begin"&&v!=="begin-end"||Tc(u,y.position,0,1),v!=="end"&&v!=="begin-end"||Tc(u,y.position,y.position.length-3,1)}_(o),Kr.LINE_WIREFRAMES&&_(a)}return new B4(this,c,d,this._context.drapeSourceRenderer)}get _patternHidesLine(){const t=this.symbolLayer.pattern;return t!=null&&t.type==="style"&&t.style==="none"}_computeMaterialWidth(t){return t=t??_d(1),this._drivenProperties.size?this._fastUpdates?.visualVariables.size?Ho(1):1:Ho(t)}_prepareMaterialPatch(t,r,i){const s=r.material;if(s==null)return void(i.changed&&i.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterialCached,t));if(s.type==="collection")return;const n=s.type==="complete"?s.newValue?.color:s.diff.color?.type==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);i.useMaterialColor&&this._patchMaterialColor(z3(o),this._markerMaterialCached,t),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterialCached,t),delete r.material}_prepareMarkerPatch(t,r){const i=r.marker,s=this._markerMaterial;if(i==null||i.type!=="partial"||i.diff==null||i.diff.placement!=null||i.diff.style!=null&&i.diff.style.type!=="complete"||i.diff.color!=null&&i.diff.color.type!=="complete"||s==null)return{changed:!1,useMaterialColor:this._markerColor==null};const n=i.diff.color,o=n!=null,a=o?n.newValue:null,l=a==null&&this._markerColor==null;a&&this._patchMaterialColor(this._getCombinedOpacityAndColor(a),s,t);const c=i.diff.style?.newValue;return c&&t.symbolLayerStatePatches.push(()=>s.setParameters({markerPrimitive:Oee(c)})),delete r.marker,{changed:o,useMaterialColor:l}}_patchMaterialColor(t,r,i){r!=null&&i.symbolLayerStatePatches.push(()=>r.setParameters({color:t}))}}var UC;G4.elevationModeChangeTypes={definedChanged:Qi.RECREATE,staysOnTheGround:Qi.NONE,onTheGroundChanged:Qi.RECREATE},function(e){e[e.DRAPED=0]="DRAPED",e[e.ELEVATED=1]="ELEVATED"}(UC||(UC={}));let yS=null,KL=!0;function Q6(e,t,r){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(KL)try{return new ImageData(e,t)}catch{KL=!1}return A_e(e,t,r)}function dZe(e,t,r,i){if(!t||!r)throw new Error("Cannot construct image data without dimensions");if(KL)try{return new ImageData(e,t,r)}catch{KL=!1}const s=A_e(t,r,i);return s.data.set(e,0),s}function pZe(){return yS||(yS=document.createElement("canvas"),yS.width=1,yS.height=1),yS}function A_e(e,t,r){return r||(r=pZe()),r.getContext("2d").createImageData(e,t)}var kw;const eU=new WeakMap;let fZe=0,up=kw=class extends Pe{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,r,i){if(e instanceof HTMLImageElement){const s={type:"image-element",src:dT(e.src,i),crossOrigin:e.crossOrigin};t[r]=s}else if(e instanceof HTMLCanvasElement){const s=e.getContext("2d").getImageData(0,0,e.width,e.height),n={type:"canvas-element",imageData:this._encodeImageData(s)};t[r]=n}else if(e instanceof HTMLVideoElement){const s={type:"video-element",src:dT(e.src,i),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[r]=s}else if(e instanceof ImageData){const s={type:"image-data",imageData:this._encodeImageData(e)};t[r]=s}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=this._decodeImageData(e.imageData),r=document.createElement("canvas");return r.width=t.width,r.height=t.height,r.getContext("2d").putImageData(t,0,0),r}case"image-data":return this._decodeImageData(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this._imageDataContainsTransparent(e);if(t){const r=t.substr(t.length-4,4).toLowerCase(),i=t.substr(0,15).toLocaleLowerCase();if(r===".png"||i==="data:image/png;")return!0}return!1}set transparent(e){this._overrideIfSome("transparent",e)}get contentHash(){const e=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(r="")=>`d:${r},t:${this.transparent},w:${e}`;return this.url!=null?t(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(eU.has(this.data)||eU.set(this.data,++fZe),t(eU.get(this.data))):t()}get memoryUsage(){let e=0;if(e+=this.url!=null?this.url.length:0,this.data!=null){const t=this.data;"data"in t?e+=t.data.byteLength:t instanceof HTMLImageElement?e+=t.naturalWidth*t.naturalHeight*3:t instanceof HTMLCanvasElement&&(e+=t.width*t.height*3)}return e}clone(){const e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new kw(e)}cloneWithDeduplication(e){const t=e.get(this);if(t)return t;const r=this.clone();return e.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(e){let t="";for(let r=0;r<e.data.length;r++)t+=String.fromCharCode(e.data[r]);return{data:btoa(t),width:e.width,height:e.height}}_decodeImageData(e){const t=atob(e.data),r=new Uint8ClampedArray(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return dZe(r,e.width,e.height)}_imageDataContainsTransparent(e){for(let t=3;t<e.data.length;t+=4)if(e.data[t]!==255)return!0;return!1}static from(e){return typeof e=="string"?new kw({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new kw({data:e}):Yx(kw,e)}};h([f({type:String,json:{write:fy}})],up.prototype,"url",null),h([f({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),f()],up.prototype,"data",null),h([Yt("data")],up.prototype,"writeData",null),h([br("data")],up.prototype,"readData",null),h([f({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],up.prototype,"transparent",null),h([f({json:{write:!0}})],up.prototype,"wrap",void 0),h([f({readOnly:!0})],up.prototype,"contentHash",null),up=kw=h([F("esri.geometry.support.MeshTexture")],up);const kC=up;let zw=class extends of(Pe){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};h([f({type:[Number],nonNullable:!0,json:{write:!0}})],zw.prototype,"offset",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0}})],zw.prototype,"rotation",void 0),h([f({type:[Number],nonNullable:!0,json:{write:!0}})],zw.prototype,"scale",void 0),zw=h([F("esri.geometry.support.MeshTextureTransform")],zw);const Vx=zw;var vB;let Ih=vB=class extends Pe{constructor(e){super(e),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=e!=null?e.get(this):null;if(r)return r;const i=new vB(this.clonePropertiesWithDeduplication(t));return e?.set(this,i),i}clonePropertiesWithDeduplication(e){return{color:this.color!=null?this.color.clone():null,colorTexture:this.colorTexture?.cloneWithDeduplication(e),normalTexture:this.normalTexture?.cloneWithDeduplication(e),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:this.colorTextureTransform?.clone(),normalTextureTransform:this.normalTextureTransform?.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let e=0;return e+=this.color!=null?16:0,this.colorTexture!=null&&(e+=this.colorTexture.memoryUsage),e+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(e+=this.normalTexture.memoryUsage),e+=this.normalTextureTransform!=null?20:0,e}};h([f({type:ot,json:{write:!0}})],Ih.prototype,"color",void 0),h([f({type:kC,json:{write:!0}})],Ih.prototype,"colorTexture",void 0),h([f({type:Vx,json:{write:!0}})],Ih.prototype,"colorTextureTransform",void 0),h([f({type:kC,json:{write:!0}})],Ih.prototype,"normalTexture",void 0),h([f({type:Vx,json:{write:!0}})],Ih.prototype,"normalTextureTransform",void 0),h([f({nonNullable:!0,json:{write:!0}})],Ih.prototype,"alphaMode",void 0),h([f({nonNullable:!0,json:{write:!0}})],Ih.prototype,"alphaCutoff",void 0),h([f({nonNullable:!0,json:{write:!0}})],Ih.prototype,"doubleSided",void 0),Ih=vB=h([F("esri.geometry.support.MeshMaterial")],Ih);const cW=Ih;var bB;let hu=bB=class extends cW{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=e!=null?e.get(this):null;if(r)return r;const i=new bB(this.clonePropertiesWithDeduplication(t));return e?.set(this,i),i}getMemoryUsage(){let e=super.getMemoryUsage();return e+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(e+=this.emissiveTexture.memoryUsage),e+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(e+=this.occlusionTexture.memoryUsage),e+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(e+=this.metallicRoughnessTexture.memoryUsage),e+=this.metallicRoughnessTextureTransform!=null?20:0,e}clonePropertiesWithDeduplication(e){return{...super.clonePropertiesWithDeduplication(e),emissiveColor:this.emissiveColor?.clone(),emissiveTexture:this.emissiveTexture?.cloneWithDeduplication(e),emissiveTextureTransform:this.emissiveTextureTransform?.clone(),occlusionTexture:this.occlusionTexture?.cloneWithDeduplication(e),occlusionTextureTransform:this.occlusionTextureTransform?.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture?.cloneWithDeduplication(e),metallicRoughnessTextureTransform:this.metallicRoughnessTextureTransform?.clone()}}};h([f({type:ot,json:{write:!0}})],hu.prototype,"emissiveColor",void 0),h([f({type:kC,json:{write:!0}})],hu.prototype,"emissiveTexture",void 0),h([f({type:Vx,json:{write:!0}})],hu.prototype,"emissiveTextureTransform",void 0),h([f({type:kC,json:{write:!0}})],hu.prototype,"occlusionTexture",void 0),h([f({type:Vx,json:{write:!0}})],hu.prototype,"occlusionTextureTransform",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],hu.prototype,"metallic",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],hu.prototype,"roughness",void 0),h([f({type:kC,json:{write:!0}})],hu.prototype,"metallicRoughnessTexture",void 0),h([f({type:Vx,json:{write:!0}})],hu.prototype,"metallicRoughnessTextureTransform",void 0),hu=bB=h([F("esri.geometry.support.MeshMaterialMetallicRoughness")],hu);const O_e=hu;var xI;const R_e="esri.geometry.support.MeshVertexAttributes",Gb=K.getLogger(R_e);let qc=xI=class extends Pe{constructor(e){super(e),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(e){return Bw(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},Gb)}castPosition(e){return e&&e instanceof Float32Array&&Gb.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),Bw(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},Gb)}castUv(e){return Bw(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},Gb)}castNormal(e){return Bw(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},Gb)}castTangent(e){return Bw(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},Gb)}clone(){const e={position:ye(this.position),uv:ye(this.uv),normal:ye(this.normal),tangent:ye(this.tangent),color:ye(this.color)};return new xI(e)}clonePositional(){const e={position:ye(this.position),normal:ye(this.normal),tangent:ye(this.tangent),uv:this.uv,color:this.color};return new xI(e)}get memoryUsage(){let e=0;return e+=this.position.byteLength,this.uv!=null&&(e+=this.uv.byteLength),this.normal!=null&&(e+=this.normal.byteLength),this.tangent!=null&&(e+=this.tangent.byteLength),this.color!=null&&(e+=this.color.byteLength),e}};function tU(e,t,r,i){const{loggerTag:s,stride:n}=t;return e.length%n!=0?(i.error(s,`Invalid array length, expected a multiple of ${n}`),new r([])):e}function Bw(e,t,r,i,s){if(!e)return e;if(e instanceof t)return tU(e,i,t,s);for(const n of r)if(e instanceof n)return tU(new t(e),i,t,s);if(Array.isArray(e))return tU(new t(e),i,t,s);{const n=r.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${e.constructor.name}`),new t([])}}function _S(e,t,r){t[r]=mZe(e)}function mZe(e){const t=new Array(e.length);for(let r=0;r<e.length;r++)t[r]=e[r];return t}h([f({json:{write:_S}})],qc.prototype,"color",void 0),h([si("color")],qc.prototype,"castColor",null),h([f({nonNullable:!0,json:{write:_S}})],qc.prototype,"position",void 0),h([si("position")],qc.prototype,"castPosition",null),h([f({json:{write:_S}})],qc.prototype,"uv",void 0),h([si("uv")],qc.prototype,"castUv",null),h([f({json:{write:_S}})],qc.prototype,"normal",void 0),h([si("normal")],qc.prototype,"castNormal",null),h([f({json:{write:_S}})],qc.prototype,"tangent",void 0),h([si("tangent")],qc.prototype,"castTangent",null),qc=xI=h([F(R_e)],qc);var kE;const P_e="esri.geometry.support.MeshComponent",gZe=K.getLogger(P_e);let Hf=kE=class extends Pe{static from(e){return Yx(kE,e)}constructor(e){super(e),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}castFaces(e){return Bw(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},gZe)}castMaterial(e){return Yx(e&&typeof e=="object"&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?O_e:cW,e)}clone(){return new kE({faces:ye(this.faces),shading:this.shading,material:ye(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(e,t){const r={faces:ye(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals};return new kE(r)}get memoryUsage(){let e=0;return this.faces!=null&&(e+=this.faces.byteLength),this.material!=null&&(e+=this.material.memoryUsage),e}};h([f({json:{write:!0}})],Hf.prototype,"faces",void 0),h([si("faces")],Hf.prototype,"castFaces",null),h([f({type:cW,json:{write:!0}})],Hf.prototype,"material",void 0),h([si("material")],Hf.prototype,"castMaterial",null),h([f({type:String,json:{write:!0}})],Hf.prototype,"shading",void 0),h([f({type:Boolean})],Hf.prototype,"trustSourceNormals",void 0),Hf=kE=h([F(P_e)],Hf);const yZe=Hf,j4=K.getLogger("esri.geometry.support.meshUtils.normalProjection");function _Ze(e,t,r,i,s){return W4(i)?(H4(Sm.TO_PCPF,Es.fromTypedArray(e),Qa.fromTypedArray(t),Qa.fromTypedArray(r),i,Es.fromTypedArray(s)),s):(j4.error("Cannot convert spatial reference to PCPF"),s)}function $mt(e,t,r,i,s){return W4(i)?(H4(Sm.FROM_PCPF,Es.fromTypedArray(e),Qa.fromTypedArray(t),Qa.fromTypedArray(r),i,Es.fromTypedArray(s)),s):(j4.error("Cannot convert to spatial reference from PCPF"),s)}function Lmt(e,t,r){return ji(e,t,0,r,MN(t),0,e.length/3),r}function Dmt(e,t,r){return ji(e,MN(r),0,t,r,0,e.length/3),t}function vZe(e,t,r){return vy(Rn,r),F1(t,e,Rn),xj(Rn)||w4(t,t),t}function bZe(e,t,r){if(vy(Rn,r),F1(t,e,Rn,4),xj(Rn)||w4(t,t,4),e!==t)for(let i=3;i<e.length;i+=4)t[i]=e[i];return t}function wZe(e,t,r,i,s){if(!W4(i))return j4.error("Cannot convert spatial reference to PCPF"),s;H4(Sm.TO_PCPF,Es.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),Qa.fromTypedArray(t),Qa.fromTypedArray(r),i,Es.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function Nmt(e,t,r,i,s){if(!W4(i))return j4.error("Cannot convert to spatial reference from PCPF"),s;H4(Sm.FROM_PCPF,Es.fromTypedArray(e,16),Qa.fromTypedArray(t),Qa.fromTypedArray(r),i,Es.fromTypedArray(s,16));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function H4(e,t,r,i,s,n){if(!t)return;const o=r.count,a=MN(s);if(M_e(s))for(let l=0;l<o;l++)i.getVec(l,hP),t.getVec(l,Bd),Oc(a,hP,dP,a),Ku(Rn,dP),e===Sm.FROM_PCPF&&Qu(Rn,Rn),Il(Bd,Bd,Rn),n.setVec(l,Bd);else for(let l=0;l<o;l++){i.getVec(l,hP),t.getVec(l,Bd),Oc(a,hP,dP,a),Ku(Rn,dP);const c=k$(r.get(l,1));let u=Math.cos(c);e===Sm.TO_PCPF&&(u=1/u),Rn[0]*=u,Rn[1]*=u,Rn[2]*=u,Rn[3]*=u,Rn[4]*=u,Rn[5]*=u,e===Sm.FROM_PCPF&&Qu(Rn,Rn),Il(Bd,Bd,Rn),pe(Bd,Bd),n.setVec(l,Bd)}return n}function W4(e){return M_e(e)||xZe(e)}function M_e(e){return e.isWGS84||Mce(e)||af(e)||lf(e)}function xZe(e){return e.isWebMercator}var Sm;(function(e){e[e.TO_PCPF=0]="TO_PCPF",e[e.FROM_PCPF=1]="FROM_PCPF"})(Sm||(Sm={}));const hP=C(),Bd=C(),dP=be(),Rn=$i();var zC;(function(e){e[e.EnableFastUpdates=0]="EnableFastUpdates",e[e.DisableFastUpdates=1]="DisableFastUpdates",e[e.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"})(zC||(zC={}));class I_e{constructor(t){this.data=t,this.type="encoded-mesh-texture",this.encoding=vm.KTX2_ENCODING}}function Jv(e){return e?.type==="encoded-mesh-texture"}async function TZe(e){return new Promise((t,r)=>{const i=new Blob([e]),s=new FileReader;s.onload=()=>{const n=s.result;t(JSON.parse(n))},s.onerror=n=>{r(n)},s.readAsText(i)})}async function SZe(e,t){return t===vm.KTX2_ENCODING?new I_e(e):new Promise((r,i)=>{const s=new Blob([e],{type:t}),n=URL.createObjectURL(s),o=new Image,a=()=>{URL.revokeObjectURL(n),"decode"in o?o.decode().then(()=>r(o),()=>r(o)).then(c):(r(o),c())},l=u=>{URL.revokeObjectURL(n),i(u),c()},c=()=>{o.removeEventListener("load",a),o.removeEventListener("error",l)};o.addEventListener("load",a),o.addEventListener("error",l),o.src=n})}function Rp(e){if(e==null)return null;const t=e.offset!=null?e.offset:Q0e,r=e.rotation!=null?e.rotation:0,i=e.scale!=null?e.scale:eye,s=bI(1,0,0,0,1,0,t[0],t[1],1),n=bI(Math.cos(r),-Math.sin(r),0,Math.sin(r),Math.cos(r),0,0,0,1),o=bI(i[0],0,0,0,i[1],0,0,0,1),a=Ya();return AT(a,n,o),AT(a,s,a),a}K.getLogger("esri.views.3d.layers.graphics.Graphics3DMeshObject3DGraphicLayer");class EZe extends pf{constructor(){super(...arguments),this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}enableFastTransformUpdates(t,r){if(this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!0;const{stageObject:i}=this,s=i.geometries.slice();i.removeAllGeometries();const n=Ck(rU,i.transformation),o=r.getOrigin(n);for(const a of s){const l=t(a.material),c=a.instantiate({material:l});c.localOrigin=o,i.addGeometry(c)}this._originalGeometries=s}disableFastTransformUpdates(t){if(!this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!1;const{stageObject:r}=this,i=r.geometries.map(s=>t(s.material));r.removeAllGeometries();for(let s=0;s<this._originalGeometries.length;s++){const n=this._originalGeometries[s],o=i[s];o.setParameters({modelTransformation:null}),o===n.material?r.addGeometry(n):r.addGeometry(n.instantiate({material:o}))}this._originalGeometries.length=0}updateFastLocalOrigin(t,r,i){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:s}=this;if(s.geometries.length===0)return;const n=s.geometries[0].localOrigin,o=Ck(rU,t),a=i.getOrigin(o);if(a===n)return;const l=r?.localMatrix??Ks;s.clearShaderTransformation(),s.transformation=t,s.geometries.forEach(c=>{c.transformation=l,c.localOrigin=a})}updateTransform(t,r,i){const{stageObject:s}=this,n=r?.localMatrix??Ks;if(!this._fastTransformUpdatesEnabled)return s.clearShaderTransformation(),s.transformation=t,s.geometries.forEach(g=>{g.transformation=n}),void this.resetEdgeObject(i);const o=s.transformation,a=s.geometries[0].transformation,l=t,c=n,u=Jr(Pee,o,a),d=Jr(Mee,l,c);s.shaderTransformation=l,this._setFastMaterialTransformation({matA:u,matB:d});const p=()=>c;for(const g of s.geometries)g.shaderTransformer=p;this.resetEdgeObject(i)}alignWithElevation(t,r,i,s){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(t,r,i,s);i!=null&&g4(this.elevationContext.featureExpressionInfoContext,i);const n=(g,y)=>Oy(g,t,this.elevationContext,r,y),{stageObject:o}=this;if(!o.geometries[0].material.parameters.modelTransformation)return;const a=o.transformation,l=o.geometries[0].transformation,c=Jr(Pee,a,l),u=Ss(CZe,o.shaderTransformation);this.alignedSampledElevation=Wv(this,this.elevationContext,t.spatialReference,n,r,u),o.shaderTransformation=u;const d=o.geometries[0].shaderTransformation,p=Jr(Mee,u,d);this._setFastMaterialTransformation({matA:c,matB:p}),this.resetEdgeObject(s)}_setFastMaterialTransformation({matA:t,matB:r}){const{stageObject:i}=this;if(i.geometries.length===0)return;const s=i.geometries[0].localOrigin,n=U3(AZe,te(rU,s.vec3,-1)),o=Jr(Iee,n,t),a=Jr($ee,n,r),l=Fn(Iee,o),c=Jr($ee,a,l);for(const u of i.geometries)u.material.setParameters({modelTransformation:c})}}const rU=C(),Pee=be(),Mee=be(),CZe=be(),Iee=be(),$ee=be(),AZe=be();class OZe{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(t,r,i){t.enableFastTransformUpdates(s=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(s))return s;const o=r.byMaterial(s);return this._fastTransformOriginalMaterials.set(s,o),r.delete(s),s}const n=new tf(s.parameters);return i.stage.add(n),this._fastTransformClonedMaterials.set(n,s),n},i.localOriginFactory)}disable(t,r,i){const s=new Set,n=new Set;t.disableFastTransformUpdates(o=>{if(!this._fastTransformClonedMaterials.has(o)){const c=o,u=this._fastTransformOriginalMaterials.get(c);return r.has(u.uid)?(s.add(c),r.byUid(u.uid).material):(n.add(c),u.material)}const a=o,l=this._fastTransformClonedMaterials.get(a);return this._fastTransformClonedMaterials.delete(a),i.stage.remove(a),a.dispose(),l});for(const o of s)this._fastTransformOriginalMaterials.delete(o),i.stage.remove(o),o.dispose();for(const o of n){const a=this._fastTransformOriginalMaterials.get(o);this._fastTransformOriginalMaterials.delete(o),r.set(a.uid,a)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(t,r,i){this._graphicReferenceCount--,this.disable(t,r,i)}forEachMaterialInfo(t){this._fastTransformOriginalMaterials.forEach(t)}forEachClonedMaterial(t){this._fastTransformClonedMaterials.forEach(t)}destroy(t){t.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),t.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:r})=>r)),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}}class RZe{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),t=>t.material)}byUid(t){return this._byUid.get(t)}byMaterial(t){return this._byMaterial.get(t)}set(t,r){this._byUid.set(t,r),this._byMaterial.set(r.material,r)}delete(t){const r=this._byMaterial.get(t)?.uid;r&&(this._byUid.delete(r),this._byMaterial.delete(t))}has(t){return this._byUid.has(t)}forEachMaterialInfo(t){this._byUid.forEach(t)}clear(){this._byUid.clear(),this._byMaterial.clear()}}function PZe(e){const t=new pr,{vertex:r,fragment:i}=t;return t.include(Xa,e),t.include(ub,e),t.include(Pye,e),Fl(r,e),e.stippleEnabled&&(t.attributes.add(E.UV0,"vec2"),t.attributes.add(E.AUXPOS1,"vec3"),r.uniforms.add(new Zt("viewport",(s,n)=>n.camera.fullViewport))),t.attributes.add(E.POSITION,"vec3"),t.varyings.add("vpos","vec3"),r.code.add(b`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),e.stippleEnabled&&(r.code.add(b`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),e.draped?r.uniforms.add(new Ae("worldToScreenRatio",(s,n)=>1/n.screenToPCSRatio)):r.code.add(b`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(b`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),e.draped?r.code.add(b`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):r.code.add(b`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new Ae("stipplePatternPixelSize",s=>GH(s))),r.code.add(b`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),r.code.add(b`}`),e.output===D.Highlight&&t.include(ig,e),t.include(os,e),i.uniforms.add(new Ae("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),e.hasVertexColors||i.uniforms.add(new Zt("constantColor",s=>s.color)),i.code.add(b`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    ${e.output===D.ObjectAndLayerIdColor?b`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${b.float(to)}) {
      discard;
    }

    ${e.output===D.Color?b`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===D.Highlight?b`outputHighlight();`:""}
  }
  `),t}const MZe=Object.freeze(Object.defineProperty({__proto__:null,build:PZe},Symbol.toStringTag,{value:"Module"}));class q4 extends xr{get _stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==D.Highlight}initializeProgram(t){return new vr(t.rctx,q4.shader.get().build(this.configuration),dr)}initializePipeline(){const t=this.configuration,r=oo(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),i=(s,n=null,o=null)=>Tt({blending:n,depthTest:HH,depthWrite:o,colorWrite:It,stencilWrite:t.hasOccludees?ef:null,stencilTest:t.hasOccludees?s?My:ky:null});return t.output===D.Color?(this._occludeePipelineState=i(!0,t.transparent||this._stippleEnabled?r:null,Ka),i(!1,t.transparent||this._stippleEnabled?r:null,Ka)):i(!1)}get primitiveType(){return bt.LINES}getPipelineState(t,r){return r?this._occludeePipelineState:super.getPipelineState(t,r)}}q4.shader=new _r(MZe,()=>ue(()=>import("./NativeLine.glsl.db907359.js"),[]));class sc extends bo{constructor(){super(...arguments),this.output=D.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}h([B({count:D.COUNT})],sc.prototype,"output",void 0),h([B()],sc.prototype,"hasSlicePlane",void 0),h([B()],sc.prototype,"hasVertexColors",void 0),h([B()],sc.prototype,"transparent",void 0),h([B()],sc.prototype,"draped",void 0),h([B()],sc.prototype,"stippleEnabled",void 0),h([B()],sc.prototype,"stippleOffColorEnabled",void 0),h([B()],sc.prototype,"stipplePreferContinuous",void 0),h([B()],sc.prototype,"hasOccludees",void 0),h([B({constValue:!1})],sc.prototype,"stippleRequiresClamp",void 0),h([B({constValue:!1})],sc.prototype,"stippleScaleWithLineWidth",void 0),h([B({constValue:!1})],sc.prototype,"stippleRequiresStretchMeasure",void 0);var QL;(function(e){e[e.START=0]="START",e[e.END=1]="END"})(QL||(QL={}));class Lee extends Fy{constructor(t){super(t,new LZe),this._configuration=new sc}getConfiguration(t,r){this._configuration.output=t,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.draped=r.slot===ae.DRAPED_MATERIAL;const i=this.parameters.stipplePattern!=null;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&this.parameters.stippleOffColor!=null,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._configuration}intersect(t,r,i,s,n,o){if(!i.options.selectionMode||!t.visible)return;if(!Wpe(r))return void K.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=t.vertexAttributes.get(E.POSITION).data,l=i.camera,c=NZe;en(c,i.point);const u=2;se(vS[0],c[0]-u,c[1]+u,0),se(vS[1],c[0]+u,c[1]+u,0),se(vS[2],c[0]+u,c[1]-u,0),se(vS[3],c[0]-u,c[1]-u,0);for(let _=0;_<4;_++)if(!l.unprojectFromRenderScreen(vS[_],Sf[_]))return;ko(l.eye,Sf[0],Sf[1],iU),ko(l.eye,Sf[1],Sf[2],sU),ko(l.eye,Sf[2],Sf[3],nU),ko(l.eye,Sf[3],Sf[0],oU);let d=Number.MAX_VALUE,p=0;for(let _=0;_<a.length-5;_+=3){if(na[0]=a[_]+r[12],na[1]=a[_+1]+r[13],na[2]=a[_+2]+r[14],oa[0]=a[_+3]+r[12],oa[1]=a[_+4]+r[13],oa[2]=a[_+5]+r[14],ri(iU,na)<0&&ri(iU,oa)<0||ri(sU,na)<0&&ri(sU,oa)<0||ri(nU,na)<0&&ri(nU,oa)<0||ri(oU,na)<0&&ri(oU,oa)<0)continue;if(l.projectToRenderScreen(na,p_),l.projectToRenderScreen(oa,f_),p_[2]<0&&f_[2]>0){ce(Vd,na,oa);const w=l.frustum,T=-ri(w[ti.NEAR],na)/de(Vd,w[ti.NEAR]);te(Vd,Vd,T),oe(na,na,Vd),l.projectToRenderScreen(na,p_)}else if(p_[2]>0&&f_[2]<0){ce(Vd,oa,na);const w=l.frustum,T=-ri(w[ti.NEAR],oa)/de(Vd,w[ti.NEAR]);te(Vd,Vd,T),oe(oa,oa,Vd),l.projectToRenderScreen(oa,f_)}else if(p_[2]<0&&f_[2]<0)continue;p_[2]=0,f_[2]=0;const v=LG(Vv(p_,f_,Fee),c);v<d&&(d=v,re(Dee,na),re(Nee,oa),p=_/3)}const g=i.rayBegin,y=i.rayEnd;if(d<u*u){let _=Number.MAX_VALUE;if(Ade(Vv(Dee,Nee,Fee),Vv(g,y,DZe),d_)){ce(d_,d_,g);const v=Se(d_);te(d_,d_,1/v),_=v/ni(g,y)}o(_,d_,p,!1)}}intersectDraped(t,r,i,s,n,o){if(!i.options.selectionMode)return;const a=t.vertexAttributes.get(E.POSITION).data,l=t.vertexAttributes.get(E.SIZE),c=l?l.data[0]:0,u=s[0],d=s[1],p=((c+1)/2+4)*t.screenToWorldRatio;let g=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],w=a[_+1],T=u-v,x=d-w,S=a[_+3]-v,O=a[_+4]-w,A=fe((S*T+O*x)/(S*S+O*O),0,1),$=S*A-T,P=O*A-x,U=$*$+P*P;U<g&&(g=U,y=_/3)}g<p*p&&n(o.dist,o.normal,y,!1)}requiresSlot(t,r){return!(r!==D.Color&&r!==D.Highlight&&r!==D.ObjectAndLayerIdColor||t!==ae.OPAQUE_MATERIAL&&t!==ae.DRAPED_MATERIAL)}createGLMaterial(t){return new IZe(t)}createBufferWriter(){const t=this.parameters.hasVertexColors?kHe:FHe;return this.parameters.stipplePattern==null?new P2(t):new $Ze(t.clone().vec3f(E.AUXPOS1).vec2f(E.UV0))}}class IZe extends Ny{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){this._output===D.Color&&this._updateOccludeeState(t);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(r,this._stipplePattern)}),this._stipplePattern=r),this.ensureTechnique(q4,t)}}class $Ze{constructor(t){this.vertexBufferLayout=t}elementCount(t){return t.indices.get(E.POSITION).length}write(t,r,i,s,n){Pge(i,this.vertexBufferLayout,t,r,s,n),this._writeAuxpos1(t,i,s,n),this._writeUV0(t,i,s,n)}_writeAuxpos1(t,r,i,s){const n=i.getField(E.AUXPOS1,Es),o=r.indices.get(E.POSITION),a=r.vertexAttributes.get(E.POSITION).data,l=t,c=n.typedBufferStride,u=n.typedBuffer;s*=c;for(let d=0;d<o.length-1;d+=2)for(const p of[1,0]){const g=3*o[d+p],y=a[g],_=a[g+1],v=a[g+2],w=l[0]*y+l[4]*_+l[8]*v+l[12],T=l[1]*y+l[5]*_+l[9]*v+l[13],x=l[2]*y+l[6]*_+l[10]*v+l[14];u[s]=w,u[s+1]=T,u[s+2]=x,s+=c}}_writeUV0(t,r,i,s){const n=i.getField(E.UV0,bd),o=r.indices.get(E.POSITION),a=r.vertexAttributes.get(E.POSITION).data,l=r.vertexAttributes.get(E.DISTANCETOSTART)?.data,c=n.typedBufferStride,u=n.typedBuffer;let d=0;u[s*=c]=QL.START,u[s+1]=d,s+=c;const p=3*o[0],g=se(na,a[p],a[p+1],a[p+2]);t&&Ue(g,g,t);const y=oa,_=o.length-1;let v=1;const w=l?(x,S,O)=>d=l[O]:(x,S,O)=>d+=ni(x,S);for(let x=1;x<_;x+=2){const S=3*o[x];se(y,a[S],a[S+1],a[S+2]),t&&Ue(y,y,t),w(g,y,v++);for(let O=0;O<2;++O)u[s]=1-O,u[s+1]=d,s+=c;re(g,y)}const T=3*o[_];se(y,a[T],a[T+1],a[T+2]),t&&Ue(y,y,t),w(g,y,v),u[s]=QL.END,u[s+1]=d}}class LZe extends pH{constructor(){super(...arguments),this.color=Mu,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1,this.stippleTexture=null}}const na=C(),oa=C(),Vd=C(),d_=C(),p_=xo(),f_=xo(),Dee=C(),Nee=C(),Fee=Sd(),DZe=Sd(),NZe=C(),vS=[xo(),xo(),xo(),xo()],Sf=[C(),C(),C(),C()],iU=Sr(),sU=Sr(),nU=Sr(),oU=Sr(),FZe=["mesh"];class UZe extends ff{constructor(t,r,i,s){super(t,r,i,s),this._materialInfoCache=new RZe,this._fastUpdateProcessor=new OZe,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){Kr.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new Lee({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new Lee({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,FZe,"fill on mesh-3d"))return null;const i=this.setGraphicElevationContext(r,new Vc),s=t.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}onRemoveGraphic(t){this._fastUpdateProcessor.onRemoveGraphic(t,this._materialInfoCache,this._context)}layerOpacityChanged(t,r){const i=this._getLayerOpacity();this._updateMaterialParameters(s=>{s.material.setParameters({layerOpacity:i});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),t.forEach(s=>{const n=r(s);n?.layerOpacityChanged(i,this._context.isAsync)})}layerElevationInfoChanged(t,r){return this.updateGraphics3DGraphicElevationInfo(t,r,Ry)}slicePlaneEnabledChanged(t,r){return this._updateMaterialParameters(({material:i})=>{i.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),t.forEach(i=>{const s=r(i);s?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const t=this._usePBR();return this._updateMaterialParameters(({material:r})=>r.setParameters({usePBR:t})),!0}updateTransform(t,r,i,s){const n=this._context.renderCoordsHelper.spatialReference,o=kZe,{origin:a,transform:l}=i;switch(Oc(r,se(jn,a.x,a.y,a.z??0),o,n),s){case zC.EnableFastUpdates:this._fastUpdateProcessor.enable(t,this._materialInfoCache,this._context);break;case zC.DisableFastUpdates:this._fastUpdateProcessor.disable(t,this._materialInfoCache,this._context);break;case zC.UpdateFastLocalOrigin:t.updateFastLocalOrigin(o,l,this._context.localOriginFactory)}const{elevationContext:c}=t;c.centerPointInElevationSR=this._getCenterPointInElevationSR(o);const{elevationProvider:u,renderCoordsHelper:d}=this._context,p=(g,y)=>Oy(g,u,c,d,y);return t.alignedSampledElevation=Wv(t,c,u.spatialReference,p,d,o),t.updateTransform(o,l,this._context.isAsync),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(t){return t==null?"-":t instanceof ot?t.toHex():t.contentHash}_materialPropertiesDefault(t,r){const i=this._requiresSymbolVertexColors(),s=!!t.vertexAttributes.color,n=!!t.vertexAttributes.tangent;return{hasSymbolVertexColors:i,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${r},svc:${i}`}}_textureTransformUid(t){const{offset:r,scale:i,rotation:s}=t??BZe;return`${r[0]},${r[1]},${s},${i[0]},${i[1]}`}_materialProperties(t,r,i){const s=this._materialPropertiesDefault(t,i);if(!r.material)return s;const{color:n,colorTexture:o,colorTextureTransform:a,normalTexture:l,normalTextureTransform:c,doubleSided:u,alphaCutoff:d,alphaMode:p}=r.material,g=this._colorOrTextureUid(n),y=this._colorOrTextureUid(o),_=this._textureTransformUid(a),v=this._colorOrTextureUid(l),w=this._textureTransformUid(c);if(s.color=n,s.colorTexture=o,s.normalTexture=l,s.uid=`${s.uid},cmuid:${g},ctmuid:${y},cttuid:${_},ntmuid:${v},nttuid:${w},ds:${u},ac:${d},am:${p}`,r.material instanceof O_e){const{metallic:T,roughness:x,metallicRoughnessTexture:S,metallicRoughnessTextureTransform:O,emissiveColor:A,emissiveTexture:$,emissiveTextureTransform:P,occlusionTexture:U,occlusionTextureTransform:I}=r.material,L=this._colorOrTextureUid(S),N=this._textureTransformUid(O),Z=this._colorOrTextureUid(A),W=this._colorOrTextureUid($),V=this._textureTransformUid(P),J=this._colorOrTextureUid(U),R=this._textureTransformUid(I);s.metallic=T,s.roughness=x,s.metallicRoughnessTexture=S,s.emissiveColor=A,s.emissiveTexture=$,s.occlusionTexture=U,s.colorTextureTransform=this._convertTextureTransform(a),s.normalTextureTransform=this._convertTextureTransform(c),s.emissiveTextureTransform=this._convertTextureTransform(P),s.occlusionTextureTransform=this._convertTextureTransform(I),s.metallicRoughnessTextureTransform=this._convertTextureTransform(O),s.uid=`${s.uid},mrm:${T},mrr:${x},mrt:${L},mrtt:${N},emuid:${Z},etmuid:${W},ett:${V},otmuid:${J},ott:${R}`}return s}_convertTextureTransform(t){if(!t)return null;const{scale:r,offset:i,rotation:s}=t;return{scale:r,offset:i,rotation:Ot(s)}}_setInternalColorValueParameters(t,r){r.diffuse=ot.toUnitRGB(t),r.opacity=t.a}_getLoadableTextureResource(t){return t.data?t.data:t.url}_getInternalTextureId(t){const r=this._getInternalTexture(t,Gr.Opaque);return r!=null?r.id:null}_getInternalTexture(t,r){const i=this._getLoadableTextureResource(t);if(!i)return null;const s=`${t.contentHash}/${r}`;let n=this._textures.get(s);return n||(n=new lb(Jv(i)?i.data:i,{mipmap:!0,wrap:this._castTextureWrap(t.wrap),noUnpackFlip:!0,preMultiplyAlpha:!Jv(i)&&r!==Gr.Opaque,encoding:Jv(i)&&i.encoding!=null?i.encoding:void 0}),this._textures.set(s,n),this._context.stage.add(n),this._context.stage.loadImmediate(n)),n}_castTextureWrap(t="repeat"){if(typeof t=="string"){const r=this._castTextureWrapIndividual(t);return{s:r,t:r}}return{s:this._castTextureWrapIndividual(t.horizontal),t:this._castTextureWrapIndividual(t.vertical)}}_castTextureWrapIndividual(t){switch(t){case"clamp":return Ct.CLAMP_TO_EDGE;case"mirror":return Ct.MIRRORED_REPEAT;default:return Ct.REPEAT}}_setInternalMaterialParameters(t,r){if(t.color!=null&&this._setInternalColorValueParameters(t.color,r),t.colorTexture!=null){const i=this._getInternalTexture(t.colorTexture,r.textureAlphaMode);i!=null?(r.textureId=i.id,r.textureAlphaPremultiplied=!!i.parameters.preMultiplyAlpha):r.textureId=void 0}t.normalTexture!=null&&(r.normalTextureId=this._getInternalTextureId(t.normalTexture)),t.emissiveColor!=null&&(r.emissiveFactor=ot.toUnitRGB(t.emissiveColor)),t.emissiveTexture!=null&&(r.emissiveTextureId=this._getInternalTextureId(t.emissiveTexture)),t.occlusionTexture!=null&&(r.occlusionTextureId=this._getInternalTextureId(t.occlusionTexture)),t.metallicRoughnessTexture!=null&&(r.metallicRoughnessTextureId=this._getInternalTextureId(t.metallicRoughnessTexture)),r.colorTextureTransformMatrix=Rp(t.colorTextureTransform),r.normalTextureTransformMatrix=Rp(t.normalTextureTransform),r.occlusionTextureTransformMatrix=Rp(t.occlusionTextureTransform),r.emissiveTextureTransformMatrix=Rp(t.emissiveTextureTransform),r.metallicRoughnessTextureTransformMatrix=Rp(t.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(t){const r=this._drivenProperties.color;let i=this.symbolLayer.material!=null?this.symbolLayer.material.colorMixMode:null;if(r)t.externalColor=Mu;else{const s=this.symbolLayer.material!=null?this.symbolLayer.material.color:null;s!=null?t.externalColor=ot.toUnitRGBA(s):(i=null,t.externalColor=Mu)}i&&(t.colorMixMode=i),t.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(t){const r=t.vertexAttributes.color;if(r==null)return!1;for(let i=3;i<r.length;i+=4)if(r[i]!==255)return!0;return!1}_getOrCreateMaterial(t,r){const i=r.material?.color,s=r.material?.colorTexture,n=r.material?.alphaMode,o=n==="blend",a=n!=="opaque"&&(this._hasTransparentVertexColors(t)||i!=null&&i.a<1||s!=null&&s.transparent||o),l=this._materialProperties(t,r,a),c=this._materialInfoCache.byUid(l.uid);if(c)return c.material;const u={uid:l.uid,material:null,isComponentTransparent:a,alphaMode:r.material?r.material.alphaMode:"opaque"},d=n_e({normalTexture:l.normalTexture,metallicRoughnessTexture:l.metallicRoughnessTexture,metallicFactor:l.metallic,roughnessFactor:l.roughness,emissiveTexture:l.emissiveTexture,emissiveFactor:ot.toUnitRGB(l.emissiveColor),occlusionTexture:l.occlusionTexture}),p={usePBR:this._usePBR(),isSchematic:d,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:wa,diffuse:cm,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:oi.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p.mrrFactors=d?[...nW]:[l.metallic,l.roughness,I4[2]],r.material&&(p.doubleSided=r.material.doubleSided,p.cullFace=r.material.doubleSided?oi.None:oi.Back,p.textureAlphaCutoff=r.material.alphaCutoff),this._setExternalMaterialParameters(p),this._setMaterialTransparentParameter(p,u),this._setInternalMaterialParameters(l,p);const g=new tf(p);return u.material=g,this._materialInfoCache.set(l.uid,u),this._context.stage.add(g),g}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(t,r){t.transparent=this.needsDrivenTransparentPass||r.isComponentTransparent||t.layerOpacity<1||t.opacity<1||t.externalColor&&t.externalColor[3]<1,r.alphaMode==="auto"?t.textureAlphaMode=t.transparent?Gr.MaskBlend:Gr.Opaque:t.textureAlphaMode=r.alphaMode==="opaque"?Gr.Opaque:r.alphaMode==="mask"?Gr.Mask:Gr.Blend}_addDebugNormals(t,r){const i=r.length,s=t.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(t.extent.width*s,t.extent.height*s,t.extent.zmax-t.extent.zmin),o=[],a=[],l=[],c=[];for(let g=0;g<i;g++){const y=r[g],_=y.vertexAttributes.get(E.POSITION),v=y.vertexAttributes.get(E.NORMAL),w=y.indices.get(E.POSITION),T=y.indices.get(E.NORMAL),x=_.data,S=v.data;for(let O=0;O<w.length;O++){const A=3*w[O],$=3*T[O];for(let P=0;P<3;P++)o.push(x[A+P]);for(let P=0;P<3;P++)o.push(x[A+P]+S[$+P]*n);if(a.push(a.length),a.push(a.length),O%3==0){this._calculateFaceNormal(x,w,O,Wb),this._getFaceVertices(x,w,O,jn,jb,Hb),oe(jn,jn,jb),oe(jn,jn,Hb),te(jn,jn,1/3);for(let P=0;P<3;P++)l.push(jn[P]);for(let P=0;P<3;P++)l.push(jn[P]+Wb[P]*n);c.push(c.length),c.push(c.length)}}}const u=r[0].transformation,d=new Cs(this._debugVertexNormalMaterial,[[E.POSITION,new Fe(o,3,!0)]],[[E.POSITION,a]],null,Ki.Line);r.push(d),d.transformation=u;const p=new Cs(this._debugFaceNormalMaterial,[[E.POSITION,new Fe(l,3,!0)]],[[E.POSITION,c]],null,Ki.Line);p.transformation=u,r.push(p)}_createAs3DShape(t,r,i,s){const n=t.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,r,s);if(o==null)return null;const{geometries:a,objectTransformation:l}=o;Kr.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,a);const c=new ng({geometries:a,layerUid:this._context.layer.uid,graphicUid:s});c.transformation=l;const u=j0e(this.symbolLayer,{opacity:this._getLayerOpacity()}),d=u!=null?new hGe(a[0].material,[u],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,p=new EZe(this,c,a,null,null,Wv,i,d);this._fastUpdateProcessor.onAddGraphic(),p.needsElevationUpdates=Ry(i.mode),p.useObjectOriginAsAttachmentOrigin=!0,i.centerPointInElevationSR=this._getCenterPointInElevationSR(c.transformation);const{elevationProvider:g,renderCoordsHelper:y}=this._context,_=(v,w)=>Oy(v,g,i,y,w);return p.alignedSampledElevation=Wv(p,i,g.spatialReference,_,y),p}_getCenterPointInElevationSR(t){const r=cb(0,0,0,this._context.elevationProvider.spatialReference!=null?this._context.elevationProvider.spatialReference:null);return SG([t[12],t[13],t[14]],this._context.renderCoordsHelper.spatialReference,r),r}_createComponentNormals(t,r,i,s){switch(i.shading||"flat"){default:case"source":return this._createComponentNormalsSource(t,r,i,s);case"flat":return this._createComponentNormalsFlat(t,s);case"smooth":return this._createComponentNormalsSmooth(t,s)}}_createComponentNormalsSource(t,r,i,s){if(r==null)return this._createComponentNormalsFlat(t,s);let n=!1;if(!i.trustSourceNormals)for(let o=0;o<s.length;o+=3){this._calculateFaceNormal(t,s,o,Wb);for(let a=0;a<3;a++){const l=3*s[o+a];jn[0]=r[l],jn[1]=r[l+1],jn[2]=r[l+2],de(Wb,jn)<0&&(r[l]=-r[l],r[l+1]=-r[l+1],r[l+2]=-r[l+2],n=!0)}}return new aU(r,s,n)}_createComponentNormalsFlat(t,r){const i=Vi(r.length),s=new Array(3*r.length);for(let n=0;n<r.length;n+=3){const o=this._calculateFaceNormal(t,r,n,Wb);for(let a=0;a<3;a++)i[n+a]=o[a],s[n+a]=n/3}return new aU(i,s,!1)}_createComponentNormalsSmooth(t,r){const i={};for(let o=0;o<r.length;o+=3){const a=this._calculateFaceNormal(t,r,o,Wb);for(let l=0;l<3;l++){const c=r[o+l];let u=i[c];u||(u={normal:C(),count:0},i[c]=u),oe(u.normal,u.normal,a),u.count++}}const s=Vi(3*r.length),n=new Array(3*r.length);for(let o=0;o<r.length;o++){const a=i[r[o]];a.count!==1&&(pe(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)s[3*o+l]=a.normal[l];n[o]=o}return new aU(s,n,!1)}_getFaceVertices(t,r,i,s,n,o){const a=3*r[i],l=3*r[i+1],c=3*r[i+2];s[0]=t[a],s[1]=t[a+1],s[2]=t[a+2],n[0]=t[l],n[1]=t[l+1],n[2]=t[l+2],o[0]=t[c],o[1]=t[c+1],o[2]=t[c+2]}_calculateFaceNormal(t,r,i,s){return this._getFaceVertices(t,r,i,jn,jb,Hb),ce(jb,jb,jn),ce(Hb,Hb,jn),rt(jn,jb,Hb),pe(s,jn),s}_getOrCreateComponents(t){return t.components??zZe}_createPositionBuffer(t,r){let i=t.vertexAttributes.position;const s=r.reprojection===yl.ECEF?r.transformBeforeProject:null;if(s!=null&&(i=XT(new Float64Array(i.length),i,s)),r.reprojection===yl.NONE)return r.needsBufferCopy?new Float64Array(i):i;const n=s!=null?i:new Float64Array(i.length);return ji(i,t.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,i.length/3),n}_createNormalBuffer(t,r,i){let s=t.vertexAttributes.normal;if(s==null)return null;const n=i.reprojection===yl.ECEF?i.transformBeforeProject:null;if(n!=null&&(s=vZe(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===yl.NONE)return i.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const o=t.vertexAttributes.position,a=n!=null?s:new Float32Array(s.length);return _Ze(s,o,r,t.spatialReference,a)}_createTangentBuffer(t,r,i){let s=t.vertexAttributes.tangent;if(s==null)return null;const n=i.reprojection===yl.ECEF?i.transformBeforeProject:null;if(n!=null&&(s=bZe(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===yl.NONE)return i.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const o=t.vertexAttributes.position,a=n!=null?s:new Float32Array(s.length);return wZe(s,o,r,t.spatialReference,a)}_createColorBuffer(t){return t.vertexAttributes.color}_createSymbolColorBuffer(t){if(this._requiresSymbolVertexColors()){const r=this._getVertexOpacityAndColor(t),i=NWe(this.symbolLayer?.material?.colorMixMode),s=new Uint8Array(4);return l_e(r,i,s),s}return null}_createBuffers(t,r){const i=t.vertexAttributes&&t.vertexAttributes.position;if(!i)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=t.vertexAttributes.normal,n=t.vertexAttributes.uv,o=t.vertexAttributes.tangent;if(s!=null&&s.length!==i.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(o!=null&&o.length/4!=i.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(n!=null&&n.length/2!=i.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(t),l=this._createPositionBuffer(t,a),c=this._createColorBuffer(t),u=this._createSymbolColorBuffer(r),d=this._createNormalBuffer(t,l,a),p=this._createTangentBuffer(t,l,a);return{positionBuffer:l,normalBuffer:d,tangentBuffer:p,uvBuffer:n,colorBuffer:c,symbolColorBuffer:u,objectTransformation:a.reprojection===yl.NONE&&a.objectTransformation!=null?a.objectTransformation:this._transformOriginLocal(t,l,d,p),geometryTransformation:a.reprojection===yl.NONE&&a.geometryTransformation!=null?a.geometryTransformation:be()}}_computeReprojectionInfo(t){const{vertexSpace:r}=t,i=r.isRelative,s=r.isGeoreferenced?this._context.renderCoordsHelper.viewingMode===Ie.Local?yl.NONE:yl.ECEF:yl.NONE;if(i){const{origin:n}=r,o=be(),a=t.transform?.localMatrix??Ks;if(s===yl.NONE)return Oc(t.spatialReference,n,o,this._context.renderCoordsHelper.spatialReference),{reprojection:s,objectTransformation:o,geometryTransformation:gT(a),needsBufferCopy:!1};const l=U3(be(),n);return Jr(l,l,a),{reprojection:s,transformBeforeProject:l,needsBufferCopy:!0}}return{reprojection:s,needsBufferCopy:!0}}_transformOriginLocal(t,r,i,s){const n=this._context.renderCoordsHelper.spatialReference,o=t.anchor;pP[0]=o.x,pP[1]=o.y,pP[2]=o.z??0;const a=be();return Oc(t.spatialReference,pP,a,n),Fn(Uee,a),XT(r,r,Uee),i==null&&s==null||(Ku(bS,a),Qu(bS,bS),i!=null&&F1(i,i,bS),s!=null&&F1(s,s,bS,4)),a}_validateFaces(t,r){const i=t.vertexAttributes.position.length/3,s=r.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(i<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(i%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(t,r){return r.faces??NT(t.vertexAttributes.position.length/3)}_isOutsideClippingArea(t){if(!this._context.clippingExtent)return!1;const r=t.vertexAttributes&&t.vertexAttributes.position;if(!r)return!1;const i=this._context.elevationProvider.spatialReference;let s;const n=r.length/3;return i==null||t.spatialReference.equals(i)?s=r:(s=new Float64Array(r.length),ji(t.vertexAttributes.position,t.spatialReference,0,s,i,0,n)),mi(lU),Tc(lU,s,0,n),!rd(lU,this._context.clippingExtent)}_createGeometryInfo(t,r,i){if(!Dm(t.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(t))return null;const s=this._createBuffers(t,r);if(s==null)return null;const{positionBuffer:n,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:u,objectTransformation:d,geometryTransformation:p}=s,g=this._getOrCreateComponents(t),y=new Array;let _=!1;for(const v of g){if(!this._validateFaces(t,v))return null;const w=this._getOrCreateFaces(t,v);if(w.length===0)continue;const T=this._createComponentNormals(n,c,v,w);T.didFlipNormals&&(_=!0);const x=[[E.POSITION,new Fe(n,3,!0)],[E.NORMAL,new Fe(T.normals,3,!0)]],S=[[E.POSITION,w],[E.NORMAL,T.indices]];a!=null&&(x.push([E.COLOR,new Fe(a,4,!0)]),S.push([E.COLOR,w])),l!=null&&(x.push([E.SYMBOLCOLOR,new Fe(l,4,!0)]),S.push([E.SYMBOLCOLOR,T2(w.length)])),o!=null&&(x.push([E.UV0,new Fe(o,2,!0)]),S.push([E.UV0,w])),u!=null&&(x.push([E.TANGENT,new Fe(u,4,!0)]),S.push([E.TANGENT,w]));const O=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:this._context.layer.uid}),A=this._getOrCreateMaterial(t,v),$=new Cs(A,x,S,null,Ki.Mesh,O);$.transformation=p,y.push($)}return _&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:y,objectTransformation:d}}_updateMaterialParameters(t){this._materialInfoCache.forEachMaterialInfo(t),this._fastUpdateProcessor.forEachMaterialInfo(t),this._fastUpdateProcessor.forEachClonedMaterial((r,i)=>{i.setParameters(r.parameters)})}test(){return{...super.test(),materials:this._materialInfoCache.materials}}}class aU{constructor(t,r,i){this.normals=t,this.indices=r,this.didFlipNormals=i}}const pP=C(),jn=C(),jb=C(),Hb=C(),Wb=C(),Uee=be(),bS=$i(),kZe=be(),lU=Qs(),zZe=[new yZe],BZe=new Vx;var yl;(function(e){e[e.NONE=0]="NONE",e[e.ECEF=1]="ECEF"})(yl||(yl={}));class VZe{constructor(t,r,i,s){this.graphics3DSymbolLayer=t,this.instanceIndex=r,this.elevationAligner=i,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(t){const r=this._lodRenderer.instanceData;t!==r.getVisible(this.instanceIndex)&&r.setVisible(this.instanceIndex,t)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(t,r,i){if(this.elevationAligner){g4(this.elevationContext.featureExpressionInfoContext,i);const s=(o,a)=>Oy(o,t,this.elevationContext,r,a),n=this.elevationAligner(this,this.elevationContext,t.spatialReference,s,r);n!=null&&(this.alignedSampledElevation=n)}}getCenterObjectSpace(t=C()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Gd),Ue(t,this._lodRenderer.baseBoundingSphere.center,Gd)}getBoundingBoxObjectSpace(t=Qs()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Gd);const r=this._lodRenderer.baseBoundingBox;mi(t);for(let i=0;i<8;++i)se(Xc,(1&i)==0?r[0]:r[3],(2&i)==0?r[1]:r[4],(4&i)==0?r[2]:r[5]),Ue(Xc,Xc,Gd),Zp(t,Xc);return t}computeAttachmentOrigin(t){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Gd),t.render.origin[0]+=Gd[12],t.render.origin[1]+=Gd[13],t.render.origin[2]+=Gd[14],t.render.num++}async getProjectedBoundingBox(t,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=GZe,l=lG(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Gd);for(let u=0;u<l;u++){const d=a[u];Xc[0]=o[d[0]],Xc[1]=o[d[1]],Xc[2]=o[d[2]],Ue(Xc,Xc,Gd),m_[3*u]=Xc[0],m_[3*u+1]=Xc[1],m_[3*u+2]=Xc[2]}if(!t(m_,0,l))return null;mi(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],m_[u+d]),o[d+3]=Math.max(o[d+3],m_[u+d]);c&&i.push({location:m_.slice(u,u+3),screenSpaceBoundingRect:c})}if(r&&(td(o,cU),this.elevationContext.mode!=="absolute-height")){let u;const d=AH(o,r.service.spatialReference,r);try{u=await r.service.queryElevation(cU[0],cU[1],s,d,"ground")}catch{}u!=null&&Hue(o,0,0,-this.alignedSampledElevation+u)}return o}addObjectState(t,r){if(t===km.Highlight){const i=new bL(t);this._addHighlightId(i),r.addExternal(s=>{this._removeHighlightId(s)},i)}}removeObjectState(t){this._highlights.forEach(r=>t.remove(r))}_addHighlightId(t){this._highlights.add(t),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(t){this._highlights.delete(t),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const m_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Xc=C(),cU=C(),GZe=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Gd=be();function jZe(e){const t=new Array;return e.stageResources.geometries.forEach(r=>{const i=e.stageResources.textures;t.push(new B0e(r,i))}),{components:t,minScreenSpaceRadius:e.lodThreshold??0,pivotOffset:e.pivotOffset}}function HZe(e){return{levels:e.map(t=>jZe(t))}}function WZe(e){return e=e||globalThis.location.hostname,qZe.some(t=>e?.match(t)!=null)}function wB(e,t){return e&&(t=t||globalThis.location.hostname)?t.match($_e)!=null||t.match(D_e)!=null?e.replace("static.arcgis.com","staticdev.arcgis.com"):t.match(L_e)!=null||t.match(N_e)!=null?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}const $_e=/^devext.arcgis.com$/,L_e=/^qaext.arcgis.com$/,D_e=/^[\w-]*\.mapsdevext.arcgis.com$/,N_e=/^[\w-]*\.mapsqa.arcgis.com$/,qZe=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,$_e,L_e,/^jsapps.esri.com$/,D_e,N_e];function XZe(e,t,r){if(e.count!==t.count)return void b4.error("source and destination buffers need to have the same number of elements");const i=e.count,s=r[0],n=r[1],o=r[2],a=r[3],l=r[4],c=r[5],u=r[6],d=r[7],p=r[8],g=r[9],y=r[10],_=r[11],v=r[12],w=r[13],T=r[14],x=r[15],S=e.typedBuffer,O=e.typedBufferStride,A=t.typedBuffer,$=t.typedBufferStride;for(let P=0;P<i;P++){const U=P*O,I=P*$,L=A[I],N=A[I+1],Z=A[I+2],W=A[I+3];S[U]=s*L+l*N+p*Z+v*W,S[U+1]=n*L+c*N+g*Z+w*W,S[U+2]=o*L+u*N+y*Z+T*W,S[U+3]=a*L+d*N+_*Z+x*W}}function ZZe(e,t,r){uW(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)}function uW(e,t,r,i=4,s=i){if(e.length/i!=t.length/s)return void b4.error("source and destination buffers need to have the same number of elements");const n=e.length/i,o=r[0],a=r[1],l=r[2],c=r[3],u=r[4],d=r[5],p=r[6],g=r[7],y=r[8];let _=0,v=0;for(let w=0;w<n;w++){const T=t[_],x=t[_+1],S=t[_+2],O=t[_+3];e[v]=o*T+c*x+p*S,e[v+1]=a*T+u*x+g*S,e[v+2]=l*T+d*x+y*S,e[v+3]=O,_+=s,v+=i}}function YZe(e,t){const r=Math.min(e.count,t.count),i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride;for(let a=0;a<r;a++){const l=a*s,c=a*o,u=n[c],d=n[c+1],p=n[c+2],g=u*u+d*d+p*p;if(g>0){const y=1/Math.sqrt(g);i[l]=y*u,i[l+1]=y*d,i[l+2]=y*p}}}function JZe(e,t,r){eD(e.typedBuffer,t,r,e.typedBufferStride)}function eD(e,t,r,i=4){const s=Math.min(e.length/i,t.count),n=t.typedBuffer,o=t.typedBufferStride;let a=0,l=0;for(let c=0;c<s;c++)e[l]=r*n[a],e[l+1]=r*n[a+1],e[l+2]=r*n[a+2],e[l+3]=r*n[a+3],a+=o,l+=i}Object.freeze(Object.defineProperty({__proto__:null,normalize:YZe,scale:eD,scaleView:JZe,transformMat3:uW,transformMat3View:ZZe,transformMat4:XZe},Symbol.toStringTag,{value:"Module"}));function KZe(e,t){hW(e.typedBuffer,t.typedBuffer,e.typedBufferStride,t.typedBufferStride)}function hW(e,t,r=2,i=r){const s=t.length/2;let n=0,o=0;if(md(t)||Cwe(t)){for(let l=0;l<s;++l)e[n]=t[o],e[n+1]=t[o+1],n+=r,o+=i;return}const a=Awe(t);if(Ewe(t))for(let l=0;l<s;++l)e[n]=Math.max(t[o]/a,-1),e[n+1]=Math.max(t[o+1]/a,-1),n+=r,o+=i;else for(let l=0;l<s;++l)e[n]=t[o]/a,e[n+1]=t[o+1]/a,n+=r,o+=i}function QZe(e,t,r,i){const s=e.typedBuffer,n=e.typedBufferStride,o=i?.count??e.count;let a=(i?.dstIndex??0)*n;for(let l=0;l<o;++l)s[a]=t,s[a+1]=r,a+=n}Object.freeze(Object.defineProperty({__proto__:null,fill:QZe,normalizeIntegerBuffer:hW,normalizeIntegerBufferView:KZe},Symbol.toStringTag,{value:"Module"}));function eYe(e,t){dO(e.typedBuffer,t.typedBuffer,e.typedBufferStride,t.typedBufferStride)}function dO(e,t,r=3,i=r){const s=t.length/i;let n=0,o=0;for(let a=0;a<s;++a)e[n]=t[o],e[n+1]=t[o+1],e[n+2]=t[o+2],n+=r,o+=i}function tYe(e,t,r,i,s){const n=e.typedBuffer,o=e.typedBufferStride,a=s?.count??e.count;let l=(s?.dstIndex??0)*o;for(let c=0;c<a;++c)n[l]=t,n[l+1]=r,n[l+2]=i,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:dO,copyView:eYe,fill:tYe},Symbol.toStringTag,{value:"Module"}));function rYe(e,t){dW(e.typedBuffer,t,e.typedBufferStride)}function dW(e,t,r=4){const i=t.typedBuffer,s=t.typedBufferStride,n=t.count;let o=0,a=0;for(let l=0;l<n;++l)e[o]=i[a],e[o+1]=i[a+1],e[o+2]=i[a+2],e[o+3]=i[a+3],o+=r,a+=s}function iYe(e,t,r,i,s,n){const o=e.typedBuffer,a=e.typedBufferStride,l=n?.count??e.count;let c=(n?.dstIndex??0)*a;for(let u=0;u<l;++u)o[c]=t,o[c+1]=r,o[c+2]=i,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:dW,copyView:rYe,fill:iYe},Symbol.toStringTag,{value:"Module"}));class F_e{constructor(t){this._streamDataRequester=t}async loadJSON(t,r){return this._load("json",t,r)}async loadBinary(t,r){return nf(t)?(Jt(r),YV(t)):this._load("binary",t,r)}async loadImage(t,r){return this._load("image",t,r)}async _load(t,r,i){if(this._streamDataRequester==null)return(await ii(r,{responseType:sYe[t]})).data;const s=await Yu(this._streamDataRequester.request(r,t,i));if(s.ok===!0)return s.value;throw W1(s.error),new G("",`Request for resource failed: ${s.error}`)}}const sYe={image:"image",binary:"array-buffer",json:"json","image+type":void 0};function nYe(e={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...e}}function oYe(e,t={}){return{data:e,parameters:{wrap:{s:Ct.REPEAT,t:Ct.REPEAT,...t.wrap},noUnpackFlip:!0,mipmap:!1,...t}}}let V1=class{constructor(e,t,r=""){this.major=e,this.minor=t,this._context=r}lessThan(e,t){return this.major<e||e===this.major&&this.minor<t}since(e,t){return!this.lessThan(e,t)}validate(e){if(this.major!==e.major){const t=this._context&&this._context+":",r=this._context&&this._context+" ";throw new G(t+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new V1(this.major,this.minor,this._context)}static parse(e,t=""){const[r,i]=e.split("."),s=/^\s*\d+\s*$/;if(!r||!r.match||!s.test(r))throw new G((t&&t+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!i||!i.match||!s.test(i))throw new G((t&&t+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const n=parseInt(r,10),o=parseInt(i,10);return new V1(n,o,t)}};function TI(e,t){const r=e.count;t||(t=new e.TypedArrayConstructor(r));for(let i=0;i<r;i++)t[i]=e.get(i);return t}Object.freeze(Object.defineProperty({__proto__:null,makeDense:TI},Symbol.toStringTag,{value:"Module"}));class kee{constructor(t){this._data=t,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const t=this._offset4;return this._offset4+=1,this._dataUint32[t]}readUint8Array(t){const r=4*this._offset4;return this._offset4+=t/4,new Uint8Array(this._data,r,t)}remainingBytes(){return this._data.byteLength-4*this._offset4}}var BC,zee;(function(e){e.SCALAR="SCALAR",e.VEC2="VEC2",e.VEC3="VEC3",e.VEC4="VEC4",e.MAT2="MAT2",e.MAT3="MAT3",e.MAT4="MAT4"})(BC||(BC={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(zee||(zee={}));const U_e={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},aYe={pbrMetallicRoughness:U_e,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},lYe={ESRI_externalColorMixMode:"tint"},Bee=(e={})=>{const t={...U_e,...e.pbrMetallicRoughness},r=cYe({...lYe,...e.extras});return{...aYe,...e,pbrMetallicRoughness:t,extras:r}};function cYe(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:e.ESRI_externalColorMixMode,e.ESRI_externalColorMixMode="tint"}return e}const uYe={magFilter:xt.LINEAR,minFilter:xt.LINEAR_MIPMAP_LINEAR,wrapS:Ct.REPEAT,wrapT:Ct.REPEAT},hYe=e=>({...uYe,...e});function dYe(e){let t,r;return e.replace(/^(.*\/)?([^/]*)$/,(i,s,n)=>(t=s||"",r=n||"","")),{dirPart:t,filePart:r}}const fP={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};class tm{constructor(t,r,i,s){if(this._context=t,this.uri=r,this.json=i,this._glbBuffer=s,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu"],this._baseUri=dYe(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),i.scenes==null)throw new G("gltf-loader-unsupported-feature","Scenes must be defined.");if(i.meshes==null)throw new G("gltf-loader-unsupported-feature","Meshes must be defined");if(i.nodes==null)throw new G("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(t,r,i){if(nf(r)){const o=n1(r);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new tm(t,r,l)}catch{}const a=YV(r);if(tm._isGLBData(a))return this._fromGLBData(t,r,a)}if(r.endsWith(".gltf")){const o=await t.loadJSON(r,i);return new tm(t,r,o)}const s=await t.loadBinary(r,i);if(tm._isGLBData(s))return this._fromGLBData(t,r,s);const n=await t.loadJSON(r,i);return new tm(t,r,n)}static _isGLBData(t){if(t==null)return!1;const r=new kee(t);return r.remainingBytes()>=4&&r.readUint32()===fP.MAGIC}static async _fromGLBData(t,r,i){const s=await tm._parseGLBData(i);return new tm(t,r,s.json,s.binaryData)}static async _parseGLBData(t){const r=new kee(t);if(r.remainingBytes()<12)throw new G("gltf-loader-error","GLB binary data is insufficiently large.");const i=r.readUint32(),s=r.readUint32(),n=r.readUint32();if(i!==fP.MAGIC)throw new G("gltf-loader-error","Magic first 4 bytes do not fit to expected GLB value.");if(t.byteLength<n)throw new G("gltf-loader-error","GLB binary data is smaller than header specifies.");if(s!==2)throw new G("gltf-loader-unsupported-feature","An unsupported GLB container version was detected. Only version 2 is supported.");let o,a,l=0;for(;r.remainingBytes()>=8;){const c=r.readUint32(),u=r.readUint32();if(l===0){if(u!==fP.CHUNK_TYPE_JSON)throw new G("gltf-loader-error","First GLB chunk must be JSON.");if(c<0)throw new G("gltf-loader-error","No JSON data found.");o=await TZe(r.readUint8Array(c))}else if(l===1){if(u!==fP.CHUNK_TYPE_BIN)throw new G("gltf-loader-unsupported-feature","Second GLB chunk expected to be BIN.");a=r.readUint8Array(c)}else K.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 GLB chunks detected. Skipping.");l+=1}if(!o)throw new G("gltf-loader-error","No GLB JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(t,r){const i=this.json.buffers[t];if(i.uri==null){if(this._glbBuffer==null)throw new G("gltf-loader-error","GLB buffer not present");return this._glbBuffer}const s=await this._getBufferLoader(t,r);if(s.byteLength!==i.byteLength)throw new G("gltf-loader-error","Buffer byte lengths should match.");return s}async _getBufferLoader(t,r){const i=this._bufferLoaders.get(t);if(i)return i;const s=this.json.buffers[t].uri,n=this._context.loadBinary(this._resolveUri(s),r).then(o=>new Uint8Array(o));return this._bufferLoaders.set(t,n),n}async getAccessor(t,r){if(!this.json.accessors)throw new G("gltf-loader-unsupported-feature","Accessors missing.");const i=this.json.accessors[t];if(i?.bufferView==null)throw new G("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(i.type in[BC.MAT2,BC.MAT3,BC.MAT4])throw new G("gltf-loader-unsupported-feature",`AttributeType ${i.type} is not supported`);const s=this.json.bufferViews[i.bufferView],n=await this.getBuffer(s.buffer,r),o=mYe[i.type],a=gYe[i.componentType],l=o*a,c=s.byteStride||l;return{raw:n.buffer,byteStride:c,byteOffset:n.byteOffset+(s.byteOffset||0)+(i.byteOffset||0),entryCount:i.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:i.componentType,min:i.min,max:i.max,normalized:!!i.normalized}}async getIndexData(t,r){if(t.indices==null)return;const i=await this.getAccessor(t.indices,r);if(i.isDenselyPacked)switch(i.componentType){case Ze.UNSIGNED_BYTE:return new Uint8Array(i.raw,i.byteOffset,i.entryCount);case Ze.UNSIGNED_SHORT:return new Uint16Array(i.raw,i.byteOffset,i.entryCount);case Ze.UNSIGNED_INT:return new Uint32Array(i.raw,i.byteOffset,i.entryCount)}else switch(i.componentType){case Ze.UNSIGNED_BYTE:return TI(this._wrapAccessor(zm,i));case Ze.UNSIGNED_SHORT:return TI(this._wrapAccessor(P1,i));case Ze.UNSIGNED_INT:return TI(this._wrapAccessor(I1,i))}}async getPositionData(t,r){if(t.attributes.POSITION==null)throw new G("gltf-loader-unsupported-feature","No POSITION vertex data found.");const i=await this.getAccessor(t.attributes.POSITION,r);if(i.componentType!==Ze.FLOAT)throw new G("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+Ze[i.componentType]);if(i.componentCount!==3)throw new G("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(Es,i)}async getNormalData(t,r){if(t.attributes.NORMAL==null)throw new G("gltf-loader-error","No NORMAL vertex data found.");const i=await this.getAccessor(t.attributes.NORMAL,r);if(i.componentType!==Ze.FLOAT)throw new G("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+Ze[i.componentType]);if(i.componentCount!==3)throw new G("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(Es,i)}async getTangentData(t,r){if(t.attributes.TANGENT==null)throw new G("gltf-loader-error","No TANGENT vertex data found.");const i=await this.getAccessor(t.attributes.TANGENT,r);if(i.componentType!==Ze.FLOAT)throw new G("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+Ze[i.componentType]);if(i.componentCount!==4)throw new G("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+i.componentCount.toFixed());return new Gl(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount)}async getTextureCoordinates(t,r){if(t.attributes.TEXCOORD_0==null)throw new G("gltf-loader-error","No TEXCOORD_0 vertex data found.");const i=await this.getAccessor(t.attributes.TEXCOORD_0,r);if(i.componentCount!==2)throw new G("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+i.componentCount.toFixed());if(i.componentType===Ze.FLOAT)return this._wrapAccessor(bd,i);if(!i.normalized)throw new G("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return yYe(i)}async getVertexColors(t,r){if(t.attributes.COLOR_0==null)throw new G("gltf-loader-error","No COLOR_0 vertex data found.");const i=await this.getAccessor(t.attributes.COLOR_0,r);if(i.componentCount!==4&&i.componentCount!==3)throw new G("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+i.componentCount.toFixed());if(i.componentCount===4){if(i.componentType===Ze.FLOAT)return this._wrapAccessor(Gl,i);if(i.componentType===Ze.UNSIGNED_BYTE)return this._wrapAccessor(zn,i);if(i.componentType===Ze.UNSIGNED_SHORT)return this._wrapAccessor(xy,i)}else if(i.componentCount===3){if(i.componentType===Ze.FLOAT)return this._wrapAccessor(Es,i);if(i.componentType===Ze.UNSIGNED_BYTE)return this._wrapAccessor(R1,i);if(i.componentType===Ze.UNSIGNED_SHORT)return this._wrapAccessor(M1,i)}throw new G("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+Ze[i.componentType])}hasPositions(t){return t.attributes.POSITION!==void 0}hasNormals(t){return t.attributes.NORMAL!==void 0}hasVertexColors(t){return t.attributes.COLOR_0!==void 0}hasTextureCoordinates(t){return t.attributes.TEXCOORD_0!==void 0}hasTangents(t){return t.attributes.TANGENT!==void 0}async getMaterial(t,r,i){let s=t.material?this._materialCache.get(t.material):void 0;if(!s){const n=t.material!=null?Bee(this.json.materials[t.material]):Bee(),o=n.pbrMetallicRoughness,a=this.hasVertexColors(t),l=this.getTexture(o.baseColorTexture,r),c=this.getTexture(n.normalTexture,r),u=i?this.getTexture(n.occlusionTexture,r):void 0,d=i?this.getTexture(n.emissiveTexture,r):void 0,p=i?this.getTexture(o.metallicRoughnessTexture,r):void 0,g=t.material!=null?t.material:-1;s={alphaMode:n.alphaMode,alphaCutoff:n.alphaCutoff,color:o.baseColorFactor,doubleSided:!!n.doubleSided,colorTexture:await l,normalTexture:await c,name:n.name,id:g,occlusionTexture:await u,emissiveTexture:await d,emissiveFactor:n.emissiveFactor,metallicFactor:o.metallicFactor,roughnessFactor:o.roughnessFactor,metallicRoughnessTexture:await p,hasVertexColors:a,ESRI_externalColorMixMode:n.extras.ESRI_externalColorMixMode,colorTextureTransform:o?.baseColorTexture?.extensions?.KHR_texture_transform,normalTextureTransform:n.normalTexture?.extensions?.KHR_texture_transform,occlusionTextureTransform:n.occlusionTexture?.extensions?.KHR_texture_transform,emissiveTextureTransform:n.emissiveTexture?.extensions?.KHR_texture_transform,metallicRoughnessTextureTransform:o?.metallicRoughnessTexture?.extensions?.KHR_texture_transform}}return s}async getTexture(t,r){if(!t)return;if((t.texCoord||0)!==0)throw new G("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const i=t.index,s=this.json.textures[i],n=hYe(s.sampler!=null?this.json.samplers[s.sampler]:{}),o=this._getTextureSourceId(s),a=this.json.images[o],l=await this._loadTextureImageData(i,s,r);return Xne(this._textureCache,i,()=>{const c=d=>d===33071||d===33648||d===10497,u=d=>{throw new G("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${d}`)};return{data:l,wrapS:c(n.wrapS)?n.wrapS:u(n.wrapS),wrapT:c(n.wrapT)?n.wrapT:u(n.wrapT),minFilter:n.minFilter,name:a.name,id:i}})}getNodeTransform(t){if(t===void 0)return pYe;let r=this._nodeTransformCache.get(t);if(!r){const i=this.getNodeTransform(this._getNodeParent(t)),s=this.json.nodes[t];s.matrix?r=Jr(be(),i,s.matrix):s.translation||s.rotation||s.scale?(r=gT(i),s.translation&&Ja(r,r,s.translation),s.rotation&&(mP[3]=Rj(mP,s.rotation),$l(r,r,mP[3],mP)),s.scale&&gN(r,r,s.scale)):r=gT(i),this._nodeTransformCache.set(t,r)}return r}_wrapAccessor(t,r){return new t(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*(r.entryCount-1)+r.componentByteSize*r.componentCount)}_resolveUri(t){return ja(t,this._baseUri)}_getNodeParent(t){return this._nodeParentMap.get(t)}_checkVersionSupported(){const t=V1.parse(this.json.asset.version,"glTF");fYe.validate(t)}_checkRequiredExtensionsSupported(){const t=this.json;if(t.extensionsRequired&&!t.extensionsRequired.every(r=>this._supportedExtensions.includes(r)))throw new G("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+t.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((t,r)=>{t.children&&t.children.forEach(i=>{this._nodeParentMap.set(i,r)})})}async _loadTextureImageData(t,r,i){const s=this._textureLoaders.get(t);if(s)return s;const n=this._createTextureLoader(r,i);return this._textureLoaders.set(t,n),n}_getTextureSourceId(t){if(t.extensions!==void 0&&t.extensions.KHR_texture_basisu!==null)return t.extensions.KHR_texture_basisu.source;if(t.source!==null)return t.source;throw new G("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(t,r){const i=this._getTextureSourceId(t),s=this.json.images[i];if(s.uri){if(s.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(s.uri),r);return new I_e(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(s.uri),r)}if(s.bufferView==null)throw new G("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(s.mimeType==null)throw new G("gltf-loader-unsupported-feature","Image mimeType must be defined.");const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,r);if(n.byteStride!=null)throw new G("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(n.byteOffset||0);return SZe(new Uint8Array(o.buffer,a,n.byteLength),s.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const t=await b8(Array.from(this._bufferLoaders.values())),r=await b8(Array.from(this._textureLoaders.values()));return t.reduce((i,s)=>i+(s?.byteLength??0),0)+r.reduce((i,s)=>i+(s?Jv(s)?s.data.byteLength:s.width*s.height*4:0),0)}}const pYe=Che(be(),Math.PI/2),fYe=new V1(2,0,"glTF"),mP=rh(),mYe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},gYe={[Ze.BYTE]:1,[Ze.UNSIGNED_BYTE]:1,[Ze.SHORT]:2,[Ze.UNSIGNED_SHORT]:2,[Ze.FLOAT]:4,[Ze.INT]:4,[Ze.UNSIGNED_INT]:4};function yYe(e){switch(e.componentType){case Ze.BYTE:return new $1(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case Ze.UNSIGNED_BYTE:return new O1(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case Ze.SHORT:return new Ty(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case Ze.UNSIGNED_SHORT:return new $T(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case Ze.UNSIGNED_INT:return new LT(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case Ze.FLOAT:return new bd(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount)}}let _Ye=0;async function k_e(e,t,r={},i=!0){const s=await tm.load(e,t,r),n="gltf_"+_Ye++,o={lods:[],materials:new Map,textures:new Map,meta:vYe(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await bYe(s,async(u,d,p,g)=>{const y=l.get(p)??0;l.set(p,y+1);const _=u.mode!==void 0?u.mode:bt.TRIANGLES,v=_===bt.TRIANGLES||_===bt.TRIANGLE_STRIP||_===bt.TRIANGLE_FAN?_:null;if(v==null)return void K.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+bt[_]+"). Skipping primitive.");if(!s.hasPositions(u))return void K.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const w=s.getPositionData(u,r),T=s.getMaterial(u,r,i),x=s.hasNormals(u)?s.getNormalData(u,r):null,S=s.hasTangents(u)?s.getTangentData(u,r):null,O=s.hasTextureCoordinates(u)?s.getTextureCoordinates(u,r):null,A=s.hasVertexColors(u)?s.getVertexColors(u,r):null,$=s.getIndexData(u,r),P={transform:gT(d),attributes:{position:await w,normal:x?await x:null,texCoord0:O?await O:null,color:A?await A:null,tangent:S?await S:null},indices:await $,primitiveType:v,material:xYe(o,await T,n)};let U=null;o.meta!=null&&o.meta.ESRI_lod!=null&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(U=o.meta.ESRI_lod.thresholds[p]),o.lods[p]=o.lods[p]||{parts:[],name:g,lodThreshold:U},o.lods[p].parts[y]=P});for(const u of o.lods)u.parts=u.parts.filter(d=>!!d);const c=await s.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri},customMeta:{},size:c}}function vYe(e){const t=e.json;let r=null;return t.nodes.forEach(i=>{const s=i.extras;s!=null&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(r=s)}),r}async function bYe(e,t){const r=e.json,i=r.scenes[r.scene||0].nodes,s=i.length>1,n=[];for(const a of i){const l=r.nodes[a];n.push(o(a,0)),wYe(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,u)=>o(c,u+1))}async function o(a,l){const c=r.nodes[a],u=e.getNodeTransform(a);if(c.weights!=null&&K.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const d=r.meshes[c.mesh];for(const p of d.primitives)n.push(t(p,u,l,d.name))}for(const d of c.children||[])n.push(o(d,l))}await Promise.all(n)}function wYe(e){return e.extensions&&e.extensions.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}function xYe(e,t,r){const i=n=>{const o=`${r}_tex_${n&&n.id}${n&&n.name?"_"+n.name:""}`;if(n&&!e.textures.has(o)){const a=oYe(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:TYe.includes(n.minFilter),noUnpackFlip:!0});e.textures.set(o,a)}return o},s=`${r}_mat_${t.id}_${t.name}`;if(!e.materials.has(s)){const n=nYe({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?i(t.colorTexture):void 0,textureNormal:t.normalTexture?i(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?i(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?i(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?i(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],colorTextureTransform:t.colorTextureTransform,normalTextureTransform:t.normalTextureTransform,occlusionTextureTransform:t.occlusionTextureTransform,emissiveTextureTransform:t.emissiveTextureTransform,metallicRoughnessTextureTransform:t.metallicRoughnessTextureTransform,metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor});e.materials.set(s,n)}return s}const TYe=[xt.LINEAR_MIPMAP_LINEAR,xt.LINEAR_MIPMAP_NEAREST];function SYe(e,t){switch(t){case bt.TRIANGLES:return EYe(e);case bt.TRIANGLE_STRIP:return CYe(e);case bt.TRIANGLE_FAN:return AYe(e)}}function EYe(e){return typeof e=="number"?NT(e):D0(e)?new Uint16Array(e):e}function CYe(e){const t=typeof e=="number"?e:e.length;if(t<3)return[];const r=t-2,i=vL(3*r);if(typeof e=="number"){let s=0;for(let n=0;n<r;n+=1)n%2==0?(i[s++]=n,i[s++]=n+1,i[s++]=n+2):(i[s++]=n+1,i[s++]=n,i[s++]=n+2)}else{let s=0;for(let n=0;n<r;n+=1)n%2==0?(i[s++]=e[n],i[s++]=e[n+1],i[s++]=e[n+2]):(i[s++]=e[n+1],i[s++]=e[n],i[s++]=e[n+2])}return i}function AYe(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const r=t-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if(typeof e=="number"){let a=0;for(let l=0;l<r;++l)i[a++]=0,i[a++]=l+1,i[a++]=l+2;return i}const s=e[0];let n=e[1],o=0;for(let a=0;a<r;++a){const l=e[a+2];i[o++]=s,i[o++]=n,i[o++]=l,n=l}return i}class OYe{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}}class RYe{constructor(t,r,i){this.name=t,this.lodThreshold=r,this.pivotOffset=i,this.stageResources=new OYe,this.numberOfVertices=0}}const Wf=K.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function z_e(e,t){const r=await PYe(e,t),i=await DYe(r.textureDefinitions??{},t);let s=0;for(const n in i)if(i.hasOwnProperty(n)){const o=i[n];s+=o?.image?o.image.width*o.image.height*4:0}return{resource:r,textures:i,size:s+a0e(r)}}async function PYe(e,t){const r=t!=null&&t.streamDataRequester;if(r)return MYe(e,r,t);const i=await Yu(ii(e,t));if(i.ok===!0)return i.value.data;W1(i.error),B_e(i.error)}async function MYe(e,t,r){const i=await Yu(t.request(e,"json",r));if(i.ok===!0)return i.value;W1(i.error),B_e(i.error.details.url)}function B_e(e){throw new G("",`Request for object resource failed: ${e}`)}function IYe(e){const t=e.params,r=t.topology;let i=!0;switch(t.vertexAttributes||(Wf.warn("Geometry must specify vertex attributes"),i=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=t.faces;if(n){if(t.vertexAttributes)for(const o in t.vertexAttributes){const a=n[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(Wf.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),i=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(Wf.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),i=!1)):(Wf.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),i=!1)}}else Wf.warn("Indexed geometries must specify faces"),i=!1;break}default:Wf.warn(`Unsupported topology '${r}'`),i=!1}e.params.material||(Wf.warn("Geometry requires material"),i=!1);const s=e.params.vertexAttributes;for(const n in s)s[n].values||(Wf.warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function $Ye(e,t){const r=new Array,i=new Array,s=new Array,n=new S2,o=e.resource,a=V1.parse(o.version||"1.0","wosr");FYe.validate(a);const l=o.model.name,c=o.model.geometries,u=o.materialDefinitions??{},d=e.textures;let p=0;const g=new Map;for(let y=0;y<c.length;y++){const _=c[y];if(!IYe(_))continue;const v=NYe(_),w=_.params.vertexAttributes,T=[];for(const L in w){const N=w[L],Z=N.values;T.push([L,new Fe(Z,N.valuesPerElement,!0)])}const x=[];if(_.params.topology!=="PerAttributeArray"){const L=_.params.faces;for(const N in L)x.push([N,L[N].values])}const S=v.texture,O=d&&d[S];if(O&&!g.has(S)){const{image:L,parameters:N}=O,Z=new lb(L,N);i.push(Z),g.set(S,Z)}const A=g.get(S),$=A?A.id:void 0,P=v.material;let U=n.get(P,S);if(U==null){const L=u[P.substring(P.lastIndexOf("/")+1)].params;L.transparency===1&&(L.transparency=0);const N=O&&O.alphaChannelUsage,Z=L.transparency>0||N==="transparency"||N==="maskAndTransparency",W=O?V_e(O.alphaChannelUsage):void 0,V={ambient:fa(L.diffuse),diffuse:fa(L.diffuse),opacity:1-(L.transparency||0),transparent:Z,textureAlphaMode:W,textureAlphaCutoff:.33,textureId:$,initTextureTransparent:!0,doubleSided:!0,cullFace:oi.None,colorMixMode:L.externalColorMixMode||"tint",textureAlphaPremultiplied:O?.parameters.preMultiplyAlpha??!1};t!=null&&t.materialParamsMixin&&Object.assign(V,t.materialParamsMixin),U=new tf(V),n.set(P,S,U)}s.push(U);const I=new Cs(U,T,x);p+=x.find(L=>L[0]===E.POSITION)?.[1].length??0,r.push(I)}return{engineResources:[{name:l,stageResources:{textures:i,materials:s,geometries:r},pivotOffset:o.model.pivotOffset,numberOfVertices:p,lodThreshold:null}],referenceBoundingBox:LYe(r)}}function LYe(e){const t=mi();return e.forEach(r=>{const i=r.boundingInfo;i!=null&&(Zp(t,i.bbMin),Zp(t,i.bbMax))}),t}async function DYe(e,t){const r=new Array;for(const n in e){const o=e[n],a=o.images[0].data;if(!a){Wf.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,u=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",d={noUnpackFlip:!0,wrap:{s:Ct.REPEAT,t:Ct.REPEAT},preMultiplyAlpha:V_e(u)!==Gr.Opaque},p=t!=null&&t.disableTextures?Promise.resolve(null):Vm(l,t);r.push(p.then(g=>({refId:c,image:g,parameters:d,alphaChannelUsage:u})))}const i=await Promise.all(r),s={};for(const n of i)s[n.refId]=n;return s}function V_e(e){switch(e){case"mask":return Gr.Mask;case"maskAndTransparency":return Gr.MaskBlend;case"none":return Gr.Opaque;default:return Gr.Blend}}function NYe(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const FYe=new V1(1,2,"wosr"),qb=2.1;async function G_e(e,t){const r=j_e(wB(e));if(r.fileType==="wosr"){const d=await(t.cache?t.cache.loadWOSR(r.url,t):z_e(r.url,t)),{engineResources:p,referenceBoundingBox:g}=$Ye(d,t);return{lods:p,referenceBoundingBox:g,isEsriSymbolResource:!1,isWosr:!0}}const i=await(t.cache?t.cache.loadGLTF(r.url,t,!!t.usePBR):k_e(new F_e(t.streamDataRequester),r.url,t,t.usePBR)),s=i.model.meta?.ESRI_proxyEllipsoid,n=i.meta.isEsriSymbolResource&&s!=null&&i.meta.uri.includes("/RealisticTrees/");n&&!i.customMeta.esriTreeRendering&&(i.customMeta.esriTreeRendering=!0,BYe(i,s));const o=!!t.usePBR,a=i.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:n,mrrFactors:[...LWe]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[...I4]},l={...t.materialParamsMixin,treeRendering:n},{engineResources:c,referenceBoundingBox:u}=H_e(i,a,l,t.skipHighLods&&r.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:r.specifiedLodIndex});return{lods:c,referenceBoundingBox:u,isEsriSymbolResource:i.meta.isEsriSymbolResource,isWosr:!1}}function j_e(e){const t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:t[4]!=null?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function H_e(e,t,r,i){const s=e.model,n=new Array,o=new Map,a=new Map,l=s.lods.length,c=mi();return s.lods.forEach((u,d)=>{const p=i.skipHighLods===!0&&(l>1&&d===0||l>3&&d===1)||i.skipHighLods===!1&&i.singleLodIndex!=null&&d!==i.singleLodIndex;if(p&&d!==0)return;const g=new RYe(u.name,u.lodThreshold,[0,0,0]);u.parts.forEach(y=>{const _=p?new tf({}):UYe(s,y,g,t,r,o,a),{geometry:v,vertexCount:w}=kYe(y,_??new tf({})),T=v.boundingInfo;T!=null&&d===0&&(Zp(c,T.bbMin),Zp(c,T.bbMax)),_!=null&&(g.stageResources.geometries.push(v),g.numberOfVertices+=w)}),p||n.push(g)}),{engineResources:n,referenceBoundingBox:c}}function UYe(e,t,r,i,s,n,o){const a=t.material+(t.attributes.normal?"_normal":"")+(t.attributes.color?"_color":"")+(t.attributes.texCoord0?"_texCoord0":"")+(t.attributes.tangent?"_tangent":""),l=e.materials.get(t.material),c=t.attributes.texCoord0!=null,u=t.attributes.normal!=null;if(l==null)return null;const d=zYe(l.alphaMode);if(!n.has(a)){if(c){const O=(A,$=!1)=>{if(A!=null&&!o.has(A)){const P=e.textures.get(A);if(P!=null){const U=P.data;o.set(A,new lb(Jv(U)?U.data:U,{...P.parameters,preMultiplyAlpha:!Jv(U)&&$,encoding:Jv(U)&&U.encoding!=null?U.encoding:void 0}))}}};O(l.textureColor,d!==Gr.Opaque),O(l.textureNormal),O(l.textureOcclusion),O(l.textureEmissive),O(l.textureMetallicRoughness)}const g=l.color[0]**(1/qb),y=l.color[1]**(1/qb),_=l.color[2]**(1/qb),v=l.emissiveFactor[0]**(1/qb),w=l.emissiveFactor[1]**(1/qb),T=l.emissiveFactor[2]**(1/qb),x=l.textureColor!=null&&c?o.get(l.textureColor):null,S=n_e({normalTexture:l.textureNormal,metallicRoughnessTexture:l.textureMetallicRoughness,metallicFactor:l.metallicFactor,roughnessFactor:l.roughnessFactor,emissiveTexture:l.textureEmissive,emissiveFactor:l.emissiveFactor,occlusionTexture:l.textureOcclusion});n.set(a,new tf({...i,transparent:d===Gr.Blend,customDepthTest:T1.Lequal,textureAlphaMode:d,textureAlphaCutoff:l.alphaCutoff,diffuse:[g,y,_],ambient:[g,y,_],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?oi.None:oi.Back,hasVertexColors:!!t.attributes.color,hasVertexTangents:!!t.attributes.tangent,normalType:u?wr.Attribute:wr.ScreenDerivative,castShadows:!0,receiveSSAO:!0,textureId:x?.id,colorMixMode:l.colorMixMode,normalTextureId:l.textureNormal!=null&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:x!=null&&!!x.parameters.preMultiplyAlpha,occlusionTextureId:l.textureOcclusion!=null&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:l.textureEmissive!=null&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:l.textureMetallicRoughness!=null&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[v,w,T],mrrFactors:S?[...nW]:[l.metallicFactor,l.roughnessFactor,i.mrrFactors[2]],isSchematic:S,colorTextureTransformMatrix:Rp(l.colorTextureTransform),normalTextureTransformMatrix:Rp(l.normalTextureTransform),occlusionTextureTransformMatrix:Rp(l.occlusionTextureTransform),emissiveTextureTransformMatrix:Rp(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:Rp(l.metallicRoughnessTextureTransform),...s}))}const p=n.get(a);if(r.stageResources.materials.push(p),c){const g=y=>{y!=null&&r.stageResources.textures.push(o.get(y))};g(l.textureColor),g(l.textureNormal),g(l.textureOcclusion),g(l.textureEmissive),g(l.textureMetallicRoughness)}return p}function kYe(e,t){const r=e.attributes.position.count,i=SYe(e.indices||r,e.primitiveType),s=Vi(3*r),{typedBuffer:n,typedBufferStride:o}=e.attributes.position;XT(s,n,e.transform,3,o);const a=[[E.POSITION,new Fe(s,3,!0)]],l=[[E.POSITION,i]];if(e.attributes.normal!=null){const c=Vi(3*r),{typedBuffer:u,typedBufferStride:d}=e.attributes.normal;vy(gP,e.transform),F1(c,u,gP,3,d),a.push([E.NORMAL,new Fe(c,3,!0)]),l.push([E.NORMAL,i])}if(e.attributes.tangent!=null){const c=Vi(4*r),{typedBuffer:u,typedBufferStride:d}=e.attributes.tangent;vy(gP,e.transform),uW(c,u,gP,4,d),a.push([E.TANGENT,new Fe(c,4,!0)]),l.push([E.TANGENT,i])}if(e.attributes.texCoord0!=null){const c=Vi(2*r),{typedBuffer:u,typedBufferStride:d}=e.attributes.texCoord0;hW(c,u,2,d),a.push([E.UV0,new Fe(c,2,!0)]),l.push([E.UV0,i])}if(e.attributes.color!=null){const c=new Uint8Array(4*r);e.attributes.color.elementCount===4?e.attributes.color instanceof Gl?eD(c,e.attributes.color,255):e.attributes.color instanceof zn?dW(c,e.attributes.color):e.attributes.color instanceof xy&&eD(c,e.attributes.color,1/256):(c.fill(255),e.attributes.color instanceof Es?jL(c,e.attributes.color,255,4):e.attributes.color instanceof R1?dO(c,e.attributes.color.typedBuffer,4,e.attributes.color.typedBufferStride):e.attributes.color instanceof M1&&jL(c,e.attributes.color,1/256,4)),a.push([E.COLOR,new Fe(c,4,!0)]),l.push([E.COLOR,i])}return{geometry:new Cs(t,a,l),vertexCount:r}}const gP=$i();function zYe(e){switch(e){case"BLEND":return Gr.Blend;case"MASK":return Gr.Mask;case"OPAQUE":case null:case void 0:return Gr.Opaque}}function BYe(e,t){for(let r=0;r<e.model.lods.length;++r){const i=e.model.lods[r];for(const s of i.parts){const n=s.attributes.normal;if(n==null)return;const o=s.attributes.position,a=o.count,l=C(),c=C(),u=C(),d=new Uint8Array(4*a),p=new Float64Array(3*a),g=Fn(be(),s.transform);let y=0,_=0;for(let v=0;v<a;v++){o.getVec(v,c),n.getVec(v,l),Ue(c,c,s.transform),ce(u,c,t.center),XI(u,u,t.radius);const w=u[2],T=Se(u),x=Math.min(.45+.55*T*T,1);XI(u,u,t.radius),g!==null&&Ue(u,u,g),pe(u,u),r+1!==e.model.lods.length&&e.model.lods.length>1&&Lr(u,u,l,w>-1?.2:Math.min(-4*w-3.8,1)),p[y]=u[0],p[y+1]=u[1],p[y+2]=u[2],y+=3,d[_]=255*x,d[_+1]=255*x,d[_+2]=255*x,d[_+3]=255,_+=4}s.attributes.normal=new Es(p),s.attributes.color=new zn(d)}}}var Fmt=Object.freeze(Object.defineProperty({__proto__:null,fetch:G_e,gltfToEngineResources:H_e,parseUrl:j_e},Symbol.toStringTag,{value:"Module"}));const VYe=()=>!!ne("enable-feature:force-wosr"),Umt=()=>!!ne("enable-feature:direct-3d-object-feature-layer-display"),GYe=()=>ne.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0),jYe=()=>ne.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0),kmt=()=>!!ne("enable-i3s-patching"),HYe=()=>ne.add("enable-i3s-patching",!0,!0,!0),WYe=()=>ne.add("enable-i3s-patching",!1,!0,!0),zmt=()=>!!ne("enable-feature:SceneLayer-editing"),qYe=(e="i3s-patching")=>{switch(WYe(),jYe(),ne.add("enable-feature:SceneLayer-editing",!0,!0,!0),e){case"feature-layer-view":GYe();break;case"i3s-patching":HYe()}};qYe("i3s-patching");let uU={};async function XYe(e,t){try{return{data:(await pW(e,t)).data,baseUrl:QV(e),styleUrl:e}}catch(r){return W1(r),null}}function ZYe(e,t,r){const i=t.portal!=null?t.portal:ba.getDefault();let s;const n=`${i.url} - ${i.user&&i.user.username} - ${e}`;return uU[n]||(uU[n]=YYe(e,i,r).then(o=>(s=o,o.fetchData())).then(o=>({data:o,baseUrl:s.itemUrl??"",styleName:e}))),uU[n]}function YYe(e,t,r){return t.load(r).then(()=>{const i=new Ep({disableExtraQuery:!0,query:`owner:${Vee} AND type:${Gee} AND typekeywords:"${e}"`});return t.queryItems(i,r)}).then(({results:i})=>{let s=null;const n=e.toLowerCase();if(i&&Array.isArray(i)){for(const o of i)if(o.typeKeywords?.some(l=>l.toLowerCase()===n)&&o.type===Gee&&o.owner===Vee){s=o;break}}if(!s)throw new G("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return s.load(r)})}function W_e(e,t,r){return e&&e.styleUrl!=null?XYe(e.styleUrl,r):e&&e.styleName!=null?ZYe(e.styleName,t,r):Promise.reject(new G("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function q_e(e){return e===null||e.type==="CIMSymbolReference"?e:{type:"CIMSymbolReference",symbol:e}}function X_e(e,t,r=["gltf"]){if(t==="cimRef")return e.cimRef;if(e.formatInfos&&!VYe())for(const i of r){const s=e.formatInfos.find(n=>n.type===i);if(s)return s.href}return e.webRef}function pW(e,t){const r={responseType:"json",query:{f:"json"},...t};return ii(ld(e),r)}const Vee="esri_en",Gee="Style",JYe="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json",wS={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function KYe(e,t=wS){if(!e)return{symbol:null};const{retainId:r=wS.retainId,ignoreDrivers:i=wS.ignoreDrivers,hasLabelingContext:s=wS.hasLabelingContext,retainCIM:n=wS.retainCIM}=t;let o=null;if(_1(e)||e instanceof f2)o=e.clone();else if(e.type==="cim"){const a=e.data?.symbol?.type;if(a!=="CIMPointSymbol")return{error:new G("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${a||"unknown"}' is unsupported in 3D`,{symbol:e})};o=n?e.clone():V0.fromCIMSymbol(e)}else if(e instanceof K1)o=uN.fromSimpleLineSymbol(e);else if(e instanceof fN)o=V0.fromSimpleMarkerSymbol(e);else if(e instanceof dN)o=V0.fromPictureMarkerSymbol(e);else if(e instanceof gG)o=t.geometryType&&t.geometryType==="mesh"?hN.fromSimpleFillSymbol(e):pN.fromSimpleFillSymbol(e);else{if(!(e instanceof F3))return{error:new G("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${e.type||e.declaredClass}' is unsupported in 3D`,{symbol:e})};o=s?cN.fromTextSymbol(e):V0.fromTextSymbol(e)}return r&&o&&o.type!=="cim"&&(o.id=e.id),i&&_1(o)&&o.symbolLayers.forEach(a=>a.ignoreDrivers=!0),{symbol:o}}function Bmt(e,t,r,i){const s=Z_e(e,{},{context:i,isLabelSymbol:!1});s!=null&&(t[r]=s)}function Vmt(e,t,r,i){const s=Z_e(e,{},{context:i,isLabelSymbol:!0});s!=null&&(t[r]=s)}function jee(e){return e instanceof p2||e instanceof f2}function Z_e(e,t,r){if(e==null)return null;const{context:i,isLabelSymbol:s}=r,n=i?.origin,o=i?.messages;if(n==="web-scene"&&!jee(e)){const a=KYe(e,{retainCIM:!0,hasLabelingContext:s});return a.symbol!=null?a.symbol.write(t,i):(o?.push(new G("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:e,context:i,error:a.error})),null)}return(n==="web-map"||n==="portal-item"&&!ULe(i?.layer))&&jee(e)?(o?.push(new G("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:e,context:i})),null):e.write(t,i)}function Y_e(e,t){return JMe(e,null,t)}function QYe(e,t,r,i){const s=e.name;return s==null?Promise.reject(new G("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):e.styleName&&e.styleName==="Esri2DPointSymbolsStyle"?eJe(s,t,i):W_e(e,t,i).then(n=>mW(Sl(n),s,t,r,X_e,i))}function fW(e,t){return t.items.find(r=>r.name===e)}function mW(e,t,r,i,s,n){const o=r&&r.portal!=null?r.portal:ba.getDefault(),a={portal:o,url:Us(e.baseUrl),origin:"portal-item"},l=fW(t,e.data);if(!l){const g=`The symbol name '${t}' could not be found`;return Promise.reject(new G("symbolstyleutils:symbol-name-not-found",g,{symbolName:t}))}let c=y1(s(l,i),a),u=l.thumbnail?.href??null;const d=l.thumbnail&&l.thumbnail.imageData;WZe()&&(c=wB(c)??"",u=wB(u));const p={portal:o,url:Us(QV(c)),origin:"portal-item"};return pW(c,n).then(g=>{const y=i==="cimRef"?q_e(g.data):g.data,_=Y_e(y,p);if(_&&_1(_)){if(u){const v=y1(u,a);_.thumbnail=new zv({url:v})}else d&&(_.thumbnail=new zv({url:`data:image/png;base64,${d}`}));e.styleUrl?_.styleOrigin=new pA({portal:r.portal,styleUrl:e.styleUrl,name:t}):e.styleName&&(_.styleOrigin=new pA({portal:r.portal,styleName:e.styleName,name:t}))}return _})}function eJe(e,t,r){const i=JYe.replaceAll(/\{SymbolName\}/gi,e),s=t.portal!=null?t.portal:ba.getDefault();return pW(i,r).then(n=>{const o=q_e(n.data);return Y_e(o,{portal:s,url:Us(QV(i)),origin:"portal-item"})})}var tJe=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:mW,getStyleItemFromStyle:fW,resolveWebStyleSymbol:QYe},Symbol.toStringTag,{value:"Module"}));async function rJe(e){if(e===null||e.styleName==null&&e.styleUrl==null)return null;const t=e.name;if(t==null)throw new G("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const r={portal:e.portal},i=await W_e(e,r).catch(()=>null);if(i===null)return null;const s=fW(t,i.data);if(s&&!s.formatInfos?.some(a=>a.type==="gltf_basisu"))return null;const n=await mW(i,t,r,"webRef",(a,l)=>X_e(a,l,["gltf_basisu","gltf"])).catch(()=>null);if(n===null||n.type!=="point-3d")return null;const o=n.symbolLayers.items[0];return o.type==="object"?o.resource:null}class iJe{constructor(t,r,i){this._elementSize=r,this._buffer=rr.createVertex(t,gr.STATIC_DRAW),this.resize(i)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(t,r,i,s=0){const n=new Uint8Array(this.array,t*this.elementSize,(r-t)*this.elementSize);new Uint8Array(i.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(t,r){const i=t*this._elementSize,s=r*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),i,i,s)}resize(t){const r=t*this._elementSize,i=new ArrayBuffer(r);this._array&&(t>=this._capacity?new Uint8Array(i).set(new Uint8Array(this._array)):new Uint8Array(i).set(new Uint8Array(this._array).subarray(0,t*this._elementSize))),this._array=i,this._buffer.setSize(r),this._capacity=t}}class sJe{constructor(t){this.modelOriginHi=t.getField(E.MODELORIGINHI,Es),this.modelOriginLo=t.getField(E.MODELORIGINLO,Es),this.model=t.getField(E.MODEL,wd),this.modelNormal=t.getField(E.MODELNORMAL,wd),this.featureAttribute=t.getField(E.INSTANCEFEATUREATTRIBUTE,Gl),this.color=t.getField(E.INSTANCECOLOR,zn),this.objectAndLayerIdColor=t.getField(E.INSTANCEOBJECTANDLAYERIDCOLOR,zn)}}class Hee{constructor(t,r){this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=t,this._instanceBufferLayout=r,this._elementSize=r.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const t=this._headIndex,r=this._tailIndex;return t>=r?t-r:t+this._capacity-r}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){Ye(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){Ye(this._updating,"not updating"),this.size<mwe*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){Ye(this._updating,"not updating"),this.isFull&&this._grow();const t=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=t,this._captureFirstIndex=!1),this._incrementHead(),Ye(this._headIndex!==this._tailIndex,"invalid pointers"),t}freeTail(){Ye(this._updating,"not updating"),Ye(this.size>0,"invalid size");const t=this._tailIndex===this._firstIndex;this._incrementTail(),t&&(this._firstIndex=this._tailIndex)}_grow(){const t=Math.max(tD,Math.floor(this._capacity*CD));this._resize(t)}_shrink(){const t=Math.max(tD,Math.floor(this._capacity*fwe));this._resize(t)}_resize(t){if(Ye(this._updating,"not updating"),t===this._capacity)return;const r=new iJe(this._rctx,this._elementSize,t);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const i=this.size,s=this._compactInstances(r);Ye(s===i,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=t,this._buffer=r,this._view=new sJe(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(t){const r=this._headIndex,i=this._tailIndex;return i<r?(this._buffer.copyRange(i,r,t),r-i):i>r?(this._buffer.copyRange(i,this._capacity,t),r>0&&this._buffer.copyRange(0,r,t,this._capacity-i),r+(this._capacity-i)):0}_incrementHead(t=1){this._headIndex=(this._headIndex+t)%this._capacity}_incrementTail(t=1){this._tailIndex=(this._tailIndex+t)%this._capacity}_transferRange(t,r){t<r?this._buffer.transferRange(t,r):t>r&&(r>0&&this._buffer.transferRange(0,r),this._buffer.transferRange(t,this._capacity))}}const tD=64;var Ti;function nJe(e){let t=Li().mat4f64(E.LOCALTRANSFORM).mat4f64(E.GLOBALTRANSFORM).vec4f64(E.BOUNDINGSPHERE).vec3f64(E.MODELORIGIN).mat3f(E.MODEL).mat3f(E.MODELNORMAL).vec2f(E.MODELSCALEFACTORS);return e.includes(E.FEATUREATTRIBUTE)&&(t=t.vec4f(E.FEATUREATTRIBUTE)),e.includes(E.COLOR)&&(t=t.vec4u8(E.COLOR)),e.includes(E.OBJECTANDLAYERIDCOLOR)&&(t=t.vec4u8(E.OBJECTANDLAYERIDCOLOR)),t=t.u8(E.STATE).u8(E.LODLEVEL),t}(function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",e[e.ACTIVE=18]="ACTIVE"})(Ti||(Ti={}));class Wee{constructor(t){this.localTransform=t.getField(E.LOCALTRANSFORM,wy),this.globalTransform=t.getField(E.GLOBALTRANSFORM,wy),this.modelOrigin=t.getField(E.MODELORIGIN,Qa),this.model=t.getField(E.MODEL,wd),this.modelNormal=t.getField(E.MODELNORMAL,wd),this.modelScaleFactors=t.getField(E.MODELSCALEFACTORS,bd),this.boundingSphere=t.getField(E.BOUNDINGSPHERE,A1),this.featureAttribute=t.getField(E.FEATUREATTRIBUTE,Gl),this.color=t.getField(E.COLOR,zn),this.objectAndLayerIdColor=t.getField(E.OBJECTANDLAYERIDCOLOR,zn),this.state=t.getField(E.STATE,zm),this.lodLevel=t.getField(E.LODLEVEL,zm)}}let Vw=class extends xe{constructor(e,t){super(e),this.events=new cs,this._capacity=0,this._size=0,this._next=0,this._layout=nJe(t),this._capacity=tD,this._buffer=this._layout.createBuffer(this._capacity),this._view=new Wee(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,Ti.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const t=this._view.state;Ye(e>=0&&e<this._capacity&&(t.get(e)&Ti.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,Ti.ACTIVE)?this._setStateFlags(e,Ti.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const t=this._view.state;Ye(e>=0&&e<this._capacity&&(t.get(e)&Ti.ALLOCATED)!=0,"invalid instance handle"),t.set(e,0),this._size--}setLocalTransform(e,t,r=!0){this._view.localTransform.setMat(e,t),r&&this.updateModelTransform(e)}getLocalTransform(e,t){this._view.localTransform.getMat(e,t)}setGlobalTransform(e,t,r=!0){this._view.globalTransform.setMat(e,t),r&&this.updateModelTransform(e)}getGlobalTransform(e,t){this._view.globalTransform.getMat(e,t)}updateModelTransform(e){const t=this._view,r=ol,i=gh;t.localTransform.getMat(e,qee),t.globalTransform.getMat(e,hU);const s=Jr(hU,hU,qee);se(r,s[12],s[13],s[14]),t.modelOrigin.setVec(e,r),Ku(i,s),t.model.setMat(e,i);const n=X$e(ol,s);n.sort(),t.modelScaleFactors.set(e,0,n[1]),t.modelScaleFactors.set(e,1,n[2]),nb(i,i),Qu(i,i),t.modelNormal.setMat(e,i),this._setStateFlags(e,Ti.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,t){const r=this._view;r.model.getMat(e,gh),r.modelOrigin.getVec(e,ol),t[0]=gh[0],t[1]=gh[1],t[2]=gh[2],t[3]=0,t[4]=gh[3],t[5]=gh[4],t[6]=gh[5],t[7]=0,t[8]=gh[6],t[9]=gh[7],t[10]=gh[8],t[11]=0,t[12]=ol[0],t[13]=ol[1],t[14]=ol[2],t[15]=1}applyShaderTransformation(e,t){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,t)}getCombinedModelTransform(e,t){return this.getModelTransform(e,t),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,t),t}getCombinedLocalTransform(e,t){this._view.localTransform.getMat(e,t),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,t)}getCombinedMaxScaleFactor(e){let t=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(ol,this,e),t*=Math.max(ol[0],ol[1],ol[2])),t}getCombinedMedianScaleFactor(e){let t=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(ol,this,e),t*=oJe(ol[0],ol[1],ol[2])),t}getModel(e,t){this._view.model.getMat(e,t)}setFeatureAttribute(e,t){this._view.featureAttribute.setVec(e,t)}getFeatureAttribute(e,t){this._view.featureAttribute.getVec(e,t)}setColor(e,t){this._view.color.setVec(e,t)}setObjectAndLayerIdColor(e,t){this._view.objectAndLayerIdColor.setVec(e,t)}setVisible(e,t){t!==this.getVisible(e)&&(this._setStateFlag(e,Ti.VISIBLE,t),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,Ti.VISIBLE)}setHighlight(e,t){t!==this.getHighlight(e)&&(this._setStateFlag(e,Ti.HIGHLIGHT,t),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,Ti.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let t=0;for(let r=0;r<this._capacity;++r)this.getState(r)&e&&++t;return t}_setStateFlags(e,t){const r=this._view.state;t=r.get(e)|t,r.set(e,t)}_clearStateFlags(e,t){const r=this._view.state;t=r.get(e)&~t,r.set(e,t)}_setStateFlag(e,t,r){r?this._setStateFlags(e,t):this._clearStateFlags(e,t)}_getStateFlag(e,t){return!!(this._view.state.get(e)&t)}_grow(){this._capacity=Math.max(tD,Math.floor(this._capacity*CD)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new Wee(this._buffer)}_findSlot(){const e=this._view.state;let t=this._next;for(;e.get(t)&Ti.ALLOCATED;)t=t+1===this._capacity?0:t+1;return this._next=t+1===this._capacity?0:t+1,t}};function oJe(e,t,r){return Math.max(Math.min(e,t),Math.min(Math.max(e,t),r))}h([f({constructOnly:!0})],Vw.prototype,"shaderTransformation",void 0),h([f()],Vw.prototype,"_size",void 0),h([f({readOnly:!0})],Vw.prototype,"size",null),Vw=h([F("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],Vw);const ol=C(),gh=$i(),qee=be(),hU=be();class aJe extends nd{constructor(t,r){super(i=>this._instanceData.view.boundingSphere.getVec(i,this._tmpSphere),{maximumDepth:25}),this._instanceData=t,this._boundingSphere=r,this._tmpSphere=ls(),this._tmpMat4=be()}addInstance(t){const r=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(t,this._tmpMat4);Ue(this._tmpSphere,this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*_T(i),r.setVec(t,this._tmpSphere),this.add([t])}removeInstance(t){this.remove([t])}}class lJe{constructor(t,r){this._worldSpaceRadius=t,this._minScreenSpaceRadii=r}selectLevel(t,r,i){const s=i.computeScreenPixelSizeAt(t),n=this._worldSpaceRadius*r/s;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)n>=this._minScreenSpaceRadii[a]&&(o=a);return o}}class cJe extends qN{constructor(t,r,i,s,n,o){super(t,r),this.layerUid=t,this.graphicUid=r,this.geometryId=i,this.triangleNr=s,this.baseBoundingSphere=n,this.numLodLevels=o}}function gW(e){return Cd(e)&&e.intersector===Ii.LOD&&!!e.target}class uJe{constructor(t,r){const i=t.renderContext.rctx,s=r.geometry;this._materialRepository=t.materialRepository,s.material.setParameters({instancedDoublePrecision:!0});const n=s.material.createBufferWriter(),o=n.vertexBufferLayout,a=n.elementCount(s),l=o.createBuffer(a);n.write(null,null,s,l,0),this.geometry=s,this.material=s.material,this.glMaterials=new Vye(s.material,this._materialRepository),this.vertexBufferLayout=o,this.vbo=rr.createVertex(i,gr.STATIC_DRAW,l.buffer),this.vao=new Ed(i,dr,{geometry:Wl(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(t,r,i,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,t.transform.transform,t,i,s,(u,d,p,g,y)=>{if(u>=0){if(r!=null&&!r(t.rayBegin,t.rayEnd,u))return;const _=new cJe(o.layerUid,o.graphicUid(n),c,p,a,l);if((t.results.min.drapedLayerOrder==null||y>=t.results.min.drapedLayerOrder)&&(t.results.min.dist==null||u<t.results.min.dist)&&t.results.min.set(Ii.LOD,_,u,d,t.transform.transform,y),t.options.store!==so.MIN&&(t.results.max.drapedLayerOrder==null||y>=t.results.max.drapedLayerOrder)&&(t.results.max.dist==null||u>t.results.max.dist)&&t.results.max.set(Ii.LOD,_,u,d,t.transform.transform,y),t.options.store===so.ALL){const v=Nj(t.results.min.ray);v.set(Ii.LOD,_,u,d,t.transform.transform,y),t.results.all.push(v)}}})}}class yW{static async create(t,r,i){const s=await Promise.allSettled(r.components.map(o=>t.controller.schedule(()=>new uJe(t,o),i))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(v3);if(Hs(i)||n.length!==s.length){n.forEach(o=>o.destroy()),Jt(i);for(const o of s)if(o.status==="rejected")throw o.reason}return new yW(r.minScreenSpaceRadius,n)}constructor(t,r){this.minScreenSpaceRadius=t,this.components=r}destroy(){this.components.forEach(t=>t.destroy())}intersect(t,r,i,s,n,o,a){this.components.forEach(l=>l.intersect(t,r,i,s,n,o,this.boundingSphere,a))}get boundingBox(){if(this._boundingBox==null){const t=mi();this.components.forEach(r=>{r.boundingInfo!=null&&(Zp(t,r.boundingInfo.bbMin),Zp(t,r.boundingInfo.bbMax))}),this._boundingBox=t}return this._boundingBox}get boundingSphere(){if(this._boundingSphere==null){const t=this.boundingBox,r=C();td(t,r),this._boundingSphere={center:r,radius:.5*jue(t)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((t,r)=>t+r.triangleCount,0)}}const hJe=e=>{const t=e.baseBoundingSphere.radius,r=e.levels.map(i=>i.minScreenSpaceRadius);return new lJe(t,r)};let du=class extends xe{constructor(e,t){super(e),this.type=Ii.LOD,this.isGround=!1,this._handles=new gi,this._levels=[],this._defaultRenderInstanceData=[new Array],this._highlightRenderInstanceData=[new Array],this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new lt,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[ae.OPAQUE_MATERIAL,ae.TRANSPARENT_MATERIAL],this.canRender=!0,this._instanceData=new Vw({shaderTransformation:e.shaderTransformation},e.optionalFields),this._handles.add(t.registerTask(at.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=pJe(this.optionalFields),this._glInstanceBufferLayout=Wl(this._instanceBufferLayout,1),this._handles.add([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))])}destroy(){this._handles.destroy()}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._allRenderInstanceData.forEach(t=>t.forEach(r=>{e.cpu+=r.memoryUsage.cpu,e.gpu+=r.memoryUsage.gpu})),e}get renderStats(){const e=this._instanceData.size,t=[];return this._levels.forEach((r,i)=>{const s=this._allRenderInstanceData[0][i].size+this._allRenderInstanceData[1][i].size,n=r.triangleCount;t.push({renderedInstances:s,renderedTriangles:s*n,trianglesPerInstance:n})}),{totalInstances:e,renderedInstances:t.reduce((r,i)=>r+i.renderedInstances,0),renderedTriangles:t.reduce((r,i)=>r+i.renderedTriangles,0),levels:t}}async initializeRenderContext(e,t){this._context=e;const r=e.renderContext.rctx,i=await Promise.allSettled(this.symbol.levels.map(n=>(this._defaultRenderInstanceData[0].push(new Hee(r,this._instanceBufferLayout)),this._highlightRenderInstanceData[0].push(new Hee(r,this._instanceBufferLayout)),yW.create(e,n,t)))),s=i.map(n=>n.status==="fulfilled"?n.value:null).filter(v3);if(Hs(t)||s.length!==i.length){s.forEach(n=>n.destroy()),Jt(t);for(const n of i)if(n.status==="rejected")throw n.reason}this._levels=s,this._levelSelector=hJe(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData[0].forEach(e=>e.destroy()),this._highlightRenderInstanceData[0].forEach(e=>e.destroy())}get needsTransparentPass(){return this._levels.some(e=>e.components.some(t=>t.material.requiresSlot(ae.TRANSPARENT_MATERIAL,D.Color)))}get needsHighlight(){return this._highlightRenderInstanceData[0].some(e=>e.size>0)}prepareRender(e){if(!Kr.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const t=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),t||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(_a),this._needFullCycle=!1)}}prepareTechniques(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return null;const t=this._getInstanceDatas(e.output);if(!t)return null;const r=new Array;return t.forEach(i=>this.levels.forEach((s,n)=>{s.components.forEach(o=>r.push(this._beginComponent(e,i[n],o)))})),r}render(e,t){const r=this._getInstanceDatas(e.output);if(!r)return;let i=0;e.rctx.bindVAO(),r.forEach(s=>this.levels.forEach((n,o)=>{n.components.forEach(a=>this._renderComponent(e,t[i++],s[o],a,o))}))}_getInstanceDatas(e){const t=e!==D.Highlight&&e!==D.ShadowHighlight,r=e!==D.ShadowExcludeHighlight;return t&&r?this._allRenderInstanceData:t?this._defaultRenderInstanceData:r?this._highlightRenderInstanceData:null}intersect(e,t,r,i){if(!this.baseMaterial.isVisible()||this._octree==null)return;const s=C();ce(s,i,r);const n=o=>{this._instanceData.getCombinedModelTransform(o,Yee),e.transform.set(Yee),Ue(Jee,r,e.transform.inverse),Ue(Kee,i,e.transform.inverse);const a=this._instanceData.getState(o),l=this._instanceData.getLodLevel(o),c=this._levels.length;Ye((a&Ti.ACTIVE)!=0,"invalid instance state"),Ye(l>=0&&l<c,"invaid lod level"),this._levels[l].intersect(e,t,Jee,Kee,o,this.metadata,c)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(n):this._octree.forEachAlongRay(r,s,n)}queryDepthRange(e){return this._queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){if(this._octreeCached==null){const e=this._instanceData,t=e.view?.state;if(!t)return null;this._octreeCached=new aJe(e,this.baseBoundingSphere);for(let r=0;r<e.capacity;++r)t.get(r)&Ti.ACTIVE&&this._octreeCached.addInstance(r)}return this._octreeCached}_invalidateOctree(){this._octreeCached=Re(this._octreeCached)}_queryDepthRangeOctree(e){if(this._octree==null)return{near:1/0,far:-1/0};const t=e.viewForward,r=this._octree.findClosest(t,nd.DepthOrder.FRONT_TO_BACK,e.frustum),i=this._octree.findClosest(t,nd.DepthOrder.BACK_TO_FRONT,e.frustum);if(r==null||i==null)return{near:1/0,far:-1/0};const s=e.eye,n=this._instanceData.view;n.boundingSphere.getVec(r,jd),ce(jd,jd,s);const o=de(jd,t)-jd[3];n.boundingSphere.getVec(i,jd),ce(jd,jd,s);const a=de(jd,t)+jd[3];return{near:Math.max(e.near,o),far:Math.min(e.far,a)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach(e=>e.forEach(t=>t.startUpdateCycle()))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:t,_camera:r,_levelSelector:i}=this;this._allRenderInstanceData.forEach(c=>c.forEach(u=>u.beginUpdate()));const s=this._instanceData,n=s.view;let o=s.size;const a=s.capacity;let l=this._instanceIndex;for(let c=0;c<o&&!e.done;++c){l===this._cycleStartIndex&&this._startUpdateCycle();const u=n.state.get(l);let d=0;if(!(u&Ti.ALLOCATED)){l=l+1===a?0:l+1,o++;continue}const p=n.lodLevel.get(l);if(u&Ti.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][p].freeTail(),u&Ti.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][p].freeTail(),u&Ti.REMOVE)s.freeInstance(l);else if(u&Ti.VISIBLE){let g=0;t&&(n.modelOrigin.getVec(l,Zee),g=i.selectLevel(Zee,s.getCombinedMedianScaleFactor(l),r)),d=u&~(Ti.ACTIVE|Ti.TRANSFORM_CHANGED),g>=0&&(u&Ti.HIGHLIGHT?(Xee(this._highlightRenderInstanceData[0][g],n,l),d|=Ti.HIGHLIGHT_ACTIVE):(Xee(this._defaultRenderInstanceData[0][g],n,l),d|=Ti.DEFAULT_ACTIVE)),n.state.set(l,d),n.lodLevel.set(l,g)}else d=u&~(Ti.ACTIVE|Ti.TRANSFORM_CHANGED),n.state.set(l,d);if(this._octreeCached!=null){const g=!!(u&Ti.ACTIVE),y=!!(d&Ti.ACTIVE);!g&&y?this._octreeCached.addInstance(l):g&&!y?this._octreeCached.removeInstance(l):g&&y&&u&Ti.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(l),this._octreeCached.addInstance(l))}l=l+1===a?0:l+1,e.madeProgress()}this._instanceIndex=l,this._allRenderInstanceData.forEach(c=>c.forEach(u=>u.endUpdate())),this._context.requestRender()}_beginComponent(e,t,r){const{bindParameters:i,rctx:s,output:n}=e;if(t.size===0||!r.material.requiresSlot(i.slot,e.output))return null;const o=r.glMaterials.load(s,i.slot,n);return o!=null?o.beginSlot(i):null}_renderComponent(e,t,r,i,s){if(!t)return;const{bindParameters:n,rctx:o}=e;o.appleAmdDriverHelper?.resetIndicesType();const a=o.bindTechnique(t,i.material.parameters,n);o.bindVAO(i.vao),t.ensureAttributeLocations(i.vao),a.bindDraw(fJe,n,i.material.parameters),Kr.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===D.Color&&(a.setUniform4fv("externalColor",Qee[Math.min(s,Qee.length-1)]),a.setUniform1i("colorMixMode",Sge.replace));const l=o.capabilities.instancing,c=r.capacity,u=r.headIndex,d=r.tailIndex,p=r.firstIndex,g=this._glInstanceBufferLayout,y=(_,v)=>{lj(o,dr,r.buffer,g,_),l.drawArraysInstanced(t.primitiveType,0,i.vertexCount,v-_),cj(o,dr,r.buffer,g)};i.material.parameters.transparent&&p!=null?u>d?(Ye(p>=d&&p<=u,"invalid firstIndex"),y(p,u),y(d,p)):u<d&&(p<=u?(Ye(p>=0&&p<=u,"invalid firstIndex"),y(p,u),y(d,c),y(0,p)):(Ye(p>=d&&p<=c,"invalid firstIndex"),y(p,c),y(0,u),y(d,p))):u>d?y(d,u):u<d&&(y(0,u),y(d,c)),o.bindVAO(null)}};function Xee(e,t,r){const i=e.allocateHead();dJe(t,r,e.view,i)}function dJe(e,t,r,i){d6e(e.modelOrigin,t,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,e.model,t),r.modelNormal.copyFrom(i,e.modelNormal,t),e.color&&r.color&&r.color.copyFrom(i,e.color,t),e.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(i,e.objectAndLayerIdColor,t),e.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,e.featureAttribute,t)}function pJe(e){let t=Li().vec3f(E.MODELORIGINHI).vec3f(E.MODELORIGINLO).mat3f(E.MODEL).mat3f(E.MODELNORMAL);return e!=null&&e.includes("featureAttribute")&&(t=t.vec4f(E.INSTANCEFEATUREATTRIBUTE)),e!=null&&e.includes("color")&&(t=t.vec4u8(E.INSTANCECOLOR)),e!=null&&e.includes("objectAndLayerIdColor")&&(t=t.vec4u8(E.INSTANCEOBJECTANDLAYERIDCOLOR)),t}h([f({constructOnly:!0})],du.prototype,"symbol",void 0),h([f({constructOnly:!0})],du.prototype,"optionalFields",void 0),h([f({constructOnly:!0})],du.prototype,"metadata",void 0),h([f({constructOnly:!0})],du.prototype,"shaderTransformation",void 0),h([f()],du.prototype,"_instanceData",void 0),h([f()],du.prototype,"_cycleStartIndex",void 0),h([f({readOnly:!0})],du.prototype,"_enableLevelSelection",null),h([f()],du.prototype,"_updateCyclesWithStaticCamera",void 0),h([f({readOnly:!0})],du.prototype,"running",null),du=h([F("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],du);const Zee=C(),jd=Ht(),Yee=be(),Jee=C(),Kee=C(),Qee=[At(1,0,1,1),At(0,0,1,1),At(0,1,0,1),At(1,1,0,1),At(1,0,0,1)],fJe=new YWe;class ete{constructor(t,r,i,s,n,o,a,l,c,u,d,p){this.lodResources=t,this.lodRenderer=r,this.stageResources=i,this.originalMaterialParameters=s,this.resourceSize=n,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=u,this.physicalBasedRenderingEnabled=d,this.pivotOffset=p}}class mJe extends ff{getCachedSize(){const[t,r,i]=this._resources!=null?this._resources.symbolSize:[1,1,1];return{width:t,depth:r,height:i}}constructor(t,r,i,s){super(t,r,i,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=i.physicalBasedRenderingEnabled}async doLoad(t){if(!this._drivenProperties.size&&m4(this.symbolLayer))throw new Error;if(this._isPrimitive){const r=this.symbolLayer.resource,i=r&&pGe(r.primitive)?r.primitive:she;this._resources=await this._createResourcesForPrimitive(i,t)}else{const r=await rJe(this.symbol.styleOrigin),i=r?.href??this.symbolLayer.resource.href;this._resources=await this._createResourcesForUrl(i,t)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return this._resources!=null?this._resources.extentPadding:0}get _isPrimitive(){return!this.symbolLayer.resource?.href}get lodRenderer(){return this._resources?.lodRenderer}_setMaterialTransparencyParams(t,r=this.symbolLayer?.material?.color){const i=this._getCombinedOpacity(r),s=i<1||this.needsDrivenTransparentPass;return t.transparent=s,t.opacity=i,t.cullFace=s?oi.None:oi.Back,t}async _createResourcesForPrimitive(t,r){const i=this.symbolLayer,s=Qs(_Me(t)),n=fa(zO(s)),o=fa(aF(n,i)),a=Se(o),l=!1,c=!1,u={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...nW],ambient:cm,diffuse:cm,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},d=!!u.usePBR;this._setMaterialTransparencyParams(u);const p=this.symbol;if(p.type==="point-3d"&&p.verticalOffset){const{screenLength:T,minWorldLength:x,maxWorldLength:S}=p.verticalOffset;u.verticalOffset={screenLength:Ho(T),minWorldLength:x||0,maxWorldLength:S??1/0},u.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(u.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)u.externalColor=Mu;else{const T=i.material!=null?i.material.color:null,x=T!=null?ot.toUnitRGBA(T):Mu;u.externalColor=x}this._fastUpdates=GT(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,null)),u.isInstanced=!0,this._fastUpdates?(Object.assign(u,this._fastUpdates.materialParameters),this._optionalFields.push(E.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(u.hasInstancedColor=!0,this._optionalFields.push(E.COLOR)),ne("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(E.OBJECTANDLAYERIDCOLOR);const g=new tf(u),y=G0e(t,g);if(!y)throw new Error(`Unknown object symbol primitive: ${t}`);const _=ZR(y).map(T=>({opacity:1,transparent:T.parameters.transparent})),v=await this._createStageResources(y,d,r),w=await this._createLodRenderer(y,r);return new ete(y,w,v,_,n,l,c,s,o,a,d,null)}async _createResourcesForUrl(t,r){const i={materialParamsMixin:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=GT(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(i.materialParamsMixin,this._fastUpdates.materialParameters),this._optionalFields.push(E.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(i.materialParamsMixin.hasInstancedColor=!0,this._optionalFields.push(E.COLOR)),ne("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(E.OBJECTANDLAYERIDCOLOR);const s=this.symbol;if(s.type==="point-3d"&&s.verticalOffset){const{screenLength:I,minWorldLength:L,maxWorldLength:N}=s.verticalOffset;i.materialParamsMixin.verticalOffset={screenLength:Ho(I),minWorldLength:L||0,maxWorldLength:N??1/0},i.materialParamsMixin.castShadows=!1}i.signal=r,i.usePBR=this._context.physicalBasedRenderingEnabled,i.skipHighLods=this._context.skipHighSymbolLods;const n=i.usePBR,o=await G_e(t,i),a=o.isEsriSymbolResource,l=o.isWosr,c=HZe(o.lods);c.levels.sort((I,L)=>I.minScreenSpaceRadius-L.minScreenSpaceRadius);const u=this._context,d=this.symbolLayer.material,p=this._getExternalColorParameters(d),g=this.symbolLayer?.material?.color,y=this._getCombinedOpacity(g,{hasIntrinsicColor:!0}),_=this.needsDrivenTransparentPass,v=ZR(c),w=ZR(c).map(I=>({opacity:I.parameters.opacity||1,transparent:I.parameters.transparent}));v.forEach(I=>{const L=I.parameters;I.setParameters(p);const N=L.opacity*y,Z=N<1||_||L.transparent;I.setParameters({opacity:N,transparent:Z}),u.screenSizePerspectiveEnabled&&I.setParameters({screenSizePerspective:u.sharedResources.screenSizePerspectiveSettings})});const T=o.referenceBoundingBox,x=fa(zO(T)),S=fa(c.levels[0].pivotOffset),O=fa(aF(x,this.symbolLayer)),A=Se(O),$=this._fastUpdates;jT($,this._context.renderer,this._fastVisualVariableConvertOptions(T,O,x,S))&&v.forEach(I=>I.setParameters($.materialParameters));const P=await this._createStageResources(c,n,r),U=await this._createLodRenderer(c,r);return new ete(c,U,P,w,x,a,l,T,O,A,n,S)}_addDisposeResource(t){this._disposeResourceHandles.push(t)}async _createStageResources(t,r,i){const s=this._context.stage,n=ZR(t);r!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),s.addMany(n),this._addDisposeResource(()=>s.removeMany(n));const o=sQ(t);s.addMany(o),this._addDisposeResource(()=>s.removeMany(o)),await s.load(o,i),Jt(i);const a=nQ(t);return s.addMany(a),this._addDisposeResource(()=>s.removeMany(a)),{materials:n,textures:o,geometries:a}}async _createLodRenderer(t,r){const i=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:l=>this._instanceIndexToGraphicUid.get(l),notifyGraphicGeometryChanged:l=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(l)),notifyGraphicVisibilityChanged:l=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(l))},n=this._fastUpdates,o=n?{applyTransform:(l,c,u)=>{l.getFeatureAttribute(c,yP),Ss(u,Kz(n.materialParameters,yP,u))},scaleFactor:(l,c,u)=>{c.getFeatureAttribute(u,yP),CVe(l,n.materialParameters,yP)}}:null,a=new du({symbol:t,optionalFields:this._optionalFields,metadata:s,shaderTransformation:o},this._context.scheduler);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{i.removeRenderPlugin(a),a.destroy()}),await i.addRenderPlugin(a.slots,a,r),a}_getExternalColorParameters(t){const r={};return this._drivenProperties.color?r.externalColor=Mu:t!=null&&t.color!=null?r.externalColor=ot.toUnitRGBA(t.color):(r.externalColor=Mu,r.colorMixMode="ignore"),r}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(t=>t()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry))return null;const i=JA(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const s=this.setGraphicElevationContext(r,new Vc),n=t.renderingInfo;return this._createAs3DShape(r,i,n,s,r.uid,t.layer.uid)}notifyDestroyGraphicLayer(t){this._instanceIndexToGraphicUid.delete(t.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(this._resources==null)return;const t=this._drivenProperties.opacity,r=!this._isPrimitive,i=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let n=0;n<i.length;n++){const o=i[n],a=this.symbolLayer?.material?.color,l=s[n],c=this._getCombinedOpacity(a,{hasIntrinsicColor:r})*l.opacity,u=c<1||t||l.transparent;o.setParameters({opacity:c,transparent:u}),this._isPrimitive&&o.setParameters({cullFace:u?oi.None:oi.Back})}}layerElevationInfoChanged(t,r){return this.updateGraphics3DGraphicElevationInfo(t,r,Ry)}slicePlaneEnabledChanged(){if(this._resources==null)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const t of this._resources.stageResources.materials)t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(this._resources==null)return!0;const{stageResources:t,isWosr:r}=this._resources;for(const i of t.materials)this._isPrimitive?i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):r||i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(t,r){if(this._resources==null)return xs.RecreateSymbol;const{stageResources:{materials:i},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in t.diff){if(c!=="visualVariables"||!jT(this._fastUpdates,r,this._fastVisualVariableConvertOptions(n,o,a,l)))return xs.RecreateSymbol;for(const u of i)u.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return xs.FastUpdate}computeComplexity(){if(this._resources==null)return super.computeComplexity();const t=this._resources.lodResources,r=V0e(t.levels[0]).reduce((n,o)=>n+o.indices.get(E.POSITION).length,0)/3,i=n=>Array.from(n.vertexAttributes.values()).reduce((o,a)=>o+N0(a.data),0)+Array.from(n.indices.values()).reduce((o,a)=>o+N0(a),0),s=sQ(t).reduce((n,o)=>n+(o.parameters.encoding&&o.parameters.encoding==="image/ktx2"?o.memoryEstimate:o.memoryEstimate/4),0)+nQ(t).reduce((n,o)=>n+i(o),0);return{primitivesPerFeature:r,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:{...W0e(this.symbol,this.symbolLayer),resourceBytes:s}}}_hasLodRenderer(){return this._resources!=null}_createAs3DShape(t,r,i,s,n,o){if(!this._hasLodRenderer()||this._resources==null)return null;const a=this.getFastUpdateAttrValues(t),l=this._context.clippingExtent;if(no(r,Xb,this._context.elevationProvider.spatialReference),l!=null&&!oG(l,Xb))return null;const c=this._requiresTerrainElevation(s),u=this._computeGlobalTransform(r,s,dU,_P),d=this._computeLocalTransform(this._resources,this.symbolLayer,i,tte),p=this._resources.lodRenderer.instanceData,g=p.addInstance();this._instanceIndexToGraphicUid.set(g,n),p.setLocalTransform(g,d,!1),p.setGlobalTransform(g,u),a&&p.setFeatureAttribute(g,a),this._fastUpdates==null&&this._hasPerInstanceColor()&&p.setColor(g,IC(i.color,i.opacity,255)),this._context.stage.renderView.objectAndLayerIdRenderHelper!=null&&p.setObjectAndLayerIdColor(g,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:n,layerUid:o}));const y=new VZe(this,g,Q7e,s);return c&&(y.alignedSampledElevation=_P.sampledElevation),y.needsElevationUpdates=Ry(s.mode),YA(y,r,this._context.elevationProvider),y}_computeGlobalTransform(t,r,i,s){return Oy(t,this._context.elevationProvider,r,this._context.renderCoordsHelper,s),Xb[0]=t.x,Xb[1]=t.y,Xb[2]=s.z,Oc(t.spatialReference,Xb,i,this._context.renderCoordsHelper.spatialReference),i}_computeLocalTransform(t,r,i,s){return Zu(s),this._applyObjectRotation(i,!1,s),this._applyObjectRotation(r,!0,s),this._applyObjectScale(t,i,s),this._applyAnchor(t,r,s),s}_applyObjectScale(t,r,i){if(this._fastUpdates?.requiresShaderTransformation)return;const s=this._drivenProperties.size&&r.size?r.size:t.symbolSize,n=rQ(s,t.symbolSize,t.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||gN(i,i,n)}prepareSymbolLayerPatch(t){if(t.diff.type!=="partial")return;const r=t.diff.diff;this._preparePatchTransform(t,r),this._preparePatchColor(t,r)}updateGeometry(t,r){if(this._resources==null)return!0;const i=r&&JA(r);if(i==null)return!1;const s=this.getGeometryElevationMode(r);return t.elevationContext.mode===s&&(this._computeGlobalTransform(i,t.elevationContext,dU,_P),this._requiresTerrainElevation(t.elevationContext)&&(t.alignedSampledElevation=_P.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(t.instanceIndex,dU,!0),YA(t,i,this._context.elevationProvider),!0)}_preparePatchTransform(t,r){if(!(r.heading||r.tilt||r.roll||r.width||r.height||r.depth||r.anchor||r.anchorPosition)||this._resources==null)return;const i=(y,_,v)=>(y!=null&&y.type==="complete"?y.newValue:_)??v,s=i(r.heading,this.symbolLayer.heading,0),n=i(r.tilt,this.symbolLayer.tilt,0),o=i(r.roll,this.symbolLayer.roll,0),a=i(r.width,this.symbolLayer.width,void 0),l=i(r.height,this.symbolLayer.height,void 0),c=i(r.depth,this.symbolLayer.depth,void 0),u=i(r.anchor,this.symbolLayer.anchor,void 0),d=i(r.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete r.heading,delete r.tilt,delete r.roll,delete r.width,delete r.height,delete r.depth,delete r.anchor,delete r.anchorPosition;const p={heading:s,tilt:n,roll:o,anchor:u,anchorPosition:d},g=this._resources;this.loadStatus===mc.LOADED&&t.symbolLayerStatePatches.push(()=>{g.symbolSize=fa(aF(g.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),t.graphics3DGraphicPatches.push((y,_)=>{const v=this._computeLocalTransform(g,p,_,tte),w=y.instanceIndex;g.lodRenderer.instanceData.setLocalTransform(w,v,!0)})}_preparePatchColor(t,r){if(!r.material||r.material.type!=="partial")return;const i=r.material.diff;if(!i.color||i.color.type!=="complete"||i.color.newValue==null||i.color.oldValue==null)return;const s=i.color.newValue,n=s!=null?ot.toUnitRGBA(s):Mu;delete i.color;const o=this._resources;o!=null&&t.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParams({},s)):l=this._setMaterialTransparencyParams({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(t){return t.mode!=="absolute-height"}_applyObjectRotation(t,r,i){if(!this._fastUpdates?.requiresShaderTransformation||!r)return V7e(t.heading,t.tilt,t.roll,i)}_computeAnchor(t,r,i){const s=C();switch(i.anchor){case"center":re(s,td(t)),Wo(s,s);break;case"top":{const n=td(t);se(s,-n[0],-n[1],-t[5]);break}case"bottom":{const n=td(t);se(s,-n[0],-n[1],-t[2]);break}case"relative":{const n=td(t),o=zO(t),a=i.anchorPosition,l=a?Ce(a.x,a.y,a.z):wa;SD(s,o,l),oe(s,s,n),Wo(s,s);break}default:r!=null?Wo(s,r):re(s,wa)}return s}_applyAnchor(t,r,i){if(this._fastUpdates?.requiresShaderTransformation)return;const s=this._computeAnchor(t.resourceBoundingBox,t.pivotOffset,r);s&&Ja(i,i,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(t,r,i,s){const n=t!=null?fa(zO(t)):cm,o=t!=null?this._computeAnchor(t,s,this.symbolLayer):wa,a=this._context.renderCoordsHelper.unitInMeters,l=rQ(r??void 0,r,i,a),c=Ce(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new Q3({size:!0,color:!0,rotation:!0,opacity:!1},n,r??cm,a,o,l,c)}}const Xb=C(),tte=be(),dU=be(),yP=Ht(),_P=new rO;class gJe{constructor(t,r,i,s){this.vertices=t,this.positionsES=r,this.offset=s;const n=t.length,o=Math.floor(n/2),a=this.offset+3*o,l=i[a],c=i[a+1],u=i[a+2];this.origin=Ce(l,c,u),this.positions=Vi(3*n);const d=this.offset+3*n;for(let p=this.offset;p<d;p+=3)this.positions[p]=i[p]-l,this.positions[p+1]=i[p+1]-c,this.positions[p+2]=i[p+2]-u;this.updatePathVertexInformation()}updatePathVertexInformation(){const t=this.vertices.length,r=this.vertices[0];let i=this.offset;const s=this.positions;r.vRight[0]=s[i+3]-s[i],r.vRight[1]=s[i+4]-s[i+1],r.vRight[2]=s[i+5]-s[i+2],i+=3;let n=Se(r.vRight);r.vMinSiblingLength=n,pe(r.vRight,r.vRight);let o=r;for(let a=1;a<t;++a){const l=this.vertices[a];if(l.vLeft=o.vRight,a<t-1){l.vRight[0]=s[i+3]-s[i],l.vRight[1]=s[i+4]-s[i+1],l.vRight[2]=s[i+5]-s[i+2];const c=Se(l.vRight);l.vMinSiblingLength=Math.min(n,c),n=c,pe(l.vRight,l.vRight)}else re(l.vRight,l.vLeft),l.vMinSiblingLength=n;o=l,i+=3}}}class yJe{constructor(t,r,i,s,n,o={}){this.path=t,this.profile=r,this.extruder=i,this.startCap=s,this.endCap=n,this.options=o,this._extrusionVertexCount=0;const a=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*a+2,this.numVerticesTotal=r.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.numVertices;this.numVerticesTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.numVertices;this.numVerticesTotal+=c,this.pathVertexData=i6e(1*this.numVerticesTotal),this.profileRightAxes=Vi(4*this.numVerticesTotal),this.profileUpAxes=Vi(4*this.numVerticesTotal),this.profileVertexAndNormals=Vi(4*this.numVerticesTotal),this.positions=_L(t.positions,t.offset,3*t.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(t,r,i,s,n){const o=4*this._extrusionVertexCount;if(this.profileRightAxes[o]=r.right[0],this.profileRightAxes[o+1]=r.right[1],this.profileRightAxes[o+2]=r.right[2],this.profileUpAxes[o]=r.up[0],this.profileUpAxes[o+1]=r.up[1],this.profileUpAxes[o+2]=r.up[2],this.profileVertexAndNormals[o]=i[0],this.profileVertexAndNormals[o+1]=i[1],this.profileVertexAndNormals[o+2]=s[0],this.profileVertexAndNormals[o+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,n){const a=this.path.vertices[t],l=a.maxStretchDistance;this.profileRightAxes[o+3]=a.rotationRight[0]*l,this.profileUpAxes[o+3]=a.rotationRight[1]*l}else this.profileRightAxes[o+3]=0,this.profileUpAxes[o+3]=0;++this._extrusionVertexCount}emitCapVertex(t,r,i,s,n,o){const a=4*this._extrusionVertexCount;this.profileRightAxes[a]=r.right[0],this.profileRightAxes[a+1]=r.right[1],this.profileRightAxes[a+2]=r.right[2],this.profileRightAxes[a+3]=n,this.profileUpAxes[a]=r.up[0],this.profileUpAxes[a+1]=r.up[1],this.profileUpAxes[a+2]=r.up[2],this.profileUpAxes[a+3]=o,this.profileVertexAndNormals[a]=i[0],this.profileVertexAndNormals[a+1]=i[1],this.profileVertexAndNormals[a+2]=s[0],this.profileVertexAndNormals[a+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:t,offset:r,vertices:i}=this.path;this.positions=_L(t,r,3*i.length);let s=0;const n=(a,l,c,u,d)=>this.emitCapVertex(s,a,l,c,u,d),o=(a,l,c,u)=>this.emitVertex(s,a,l,c,u);for(this.startCap.rebuildConnectingProfileGeometry(i[s],this.profile,n),s=1;s<i.length-1;++s)this.extruder.extrude(i[s],this.profile,o);this.endCap.rebuildConnectingProfileGeometry(i[s],this.profile,n),s=0,this.startCap.rebuildCapGeometry(i[s],n),s=i.length-1,this.endCap.rebuildCapGeometry(i[s],n)}buildTopology(){const t=this.profile.vertices.length,r=this.profile.numSegments,i=this.numExtrusionProfiles-1;let s=3*(2*(r*i));this.startCap.indexBufferStart=s,this.startCap.firstProfileVertexIndex=0,s+=this.startCap.numIndices,this.endCap.indexBufferStart=s,this.endCap.firstProfileVertexIndex=t*(this.numExtrusionProfiles-1);const n=new Array,o=new Array,a=new Array,l=(c,u,d)=>{n.push(c),n.push(u),n.push(d),o.push(c),o.push(u),o.push(d),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[u]),a.push(this.pathVertexData[d])};for(let c=0;c<r;++c){const u=this.profile.indices[2*c],d=this.profile.indices[2*c+1];for(let p=0;p<i;++p){const g=p*t+u,y=(p+1)*t+d,_=p*t+d;l(g,(p+1)*t+u,y),l(g,y,_)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=Vp(n),this.normalIndices=Vp(o),this.pathVertexIndices=Vp(a)}onPathChanged(){this._rebuildGeometry()}}class _W{rebuildConnectingProfileGeometry(t,r,i){for(let s=0;s<r.vertices.length;++s)i(t.frame,r.vertices[s],r.normals[s],0,0)}}class rte extends _W{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}}class vP extends _W{constructor(t,r=0,i=!1){super(),this.profile=t,this.profilePlaneOffset=r,this.flip=i}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(t,r,i){const s=this.profilePlaneOffset;for(let n=0;n<r.vertices.length;++n)i(t.frame,r.vertices[n],r.normals[n],s,0)}rebuildCapGeometry(t,r){const i=this.profile,s=this.flip?1:-1,n=this.profilePlaneOffset,o=J_e;Qt(o,0,0);for(let a=0;a<i.vertices.length;++a)r(t.frame,i.vertices[a],o,n,s)}buildTopology(t,r){const i=this.profile,s=this.vertexBufferStart+i.indices[0];for(let n=1;n<i.numSegments;++n){const o=i.indices[2*n],a=i.indices[2*n+1],l=this.vertexBufferStart+o,c=this.vertexBufferStart+a;this.flip?r(c,l,s):r(s,l,c)}}}class ite extends _W{constructor(t){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=t.profile,this.flip=t.flip,this.sign=this.flip?1:-1,this.breakNormals=t.breakNormals,this.numSegments=t.subdivisions}get numVertices(){let t=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(t+=this.profile.vertices.length),t}get numIndices(){let t=0;const r=this.profile;t+=2*r.numSegments*(this.numSegments-1);for(let i=0;i<r.numSegments;++i){const s=r.indices[2*i],n=r.indices[2*i+1];r.poleIndices[s]===r.poleIndices[n]?t+=1:t+=2}return 3*t}rebuildCapGeometry(t,r){const i=this.profile,s=t.frame,n=.5*this.sign,o=_Je,a=J_e;Qt(a,0,0);for(const l of i.poles)l.normal?r(s,l.position,l.normal,n,0):r(s,l.position,a,n,this.sign);if(this.breakNormals)for(let l=0;l<i.vertices.length;++l)r(s,i.vertices[l],i.normals[l],0,0);for(let l=0;l<this.numSegments-1;++l){const c=(1-(l+1)/this.numSegments)*Math.PI*.5,u=Math.sin(c),d=Math.cos(c);for(let p=0;p<i.vertices.length;++p){const g=i.poles[i.poleIndices[p]];Ap(o,i.vertices[p],g.position),Pl(o,o,u),g.normal?(Hh(o,o,g.position),r(s,o,g.normal,n*d,0)):(EA(a,o),Pl(a,a,u),Hh(o,o,g.position),r(s,o,a,n*d,this.sign*d))}}}buildTopology(t,r){const i=this.profile,s=this.breakNormals?this.vertexBufferStart+i.poles.length:this.firstProfileVertexIndex,n=this.breakNormals?this.vertexBufferStart+i.poles.length+i.vertices.length:this.vertexBufferStart+i.poles.length;for(let o=0;o<i.numSegments;++o){const a=i.indices[2*o],l=i.indices[2*o+1],c=this.vertexBufferStart+i.poleIndices[a],u=this.vertexBufferStart+i.poleIndices[l];let d=s+a,p=s+l;for(let g=0;g<this.numSegments-1;++g){const y=n+g*i.vertices.length+a,_=n+g*i.vertices.length+l;this.flip?(r(y,p,d),r(p,y,_)):(r(d,p,y),r(_,y,p)),d=y,p=_}this.flip?(r(c,p,d),c!==u&&r(c,u,p)):(r(d,p,c),c!==u&&r(p,u,c))}}}const _Je=Ne(),J_e=Ne();class vJe{numProfilesPerJoin(){return 1}extrude(t,r,i){for(let s=0;s<r.vertices.length;++s)i(t.frame,r.vertices[s],r.normals[s],!1)}}class pU{constructor(t,r){this.cutoffAngle=t,this.numBendSubdivisions=r}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(t,r,i){const s=wJe,{rotationAngle:n,rotationRight:o,frame:a}=t;if(Math.abs(n)>=this.cutoffAngle){const l=t.rotationFrameUp;for(let c=0;c<this.numBendSubdivisions+1;++c){Nc(nte,.5*-n+c*n/this.numBendSubdivisions,l),bJe(s,a,nte);for(let u=0;u<r.vertices.length;++u)Bs(r.vertices[u],o)*n>=0?i(s,r.vertices[u],r.normals[u],!1):i(a,t.applyMiterStretch(ste,r.vertices[u]),r.normals[u],!0)}}else for(let l=0;l<this.numBendSubdivisions+1;++l)for(let c=0;c<r.vertices.length;++c){const u=Bs(r.vertices[c],o)*n>=0;i(a,t.applyMiterStretch(ste,r.vertices[c]),r.normals[c],!u)}}}class K_e{constructor(){this.up=C(),this.right=C()}}function bJe(e,t,r){Ue(e.up,t.up,r),Ue(e.right,t.right,r)}const ste=Ne(),nte=be(),wJe=new K_e;class xJe extends Cs{constructor(t,r,i,s,n,o,a){super(t,r,i,null,Ki.Mesh,a),this.path=s,this.geometrySR=n,this.stencilWidth=o}}var Gp;function Q_e(e){return"path"in e}(function(e){e[e.World=0]="World",e[e.Path=1]="Path"})(Gp||(Gp={}));class eve{constructor(t){this.builder=t}onPathChanged(t){this.builder.onPathChanged()}}class tve extends eve{constructor(t){super(t),this.vertexAttributeColor=At(255,255,255,255),this.size=new Array,this.vertexAttributePosition=Vi(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(t){this.vertexAttributeColor[0]=255*t[0],this.vertexAttributeColor[1]=255*t[1],this.vertexAttributeColor[2]=255*t[2],this.vertexAttributeColor[3]=255*(t.length>3?t[3]:1)}bake(t){this.size=t;const{numVerticesTotal:r,pathVertexData:i,path:s,positions:n,profileRightAxes:o,profileUpAxes:a,profileVertexAndNormals:l}=this.builder;for(let c=0;c<r;++c){let u=i[c];const d=u===0||u===s.vertices.length-1;u*=3;const p=AJe;let g=0,y=0;const _=4*c,v=se(OJe,o[_],o[_+1],o[_+2]),w=se(RJe,a[_],a[_+1],a[_+2]),T=Qt(ote,l[_]*t[0],l[_+1]*t[1]);if(d)rt(p,w,v),g=o[_+3]*t[0],y=a[_+3];else{const A=SJe,$=EJe;Qt(A,o[_+3],a[_+3]);const P=ij(A);EA(A,A);const U=Bs(T,A);if(Math.abs(U)>P){Qt($,-A[1],A[0]);const I=Bs(T,$);Pl(A,A,P*Math.sign(U)),Pl($,$,I),Hh(T,A,$)}se(p,0,0,0)}const x=se(CJe,v[0]*T[0]+w[0]*T[1],v[1]*T[0]+w[1]*T[1],v[2]*T[0]+w[2]*T[1]),S=3*c;this.vertexAttributePosition[S]=n[u]+x[0]+p[0]*g,this.vertexAttributePosition[S+1]=n[u+1]+x[1]+p[1]*g,this.vertexAttributePosition[S+2]=n[u+2]+x[2]+p[2]*g;const O=Qt(ote,l[_+2],l[_+3]);z1(this.vertexAttributeNormal,c,v[0]*O[0]+w[0]*O[1]+p[0]*y,v[1]*O[0]+w[1]*O[1]+p[1]*y,v[2]*O[0]+w[2]*O[1]+p[2]*y)}}createGeometryData(){const t=this.builder.vertexIndices.length;return new rve([[E.POSITION,new Fe(this.vertexAttributePosition,3,!0)],[E.NORMALCOMPRESSED,new Fe(this.vertexAttributeNormal,2,!0)],[E.COLOR,new Fe(this.vertexAttributeColor,4)]],[[E.POSITION,this.builder.vertexIndices],[E.NORMALCOMPRESSED,this.builder.normalIndices],[E.COLOR,T2(t)]])}onPathChanged(t){super.onPathChanged(t),this.bake(this.size)}intersect(t,r,i){const s=this.builder.vertexIndices,n=new Fe(this.vertexAttributePosition,3),o=s.length/3;Y3(t,r,0,o,s,n,void 0,void 0,i)}}class TJe extends eve{constructor(t,r,i,s){super(t),this.sizeAttributeValue=r,this.colorAttributeValue=i,this.opacityAttributeValue=s,this.vvData=null,this.baked=new tve(t),this.vvData=Vi(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n]=r,this.vvData[4*n+1]=i,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){return new rve([[E.POSITION,new Fe(this.builder.positions,3,!0)],[E.PROFILERIGHT,new Fe(this.builder.profileRightAxes,4,!0)],[E.PROFILEUP,new Fe(this.builder.profileUpAxes,4,!0)],[E.PROFILEVERTEXANDNORMAL,new Fe(this.builder.profileVertexAndNormals,4,!0)],[E.FEATUREVALUE,new Fe(this.vvData,4,!0)]],[[E.POSITION,this.builder.pathVertexIndices],[E.PROFILERIGHT,this.builder.vertexIndices],[E.PROFILEUP,this.builder.vertexIndices],[E.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[E.FEATUREVALUE,this.builder.pathVertexIndices]])}onPathChanged(t){super.onPathChanged(t);const r=t.getMutableAttribute(E.POSITION);r&&(r.data=this.builder.positions)}}class rve{constructor(t,r){this.vertexAttributes=t,this.indices=r}}const ote=Ne(),SJe=Ne(),EJe=Ne(),CJe=C(),AJe=C(),OJe=C(),RJe=C();function PJe(e,t){let r=null;const i=e.vertices.length,s=.99619469809,n=C(),o=C(),a=C(),l=C(),c=C(),u=C(),d=Sr();let p=e.vertices[0];re(o,t),se(n,0,1,0),wL(p.vRight,o,n,n,a,o,s),re(p.frame.up,o),re(p.frame.right,a);const g=e.positions;let y=e.offset;r=p;for(let _=1;_<i;++_){p=e.vertices[_],oe(c,p.vLeft,p.vRight);let v=Se(c);v>0?(v=1/Math.sqrt(v),c[0]=c[0]*v,c[1]=c[1]*v,c[2]=c[2]*v):(c[0]=p.vRight[0],c[1]=p.vRight[1],c[2]=p.vRight[2]),u[0]=g[y]+r.frame.up[0],u[1]=g[y+1]+r.frame.up[1],u[2]=g[y+2]+r.frame.up[2],y+=3;const w=se(MJe,g[y],g[y+1],g[y+2]);B3(w,c,d),ib(d,Fc(u,p.vLeft),l)?(l[0]-=g[y],l[1]-=g[y+1],l[2]-=g[y+2],pe(o,l),rt(a,c,o),pe(a,a)):wL(c,r.frame.up,r.frame.right,n,a,o,s),re(p.frame.up,o),re(p.frame.right,a),r=p}}const MJe=C();class ive{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(t,r){return this.vertices.push(fE(t)),this.normals.push(fE(r)),this.vertices.length-1}addPole(t,r=null){return this.poles.push({position:fE(t),normal:r?fE(r):null}),this.poles.length-1}addSegment(t,r=null){this.indices.push(t.v0),this.indices.push(t.v1),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.indices.length/2}translate(t,r){for(const i of this.vertices)i[0]+=t,i[1]+=r;for(const i of this.poles)i.position[0]+=t,i.position[1]+=r}}const sve={top:[0,-.5],bottom:[0,.5]};function fU(e){const r=z0e,i=new ive,s={v0:0,v1:0};i.addPole(or(0,0));for(let o=0;o<r;++o){const a=2*o*Math.PI/r,l=Math.cos(a),c=Math.sin(a),u=or(l*.5,c*.5),d=or(l,c);i.addVertex(u,d)}for(let o=0;o<r-1;++o){const a={v0:o,v1:o+1};i.addSegment(a,s)}const n={v0:r-1,v1:0};if(i.addSegment(n,s),e!=="center"){const o=sve[e];i.translate(o[0],o[1])}return i}const IJe={center:fU("center"),top:fU("top"),bottom:fU("bottom")},$Je={center:mU("center"),top:mU("top"),bottom:mU("bottom")};function mU(e){const i=new ive,s=or(.5*-1,.5*-1),n=or(.5*1,.5*-1),o=or(.5*1,.5*1),a=or(.5*-1,.5*1),l=or(0,-1),c=or(1,0),u=or(0,1),d=or(-1,0);if(i.addPole(or(0,.5*1),u),i.addPole(or(0,.5*1)),i.addPole(or(0,.5*-1)),i.addPole(or(0,.5*-1),l),i.addVertex(s,l),i.addVertex(n,l),i.addSegment({v0:0,v1:1},{v0:3,v1:3}),i.addVertex(n,c),i.addVertex(o,c),i.addSegment({v0:2,v1:3},{v0:2,v1:1}),i.addVertex(o,u),i.addVertex(a,u),i.addSegment({v0:4,v1:5},{v0:0,v1:0}),i.addVertex(a,d),i.addVertex(s,d),i.addSegment({v0:6,v1:7},{v0:1,v1:2}),e!=="center"){const p=sve[e];i.translate(p[0],p[1])}return i}function LJe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function DJe(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function nve(e,t,r,i,s){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e}function NJe(e,t){if(e===t){const r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function FJe(e,t){const r=t[0],i=t[1],s=t[2],n=t[3];let o=r*n-s*i;return o?(o=1/o,e[0]=n*o,e[1]=-i*o,e[2]=-s*o,e[3]=r*o,e):null}function UJe(e,t){const r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e}function kJe(e){return e[0]*e[3]-e[2]*e[1]}function ove(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=r[0],l=r[1],c=r[2],u=r[3];return e[0]=i*a+n*l,e[1]=s*a+o*l,e[2]=i*c+n*u,e[3]=s*c+o*u,e}function zJe(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+n*a,e[1]=s*l+o*a,e[2]=i*-a+n*l,e[3]=s*-a+o*l,e}function BJe(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=r[0],l=r[1];return e[0]=i*a,e[1]=s*a,e[2]=n*l,e[3]=o*l,e}function VJe(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e}function GJe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function jJe(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function HJe(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2)}function WJe(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]}function qJe(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function ave(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function XJe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function ZJe(e,t){const r=e[0],i=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],c=t[3],u=Ta();return Math.abs(r-o)<=u*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=u*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=u*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=u*Math.max(1,Math.abs(n),Math.abs(c))}function YJe(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function JJe(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}const KJe=ove,QJe=ave;Object.freeze(Object.defineProperty({__proto__:null,LDU:WJe,add:qJe,adjoint:UJe,copy:LJe,determinant:kJe,equals:ZJe,exactEquals:XJe,frob:HJe,fromRotation:VJe,fromScaling:GJe,identity:DJe,invert:FJe,mul:KJe,multiply:ove,multiplyScalar:YJe,multiplyScalarAndAdd:JJe,rotate:zJe,scale:BJe,set:nve,str:jJe,sub:QJe,subtract:ave,transpose:NJe},Symbol.toStringTag,{value:"Module"}));function lve(){return[1,0,0,1]}function eKe(e){return[e[0],e[1],e[2],e[3]]}function tKe(e,t,r,i){return[e,t,r,i]}function rKe(e,t){return new Float64Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:eKe,create:lve,createView:rKe,fromValues:tKe},Symbol.toStringTag,{value:"Module"}));class cve{constructor(){this.vLeft=C(),this.vRight=C(),this.vMinSiblingLength=0,this.frame=new K_e}setFrameFromUpVector(t){re(this.frame.up,t),oe(TS,this.vLeft,this.vRight),pe(TS,TS),te(cte,this.frame.up,de(TS,this.frame.up)),ce(bP,TS,cte),pe(bP,bP),rt(this.frame.right,bP,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}}class iKe extends cve{get rotationFrameUp(){return this.frame.up}get rotationRight(){return vde}get rotationAngle(){return te(Mg,this.frame.up,de(this.frame.up,this.vLeft)),ce(Mg,this.vLeft,Mg),Wo(Mg,Mg),pe(Mg,Mg),te(Yb,this.frame.up,de(this.frame.up,this.vRight)),ce(Yb,this.vRight,Yb),pe(Yb,Yb),rt(rD,this.rotationFrameUp,this.vLeft),Math.sign(de(rD,this.vRight))*(Math.PI-_n(de(Mg,Yb)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(t,r){const i=this.rotationAngle;if(Math.abs(i)<=0)return r;const s=u8(Math.cos(.5*i));return Qt(t,(s-1+1)*r[0],r[1])}}class sKe extends cve{get rotationFrameUp(){const t=Math.sign(de(this.frame.right,this.vRight));return rt(xS,this.vRight,this.vLeft),te(xS,xS,t),pe(xS,xS)}get rotationRight(){const t=this.rotationFrameUp,r=de(t,this.frame.up),i=de(t,this.frame.right);return te(Zb,this.frame.up,-i),te(lte,this.frame.right,r),oe(Zb,Zb,lte),pe(Zb,Zb),nKe(ate,this.frame,Zb),ate}get rotationAngle(){const t=Math.sign(de(this.frame.right,this.vRight));return Wo(rD,this.vLeft),-t*(Math.PI-_n(de(rD,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*u8(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(t,r){const i=this.rotationAngle;if(Math.abs(i)===0)return r;const s=u8(Math.cos(.5*i)),n=this.rotationRight,o=nve(aKe,1+(s-1)*n[0]*n[0],(s-1)*n[0]*n[1],(s-1)*n[0]*n[1],1+(s-1)*n[1]*n[1]);return Bpe(t,r,o)}}function nKe(e,t,r){Qt(e,de(r,t.right),de(r,t.up))}function oKe(e){switch(e){case Gp.World:return new iKe;case Gp.Path:return new sKe}}const xS=C(),ate=Ne(),Zb=C(),lte=C(),rD=C(),Mg=C(),Yb=C(),cte=C(),TS=C(),bP=C(),aKe=lve(),gU=8;function lKe(e,t){const r=E.FEATUREVALUE;e.attributes.add(r,"vec4");const i=e.vertex;i.code.add(b`
  bool isCapVertex() {
    return ${r}.w == 1.0;
  }
  `),i.uniforms.add(new yr("size",s=>s.size)),t.vvSize?(i.uniforms.add(new Rt("vvSizeMinSize",s=>s.vvSize.minSize),new Rt("vvSizeMaxSize",s=>s.vvSize.maxSize),new Rt("vvSizeOffset",s=>s.vvSize.offset),new Rt("vvSizeFactor",s=>s.vvSize.factor)),i.code.add(b`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${r}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):i.code.add(b`vec2 getSize(){
return size;
}`),t.vvOpacity?(i.constants.add("vvOpacityNumber","int",gU),i.uniforms.add(new Wa("vvOpacityValues",s=>s.vvOpacity.values,gU),new Wa("vvOpacityOpacities",s=>s.vvOpacity.opacityValues,gU)),i.code.add(b`
    vec4 applyOpacity(vec4 color) {
      float value = ${r}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):i.code.add(b`vec4 applyOpacity(vec4 color){
return color;
}`),t.vvColor?(i.constants.add("vvColorNumber","int",zx),i.uniforms.add(new Wa("vvColorValues",s=>s.vvColor.values,zx),new Zge("vvColorColors",s=>s.vvColor.colors,zx)),i.code.add(b`
    vec4 getColor() {
      float value = ${r}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):i.code.add(b`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),e.include(H3),e.attributes.add(E.PROFILERIGHT,"vec4"),e.attributes.add(E.PROFILEUP,"vec4"),e.attributes.add(E.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(b`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(b`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(b`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(b`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}class cKe extends eO{constructor(){super(...arguments),this.size=or(1,1)}}function uKe(e){const t=new pr,{vertex:r,fragment:i}=t;switch(Fl(r,e),t.varyings.add("vpos","vec3"),t.include(lKe,e),e.output!==D.Color&&e.output!==D.Alpha||(t.include(Xa,e),t.include(k1,e),t.include(w2,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vcolor","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.code.add(b`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${e.output===D.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),t.include(kc,e),e.output){case D.Alpha:t.include(os,e),i.uniforms.add(new Ae("opacity",s=>s.opacity)),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        fragColor = vec4(combinedOpacity);
      }
    `);break;case D.Color:t.include(os,e),t.include(B1,e),t.include(lO,e),t.include(k1,e),t.include(s_e,e),xd(i,e),cO(i),M2(i),i.uniforms.add(r.uniforms.get("localOrigin"),new Rt("ambient",s=>s.ambient),new Rt("diffuse",s=>s.diffuse),new Rt("specular",s=>s.specular),new Ae("opacity",s=>s.opacity)),i.include(df),hf(i),i.code.add(b`
        void main() {
          discardBySlice(vpos);
          ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${e.transparencyPassType===tt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
        }
      `);break;case D.Depth:case D.Shadow:case D.ShadowHighlight:case D.ShadowExcludeHighlight:t.include(Xa,e),C1(t),t.varyings.add("depth","float"),r.code.add(b`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),t.include(os,e),t.include(jm,e),i.code.add(b`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case D.Normal:t.include(Xa,e),t.include(e3,e),zT(r),t.varyings.add("vnormal","vec3"),r.code.add(b`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(os,e),i.code.add(b`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case D.Highlight:t.include(Xa,e),t.include(e3,e),t.varyings.add("vnormal","vec3"),r.code.add(b`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(os,e),t.include(ig,e),i.code.add(b`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return t}const hKe=Object.freeze(Object.defineProperty({__proto__:null,build:uKe},Symbol.toStringTag,{value:"Module"})),uve=new Map([[E.POSITION,0],[E.PROFILERIGHT,1],[E.PROFILEUP,2],[E.PROFILEVERTEXANDNORMAL,3],[E.FEATUREVALUE,4]]);class dKe extends cKe{constructor(){super(...arguments),this.ambient=Ce(.2,.2,.2),this.diffuse=Ce(.8,.8,.8),this.specular=Ce(0,0,0),this.opacity=1,this.origin=C(),this.modelTransformation=null}}class X4 extends xr{initializeConfiguration(t,r){r.spherical=t.viewingMode===Ie.Global,r.doublePrecisionRequiresObfuscation=t.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(t){return new vr(t.rctx,X4.shader.get().build(this.configuration),uve)}initializePipeline(){const t=this.configuration.transparencyPassType,r=this.configuration,i=t===tt.NONE,s=t===tt.FrontFace;return Tt({blending:r.output!==D.Color&&r.output!==D.Alpha||!r.transparent?null:i?Pc:sg(t),culling:r.hasSlicePlane&&!r.transparent&&r.doubleSidedMode!==Gi.None?Ype:null,depthTest:{func:Uy(t)},depthWrite:i||s?Ka:null,colorWrite:It,stencilWrite:r.hasOccludees?ef:null,stencilTest:r.hasOccludees?ky:null,polygonOffset:i||s?null:h4})}}X4.shader=new _r(hKe,()=>ue(()=>import("./Path.glsl.2c7fede4.js"),[]));class En extends bo{constructor(){super(...arguments),this.output=D.Color,this.doubleSidedMode=Gi.None,this.transparencyPassType=tt.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}}h([B({count:D.COUNT})],En.prototype,"output",void 0),h([B({count:Gi.COUNT})],En.prototype,"doubleSidedMode",void 0),h([B({count:tt.COUNT})],En.prototype,"transparencyPassType",void 0),h([B()],En.prototype,"spherical",void 0),h([B()],En.prototype,"receiveShadows",void 0),h([B()],En.prototype,"receiveAmbientOcclusion",void 0),h([B()],En.prototype,"vvSize",void 0),h([B()],En.prototype,"vvColor",void 0),h([B()],En.prototype,"vvOpacity",void 0),h([B()],En.prototype,"hasSlicePlane",void 0),h([B()],En.prototype,"transparent",void 0),h([B()],En.prototype,"hasOccludees",void 0),h([B()],En.prototype,"hasMultipassTerrain",void 0),h([B()],En.prototype,"cullAboveGround",void 0),h([B()],En.prototype,"doublePrecisionRequiresObfuscation",void 0),h([B({constValue:Qe.Disabled})],En.prototype,"pbrMode",void 0),h([B({constValue:!0})],En.prototype,"hasVvInstancing",void 0),h([B({constValue:!1})],En.prototype,"useCustomDTRExponentForWater",void 0),h([B({constValue:!1})],En.prototype,"useFillLights",void 0);class vW extends Fy{constructor(t){super(t,new fKe),this.supportsEdges=!0,this._vertexAttributeLocations=uve,this._configuration=new En,this._vertexBufferLayout=vW.getVertexBufferLayout()}getConfiguration(t,r){return this._configuration.output=t,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,t!==D.Color&&t!==D.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Gi.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Gi.WindingOrder:Gi.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(t){return t!==D.Shadow&&t!==D.ShadowExcludeHighlight&&t!==D.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(t,r,i,s,n,o){const a=t;if(!Q_e(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:v,factor:w,minSize:T,maxSize:x}=this.parameters.vvSize,S=l.sizeAttributeValue;c[0]*=fe(v[0]+S*w[0],T[0],x[0]),c[1]*=fe(v[2]+S*w[2],T[2],x[2])}const u=Math.max(c[0],c[1]),d=t.boundingInfo;if(d==null)return void this._intersectTriangles(l,c,s,n,o);const p=g1(d.bbMin[0]-u,d.bbMin[1]-u,d.bbMin[2]-u,d.bbMax[0]+u,d.bbMax[1]+u,d.bbMax[2]+u),g=[n[0]-s[0],n[1]-s[1],n[2]-s[2]],y=Math.sqrt(g[0]*g[0]+g[1]*g[1]+g[2]*g[2]),_=[y/g[0],y/g[1],y/g[2]];hH(p,s,_,i.tolerance)&&this._intersectTriangles(l,c,s,n,o)}_intersectTriangles(t,r,i,s,n){t.baked.size&&t.baked.size[0]===r[0]&&t.baked.size[1]===r[1]||t.baked.bake(r),t.baked.intersect(i,s,n)}createBufferWriter(){return new P2(this._vertexBufferLayout)}requiresSlot(t,r){switch(r){case D.Shadow:case D.ShadowHighlight:case D.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case D.Color:case D.Alpha:case D.Depth:case D.Normal:case D.Highlight:case D.ObjectAndLayerIdColor:return t===(this.parameters.transparent?ae.TRANSPARENT_MATERIAL:ae.OPAQUE_MATERIAL)||t===ae.DRAPED_MATERIAL;default:return!1}}createGLMaterial(t){return new pKe(t)}static getVertexBufferLayout(){return Li().vec3f(E.POSITION).vec4f(E.PROFILERIGHT).vec4f(E.PROFILEUP).vec4f(E.PROFILEVERTEXANDNORMAL).vec4f(E.FEATUREVALUE)}}class pKe extends Ny{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}_updateShadowState(t){this.technique!=null&&t.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:t.shadowMap.enabled})}beginSlot(t){return this._output!==D.Color&&this._output!==D.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t)),this.ensureTechnique(X4,t)}}class fKe extends dKe{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}}const mKe=["polyline"];class gKe extends ff{constructor(t,r,i,s){super(t,r,i,s),this._intrinsicSize=or(1,1),this._upVectorAlignment=Gp.Path,this._stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const t=this.symbolLayer.width!=null?this.symbolLayer.width:this.symbolLayer.height,r=this.symbolLayer.height!=null?this.symbolLayer.height:t;this._vvConvertOptions=new Q3({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[t,1,r],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=this._context.renderer?.visualVariables?.length>0?GT(this._context.renderer,this._vvConvertOptions):null;const i=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?Gp.World:Gp.Path;const s=this.symbolLayer.profile||"circle";switch(s){default:case"circle":this._profile=IJe[i];break;case"quad":this._profile=$Je[i]}switch(this.symbolLayer.join){case"round":this._extruder=new pU(0,k0e);break;case"bevel":this._extruder=new pU(0,1);break;case"miter":this._extruder=new pU(.8*Math.PI,1);break;default:this._extruder=new vJe}const n=this.symbolLayer.cap||"butt";switch(n){case"none":this._startCap=new rte,this._endCap=new rte;break;case"butt":default:this._startCap=new vP(this._profile,0),this._endCap=new vP(this._profile,0,!0);break;case"square":this._startCap=new vP(this._profile,-.5),this._endCap=new vP(this._profile,.5,!0);break;case"round":{const p=s==="quad";this._startCap=new ite({profile:this._profile,flip:!1,breakNormals:p,subdivisions:oB}),this._endCap=new ite({profile:this._profile,flip:!0,breakNormals:p,subdivisions:oB});break}}const o=this.symbolLayer?.material?.color,a=this._getCombinedOpacityAndColor(o),l=fa(a),c=a[3],u=c<1||this.needsDrivenTransparentPass,d={diffuse:l,ambient:l,opacity:c,transparent:u,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:u||n==="none"?oi.None:oi.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(Qt(this._intrinsicSize,t,r),!nB(this._intrinsicSize[0])||!nB(this._intrinsicSize[1])))throw new G("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates&&this._fastUpdates.visualVariables.size||Pl(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const p={...d,...this._fastUpdates.materialParameters,size:pde(this._intrinsicSize)};this._material=new vW(p)}else d.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,d.normalType=wr.Compressed,this._material=new tf(d);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,mKe,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new Vc),s=t.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}layerOpacityChanged(){const t=this.symbolLayer?.material?.color,r=this._getCombinedOpacity(t),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:r,transparent:i})}layerElevationInfoChanged(t,r){return this.updateGraphics3DGraphicElevationInfo(t,r,Ry)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(t,r){for(const i in t.diff){if(i!=="visualVariables"||!jT(this._fastUpdates,r,this._vvConvertOptions))return xs.RecreateSymbol;this._material.setParameters(this._fastUpdates.materialParameters)}return xs.FastUpdate}_getVertexData(t){let r=0;const i=t.paths,s=[],n=t.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const d of i)r+=d.length;const l=To(3*r);let c,u=0;for(const d of i){s.push({offset:u,numVertices:d.length});for(const p of d)l[u++]=p[0],l[u++]=p[1],l[u++]=t.hasZ?p[2]:0}return o==null||n.equals(o)||ji(l,n,0,l,o,0,r)?(o==null||o.equals(a)?c=Bfe(l):(c=To(3*r),ji(l,o,0,c,a,0,r)),{pathVertexDataInfos:s,vertexDataES:l,vertexDataRS:c}):null}_createAs3DShape(t,r,i,s){const n=t.geometry,o=this._getVertexData(n);if(o==null)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(o.pathVertexDataInfos.length===0)return n.paths.length!==0&&n.paths.some(y=>y.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const a=new Array,l=n.spatialReference,c=Qs(),u=this._context.renderCoordsHelper,d=new eH(o.vertexDataES);for(const y of o.pathVertexDataInfos){const _=y.numVertices;if(_<2)continue;const v=y.offset;if(this._context.clippingExtent!=null&&(mi(c),Tc(c,o.vertexDataES,v,_),!rd(c,this._context.clippingExtent)))continue;const w=new Array,T=v+3*_;for(let I=v;I<T;I+=3){d.offset=I;const L=G7e(d,this._context.elevationProvider,i,u);se(ss,o.vertexDataRS[I],o.vertexDataRS[I+1],o.vertexDataRS[I+2]),u.setAltitude(ss,L),o.vertexDataRS[I]=ss[0],o.vertexDataRS[I+1]=ss[1],o.vertexDataRS[I+2]=ss[2],w.push(oKe(this._upVectorAlignment))}const x=new gJe(w,o.vertexDataES,o.vertexDataRS,v);hve(x,this._upVectorAlignment,this._context.renderCoordsHelper);const S=new yJe(x,this._profile,this._extruder,this._startCap,this._endCap);let O=null;if(this._fastUpdates){const I=this._fastUpdates.visualVariables,L=pd(I.size?.field,t)??0,N=pd(I.color?.field,t)??0,Z=pd(I.opacity?.field,t)??0;O=new TJe(S,L,N,Z)}else{const I=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const Z=r.size;I[0]*=ute(Z[0],Z[2]==="symbol-value"?this.symbolLayer.height||0:Z[2],this.symbolLayer.width||0),I[1]*=ute(Z[2],Z[0]==="symbol-value"?this.symbolLayer.width||0:Z[0],this.symbolLayer.height||0)}let L;this._drivenProperties.color&&(L=r.color),this._drivenProperties.opacity&&r.opacity!=null&&(L=L?[L[0],L[1],L[2],r.opacity]:[1,1,1,r.opacity]);const N=new tve(S);N.bake(I),L&&N.bakeVertexColors(L),O=N}const{vertexAttributes:A,indices:$}=O.createGeometryData(),P=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),U=new xJe(this._material,A,$,O,l,this._stencilWidth,P);U.transformation=Ja(be(),Ks,S.path.origin),a.push(U)}if(a.length===0)return null;const p=new ng({geometries:a,layerUid:this._context.layer.uid,graphicUid:s}),g=new pf(this,p,a,null,null,(y,_,v,w,T)=>_Ke(y,_,w,T,this._upVectorAlignment),i);return g.alignedSampledElevation=0,g.needsElevationUpdates=Ry(i.mode),g}}function hve(e,t,r){const{origin:i,positions:s}=e;let n=e.offset;switch(t){default:case Gp.World:for(const o of e.vertices)ss[0]=s[n++]+i[0],ss[1]=s[n++]+i[1],ss[2]=s[n++]+i[2],r.worldUpAtPosition(ss,ss),o.setFrameFromUpVector(ss);break;case Gp.Path:ss[0]=s[n]+i[0],ss[1]=s[n+1]+i[1],ss[2]=s[n+2]+i[2],r.worldUpAtPosition(ss,ss),PJe(e,ss)}}function ute(e,t,r){switch(e){case"symbol-value":return r;case"proportional":return t;default:return e}}function yKe(e,t,r,i){let s=0;const{origin:n,vertices:o,positions:a,positionsES:l}=e,c=e.offset+3*o.length;for(let u=e.offset;u<c;u+=3)se(ss,l[u],l[u+1],l[u+2]),r(ss,yU),s+=yU.sampledElevation,ss[0]=a[u]+n[0],ss[1]=a[u+1]+n[1],ss[2]=a[u+2]+n[2],i.setAltitude(ss,yU.z),a[u]=ss[0]-n[0],a[u+1]=ss[1]-n[1],a[u+2]=ss[2]-n[2];return e.updatePathVertexInformation(),s/o.length}function _Ke(e,t,r,i,s){const n=e.stageObject,o=n.geometries;let a=0;for(const l of o){if(!Q_e(l))continue;const c=l.path,u=c.builder.path;a+=yKe(u,t,r,i),s!==Gp.World&&hve(u,s,i),c.onPathChanged(l),l.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(l)}return a/o.length}const ss=C(),yU=new rO;function vKe(e,t,r,i,s=1){if(r.isGeographic&&i===Ie.Global){const c=To(t.length),u=t.length,d=Mr(r);for(let p=0;p<u;p+=3)xN(t,p,c,p,d);t=c}Qt(Gs,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<t.length;c+=3)Gs[0]=Math.min(Gs[0],t[c]),Gs[1]=Math.min(Gs[1],t[c+1]);const n=Gs[0]%s,o=Gs[1]%s,a=Gs[0]-n,l=Gs[1]-o;for(let c=0;c<t.length;c+=3){const u=c/3*4;e[u]=(t[c]-a)/s,e[u+1]=(t[c+1]-l)/s,e[u+2]=a/s,e[u+3]=l/s}}function dve(e,t,r,i,s=1){se(g_,1,0,0),se(y_,0,1,0),se(Kb,0,0,1),xKe(_U,r),bKe(r,hte)&&wKe(hte,g_,y_,Kb,i,_U),Qt(Gs,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),Qt(__,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let u=0;u<r.length;u+=3){se(Jb,r[u],r[u+1],r[u+2]);const d=de(g_,Jb),p=de(y_,Jb);Gs[0]=Math.min(Gs[0],d),Gs[1]=Math.min(Gs[1],p),__[0]=Math.max(__[0],d),__[1]=Math.max(__[1],p)}const n=de(Kb,_U);bU(Ig,Gs[0],Gs[1],n,g_,y_,Kb),bU(v_,__[0],Gs[1],n,g_,y_,Kb),bU(b_,Gs[0],__[1],n,g_,y_,Kb),ce(v_,v_,Ig),te(v_,v_,.5),ce(b_,b_,Ig),te(b_,b_,.5),oe(Ig,Ig,v_),oe(Ig,Ig,b_);const o=Gs[0]%s,a=Gs[1]%s,l=Gs[0]-o,c=Gs[1]-a;for(let u=0;u<r.length;u+=3){se(Jb,r[u],r[u+1],r[u+2]);const d=u/3,p=4*d;e[p]=(de(g_,Jb)-l)/s,e[p+1]=(de(y_,Jb)-c)/s,e[p+2]=l/s,e[p+3]=c/s;const g=9*d;for(let y=0;y<3;y++)t[g+y]=Ig[y],t[g+y+3]=v_[y],t[g+y+6]=b_[y]}}const _U=C(),Jb=C(),hte=Sr(),g_=C(),y_=C(),Kb=C(),Gs=Ne(),__=Ne(),Ig=C(),v_=C(),b_=C();function bKe(e,t){const r=e.length/3-1;return zde(e,t,0,Math.floor(r/3),Math.floor(r*(2/3)))}function wKe(e,t,r,i,s,n){s!=null?(s.basisMatrixAtPosition(n,Hd),se(wP,Hd[0],Hd[1],Hd[2]),se(xP,Hd[4],Hd[5],Hd[6]),se(vU,Hd[8],Hd[9],Hd[10])):(se(wP,1,0,0),se(xP,0,1,0),se(vU,0,0,1));const o=e;de(o,vU)<0&&te(o,o,-1),re(i,o);const a=de(o,xP),l=de(o,wP);Math.abs(a)<Math.abs(l)?(Ev(t,wP,o,-l),pe(t,t),rt(r,t,o),pe(r,r),te(r,r,-1)):(Ev(r,xP,o,-a),pe(r,r),rt(t,r,o),pe(t,t))}const Hd=be(),wP=C(),xP=C(),vU=C();function xKe(e,t){se(SS,0,0,0);for(let r=0;r<t.length-3;r+=3)SS[0]+=t[r],SS[1]+=t[r+1],SS[2]+=t[r+2];te(e,SS,1/(t.length/3-1))}const SS=C();function bU(e,t,r,i,s,n,o){se(e,t*s[0]+r*n[0]+i*o[0],t*s[1]+r*n[1]+i*o[1],t*s[2]+r*n[2]+i*o[2])}function TKe(e){const t=new pr,{vertex:r,fragment:i,attributes:s,varyings:n}=t;Fl(r,e),t.include(Xa,e),t.include(ub,e),t.include(wm,e),t.include(K3,e),s.add(E.POSITION,"vec3"),e.vvColor&&s.add(E.COLORFEATUREATTRIBUTE,"float"),n.add("vColor","vec4"),n.add("vpos","vec3");const o=e.hasMultipassTerrain&&(e.output===D.Color||e.output===D.Alpha);o&&n.add("depth","float"),r.uniforms.add(new Zt("eColor",c=>c.color));const a=e.output===D.Depth;a&&(t.include(jm,e),C1(t),by(t)),r.code.add(b`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${e.hasVertexColors?"vColor *= eColor;":e.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${o?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${a?b`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:b`transformPosition(proj, view, vpos);`}
    }
  `),t.include(os,e),o&&t.include(kc,e),i.include(df);const l=e.output===D.Highlight;return l&&t.include(ig,e),i.code.add(b`
  void main() {
    discardBySlice(vpos);
    ${o?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = vColor;

    ${e.output===D.ObjectAndLayerIdColor?b`fColor.a = 1.0;`:""}

    if (fColor.a < ${b.float(to)}) {
      discard;
    }

    ${e.output===D.Alpha?b`fragColor = vec4(fColor.a);`:""}

    ${e.output===D.Color?b`fragColor = highlightSlice(fColor, vpos); ${e.transparencyPassType===tt.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
    ${l?b`outputHighlight();`:""};
    ${e.output===D.Depth?b`outputDepth(linearDepth);`:""};
    ${e.output===D.ObjectAndLayerIdColor?b`outputObjectAndLayerIdColor();`:""}
  }
  `),t}const SKe=Object.freeze(Object.defineProperty({__proto__:null,build:TKe},Symbol.toStringTag,{value:"Module"}));class Z4 extends xr{initializeProgram(t){return new vr(t.rctx,Z4.shader.get().build(this.configuration),dr)}_createPipeline(t,r){const i=this.configuration,s=t===tt.NONE,n=t===tt.FrontFace;return Tt({blending:i.output!==D.Color&&i.output!==D.Alpha||!i.transparent?null:s?Pc:sg(t),culling:FN(i.cullFace),depthTest:{func:Uy(t)},depthWrite:(s||n)&&i.writeDepth?Ka:null,colorWrite:It,stencilWrite:i.hasOccludees?ef:null,stencilTest:i.hasOccludees?r?My:ky:null,polygonOffset:s||n?i.polygonOffset?EKe:null:d4(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,r){return r?this._occludeePipelineState:super.getPipelineState(t,r)}}Z4.shader=new _r(SKe,()=>ue(()=>import("./ColorMaterial.glsl.6b9c895e.js"),[]));const EKe={factor:1,units:1};class ho extends bo{constructor(){super(...arguments),this.output=D.Color,this.cullFace=oi.None,this.transparencyPassType=tt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1}}h([B({count:D.COUNT})],ho.prototype,"output",void 0),h([B({count:oi.COUNT})],ho.prototype,"cullFace",void 0),h([B({count:tt.COUNT})],ho.prototype,"transparencyPassType",void 0),h([B()],ho.prototype,"hasSlicePlane",void 0),h([B()],ho.prototype,"hasVertexColors",void 0),h([B()],ho.prototype,"transparent",void 0),h([B()],ho.prototype,"polygonOffset",void 0),h([B()],ho.prototype,"enableOffset",void 0),h([B()],ho.prototype,"writeDepth",void 0),h([B()],ho.prototype,"hasOccludees",void 0),h([B()],ho.prototype,"hasMultipassTerrain",void 0),h([B()],ho.prototype,"cullAboveGround",void 0),h([B()],ho.prototype,"objectAndLayerIdColorInstanced",void 0),h([B()],ho.prototype,"vvColor",void 0),h([B({constValue:!0})],ho.prototype,"hasVvInstancing",void 0),h([B({constValue:!1})],ho.prototype,"vvSize",void 0),h([B({constValue:!1})],ho.prototype,"vvOpacity",void 0);class dte extends ZH{constructor(t){super(t,new AKe),this.supportsEdges=!0,this._configuration=new ho}getConfiguration(t,r){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<u4,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}requiresSlot(t,r){return r===D.Color||r===D.Alpha||r===D.Highlight||r===D.Depth&&this.parameters.writeLinearDepth||r===D.ObjectAndLayerIdColor?t===ae.DRAPED_MATERIAL?!0:r===D.Highlight?t===ae.OPAQUE_MATERIAL:t===(this.parameters.transparent?this.parameters.writeDepth?ae.TRANSPARENT_MATERIAL:ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:ae.OPAQUE_MATERIAL):!1}createGLMaterial(t){return new CKe(t)}createBufferWriter(){const t=Li().vec3f(E.POSITION);return ne("enable-feature:objectAndLayerId-rendering")&&t.vec4u8(E.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?t.f32(E.COLORFEATUREATTRIBUTE):t.vec4u8(E.COLOR),new P2(t)}}class CKe extends Ny{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==D.Color&&this._output!==D.Alpha||this._updateOccludeeState(t),this.ensureTechnique(Z4,t)}}class AKe extends eO{constructor(){super(...arguments),this.color=Up,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=oi.None,this.hasOccludees=!1}}var eo;(function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Cross=2]="Cross",e[e.ForwardDiagonal=3]="ForwardDiagonal",e[e.BackwardDiagonal=4]="BackwardDiagonal",e[e.DiagonalCross=5]="DiagonalCross",e[e.COUNT=6]="COUNT"})(eo||(eo={}));const xB=.70710678118,pte=xB,OKe=.08715574274;function RKe(e){const t=new pr,r=e.hasMultipassTerrain&&(e.output===D.Color||e.output===D.Alpha),{vertex:i,fragment:s,attributes:n,varyings:o}=t;Fl(i,e),t.include(Xa,e),t.include(ub,e),t.include(wm,e),e.draped?i.uniforms.add(new Ae("worldToScreenRatio",(c,u)=>1/u.screenToPCSRatio)):n.add(E.BOUNDINGRECT,"mat3"),n.add(E.POSITION,"vec3"),n.add(E.UVMAPSPACE,"vec4"),e.vvColor&&n.add(E.COLORFEATUREATTRIBUTE,"float"),o.add("vColor","vec4"),o.add("vpos","vec3"),o.add("vuv","vec2"),r&&o.add("depth","float"),i.uniforms.add(new Zt("uColor",c=>c.color));const a=e.style===eo.ForwardDiagonal||e.style===eo.BackwardDiagonal||e.style===eo.DiagonalCross;a&&i.code.add(b`
      const mat2 rotate45 = mat2(${b.float(xB)}, ${b.float(-pte)},
                                 ${b.float(pte)}, ${b.float(xB)});
    `),e.draped||(xd(i,e),i.uniforms.add(new Ae("worldToScreenPerDistanceRatio",(c,u)=>1/u.camera.perScreenPixelRatio)),i.code.add(b`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),i.code.add(b`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),i.code.add(b`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${b.float(OKe)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),i.code.add(b`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${a?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${a?" * rotate45":""};

      ${e.draped?"":b`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${b.float(e.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const l=e.output===D.Depth;return l&&(t.include(jm,e),C1(t),by(t)),i.code.add(b`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      ${e.hasVertexColors?"vColor *= uColor;":e.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      gl_Position = ${l?b`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:b`transformPosition(proj, view, vpos);`}
    }
  `),t.include(os,e),s.include(df),e.draped&&s.uniforms.add(new Ae("texelSize",(c,u)=>1/u.camera.pixelRatio)),e.output===D.Highlight&&t.include(ig,e),r&&t.include(kc,e),e.output!==D.Highlight&&(s.code.add(b`
      const float lineWidth = ${b.float(e.lineWidth)};
      const float spacing = ${b.float(e.patternSpacing)};
      const float spacingINV = ${b.float(1/e.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),e.draped||s.code.add(b`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),s.code.add(b`
    void main() {
      discardBySlice(vpos);
      ${r?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${e.output!==D.Highlight?b`color.a *= ${PKe(e)};`:""}

      ${e.output===D.ObjectAndLayerIdColor?b`color.a = 1.0;`:""}

      if (color.a < ${b.float(to)}) {
        discard;
      }

      ${e.output===D.Alpha?b`fragColor = vec4(color.a);`:""}

      ${e.output===D.Color?b`fragColor = color; ${e.transparencyPassType===tt.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
      ${e.output===D.Highlight?b`outputHighlight();`:""}
      ${e.output===D.Depth?b`outputDepth(linearDepth);`:""};
    }
  `),t}function PKe(e){function t(r){return e.draped?b`coverage(vuv.${r}, texelSize)`:b`sampleAA(vuv.${r})`}switch(e.style){case eo.ForwardDiagonal:case eo.Horizontal:return t("y");case eo.BackwardDiagonal:case eo.Vertical:return t("x");case eo.DiagonalCross:case eo.Cross:return b`
        1.0 - (1.0 - ${t("x")}) * (1.0 - ${t("y")})
      `;default:return"0.0"}}const MKe=Object.freeze(Object.defineProperty({__proto__:null,build:RKe},Symbol.toStringTag,{value:"Module"}));class Y4 extends xr{initializeProgram(t){return new vr(t.rctx,Y4.shader.get().build(this.configuration),pve)}_setPipelineState(t,r){const i=this.configuration,s=t===tt.NONE,n=t===tt.FrontFace;return Tt({blending:i.output===D.Color||i.output===D.Alpha?s?Pc:sg(t):null,culling:FN(i.cullFace),depthTest:{func:Uy(t)},depthWrite:s?i.writeDepth?Ka:null:c4(t),colorWrite:It,stencilWrite:i.hasOccludees?ef:null,stencilTest:i.hasOccludees?r?My:ky:null,polygonOffset:s||n?i.polygonOffset?IKe:null:d4(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,r){return r?this._occludeePipelineState:super.getPipelineState(t,r)}}Y4.shader=new _r(MKe,()=>ue(()=>import("./Pattern.glsl.47141250.js"),[]));const IKe={factor:1,units:1};class Cn extends bo{constructor(){super(...arguments),this.output=D.Color,this.cullFace=oi.None,this.transparencyPassType=tt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.vvColor=!1}}h([B({count:D.COUNT})],Cn.prototype,"output",void 0),h([B({count:oi.COUNT})],Cn.prototype,"cullFace",void 0),h([B({count:eo.COUNT})],Cn.prototype,"style",void 0),h([B({count:tt.COUNT})],Cn.prototype,"transparencyPassType",void 0),h([B()],Cn.prototype,"hasSlicePlane",void 0),h([B()],Cn.prototype,"hasVertexColors",void 0),h([B()],Cn.prototype,"polygonOffset",void 0),h([B()],Cn.prototype,"writeDepth",void 0),h([B()],Cn.prototype,"hasOccludees",void 0),h([B()],Cn.prototype,"patternSpacing",void 0),h([B()],Cn.prototype,"lineWidth",void 0),h([B()],Cn.prototype,"enableOffset",void 0),h([B()],Cn.prototype,"draped",void 0),h([B()],Cn.prototype,"hasMultipassTerrain",void 0),h([B()],Cn.prototype,"cullAboveGround",void 0),h([B()],Cn.prototype,"vvColor",void 0),h([B({constValue:!1})],Cn.prototype,"hasVvInstancing",void 0),h([B({constValue:!1})],Cn.prototype,"vvSize",void 0),h([B({constValue:!1})],Cn.prototype,"vvOpacity",void 0);const pve=new Map([[E.POSITION,0],[E.COLOR,3],[E.UVMAPSPACE,4],[E.COLORFEATUREATTRIBUTE,5],[E.BOUNDINGRECT,6]]);class bW extends ZH{constructor(t){super(t,new DKe),this.supportsEdges=!0,this._vertexAttributeLocations=pve,this._configuration=new Cn}getConfiguration(t,r){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<u4,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}requiresSlot(t,r){return r===D.Color||r===D.Alpha||r===D.Highlight||r===D.Depth&&this.parameters.writeLinearDepth?t===ae.DRAPED_MATERIAL?!0:r===D.Highlight?t===ae.OPAQUE_MATERIAL:t===(this.parameters.writeDepth?ae.TRANSPARENT_MATERIAL:ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1}createGLMaterial(t){return new $Ke(t)}createBufferWriter(){const t=Li().vec3f(E.POSITION).vec4f(E.UVMAPSPACE);return this.parameters.draped||t.mat3f(E.BOUNDINGRECT),this.parameters.vvColor?t.f32(E.COLORFEATUREATTRIBUTE):t.vec4u8(E.COLOR),new LKe(t)}}class $Ke extends Ny{_updateParameters(t){return this.ensureTechnique(Y4,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==D.Color&&this._output!==D.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class LKe extends P2{write(t,r,i,s,n){for(const o of this.vertexBufferLayout.fields.keys()){const a=i.vertexAttributes.get(o),l=i.indices.get(o);if(a&&l)switch(o){case E.UVMAPSPACE:{Ye(a.size===4);const c=s.getField(o,Gl);c&&BT(l,a.data,c,n);break}case E.BOUNDINGRECT:{Ye(a.size===9);const c=s.getField(o,wd);c&&this.writeBoundingRect(l,a.data,t,c,n);break}default:Mge(o,a,l,t,r,s,n)}}}writeBoundingRect(t,r,i,s,n){const o=i,a=s.typedBuffer,l=s.typedBufferStride,c=t.length;n*=l;for(let u=0;u<c;++u){const d=9*t[u],p=r[d],g=r[d+1],y=r[d+2];a[n]=o[0]*p+o[4]*g+o[8]*y+o[12],a[n+1]=o[1]*p+o[5]*g+o[9]*y+o[13],a[n+2]=o[2]*p+o[6]*g+o[10]*y+o[14];for(let _=3;_<9;++_)a[n+_]=r[d+_];n+=l}}}class DKe extends eO{constructor(){super(...arguments),this.color=At(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=oi.None,this.hasOccludees=!1,this.style=eo.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}}function NKe(e,t){const r=e?.pattern??null;return r==null?new dte(t):r.style==="none"||r.style==="solid"?(r.style==="none"&&(t.color=At(0,0,0,0),t.transparent=!0),new dte(t)):(t.style=FKe(r.style),new bW(t))}function FKe(e){switch(e){case"horizontal":return eo.Horizontal;case"vertical":return eo.Vertical;case"cross":return eo.Cross;case"forward-diagonal":return eo.ForwardDiagonal;case"backward-diagonal":return eo.BackwardDiagonal;case"diagonal-cross":return eo.DiagonalCross;default:return}}function UKe(e){return e.material instanceof bW&&!e.material.parameters.draped}function kKe(e,t){if(UKe(e)){const r=e.vertexAttributes.get(E.POSITION).data,i=e.getMutableAttribute(E.UVMAPSPACE).data,s=e.getMutableAttribute(E.BOUNDINGRECT).data;dve(i,s,r,t)}}function zKe(e,t,r,i,s){const n=I0e(e,t,r,i,s),o=e.stageObject.geometries;for(const a of o)kKe(a,s);return n}const BKe=["polyline","polygon","extent"],fte=new Q3({size:!1,color:!0,rotation:!1,opacity:!1});class J4 extends ff{constructor(t,r,i,s){super(t,r,i,s),this._needsUV=!1,this._hasOutline=!1}async doLoad(){this._fastUpdates=GT(this._context.renderer,fte)}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if(this._material!=null)return;const t=this.symbolLayer?.material?.color,r=this._getCombinedOpacityAndColor(t);this._material=NKe(this.symbolLayer,{color:r,transparent:r[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...this._fastUpdates?.materialParameters}),this._needsUV=this._material instanceof bW,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const t=this.symbolLayer.outline;if(this._outlineMaterial||!this._isValidOutline(t))return;this._hasOutline=!0;const r=i=>{const s=C_e(t.pattern);return new mx({width:i,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:s,stippleScaleWithLineWidth:!0,cap:yB(t.patternCap||"butt")})};this._outlineMaterial=r(Ho(t.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(t){return t!=null&&t.size!=null&&t.size>0&&t.color!=null&&(t.pattern==null||t.pattern.type!=="style"||t.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,BKe,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(r,new Vc);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(r,i):this._createAs3DShape(r,i,s)}applyRendererDiff(t,r){for(const i in t.diff){if(i!=="visualVariables"||!jT(this._fastUpdates,r,fte))return xs.RecreateSymbol;this._material&&this._material.setParameters(this._fastUpdates.materialParameters)}return xs.FastUpdate}layerOpacityChanged(){if(this._material!=null){const t=this._material.parameters.color,r=this.symbolLayer?.material?.color,i=this._getCombinedOpacity(r);this._material.setParameters({color:[t[0],t[1],t[2],i],transparent:i<1||this.needsDrivenTransparentPass})}if(this._outlineMaterial!=null){const t=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[t[0],t[1],t[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(t,r,i){const s=this._elevationContext.mode,n=tO(J4.elevationModeChangeTypes,i,s);if(n!==Qi.UPDATE)return n;const o=th(s);return this.updateGraphics3DGraphicElevationInfo(t,r,()=>o)}slicePlaneEnabledChanged(){if(this._material&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._outlineMaterial){const t={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(t)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(t,r,i){const s=QA(t.geometry);if(!s)return null;const n=iW(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=new VKe(n,r,this._context.layer.uid,t.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=Vi(4*a,!0),o.boundingRect=To(9*a,!0),dve(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(t,o),this._hasOutline&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,s.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new ng({geometries:o.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:t.uid}),c=new pf(this,l,o.outGeometries,null,null,zKe,i);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=th(i.mode),c}_createAs3DShapeFill(t,r){const i=r.renderData.polygons;for(const{position:s,mapPositions:n,holeIndices:o,index:a,count:l}of i){if(this._context.clippingExtent!=null&&(mi(yh),Tc(yh,n),!rd(yh,this._context.clippingExtent)))continue;const c=qT(n,o,3);if(c.length===0)continue;const u=this._fastUpdates?.visualVariables.color,d=SQ({material:this._material,indices:c,mapPositions:n,attributeData:{position:s,color:u?null:r.color,colorFeature:u?pd(u.field,t):null,uvMapSpace:this._needsUV?_L(r.uvMapSpace,4*a,4*l):null,boundingRect:this._needsUV?Bu(r.boundingRect,9*a,9*l):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(d)}}_createAs3DShapeOutline(t){if(!this._hasOutline)return;const r=t.renderData.outlines;for(let i=0;i<r.length;++i){const{mapPositions:s,position:n}=r[i];if(this._context.clippingExtent!=null&&(mi(yh),Tc(yh,s),!rd(yh,this._context.clippingExtent)))continue;const o=_B(this._outlineMaterial,{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:s,attributeData:{position:n}},t.objectAndLayerIdColor);t.outGeometries.push(o)}}_createAsOverlay(t,r){const i=QA(t.geometry);if(i==null)return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,this._outlineMaterial!=null&&(this._outlineMaterial.renderPriority=this._renderPriority);const s=e_e(i,this._context.overlaySR),n=new GKe(s,r,this._context.layer.uid,t.uid),o=n.renderData.position.length/3;return this._needsUV&&(n.uvMapSpace=Vi(4*o,!0),vKe(n.uvMapSpace,n.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),n.outBoundingBox=mi(),n.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(n),this._createAsOverlayFill(t,n),this._hasOutline&&this._createAsOverlayOutline(n),this._logGeometryCreationWarnings(n.renderData,i.rings,"rings","FillSymbol3DLayer"),n.outGeometries.length===0?null:new B4(this,n.outGeometries,n.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(t,r){const i=r.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of i){const l=mi(yh);if(Tc(l,s),!rd(l,this._context.clippingExtent))continue;const c=qT(s,n,3);if(c.length===0)continue;hT(r.outBoundingBox,l);const u=this._fastUpdates?.visualVariables.color,d=SQ({material:this._material,indices:c,attributeData:{position:s,color:u?null:r.color,colorFeature:u?pd(u.field,t):null,uvMapSpace:this._needsUV?_L(r.uvMapSpace,4*o,4*a):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(new YT(d,r))}}_createAsOverlayOutline(t){if(!this._hasOutline)return;const r=t.renderData.outlines;for(let i=0;i<r.length;++i){const{position:s}=r[i];if(mi(yh),Tc(yh,s),!rd(yh,this._context.clippingExtent))continue;hT(t.outBoundingBox,yh);const n=_B(this._outlineMaterial,{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:s}},t.objectAndLayerIdColor);t.outGeometries.push(new YT(n,t))}}_getOutlineOpacity(){const t=this.symbolLayer?.outline?.color;return(this.draped?1:this._getLayerOpacity())*(t!=null?t.a:0)}_getOutlineColor(){const t=this.symbolLayer?.outline?.color,r=this._getOutlineOpacity();return IC(t!=null?ot.toUnitRGB(t):null,r)}test(){return{...super.test(),createAsOverlay:(t,r)=>this._createAsOverlay(t,r),createAs3DShape:(t,r,i)=>this._createAs3DShape(t,r,i)}}}J4.elevationModeChangeTypes={definedChanged:Qi.RECREATE,staysOnTheGround:Qi.NONE,onTheGroundChanged:Qi.RECREATE};const yh=Qs();class VKe extends S4{constructor(t,r,i,s){super(t,i,s),this.color=r}}class GKe extends S4{constructor(t,r,i,s){super(t,i,s),this.color=r}}const jKe="arial-unicode-ms",mte="woff2",gte=new Map,fve=new Set;class HKe{constructor(t,r){this.fontFace=t,this.promise=r}}async function WKe(e){const t=ZKe(e),r=gte.get(t);if(r)return r.promise;const i=new FontFace(e.family,`url('${Or.fontsUrl}/woff2/${t}.${mte}') format('${mte}')`,{style:e.style,weight:e.weight}),s=document.fonts;if(s.has(i)&&i.status==="loading")return i.loaded;const n=i.load().then(()=>(s.add(i),i));return gte.set(t,new HKe(i,n)),fve.add(i),n}function qKe(e){return fve.has(e)}function XKe(e){if(!e)return jKe;const t=e.toLowerCase().split(" ").join("-");switch(t){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return t}}function ZKe(e){const t=YKe(e)+JKe(e);return XKe(e.family)+(t.length>0?t:"-regular")}function YKe(e){if(!e.weight)return"";switch(e.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function JKe(e){if(!e.style)return"";switch(e.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}class K4{constructor(t){this.definition=t,this.key=JSON.stringify(t),this.haloSize=Math.round(t.halo.size),this.textStyle=this._colorToRGBA(t.color),this.haloStyle=this._colorToRGB(t.halo.color),this.backgroundStyle=t.background.color[3]!==0?this._colorToRGBA(t.background.color):null}fontString(t){const r=this.definition.font;return`${r.style} ${r.weight} ${t}px ${r.family}, sans-serif`}_colorToRGB(t){return`rgb(${t.slice(0,3).map(r=>Math.floor(255*r)).toString()})`}_colorToRGBA(t){return`rgba(${t.slice(0,3).map(r=>Math.floor(255*r)).toString()},${t[3]})`}static async fromSymbol(t,r){const i=t?.material?.color,s=ot.toUnitRGBA(i)??Up,n=t.size!=null?Ho(t.size):12,o=t.lineHeight,a=t.background!=null?ot.toUnitRGBA(t.background.color):Up,l={family:t.font?.family??"sans-serif",decoration:t.font?.decoration??"none",weight:t.font?.weight??"normal",style:t.font?.style??"normal"},c=t.halo,u=c!=null&&c.color!=null&&c.size>0?{size:Ho(c.size),color:ot.toUnitRGBA(c.color)}:{size:0,color:Up},d=new K4({color:s,size:n,background:{color:a,padding:t.background!=null?[.65*n,.5*n]:[0,0],borderRadius:t.background!=null?n*(6/16):0},lineSpacingFactor:o,font:l,halo:u,pixelRatio:r});if(t.font){let p=!1;const g=d.fontString(n);try{p=(await document.fonts.load(g)).some(y=>!qKe(y))}catch{K.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${g}'. Some text symbology may be rendered using the default browser font.`)}if(!p&&!KKe.has(t.font.family))try{await WKe(t.font)}catch{}}return d}}const KKe=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]);class QKe{constructor(t,r,i){this._renderer=new w_e(t,r,i)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const t=gB(eQe,this._renderer.renderedWidth,this._renderer.renderedHeight),r=t.getContext("2d");return r.save(),this._renderer.render(r,0,0),r.restore(),new lb(t,{wrap:{s:Ct.CLAMP_TO_EDGE,t:Ct.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}}const eQe={canvas:null},tQe=[0,0,1];class rQe extends ff{constructor(t,r,i,s){super(t,r,i,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const t=m4(this.symbolLayer.size);if(t)throw new G("graphics3dtextsymbollayer:invalid-size",t)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const t=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await K4.fromSymbol(this.symbolLayer,t)}destroy(){super.destroy()}createGraphics3DGraphic(t){const r=t.graphic,i=JA(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for text symbol: ${r.geometry.type}`),null;const s=this.symbolLayer.text;if(s==null||s==="")return null;const n=mG(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(n!=null&&!uhe(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o=new R0e(n,this.symbolLayer.horizontalAlignment,MXe(this.symbolLayer.verticalAlignment));return this._createAs3DShape(r,i,s,o)}createLabel(t,r,i,s){const n=t.graphic,o=JA(n.geometry);if(o==null)return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const a=r.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(n,o,a,r,i,s)}setGraphicElevationContext(t,r,i=0){const s=super.setGraphicElevationContext(t,r);return s.addOffsetRenderUnits(i),s}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(t,r){return yte(t,r,(i,s)=>{this.updateGraphicElevationContext(s,i)}),Qi.UPDATE}slicePlaneEnabledChanged(t,r){return yte(t,r,i=>{for(const s of i.stageObject.geometries)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(t,r){const i=r.elevationContext;this.setGraphicElevationContext(t,i,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=th(i.mode)||i.mode==="absolute-height"}_defaultElevationInfoNoZ(){return sQe}_createAs3DShape(t,r,i,s,n,o){const a=this.setGraphicElevationContext(t,new Vc,s.elevationOffset),l=t.geometry?.type==="polyline",c=t.uid;let u=null,d=null;if(o==null){const P=T_e(s.horizontalPlacement);u=new QKe(i,P,this._textRenderParameters);let U=null;if(this._context.sharedResources.textures!=null){d=this._context.sharedResources.textures.fromData(u.key,()=>u.create(),()=>{U?.release()});const I=this._context.stage.renderView.textureRepository.acquire(d.texture.id);if(I==null||zc(I))return d.release(),null;U=I}}const p=iQe(u,s),g={occlusionTest:!0,screenOffset:s.screenOffset,anchorPosition:p,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.centerOffsetUnits,drawInSecondSlot:!0};if(o!=null?g.textureId=o.id:d!=null&&(g.textureId=d.texture.id),s.verticalOffset!=null){const{screenLength:P,minWorldLength:U,maxWorldLength:I}=s.verticalOffset;g.verticalOffset={screenLength:Ho(P),minWorldLength:U||0,maxWorldLength:I??1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:P,screenSizePerspectiveSettingsLabels:U}=this._context.sharedResources;g.screenSizePerspective=U.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),g.screenSizePerspectiveAlignment=P}let y;if(l&&(g.shaderPolygonOffset=1e-4),g.hasSlicePlane=this._context.slicePlaneEnabled,n!=null){const P=JSON.stringify(g);y=n.get(P),y==null&&(y=new HT(g),n.add(P,y))}else y=new HT(g);const _=s.translation,v=u?or(u.displayWidth,u.displayHeight):vd,w=s.centerOffset,T=Ez(y,tQe,_,null,v,w,[0,0],null),x=$H(this._context,r,T,a,c);if(x==null)return null;const S=new pf(this,x.object,[T],n==null?[y]:null,d,Wv,a);S.alignedSampledElevation=x.sampledElevation,S.needsElevationUpdates=th(a.mode)||a.mode==="absolute-height";const{displayWidth:O,displayHeight:A}=u??s;S.getScreenSize=(P=Ne())=>(P[0]=O,P[1]=A,P);const $=new U0e(s.elevationOffset,i);return S.metadata=$,YA(S,r,this._context.elevationProvider),S}}function yte(e,t,r){e&&e.forEach(i=>{const s=t(i);s!=null&&r(s,i.graphic)})}function iQe(e,t){if(t.verticalPlacement==="baseline"){const i=OXe[t.horizontalPlacement],s=e!=null?e.baselineAnchorY:0;return or(i,s)}const r=PXe(t.horizontalPlacement,t.verticalPlacement);return wI[r]}const sQe={mode:"relative-to-ground",offset:0},nQe={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},oQe=["polyline","polygon","extent"];class xp extends ff{constructor(t,r,i,s){super(t,r,i,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,oQe,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new Vc);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(r):this._createAs3DShape(r,i,r.uid)}ensureMaterial(){if(this._material!=null)return;const t=new Xye,r=this.symbolLayer.color;r!=null&&(t.color=ot.toUnitRGBA(r));const i=this._getCombinedOpacity(r,{hasIntrinsicColor:!0});t.color=[t.color[0],t.color[1],t.color[2],i],t.transparent=i<1||this.needsDrivenTransparentPass,t.waveDirection=this.symbolLayer.waveDirection!=null?xp.headingVectorFromAngle(this.symbolLayer.waveDirection):or(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=nQe[s];t.waveStrength=n.waveStrength,t.waveTextureRepeat=n.textureRepeat,t.waveVelocity=n.waveVelocity,t.flowStrength=n.perturbationStrength,t.hasSlicePlane=this._context.slicePlaneEnabled,t.isDraped=this.draped,this._material=new qye(t),this._context.stage.add(this._material)}layerOpacityChanged(){if(this._material==null)return;const t=this._material.parameters.color,r=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({color:[t[0],t[1],t[2],r],transparent:i})}layerElevationInfoChanged(t,r,i){const s=this._elevationContext.mode,n=tO(xp.elevationModeChangeTypes,i,s);if(n!==Qi.UPDATE)return n;const o=th(s);return this.updateGraphics3DGraphicElevationInfo(t,r,()=>o)}slicePlaneEnabledChanged(){return this._material!=null&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(t,r,i){const s=QA(t.geometry);if(s==null)return null;const n=iW(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=n.position.length/3,a=To(2*o);this._createUVCoordsFromVertices(a,n.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new aQe(n,a,this._context.layer.uid,t.uid);if(l.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(l),this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,s.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new ng({geometries:l.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),u=new pf(this,c,l.outGeometries,null,null,I0e,r);return u.alignedSampledElevation=l.renderData.sampledElevation,u.needsElevationUpdates=th(r.mode),u}_createUVCoordsFromVertices(t,r,i,s){const n=Sa(s);qu($g);for(let l=0;l<i;l++)Qt(_te,r[3*l],r[3*l+1]),z7($g,_te);t1($g,$g,n);const o=$g[0]%xp.unitSizeOfTexture,a=$g[1]%xp.unitSizeOfTexture;TP[0]=$g[0]-o,TP[1]=$g[1]-a;for(let l=0;l<i;l++)t[2*l]=(r[3*l]*n-TP[0])/xp.unitSizeOfTexture,t[2*l+1]=(r[3*l+1]*n-TP[1])/xp.unitSizeOfTexture}_create3DShapeGeometries(t){const r=t.renderData.polygons,i=t.uvCoords;for(const{count:s,index:n,position:o,mapPositions:a,holeIndices:l}of r){if(this._context.clippingExtent!=null&&(mi(w_),Tc(w_,a),!rd(w_,this._context.clippingExtent)))continue;const c=qT(a,l,3);if(c.length===0)continue;const u=Bu(i,2*n,2*s),d=EQ({material:this._material,indices:c,mapPositions:a,attributeData:{position:o,uv0:u}},t.objectAndLayerIdColor);t.outGeometries.push(d)}}_createAsOverlay(t){const r=QA(t.geometry);if(r==null)return null;this._material.renderPriority=this._renderPriority;const i=e_e(r,this._context.overlaySR),s=i.position.length/3,n=To(2*s);this._createUVCoordsFromVertices(n,i.position,s,this._context.overlaySR);const o=new lQe(i,n,this._context.layer.uid,t.uid);return o.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(o),o.outBoundingBox=mi(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,r.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new B4(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(t){const r=t.uvCoords,i=t.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of i){if(mi(w_),Tc(w_,s),!rd(w_,this._context.clippingExtent))continue;hT(t.outBoundingBox,w_);const l=qT(s,n,3);if(l.length===0)continue;const c=Bu(r,2*o,2*a),u=EQ({material:this._material,indices:l,attributeData:{position:s,uv0:c}},t.objectAndLayerIdColor);t.outGeometries.push(new YT(u,t))}}static headingVectorFromAngle(t){const r=Ne(),i=TD(t);return r[0]=Math.sin(i),r[1]=Math.cos(i),r}test(){return{...super.test(),create3DShape:t=>this._createAs3DShape(t.graphic,t.elevationContext,t.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}xp.unitSizeOfTexture=100,xp.elevationModeChangeTypes={definedChanged:Qi.RECREATE,staysOnTheGround:Qi.NONE,onTheGroundChanged:Qi.RECREATE};const TP=Ne(),$g=Nt(),_te=Ne(),w_=Qs();class aQe extends S4{constructor(t,r,i,s){super(t,i,s),this.uvCoords=r}}class lQe extends S4{constructor(t,r,i,s){super(t,i,s),this.uvCoords=r}}function cQe(e,t,r,i){const s=hQe[e.type]?.[t.type]||uQe[t.type];return s?new s(e,t,r,i):(K.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${t.type}`),null)}const uQe={icon:s3,object:mJe,line:G4,path:gKe,fill:J4,extrude:cqe,text:rQe,water:xp},hQe={"mesh-3d":{fill:UZe}};class dQe extends PH{set symbol(t){this._symbol=t,t.symbolLayers.forEach((r,i)=>{const s=this.symbolLayers[i];s!=null&&(s.symbol=t,s.symbolLayer=r)})}get symbol(){return this._symbol}constructor(t,r,i){super(r.schedule),this._symbol=t,this._context=r,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(t){let r=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(r=this._backgroundLayers.concat(r));const i=r.length;for(;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length;const s=[];for(let n=0;n<i;n++){const o=r.at(n);if(o.enabled===!1)continue;SP.renderPriority=1-(1+n)/i,SP.renderPriorityStep=1/i,SP.ignoreDrivers=o.ignoreDrivers;const a=cQe(this.symbol,o,this._context,SP),l=ND(t,()=>{this.symbolLayers[n]=null,a.destroy()});l&&s.push(l),this.symbolLayers[n]=a}if(await IN(this.symbolLayers,async(n,o)=>{if(n!=null)try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}}),s.forEach(n=>n.remove()),Jt(t),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(t){const r=this.symbolLayers[t];return r!=null?r.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(t=>t!=null&&t.queryForSnapping)}createGraphics3DGraphic(t,r){const i=t.graphic,s=this.symbolLayers.map(o=>o?.createGraphics3DGraphic(t)??null),n=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new dje(i,r||this,s,t.layer,n)}get complexity(){return IH(this.symbolLayers.map(t=>t!=null?t.complexity:null))}globalPropertyChanged(t,r){const i=this.symbolLayers.length;for(let s=0;s<i;s++){const n=this.symbolLayers[s],o=a=>{const l=a.layers[s];return l instanceof pf?l:null};if(n!=null&&!n.globalPropertyChanged(t,r,o))return!1}return!0}applyRendererDiff(t,r){return this.loadStatus!==mc.LOADED?xs.RecreateSymbol:this.symbolLayers.reduce((i,s)=>i!==xs.RecreateSymbol&&s!=null?Math.min(i,s.applyRendererDiff(t,r)):i,xs.FastUpdate)}prepareSymbolPatch(t){if(this.loadStatus===mc.FAILED||t.diff.type!=="partial")return;const r=t.diff.diff;if(!r.symbolLayers||r.symbolLayers.type!=="partial")return;const i=r.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(s==null)return;const o=i[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),t.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&t.graphics3DGraphicPatches.push((l,c)=>{const u=l.layers[n];u!=null&&a.graphics3DGraphicPatches.forEach(d=>d(u,c))})}})}updateGeometry(t,r){return this._updateGeometryOrTransform(t,(i,s)=>i.updateGeometry(s,r))}updateTransform(t,r,i,s){return this._updateGeometryOrTransform(t,(n,o)=>n.updateTransform(o,r,i,s))}_updateGeometryOrTransform(t,r){for(let i=0;i<this.symbolLayers.length;i++){const s=this.symbolLayers[i];if(s==null)continue;const n=t.layers[i];if(!n||!r(s,n))return!1}return!0}onRemoveGraphic(t){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(i==null)continue;const s=t.layers[r];s!=null&&i.onRemoveGraphic(s)}}getFastUpdateStatus(){let t=0,r=0,i=0;return this.symbolLayers.forEach(s=>{s!=null&&(s.loadStatus===mc.LOADING?t++:s.isFastUpdatesEnabled()?i++:r++)}),{loading:t,slow:r,fast:i}}async queryForSnapping(t,r,i,s){const n=this.symbolLayers.filter(v3).filter(a=>a.queryForSnapping!=null).map(a=>a.queryForSnapping(t,r,i,s)),o=await Promise.all(n);return Jt(s),o.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const t of this.symbolLayers)t?.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}}const SP=new pje;class pQe extends PH{constructor(t,r,i){super(r),this.symbol=t,this._convert=i,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(t){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(t):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(t){const r=await this.symbol.fetchSymbol({signal:t});r.id=this.symbol.id,this.graphics3DSymbol=this._convert(r),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(t){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(t,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:MH}globalPropertyChanged(t,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(t,r)}applyRendererDiff(t,r){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(t,r):xs.RecreateSymbol}prepareSymbolPatch(t){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(t)}updateGeometry(t,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(t,r)}updateTransform(t,r,i,s){return this.graphics3DSymbol?.updateTransform(t,r,i,s)??!1}onRemoveGraphic(){}getFastUpdateStatus(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}}function wW(e){return e instanceof pQe?e.graphics3DSymbol:e instanceof dQe?e:null}const n3=K.getLogger("esri.views.3d.layers.graphics.labelPlacement");function fQe(e){const t=TQe(e);if(t==null)return null;const r=mQe(e,t);if(r==null)return null;const i=r.anchor,s=!!t.hasLabelVerticalOffset;return yQe({anchor:i,verticalOffset:t.verticalOffset,screenOffset:Ne(),centerOffset:At(0,0,0,-1),centerOffsetUnits:"world",translation:C(),elevationOffset:0,hasLabelVerticalOffset:s},r,e)}function mQe(e,t){if(t.anchor)return t;const r=e.labelClass.labelPlacement,i=od[r],s=i||iD(e);return r&&!i&&n3.warnOncePerTick(`the requested label placement '${r}' is currently unsupported in SceneView.`),gQe(s,e)}function xW(e){const t=e.graphics3DGraphic.graphics3DSymbol,r=wW(t);return r!=null?r.symbol.symbolLayers.at(0):null}function gQe(e,t){const r=t.graphics3DGraphic.graphic.geometry;if(r==null)return null;if(t.disablePlacement!=null)return t.labelClass.labelPlacement?(n3.warnOncePerTick(vte(e?.placement,t.disablePlacement.logEntityDescription)),iD(t)):e;const i=r.type;switch(i){case"polyline":case"polygon":case"extent":case"multipoint":if(t.labelClass.labelPlacement)return n3.warnOncePerTick(vte(e?.placement,`'${i}' geometries`)),iD(t);break;case"point":case"mesh":return e}return e}function vte(e,t){return`the requested label placement '${e}' is currently unsupported for ${t} in SceneView.`}function iD(e){const t=e.graphics3DGraphic.graphic.geometry;if(t==null)return null;switch(t.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const r=xW(e);return r!=null&&r.type==="extrude"?od["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return od["above-center"];default:return}}function yQe(e,t,r){const i=r.graphics3DGraphic.graphic.geometry;if(i==null)return null;switch(i.type){case"point":vQe(e,t,r);break;case"polygon":_Qe(e,t,r);break;case"mesh":TW(e,t,r.graphics3DGraphic.layers[0])}return e}function _Qe(e,t,r){const i=xW(r);if(i!=null)switch(i.type){case"extrude":{const s=r.graphics3DGraphic.layers[0];s!=null?(s.getBoundingBoxObjectSpace(VC),td(VC,e.translation),e.translation[2]=Ly(VC)/2):se(e.translation,0,0,0),TW(e,t,s);break}}}function vQe(e,t,r){const i=xW(r);if(i==null)return;const s=r.graphics3DGraphic.layers[0];switch(s!=null?s.getCenterObjectSpace(e.translation):se(e.translation,0,0,0),i.type){case"icon":case"text":bQe(e,t,r,s);break;case"object":TW(e,t,s)}}function bQe(e,t,r,i){const{graphics3DGraphic:s}=r,n=i!=null?i.getScreenSize():null;if(s.isDraped||n==null)e.hasLabelVerticalOffset||e.anchor==="center"||(od[r.labelClass.labelPlacement]&&n3.warnOncePerTick(`the requested placement '${t.placement}' is currently unsupported for draped graphics`),e.anchor="center");else{const o=wQe(r);e.screenOffset[0]=n[0]/2*(t.normalizedOffset[0]-o[0]);const a=n[1]/2*(t.normalizedOffset[1]-o[1]);e.hasLabelVerticalOffset?(e.centerOffset[1]=a,e.centerOffsetUnits="screen"):e.screenOffset[1]=a}}function wQe(e,t=SQe){const{graphics3DGraphic:r}=e,i=r.layers[0],s=i!=null?i.stageObject.geometries[0].material:null;if(s&&s instanceof HT){const n=s.parameters.anchorPosition;t[0]=2*(n[0]-.5),t[1]=2*(n[1]-.5)}else t[0]=0,t[1]=0;return t}function TW(e,t,r){const i=r!=null?r.getBoundingBoxObjectSpace(VC):VC,s=Ce(i[3]-i[0],i[4]-i[1],i[5]-i[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);e.centerOffset[0]=n/2*t.normalizedOffset[0];const o=e.translation[2],a=s[2]/2*t.normalizedOffset[1];e.translation[2]=0,e.elevationOffset=o+a;const l=Se(s);e.centerOffset[2]=l/2*t.normalizedOffset[2]}function xQe(e){return e==="above-center"}function TQe(e){const t=e.labelClass.labelPlacement,{labelSymbol:r,graphics3DGraphic:i}=e,s=wW(i.graphics3DSymbol),n=Lu(s,a=>a.symbol.type==="point-3d"?a.symbol:null),o=od[t]||iD(e);return n!=null&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!i.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:bte(n.verticalOffset),anchor:null,normalizedOffset:null}:!r||!r.hasVisibleVerticalOffset()||n!=null&&n.supportsCallout()&&n.verticalOffset&&!i.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:o&&xQe(o.placement)?{placement:"above-center",verticalOffset:bte(r.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(n3.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+t+" placement)"),null)}function bte(e){const{screenLength:t,minWorldLength:r,maxWorldLength:i}=e;return{screenLength:t,minWorldLength:r,maxWorldLength:i}}const od={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},wte={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const e in wte){const t=wte[e],r=od[e];t.forEach(i=>{od[i]=r})}Object.freeze&&(Object.freeze(od),Object.keys(od).forEach(e=>{Object.freeze(od[e]),Object.freeze(od[e]?.normalizedOffset)}));const SQe=[0,0],VC=Qs();class xte{constructor(t){this._stage=t,this._materials=new Map}get(t){return this._materials.get(t)}add(t,r){this._materials.set(t,r),this._stage.add(r)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}}const EP=4096;class EQe{constructor(){this.offset={x:0,y:0},this.uvMinMax=Ht()}}class CQe{constructor(t,r){this.textId=t,this.textRenderer=r,this.placement=new EQe,this.rendered=!1}}class AQe{constructor(t,r,i){this.size=t,this.cursor=r,this.lineHeight=i}resize(t){this.size.height=t}resetCursor(){this.cursor.x=GC,this.cursor.y=GC+mve,this.lineHeight=0}getUsage(){return(this.cursor.x+this.cursor.y*this.size.width)/(this.size.width*this.size.height)}}let zE=class extends xe{constructor(e){super(e),this.type=Ki.Texture,this.id=Nl(),this.events=new cs,this._glTexture=null,this._needsClear=!1,this._elementsToAddOrUpdate=new Map,this._elementsToRemove=new Map,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._atlas=new AQe({width:EP,height:256},{x:0,y:0},0),this._updateCanvasElementSize(this._atlas),this._resetAtlasCursor()}unload(){this._glTexture=De(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get requiresFrameUpdates(){return!1}_createDescriptor(e){const t=new hr;return t.wrapMode=Ct.CLAMP_TO_EDGE,t.flipped=!0,t.samplingMode=xt.LINEAR_MIPMAP_LINEAR,t.hasMipmap=!0,t.preMultiplyAlpha=!0,t.maxAnisotropy=e.parameters.maxMaxAnisotropy,t}get glTexture(){return this._glTexture}load(e){return this._glTexture!=null||(this._glTexture=new wt(e,this._createDescriptor(e),this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(at.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this._elements=null,this._elementsToAddOrUpdate=null,this._elementsToRemove=null,this._elementsToRender=null,this._frameWorker=xi(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=De(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.setAttribute("width",e.size.width.toString()),this._canvas.setAttribute("height",e.size.height.toString())}_resizeAtlas(e){this._atlas.resize(e),this._glTexture!=null&&this._glTexture.resize(this._atlas.size.width,e),this._updateCanvasElementSize(this._atlas)}_resetAtlasCursor(){this._atlas.resetCursor(),this._needsClear=!0}_addAtlasElement(e,t,r,i){const s=this._atlas,{renderedWidth:n,renderedHeight:o}=e.textRenderer;e.placement.offset.x=s.cursor.x,e.placement.offset.y=s.cursor.y,pi(e.placement.uvMinMax,e.placement.offset.x/s.size.width,1-(e.placement.offset.y+o)/s.size.height,(e.placement.offset.x+n)/s.size.width,1-e.placement.offset.y/s.size.height),s.cursor.x+=r,s.lineHeight=Math.max(s.lineHeight,i),this._elements.set(t,e)}_removeAtlasElement(e){if(e&&this._elements.has(e.textId)){const t=e.placement.offset;this._ctx.clearRect(t.x,t.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),this._elements.delete(e.textId)}}_ensureStageObjects(e){const t=this._stageObjects.get(e);if(t)return t;const r=new Set;return this._stageObjects.set(e,r),r}_addStageObject(e,t){this._ensureStageObjects(e).add(t)}_removeStageObject(e,t){const r=this._stageObjects.get(e);r&&r.delete(t)&&(t.geometries[0].setAttributeData(E.SIZE,[0,0]),t.geometryVertexAttrsUpdated(t.geometries[0]))}_processAddition(e,t){const r=this._atlas,i=e.textId,s=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,o=s+GC,a=n+GC+mve;if(r.cursor.x+o<r.size.width&&r.cursor.y+a<r.size.height)this._addAtlasElement(e,i,o,a),this._elementsToRender.set(i,e),this._elementsToAddOrUpdate.delete(i);else{if(!(r.cursor.y+a+r.lineHeight<r.size.height)){const l=r.cursor.y+a+r.lineHeight-r.size.height,c=r.size.height+l<EP;if(c){const u=Math.ceil(r.size.height*Math.max(1.3,(l+r.size.height)/r.size.height));this._resizeAtlas(Math.min(qH(u),EP))}return!t||!c&&r.size.height===EP?(this._processRemovals(),gx.OK):(this._repack(),gx.REPACK)}r.cursor.x=GC,r.cursor.y+=r.lineHeight,r.lineHeight=0,this._addAtlasElement(e,i,o,a),this._elementsToRender.set(i,e),this._elementsToAddOrUpdate.delete(i)}return gx.OK}_processRemovals(){this._elementsToRemove.forEach((e,t)=>{const r=this._stageObjects.get(t);r&&r.size!==0||this._removeAtlasElement(e),r&&r.size===0&&this._stageObjects.delete(t)}),this._elementsToRemove.clear()}_repack(){this._processRemovals(),this._elements.forEach((e,t)=>{e.rendered=!1,this._elementsToAddOrUpdate.set(t,e)}),this._elements.clear(),this._resetAtlasCursor(),this._elementsToRender.clear()}_processRenderingRequest(e){this._ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),e.textRenderer.render(this._ctx,e.placement.offset.x,e.placement.offset.y);const t=this._stageObjects.get(e.textId);t&&t.forEach(r=>{r.geometries[0].setAttributeData(E.UV0,e.placement.uvMinMax),r.geometries[0].setAttributeData(E.SIZE,[e.textRenderer.displayWidth,e.textRenderer.displayHeight]),r.geometryVertexAttrsUpdated(r.geometries[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,t=!0){if(this._glTexture==null)return Eo.YIELD;let r=!1;if(_o(this._elementsToAddOrUpdate,(s,n)=>{if(this._elements.get(n)?.rendered){const a=this._stageObjects.get(n);return a&&a.forEach(l=>{const c=l.geometries[0],u=this._elements.get(n);c.setAttributeData(E.UV0,u.placement.uvMinMax),c.setAttributeData(E.SIZE,[u.textRenderer.displayWidth,u.textRenderer.displayHeight]),l.geometryVertexAttrsUpdated(l.geometries[0])}),this._elementsToAddOrUpdate.delete(n),e.madeProgress(),!1}return this._processAddition(this._elementsToAddOrUpdate.get(n),t)===gx.REPACK&&(r=!0,!0)}),r)return this.runTask(_a,!1),void e.madeProgress();let i=!1;this._elementsToRender.size>0&&this._needsClear&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._needsClear=!1),_o(this._elementsToRender,(s,n)=>(this._processRenderingRequest(s),this._elementsToRender.delete(n),i=!0,e.madeProgress(),e.done)),i&&this._glTexture.setData(this._canvas),this.updating=this._elementsToRender.size>0,!this.updating&&Xje.orderedRepackingEnabled&&(this.repackOrdered(),e.madeProgress())}addTextTexture(e,t){const r=e.key;this._elementsToAddOrUpdate.has(r)||this._elementsToAddOrUpdate.set(r,new CQe(r,e)),this._addStageObject(r,t),this._elementsToRemove.delete(r),this.setDirty()}removeTextTexture(e,t){const r=e.key;this._elementsToRemove.set(r,this._elements.get(r)),this._removeStageObject(r,t)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this._elements.size===0)return;const e=[];this._elements.forEach((r,i)=>e.push({element:r,key:i}));let t=!0;for(let r=0;r<e.length-1;r++)if(e[r].key.localeCompare(e[r+1].key)>0){t=!1;break}if(!t||this._elementsToRemove.size){e.sort((r,i)=>r.key.localeCompare(i.key)),this._elements.clear();for(const{element:r,key:i}of e)this._elements.set(i,r);this._repack(),this.setDirty()}}get test(){const{_elements:e,_stageObjects:t,_elementsToRemove:r,_atlas:i}=this,s=this;return{elements:e,stageObjects:t,elementsToRemove:r,atlas:i,resizeAtlas:n=>s._resizeAtlas(n),run:(n,o)=>s.runTask(n,o)}}};h([f({constructOnly:!0})],zE.prototype,"view",void 0),h([f({type:Boolean})],zE.prototype,"updating",void 0),zE=h([F("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],zE);const GC=2,mve=2;var gx;(function(e){e[e.OK=0]="OK",e[e.REPACK=1]="REPACK"})(gx||(gx={}));class Tte{constructor(t,r){this.labelingContext=t,this.graphics3DGraphic=r,this.hasGraphics3DResources=!1,this.visible=!1,this.rendered=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}}class OQe{constructor(t,r,i,s,n){this.labelClass=t,this.graphics3DSymbol=r,this.graphics3DCalloutSymbolLayer=i,this.textRenderParameters=s,this.labelFunction=n,this.calloutSymbolLayerIndex=0}}class RQe{constructor(t,r,i,s,n,o,a,l){this.layer=r,this.graphics3DCore=i,this.scaleVisibility=s,this.emptySymbolLabelSupported=n,this.elevationInfoOverride=o,this.disablePlacement=a,this.active=l,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new Sye(t,{pickable:!0,disableOctree:!0},r.uid)}destroy(){this.stageLayer.destroy()}}let ev=class extends xe{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new gi,this._handles.add([le(()=>this.view.state?.camera,()=>this.setDirty()),le(()=>this.view.state?.rasterPixelRatio,()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(at.LABELER,this)]),this._textTextureAtlas=new zE({view:this.view}),this._hudMaterialCollection=new xte(this.view._stage),this._calloutMaterialCollection=new xte(this.view._stage)}dispose(){this._handles=Re(this._handles),this._textTextureAtlas=De(this._textTextureAtlas),this._hudMaterialCollection=De(this._hudMaterialCollection),this._calloutMaterialCollection=De(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}destroy(){this.dispose(),_h.graphic=null,_h.renderingInfo=null,_h.layer=null}_activateLabelingContext(e){e.graphics.forEach((t,r)=>{const i=new Tte(e,t);this._labels.set(r,i),e.labelsToInitialize.set(r,i),t.setVisibilityFlag($n.LABEL,wo.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((t,r)=>{t.setVisibilityFlag($n.LABEL,wo.USER,!1),this.setLabelGraphicVisibility(t,!1),this._labels.delete(r)}),e.active=!1}_addLabelTextureToAtlas(e){for(const t of e.graphics3DGraphic.labelLayers){if(!t._labelClass)continue;const r=e.textRenderers[t._labelIndex];r&&this._textTextureAtlas.addTextTexture(r,t.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const t of e.graphics3DGraphic.labelLayers){if(!t._labelClass)continue;const r=e.textRenderers[t._labelIndex];r!=null&&this._textTextureAtlas.removeTextTexture(r,t.stageObject)}e.rendered=!1}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),Eo.YIELD}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const t of this._labelingContexts)if(t.active){if(!Ste(t)){if(PQe(t)){this._deactivateLabelingContext(t);continue}if(this._createLabelClassContext(t),wU(t)){this._dirty=!0;continue}if(!Ste(t))continue}_o(t.labelsToInitialize,(r,i)=>(this._ensureGraphics3DResources(r)&&(this._labels.set(i,r),this.deconflictor.setDirty(),e.madeProgress()),(r.visible&&r.textInitialized||!r.visible&&r.hasGraphics3DResources)&&(t.labelsToInitialize.delete(i),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(t=>this._removeLabelTextureFromAtlas(t)),this._labelsToAdd.forEach(t=>this._addLabelTextureToAtlas(t)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const t=e.labelClassAbortController?.signal;await e.layer.when?.(),Jt(t),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const r=e.graphics3DCore,i=r.layer,s=i.labelingInfo&&i.labelingInfo.filter(n=>!!n.symbol);!s||s.length===0||(await IN(s,async(n,o)=>{const a=n.symbol,l=wW(r.getOrCreateGraphics3DSymbol(a));if(l==null)return void K.getLogger(this).error("Failed to create Graphics3DSymbol for label");await l.load(),Jt(t);let c=null;mG(a)&&a.hasVisibleCallout()&&(c=VGe(a,r.symbolCreationContext),await c.load(),Jt(t));const u=await Yu(A0e(n,e.layer.fieldsIndex,this.view.spatialReference));if(Jt(t),u.ok===!0){const d=await this._createTextRenderParameters(l.symbol);Jt(t),e.labelClassContexts[o]=new OQe(n,l,c,d,u.value)}else K.getLogger(this).error(`Label expression failed to evaluate: ${u.error}`)}),Jt(t))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(t=>{if($s(t))throw t;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const t=e.symbolLayers.at(0);return t?.type!=="text"?null:K4.fromSymbol(t,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)--r.graphics3DSymbol.referenced;const t=e.labelClassAbortController;e.labelClassAbortController=new AbortController,$c(t),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,t,r,i,s){const n=new R0e(r.verticalOffset,Cee(r.anchor),RXe(r.anchor),e.text,r.translation,r.elevationOffset,r.centerOffset,r.screenOffset,r.centerOffsetUnits,e.displayWidth,e.displayHeight);return _h.graphic=t,_h.renderingInfo=null,_h.layer=i,s.createLabel(_h,n,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,t,r,i,s){return _h.graphic=e,_h.layer=s,_h.renderingInfo=new zGe(null,t,i.translation,i.centerOffset,i.screenOffset,i.centerOffsetUnits,i.elevationOffset,this._calloutMaterialCollection),r.createGraphics3DGraphic(_h)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const t=e.graphics3DGraphic;if(t.destroyed)return!1;this._ensureTextTextureResources(e);const r=e.labelingContext,i=r.labelClassContexts;if(!i||i.length===0||!r.emptySymbolLabelSupported&&t.layers.length===0)return!1;let s=!1;const n=t.graphic,o=r.layer,a=CP(r.layer);for(let l=0;l<i.length;l++){const c=e.textRenderers[l],u=e.textLabelPlacements[l];if(c==null||u==null)continue;const d=i[l],p=d.graphics3DSymbol,g=p.symbol&&p.symbol.type==="label-3d"?p.symbol:null,y=p.symbolLayers[0];if(!y)continue;y.setElevationInfoOverride(r.elevationInfoOverride);const _=this._createTextSymbolGraphic(c,n,u,o,y);if(_==null)return!1;_._labelClass=d.labelClass,_._labelIndex=l,t.addLabelGraphic(_,r.stageLayer),t.deconflictionPriority=d.textRenderParameters?.definition.size??0,t.setVisibilityFlag($n.LABEL,wo.USER,a),t.setVisibilityFlag($n.LABEL,wo.SCALE_RANGE,!0),t.setVisibilityFlag($n.LABEL,wo.DECONFLICTION,!1),s=!0;const v=d.graphics3DCalloutSymbolLayer;if(v&&u.hasLabelVerticalOffset){v.setElevationInfoOverride(r.elevationInfoOverride);const w=this._createLineCalloutGraphic(n,g,v,u,o);w!=null&&(d.calloutSymbolLayerIndex=t.labelLayers.length,t.addLabelGraphic(w,r.stageLayer))}break}return r.scaleVisibility&&s&&r.scaleVisibility.updateGraphicLabelScaleVisibility(t),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const t=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelLayers){if(r._labelClass==null)continue;const i=t[r._labelIndex].graphics3DSymbol.symbolLayers[0];i?.onRemoveGraphic(r)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){if(e.textInitialized)return;const t=e.labelingContext,r=t.labelClassContexts;if(!r||r.length===0)return;const i=e.graphics3DGraphic.graphic;for(let s=0;s<r.length;s++){const n=r[s];if(e.textRenderers[s]=null,e.textLabelPlacements[s]=null,n?.textRenderParameters==null)continue;const o=n.labelFunction;let a;if(o.type==="arcade")try{const v=o.needsHydrationToEvaluate()?T7e(i,t.layer):i;a=o.evaluate(v)}catch{a=null}else a=o.evaluate(i);if(a==null||a===""||/^\s+$/.test(a))continue;const l=n.graphics3DSymbol,c=l.symbol?.type==="label-3d"?l.symbol:null;if(!l.symbolLayers[0])continue;const u=e.graphics3DGraphic,d=n.labelClass,p=t.disablePlacement,g=fQe({graphics3DGraphic:u,labelSymbol:c,labelClass:d,disablePlacement:p});if(g==null)continue;const y=Cee(g.anchor),_=T_e(y);e.textRenderers[s]=new w_e(a,_,n.textRenderParameters),e.textLabelPlacements[s]=g}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,t){const r=t.graphic.uid;if(e.graphics.set(r,t),e.active){const i=new Tte(e,t);this._labels.set(r,i),e.labelsToInitialize.set(r,i)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,t){const r=t.graphic.uid,i=this._labels.get(r);e.graphics.delete(r),i&&(this._destroyGraphic(i,r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,t){this._labels.has(t)&&(this._labels.delete(t),this._labelsToAdd.delete(t),this._labelsToRemove.delete(t)),e.textInitialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,t){if(!t)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of t){const i=e.graphics.get(r);i&&(this._removeGraphic(e,i),this._addGraphic(e,i))}}_globalPropertyChanged(e,t){for(const r of t.labelClassContexts){const i=new Map;t.graphics.forEach(n=>i.set(n.graphic.uid,n));const s=n=>n.labelLayers[0];if(r.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,i,s),r.graphics3DCalloutSymbolLayer){const n=o=>o.labelLayers[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,i,n)}}}_visibilityInfoChange(e){const t=CP(e.layer);t&&!e.active&&this._activateLabelingContext(e),!t&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((t,r)=>{const i=this._labels.get(r);i&&(this._destroyGraphic(i,r),i.visible=!1,i.rendered=!1,e.labelsToInitialize.set(r,i))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const t of this._labelingContexts)if(t.graphics3DCore===e)return t;return null}addGraphicsOwner(e,t,r){const i=r&&r.emptySymbolLabelSupported||!1,s=r&&r.elevationInfoOverride||null,n=r&&r.disablePlacement||null;if(this._findLabelingContext(e))return;const o=e.layer,a=new RQe(this.view._stage,o,e,t,i,s,n,CP(o));return this._labelingContexts.push(a),this.setDirty(),{addGraphic:l=>this._addGraphic(a,l),removeGraphic:l=>this._removeGraphic(a,l),featureReductionChange:()=>{},layerLabelsEnabled:()=>CP(a.layer),labelingInfoChange:l=>this._labelingInfoChange(a,l),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",a),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",a),visibilityInfoChange:()=>this._visibilityInfoChange(a),reset:()=>this._resetLabels(a),clear:()=>{}}}removeGraphicsOwner(e){const t=this._findLabelingContext(e);if(!t)return;const r=this._labelingContexts.indexOf(t);this._labelingContexts.splice(r,1),t.graphics.forEach(i=>this._removeGraphic(t,i)),t.destroy(),this.setDirty()}setLabelGraphicVisibility(e,t){const r=e.graphic.uid,i=this._labels.get(r);i&&i.visible!==t&&(t&&!i.rendered?(this._labelsToAdd.set(r,i),this._labelsToRemove.delete(r),i.textInitialized||i.labelingContext.labelsToInitialize.set(r,i)):!t&&i.rendered&&(this._labelsToRemove.set(r,i),this._labelsToAdd.delete(r)),i.visible=t,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some(e=>wU(e))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((t,r)=>t+(wU(r)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function wU(e){return!!e.labelClassPromise&&!!e.labelClassAbortController}function Ste(e){return e.labelClassContexts&&e.labelClassContexts.length}function PQe(e){return e.labelClassContexts===null}function CP(e){return e.labelsVisible===!0&&!!e.labelingInfo?.some(t=>!!t.symbol)}h([f({constructOnly:!0})],ev.prototype,"view",void 0),h([f({constructOnly:!0})],ev.prototype,"deconflictor",void 0),h([f()],ev.prototype,"_textTextureAtlas",void 0),h([f({type:Boolean,readOnly:!0})],ev.prototype,"updating",null),ev=h([F("esri.views.3d.layers.graphics.Labeler")],ev);const _h=new BGe(null,null,null);class Qh{constructor(t,r,i,s=null){this.lij=[0,0,0],this.extent=Nt(),this.resolution=0,this.loadPriority=0,this.measures={visibility:No.VISIBLE_ON_SURFACE,screenRect:Nt(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(t,r,i,s)}acquire(t,r,i,s){this.tilingScheme=s,this.id=Qh.id(t,r,i),this.lij[0]=t,this.lij[1]=r,this.lij[2]=i,s.getExtent(t,r,i,this.extent),this.resolution=s.resolutionAtLevel(t)}release(){this.tilingScheme=null}getChildren(t){const r=this.lij[0]+1,i=2*this.lij[1],s=2*this.lij[2];return t?(t[0].acquire(r,i,s,this.tilingScheme),t[1].acquire(r,i+1,s,this.tilingScheme),t[2].acquire(r,i,s+1,this.tilingScheme),t[3].acquire(r,i+1,s+1,this.tilingScheme),t):[new Qh(r,i,s,this.tilingScheme),new Qh(r,i+1,s,this.tilingScheme),new Qh(r,i,s+1,this.tilingScheme),new Qh(r,i+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(t){this.measures.visibility=t.measures.visibility,this.measures.shouldSplit=t.measures.shouldSplit,this.measures.distance=t.measures.distance,Im(t.measures.screenRect,this.measures.screenRect)}static id(t,r,i){return`${t}/${r}/${i}`}}var No;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",e[e.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(No||(No={}));const gve=.5*Math.PI,MQe=gve/Math.PI*180;class IQe{constructor(t){this._renderCoordsHelper=t.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:C(),direction:C()};for(let r=0;r<4;r++)this._extent[r]={origin:C(),direction:C(),cap:{next:null,direction:C()}},this._planes[r]=Sr();this._planes[ti.NEAR]=Sr(),this._planes[ti.FAR]=Sr(),this._planesWithoutFar=this._planes.slice(0,5)}update(t,r,i,s=!0){const n=this._extent;this._toRenderBoundingExtent(t,r,i),oe(this._center.origin,n[0].origin,n[2].origin),te(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),s||te(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,Hm(a.cap.direction,a.origin,l.origin),_A(a.direction,a.cap.direction,a.origin,this._planes[o]),s||te(a.direction,a.direction,-1)}_A(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[ti.NEAR]),s?jk(this._planes[ti.NEAR],this._planes[ti.FAR]):(AN(this._planes[ti.FAR],this._planes[ti.NEAR]),jk(this._planes[ti.NEAR],this._planes[ti.NEAR])),this._maxSpan=Math.max(Math.abs(t[0]-t[2]),Math.abs(t[1]-t[3])),this._maxSpanSpatialReference=r,this._minGlobalAltitude=.9*Mr(this._maxSpanSpatialReference).radius}isVisibleInFrustum(t,r,i=!1){if(t==null)return!1;if(this._renderCoordsHelper.viewingMode===Ie.Global){const n=this._maxSpanSpatialReference.isGeographic?MQe:gve*r;if(this._maxSpan>n)return!0;if(t.altitude!=null&&t.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(t)}if(this._maxSpan===0){const n=this._extent[0];return!(i||!t.intersectsRay(Fc(n.origin,n.direction)))}for(let n=0;n<this._extent.length;n++){const o=this._extent[n];if(!i&&t.intersectsRay(Fc(o.origin,o.direction))||t.intersectsLineSegment(Vv(o.origin,o.cap.next,LQe),o.cap.direction))return!0}const s=i?this._planes:this._planesWithoutFar;for(let n=0;n<t.lines.length;n++){const o=t.lines[n];if(s8e(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(t,r,i){B7(t,vh),vh[2]=i,Oc(r,vh,xU,this._renderCoordsHelper.spatialReference),Fn(Ete,xU),mi(al);for(const{x0:n,x1:o,y0:a,y1:l}of $Qe)for(let c=0;c<5;c++){const u=c/4;vh[0]=yt(t[n],t[o],u),vh[1]=yt(t[a],t[l],u),vh[2]=i,yn(vh,r,vh,this._renderCoordsHelper.spatialReference),Ue(vh,vh,Ete),Zp(al,vh)}se(this._extent[0].origin,al[0],al[1],al[2]),se(this._extent[1].origin,al[3],al[1],al[2]),se(this._extent[2].origin,al[3],al[4],al[2]),se(this._extent[3].origin,al[0],al[4],al[2]);for(let n=0;n<4;++n)Ue(this._extent[n].origin,this._extent[n].origin,xU)}_toRenderBoundingExtentLocal(t,r,i){k3(t,r,Ef,this._renderCoordsHelper.spatialReference),se(this._extent[0].origin,Ef[0],Ef[1],i),se(this._extent[1].origin,Ef[2],Ef[1],i),se(this._extent[2].origin,Ef[2],Ef[3],i),se(this._extent[3].origin,Ef[0],Ef[3],i)}_toRenderBoundingExtent(t,r,i){switch(this._renderCoordsHelper.viewingMode){case Ie.Global:this._toRenderBoundingExtentGlobal(t,r,i);break;case Ie.Local:this._toRenderBoundingExtentLocal(t,r,i);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(t){if(ri(t.planes[ti.NEAR],this._center.origin)<0&&de(this._center.direction,t.direction)<0)return!0;for(let r=0;r<4;r++){const i=this._extent[r];if(ri(t.planes[ti.NEAR],i.origin)<0&&de(i.direction,t.direction)<0)return!0}return!1}}const $Qe=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],vh=C(),xU=be(),Ete=be(),al=Qs(),Ef=Nt(),LQe=Sd();class DQe{constructor(t){this._renderCoordsHelper=t,this._surfaceElevation=0,this._cache=new Map,this._frustum=new M0(t),this._extendedFrustum=new M0(t),this._intersector=new IQe({renderCoordsHelper:t}),this._renderCoordsHelper=t}begin(t,r){this._surfaceElevation=r,this._aboveGround=this._renderCoordsHelper.getAltitude(t.eye)>r,this._frustum.update(t),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(t)}end(){this._cache.clear()}calculate(t){if(this._allTilesInvisible)return No.INVISIBLE;const r=this._renderCoordsHelper.viewingMode===Ie.Global&&t.lij[0]>=NQe&&t.lij[0]<FQe,i=this._getOrCalculateSingleTileVisibility(t,!r);return i!==No.INVISIBLE&&r?this._calculateAggregatedChildrenVisibility(t):i}_shortenFrustumFarPlane(t){const r=M0.nearFarLineIndices,i=t.mutablePoints;for(const s of r){const[n,o]=s,a=i[n],l=i[o];ce(Ql,l,a),te(Ql,Ql,kQe),oe(i[o],a,Ql)}t.updatePoints(i)}_calculateAggregatedChildrenVisibility(t){let r=No.INVISIBLE;const i=this._cache.get(t.id);if(i!=null)return i;const s=Rte.acquire();t.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==No.INVISIBLE&&(r=o,o===No.VISIBLE_ON_SURFACE))break}return Rte.release(s),this._cache.set(t.id,r),r}_getOrCalculateSingleTileVisibility(t,r){const i=this._cache.get(t.id);if(i!=null)return i;const s=this._calculateSingleTileVisibility(t);return r&&this._cache.set(t.id,s),s}_calculateSingleTileVisibility(t){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===Ie.Global&&t.lij[0]<UQe?this._calculateSingleTileVisibilitySided(t,!1)===No.INVISIBLE?this._calculateSingleTileVisibilitySided(t,!0):void 0:this._calculateSingleTileVisibilitySided(t,this._aboveGround)}_calculateSingleTileVisibilitySided(t,r){this._intersector.update(t.extent,t.tilingScheme.spatialReference,this._surfaceElevation,r);const i=Mr(t.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,i)?this._intersector.isVisibleInFrustum(this._frustum,i,!0)?No.VISIBLE_ON_SURFACE:No.VISIBLE_WHEN_EXTENDED:No.INVISIBLE}_updateExtendedFrustum(t){this._extendedFrustum.update(t),this._shortenFrustumFarPlane(this._extendedFrustum);const r=this._renderCoordsHelper.worldUpAtPosition(t.eye,Ql);this._aboveGround||Wo(r,r);const i=_n(-de(r,t.viewForward));if(this._allTilesInvisible=i>(Math.PI+t.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=i>t.fovY/2,!this._hasExtendedFrustum))return;const s=this._extendedFrustumParameters(),n=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this._renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,Ql),a){case We.FAR_BOTTOM_LEFT:case We.FAR_TOP_LEFT:case We.NEAR_BOTTOM_LEFT:case We.NEAR_TOP_LEFT:Hk(this._extendedFrustum.planes[ti.LEFT],Ql,Ql);break;case We.FAR_BOTTOM_RIGHT:case We.FAR_TOP_RIGHT:case We.NEAR_BOTTOM_RIGHT:case We.NEAR_TOP_RIGHT:Hk(this._extendedFrustum.planes[ti.RIGHT],Ql,Ql)}te(Ql,Ql,s.direction),this._renderCoordsHelper.intersectInfiniteManifold(Fc(l,Ql),s.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(n),ko(n[We.NEAR_BOTTOM_LEFT],n[We.NEAR_BOTTOM_RIGHT],n[We.NEAR_TOP_RIGHT],Ate),ko(n[We.NEAR_BOTTOM_RIGHT],n[We.NEAR_TOP_RIGHT],n[We.NEAR_TOP_LEFT],Ote),de(Ate,Ote)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[We.NEAR_BOTTOM_LEFT],o[We.NEAR_BOTTOM_RIGHT]]=[o[We.NEAR_BOTTOM_RIGHT],o[We.NEAR_BOTTOM_LEFT]]:[o[We.NEAR_TOP_LEFT],o[We.NEAR_TOP_RIGHT]]=[o[We.NEAR_TOP_RIGHT],o[We.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const t=this._surfaceElevation-Cte;return{zWithMargin:t,pointIndices:M0.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:r=>r>t}}_extendedFrustumParametersBelowSurface(){const t=this._surfaceElevation+Cte;return{zWithMargin:t,pointIndices:M0.planePointIndices.top,direction:1,needsAltitudeAdjustment:r=>r<t}}}const NQe=2,FQe=6,UQe=12,kQe=.95,Cte=1,Ql=C(),Ate=Sr(),Ote=Sr(),Rte=new fn(Array,e=>{e.length!==4&&(e[0]=new Qh,e[1]=new Qh,e[2]=new Qh,e[3]=new Qh)},e=>{e[0].release(),e[1].release(),e[2].release(),e[3].release()});class zQe{constructor(t){this._camera=new lt,this._focusOnMap=[0,0],this._screenRect=Nt(),this._tileSize=t.tileSize,this._renderCoordsHelper=t.renderCoordsHelper,this._tilingScheme=t.tilingScheme,this._visibility=new DQe(t.renderCoordsHelper)}begin(t,r,i){this._camera.copyFrom(t),this._surfaceElevation=i,this._focusOnMap[0]=r.x,this._focusOnMap[1]=r.y,k7(0,0,t.fullWidth,t.fullHeight,this._screenRect),this._visibility.begin(this._camera,i)}end(){this._visibility.end()}updateTile(t){t.measures.visibility=this._visibility.calculate(t),t.measures.distance=MRe(t.extent,this._focusOnMap),t.measures.visibility!==No.INVISIBLE&&this._updateScreenMeasure(t)}_updateScreenMeasure(t){const r=BQe,i=1<<r,s=t.measures.screenRect;qu(s);let n=0;const o=t.lij[0]+r,a=t.lij[1]<<r,l=t.lij[2]<<r,c=this._tileSizeWithBias(t),u=c*c;for(let d=0;d<i;d++)for(let p=0;p<i;p++)if(n+=this._computeScreenArea(t,o,a+d,l+p,s),n>u)return void(t.measures.shouldSplit=!0);t.measures.shouldSplit=!1}_tileSizeWithBias(t){return t.measures.visibility===No.VISIBLE_WHEN_EXTENDED?this._tileSize*VQe:this._tileSize}_computeScreenArea(t,r,i,s,n){const o=t.measures.visibility===No.VISIBLE_WHEN_EXTENDED;this._projectToScreen(r,i,s,o,Lg),qu(TU);for(let a=0;a<4;a++)z7(TU,Lg[a]);return ry(n,TU,n),eJ(Lg[0],Lg[1],Lg[2])+eJ(Lg[0],Lg[2],Lg[3])}_projectToScreen(t,r,i,s,n){this._tilingScheme.ensureMaxLod(t),this._tilingScheme.getExtent(t,r,i,ES),this._toRenderCoords(ES,0,3,Dg[0]),this._toRenderCoords(ES,2,3,Dg[1]),this._toRenderCoords(ES,2,1,Dg[2]),this._toRenderCoords(ES,0,1,Dg[3]),s&&(this._projectToPlane(Dg,this._camera.frustum[ti.NEAR]),this._projectToPlane(Dg,this._camera.frustum[ti.TOP]),this._projectToPlane(Dg,this._camera.frustum[ti.BOTTOM]));for(let o=0;o<4;o++)this._camera.projectToRenderScreen(Dg[o],Pte),this._camera.renderToScreen(Pte,n[o])}_projectToPlane(t,r){for(let s=0;s<4;s++)AS[s]=ri(r,t[s]);const i=Math.max(AS[0],AS[1],AS[2],AS[3]);if(i>0){const s=te(CS,r,-i);for(let n=0;n<4;n++)oe(t[n],t[n],s)}}_toRenderCoords(t,r,i,s){return CS[0]=t[r],CS[1]=t[i],CS[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(CS,this._tilingScheme.spatialReference,s),s}}const TU=Nt(),BQe=2,VQe=5,Lg=[zi(),zi(),zi(),zi()],ES=Nt(),CS=C(),Dg=[C(),C(),C(),C()],AS=[0,0,0,0],Pte=xo();function Gmt(e,t,r){if(e==null||r==null)return!1;let i=!0;return Vs[0]=e.xmin!=null?e.xmin:0,Vs[1]=e.ymin!=null?e.ymin:0,Vs[2]=e.zmin!=null?e.zmin:0,i=i&&ji(Vs,e.spatialReference,0,t,r,0,1),Vs[0]=e.xmax!=null?e.xmax:0,Vs[1]=e.ymax!=null?e.ymax:0,Vs[2]=e.zmax!=null?e.zmax:0,i=i&&ji(Vs,e.spatialReference,0,t,r,3,1),e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.zmin==null&&(t[2]=-1/0),e.xmax==null&&(t[3]=1/0),e.ymax==null&&(t[4]=1/0),e.zmax==null&&(t[5]=1/0),i}function yve(e,t,r){if(e==null||r==null)return!1;let i=!0;return Vs[0]=e.xmin!=null?e.xmin:0,Vs[1]=e.ymin!=null?e.ymin:0,Vs[2]=e.zmin!=null?e.zmin:0,i=i&&ji(Vs,e.spatialReference,0,Vs,r,0,1),t[0]=Vs[0],t[1]=Vs[1],Vs[0]=e.xmax!=null?e.xmax:0,Vs[1]=e.ymax!=null?e.ymax:0,Vs[2]=e.zmax!=null?e.zmax:0,i=i&&ji(Vs,e.spatialReference,0,Vs,r,0,1),t[2]=Vs[0],t[3]=Vs[1],e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.xmax==null&&(t[2]=1/0),e.ymax==null&&(t[3]=1/0),i}const Vs=C();let Jn=class extends xe{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void K.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const t=this._get("filterExtent");if(t===e||t!=null&&e&&t.equals(e))return;const r=e!=null?e.clone():null;this._set("filterExtent",r),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=Nt();return yve(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new Pt,this.tileSize=512,this._idToTile=new Map,this._handles=new gi,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new Mt}initialize(){this._handles.add([le(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),Vr),le(()=>[this.tileSize,this.cameraOnSurface?.location,this.tilingScheme,this.viewState?.contentCamera,this.focus?.location],()=>this._setDirty(),_s)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(at.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=xi(this._frameWorker),this._handles=Re(this._handles)}addClient(){const e=jQe();return this._clients.add(e),this._clients.size===1&&this._setDirty(),Xo(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(_a))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker!=null&&(this._frameWorker.priority=at.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||this._frameWorker==null||(this._frameWorker.priority=at.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new zQe({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(t=>new Qh(t[0],t[1],t[2],e))}_purgeHorizonTiles(e){e.sort((t,r)=>{const i=t.measures.screenRect,s=r.measures.screenRect;return i[1]+i[3]-(s[1]+s[3])}),qu(AP);for(let t=0;t<e.length;t++)if(ry(AP,e.data[t].measures.screenRect,AP),yd(AP)>HQe)return e.data.slice(t,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:t}=this;for(;this._pendingTiles.length>0&&!e.done;){const r=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!tN(this._filterExtentRect,r.extent)||(this._tileMeasurements.updateTile(r),r.measures.visibility!==No.INVISIBLE&&(r.measures.shouldSplit?(t.ensureMaxLod(r.lij[0]+1),this._pendingTiles.push(...r.getChildren())):this._newTiles.push(r)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const i of this.tiles.items)i.used=!1;const t=e.filter(i=>{const s=this._idToTile.get(i.id);return s?(s.copyMeasurementsFrom(i),s.used=!0):this._idToTile.set(i.id,i),!s}),r=this.tiles.items.filter(i=>!i.used&&(this._idToTile.delete(i.id),!0));this.tiles.removeMany(r),this.tiles.addMany(t),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,t)=>e.measures.visibility!==t.measures.visibility?e.measures.visibility===No.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-t.measures.distance),this.tiles.forEach((e,t)=>e.loadPriority=t)}};h([f({constructOnly:!0})],Jn.prototype,"scheduler",void 0),h([f({constructOnly:!0})],Jn.prototype,"renderCoordsHelper",void 0),h([f({constructOnly:!0})],Jn.prototype,"tilingSchemeOwner",void 0),h([f({constructOnly:!0})],Jn.prototype,"cameraOnSurface",void 0),h([f({constructOnly:!0})],Jn.prototype,"focus",void 0),h([f({constructOnly:!0})],Jn.prototype,"viewState",void 0),h([f({constructOnly:!0})],Jn.prototype,"terrain",void 0),h([f()],Jn.prototype,"tiles",void 0),h([f()],Jn.prototype,"tileSize",void 0),h([f({readOnly:!0})],Jn.prototype,"tilingScheme",null),h([f()],Jn.prototype,"filterExtent",null),h([f({readOnly:!0})],Jn.prototype,"_filterExtentRect",null),h([f({readOnly:!0})],Jn.prototype,"_rootTileIds",null),h([f({value:!1})],Jn.prototype,"suspended",null),h([f({readOnly:!0})],Jn.prototype,"updating",null),Jn=h([F("esri.views.3d.layers.support.FeatureTileTree3D")],Jn);let GQe=0;function jQe(){return GQe++}const AP=Nt(),HQe=10;let Wi=class extends xe{constructor(){super(...arguments),this._propertiesPool=new Um({camera:lt},this),this._lastSeenCameraProjectionValues=new lt,this.mode=Er.ANIMATING,this._cssCamera=new lt,this._camera=new lt,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new cs,this.viewingMode=Ie.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,t){this._set("viewingMode",e),this._set("spatialReference",t),this._set("constraints",new jf({mode:this.viewingMode}))}exit(){this.cameraController?.destroy(),this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new Um({camera:lt},this)}destroy(){this.cameraController?.destroy(),this.cameraController=null,this._propertiesPool?.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===Ie.Global){const e=Mr(this.spatialReference).radius;this.camera=new lt({eye:Ce(4*e,0,0),center:Ce(e,0,0),up:Ce(0,0,1)})}else this.camera=new lt({eye:Ce(0,0,100),center:Ce(0,0,0),up:Ce(0,1,0)})}get animation(){return this.cameraController instanceof GA&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get camera(){return this._camera}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:t,width:r,pixelRatio:i}=this.camera;return e.pixelRatio=1,e.height=Math.round(t/i),e.width=Math.round(r/i),e}set camera(e){e!==Zc&&Zc.copyFrom(e),Zc.computeUp(this.viewingMode),this.events.emit("before-camera-change",Zc);const t=this._camera;if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,Zc)&&(this._lastSeenCameraProjectionValues.copyFrom(Zc),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!t.equals(Zc)&&(this._camera=this._propertiesPool.get("camera").copyFrom(Zc),this._cameraChanged=!t.almostEquals(Zc),this._cameraChanged)){const r=boe(()=>{this._cameraChanged=!1,r.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===Er.IDLE}get updating(){return!this.alignPixelEnabled}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===Ie.Global}get isLocal(){return this.viewingMode===Ie.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(this.cameraController?.destroy(),e&&(this.removeHandles(Mte),this.addHandles(Dc(()=>e.state===Ui.Finished||e.state===Ui.Stopped,()=>{this._set("cameraController",null),this.updateCamera(t=>e.onControllerEnd(t))},{sync:!0,once:!0}),Mte),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Ui.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==Ui.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();Zc.copyFrom(this._get("camera")),e(Zc),this.camera=Zc,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,t){return e.fov!==t.fov||e.fullViewport[0]!==t.fullViewport[0]||e.fullViewport[1]!==t.fullViewport[1]||e.fullViewport[2]!==t.fullViewport[2]||e.fullViewport[3]!==t.fullViewport[3]||e.padding[Gt.TOP]!==t.padding[Gt.TOP]||e.padding[Gt.RIGHT]!==t.padding[Gt.RIGHT]||e.padding[Gt.BOTTOM]!==t.padding[Gt.BOTTOM]||e.padding[Gt.LEFT]!==t.padding[Gt.LEFT]}};h([f()],Wi.prototype,"mode",void 0),h([f({readOnly:!0,type:xT})],Wi.prototype,"animation",null),h([f({type:lt})],Wi.prototype,"camera",null),h([f({type:lt})],Wi.prototype,"cssCamera",null),h([f()],Wi.prototype,"_cssCamera",void 0),h([f()],Wi.prototype,"_camera",void 0),h([f({readOnly:!0})],Wi.prototype,"pixelRatio",null),h([f()],Wi.prototype,"rasterPixelRatio",void 0),h([f()],Wi.prototype,"contentPixelRatio",void 0),h([f({readOnly:!0})],Wi.prototype,"alignPixelEnabled",null),h([f({readOnly:!0})],Wi.prototype,"updating",null),h([f({})],Wi.prototype,"_contentCamera",void 0),h([f({type:lt})],Wi.prototype,"contentCamera",null),h([f({readOnly:!0})],Wi.prototype,"fixedContentCamera",null),h([f({readOnly:!0})],Wi.prototype,"constraints",void 0),h([f({readOnly:!0})],Wi.prototype,"events",void 0),h([f({readOnly:!0})],Wi.prototype,"isGlobal",null),h([f({readOnly:!0})],Wi.prototype,"isLocal",null),h([f({readOnly:!0})],Wi.prototype,"viewingMode",void 0),h([f({readOnly:!0})],Wi.prototype,"spatialReference",void 0),h([f()],Wi.prototype,"navigating",null),h([f()],Wi.prototype,"stationary",null),h([f()],Wi.prototype,"_cameraChanged",void 0),h([f()],Wi.prototype,"cameraController",null),Wi=h([F("esri.views.3d.state.ViewState")],Wi);const WQe=Wi,Zc=new lt,Mte="ViewStateHandles";class qQe{constructor(t,r,i){this.viewingMode=t,this._forEachLayer=r,this._view=i,this._externalIntersectionHandlers=new Mt,this._tolerance=FT,this._tmpRay=Dn(),this._tmpRegion=Nt(),this._validateHUDIntersector=eh(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(t,r,i){return this.intersectRay(this._getPickRay(t,this._tmpRay),Ite(this.viewingMode),r,i)}intersectScreenFreePointFallback(t,r,i){return this.intersectRayFreePointFallback(this._getPickRay(t,this._tmpRay),r,i)}intersectRayFreePointFallback(t,r,i){return this.intersectRay(t,Ite(this.viewingMode),r,i)||this._intersectRayFreePointLocal(t,r)}intersectRay(t,r,i,s){return r.options.selectionMode=!1,r.options.store=so.MIN,this.computeIntersection(t,r,s),!!r.results.min&&r.results.min.getIntersectionPoint(i)}getCenterRayWithSubpixelOffset(t,r,i=.5,s=.5){return t.getRenderCenter(PP,i,s),PP[0]+=.0466,PP[1]-=.0123,qj(t,PP,r)}intersectIntersectorScreen(t,r,i){this.computeIntersection(this._getPickRay(t,this._tmpRay),r,i)}intersectToolIntersectorScreen(t,r,i){const s=this._getPickRay(t,this._tmpRay);this.intersectToolIntersectorRay(s,r,i)}intersectToolIntersectorRay(t,r,i){r.options.selectionMode=!0,this.computeIntersection(t,r,i);const s=r.results.min;!!this._view.basemapTerrain&&this._view.basemapTerrain.opaque||Cd(s)&&s.intersector!==Ii.TERRAIN||(r.options.selectionMode=!1,this.computeIntersection(t,r,i))}setTolerance(t=FT){this._tolerance=t}addIntersectionHandler(t){this._externalIntersectionHandlers.push(t),this._externalIntersectionHandlers.sort((r,i)=>r.type===Ii.TERRAIN?1:i.type===Ii.TERRAIN?-1:0)}removeIntersectionHandler(t){this._externalIntersectionHandlers.removeUnordered(t)!=null&&this._externalIntersectionHandlers.sort((r,i)=>r.type===Ii.TERRAIN?1:i.type===Ii.TERRAIN?-1:0)}_getPickRay(t,r){const i=this._view.state.camera;return hme(i,t,r)}_intersectRayFreePointLocal(t,r){return this.viewingMode!==Ie.Local||t==null||oe(r,t.origin,pe(Le.get(),t.direction)),!1}intersectElevationFromScreen(t,r,i=0,s=null){return this._intersectElevation(this._getPickRay(t,this._tmpRay),r,i,s)}_intersectElevation(t,r,i=0,s=null){if(t==null)return null;const n=r!=null?r.mode:"absolute-height",o=r?.offset??0,a=n!=="on-the-ground"?o+i:0,l=a/this._view.renderCoordsHelper.unitInMeters;if(n==="absolute-height"){if(this._view.renderCoordsHelper.intersectInfiniteManifold(t,a,RP)){const T=this._view.computeMapPointFromVec3d(RP);return T.z??(T.z=0),T.z-=o,T}return null}const c=this._view.state.camera,u=Le.get();c.projectToRenderScreen(t.origin,u);const d=new $te(null,this._forEachLayer),p=this._view.slicePlane,g=p!=null?jJ(p):null,y=eh(this.viewingMode);y.options.store=so.MIN,y.options.verticalOffset=l;const _=t.origin,v=oe(Le.get(),_,t.direction);y.reset(_,v,c),y.point=u;const w=s?"type"in s&&s.type==="graphics"?T=>T.layerUid!==s.uid:T=>T.graphicUid!==s.uid:null;switch(n){case"relative-to-scene":{const T=x=>(!w||w(x))&&!!x.lastValidElevationBB;y.intersect(d.layers,u,this._tolerance,null,T),this._externalIntersectionHandlers.forAll(x=>{if(x.type===Ii.I3S||x.type===Ii.TERRAIN){const S=x.slicePlaneEnabled?g:null;x.intersect(y,S,y.rayBegin,y.rayEnd,u)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(T=>{if(T.isGround){const x=T.slicePlaneEnabled?g:null;T.intersect(y,x,y.rayBegin,y.rayEnd,u)}})}if(y.results.min.getIntersectionPoint(RP)){const T=this._view.computeMapPointFromVec3d(RP);return T.z=i,T}return null}computeIntersection(t,r,i){if(t==null)return;const s=this._view.state.camera,n=Le.get();s.projectToRenderScreen(t.origin,n);const o=new $te(i,this._forEachLayer);r.options.selectOpaqueTerrainOnly=!i||!("include"in i||"exclude"in i);const a=t.origin,l=oe(Le.get(),t.origin,t.direction);r.reset(a,l,s),r.intersect(o.layers,n,this._tolerance);const c=this._view.slicePlane,u=c!=null?jJ(c):null;r.intersect(o.sliceableLayers,n,this._tolerance,u);const d=i&&(i.requiresGroundFeedback||i.enableDraped);this._externalIntersectionHandlers.forAll(y=>{const _=y.layerUid,v=Array.isArray(_),w=v?_:[_];v&&(r.options.filteredLayerUids=[]);let T=!1;for(const x of w)o.filterLayerUid(x)?T=!0:v&&r.options.filteredLayerUids.push(x);if(r.options.isFiltered=!T,y.isGround&&d||!r.options.isFiltered){const x=y.slicePlaneEnabled?u:null;y.intersect(r,x,a,l,n)}});const p=Le.get(),g=this._view.basemapTerrain;if(i&&i.enableDraped&&g.spatialReference!=null&&r.results.ground.getIntersectionPoint(p)){const y=g.overlayManager.renderer,_=this._view.renderCoordsHelper.spatialReference,v=Le.get();this._view.renderCoordsHelper.fromRenderCoords(p,v,g.spatialReference),v[2]=this._view.elevationProvider?.getElevation(p[0],p[1],p[2],_,"ground")??0,y.intersect(r,v,r.results.ground,w=>o.filterRenderGeometry(w))}r.sortResults(),this._processHUDResults(r)}_processHUDResults(t){const r=t.results.hud;Im(this._tmpRegion,h9);const i=this._view.state.camera,s=[],n=this._tmpRegion,o=w=>{const T=new ZQe(w);i.projectToRenderScreen(w.target.center,T.screenPoint),T.screenPoint[0]=Math.floor(T.screenPoint[0]),T.screenPoint[1]=Math.floor(T.screenPoint[1]),s.push(T),z7(n,T.screenPoint)};t.sortResults(r.all),r.min.dist!=null&&o(r.min);for(const w of r.all)r.min.target.object!==w.target.object&&r.max.target.object!==w.target.object&&o(w);if(r.max.dist!=null&&r.max.target.object!==r.min.target.object&&o(r.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=i.fullWidth,l=i.fullHeight,c=Math.max(0,n[0]-BE),u=Math.max(0,n[1]-BE),d=Math.min(bc(n)+2*BE,a-c),p=Math.min(yd(n)+2*BE,l-u),g=new Uint8Array(d*p*4);this._view._stage.renderer.readHUDVisibility(c,u,d,p,g);let y=!0;const _=t.results.max.dist==null;let v=0;for(const w of s)for(const T of XQe)if(g[4*(Math.min(w.screenPoint[0]+T[0],a)-n[0]+(Math.min(w.screenPoint[1]+T[1],l)-n[1])*d)]){y&&(t.results.min.copy(w.result),y=!1),_&&t.results.max.copy(w.result),t.options.store===so.ALL&&t.results.all.splice(v++,0,w.result);break}}}const BE=1,XQe=(()=>{const e=[],t=BE;for(let r=-t;r<=t;r++)for(let i=-t;i<=t;i++)e.push([i+t,r+t]);return e})();class ZQe{constructor(t){this.result=t,this.screenPoint=xo()}}let OP;function Ite(e){return OP&&OP.viewingMode===e||(OP=eh(e)),OP}class $te{constructor(t,r){this.layers=new Array,this.sliceableLayers=new Array,this.include=t?.include,this.exclude=t?.exclude,r(i=>{i.pickable&&this.filterLayerUid(i.apiLayerUid)&&(i.sliceable?this.sliceableLayers:this.layers).push(i)})}filterLayerUid(t){const{include:r,exclude:i}=this;return t==null?r==null&&i==null:(r==null||r.has(t))&&(i==null||!i.has(t))}filterRenderGeometry(t){return this.filterLayerUid(t.layerUid)}}function Lte(e){return typeof e=="object"&&"intersect"in e}const RP=C(),PP=xo();class jmt{constructor(t,r){this.spatialReference=t,this._view=r}getElevation(t,r,i){return this._view.elevationProvider.getElevation(t,r,0,this.spatialReference,i)}async queryElevation(t,r,i,s,n){return this._view.elevationProvider.queryElevation(t,r,0,this.spatialReference,n,i,s)}}class YQe{constructor(t,r,i,s){this.spatialReference=r,this._getElevationQueryProvider=i,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=t.registerTask(at.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(t,r,i,s=0){const n=Ys(),o={x:t,y:r,minDemResolution:s,result:n,signal:i};return this._queries.push(o),Ws(i,()=>{LV(this._queries,o),n.reject(Cr())}),n.promise}get running(){return this._queries.length>0}runTask(t){const r=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return r.forEach(u=>u.result.reject()),void t.madeProgress();const s=r.map(u=>[u.x,u.y]),n=r.reduce((u,d)=>Math.min(u,d.minDemResolution),1/0),o=new I3({points:s,spatialReference:this.spatialReference}),a=r.length>1&&r.some(u=>!!u.signal)?new AbortController:null,l=a!=null?a.signal:r[0].signal;if(a!=null){let u=0;r.forEach(d=>Ws(d.signal,()=>{u++,d.result.reject(Cr()),u===r.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:n,signal:l};i.queryElevation(o,c).then(u=>{r.forEach((d,p)=>{d.signal!=null&&d.signal.aborted?d.result.reject(Cr()):d.result.resolve(u.geometry.points[p][2])})}).catch(u=>{r.forEach(d=>d.result.reject(u))}),t.madeProgress()}get test(){const t=this;return{update:()=>t._queries.length>0&&t.runTask(_a)}}}let VE=class extends cs.EventedMixin(xe){get spatialReference(){return this.view?.basemapTerrain?.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this._handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=Re(this._elevationQueryCached)}get _elevationQuery(){return this._elevationQueryCached==null&&(this._elevationQueryCached=new YQe(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQueryCached}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,t,r,i,s){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const o=this.lastElevationQuery;if(e===o.x&&t===o.y&&r===o.z&&kn(i,o.spatialReference)&&s===o.queryContext)return o.result}let n=null;return n=MP(n,this._im,e,t,r,i,s),n==null&&(n=MP(n,this._ground,e,t,r,i,s)),s==="scene"&&(n=MP(n,this._scene,e,t,r,i,s)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:t,z:r,spatialReference:i,queryContext:s,result:n}),n}getSphereElevationBounds(e,t){let r=1/0,i=-1/0;for(const s of[this._im,this._ground,this._scene])s.forEach(n=>{if(n.getSphereElevationBounds){const o=n.getSphereElevationBounds(e,t);o!=null&&(r=Math.min(r,o.min),i=Math.max(i,o.max))}});return{min:r,max:i}}queryElevation(e,t,r,i,s,n=null,o=0){const a=Ys();return this._elevationQuery.queryElevation(e,t,n,o).then(l=>{s==="scene"&&(l=MP(l,this._scene,e,t,r,i,s)),a.resolve(l)}).catch(l=>{$s(l)?a.reject(l):a.resolve(this.getElevation(e,t,r,i,s))}),a.promise}register(e,t){this._handles.set(t,t.on("elevation-change",r=>this.emit("elevation-change",r))),this._providersFromContext(e).push(t)}unregister(e){this._handles.has(e)&&(this._handles.get(e)?.remove(),this._handles.delete(e));for(const t of[this._im,this._ground,this._scene]){const r=t.indexOf(e);r>-1&&t.splice(r,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}};function MP(e,t,r,i,s,n,o){for(const a of t){const l=a.getElevation(r,i,s,n,o);l!=null&&(e=e!=null?Math.max(l,e):l)}return e}h([f({constructOnly:!0})],VE.prototype,"view",void 0),h([f()],VE.prototype,"spatialReference",null),VE=h([F("esri.views.3d.support.CombinedElevationProvider")],VE);class K0{static isValidProfile(t){return t in K0.profiles}static getDefaultProfile(){return ne("esri-iPhone")?"low":"medium"}static apply(t,r){const i=K0.profiles[t];r.graphics3D.maxTotalNumberOfFeatures=i.graphics3D.maxTotalNumberOfFeatures,r.graphics3D.maxTotalNumberOfPrimitives=i.graphics3D.maxTotalNumberOfPrimitives,r.graphics3D.polygonLodFactor=i.graphics3D.polygonLodFactor,r.graphics3D.polylineLodFactor=i.graphics3D.polylineLodFactor,r.graphics3D.snapshotAvailable=i.graphics3D.snapshotAvailable,r.graphics3D.skipHighSymbolLods=i.graphics3D.skipHighSymbolLods;const s=r.sceneService.object,n=i.sceneService.object;s.lodFactor=n.lodFactor,s.lodCrossfadeinDuration=n.lodCrossfadeinDuration,s.lodCrossfadeoutDuration=n.lodCrossfadeoutDuration,s.lodCrossfadeUncoveredDuration=n.lodCrossfadeUncoveredDuration,r.sceneService.point.lodFactor=i.sceneService.point.lodFactor,r.sceneService.integratedMesh.lodFactor=i.sceneService.integratedMesh.lodFactor,r.sceneService.pointCloud.lodFactor=i.sceneService.pointCloud.lodFactor,r.sceneService.uncompressedTextureDownsamplingEnabled=i.sceneService.uncompressedTextureDownsamplingEnabled,r.tiledSurface.lodBias=i.tiledSurface.lodBias,r.tiledSurface.angledSplitBias=i.tiledSurface.angledSplitBias,r.tiledSurface.reduceTileLevelDifferences=i.tiledSurface.reduceTileLevelDifferences,r.tiledSurface.textureFadeDuration=i.tiledSurface.textureFadeDuration,r.heatmap.pixelRatio=i.heatmap.pixelRatio,r.heatmap.maxTotalNumberOfFeatures=i.heatmap.maxTotalNumberOfFeatures,r.fadeDuration=i.fadeDuration,r.antialiasingEnabled=i.antialiasingEnabled,r.physicallyBasedRenderingEnabled=i.physicalBasedRenderingEnabled,r.highQualityTransparency=i.highQualityTransparency,r.highResolutionAtmosphere=i.highResolutionAtmosphere,r.reflections=i.reflections,r.ambientOcclusion=i.ambientOcclusion,r.memoryLimit=i.memoryLimit,r.additionalCacheMemory=i.additionalCacheMemory,r.frameRate=i.frameRate,r.maximumPixelRatio=i.maximumPixelRatio}}function Dte(){const e=!!ne("esri-mobile"),t=!!ne("ios"),r=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?.8:1,polylineLodFactor:e?1.2:1.5,snapshotAvailable:!t,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:e},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!ne("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:e?600:750,additionalCacheMemory:e?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?1.2:2,polylineLodFactor:e?1.2:2,snapshotAvailable:!t,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!ne("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:e?900:1500,additionalCacheMemory:e?-150:0,frameRate:0,maximumPixelRatio:e?1:1/0}}}K0.test={reset(){const e=Dte();for(const t of Object.keys(e))K0.profiles[t]=e[t]}},function(e){e.profiles=Dte()}(K0||(K0={}));const SI=K0;function _ve(){return new Float32Array(4)}function JQe(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function rf(e,t,r,i){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s}function KQe(e,t){return new Float32Array(e,t,4)}function vve(){return _ve()}function bve(){return rf(1,1,1,1)}function wve(){return rf(1,0,0,0)}function xve(){return rf(0,1,0,0)}function Tve(){return rf(0,0,1,0)}function Sve(){return rf(0,0,0,1)}const QQe=vve(),eet=bve(),tet=wve(),ret=xve(),iet=Tve(),set=Sve();Object.freeze(Object.defineProperty({__proto__:null,ONES:eet,UNIT_W:set,UNIT_X:tet,UNIT_Y:ret,UNIT_Z:iet,ZEROS:QQe,clone:JQe,create:_ve,createView:KQe,fromValues:rf,ones:bve,unitW:Sve,unitX:wve,unitY:xve,unitZ:Tve,zeros:vve},Symbol.toStringTag,{value:"Module"}));const Nte=new ot([0,255,255]),Fte=new ot([0,0,0]),Ute=1,kte=.25,zte=.4,Bte=.2;let hp=class extends xe{constructor(){super(...arguments),this.color=Nte.clone(),this.haloColor=null,this.haloOpacity=Ute,this.fillOpacity=kte,this.shadowOpacity=zte,this.shadowColor=Fte.clone(),this.shadowDifference=Bte}static toEngineOptions(e){const t=ot.toUnitRGBA(e.color??Nte),r=e.haloColor!=null?ot.toUnitRGBA(e.haloColor):t,i=ot.toUnitRGBA(e.shadowColor??Fte),s=e.haloOpacity??Ute,n=e.fillOpacity??kte,o=e.shadowOpacity??zte,a=e.shadowDifference??Bte;return{color:rf(t[0],t[1],t[2],t[3]),haloColor:rf(r[0],r[1],r[2],r[3]),haloOpacity:s,haloOpacityOccluded:.25*s,fillOpacity:n,fillOpacityOccluded:.25*n,shadowOpacity:o,shadowColor:At(i[0],i[1],i[2],i[3]),occludedShadowOpacity:o*(1-a)}}};h([f({type:ot})],hp.prototype,"color",void 0),h([f({type:ot})],hp.prototype,"haloColor",void 0),h([f()],hp.prototype,"haloOpacity",void 0),h([f()],hp.prototype,"fillOpacity",void 0),h([f()],hp.prototype,"shadowOpacity",void 0),h([f({type:ot})],hp.prototype,"shadowColor",void 0),h([f()],hp.prototype,"shadowDifference",void 0),hp=h([F("esri.views.3d.support.HighlightOptions")],hp);const TB=hp;function net(e,t){return t?{...t,query:{...e??{},...t.query}}:{query:e}}function oet(e){return typeof e=="string"?Us(e):ye(e)}function aet(e,t,r){const i={};for(const s in e){if(s==="declaredClass")continue;const n=e[s];if(n!=null&&typeof n!="function")if(Array.isArray(n)){i[s]=[];for(let o=0;o<n.length;o++)i[s][o]=aet(n[o])}else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(r&&r[s]);i[s]=t?o:JSON.stringify(o)}else i[s]=t?n:JSON.stringify(n);else i[s]=n}return i}function Hmt(e){return{geometryType:Z7(e[0]),geometries:e.map(t=>t.toJSON())}}function cet(e,t,r){const i=HRe(t);return e.map(s=>{const n=i.fromJSON(s);return n.spatialReference=r,n})}let tv=class extends Pe{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(i=>i.toJSON()),t=this.geometries[0],r={};return r.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),r.inSR=t.spatialReference.wkid||JSON.stringify(t.spatialReference.toJSON()),r.geometries=JSON.stringify({geometryType:Z7(t),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(r.transformForward=this.transformForward),r}};h([f()],tv.prototype,"geometries",void 0),h([f({json:{read:{source:"outSR"}}})],tv.prototype,"outSpatialReference",void 0),h([f()],tv.prototype,"transformation",void 0),h([f()],tv.prototype,"transformForward",void 0),tv=h([F("esri.rest.support.ProjectParameters")],tv);const SW=tv,uet=ro(SW);async function Eve(e,t,r){t=uet(t);const i=oet(e),s={...i.query,f:"json",...t.toJSON()},n=t.outSpatialReference,o=Z7(t.geometries[0]),a=net(s,r);return ii(i.path+"/project",a).then(({data:{geometries:l}})=>cet(l,o,n))}async function EW(e=null,t){if(Or.geometryServiceUrl)return Or.geometryServiceUrl;if(!e)throw new G("internal:geometry-service-url-not-configured");let r;r="portal"in e?e.portal||ba.getDefault():e,await r.load({signal:t});const i=r.helperServices?.geometry?.url;if(!i)throw new G("internal:geometry-service-url-not-configured");return i}async function het(e,t,r=null,i){const s=await EW(r,i),n=new SW;n.geometries=[e],n.outSpatialReference=t;const o=await Eve(s,n,{signal:i});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new G("internal:geometry-service-projection-failed")}var det=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:EW,projectGeometry:het},Symbol.toStringTag,{value:"Module"}));class pet{constructor(t,r){this.spatialReference=r,this.unitInMeters=Sa(this.spatialReference,Mr(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=EW(t&&t.get("portalItem")).catch(()=>{throw new G("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(t){const r=await this._geometryServiceURLPromise;let i,s=!0;Array.isArray(t[0])&&typeof t[0]!="number"?i=t:(i=[t],s=!1);const n=i.map(l=>l instanceof ut?l:new ut(l,this.spatialReference)),o=new SW({geometries:n,outSpatialReference:st.WGS84}),a=(await Eve(r,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return s?a:a[0]}}let Bh=class extends xe{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1}};h([f()],Bh.prototype,"minTotalNumberOfFeatures",void 0),h([f()],Bh.prototype,"maxTotalNumberOfFeatures",void 0),h([f()],Bh.prototype,"maxTotalNumberOfPrimitives",void 0),h([f()],Bh.prototype,"snapshotAvailable",void 0),h([f()],Bh.prototype,"polygonLodFactor",void 0),h([f()],Bh.prototype,"polylineLodFactor",void 0),h([f()],Bh.prototype,"skipHighSymbolLods",void 0),Bh=h([F("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Bh);let jp=class extends xe{constructor(){super(...arguments),this.lodFactor=1}};h([f()],jp.prototype,"lodFactor",void 0),jp=h([F("esri.views.3d.support.QualitySettings.LoDFactorSettings")],jp);let sD=class extends jp{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};sD=h([F("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],sD);let rm=class extends xe{constructor(){super(...arguments),this.object=new sD,this.point=new jp,this.integratedMesh=new jp,this.pointCloud=new jp,this.uncompressedTextureDownsamplingEnabled=!1}};h([f({type:sD})],rm.prototype,"object",void 0),h([f({type:jp})],rm.prototype,"point",void 0),h([f({type:jp})],rm.prototype,"integratedMesh",void 0),h([f({type:jp})],rm.prototype,"pointCloud",void 0),h([f()],rm.prototype,"uncompressedTextureDownsamplingEnabled",void 0),rm=h([F("esri.views.3d.support.QualitySettings.SceneServiceSettings")],rm);let S0=class extends xe{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=400}};h([f()],S0.prototype,"lodBias",void 0),h([f()],S0.prototype,"angledSplitBias",void 0),h([f()],S0.prototype,"reduceTileLevelDifferences",void 0),h([f()],S0.prototype,"textureFadeDuration",void 0),S0=h([F("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],S0);let yx=class extends xe{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};h([f()],yx.prototype,"pixelRatio",void 0),h([f()],yx.prototype,"maxTotalNumberOfFeatures",void 0),yx=h([F("esri.views.3d.support.QualitySettings.HeatmapSettings")],yx);let po=class extends xe{constructor(){super(...arguments),this.graphics3D=new Bh,this.sceneService=new rm,this.tiledSurface=new S0,this.heatmap=new yx,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};h([f({type:Bh})],po.prototype,"graphics3D",void 0),h([f({type:rm})],po.prototype,"sceneService",void 0),h([f({type:S0})],po.prototype,"tiledSurface",void 0),h([f({type:yx})],po.prototype,"heatmap",void 0),h([f()],po.prototype,"fadeDuration",void 0),h([f()],po.prototype,"antialiasingEnabled",void 0),h([f()],po.prototype,"physicallyBasedRenderingEnabled",void 0),h([f()],po.prototype,"highQualityTransparency",void 0),h([f()],po.prototype,"highResolutionAtmosphere",void 0),h([f()],po.prototype,"reflections",void 0),h([f()],po.prototype,"ambientOcclusion",void 0),h([f()],po.prototype,"memoryLimit",void 0),h([f()],po.prototype,"additionalCacheMemory",void 0),h([f()],po.prototype,"frameRate",void 0),h([f()],po.prototype,"maximumPixelRatio",void 0),po=h([F("esri.views.3d.support.QualitySettings.QualitySettings")],po);const Vte=po;function fet(e){return t2(e)&&e.length>=3}function met(e){return(r2(e)||Array.isArray(e))&&e.length>=3}function get(e){return fet(e)||met(e)}class nD{constructor(t,r,i,s){this.viewingMode=t,this.spatialReference=r,this.unitInMeters=i,this._coordinateSystem=s,this._tmpCoordinateSystem=TLe(s)}set extent(t){t&&SLe(this._coordinateSystem,t,this._coordinateSystem)}getAltitude(t){return ILe(this._coordinateSystem,t)}setAltitude(t,r,i=t){return tpe(this._coordinateSystem,i,r,t)}setAltitudeOfTransformation(t,r){$Le(this._coordinateSystem,r,t,r)}worldUpAtPosition(t,r){return OLe(this._coordinateSystem,t,r)}worldBasisAtPosition(t,r,i){return RLe(this._coordinateSystem,t,r,i)}basisMatrixAtPosition(t,r){const i=this.worldBasisAtPosition(t,Ll.X,Le.get()),s=this.worldBasisAtPosition(t,Ll.Y,Le.get()),n=this.worldBasisAtPosition(t,Ll.Z,Le.get());return uf(r,i[0],i[1],i[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),r}headingAtPosition(t,r){const i=this.worldUpAtPosition(t,Le.get()),s=this.worldBasisAtPosition(t,Ll.Y,Le.get()),n=Pde(r,s,i);return xa(n)}intersectManifoldClosestSilhouette(t,r,i){return gF(this._coordinateSystem,r,this._tmpCoordinateSystem),MLe(this._tmpCoordinateSystem,t,i),i}intersectManifold(t,r,i){gF(this._coordinateSystem,r,this._tmpCoordinateSystem);const s=Le.get();return PLe(this._tmpCoordinateSystem,t,s)?re(i,s):null}intersectInfiniteManifold(t,r,i){if(this.viewingMode===Ie.Global)return this.intersectManifold(t,r,i);gF(this._coordinateSystem,r,this._tmpCoordinateSystem);const s=this._tmpCoordinateSystem.value,n=Le.get();return ib(s.plane,t,n)?re(i,n):null}toRenderCoords(t,r,i){return IL(t)?no(t,r,this.spatialReference):yn(t,r,i,this.spatialReference)}fromRenderCoords(t,r,i=null){return IL(r)?(i!=null&&(r.spatialReference=i),SG(t,this.spatialReference,r)):get(r)?yn(t,this.spatialReference,r,i)?r:null:Nm(t,this.spatialReference,r)}static create(t,r){switch(t){case Ie.Local:return new nD(Ie.Local,r,Sa(r),ALe());case Ie.Global:return new nD(Ie.Global,r,1,CLe(r))}}static renderUnitScaleFactor(t,r){return YX(t)/YX(r)}}var Pp;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.BASEMAP=1]="BASEMAP",e[e.I3S_INDEX=2]="I3S_INDEX",e[e.I3S_DATA=3]="I3S_DATA",e[e.SYMBOLOGY=4]="SYMBOLOGY"})(Pp||(Pp={}));const yet=(()=>{const e=new Array;return e[Pp.ELEVATION]=10,e[Pp.BASEMAP]=10,e[Pp.I3S_INDEX]=10,e[Pp.I3S_DATA]=10,e[Pp.SYMBOLOGY]=5,e})(),_et=30;function Cve(e){return"usedMemory"in e&&"unloadedMemory"in e&&"ignoresMemoryFactor"in e}function vet(e){return new Fa({view:e})}const IP=1,SU=1,bet=.75,wet=.6,Gte=1.3;let Fa=class extends xe{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new Zye,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(IP),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}newCache(e,t){return new aWe(e,this._cacheStorage,t)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<wet&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(IP);else if(e)(this._memoryPredicted>1.1*SU||this._usedMemory>SU)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/Gte),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._usedMemory>SU)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/Gte),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._usedMemory<bet&&this._quality<IP){this._stableQuality=this._quality;const t=.05;e=this._updateQuality(this._quality+t)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),IP))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){if(!this.view)return;let e=0;this.view.basemapTerrain&&(e+=this.view.basemapTerrain.usedMemory);const t=this.view?._stage&&this.view._stage.renderView&&this.view._stage.renderer?.edgeView;t!=null&&(e+=t.usedMemory);let r=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(o=>{if(Cve(o)){const a=o.ignoresMemoryFactor?this._quality:1;e+=o.usedMemory*a,r+=o.unloadedMemory*a}});const i=this._warnMemoryUsage==null||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),s=1048576*this.maxMemory;if(e>s&&i){this._warnMemoryUsage=e;const o=l=>(l/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",a=Math.round(100*this._quality);K.getLogger(this).warn(`Memory Limit exceeded! Limit: ${o(s)} Current: ${o(e)} Projected: ${o(e+r)} Quality: ${a}%`)}this._usedMemory=e/s,this._memoryPredicted=(e+r)/s;const n=s-e;this._cacheStorage.maxSize=Math.max(0,n+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const t=e._numQualityChanges;return e._numQualityChanges=0,t}}}};h([f({constructOnly:!0})],Fa.prototype,"view",void 0),h([f()],Fa.prototype,"maxMemory",null),h([f()],Fa.prototype,"additionalCacheMemory",null),h([f()],Fa.prototype,"memoryFactor",null),h([f()],Fa.prototype,"updating",null),h([f()],Fa.prototype,"usedMemory",null),h([f()],Fa.prototype,"_quality",void 0),h([f()],Fa.prototype,"_usedMemory",void 0),h([f()],Fa.prototype,"_updating",void 0),h([f()],Fa.prototype,"_stableQuality",void 0),h([f()],Fa.prototype,"_maxMemory",void 0),h([f()],Fa.prototype,"_additionalCacheMemory",void 0),Fa=h([F("esri.views.3d.support.MemoryController")],Fa);class xet{constructor(t){this.client=t,this._cancelled=!1,this.size=0,this.duration=0}}class Tet{constructor(t){this.typeWorkerQuota=t,this.tasks=new Array,this.numWorkers=0,this.statistics=new Eet}}class Eet{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}}class Cet{constructor(t,r,i,s){this._workerFunc=t,this._callbackFunc=r,this._maxTotalNumWorkers=i,this._totalNumWorkers=0,this._clients=s.map(n=>new Tet(n))}destroy(){this._clients.length=0}hasQuota(t){const r=this._clients[t];return!!r&&(this._totalNumWorkers<this._maxTotalNumWorkers||r.numWorkers+r.tasks.length<r.typeWorkerQuota)}push(t){const r=this._clients[t.client];r&&(this._totalNumWorkers<this._maxTotalNumWorkers?(r.numWorkers++,this._totalNumWorkers++,this._workerFunc(t,(i,s)=>this._taskCallback(i,s))):r.tasks.push(t))}cancel(t){this._taskFinished(t),t._cancelled=!0}_taskFinished(t){const r=this._clients[t.client];this._totalNumWorkers--,r&&(r.numWorkers--,r.statistics.requests++,r.statistics.size+=t.size||0,r.statistics.duration+=t.duration||0,r.statistics.speed=r.statistics.duration>0?r.statistics.size/r.statistics.duration:0,Ye(r.numWorkers>=0)),this._next()}_next(){for(const t of this._clients)if(t&&t.numWorkers<t.typeWorkerQuota&&this._processQueue(t))return;for(const t of this._clients)if(t&&this._processQueue(t))return}_processQueue(t){for(;t.tasks.length>0;)if(this._workerFunc(t.tasks.shift(),(r,i)=>this._taskCallback(r,i)))return t.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(t,r){t._cancelled||(this._callbackFunc(t,r),this._taskFinished(t))}getStatsForType(t){const r=this._clients[t];return r?{quota:r.typeWorkerQuota,workers:r.numWorkers,queueSize:r.tasks.length,requestStats:r.statistics}:null}get test(){const t=this;return{set workerFunc(r){t._workerFunc=r}}}}let EI=class extends xe{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,t,r){this._loadQueue=new Cet((i,s)=>this._startLoading(i,s),(i,s)=>this._doneLoadingCB(i,s),e,t),r&&(this._frameTask=r.registerTask(at.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=xi(this._frameTask),this._tasks.forEach(e=>$c(e.abortController)),this._loadQueue=Re(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,t,r,i={}){const s=Ys();s.__signal=i!=null?i.signal:null;const n=this._createOrUpdateTask(e,t,r,i,s);return Ws(i,()=>this._cancelRequest(n,s)),s.promise}_createTask(e,t,r,i,s,n){const o=new Ret(e,t,r,i,s);return this._updateTask(o,n),this._tasks.set(s,o),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(o),o}_cancelRequest(e,t){eA(e.resolvers,t),t.reject(Cr()),e.resolvers.length===0&&(e.status===mu.DOWNLOADING&&(e.status=mu.CANCELLED,this._loadQueue.cancel(e),e.abortController?.abort(),e.request=null,e.abortController=null),e.status=mu.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,t){e.resolvers.push(t)}_createOrUpdateTask(e,t,r,i,s){const n=Pet(i!=null&&i.uid||e,t,r),o=this._tasks.get(n);return o?(this._updateTask(o,s),o):this._createTask(e,i,t,r,n,s)}_doneLoadingCB(e,t){this._loadQueue&&(Ye(e.status===mu.DOWNLOADING),e.status=mu.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:t}):this._doneLoading(e,t))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const t=this._onLoadQueue.shift();Jt(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const t=this._doneQueue.shift();t.task.status!==mu.DOWNLOADED&&(t.err=t.err||Cr()),this._doneLoading(t.task,t.err),e.madeProgress()}}_doneLoading(e,t){if(t&&!$s(t)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let r=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const i of e.resolvers)if(t)$s(t)?i.reject(t):i.reject(new G("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${t}`,{url:e.url,error:t}));else{--r;const s=r<=0?e.result:ye(e.result);i.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,t){if(e.status===mu.CANCELLED)return!1;let r,i;switch(e.startTime=performance.now(),e.status=mu.DOWNLOADING,e.docType){case"binary":i="array-buffer",r=0;break;case"image":i="image";break;case"image+type":i="array-buffer";break;default:i="json"}e.abortController=new AbortController;const s=e.abortController.signal;e.request=ii(e.url,{...e.options,responseType:i,timeout:r,signal:s});let n=()=>{};const o=l=>{e.duration=performance.now()-e.startTime,e.size=l instanceof ArrayBuffer?l.byteLength:e.size||0,e.result=l,this._frameTask?this._onLoadQueue.push({callback:t,task:e}):(e.abortController=null,t(e))},a=l=>{e.status===mu.DOWNLOADING&&t(e,l),n()};return e.docType!=="image+type"?(e.request.then(l=>o(l.data),a),!0):(e.request.then(l=>{const c=l.data,u=Oet(c);if(i="image",e.size=c.byteLength,u==="unknown")return e.request=ii(e.url,{responseType:i,timeout:r,signal:s}),void e.request.then(g=>o(g.data),a);const d=new Blob([c],{type:u}),p=window.URL.createObjectURL(d);n=()=>window.URL.revokeObjectURL(p),e.request=ii(p,{responseType:i,timeout:r,signal:s}),e.request.then(g=>o(new Q4(g.data,u,n)),a)},a),!0)}get test(){return{loadQueue:this._loadQueue}}};h([f({readOnly:!0})],EI.prototype,"updating",void 0),EI=h([F("esri.views.3d.support.StreamDataLoader")],EI);const Aet={numRetries:0};function Oet(e){if(e.byteLength<2)return"unknown";const t=new Uint8Array(e,0,e.byteLength);return t[0]===137&&t[1]===80?"image/png":t[0]===71&&t[1]===73?"image/gif":t[0]===66&&t[1]===77?"image/bmp":t[0]===255&&t[1]===216?"image/jpeg":"unknown"}class Q4{constructor(t,r,i){this.image=t,this.type=r,this.release=i}get isOpaque(){return this.type==="image/jpeg"}}class Ret extends xet{constructor(t,r,i,s,n){super(s),this.url=t,this.options=r,this.docType=i,this.key=n,this.result=null,this.status=mu.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=Aet.numRetries}}function Pet(e,t,r){return`${e}:${t}:${r}`}var mu;(function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.DOWNLOADED=3]="DOWNLOADED",e[e.CANCELLED=4]="CANCELLED"})(mu||(mu={}));let CI=class extends xe{constructor(){super(...arguments),this.updating=!1}};function Met(e){return new $h({view:e})}h([f({readOnly:!0})],CI.prototype,"updating",void 0),CI=h([F("esri.views.3d.support.ResourceControllerMain")],CI);let $h=class extends CI{constructor(){super(...arguments),this._immediateTask=wT,this._normalTask=wT,this._updatingObjects=bA([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=ENe(),this._memoryController=vet(this.view),this._streamDataLoader=new EI,this._streamDataLoader.setup(_et,yet,this._scheduler),this.addHandles([le(()=>this.view.state?.mode,e=>{e!=null&&(this._scheduler.state=e)},Vr),le(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=Qx({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(at.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(at.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=xi(this._frameTask),this._streamDataLoader=Re(this._streamDataLoader),this._memoryController=Re(this._memoryController),this._scheduler=Re(this._scheduler),this.view=null}get updating(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._immediateTask?.updating)||this._updatingObjects?.value.some(e=>e.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const t=this._streamDataLoader;return{request:(r,i,s)=>t.request(r,i,e,s),get busy(){return!t.hasDownloadSlots(e)}}}addUpdatingObject(e){const t=this._updatingObjects;return t.value=[...t.value,e],Xo(()=>{t.value=t.value.filter(r=>r!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(BV(e.deltaTime)),!this._scheduler)||(this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};h([f()],$h.prototype,"view",void 0),h([f()],$h.prototype,"_scheduler",void 0),h([f()],$h.prototype,"_memoryController",void 0),h([f()],$h.prototype,"_streamDataLoader",void 0),h([f()],$h.prototype,"_immediateTask",void 0),h([f()],$h.prototype,"_normalTask",void 0),h([f()],$h.prototype,"_updatingObjects",void 0),h([f({readOnly:!0})],$h.prototype,"updating",null),$h=h([F("esri.views.3d.support.ResourceControllerImpl")],$h);function Iet(e){return Cve(e)}function $et(e){return"performanceInfo"in e}var Uo,et;(function(e){e[e.INSIDE=0]="INSIDE",e[e.INTERSECTS=1]="INTERSECTS",e[e.OUTSIDE=2]="OUTSIDE"})(Uo||(Uo={})),function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"}(et||(et={}));const Qb=C(),Let=C(),Cf=C(),Af=C();function Det(e,t,r=0){const i=e.extent;if(i==null)return!1;if(r===0)return Qce(i,t);const s=Math.min(i[2]-i[0],i[3]-i[1]);return PRe(i,t,r*s)}function $P(e,t,r,i){re(Qb,r),Qb[i]=t[i];const s=ce(Qb,Qb,t),n=ce(Let,e,t),o=de(n,s),a=de(s,s);let l;l=o<=0?t:a<=o?r:oe(Qb,t,te(s,s,o/a));const c=ce(Qb,e,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function Net(e,t,r){const i=e.extent;if(i==null)return 0;Cf[0]=i[0],Cf[1]=i[1],Cf[2]=r,Af[0]=i[2],Af[1]=i[3],Af[2]=r;let s=1/0,n=1/0;return t[0]<Cf[0]?s=$P(t,Cf,Af,0):t[0]>Af[0]&&(s=$P(t,Af,Cf,0)),t[1]<Cf[1]?n=$P(t,Cf,Af,1):t[1]>Af[1]&&(n=$P(t,Af,Cf,1)),Math.min(s,n)}function Fet(e,t,r){if(e==null)return WG();if(e.spatialReference.isGeographic&&!gy(e.spatialReference))return new G("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const i=Pi.checkUnsupported(e);if(i!=null)return i;if(r==null)return new G("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const s=Uet(e,r);if(s)return s;const n=e.spatialReference;return t==null||n.equals(t)||t.isWGS84&&n.isWebMercator?null:new G("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}function Uet(e,t){const r=e.lods,i=r[0].resolution*2**r[0].level,s=[i*e.size[0],i*e.size[1]],n=[e.origin.x,e.origin.y],o=Jce(t),a=Nt();Pi.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>ox){const c=r[0].scale*2**r[0].level;let u=Math.max((o[3]-o[1])/e.size[1],(o[2]-o[0])/e.size[0])*c/i;const d=Math.floor(Math.log(u)/Math.log(10));return u=Math.ceil(u/10**d)*10**d,new G("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+u.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:u,requiredNumRootTiles:l,allowedNumRootTiles:ox})}return null}const ket=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:Fet,isInsideExtent:Det,tiltToExtentEdge:Net},Symbol.toStringTag,{value:"Module"}));function zet(){return!0}function Bet(){return 0}function Vet(e,t){if(e==null)return WG();const r=e.lods.length-1,i=e.spatialReference,s=gy(i)||af(i)||lf(i);if(i.isWebMercator){if(!Pi.makeWebMercatorAuxiliarySphere(r).compatibleWith(e))return new G("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new G("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!Pi.makeGCSWithTileSize(e.spatialReference,e.size[0],r).compatibleWith(e))return e.spatialReference.isWGS84?new G("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new G("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return t==null||e.spatialReference.equals(t)?void 0:new G("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const Get=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:Vet,isInsideExtent:zet,tiltToExtentEdge:Bet},Symbol.toStringTag,{value:"Module"})),jet={[Ie.Global]:Get,[Ie.Local]:ket};function wp(e,t){e||console.warn("Terrain: "+t)}let Js=!1,oD=!1;function Het(e){oD=e,Js=Js||e}function Wet(e){Js=e}function we(e,t){if(Js&&!e){const r=new Error().stack?.slice(5);throw console.warn("Terrain internal: "+(t??"")+" at "+r),new Error("Assertion failed"+(t?": "+t:""))}}function SB(e){return e5(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function aD(e){return e?.type==="imagery-tile"||e?.type==="wcs"}function e5(e){return e?.type==="imagery-tile-3d"}function CW(e){return e?.type==="tile-3d"}function o3(e){return e?.type==="vector-tile-3d"}function Ave(e){return e?.type==="wmts-3d"}function EB(e){return e?.type==="elevation-3d"}function OS(e){return e?.type==="group"}function lD(e){return e&&(CW(e)||Ave(e)||e5(e)||o3(e))}function CB(e){return e&&(CW(e)||e5(e)||o3(e)||Ave(e))}function a3(e){return CB(e)||EB(e)}function qet(e){const t=e?.sourceLayerInfo?.data;return t!=null&&"type"in t&&t.type==="raster-tile"}function Ove(e){return Rve(e?.sourceLayerInfo)}function Xet(e){const t=e?.sourceLayerInfo?.data;return t!=null&&"type"in t&&t.type==="tile-texture"}function Zet(e){const t=e?.sourceLayerInfo?.data;return t instanceof HTMLImageElement||t instanceof Q4||t instanceof HTMLCanvasElement||t instanceof ImageData}function Rve(e){return e?.data!=null&&"type"in e.data&&e.data.type==="vector-tile"}function Gx(e){return e!=null&&"release"in e&&e.release(),null}function jte(e){return e.fetchTile&&e.hasOverriddenFetchTile!==!1}function AW(e,t,r,i){return jet[i].checkIfTileInfoSupportedForViewSR(e,r,t)}function t5(e,t,r){let i=null,s=null;if(e?.type==="wmts"){const n=Yet(e,t,r);i=n.tileInfo,s=n.fullExtent}else{s=aD(e)?e.getCompatibleFullExtent(t):e.fullExtent;const n=r===Ie.Local;if(aD(e))i=e.getCompatibleTileInfo(t,s,n);else if(e?.type==="vector-tile"){const o=n&&!Jet(t)||Ket.force512VTL,a=e.tileInfo.spatialReference.isGeographic;i=o?e.tileInfo:e.tileInfo.getOrCreateCompatible(256,a?1:2)}else i=e.tileInfo}return i!=null&&s!=null&&AW(i,s,t,r)==null?{tileInfo:i,fullExtent:s}:null}function Yet(e,t,r){const i=kLe(e);if(i!=null){if(!Pt.isCollection(i))return{tileInfo:i.tileInfo,fullExtent:i.fullExtent};{const s=i.find(n=>AW(n.tileInfo,n.fullExtent,t,r)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function Jet(e){return e.isWGS84||e.isWebMercator||Mce(e)||!nT(e)}const Ket={force512VTL:!1};function Hte(e){return"["+e[0]+","+e[1]+","+e[2]+"]"}function Of(e){return"("+e[0]+","+e[1]+","+e[2]+")"}function Au(e,t,r=ttt){return Math.abs(e-t)<r}function cD(e){return e===et.NORTH_EAST?et.SOUTH_WEST:e===et.NORTH_WEST?et.SOUTH_EAST:e===et.SOUTH_WEST?et.NORTH_EAST:et.NORTH_WEST}function uD(e){return e===et.NORTH?et.SOUTH:e===et.EAST?et.WEST:e===et.SOUTH?et.NORTH:et.EAST}function Qet(e){return e===et.NORTH_WEST||e===et.SOUTH_WEST}function ett(e){return e===et.NORTH_WEST||e===et.NORTH_EAST}function Wte(e){return e===et.NORTH_WEST||e===et.WEST||e===et.SOUTH_WEST}function qte(e){return e===et.NORTH_EAST||e===et.EAST||e===et.SOUTH_EAST}function Xte(e){return e===et.SOUTH_EAST||e===et.SOUTH||e===et.SOUTH_WEST}function Zte(e){return e===et.NORTH_EAST||e===et.NORTH||e===et.NORTH_WEST}const $p=[et.NORTH,et.EAST,et.SOUTH,et.WEST],l3=[et.NORTH_EAST,et.SOUTH_EAST,et.SOUTH_WEST,et.NORTH_WEST],ttt=1e-5;class rtt{constructor(t,r){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=t.layer,this.memory=a3(t)?r.basemapTerrain.getUsedMemoryForLayerView(t):t.usedMemory,$et(t)){const i=t.performanceInfo;this.displayedNumberOfFeatures=i.displayedNumberOfFeatures,this.maximumNumberOfFeatures=i.maximumNumberOfFeatures,this.totalNumberOfFeatures=i.totalNumberOfFeatures}}}class itt{constructor(t){if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,t.resourceController!=null){const i=t.resourceController.memoryController;this.totalMemory=(i.maxMemory??0)*eL.MEGABYTES,this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=i.memoryFactor,this.load=t.resourceController.scheduler.load}this.terrainMemory=t.basemapTerrain?.usedMemory??0;const r=t._stage&&t._stage.renderView&&t._stage.renderer.edgeView;this.edgesMemory=r!=null?r.usedMemory:0,t.allLayerViews.items.forEach(i=>{(Iet(i)||a3(i))&&this.layerPerformanceInfos.push(new rtt(i,t))}),this.layerPerformanceInfos.sort((i,s)=>s.memory-i.memory)}}class stt{constructor(t){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=t("gltf-resources",()=>{}),this._wosrMemCache=t("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(t=>t.abortController.abort()),this._wosrLoading.forEach(t=>t.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(t,r,i){const s=i?`gltfPBR:${t}`:`gltf:${t}`,n=this._gltfMemCache.get(s);return n!=null?Promise.resolve(n):this._loadOnce(this._gltfLoading,this._gltfMemCache,s,o=>k_e(new F_e(o.streamDataRequester),t,o,i),r)}loadWOSR(t,r){const i=`wosr:${t}:${r.disableTextures}`,s=this._wosrMemCache.get(i);return s!=null?Promise.resolve(s):this._loadOnce(this._wosrLoading,this._wosrMemCache,i,n=>z_e(t,n),r)}async _loadOnce(t,r,i,s,n){Jt(n);const o=Ws(n,()=>this._abortLoad(t,i));let a=t.get(i);if(a)a.refCount++;else{const l=new AbortController;a={refCount:1,abortController:l,promise:s({...n,signal:l.signal})},t.set(i,a)}try{const l=await a.promise;return r.put(i,l,l.size),t.delete(i),Jt(n),l}finally{xi(o)}}_abortLoad(t,r){const i=t.get(r);i!=null&&--i.refCount>0||(t.delete(r),i?.abortController.abort())}}class ntt extends ax{constructor(t,r,i){super(r,i),this._streamDataRequester=t}async fromUrl(t,r,i){Jt(i);const s=i!=null?i.signal:null,n=this.makeUid(t,r);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(t,"image",{uid:n,signal:a.signal});o=new mpe,o.abortController=a;const c=o;this._textureRequests.set(n,o),o.textureAsync=l.then(async u=>{const d=this._createTexture(t,u,r);return c.texture=d,c.abortController=null,this._stage.add(d),await this._stage.load(d),{uid:n,texture:d,release:()=>this._release(n)}},u=>{throw c.abortController=null,u})}o.referenceCount++;try{return await Xwe(o.textureAsync,s)}catch(a){throw this._release(n),a}}_createTexture(t,r,i){const s={width:r.width,height:r.height,wrap:{s:Ct.CLAMP_TO_EDGE,t:Ct.CLAMP_TO_EDGE},preMultiplyAlpha:!0};if(Poe(t)){if(i||r.width===0&&r.height===0){const n=r.width?r.height/r.width:1;i=i||64,n>1?(r.width=Math.round(i/n),r.height=i):(r.width=i,r.height=Math.round(i*n))}this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return new lb(r,s)}}class ott{constructor(t){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=t.viewState,this._view=t.view,this._pointsOfInterest=t.pointsOfInterest,this.streamDataRequester=t.resourceController.createStreamDataRequester(Pp.SYMBOLOGY),this.objectResourceCache=new stt((i,s)=>t.resourceController.memoryController.newCache(i,s)),this.textures=new ntt(this.streamDataRequester,t.view._stage,t.resourceController.scheduler);const r=Mr(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=age(t.viewingMode,r),this.screenSizePerspectiveSettingsLabels=aBe(t.viewingMode,r)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(t){if(!t)return Xo();this._graphicsOwners.push(t);const r=le(()=>t.layer?.screenSizePerspectiveEnabled,()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),Xo(()=>{r.remove(),eA(this._graphicsOwners,t),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const t=this._graphicsOwners.some(r=>r.layer?.screenSizePerspectiveEnabled===!0);if(t&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new gi;const r=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([le(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,r,Vr),this._viewState.events.on("camera-projection-changed",r)]),this._updateScreenSizePerspectiveSettings()}else t||(this._screenSizePerspectiveHandles=Re(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const t=this._pointsOfInterest;LP.distance=t.centerOnSurfaceInfrequent.distance,LP.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(LP),this.screenSizePerspectiveSettingsLabels.update(LP),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}}const LP={distance:0,fovY:0};class Gw{constructor(t,r,i=""){this.graphics=t,this._symbol=new V0({symbolLayers:[new B0({material:{color:r},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new tb({text:i,halo:{color:"white",size:1/.75},material:{color:r},size:12})]})}show(t,r){if(r==null)return;this.hide();const i=new ut({x:t[0],y:t[1],z:t[2],spatialReference:r});this._graphic=new v1({geometry:i,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){this._graphic!=null&&(this.graphics.remove(this._graphic),this._graphic=null)}}let $0=class extends xe{constructor(e){super(e),this.handles=new gi}destroy(){this.handles.destroy()}};h([f({constructOnly:!0})],$0.prototype,"renderCoordsHelper",void 0),h([f({constructOnly:!0})],$0.prototype,"surface",void 0),h([f({constructOnly:!0})],$0.prototype,"state",void 0),$0=h([F("esri.views.3d.support.PointOfInterest")],$0);const att=Array;let Lh=class extends $0{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new Um({location:ut,renderLocation:att},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=C(),this._tmpPoint=new ut}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(qo(()=>this.map?.ground?.layers,"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=Re(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,t=ni(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return D1(r,t,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return this._updateSurfaceAltitude(0),Eo.YIELD;const e=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,e);const t=(this._tmpPoint.z??0)>ltt&&this.renderCoordsHelper.viewingMode===Ie.Global&&(e.isWGS84||e.isWebMercator);let r=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:r.signal,cache:this.cache,minDemResolution:t?ctt:0}).then(i=>this._updateSurfaceAltitude(i.geometry.z??0)).catch(i=>{$s(i)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===r&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),r=null}),this._pendingElevationQueryController=r,Eo.YIELD}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(EU,this._estimatedSurfaceAltitude,this._camera.eye),Go(this._get("renderLocation"),EU)||(this._set("renderLocation",re(this._propertiesPool.get("renderLocation"),EU)),this.notifyChange("renderLocation"))}};h([f({constructOnly:!0})],Lh.prototype,"scheduler",void 0),h([f({constructOnly:!0})],Lh.prototype,"cache",void 0),h([f({constructOnly:!0})],Lh.prototype,"task",void 0),h([f({readOnly:!0})],Lh.prototype,"location",null),h([f({constructOnly:!0})],Lh.prototype,"map",void 0),h([f({readOnly:!0})],Lh.prototype,"renderLocation",void 0),h([f({readOnly:!0})],Lh.prototype,"scale",null),h([f({readOnly:!0})],Lh.prototype,"updating",null),Lh=h([F("esri.views.3d.support.CameraOnSurface")],Lh);const EU=C(),ltt=1e5,ctt=1e6,utt=Array;let gu=class extends $0{constructor(e){super(e),this._propertiesPool=new Um({location:ut,renderLocation:utt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=C(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=xi(this._frameWorker),this._propertiesPool=Re(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,Eo.YIELD}_updateRenderLocation(){const e=dtt;let t=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!t&&r&&(t=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),t&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const i=ptt;t&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,i)&&(re(e,i),this._currentSurfaceAltitude=this._latestSurfaceAltitude),t?this.distance=ni(this._camera.eye,e):(te(e,this._camera.viewForward,this._get("distance")),oe(e,e,this._camera.eye)),Go(this._get("renderLocation"),e)||this._set("renderLocation",re(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,t){const r=this._camera;if(!this.renderCoordsHelper.intersectManifold(r.ray,e,t))return!1;if(this.state.isGlobal){const i=Mr(this.renderCoordsHelper.spatialReference).radius,s=i+e,n=Bo(r.eye),o=n<s*s,a=ni(r.eye,t);if(o&&a>i/4){const l=s-Math.sqrt(n);return te(t,r.viewForward,l),oe(t,t,r.eye),!0}}else{const i=this.surface?.ready?this.surface.extent:null;i!=null&&k3(i,this.surface?.spatialReference,RS,this.renderCoordsHelper.spatialReference)&&(t[0]=fe(t[0],RS[0],RS[2]),t[1]=fe(t[1],RS[1],RS[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,t){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,t)){if(Kr.TESTS_DISABLE_OPTIMIZATIONS)return!0;const r=this._camera.eye,i=ni(r,e),s=ni(r,t);if(Math.abs(s-i)/i>htt)return!0}return!1}};h([f({constructOnly:!0})],gu.prototype,"scheduler",void 0),h([f({constructOnly:!0})],gu.prototype,"task",void 0),h([f()],gu.prototype,"distance",void 0),h([f({constructOnly:!0})],gu.prototype,"estimateSurfaceAltitudeAtCenter",void 0),h([f({readOnly:!0})],gu.prototype,"location",null),h([f({readOnly:!0})],gu.prototype,"renderLocation",void 0),h([f()],gu.prototype,"updating",void 0),gu=h([F("esri.views.3d.support.CenterOnSurface")],gu);const htt=.05,dtt=C(),ptt=C(),RS=Nt();class ftt{constructor(t){this._handles=new gi,this.events=new cs,this._contentLayerViews=t.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",r=>this._layerViewsChanged(r))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=Re(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(t){t.added.forEach(r=>{r.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(r.on("visible-geometry-changed",()=>this._contentChanged()),r.uid)}),t.removed.forEach(r=>this._handles.remove(r.uid))}_contentChanged(){this.events.emit("request-update",mtt)}}const mtt={},gtt=Array;let dp=class extends $0{constructor(e){super(e),this._propertiesPool=new Um({location:ut,renderLocation:gtt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([le(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),le(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(at.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=Re(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),t=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,i=this.state.contentCamera;this._dirty=!1,r.worldUpAtPosition(t,Yte);const s=Math.max(0,(Math.acos(de(Yte,i.viewForward))-.5*Math.PI)*(i.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!ly(e,t)){const l=this._propertiesPool.get("renderLocation");re(l,t),this._set("renderLocation",l)}return Eo.YIELD}const n=1-fe(s/(.5*Math.PI),0,1),o=n*n*n;this._calculateScreenHorizontalEdgeOnSurface(Jte);const a=this._propertiesPool.get("renderLocation");return Lr(a,t,Jte,o),e&&ly(e,a)||this._set("renderLocation",a),Eo.YIELD}_calculateScreenHorizontalEdgeOnSurface(e){const t=this.state.contentCamera,r=t.getRenderCenter(xo());if(r[1]=t.aboveGround?t.padding[Gt.BOTTOM]:t.fullHeight-t.padding[Gt.TOP],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const i=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(t.unprojectFromRenderScreen(r,PS)){ce(PS,PS,t.eye);const s=pe(PS,PS);if(this.renderCoordsHelper.intersectManifold(Fc(t.eye,s),i,e))return e}return this.renderCoordsHelper.setAltitude(e,i,t.eye)}updateRenderLocation(){this._dirty=!0}};h([f()],dp.prototype,"_dirty",void 0),h([f({constructOnly:!0})],dp.prototype,"scheduler",void 0),h([f({constructOnly:!0})],dp.prototype,"centerOnSurface",void 0),h([f({constructOnly:!0})],dp.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),h([f({readOnly:!0})],dp.prototype,"updating",null),h([f({readOnly:!0})],dp.prototype,"location",null),h([f({readOnly:!0})],dp.prototype,"renderLocation",void 0),dp=h([F("esri.views.3d.support.pointsOfInterest.Focus")],dp);const Yte=C(),PS=C(),Jte=C();let qf=class extends xe{get surface(){return this.view.map?.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=C();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new gi}initialize(){this.view.state.isLocal&&(this._handles.add([le(()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent],()=>this._update()),qo(()=>this.surface?.layers,"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||this.surfaceView.extent==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=B7(this.surfaceView.extent),t=new ut({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(r=>{this._updateController=null,this._set("location",r.geometry)}).catch(r=>{$s(r)||r&&r.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",r)})):this._set("location",t)}};h([f({constructOnly:!0})],qf.prototype,"view",void 0),h([f({constructOnly:!0})],qf.prototype,"cache",void 0),h([f()],qf.prototype,"surface",null),h([f()],qf.prototype,"surfaceView",null),h([f({readOnly:!0})],qf.prototype,"location",void 0),h([f({readOnly:!0})],qf.prototype,"renderLocation",null),qf=h([F("esri.views.3d.terrain.StableSurfaceCenter")],qf);let Xf=class extends xe{constructor(e){super(e),this._tileGeometryUpdateExtent=qu(),this._tileGeometryUpdateSpatialReference=null,this.events=new cs,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(at.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",ytt),qu(this._tileGeometryUpdateExtent),this._set("updating",!1)),Eo.YIELD}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,ry(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const r=this.centerOnSurfaces[t];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,t){const r=this.state.contentCamera.eye,i=_tt,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,x_,t),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,T_,t),x_[0]<T_[0]?(i[0]=x_[0],i[2]=T_[0]):(i[0]=T_[0],i[2]=x_[0]),x_[1]<T_[1]?(i[1]=x_[1],i[3]=T_[1]):(i[1]=T_[1],i[3]=x_[1]),tN(i,e)}};h([f({constructOnly:!0})],Xf.prototype,"state",void 0),h([f({constructOnly:!0})],Xf.prototype,"centerOnSurfaces",void 0),h([f({constructOnly:!0})],Xf.prototype,"renderCoordsHelper",void 0),h([f({constructOnly:!0})],Xf.prototype,"scheduler",void 0),h([f({constructOnly:!0})],Xf.prototype,"surface",void 0),h([f({readOnly:!0})],Xf.prototype,"updating",void 0),Xf=h([F("esri.views.3d.support.SurfaceGeometryUpdates")],Xf);const ytt={},x_=C(),T_=C(),_tt=qu();let ka=class extends xe{constructor(e){super(e),this._handles=new gi,this._tmpRay=Dn(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new Um({renderPointOfView:vtt},this),this.renderPointOfView=C(),this._pois=new Array,this._debugCenters=new Map}initialize(){const{state:e,basemapTerrain:t,renderCoordsHelper:r,map:i}=this.view;this._surfaceIntersector=eh(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=so.MIN,this._contentIntersector=eh(e.viewingMode);const s=()=>this._estimateSurfaceAltitudeAtCenter(),n=this.view.resourceController.scheduler,o=this.view.basemapTerrain?.elevationQueryCache,a={state:e,scheduler:n,surface:t,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new gu({...a,task:at.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnSurfaceFrequent",new gu({...a,task:at.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnContent",new gu({...a,task:at.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new Lh({...a,cache:o,task:at.POINT_OF_INTEREST_INFREQUENT,map:i})),this._set("surfaceGeometryUpdates",new Xf({...a,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new ftt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new qf({cache:o,view:this.view})),this._set("focus",new dp({state:e,scheduler:n,surface:t,renderCoordsHelper:r,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(c,u)=>this._estimateSurfaceIntersectionAtRenderPoint(c,this.view.state.contentCamera,u)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const l=this.view.graphics;this._debugCenters.set(this.centerOnContent,new Gw(l,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new Gw(l,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new Gw(l,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new Gw(l,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new Gw(l,"green","Focus")),this._handles.add([le(()=>e.contentCamera,c=>this._cameraChanged(c),Vr),le(()=>t.extent,()=>this._updateCenterPointsOfInterest()),Dc(()=>!t.updating,()=>this._updateCenterPointsOfInterest(),Vr),qo(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),qo(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),Dc(()=>Kr.SHOW_POI,c=>this._setDebug(c),Rr)]),this._cameraChanged(this.view.state.contentCamera);for(const c of this._pois)c.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){return!(!this.surfaceGeometryUpdates?.updating&&!this._pois.some(e=>e.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,ew,wtt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(ew):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const t=e.origin,r=oe(ew,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,t,r),this._surfaceIntersector.results.min.getIntersectionPoint(ew)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(ew)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,t,r){const i=qj(t,e,btt);if(i==null)return null;const s=i.origin,n=oe(ew,i.origin,i.direction);return this._surfaceIntersector.resetWithRay(i,t),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,n),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const t=e.eye;Go(this.renderPointOfView,t)||this._set("renderPointOfView",re(this._propertiesPool.get("renderPointOfView"),t))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(t=>t.hide()),void this._handles.remove("debug");for(const t of this._pois)this._handles.add(le(()=>t.renderLocation,r=>this._debugCenters.get(t)?.show(r,t.renderCoordsHelper.spatialReference),Rr),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};h([f({readOnly:!0})],ka.prototype,"centerOnContent",void 0),h([f({readOnly:!0})],ka.prototype,"centerOnSurfaceFrequent",void 0),h([f({readOnly:!0})],ka.prototype,"centerOnSurfaceInfrequent",void 0),h([f({readOnly:!0})],ka.prototype,"cameraOnSurface",void 0),h([f({readOnly:!0})],ka.prototype,"focus",void 0),h([f({readOnly:!0})],ka.prototype,"renderPointOfView",void 0),h([f({readOnly:!0})],ka.prototype,"surfaceOrigin",void 0),h([f({readOnly:!0})],ka.prototype,"contentGeometryUpdates",void 0),h([f({readOnly:!0})],ka.prototype,"surfaceGeometryUpdates",void 0),h([f({constructOnly:!0})],ka.prototype,"view",void 0),h([f({readOnly:!0})],ka.prototype,"updating",null),ka=h([F("esri.views.3d.support.PointsOfInterest")],ka);const vtt=Array,ew=C(),btt=Dn(),wtt={exclude:new Set([R0])},c3=new Pt,jC=new WeakMap;function xtt(e){Pve(e)&&c3.push(e)}function Ttt(e){Pve(e)&&c3.includes(e)&&c3.remove(e)}function Pve(e){return e!=null&&typeof e=="object"&&"refreshInterval"in e&&"refresh"in e}function Mve(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:Mve(t,e%t):0}let CU=0,DP=0;function Stt(){const e=Date.now();for(const t of c3)t.refreshInterval&&e-(jC.get(t)??0)+5>=6e4*t.refreshInterval&&(jC.set(t,e),t.refresh(e))}yoe(()=>{const e=Date.now();let t=0;for(const r of c3)t=Mve(Math.round(6e4*r.refreshInterval),t),r.refreshInterval?jC.get(r)||jC.set(r,e):jC.delete(r);if(t!==DP){if(DP=t,clearInterval(CU),DP===0)return void(CU=0);CU=setInterval(Stt,DP)}});function Ett(e){return e!=null&&typeof e=="object"&&"refreshTimestamp"in e&&"refresh"in e}const Wmt=e=>{let t=class extends e{constructor(...r){super(...r),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=zV(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||xtt(this)},()=>{})}destroy(){Ttt(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(r=Date.now()){v8(this._debounceHasDataChanged()).then(i=>{i&&this._set("refreshTimestamp",r),this.emit("refresh",{dataChanged:i})},i=>{K.getLogger(this).error(i),this.emit("refresh",{dataChanged:!1,error:i})})}async hasDataChanged(){return!0}};return h([f({type:Number,cast:r=>r>=.1?r:r<=0?0:.1,json:{write:!0}})],t.prototype,"refreshInterval",void 0),h([f({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),h([f()],t.prototype,"refreshParameters",null),t=h([F("esri.layers.mixins.RefreshableLayer")],t),t};class Ctt{constructor(t){this._store=t}destroy(){this._store.destroy()}get(t){return this._store.get(t)}put(t,r){this._store.put(t,r,r.values.byteLength+256)}}class Att{constructor(t,r,i,s){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in t?(this.values=t.pixelData,this.width=t.width,this.height=t.height,this.noDataValue=t.noDataValue):(this.values=t,this.width=r,this.height=i,this.noDataValue=s)}get hasNoDataValues(){if(this._hasNoDataValues==null){const t=this.noDataValue;this._hasNoDataValues=this.values.includes(t)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(this._minValue!=null)return;const{noDataValue:t,values:r}=this;let i=1/0,s=-1/0,n=!0;for(const o of r)o===t?this._hasNoDataValues=!0:(i=o<i?o:i,s=o>s?o:s,n=!1);n?(this._minValue=0,this._maxValue=0):(this._minValue=i,this._maxValue=s>-3e38?s:0)}}class Ive{constructor(t,r,i,s,n={}){this._mainMethod=r,this._transferLists=i,this._listeners=[],this._promise=bIe(t,{...n,schedule:s}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>K.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${t} worker: ${o}`))}on(t,r){const i={removed:!1,eventName:t,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),Xo(()=>{i.removed=!0,LV(this._listeners,i),this._thread&&i.threadHandle!=null&&i.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(t,r){return this.invokeMethod(this._mainMethod,t,r)}invokeMethod(t,r,i){if(this._thread){const s=this._transferLists[t],n=s?s(r):[];return this._thread.invoke(t,r,{transferList:n,signal:i})}return this._promise?this._promise.then(()=>(Jt(i),this.invokeMethod(t,r,i))):Promise.reject(null)}broadcast(t,r){return this._thread?Promise.all(this._thread.broadcast(r,t)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(t,r)):Promise.reject()}get promise(){return this._promise}_connectListener(t){this._thread&&this._thread.on(t.eventName,t.callback).then(r=>{t.removed||(t.threadHandle=r)})}}class Kte extends Ive{constructor(t=null){super("LercWorker","_decode",{_decode:r=>[r.buffer]},t,{strategy:"dedicated"}),this.schedule=t,this.ref=0}decode(t,r,i){return t&&t.byteLength!==0?this.invoke({buffer:t,options:r},i):Promise.resolve(null)}release(){--this.ref<=0&&(HC.forEach((t,r)=>{t===this&&HC.delete(r)}),this.destroy())}}const HC=new Map;function Ott(e=null){let t=HC.get(e);return t||(e!=null?(t=new Kte(r=>e.immediate.schedule(r)),HC.set(e,t)):(t=new Kte,HC.set(null,t))),++t.ref,t}var Al,Qte,ere;(function(e){e[e.FILL=1]="FILL",e[e.LINE=2]="LINE",e[e.SYMBOL=3]="SYMBOL",e[e.CIRCLE=4]="CIRCLE"})(Al||(Al={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.FILL=1]="FILL",e[e.OUTLINE=2]="OUTLINE",e[e.LINE=3]="LINE",e[e.ICON=4]="ICON",e[e.CIRCLE=5]="CIRCLE",e[e.TEXT=6]="TEXT",e[e.TILEINFO=7]="TILEINFO"}(Qte||(Qte={})),function(e){e[e.PAINTER_CHANGED=0]="PAINTER_CHANGED",e[e.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",e[e.LAYER_CHANGED=2]="LAYER_CHANGED",e[e.LAYER_REMOVED=3]="LAYER_REMOVED",e[e.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(ere||(ere={}));class Rtt{constructor(t){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=t}}class qmt{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}function Xmt(e,t,r,i,s,n){const o=r-s;if(o>=0)return(t>>o)+(i-(n<<o))*(e>>o);const a=-o;return t-(n-(i<<a))*(e>>a)<<a}class Zmt{constructor(t,r,i){this._rows=Math.ceil(r/i),this._columns=Math.ceil(t/i),this._cellSize=i,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(t,r){const i=Math.min(Math.max(Math.floor(r/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][s]||null}getCellSpan(t,r,i,s){return[Math.min(Math.max(Math.floor(t/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function Ptt(e,t,r,i,s,n){const o=t[i++];for(let a=0;a<o;a++){const l=new Rtt(n);l.xTile=t[i++],l.yTile=t[i++],l.hash=t[i++],l.priority=t[i++];const c=t[i++];for(let p=0;p<c;p++){const g=t[i++],y=t[i++],_=t[i++],v=t[i++],w=!!t[i++],T=t[i++],x=r[i++],S=r[i++],O=t[i++],A=t[i++];l.colliders.push({xTile:g,yTile:y,dxPixels:_,dyPixels:v,hard:w,partIndex:T,width:O,height:A,minLod:x,maxLod:S})}const u=e[i++];for(let p=0;p<u;p++)l.textVertexRanges.push([e[i++],e[i++]]);const d=e[i++];for(let p=0;p<d;p++)l.iconVertexRanges.push([e[i++],e[i++]]);s.push(l)}return i}function Ymt(e,t,r){for(const[i,s]of e.symbols)Mtt(e,t,r,s,i)}function Mtt(e,t,r,i,s){const n=e.layerData.get(s);if(n.type===Al.SYMBOL){for(const o of i){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],u=c.startOpacity,d=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&d===0;const p=r?Math.floor(127*u)|d<<7:d?255:0;l=p<<24|p<<16|p<<8|p}else l=0;for(const[c,u]of o.iconVertexRanges)for(let d=c;d<c+u;d+=4)n.iconOpacity[d/4]=l;if(o.selectedForRendering){const c=a.parts[1],u=c.startOpacity,d=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&d===0;const p=r?Math.floor(127*u)|d<<7:d?255:0;l=p<<24|p<<16|p<<8|p}else l=0;for(const[c,u]of o.textVertexRanges)for(let d=c;d<c+u;d+=4)n.textOpacity[d/4]=l}n.lastOpacityUpdate=t,n.opacityChanged=!0}}class r5{constructor(t,r){this.layerUIDs=[],this.isDestroyed=!1,this._data=t;let i=1;const s=new Uint32Array(t);this.layerUIDs=[];const n=s[i++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[i++];this.bufferDataOffset=i,r&&(this.layer=r.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return this._data==null}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(t){this._data!=null&&(this.doPrepareForRendering(t,this._data,this.bufferDataOffset),this._data=null)}}class Itt extends r5{constructor(t,r){super(t,r),this.type=Al.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const i=new Uint32Array(t);let s=this.bufferDataOffset;this.lineIndexStart=i[s++],this.lineIndexCount=i[s++];const n=i[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=i[s++],l=i[s++],c=i[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.memoryEstimate??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=De(this.vao)}doPrepareForRendering(t,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=rr.createVertex(t,gr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=rr.createIndex(t,gr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const u=this.layer.lineMaterial;this.vao=new Ju(t,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}}class $tt extends r5{constructor(t,r){super(t,r),this.type=Al.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const i=new Uint32Array(t);let s=this.bufferDataOffset;this.fillIndexStart=i[s++],this.fillIndexCount=i[s++],this.outlineIndexStart=i[s++],this.outlineIndexCount=i[s++];const n=i[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=i[s++],l=i[s++],c=i[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){return(this.data?.byteLength??0)+(this.fillVAO?.memoryEstimate??0)+(this.outlineVAO?.memoryEstimate??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=De(this.fillVAO),this.outlineVAO=De(this.outlineVAO)}doPrepareForRendering(t,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=rr.createVertex(t,gr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=rr.createIndex(t,gr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const u=s[i++],d=rr.createVertex(t,gr.STATIC_DRAW,new Int32Array(n.buffer,4*i,u));i+=u;const p=s[i++],g=rr.createIndex(t,gr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,p));i+=p;const y=this.layer,_=y.fillMaterial,v=y.outlineMaterial;this.fillVAO=new Ju(t,_.getAttributeLocations(),_.getLayoutInfo(),{geometry:a},c),this.outlineVAO=new Ju(t,v.getAttributeLocations(),v.getLayoutInfo(),{geometry:d},g)}}class Ltt extends r5{constructor(t,r,i){super(t,r),this.type=Al.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(t),n=new Int32Array(t),o=new Float32Array(t);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++];for(let p=0;p<l;p++){const g=s[a++],y=s[a++],_=s[a++];this.iconPerPageElementsMap.set(g,[y,_])}const c=s[a++];for(let p=0;p<c;p++){const g=s[a++],y=s[a++],_=s[a++];this.glyphPerPageElementsMap.set(g,[y,_])}const u=s[a++],d=s[a++];this.iconOpacity=new Int32Array(u),this.textOpacity=new Int32Array(d),a=Ptt(s,n,o,a,this.symbols,i),this.bufferDataOffset=a}get memoryUsed(){return(this.data?.byteLength??0)+(this.iconVAO?.memoryEstimate??0)+(this.textVAO?.memoryEstimate??0)+N0(this.iconOpacity)+N0(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let t=0;for(const[r,i]of this.iconPerPageElementsMap)t+=i[1];for(const[r,i]of this.glyphPerPageElementsMap)t+=i[1];return t/3}doDestroy(){this.iconVAO=De(this.iconVAO),this.textVAO=De(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const t=this.iconOpacity,r=this.iconVAO.vertexBuffers.opacity;t.length>0&&t.byteLength===r.byteLength&&r.setSubData(t,0,0,t.length);const i=this.textOpacity,s=this.textVAO.vertexBuffers.opacity;i.length>0&&i.byteLength===s.byteLength&&s.setSubData(i,0,0,i.length)}doPrepareForRendering(t,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=rr.createVertex(t,gr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=rr.createIndex(t,gr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const u=s[i++],d=rr.createVertex(t,gr.STATIC_DRAW,new Int32Array(n.buffer,4*i,u));i+=u;const p=s[i++],g=rr.createIndex(t,gr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,p));i+=p;const y=rr.createVertex(t,gr.STATIC_DRAW,this.iconOpacity.buffer),_=rr.createVertex(t,gr.STATIC_DRAW,this.textOpacity.buffer),v=this.layer,w=v.iconMaterial,T=v.textMaterial;this.iconVAO=new Ju(t,w.getAttributeLocations(),w.getLayoutInfo(),{geometry:a,opacity:y},c),this.textVAO=new Ju(t,T.getAttributeLocations(),T.getLayoutInfo(),{geometry:d,opacity:_},g)}}class Dtt extends r5{constructor(t,r){super(t,r),this.type=Al.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const i=new Uint32Array(t);let s=this.bufferDataOffset;this.circleIndexStart=i[s++],this.circleIndexCount=i[s++],this.bufferDataOffset=s}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.memoryEstimate??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=De(this.vao)}doPrepareForRendering(t,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=rr.createVertex(t,gr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=rr.createIndex(t,gr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const u=this.layer.circleMaterial;this.vao=new Ju(t,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}}const Jmt=!0,Kmt=32,tre=200,Ntt=1/ne("mapview-transitions-duration");class Ftt extends cs{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(t){this._clips=t,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(t){this._opacity!==t&&(this._opacity=Math.min(1,Math.max(t,0)),this.requestRender())}get stage(){return this._stage}set stage(t){if(this._stage===t)return;const r=this._stage;this._stage=t,t?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):r?.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(t){this._visible!==t&&(this._visible=t,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=Ys(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=Ys(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){this._fadeInResolver?.(),this._fadeInResolver=null,this._fadeOutResolver?.(),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(t){this.updateTransitionProperties(t.deltaTime,t.state.scale)}afterRender(t){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){this.parent?.removeChild(this)}setTransform(t){}processRender(t){this.stage&&this.computedVisible&&this.doRender(t)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(t,r){if(this.fadeTransitionEnabled){const i=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===i)this.computedVisible=this.visible;else{const n=t*Ntt;this.computedOpacity=s>i?Math.max(i,s-n):Math.min(i,s+n),this.computedVisible=this.computedOpacity>0;const o=i===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(t){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}class Tp{static getId(t,r,i,s){return typeof t=="object"?`${t.level}/${t.row}/${t.col}/${t.world}`:`${t}/${r}/${i}/${s}`}constructor(t,r,i,s){this.set(t,r,i,s)}get key(){return this}get id(){return this.toString()}set id(t){this.set(t)}get hash(){const t=4095&this.row,r=4095&this.col,i=63&this.level;return(3&this.world)<<30|r<<22|t<<8|i}acquire(t,r,i,s){this.set(t,r,i,s)}contains(t){const r=t.level-this.level;return r>=0&&this.row===t.row>>r&&this.col===t.col>>r&&this.world===t.world}equals(t){return this.level===t.level&&this.row===t.row&&this.col===t.col&&this.world===t.world}clone(){return new Tp(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(t,r,i,s){if(t==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof t=="object")this.level=t.level||0,this.row=t.row||0,this.col=t.col||0,this.world=t.world||0;else if(typeof t=="string"){const[n,o,a,l]=t.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+t,this.row=+r,this.col=+i,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new Tp(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const t=this.level+1,r=this.row<<1,i=this.col<<1,s=this.world;return[new Tp(t,r,i,s),new Tp(t,r,i+1,s),new Tp(t,r+1,i,s),new Tp(t,r+1,i+1,s)]}compareRowMajor(t){return this.row<t.row?-1:this.row>t.row?1:this.col<t.col?-1:this.col>t.col?1:0}}Tp.pool=new fn(Tp,null,null,25,50);class Utt extends Ftt{constructor(t,r,i,s,n,o,a=n,l=o){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new Tp(t),this.resolution=r,this.x=i,this.y=s,this.width=n,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(t){const r=this.resolution/(t.resolution*t.pixelRatio),i=this.transforms.tileMat3,[s,n]=t.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*r,a=this.height/this.rangeY*r;yj(i,o,0,0,0,a,0,s,n,1),AT(this.transforms.dvs,t.displayViewMat3,i)}}class WC extends Utt{constructor(t,r,i,s,n,o,a,l=null){super(t,r,i,s,n,o,4096,4096),this.styleRepository=a,this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.id=t.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<tre}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<tre)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(t){this.changeDataImpl(t),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(t){let r=!1;for(const i of t)if(this.layerData.has(i)){const s=this.layerData.get(i);this._memoryUsedByLayerData-=s.memoryUsed,s.type===Al.SYMBOL&&this.symbols.has(i)&&(this.symbols.delete(i),r=!0),s.destroy(),this.layerData.delete(i),this.layerCount--}this._memCache?.updateSize(this.key.id,this,this._memoryUsedByLayerData),r&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&($ve.delete(this),WC._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsed(){return this._memoryUsedByLayerData+256}changeDataImpl(t){let r=!1;if(t){const{bucketsWithData:i,emptyBuckets:s}=t,n=this._createRenderBuckets(i);if(s&&s.byteLength>0){const o=new Uint32Array(s);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of n)this._deleteLayerData(o),a.type===Al.SYMBOL&&(this.symbols.set(o,a.symbols),r=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a),this.layerCount++;this._memCache?.updateSize(this.key.id,this,this.memoryUsed)}this._hasSymbolBuckets=!1;for(const[i,s]of this.layerData)s.type===Al.SYMBOL&&(this._hasSymbolBuckets=!0);r&&this.emit("symbols-changed")}attachWithContext(t){this.stage={context:t,trashDisplayObject(r){r.processDetach()},untrashDisplayObject:()=>!1}}setTransform(t){super.setTransform(t);const r=this.resolution/(t.resolution*t.pixelRatio),i=this.width/this.rangeX*r,s=this.height/this.rangeY*r,n=[0,0];t.toScreen(n,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;_j(o),hL(o,o,n),vj(o,o,Math.PI*t.rotation/180),bj(o,o,[i,s,1])}_createTransforms(){return{dvs:Ya(),tileMat3:Ya(),tileUnitsToPixels:Ya()}}static _destroyRenderBuckets(t){if(!t)return;const r=new Set;t.forEach(i=>{r.has(i)||(i.destroy(),r.add(i))}),t.clear()}_createRenderBuckets(t){const r=new Map,i=new Map;for(const s of t){const n=this._deserializeBucket(s,i);for(const o of n.layerUIDs)r.set(o,n)}return r}_deserializeBucket(t,r){let i=r.get(t);if(i)return i;switch(new Uint32Array(t)[0]){case Al.FILL:i=new $tt(t,this.styleRepository);break;case Al.LINE:i=new Itt(t,this.styleRepository);break;case Al.SYMBOL:i=new Ltt(t,this.styleRepository,this);break;case Al.CIRCLE:i=new Dtt(t,this.styleRepository)}return r.set(t,i),i}_deleteLayerData(t){if(!this.layerData.has(t))return;const r=this.layerData.get(t);this._memoryUsedByLayerData-=r.memoryUsed,r.destroy(),this.layerData.delete(t),this.layerCount--}}const $ve=new Map;function ktt(){$ve.forEach((e,t)=>{console.log(`
${t.key}:`),e[0].forEach(r=>console.log(r)),console.log("========"),e[1].forEach(r=>console.log(r))})}const Qmt={value:.5,readOnly:!0},ztt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};class _x{constructor(t=0,r=0){this.min=t,this.max=r,this.level=0,this.hasNoDataValues=!1}copyFrom(t){this.min=t.min,this.max=t.max,this.level=t.level,this.hasNoDataValues=t.hasNoDataValues}}class Btt{constructor(t,r){this.data=t,this.safeWidth=.99999999*(t.width-1),this.dx=(t.width-1)/(r[2]-r[0]),this.dy=(t.width-1)/(r[3]-r[1]),this.x0=r[0],this.y1=r[3]}}class Vtt{constructor(t,r,i){this.type="elevation",this.level=t[0],this.i=t[1],this.j=t[2],this.extent=r,this.samplerData=new Btt(i,r)}computeMinMaxValue(t,r,i,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=t-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(r/o)===this.i&&Math.floor(i/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.data.width,u=this.samplerData.data.values,d=.5*vA;let p=(c-1)/o,g=(i-this.j*o)*p,y=(r-this.i*o)*p;if(p<1){const _=Math.floor(g),v=Math.floor(y),w=_+v*c,T=u[w],x=u[w+1],S=u[w+c],O=u[w+c+1];if(T+x+S+O<d){const A=g-_,$=y-v,P=KO(T,x,S,O,A,$),U=KO(T,x,S,O,A+p,$),I=KO(T,x,S,O,A,$+p),L=KO(T,x,S,O,A+p,$+p);return s.min=Math.min(P,U,I,L),s.max=Math.max(P,U,I,L),s}g=_,y=v,p=1}else g=Math.floor(g),y=Math.floor(y),p=Math.ceil(p);for(let _=g;_<=g+p;_++)for(let v=y;v<=y+p;v++){const w=u[_+v*c];w<d?(a=Math.min(a,w),l=Math.max(l,w)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}}const Gtt=.5*vA;function ki(e,t,r){if(r==null)return null;for(const i of r){if(!i)continue;const s=i.safeWidth;let n=fe(i.dy*(i.y1-t),0,s),o=fe(i.dx*(e-i.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=i.data.width,u=a*c+l,d=i.data.values,p=d[u],g=d[u+1],y=u+c,_=d[y],v=d[y+1];if(p+_+g+v<Gtt){n-=a,o-=l;const w=p+(g-p)*o;return w+(_+(v-_)*o-w)*n}}return null}let fu=class extends xe{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(t=>{const r=t.layer;if(r.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const i=Lve(r.fullExtent,this.viewSpatialReference);i!=null&&e.push(Jce(i))}}),e}};function jtt(e,t){return e===Ie.Global?new AB(t):new OB(t)}h([f({readOnly:!0})],fu.prototype,"layerViewsExtent",null),h([f({readOnly:!0})],fu.prototype,"tiledLayersExtent",null),h([f({readOnly:!0})],fu.prototype,"stencilEnabledExtents",null),h([f()],fu.prototype,"viewSpatialReference",void 0),h([f()],fu.prototype,"tilingScheme",void 0),h([f()],fu.prototype,"defaultTiledLayersExtent",void 0),h([f({constructOnly:!0})],fu.prototype,"layers",void 0),h([f({constructOnly:!0})],fu.prototype,"layerViews",void 0),fu=h([F("esri.views.3d.terrain.ExtentHelper")],fu);let AB=class extends fu{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?ape:nDe}};AB=h([F("esri.views.3d.terrain.ExtentHelperGlobal")],AB);let OB=class extends fu{_computeLayerViewsExtent(){const e=qu(),t=this.viewSpatialReference;this.layerViews.forEach(s=>{const n=s.layer;if(s.isResolved()&&(n.type!=="graphics"||!n.internal)){const o=Lve("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,t);ry(e,o,e)}});const r=l9(e)?e:null,i=this._get("layerViewsExtent");return kv(r,i)?i:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const t=this.viewSpatialReference,r=qu();this.layers.forEach(n=>{if(n.loaded&&vC(n)){const o=t5(n,t,Ie.Local);if(o==null)return;const{tileInfo:a,fullExtent:l}=o;a!=null&&l!=null&&(aD(n)||e.compatibleWith(a)&&l.spatialReference.equals(e.spatialReference))&&ry(r,l,r)}}),ry(r,this.defaultTiledLayersExtent,r);const i=l9(r)?r:null,s=this._get("tiledLayersExtent");return kv(i,s)?s:i}};function Lve(e,t){return e==null||e.spatialReference.equals(t)?e:TG(e,e.spatialReference,t)}OB=h([F("esri.views.3d.terrain.ExtentHelperLocal")],OB);var jt;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.MAP=1]="MAP"})(jt||(jt={}));const rv=[jt.ELEVATION,jt.MAP];function Dve(){const e=globalThis.require?.modules;if(e){const t=Object.keys(e);for(const r of t)r.search(".glsl")!==-1&&delete e[r]}}const Htt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let Ng,aa=class extends xe{get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||Kr.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?Mr(this._spatialReference).metersPerDegree:1}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(e){super(e),this._handles=new gi,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=ne("esri-mobile")?2048:4096,this._animationTimeLast=0,this._removeRenderOverlayCallback=()=>{}}initialize(){const e=this.view;this.renderer=new cp({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference});const t=()=>this.setDrawTexturesDirty();this._groundIntersector=eh(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{t(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",i=>e._stage?.renderer.setParameters({hasOverlayWater:i})),this.renderer.events.on("renders-occluded",()=>{t(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",t),le(()=>e.state.camera.pixelRatio,t),le(()=>e.state.alignPixelEnabled,t),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),le(()=>[e.pointsOfInterest?.renderPointOfView,e.pointsOfInterest?.centerOnSurfaceFrequent?.location],()=>this.setPlacementDirty()),le(()=>[e.state?.pixelRatio,e.state?.contentPixelRatio],()=>this.setPlacementDirty(),Vr),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(at.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",i=>{this._updateOverlays(_a,i.camera,ns.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,ns.BACKGROUND,i)})]);let r=i=>this._renderOverlayCallback(i);this._removeRenderOverlayCallback=()=>{r=()=>{}},e._stage?.renderer.setParameters({renderOverlay:i=>r(i)})}_renderOverlayCallback(e){this._contentUpdated=!1;const t=this.renderer;t.processSyncDrapeSources(),t.hasOverlays&&(this._dispatchAnimationUpdate(e),this._drawOverlayTextures(t.overlays,ns.UPDATE,this.view.state)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}destroy(){this._handles=Re(this._handles),this._removeRenderOverlayCallback(),this.view?._stage?.renderer.setParameters({renderOverlay:()=>{}}),Ng!=null&&(Ng.hide(),Ng=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const t=this.view.renderSpatialReference;e!=null&&t!=null?(this._renderSR=t,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new hy(-20037508342787e-6,20037508342787e-6):new hy(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,t,r){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const i=this.renderer.createDrapeSourceRenderer(e,t,r);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),i}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,ac)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){this.view._stage?.renderer.setParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,ns.UPDATE)}_updateOverlays(e,t,r){if(!this._spatialReference)return Eo.YIELD;const i=this._computeOverlayResolution(t);this._computeOverlayExtents(t,i,Rf);const s=bc(Rf.inner)/bc(Rf.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const n=this._updateOverlay(Si.INNER,Rf.inner,i,1*Rf.pixelRatioAdjustment,Rf.mapUnitsPerPixel),o=this._updateOverlay(Si.OUTER,Rf.outer,i,s*Rf.pixelRatioAdjustment,Rf.mapUnitsPerPixel);n!==_p.EXTENT&&o!==_p.EXTENT||(this._drapeSources.forEach(a=>this._updateDrapeSourceExtent(a)),this.surface.updateTileOverlayParams(r)),n===_p.NONE&&o===_p.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const t=this.view.state.contentPixelRatio,r=e.fullWidth/e.pixelRatio*t,i=e.fullHeight/e.pixelRatio*t,s=Math.ceil(1.5*Math.max(r,i));return Math.min(qH(s),this._maxResolution)}_updateOverlay(e,t,r,i,s){if(this.renderer.overlays.length===0)return _p.NONE;const n=this.renderer.overlays[e],o=n.mapUnitsPerPixel;if(n.mapUnitsPerPixel=s,n.pixelRatio=i,Wtt(t,n.extent)&&r===n.resolution)return o===s?_p.NONE:_p.RERENDER_ONLY;Im(n.extent,t),n.resolution=r;const a=B7(n.extent);return n.renderLocalOrigin=UL(a[0],a[1],0,"OV_"+this._latestOriginId++),_p.EXTENT}setTileParameters(e){const t=e.renderData.overlay;if(this.renderer.overlays.length>0){const r=this.renderer.overlays[Si.INNER],i=this.renderer.overlays[Si.OUTER],s=e.extent;this._rectInsideRect(r.extent,s)||this._rectanglesOverlap(s,r.extent)||this._rectanglesOverlap(s,i.extent)?(this._setTileOverlayData(s,Si.INNER,t),this._setTileOverlayData(s,Si.OUTER,t)):(this._clearTileOverlayData(Si.INNER,t),this._clearTileOverlayData(Si.OUTER,t))}else this._clearTileOverlayData(Si.INNER,t),this._clearTileOverlayData(Si.OUTER,t)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const t=this.renderer.overlays[Si.INNER],r=this.renderer.overlays[Si.OUTER],i=this._pointIsInExtent(e,t.extent)?t:r;return(i.extent[2]-i.extent[0])/i.resolution}_setTileOverlayData(e,t,r){if(this.renderer.overlays.length===0)return;const i=this.renderer.overlays[t].extent,s=bc(i),n=yd(i);let o=e[0];if(this._longitudeCyclical){o=this._longitudeCyclical.minimalMonotonic(i[0],o);const a=this._longitudeCyclical.minimalMonotonic(i[0],e[2]);o>a&&(o=a-(e[2]-e[0]))}r.setScale(t,bc(e)/s,yd(e)/n),r.setOffset(t,(o-i[0])/s,(e[1]-i[1])/n)}_clearTileOverlayData(e,t){t.setScale(e,-1,-1),t.setOffset(e,-1,-1)}async reloadShaders(){Dve(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(_a)}_dispatchAnimationUpdate(e){const t=e-this._animationTimeLast;if(t>=this.surface.view._stage.renderer.animationTimestep||this.view.state.forcedAnimationTime!=null||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const r=t/this.surface.view._stage.renderer.animationTimeDilation,i=new Ege(this.view.state.camera,r,this.view.state.forcedAnimationTime);this.renderer.updateAnimation(i)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,t,r,i){const s=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,Ztt,t,r);if(s==null)return!1;const n=s.origin,o=oe(NP,s.origin,s.direction);return this._groundIntersector.reset(n,o,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,n,o),this._groundIntersector.results.min.getIntersectionPoint(i)}_findHorizonBasedPointOfInterest(e,t){let r=.5;const i=.55,s=this.view.renderCoordsHelper.getAltitude(e.eye),n=this.view.pointsOfInterest.centerOnSurfaceFrequent,o=1e-5,a=fe(n.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+o,e.aboveGround?s-o:1/0),l=e.aboveGround;if(this.view.viewingMode==="global"){const c=NP;_2(EN(CN,Mr(this.view.spatialReference).radius+a),Fc(e.eye,e.viewForward),c),ce(c,c,e.eye);const u=dy.normalize(Pde(e.viewForward,c,e.viewRight))/e.fovY+.5,d=u<=0||u>=1?.5:i;r=l?d*u:u+d*(1-u)}else{const c=.5*Math.PI-Math.acos(-e.viewForward[2]),u=Math.tan(c),d=At(0,u,1,0),p=xc(d,d,e.projectionMatrix)[1],g=fe(.5+.5*p,0,1);r=g===1||g===0?.5:l?g*i:1-(1-g)*i}return!!this._intersectGroundFromView(e,.5,r,t)&&ED(t,e.eye)<n.distance*n.distance}_computeOverlayExtents(e,t,r){const i=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=C();this._findHorizonBasedPointOfInterest(e,s)||re(s,i),Kr.OVERLAY_SHOW_CENTER?(Ng==null&&(Ng=new Gw(this.view.graphics,"red")),Ng.show(s,this._renderSR)):Ng?.hide();const n=Math.max(.1,ni(e.eye,s)),o=Cy(this.view.renderCoordsHelper,i,e.eye);this._overlaySREqualsRenderSR||yn(s,this._renderSR,s,this._spatialReference);const a=this.surface.extent,l=!this._isSpherical&&this._spatialReference!=null&&this._spatialReference.isGeographic,c=l&&this._spatialReference!=null?1/Mr(this._spatialReference).metersPerDegree:1,u=this.view.state.contentPixelRatio,d=e.perScreenPixelRatio/u*n*c;r.mapUnitsPerPixel=d/this._worldToPCSRatio;let p=t*d/2*cH,g=!1,y=l?90:1/0;this._isSpherical&&a!=null&&this._spatialReference!=null&&(this._spatialReference.isWebMercator?(p/=Math.cos(k$(s[1])),y=a[3]):(g=!0,p/=Mr(this._spatialReference).metersPerDegree,y=90),p>=y&&(p=y,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let _=1;g&&(_=1/Math.max(.2,Math.cos(Math.abs(Ot(s[1])))),p*_>180&&(_=180/p),r.mapUnitsPerPixel*=_);const v=Math.log(2)/12;p=Math.exp(Math.round(Math.log(p)/v)*v);const w=p*_,T=32,x=.5*t/(T*w),S=.5*t/(T*p);s[0]=Math.round(s[0]*x)/x,s[1]=Math.round(s[1]*S)/S;const O=r.inner;O[0]=s[0]-w,O[1]=s[1]-p,O[2]=s[0]+w,O[3]=s[1]+p,this._isSpherical&&this._shiftExtentToFitBounds(O,1/0,y);const A=r.outer;if(6*w>bc(a))Im(A,a);else if(Math.PI/2-Math.abs(o-Math.PI/2)<=.25*Math.PI)A[0]=O[0]-w,A[1]=O[1]-p,A[2]=O[2]+w,A[3]=O[3]+p;else{yn(e.eye,this._renderSR,NP,this._spatialReference),Ap(S_,s,NP);let P=-Math.atan2(S_[1],S_[0])+.125*Math.PI;P<0&&(P+=2*Math.PI);const U=Math.floor(P/(.25*Math.PI));t1(S_,Htt[U],2*p),S_[0]*=_,S_[2]*=_,RV(A,O,S_)}if(this._isSpherical)A[0]=this._longitudeCyclical.clamp(A[0]),A[2]=this._longitudeCyclical.clamp(A[2]),A[1]=Math.max(A[1],-y),A[3]=Math.min(A[3],y);else{const P=c9(O,a,qtt),U=c9(A,a,Xtt);nZ(P,U)&&(A[2]=A[0],A[3]=A[1])}const $=Math.abs(O[2]-O[0])/t;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,$),r.pixelRatioAdjustment=r.mapUnitsPerPixel/$}_drawOverlayTextures(e,t,r){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const i=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const s=this._drawOverlay(e[Si.INNER],r),n=this._drawOverlay(e[Si.OUTER],r);s!==CT.CHANGED&&n!==CT.CHANGED||this.surface.updateTileOverlayParams(ns.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),i?(this.surface.requestRender(t),t===ns.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(ns.BACKGROUND)}_drawOverlay(e,t){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,t)}_collectUnusedRenderTargetMemory(){this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays&&(this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory())}_rectanglesOverlap(e,t){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):tN(e,t))}_rectInsideRect(e,t){return t!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],t[0])&&this._longitudeCyclical.contains(e[0],e[2],t[2])&&t[1]>e[1]&&t[3]<e[3]:nZ(e,t))}_pointIsInExtent(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];const r=e.x,i=e.y;return r>t[0]&&r<t[2]&&i>t[1]&&i<t[3]}_shiftExtentToFitBounds(e,t,r){let i=0,s=0;e[0]<-t?i=e[0]+t:e[2]>t&&(i=t-e[2]),e[1]<-r?s=e[1]+r:e[3]>r&&(s=r-e[3]),B$(e,i,s)}get test(){return{renderer:this.renderer,update:()=>this.runTask(_a)}}};function Wtt(e,t){const i=Kr.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(e[2]-e[0],e[3]-e[1],t[2]-t[0],t[3]-t[1]);return Math.abs(t[0]-e[0])<=i&&Math.abs(t[1]-e[1])<=i&&Math.abs(t[2]-e[2])<=i&&Math.abs(t[3]-e[3])<=i}h([f()],aa.prototype,"_spatialReference",void 0),h([f({readOnly:!0})],aa.prototype,"running",null),h([f()],aa.prototype,"_placementDirty",void 0),h([f()],aa.prototype,"_contentUpdated",void 0),h([f()],aa.prototype,"_isSpherical",null),h([f()],aa.prototype,"_worldToPCSRatio",null),h([f({autoDestroy:!0})],aa.prototype,"renderer",void 0),h([f({constructOnly:!0})],aa.prototype,"view",void 0),h([f({constructOnly:!0})],aa.prototype,"surface",void 0),h([f()],aa.prototype,"suspended",null),h([f()],aa.prototype,"updating",null),h([f({type:Boolean})],aa.prototype,"hasHighlights",null),h([f({type:Boolean})],aa.prototype,"rendersOccluded",null),aa=h([F("esri.views.3d.terrain.OverlayManager")],aa);const S_=Ht(),NP=C(),Rf={inner:Nt(),outer:Nt(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},qtt=Nt(),Xtt=Nt(),Ztt=Dn();var _p;(function(e){e[e.NONE=0]="NONE",e[e.EXTENT=1]="EXTENT",e[e.RERENDER_ONLY=2]="RERENDER_ONLY"})(_p||(_p={}));class u3{constructor(t,r){this._factoryCallback=t,this._lengthCallback=r,this._pool=new Map}acquire(t){if(!u3.test.disabled){const r=this._pool.get(t);if(r&&r.length!==0)return r.pop()}try{return this._factoryCallback(t)}catch(r){const i=window.performance&&window.performance.memory;let s="";throw i&&(s=`
  totalJSHeapSize: ${i.totalJSHeapSize}, usedJSHeapSize: ${i.usedJSHeapSize}, jsHeapSizeLimit: ${i.jsHeapSizeLimit}`),console.log("Array allocation of size "+t+" failed: "+r+s),r}}release(t){if(u3.test.disabled)return;const r=this._lengthCallback(t);let i=this._pool.get(r);i||(i=new Mt({shrink:!0}),this._pool.set(r,i)),i.push(t)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}}u3.test={disabled:!1};class Ytt{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=mi(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}}class rre{constructor(t,r,i,s,n){this.attributes=t,this.localOrigin=r,this.index0=i,this.stride=s,this.count=n}getVertexIndex(t){return this.getAttributeIndex(t)}getAttributeIndex(t){return we(0<=t&&t<this.count),this.index0+this.stride*t}_getVertexRaw(t,r){this.attributes.position.getVec(t,r)}getVertexPos(t,r){this._getVertexRaw(this.getAttributeIndex(r),t),oe(t,t,this.localOrigin)}getNormal(t,r){const{typedBuffer:i,typedBufferStride:s}=this.attributes.normalCompressed;$We(t,i,this.getAttributeIndex(r),s)}_setNormal(t,r,i,s){const{typedBuffer:n,typedBufferStride:o}=this.attributes.normalCompressed;z1(n,t,r,i,s,o)}_setUV(t,r,i){fd(this.attributes.uv0,t,r,i)}setNormalFromValues(t,r,i,s){this._setNormal(this.getAttributeIndex(t),r,i,s)}setVertexFromValuesRawPositionUV(t,r,i,s,n,o){const a=this.getAttributeIndex(t);this.attributes.position.setValues(a,r,i,s),this._setUV(a,n,o)}setVertexFromValuesRawPositionUVNormal(t,r,i,s,n,o,a,l,c){const u=this.getAttributeIndex(t);this.attributes.position.setValues(u,r,i,s),this._setUV(u,n,o),this._setNormal(u,a,l,c)}}const Jtt=Li().vec3f(E.POSITION).vec2i16(E.UV0).vec2i16(E.NORMALCOMPRESSED,{glNormalized:!0}),OW=new u3(e=>Jtt.createBuffer(e),e=>e.count);function Ktt(){OW.clear()}function Nve(e){return OW.acquire(e)}function Qtt(e){OW.release(e.vertexAttributes),e.vertexAttributes=null,e.indices=null}const ire=16384;function fd(e,t,r,i){e.setValues(t,r*ire,i*ire)}function ju(e,t,r,i){e<i[0]?i[0]=e:e>i[3]&&(i[3]=e),t<i[1]?i[1]=t:t>i[4]&&(i[4]=t),r<i[2]?i[2]=r:r>i[5]&&(i[5]=r)}class ert{constructor(){this.sinLonLUT=new Array(gE+1),this.cosLonLUT=new Array(gE+1),this.sinLatLUT=new Array(gE+1),this.cosLatLUT=new Array(gE+1)}update(t,r,i){const s=r[0],n=r[2];for(let o=0;o<=t;o++){const a=o/t,l=s*(1-a)+n*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=i(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}}class FP{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}}class trt{constructor(){this.cornerNeighborData=[new FP,new FP,new FP,new FP],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}}class rrt{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new trt}}class jx{constructor(t){this._getFadeDuration=t,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Re(this._current),this._next=Re(this._next),this._waiting=Re(this._waiting),this._delayed=Re(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const r=this._delayed||this._waiting||this._next||this._current;r!==this._current&&(this._current=null,this.clear(),this._current=r)}let t=jx.test.fadeMoment;if(this._delayed!=null&&(t=t||performance.now(),t>=this._delayedTime&&(this._push(this._delayed,Em.Immediate),this._delayed=null)),this._next!=null){t=t||performance.now();const r=this._fadeDuration,i=this._current!=null&&this._next.texture===this._current.texture,s=this._next.type!==js.FADING,n=t-this._fadeStart>=r;(i||s||n)&&(Re(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(t))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const t=jx.test.fadeMoment||performance.now(),r=Math.max(0,t-this._fadeStart),i=this._fadeDuration;return r>i?0:1-r/i}get isFading(){return this._next!=null||this._delayed!=null}push(t,r=Em.Immediate){this._delayed=Re(this._delayed),this._push(t,r)}_push(t,r){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=t);const i=jx.test.fadeMoment||performance.now();return r!==Em.Immediate?(this._delayed=t,void(this._delayedTime=i+r)):this._next==null?(this._next=t,void(this._fadeStart=this._alignFadeStart(i))):void(t!=null&&(Re(this._waiting),this._waiting=t))}get _fadeDuration(){return this._waiting==null?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(t){const r=this._getFadeDuration();return t+r-t%r}get _isFadingEnabled(){return this._getFadeDuration()>0}}var Em;jx.test={fadeMoment:0},function(e){e[e.Immediate=0]="Immediate",e[e.Delayed=5e3]="Delayed"}(Em||(Em={}));var JT;(function(e){e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT",e[e.NONE=0]="NONE",e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(JT||(JT={}));class Fve{constructor(){this._queue=new Mt,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(t){this._queue.clear(),this._queue.push(t),this._last=void 0}reset(t=null){this._queue.clear(),t!=null&&this._queue.pushArray(t),this._last=void 0}skipSubtree(){this._last=void 0}next(){const t=this._last?.children;return t&&t[0]&&this._queue.pushArray(t),this._last=this._queue.pop(),this._last}}class irt{constructor(){this._q=new Mt}get done(){return this._q.length===0}reset(t){if(this._q.clear(),t!=null){this._q.pushArray(t);for(let r=0;r<this._q.length;++r){const i=this._q.data[r];i.isLeaf||this._q.pushArray(i.children)}}}next(){return this._q.pop()}}function qC(e,t,r){if(t==null||t.fullExtent==null)return!1;const i=t.fullExtent,s=e.extent;if(r){if(s[0]<i.xmin||s[1]<i.ymin||s[2]>i.xmax||s[3]>i.ymax)return!1}else if(i.xmin>s[2]||i.ymin>s[3]||i.xmax<s[0]||i.ymax<s[1])return!1;const n=e.surface.tilingScheme.levels[e.level].scale,o=t.minScale;if(o>0&&n>1.00000001*o)return!1;const a=t.maxScale;return!(a>0&&n<.99999999*a)}function Cm(e,t){const r=e.lij,i=t.lij;return r[0]-i[0]||r[1]-i[1]||r[2]-i[2]}function Uve(e,t,r=null){r==null||r.length===0?e===JT.BACK_TO_FRONT?t.sort(srt):t.sort(nrt):t.sort((i,s)=>ort(i,s,e,r))}function srt(e,t){const r=t.screenDepth-e.screenDepth;if(r!==0)return r;const i=e.lij,s=t.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function nrt(e,t){const r=e.screenDepth-t.screenDepth;if(r!==0)return r;const i=e.lij,s=t.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function kve(e,t,r){const i=e.screenDepth,s=t.screenDepth;return i<s?-r:i>s?r:Cm(e,t)}function ort(e,t,r,i){return sre(e,i)===sre(t,i)?kve(e,t,r):e?r:-r}function sre(e,t){for(const r of t)if(e.intersectsExtent(r))return!0;return!1}function art(e,t){const r=e.distanceToPOI-t.distanceToPOI;if(r!==0)return r;const i=e.lij,s=t.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function lrt(e,t){const r=e.length;for(let i=0;i<r;++i)e.at(i).updateDistanceToPOI(t);e.sort(art)}function crt(e,t,r){let i=1,s=0,n=0;for(;e!==t;)if(i*=.5,s*=.5,n*=.5,1&e.lij[2]&&(s+=.5),(1&e.lij[1])==0&&(n+=.5),(e=e.parent)==null)throw new Error("tile was not a descendant of upsampleTile");r.init(t,s,n,i)}function urt(e){for(let t=0;t<e.length;t++){const r=e[t],i=r.parent;if(i)for(let s=0;s<4;s++){const n=i.children[s];if(n&&n!==r)return!0}}return!1}function egt(e,t){if(!e||!t||e[0]===t[0])return!1;const r=e[0]<t[0],i=r?e:t,s=r?t:e,n=1<<s[0]-i[0];return Math.floor(s[1]/n)===i[1]&&Math.floor(s[2]/n)===i[2]}class RW{get updating(){return!!this._tileRequested}init(t,r,i,s){this.tile=t,this._layerIdx=r,this._layerClass=i,this._suspended=s,this._tileLayerInfo=t.getLayerInfo(r,i),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(t){t!==this._suspended&&(this._suspended=t,t?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const t=this._findAncestorWithData();return this._setUpsampleTile(t),this._requestNext()}dataArrived(t,r){this._setUpsampleTile(t,r),this._tileRequested=null,t===this.tile?this.tile.updateRenderData(this._layerClass,js.FADING,r):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const t=this._findNextDownload();if(this._tileRequested){if(t===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return t!=null?t.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=t):this._agentDone(),!!this._tileRequested}_findNextDownload(){const t=this._layerIdx,r=this._layerClass,i=this.tile.surface.layerViewByIndex(t,r),s=SB(i),{minLevel:n,maxLevel:o}=i.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?qC:()=>!0;let u=this.tile;const d=u.level;let p;const g=this._tileLayerInfo.upsampleInfo,y=g!=null?g.tile.level:-1,_=g!=null&&y-d>=a,v=s?.tilemapCache,w=i.type==="vector-tile-3d"?i.schemaHelper:null;for(;u&&c(u,s,!1)&&u.level>=n;){const T=u.level,x=d-T,S=u.layerInfo[r][t];if(S.data&&x>=a){(!_||T>y)&&this._setUpsampleTile(u),S.dataInvalidated&&(p=u);break}const O=w?.getLevelRowColumn(u.lij)??u.lij;if(v?.getAvailability(O[0],O[1],u.lij[2])!=="unavailable"&&T<=o&&!S.data&&!S.dataMissing&&((!p||u.level===n||T%ope==0||d-p.level<a)&&(p=u),x>=l))break;u=u.parent}if(p!=null&&d-p.level<a)if(g)p=null;else{const T=this._findAncestorWithData();T!=null&&(this._setUpsampleTile(T),p=T.layerInfo[r][t].dataInvalidated?T:null)}return p}_findAncestorWithData(){const t=this.tile.elevationLevel,r=this._desiredMinLevelDelta;let i;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(t-s.level>=r)return s;i=s}return i}_setUpsampleTile(t,r){this._tileLayerInfo.setUpsampleInfo(this.tile,t),this.tile.updateRenderData(this._layerClass,js.FADING,r)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}class hrt extends RW{get _desiredMinLevelDelta(){throw nre}get _progressiveLevelModulo(){throw nre}dispose(){}}const nre=new Error("Abstract method called on TileAgent"),ll=new hrt;class zve extends RW{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return Xk(this.tile.level)-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}class Bve extends RW{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return ope}}var Kv,G1;(function(e){e[e.Stretch=0]="Stretch",e[e.Lut=1]="Lut",e[e.Hillshade=2]="Hillshade",e[e.COUNT=3]="COUNT"})(Kv||(Kv={})),function(e){e[e.Noop=0]="Noop",e[e.PerBand=1]="PerBand",e[e.COUNT=2]="COUNT"}(G1||(G1={}));function drt(e){e.fragment.uniforms.add(new qe("u_colormap",t=>t.u_colormap),new Ae("u_colormapOffset",t=>t.colormap.u_colormapOffset),new Ae("u_colormapMaxIndex",t=>t.colormap.u_colormapMaxIndex),new Ae("u_opacity",t=>t.common.u_opacity)),e.fragment.code.add(b`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function prt(e){e.fragment.uniforms.add(new qe("u_transformGrid",t=>t.u_transformGrid),new yr("u_transformSpacing",t=>t.common.u_transformSpacing),new yr("u_targetImageSize",t=>t.common.u_targetImageSize)),e.fragment.code.add(b`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}class Vve extends Wr{constructor(){super(...arguments),this.scale=1,this.offset=vd}}function Gve(e){e.attributes.add(E.POSITION,"vec2"),e.attributes.add(E.UV0,"vec2"),e.vertex.uniforms.add(new Ae("scale",t=>t.scale)),e.vertex.uniforms.add(new yr("offset",t=>t.offset)),e.varyings.add("uv","vec2"),e.varyings.add("vuv","vec2"),e.vertex.code.add(b`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}class frt extends Vve{constructor(t,r,i){super(),this.common=t,this.u_image=r,this.u_transformGrid=i}}function mrt(e,t){e.include(prt),e.fragment.uniforms.add(new qe("u_image",i=>i.u_image),new Bp("u_flipY",i=>i.common.u_flipY),new Bp("u_applyTransform",i=>i.common.u_applyTransform));const{requireBilinearWithNN:r}=t;r&&e.fragment.uniforms.add(new yr("u_srcImageSize",i=>i.common.u_srcImageSize)),e.fragment.code.add(b`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),r?e.fragment.code.add(b`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):e.fragment.code.add(b`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}var Oe;(function(e){e[e.Normal=0]="Normal",e[e.Average=1]="Average",e[e.Lighten=2]="Lighten",e[e.Lighter=3]="Lighter",e[e.Plus=4]="Plus",e[e.Screen=5]="Screen",e[e.ColorDodge=6]="ColorDodge",e[e.Darken=7]="Darken",e[e.Multiply=8]="Multiply",e[e.ColorBurn=9]="ColorBurn",e[e.Overlay=10]="Overlay",e[e.SoftLight=11]="SoftLight",e[e.HardLight=12]="HardLight",e[e.VividLight=13]="VividLight",e[e.Hue=14]="Hue",e[e.Saturation=15]="Saturation",e[e.Luminosity=16]="Luminosity",e[e.Color=17]="Color",e[e.DestinationOver=18]="DestinationOver",e[e.DestinationAtop=19]="DestinationAtop",e[e.DestinationIn=20]="DestinationIn",e[e.DestinationOut=21]="DestinationOut",e[e.SourceAtop=22]="SourceAtop",e[e.SourceIn=23]="SourceIn",e[e.SourceOut=24]="SourceOut",e[e.Xor=25]="Xor",e[e.Difference=26]="Difference",e[e.Exclusion=27]="Exclusion",e[e.Minus=28]="Minus",e[e.Invert=29]="Invert",e[e.Reflect=30]="Reflect",e[e.COUNT=31]="COUNT"})(Oe||(Oe={}));const RB={normal:Oe.Normal,average:Oe.Average,lighten:Oe.Lighten,lighter:Oe.Lighter,screen:Oe.Screen,plus:Oe.Plus,"color-dodge":Oe.ColorDodge,darken:Oe.Darken,multiply:Oe.Multiply,"color-burn":Oe.ColorBurn,overlay:Oe.Overlay,"soft-light":Oe.SoftLight,"hard-light":Oe.HardLight,"vivid-light":Oe.VividLight,hue:Oe.Hue,saturation:Oe.Saturation,luminosity:Oe.Luminosity,color:Oe.Color,difference:Oe.Difference,exclusion:Oe.Exclusion,minus:Oe.Minus,invert:Oe.Invert,reflect:Oe.Reflect,"destination-over":Oe.DestinationOver,"destination-atop":Oe.DestinationAtop,"destination-in":Oe.DestinationIn,"destination-out":Oe.DestinationOut,"source-atop":Oe.SourceAtop,"source-in":Oe.SourceIn,"source-out":Oe.SourceOut,xor:Oe.Xor};function grt(e){return e===Oe.DestinationOver||e===Oe.DestinationAtop||e===Oe.DestinationIn||e===Oe.DestinationOut||e===Oe.SourceAtop||e===Oe.SourceIn||e===Oe.SourceOut||e===Oe.Xor}function PW(e){e.code.add(b`
    float lineFactorAtPosition(float value) {
      float pos = value * ${b.float(257)};
      if(pos < 0.5 || pos > ${b.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function yrt(e,t){const r=t.blendMode;r!==Oe.Normal&&(r===Oe.Reflect&&e.code.add(b`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),r!==Oe.ColorDodge&&r!==Oe.VividLight||e.code.add(b`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),r!==Oe.ColorBurn&&r!==Oe.VividLight||e.code.add(b`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),r===Oe.Overlay&&e.code.add(b`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),r===Oe.HardLight&&e.code.add(b`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),r===Oe.SoftLight&&e.code.add(b`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),r===Oe.VividLight&&e.code.add(b`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),r!==Oe.Hue&&r!==Oe.Saturation&&r!==Oe.Color&&r!==Oe.Luminosity||(e.code.add(b`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),r!==Oe.Hue&&r!==Oe.Saturation||e.code.add(b`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),e.code.add(b`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${r===Oe.Multiply?b`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Oe.Average?b`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Oe.Lighten?b`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Oe.Darken?b`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Oe.Lighter?b`return vec4(cl * ol + cb * ob, ol + ob);`:r===Oe.Plus?b`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:r===Oe.Minus?b`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:r===Oe.Screen?b`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Oe.Difference?b`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Oe.Invert?b`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Oe.DestinationOver?b`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:r===Oe.DestinationAtop?b`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:r===Oe.DestinationOut?b`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:r===Oe.SourceAtop?b`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Oe.SourceOut?b`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:r===Oe.Xor?b`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:r===Oe.DestinationIn?b`return vec4(cb * ob * ol, ol * ob);`:r===Oe.SourceIn?b`return vec4(cl * ol * ob, ol * ob);`:r===Oe.Hue?b`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Oe.Saturation?b`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Oe.Color?b`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Oe.Luminosity?b`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Oe.Exclusion?b`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Oe.Reflect?b`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Oe.ColorDodge?b`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Oe.ColorBurn?b`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Oe.Overlay?b`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Oe.SoftLight?b`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Oe.HardLight?b`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Oe.VividLight?b`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:b``}
    }
  `))}var dn,ad,qh;(function(e){e[e.Composite=0]="Composite",e[e.ColorComposite=1]="ColorComposite",e[e.GridComposite=2]="GridComposite",e[e.GroupBackgroundComposite=3]="GroupBackgroundComposite",e[e.COUNT=4]="COUNT"})(dn||(dn={})),function(e){e[e.NotRequired=0]="NotRequired",e[e.Required=1]="Required",e[e.COUNT=2]="COUNT"}(ad||(ad={})),function(e){e[e.Off=0]="Off",e[e.On=1]="On",e[e.COUNT=2]="COUNT"}(qh||(qh={}));function jve(e,t){const r=t.output===dn.GridComposite,i=t.output===dn.ColorComposite,s=t.output===dn.GroupBackgroundComposite,n=t.output===dn.Composite;r&&e.fragment.include(PW),i&&e.fragment.uniforms.add(new Rt("backgroundColor",c=>c.backgroundColor));const o=t.baseOpacityMode===ad.Required;o&&e.fragment.uniforms.add(new Ae("baseOpacity",c=>c.baseOpacity)),n&&e.fragment.uniforms.add(new qe("fboColor",c=>c.fboTexture));const a=t.blendMode!==Oe.Normal,l=t.premultipliedSource===qh.On;e.fragment.include(yrt,t),e.fragment.code.add(b`
    vec4 getBackground(vec2 uv) {
      return ${o?b`baseOpacity *`:""} ${s?b`vec4(0.0, 0.0, 0.0, 0.0)`:i?b`vec4(backgroundColor, 1.0)`:r?b`vec4(gridColor(uv), 1.0)`:b`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${a?b`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:b`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(n&&!o||s)?b`colorLayer * opacity;`:b`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}class i5 extends frt{constructor(t,r,i,s,n,o){super(t,s,n),this.colormap=r,this.symbolizer=i,this.u_colormap=o,this.backgroundColor=wa,this.fboTexture=null,this.baseOpacity=1}}class _rt extends i5{}class vrt extends i5{}function brt(e){const t=new pr;return t.include(Gve),t.include(mrt,e),t.include(drt,e),t.include(jve,e),t.fragment.code.add(b`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),e.colorizerType===Kv.Stretch?xrt(t,e):e.colorizerType===Kv.Lut?wrt(t):e.colorizerType===Kv.Hillshade&&Trt(t,e),t}function wrt(e){e.fragment.code.add(b`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function xrt(e,t){e.fragment.uniforms.add(new oO("u_bandCount",i=>i.symbolizer.u_bandCount),new Wa("u_minCutOff",i=>i.symbolizer.u_minCutOff,3),new Wa("u_maxCutOff",i=>i.symbolizer.u_maxCutOff,3),new Wa("u_factor",i=>i.symbolizer.u_factor,3),new Ae("u_minOutput",i=>i.symbolizer.u_minOutput),new Ae("u_maxOutput",i=>i.symbolizer.u_maxOutput),new Bp("u_useGamma",i=>i.symbolizer.u_useGamma),new Wa("u_gamma",i=>i.symbolizer.u_gamma,3),new Wa("u_gammaCorrection",i=>i.symbolizer.u_gammaCorrection,3),new Ae("u_opacity",i=>i.common.u_opacity)),e.fragment.code.add(b`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const r=t.applyColormap?b`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:b`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;e.fragment.code.add(b`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${t.stretchType===G1.Noop?b`
        fragColor = applyBackgroundBlend(currentPixel);`:b`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${r}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function Trt(e,t){const r=e.fragment;r.uniforms.add(new qe("u_image",s=>s.u_image),new oO("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new Wa("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new Wa("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new Wa("u_cosZs",s=>s.symbolizer.u_cosZs,6),new Wa("u_weights",s=>s.symbolizer.u_weights,6),new yr("u_factor",s=>s.symbolizer.u_factor),new Ae("u_minValue",s=>s.symbolizer.u_minValue),new Ae("u_maxValue",s=>s.symbolizer.u_maxValue),new yr("u_srcImageSize",s=>s.common.u_srcImageSize)),r.include(df),r.code.add(b`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),r.code.add(b`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const i=t.applyColormap?b`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:b`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;r.code.add(b`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${i}
    }
  `)}const Srt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:vrt,ColorizerStretchUniforms:_rt,ColorizerUniforms:i5,build:brt},Symbol.toStringTag,{value:"Module"}));function Ert(e,t,r="nearest",i=!1){const s=!(i&&t.pixelType==="u8"),n=s?Is.FLOAT:Is.UNSIGNED_BYTE,o=t.pixels==null||t.pixels.length===0?null:s?t.getAsRGBAFloat():t.getAsRGBA(),a=e.capabilities.textureFloat?.textureFloatLinear,l=new hr;return l.width=t.width,l.height=t.height,l.internalFormat=e.type===tr.WEBGL2&&s?He.RGBA32F:vt.RGBA,l.samplingMode=!a||r!=="bilinear"&&r!=="cubic"?xt.NEAREST:xt.LINEAR,l.dataType=n,l.wrapMode=Ct.CLAMP_TO_EDGE,new wt(e,l,o)}function Crt(e,t){const{spacing:r,offsets:i,coefficients:s,size:[n,o]}=t,a=r[0]>1,l=new hr;l.width=a?4*n:n,l.height=o,l.internalFormat=e.type===tr.WEBGL2?He.RGBA32F:vt.RGBA,l.dataType=Is.FLOAT,l.samplingMode=xt.NEAREST,l.wrapMode=Ct.CLAMP_TO_EDGE;const c=new Float32Array(a?n*o*16:2*i.length);if(a&&s!=null)for(let u=0,d=0;u<s.length;u++)c[d++]=s[u],u%3==2&&(c[d++]=1);else for(let u=0;u<o;u++)for(let d=0;d<n;d++){const p=4*(u*n+d),g=2*(d*o+u);c[p]=i[g],c[p+1]=i[g+1],c[p+3]=i[g]===-1?0:1}return new wt(e,l,c)}function ore(e,t){const r=new hr;return r.internalFormat=vt.RGBA,r.width=t.length/4,r.height=1,r.samplingMode=xt.NEAREST,r.wrapMode=Ct.CLAMP_TO_EDGE,new wt(e,r,t)}function Art(e,t,r,i=1,s=!0){return{u_flipY:s,u_applyTransform:!!e,u_opacity:i,u_transformSpacing:e?e.spacing:vd,u_transformGridSize:e?e.size:vd,u_targetImageSize:t,u_srcImageSize:r}}function Ort(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:0}}function Rrt(e){return{u_bandCount:e.bandCount,u_minOutput:e.outMin,u_maxOutput:e.outMax,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}}function Prt(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}}const are={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class Mrt{constructor(t,r,i=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=t,this.source=r,this.width=i||r.width,this.height=s||r.height}get source(){return this._source}set source(t){this._source=t,this._rasterTexture=De(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...are,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||are}set symbolizerParameters(t){this._symbolizerParameters=t}get bandIds(){return this._bandIds}set bandIds(t){t!=null&&t.length>0?this._bandIds&&t.every((r,i)=>!!this._bandIds?.[i]&&r===this._bandIds[i])||(this._bandIds=t,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(t){if(this._interpolation=t,this._rasterTexture!=null){const r=this._getRasterTextureInterpolation(t);this._rasterTexture.setSamplingMode(r==="bilinear"?xt.LINEAR:xt.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(t){this._transformGrid=t,this._transformGridTexture=De(this._transformGridTexture),this._memoryUsed=null}bind(t){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((this._rasterTexture==null||this._dirty)&&this._updateRasterTexture(t,this.bandIds),this._rasterTexture!=null&&(this._updateColormapTexture(t),this.transformGrid&&this._transformGridTexture==null&&(this._transformGridTexture=Crt(t,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:t,transformGrid:r,width:i,height:s,opacity:n}=this,o=Art(r,[i,s],[this.source.width,this.source.height],n),a=Ort(t.colormap,t.colormapOffset),l=this.symbolizerParameters.type==="stretch"?Rrt(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?Prt(this.symbolizerParameters):null;return new i5(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get isBilinearWithStretchColorRamp(){const{symbolizerParameters:t}=this;return this.interpolation==="bilinear"&&t.colormap!=null&&t.type==="stretch"}get memoryUsage(){if(this._memoryUsed==null){const t=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=t.map(r=>r!=null?r.descriptor.width*r.descriptor.height*4:0).reduce((r,i)=>r+i,0)}return this._memoryUsed}release(){return this._rasterTexture=De(this._rasterTexture),this._transformGridTexture=De(this._transformGridTexture),this._colormapTexture=De(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(t,r){const i=this.source?this.source.extractBands(r):null;if(!(i&&i.pixels&&i.pixels.length>0))return void(this._rasterTexture=De(this._rasterTexture));const s=r==null&&this.bandIds==null||r!=null&&this.bandIds!=null&&r.join("")===this.bandIds.join("");if(this._rasterTexture!=null&&s)return;this._rasterTexture=De(this._rasterTexture);const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=Ert(t,i,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(t){return this.symbolizerParameters.type==="lut"||t==="nearest"||t==="majority"||this.isBilinearWithStretchColorRamp?"nearest":"bilinear"}_updateColormapTexture(t){const r=this._colormap,i=this.symbolizerParameters.colormap;return i?r?i.length!==r.length||i.some((s,n)=>s!==r[n])?(this._colormapTexture=De(this._colormapTexture),this._colormapTexture=ore(t,i),void(this._colormap=i)):void 0:(this._colormapTexture=ore(t,i),void(this._colormap=i)):(this._colormapTexture=De(this._colormapTexture),void(this._colormap=null))}}class AI{constructor(){this.waitingAgents=new Mt,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(t){const r=AU.acquire();return r._init(t),r}release(){this.dispose(),OI.delete(this),AU.release(this)}dispose(){this.loadingAgent=De(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=Gx(this._data)}static prune(){AU.prune(0)}_init(t){this.waitingAgents.clear(),this._data=Gx(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=t,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=$c(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo!=null&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(t,r){if(t!==r&&r!=null){if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===r)return;this._upsampleInfo.tile.unrefMapData()}r.refMapData(),crt(t,r,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(t){Gx(this._data),this._data=t}}const AU=new fn(AI,null,()=>{}),OI=new Map;function Irt(){OI.size>0&&(console.log(`${OI.size} live TilePerLayerInfo allocations:`),OI.forEach(e=>console.log(e,`
`)))}class jw{constructor(t){this._texture=t,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get gpuMemoryUsage(){return this._texture.gpuMemoryUsage}}var dt;(function(e){e[e.NONE=0]="NONE",e[e.SPLIT=1]="SPLIT",e[e.ELEVATION=2]="ELEVATION",e[e.MERGE=4]="MERGE",e[e.RENDERDATA=8]="RENDERDATA",e[e.GEOMETRY=16]="GEOMETRY",e[e.TEXTURE_NOFADING=32]="TEXTURE_NOFADING",e[e.TEXTURE_FADING=64]="TEXTURE_FADING"})(dt||(dt={}));const $rt=.1;class MW{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=Nt(),this._elevationBounds=Ne(),this.layerInfo=[[],[]],this.extentInRadians=Nt(),this.centerAtSeaLevel=C(),this._center=[C(),ls(),C()],this.up=EV(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=C()}static prune(){IW.prune(0),$W.prune(0),AI.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Rs.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const t=this.parent,r=t?.frustumVisibility??Uo.INTERSECTS;this._frustumVisibility=r===Uo.INSIDE?Uo.INSIDE:r===Uo.OUTSIDE?Uo.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const i=this._frustumVisibility!==Uo.OUTSIDE&&this._intersectsClippingArea;i!==this._visible&&(this._visible=i,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const t=!!this.renderData;return t!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=t,this._surface.renderer.setDirty()),t}get shouldLoad(){return this.isLeaf}init(t,r,i){this.lij[0]=t[0],this.lij[1]=t[1],this.lij[2]=t[2],this.ellipsoid=Mr(i.tilingScheme.spatialReference),i.tilingScheme.getExtent(t[0],t[1],t[2],this.extent),i.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,i.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Rs.MIDDLE][3]=0,this.elevationLevel=t?t[0]:0,r&&r.elevationBounds?en(this._elevationBounds,r.elevationBounds):Qt(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=r,this.unsetChildren(),this._surface=i,this.updateVisibility();for(const s of rv){const n=i.numLayers(s),o=this.layerInfo[s];for(const a of o)a.release();o.length=n;for(let a=0;a<n;a++)o[a]=AI.acquire(this._surface.upsampleInfoPool),s===jt.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(i.tilingScheme.pixelSize,gE)}release(){wp(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const t of rv){for(const r of this.layerInfo[t])r.release();this.layerInfo[t].length=0}this._parent=null;for(let t=0;t<4;++t)this._children[t]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const t=this._cachedMemory;t>0&&this._surface.upsampleMapCache.put(this.key,this,t)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[jt.MAP].reduce((t,r)=>t+(r instanceof WC?r.memoryUsed/r.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const r=this._surface.tilingScheme.pixelSize;return r*r*4}_ensureUsedMemory(){if(this._usedMemory!=null)return this._usedMemory;this._usedMemory=0,this._mapTileMemoryInternal=0;let t=0;for(const{data:i}of this.layerInfo[jt.MAP])i instanceof WC?t+=this._getTerrainDataMemory(i):this._mapTileMemoryInternal+=this._getTerrainDataMemory(i);const r=this._cpuImageMemorySize;for(const i of this.layerInfo[jt.ELEVATION])this._usedMemory+=i.data?r:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=this.renderData.texture?.gpuMemoryUsage??0),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+t),this._usedMemory}getUsedMemoryForLayer(t,r){const i=this.layerInfo[t][r];return i?.data?t===jt.MAP?this._isCached?0:this._getTerrainDataMemory(i.data):t===jt.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(t){return t instanceof jw?t.texture.gpuMemoryUsage:t instanceof HTMLImageElement||t instanceof Q4?this._cpuImageMemorySize:t instanceof Mrt?t.memoryUsage:t instanceof WC?t.memoryUsed/t.referenced:0}updateScreenDepth(t){const r=this._center[Rs.MIDDLE],i=t,s=r[0],n=r[1],o=r[2],a=i[2]*s+i[6]*n+i[10]*o+i[14];this.screenDepth=a<0?0:a/(i[3]*s+i[7]*n+i[11]*o+i[15])}shouldSplit(t,r,i){if(!this.visible||t.frustum!=null&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(t.frustum)===Uo.OUTSIDE))return dt.NONE;const s=this.level;ce(kP,this._center[Rs.MIDDLE],r);let n=Bo(kP),o=kP,a=Rs.MIDDLE;ce(OU,this._center[Rs.TOP],r);const l=Bo(OU);l<n&&(n=l,o=OU,a=Rs.TOP),ce(RU,this._center[Rs.BOTTOM],r);const c=Bo(RU);if(c<n&&(n=c,o=RU,a=Rs.BOTTOM),this._edgeLen2>n&&s<t.maxLod)return dt.SPLIT;const u=i!=null?i-s:1/0,d=Math.sqrt(n),p=t.fovX*d*2,g=this._edgeLen/p,y=()=>{if(s<t.maxLod)return this.elevationLevel=s,dt.NONE;const $=s+Math.ceil(-Math.log2(t.relativeWidthLimit/g));return $!==this.elevationLevel?(this.elevationLevel=$,dt.ELEVATION):dt.NONE};if(u<=.5)return y();const _=de(this.up,kP),v=this._elevationBounds[1]-this._elevationBounds[0],w=v/this.edgeLen;if(t.aboveGround&&_>0&&w<.001&&_/d-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-w>0)return dt.NONE;const T=i!=null?3-Math.min(u,2):1;if(g*T<t.relativeWidthLimit||s>=t.maxLod)return y();if(s<7)return dt.SPLIT;te(Hn,this.up,_),ce(Hn,Hn,o);const x=Bo(Hn);if(x<=this.radius*this.radius)return dt.SPLIT;te(Hn,Hn,this.radius/Math.sqrt(x)),oe(Hn,Hn,this._center[a]),ce(Hn,r,Hn);const S=Math.min(1,(Math.abs(de(Hn,this.up))+.5*v+this._curvatureHeight)/Se(Hn)),O=$rt/t.angledSplitBias,A=t.fovY*d*2;return S*(this._edgeLen/A*T)<O*t.relativeHeightLimit?dt.NONE:dt.SPLIT}setChildren(t,r,i,s){wp(!!(t&&r&&i&&s),"Null child passed"),this._children[0]=t,this._children[1]=r,this._children[2]=i,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){return this.renderData?.hasGeometry??!1}load(){this.refMapData();for(const t of rv)this._createOrUpdateAgents(0,t);this.surface.renderer.loadTile(this)}unload(t){t.unloadTile(this);for(const r of rv){const i=this.layerInfo[r];for(const s of i)s.loadingAgent&&s.loadingAgent!==ll&&(UP(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(dt.GEOMETRY),this.resetPendingUpdate(dt.TEXTURE_NOFADING),this.resetPendingUpdate(dt.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const t=this.layerInfo[jt.MAP];for(const r of t)r.loadingAgent&&r.loadingAgent!==ll&&(UP(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(t){if(kv(t,this._clippingArea))return!1;const r=this._intersectsClippingArea,i=this._isWithinClippingArea;t!=null?(this._intersectsClippingArea=this.intersectsExtent(t),this._isWithinClippingArea=this._isWithinExtent(t)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=t,this.updateVisibility();const s=i&&this._isWithinClippingArea,n=!(i||r||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(dt.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(t,r){return this.layerInfo[r][t]}hasLayerData(t,r){const i=this.layerInfo[r][t];return!(!i||!i.data||i.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const t of rv){const r=this.layerInfo[t];for(const i of r)if(i.loadingAgent&&i.loadingAgent!==ll&&i.loadingAgent.updating)return!0}return!1}_isSuspended(t){return!!this.hasPendingUpdate(dt.SPLIT)||t!==jt.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(t){return(this._pendingUpdates&t)===t}setPendingUpdate(t){this._pendingUpdates|=t,t===dt.SPLIT||t===dt.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(t){return!!this.hasPendingUpdate(t)&&(this._pendingUpdates&=~t,!0)}requestLayerData(t,r,i){const s=this.layerInfo[r][t];if(s.waitingAgents.has(i))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,t),!0;if(s.waitingAgents.push(i),s.data&&!s.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,t);const a=s.data&&"type"in s.data&&s.data.type==="vector-tile";return i.dataArrived(this,a),!0}if(s.requestPromise)return!0;$c(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,t,r,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(t){return this.lij[0]===t[0]&&this.lij[1]===t[1]&&this.lij[2]===t[2]}findByLij(t){if(this.hasLij(t))return this;const r=this._children;return r[0]?r[0].findByLij(t)||r[1].findByLij(t)||r[2].findByLij(t)||r[3].findByLij(t):null}distanceToSquared(t){return Bo(ce(Hn,this._center[Rs.MIDDLE],t))}containsPoint(t){const r=this.extent;return t[0]>=r[0]&&t[1]>=r[1]&&t[0]<=r[2]&&t[1]<=r[3]}containsPointXY(t,r){const i=this.extent;return t>=i[0]&&r>=i[1]&&t<=i[2]&&r<=i[3]}unrequestLayerData(t,r,i){const s=this.layerInfo[r][t],n=s.waitingAgents,o=n.removeUnordered(i)!=null;wp(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(t,r,i){const s=i!=null&&"type"in i&&i.type==="vector-tile",n=this.layerInfo[r][t];n.data=i,n.dataInvalidated=!1,n.waitingAgents.forAll(o=>o.dataArrived(this,s)),n.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(t,r,i){i.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${r}/${t} error ${i}`);const s=this.layerInfo[r][t];s.dataMissing=!0,s.waitingAgents.forAll(n=>n.dataMissing()),s.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(t,r,i){switch(i&&this.forEachLoadedNeighbor(s=>s.updateRenderData(t,r)),t){case jt.MAP:return this._updateTexture(r);case jt.ELEVATION:return this._updateGeometry()}}_updateTexture(t){this.renderData&&(this.resetPendingUpdate(t===js.FADING?dt.TEXTURE_NOFADING:dt.TEXTURE_FADING),this.setPendingUpdate(t===js.FADING?dt.TEXTURE_FADING:dt.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(dt.GEOMETRY);for(const t of this.layerInfo[jt.ELEVATION])t.pendingUpdates|=dt.GEOMETRY}invalidateLayerData(t,r){this.layerInfo[r][t].invalidateSourceData(),this.restartAgents(r)}computeElevationBounds(){const t=this._elevationBounds,r=t[0],i=t[1];Qt(t,1/0,-1/0);const s=this.layerInfo[jt.ELEVATION];let n=!0;for(const o of s)o.elevationBounds!=null&&(t[0]=Math.min(t[0],o.elevationBounds.min),t[1]=Math.max(t[1],o.elevationBounds.max),o.elevationBounds.hasNoDataValues||(n=!1));n&&(t[0]=Math.min(t[0],0),t[1]=Math.max(t[1],0)),r===t[0]&&i===t[1]||(this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const t=this._elevationBounds,r=.5*(t[0]+t[1]),i=this._center;te(Hn,this.up,r),oe(i[Rs.MIDDLE],this.centerAtSeaLevel,Hn),te(Hn,this.up,t[0]),oe(i[Rs.TOP],this.centerAtSeaLevel,Hn),te(Hn,this.up,t[1]),oe(i[Rs.BOTTOM],this.centerAtSeaLevel,Hn)}findElevationBoundsForLayer(t,r){const i=this.layerInfo[jt.ELEVATION][t],s=Xk(this.level),n=Math.max(this.elevationLevel-s,0),o=i.elevationBounds;if(o!=null&&o.level>=r&&o.level<=n)return;const a=this._surface.layerViewByIndex(t,jt.ELEVATION),l=SB(a);if(!qC(this,l,!1))return;const c=Drt;let u=!1;const d=i.data;if(d&&d.level<=n){const p=i.data;c.min=p.samplerData.data.minValue,c.max=p.samplerData.data.maxValue,c.hasNoDataValues=p.samplerData.data.hasNoDataValues,c.level=this.level,u=!0}else{let p,g,y=0;for(let _=this._parent;_&&(!g||y<s)&&(y=this.elevationLevel-_.level,p=g||p,g=_.layerInfo[jt.ELEVATION][t].data,!(!g&&p&&_.level<=n));_=_.parent);g=g||p,g&&(g.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],c),c.min!==1/0&&(c.level=g.level,u=!0))}u&&(i.elevationBounds==null&&(i.elevationBounds=new _x),i.elevationBounds.copyFrom(c))}modifyLayers(t,r,i){const s=this.layerInfo[i];for(const a of s)a.loadingAgent&&a.loadingAgent!==ll&&(UP(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)t[a]===void 0&&s[a].release();const n=new Array(...s),o=r.length;s.length=o;for(let a=0;a<o;a++){const l=r[a];s[a]=l>-1?n[l]:AI.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(t){this.renderData&&(this._createOrUpdateAgents(0,t),this.updateRenderData(t,js.FADING))}updateAgents(t){if(this.renderData){const r=this.layerInfo[t];for(const i of r)i.loadingAgent===ll&&(i.loadingAgent=null);this._createOrUpdateAgents(0,t)}}updateAgentSuspension(){for(const t of rv){const r=this._isSuspended(t);for(const i of this.layerInfo[t])i.loadingAgent&&i.loadingAgent!==ll&&(i.loadingAgent.setSuspension(r),i.loadingAgent===ll&&this.updateRenderData(t,js.FADING))}}removeLayerAgent(t,r){const i=this.layerInfo[r][t];i.loadingAgent&&i.loadingAgent!==ll&&i.loadingAgent.dispose(),i.loadingAgent=null}agentDone(t,r){const i=this.layerInfo[r][t];i.loadingAgent=ll,i.data||i.upsampleInfo!=null||this._createOrUpdateAgents(t+1,r)}_hasBlendableAncestor(t){return t.blendMode!=="normal"||vT(t.parent)&&this._hasBlendableAncestor(t.parent)}_hasBlendModes(t,r,i){for(let s=t;s<r;++s){const n=this._surface.layerViewByIndex(s,i);if(lD(n)&&n?.layer?.blendMode!=="normal"||vT(n?.layer?.parent)&&this._hasBlendableAncestor(n?.layer?.parent))return!0}return!1}_createOrUpdateAgents(t,r){const i=this.layerInfo[r];if(i.length===0)return;const s=this._isSuspended(r);for(let n=t;n<i.length;++n){const o=i[n];let a=!1;const l=this._surface.layerViewByIndex(n,r),c=SB(l);if(o.loadingAgent?qC(this,c,!1)?(o.loadingAgent!==ll&&o.loadingAgent.setSuspension(s),o.loadingAgent!==ll&&(a=o.loadingAgent.update())):o.dispose():qC(this,c,!1)&&(o.loadingAgent=Lrt(this,n,r,s),a=o.loadingAgent.startLoading(),a?o.loadingAgent===ll&&this.setPendingUpdate(dt.GEOMETRY):(UP(o.loadingAgent),o.loadingAgent=ll)),o.loadingAgent===ll&&this.updateRenderData(r,js.FADING),!this._hasBlendModes(t,i.length,r)&&a&&l.isOpaque)return}}_isWithinExtent(t){const r=this.extent;return r[0]>=t[0]&&t[2]>=r[2]&&r[1]>=t[1]&&t[3]>=r[3]}intersectsExtent(t){const r=this.extent;return r[2]>=t[0]&&t[2]>=r[0]&&r[3]>=t[1]&&t[3]>=r[1]}getElevationVerticesPerSide(t){const r=this.elevationLevel-this.level,i=Math.max(this.level-t,Xk(this.level)-r),s=fe(1+(this.maxTesselation>>i),2,this.maxTesselation+1),n=this.getDefaultVerticesPerSide();return Math.max(s,n)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(t,r){if(!t)return null;const i=this.surface.rootTiles;if(i!=null){for(const s of i)if(Nrt(s,t)){let n=s,o=t[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!r(n);){const a=t[1]>>o&1,l=t[2]>>o&1;n=n.children[2*a+l],o--}return r(n)?n:null}}return null}findNeighborTile(t,r){const i=this.lij,s=this.getNeighborLIJ(i,t);return s?Frt(i,s)?r(this)?this:null:this._findLIJ(s,r):null}findCorner(t,r){const i=t===et.NORTH_EAST?1:t===et.NORTH_WEST?0:t===et.SOUTH_WEST?2:3;let s=this;for(;s.children[0]&&(!r||!r(s));)s=s.children[i];return s}findNeighborCornerTileExact(t,r){return this.findNeighborTile(t,i=>r(i)||i.level===this.level)?.findCorner(cD(t),r)||null}forAllSubtreeOnSide(t,r){const i=t===et.NORTH?[0,1]:t===et.NORTH_EAST?[1]:t===et.EAST?[1,3]:t===et.SOUTH_EAST?[3]:t===et.SOUTH?[2,3]:t===et.SOUTH_WEST?[2]:t===et.WEST?[0,2]:[0],s=n=>{const o=n.children;!r(n)&&o[0]&&i.forEach(a=>s(o[a]))};s(this)}forallNeighbors(t){l3.forEach(r=>this.findNeighborCornerTileExact(r,t)),$p.forEach(r=>this.findNeighborTile(r,i=>i.level===this.level||t(i))?.forAllSubtreeOnSide(uD(r),t))}getNeighborEdgeStartVertexIndex(t,r){if(!r)return 0;const i=this.level-r.level;if(we(!Js||i>=0),i===0)return 0;const s=2**i,n=(1&t)==1,o=n?0:1,a=r.lij[o+1]*s,l=this.lij[o+1],c=l-a,u=n?s-1-c:c;return Js&&(we(a<=l&&l<a+s),we(0<=u&&u<s)),u}forEachLoadedNeighbor(t){const r=this.level,i=s=>s.level===r||s.isLoaded;$p.forEach(s=>{const n=this.findNeighborTile(s,i);n!=null&&n!==this&&n.forAllSubtreeOnSide(uD(s),o=>!!o.isLoaded&&(t(o,s),!0))}),l3.forEach(s=>{const n=this.findNeighborTile(s,i)?.findCorner(cD(s),o=>o.isLoaded);we(!n||PB(this,n,s)),n?.isLoaded&&t(n,s)})}getNeighborLIJ(t,r){const i=Zte(r)?-1:Xte(r)?1:0,s=Wte(r)?-1:qte(r)?1:0,n=[t[0],t[1]+i,t[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(t){return!t||t[1]<0||t[1]>=2**t[0]?null:this.surface.wrapEastWest(t)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){const t=this.surface.extent,r=t?.[1]??null;return r!=null&&this.extent[1]+Ta()>=r}checkGeometryWaterproofness(){oD&&(we(this.isLoaded),this.renderData?.checkGeometryWaterproofness())}shouldHaveNeighbor(t){const r=this.extent,i=this.surface.rootTilesExtent,s=.25*(r[2]-r[0]);if(Zte(t)&&r[3]+s>=i[3]||Xte(t)&&r[1]-s<=i[1])return!1;const n=this.surface.isGlobal;return!(!n&&Wte(t)&&r[0]-s<=i[0])&&!(!n&&qte(t)&&r[2]+s>=i[2])}updateDistanceToPOI(t){const r=this._lastPOI;if(this.distanceToPOI>=0&&r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2])return;re(this._lastPOI,t);const i=this._center[Rs.MIDDLE],s=t[0]-i[0],n=t[1]-i[1],o=t[2]-i[2];this.distanceToPOI=s*s+n*n+o*o}}function Lrt(e,t,r,i){const s=r===jt.ELEVATION?$W.acquire():IW.acquire();return s.init(e,t,r,i),s}function UP(e){e.dispose(),e instanceof zve?$W.release(e):e instanceof Bve&&IW.release(e)}const IW=new fn(Bve),$W=new fn(zve),Drt=new _x;var Rs;function Nrt(e,t){const r=e.level,i=t[0];if(r>i)return!1;const s=i-r,n=Math.floor(t[1]/2**s),o=Math.floor(t[2]/2**s);return n===e.lij[1]&&o===e.lij[2]}function Frt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Urt(e,t,r){if(e==null||t==null)return!1;if(e.level===0&&t.level===0&&(e.isEastEnd&&t.isWestEnd&&r===et.EAST||e.isWestEnd&&t.isEastEnd&&r===et.WEST))return!0;const i=Math.max(1e-6*(e.extent[2]-e.extent[0]),1);switch(r){case et.NORTH:return Au(e.extent[3],t.extent[1],i);case et.SOUTH:return Au(e.extent[1],t.extent[3],i);case et.EAST:return Au(e.extent[2],t.extent[0],i)||Au(e.extent[2],-t.extent[0],i);case et.WEST:return Au(e.extent[0],t.extent[2],i)||Au(e.extent[0],-t.extent[2],i)}}function PB(e,t,r){return e!=null&&t!=null&&t!==e&&(e.level>=t.level?lre(e,t,r):lre(t,e,cD(r)))}function lre(e,t,r){we(e.level>=t.level);const i=Qet(r),s=ett(r),n=e.extent,o=t.extent,a=[i?n[0]:n[2],s?n[3]:n[1]],l=[i?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),u=Au(a[0],l[0],c)||e.surface.isGlobal&&Au(a[0],-l[0],c),d=Au(a[1],l[1],c);if(u&&d)return!0;if(e.level===t.level||!u&&!d)return we(!1),!1;const p=u?cre(o[1],o[3],n[1],n[3],c):cre(o[0],o[2],n[0],n[2],c);return we(p),p}function cre(e,t,r,i,s){return e-s<=r&&r<=i&&i<=t+s}(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(Rs||(Rs={}));const kP=C(),OU=C(),RU=C(),Hn=C();class krt{constructor(){this._scales=At(-1,-1,-1,-1),this._offsets=At(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(t,r,i){this._scales[2*t]=r,this._scales[2*t+1]=i}setOffset(t,r,i){this._offsets[2*t]=r,this._offsets[2*t+1]=i}get scales(){return this._scales}get offsets(){return this._offsets}}function zrt(e,t){e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),t.spherical?e.vertex.code.add(b`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):e.vertex.code.add(b`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),e.fragment.code.add(b`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}class LW extends Gye{constructor(){super(...arguments),this.slicePlaneLocalOrigin=C(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}}var Ml;(function(e){e[e.Material=0]="Material",e[e.ShadowMap=1]="ShadowMap",e[e.Highlight=2]="Highlight"})(Ml||(Ml={}));class Brt extends LW{constructor(){super(...arguments),this.identifier=Ml.Material,this.output=D.Color,this.transparent=!1,this.integratedMesh=!1}}class Vrt extends LW{constructor(){super(...arguments),this.identifier=Ml.ShadowMap}}class Grt extends LW{constructor(){super(...arguments),this.identifier=Ml.Highlight}}class hD extends es{constructor(t,r){super(t,"vec4",jr.Draw,(i,s,n)=>i.setUniform4fv(t,r(s,n)))}}var Am;function jrt(e,t){const{vertex:r,fragment:i}=e;r.uniforms.add(new hD("overlayTexOffset",(s,n)=>Hrt(s,n)),new hD("overlayTexScale",(s,n)=>Wrt(s,n))),i.constants.add("overlayOpacity","float",1),i.uniforms.add(new qe("ovColorTex",(s,n)=>MB(s,n))),Hve(e,t)}function Hve(e,t){t.pbrMode!==Qe.Water&&t.pbrMode!==Qe.WaterOnIntegratedMesh&&t.pbrMode!==Qe.TerrainWithWater||e.include(Wye,t);const{vertex:r,fragment:i}=e;e.varyings.add("vtcOverlay","vec4"),r.code.add(b`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),i.code.add(b`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),i.code.add(b`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),i.code.add(b`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y)*texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w)*texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),t.pbrMode!==Qe.Water&&t.pbrMode!==Qe.WaterOnIntegratedMesh&&t.pbrMode!==Qe.TerrainWithWater||(Zm(i),hf(i),i.code.add(b`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function MB(e,t){return t.overlays.length===0?null:e.identifier===Ml.Material&&e.output===D.Color?t.overlays[Si.INNER].getColorTextureNoRasterImage():e.identifier===Ml.Material&&e.output===D.ObjectAndLayerIdColor?t.overlays[Si.INNER].getColorTexture(da.ObjectAndLayerIdColor):e.identifier===Ml.Highlight?t.overlays[Si.INNER].getValidTexture(Zi.Highlight):null}function Hrt(e,t){for(const r of t.overlays){const{index:i,extent:s}=r;Kce(s)>0&&(Hx[2*i]=e.toMapSpace[0]/bc(s)-s[0]/bc(s),Hx[2*i+1]=e.toMapSpace[1]/yd(s)-s[1]/yd(s))}return Hx}function Wrt(e,t){for(const r of t.overlays){const{index:i,extent:s}=r;Kce(s)>0&&(Hx[2*i]=e.toMapSpace[2]/bc(s),Hx[2*i+1]=e.toMapSpace[3]/yd(s))}return Hx}(function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT"})(Am||(Am={}));const Hx=Ht();var Lp;(function(e){e[e.LayerOnly=0]="LayerOnly",e[e.ColorComposite=1]="ColorComposite",e[e.GridComposite=2]="GridComposite",e[e.COUNT=3]="COUNT"})(Lp||(Lp={}));class qrt extends YH{constructor(){super(...arguments),this.overlayOpacity=1,this.overlaySource=da.None}}function MS(e,t){e.vertex.uniforms.add(new dD("overlayTexOffset"),new dD("overlayTexScale")),e.fragment.uniforms.add(new Ae("overlayOpacity",r=>r.overlayOpacity),new qe("ovColorTex",(r,i)=>i.overlays.length===0?null:i.overlays[Si.INNER].getColorTexture(r.overlaySource))),Hve(e,t)}function Xrt(e,t){const{vertex:r,fragment:i,varyings:s}=e;s.add("vtc","vec2"),r.uniforms.add(new dD("texOffsetAndScale")),i.uniforms.add(new ure("tex")),i.uniforms.add(new PU("textureOpacities"));const n=t.textureFadingEnabled&&!t.renderOccluded;n&&(r.uniforms.add(new dD("nextTexOffsetAndScale")),s.add("nvtc","vec2"),i.uniforms.add(new ure("texNext")),i.uniforms.add(new PU("nextTexOpacities")),i.uniforms.add(new Zrt("fadeFactor")));const o=t.tileBlendInput===Lp.ColorComposite,a=t.tileBlendInput===Lp.GridComposite;a&&i.include(PW),o&&i.uniforms.add(new PU("backgroundColor")),r.code.add(b`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${n?b`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:b``}
  }`),i.code.add(b`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?b`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?b`backgroundColor`:b`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:b`return color;`}
    }`),n?i.code.add(b`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):i.code.add(b`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}class Zrt extends es{constructor(t){super(t,"float")}}class PU extends es{constructor(t){super(t,"vec3")}}class dD extends es{constructor(t){super(t,"vec4")}}class ure extends es{constructor(t){super(t,"sampler2D")}}class Wve extends qrt{}function Yrt(e){const t=new pr,{vertex:r,fragment:i,varyings:s}=t;t.include(H3),t.include(nO,e),t.include(zp,e);const n=()=>{t.include(e3,e),r.code.add(b`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};Fl(r,e),t.include(Xa,e);const o=e.overlayMode!==Am.Disabled,a=o&&e.invisible;switch(e.output){case D.Color:{t.include(Xrt,e),t.include(B1,e),o&&t.include(MS,{...e,pbrMode:e.pbrMode===Qe.Terrain?Qe.TerrainWithWater:Qe.Water});const l=e.overlayMode===Am.EnabledWithWater;l&&t.include(zrt,e),s.add("vnormal","vec3"),s.add("vpos","vec3"),s.add("vup","vec3"),n(),e.screenSizePerspective&&zT(r);const c=e.receiveShadows&&!e.renderOccluded;c&&t.include(w2,e),e.screenSizePerspective&&(s.add("screenSizeDistanceToCamera","float"),s.add("screenSizeCosAngle","float")),r.code.add(b`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${l?b`forwardVertexTangent(vnormal);`:b``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?b`setOverlayVTC(uv);`:""}
          ${e.tileBorders?b`forwardTextureCoordinates();`:""}

          ${e.screenSizePerspective?b`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${c?b`forwardLinearDepth();`:""}

        }
      `),t.include(os,e),t.include(B1,e),t.include(lO,e),t.include(k1,e),xd(i,e),cO(i),M2(i),i.uniforms.add(r.uniforms.get("localOrigin"),new Rt("viewDirection",(u,d)=>pe(hre,se(hre,d.camera.viewMatrix[12],d.camera.viewMatrix[13],d.camera.viewMatrix[14])))),l&&i.uniforms.add(new qe("ovWaterTex",(u,d)=>d.overlays.length===0?null:d.overlays[Si.INNER].getNormalTexture(u.overlaySource)),new pge("view",(u,d)=>Ja(Jrt,d.camera.viewMatrix,u.origin))),i.code.add(b`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),Zm(i),hf(i),i.code.add(b`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${e.receiveShadows&&!e.renderOccluded?"readShadowMap(vpos, linearDepth)":e.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?b`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${e.invisible?b`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${e.pbrMode===Qe.Terrain||e.pbrMode===Qe.TerrainWithWater?b`fragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:b`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${l?b`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${e.screenSizePerspective?b`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${e.visualizeNormals?e.spherical?b`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:b`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${e.tileBorders?b`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `)}break;case D.Depth:a&&t.include(MS,e),t.include(jm,e),by(t),C1(t),r.code.add(b`
              void main(void) {
                ${a?b`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),i.code.add(b`
              void main() {
                ${a?b`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case D.Shadow:case D.ShadowHighlight:case D.ShadowExcludeHighlight:t.include(jm,e),by(t),C1(t),r.code.add(b`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),i.code.add(b`void main() {
outputDepth(linearDepth);
}`);break;case D.Normal:a&&t.include(MS,e),s.add("vnormal","vec3"),zT(r),n(),r.code.add(b`
            void main(void) {
              ${a?b`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `),i.code.add(b`
            void main() {
              ${a?b`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              fragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case D.Highlight:o&&t.include(MS,e),r.code.add(b`
          void main() {
            ${o?b`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),t.include(ig,e),i.code.add(b`
          void main() {
            ${o?b`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return e.output===D.ObjectAndLayerIdColor&&(t.include(MS,{...e,pbrMode:Qe.Disabled}),r.code.add(b`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),i.code.add(b`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)),t}const Jrt=be(),hre=C(),Krt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:Wve,build:Yrt},Symbol.toStringTag,{value:"Module"}));class s5 extends xr{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(t,r){r.spherical=t.viewingMode===Ie.Global}initializeProgram(t){return new vr(t.rctx,s5.shader.get().build(this.configuration),qve)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(t){const r=this.configuration,i=r.backfaceCullingEnabled&&!r.renderOccluded;return Tt({blending:r.renderOccluded?Vl(ve.ONE,ve.ONE_MINUS_SRC_ALPHA):null,culling:i?oj:null,depthTest:r.renderOccluded?null:{func:Hr.LESS},depthWrite:r.renderOccluded?null:Ka,colorWrite:It,stencilTest:t?mHe(Za.IntegratedMeshMaskExcluded):null})}getPipelineState(t,r){return this.useStencil?this._stencilPipelineState:super.getPipelineState(t,r)}}s5.shader=new _r(Krt,()=>ue(()=>import("./Terrain.glsl.9b9734d8.js"),[]));const qve=new Map([[E.POSITION,0],[E.UV0,1],[E.NORMALCOMPRESSED,2]]);class Qrt{constructor(){this.geometry=new Ytt,this.intersectionData=null,this.geometryState=null,this._textureRef=new jx(()=>this.tile.surface.textureFadeDuration),this.overlay=new krt,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(t){this.clear(),this._tile=t;const r=this.geometry;r.indices=null,r.vertexAttributes=null,mi(r.boundingBox),r.indexCount=0,r.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new rrt,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(t){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(t),this._geometryStateChangedSinceLastUpdate=!1),Js&&this.tile.intersectsClippingArea)for(let r=0;r<4;++r)we(this.geometry.outerEdges[r].count===this.geometryState.neighborData.edgeResolutions[r]+1)}_calculateEdgeResolution(t,r){const i=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!i.surface.isGlobal){const l=i.surface.extent;if(l!=null&&(t===0&&i.extent[3]>l[3]||t===1&&i.extent[2]>l[2]||t===2&&i.extent[1]<l[1]||t===3&&i.extent[0]<l[0]))return s}const n=i.level,o=$p[t];if(!r)return we(i.surface?.rootTiles==null||i.surface.updatingRootTiles||!i.shouldHaveNeighbor(o)),s;if(r.isLoaded){const l=r,c=l.renderData.geometryState,u=n-l.level;if(we(u>=0),u===0){const g=c.numVerticesPerSide-1;return Math.max(g,s)}const d=2**u,p=c.neighborData.edgeResolutions[(t+2)%4]/d;return Math.max(1,p)}we(!r.isLeaf);let a=s;return r.forAllSubtreeOnSide(uD(o),l=>l===i||(l.isLoaded?(a=Math.max(a,2**(l.level-n)),!0):(we(!l.isLeaf),!1))),a}updateNeighborData(){const t=this.tile;if(!t.intersectsClippingArea)return;const r=t.renderData.geometryState.neighborData,i=a=>(a.isLoaded||a.level===t.level)&&a?.intersectsClippingArea,s=r.edgePeerNeighbors,n=r.edgePeerNeighborSamplerVersions;for(let a=0;a<4;++a){const l=t.findNeighborTile($p[a],i),c=bv(t,l),u=c?.renderData?.geometryState.samplerDataVersion??-1,d=s[a],p=c!==bv(t,d),g=n[a]!==u;s[a]=l,(p||g)&&(n[a]=u,this._markEdgeDirty(a));const y=r.edgeResolutions[a],_=this._calculateEdgeResolution(a,l);we(r1(_)),we(_>=1),r.edgeResolutions[a]=_,y!==_&&this._markEdgeResolutionDirty(a)}const o=r.cornerPeerNeighbors;for(let a=0;a<4;++a){const l=t.findNeighborTile(l3[a],i);o[a]=l;const c=bv(t,s[a]),u=bv(t,s[(a+1)%4]),d=bv(t,l);bh[a]=d,bh[(a+1)%4]=u,bh[(a+2)%4]=t,bh[(a+3)%4]=c,we(bh.some(_=>_?.isLoaded||_===t));const p=bh.reduce((_,v)=>Math.min(_,v?.level??1/0),1/0);bh.forEach((_,v)=>{_&&_?.level>p&&(bh[v]=null)}),we(bh.some(_=>_?.isLoaded||_===t));const g=r.cornerNeighborData[a].cornerTiles,y=r.cornerNeighborData[a].cornerTileSamplerVersions;for(let _=0;_<4;++_){const v=bh[_],w=v?.renderData.geometryState.samplerDataVersion??-1,T=g[_]!==v,x=!T&&y[_]!==w;(T||x)&&(g[_]=v,y[_]=w,this._markCornerDirty(a))}we(g.some(_=>_?.isLoaded||_===t))}Js&&we(this.geometryState.neighborData.edgeResolutions.every(a=>a>0));for(let a=0;a<4;++a)bh[a]=null}_updateGeometry(t){if(!this.tile.intersectsClippingArea)return;Js&&we(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(l=>l>0)),this.intersectionData=null;const r=this.tile,i=this._vao,s=this.geometry.vertexAttributes,n=!i||!s||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,o=!n&&(this._dirtyEdges!==0||this._dirtyEdgeResolutions!==0),a=!o&&this._dirtyCorners!==0;n?(this.releaseGeometry(),this._createGeometry(t)):o||a?r.updateEdgeElevations():a?r.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao.dispose(),this._vao=null,Qtt(this.geometry),!0)}ensureTexture(t,r){return this._texture!=null&&this._texture.descriptor.width!==t&&this.releaseTexture(),this._texture==null&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(t){const r=1<<t;this._dirtyCorners|=r}_markEdgeDirty(t){const r=1<<t;this._dirtyEdges|=r,this._markCornerDirty((t+0)%4),this._markCornerDirty((t+3)%4)}_markEdgeResolutionDirty(t){const r=1<<t;this._dirtyEdgeResolutions|=r,this._markEdgeDirty(t)}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const t=this._getElevationInfo(),r=this.tile,i=t.samplerData?r.getElevationVerticesPerSide(t.maxTileLevel):r.getDefaultVerticesPerSide(),s=Math.max(i,5);let n=r.clippingArea;r.intersectsClippingArea&&!r.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==s&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),t.changed&&(this._samplerDataChanged=!0,o.samplerData=t.samplerData,o.samplerDataVersion++,a=!0),Om(o.clippingArea,n)||(this._clippingAreaChanged=!0,o.clippingArea=n,a=!0);const l=r.surface.wireframe;return o.wireframe!==l&&(this._wireframeChanged=!0,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(t){this.tile.createGeometry();const r=this.geometry.vertexAttributes,i=this.geometry.indices,s=t.gl;this._vao=new Ed(t,qve,{geometry:Wl(r.layout)},{geometry:rr.createVertex(t,s.STATIC_DRAW,r.buffer)},rr.createIndex(t,s.STATIC_DRAW,i)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(t,r=Em.Immediate){t!=null&&t.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(t,r)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const t=this.geometryState.samplerData,r=this.tile.layerInfo[jt.ELEVATION],i=r.length,s=new Array(i);let n=0,o=0,a=!1;for(let u=0;u<i;u++){const d=r[u];if(d.upsampleInfo!=null){const p=d.upsampleInfo.tile,g=p.layerInfo[jt.ELEVATION][u].data,y=g&&g.samplerData;t&&t[n]===y||(a=!0),s[n++]=y,o=Math.max(o,p.lij[0])}else if(d.data){const p=this.tile.surface.layerViewByIndex(u,jt.ELEVATION);if(qC(this.tile,p.layer,!1)){const g=d.data;t&&t[n]===g.samplerData||(a=!0),s[n++]=g.samplerData,o=this.tile.level}}}t!=null&&t.length!==n&&(a=!0);const l=n>0,c=l?s:null;return l&&(s.length=n),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){const t=this.intersectionData?.estimatedMemoryUsage??0;return(this.geometry.indices?.byteLength??0)+(this.geometry.vertexAttributes?.byteLength??0)+t}get texture(){return this._texture}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!Js)return;const t=this.tile;if(!t.isLoaded||!t.intersectsClippingArea||t.level===0)return void we(t?.isLoaded);const r=t.surface.extent;if(r!=null&&!t.intersectsExtent(r))return;const i=$p.map((a,l)=>r!=null&&(l<2?-1:1)*(t.extent[3-l]-r[3-l])<0),s=t.level;we(this._dirtyCorners===0),we(this._dirtyEdges===0),we(this._dirtyEdgeResolutions===0),we(!this._numVerticesPerSideChanged),we(!this._samplerDataChanged),we(!this._clippingAreaChanged),we(!this._wireframeChanged);const n=l3.map(a=>t.findNeighborCornerTileExact(a,l=>!l.intersectsClippingArea||l.isLoaded||l.level===t.level)??null).map(a=>a?.intersectsClippingArea?a:null),o=this.geometryState.neighborData;for(let a=0;a<4;++a){const l=o.cornerPeerNeighbors[a],c=n[a];we(c===l,`Tile[${t.lij}].corner[${a}] out of date: cur=[${l?.lij}] exp=[${c?.lij}]`)}$p.forEach((a,l)=>{if(i[l])return;const c=t.findNeighborTile(a,z=>(z.level===s||z?.isLoaded)&&z?.intersectsClippingArea);if(!c){const z=!t.surface.updatingRootTiles&&t.surface.rootTiles!=null&&t.surface.rootTiles.length>0&&t.shouldHaveNeighbor(a);return void we(!z)}we(c.isLoaded||c.level===t.level),we(c===this.geometryState.neighborData.edgePeerNeighbors[l]);const u=s-c.level;if(!c.isLoaded)return we(!c.isLeaf),void we(u===0);const d=c.renderData;we(Urt(t,c,a)),we(u>=0);const p=2**u;if(u<0)return void we(!1);const g=t.renderData,y=g.geometry,_=y.outerEdges[l],v=y.numVerticesPerSide-1,w=d.geometry;if(!w)return void we(!1);const T=this.geometryState.neighborData.edgePeerNeighbors[l];if(T?.isLoaded){const z=T.renderData;we(T==T),we(g.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===z.geometryState.samplerDataVersion),we(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===z.geometryState.samplerDataVersion)}const x=(l+2)%4,S=w.outerEdges[x],O=_.count-1,A=S.count-1;we(O*p===A,`Tile[${t.lij}]:e${l},res=${O} edgeRes mismatch with Neighbor[${c.lij}]:e${x},res=${A} (expected:${O*p})`);const $=t.extent,P=a===et.NORTH||a===et.SOUTH,U=S.count-1,I=U/2**u,L=_.count-1;if(I<1)return void we(L===1);we(I===L),we(r1(I));const N=w.numVerticesPerSide-1;we(u>0||I===Math.max(N,v));const Z=t.getNeighborEdgeStartVertexIndex(l,c);we(0<=Z&&Z<p);const W=Z*I;we(0<=W&&W<=U-I);let V=0,J=W;_.getVertexPos(Wd,0),_.getVertexPos(qd,_.count-1);const R=ni(Wd,qd),k=Math.max(eit,1e-4*R);for(let z=0;z<=I;++z){_.getVertexPos(Wd,V),S.getVertexPos(qd,J);const H=z/I,X=P?$[0]+H*($[2]-$[0]):a===et.WEST?$[0]:$[2],Y=P?a===et.SOUTH?$[1]:$[3]:$[1]+H*($[3]-$[1]),ee=t.surface.extent;if(ee==null||eN(ee,X,Y)){const me=_3(Wd,qd),$e=bl(Wd)-Kt.radius,pt=bl(qd)-Kt.radius,St=me<k;if(!St){console.warn(`Tile edge vertex position mismatch: between [${t.lij}].edge${l}[${V}/${_.count}] and [${c.lij}].edge${x}[${J}/${S.count}]`),ee!=null&&console.warn("  surface extent= ",ee," x,y=",X,",",Y);const ge=C();ce(ge,g.localOrigin,d.localOrigin),bl(ge)>0&&console.warn(`   localOrigins: ${g.localOrigin} vs ${d.localOrigin} d=${bl(ge)} [${ge}]`),(()=>{const Ee=Ts(Wd),_t=Ts(qd);t.updateEdgeElevations(),c.updateEdgeElevations(),_.getVertexPos(Wd,V),S.getVertexPos(qd,J);const _e=C();Ln(_e,Wd,Ee),bl(_e)>0&&console.warn(`  XXX Tile[${t.lij}] edge out of date: ${Ee} vs ${Wd} d=${bl(_e)} [${_e}]`),Ln(_e,qd,_t),bl(_e)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${_t} vs ${qd} d=${bl(_e)} [${_e}]`)})(),we(St,`Mismatch in tile [${t.lij}].edge[${l}][${V}/${_.count}] vs neighbor [${c.lij}].edge[${x}][${J}/${S.count}] ${Of(Wd)} vs ${Of(qd)}  dist=${me} h(t|n|d)=${$e}|${pt}|${pt-$e}`)}_.getNormal(tw,V),S.getNormal(rw,J),pe(dre,tw),pe(pre,rw);const it=de(dre,pre),ft=1-it<.01||!1||t===c;if(!ft){const ge=C();Ln(ge,tw,rw);const Ee=()=>`Mismatch in tile edge normal ${Hte(t.lij)} (${V}/${_.count-1}) edge ${l} vs neighbor ${Hte(c.lij)}  (${J}/${S.count-1}) nedge ${x} :${Of(tw)} vs ${Of(rw)}  dot = ${it} : ${Of(ge)}`;console.warn("Mismatch in tile edge normal: ",Ee());{t.updateEdgeElevations(),c.updateEdgeElevations();const _t=C(),_e=C();_.getNormal(_t,V),S.getNormal(_e,J),ly(tw,_t)||console.warn("Missing update in tile normal: ",Of(tw)," => ",Of(_t)),ly(rw,_e)||console.warn("Missing update in neighbor normal: ",Of(rw)," => ",Of(_e))}we(ft,Ee())}}V+=1,J+=1}})}}const Wd=C(),qd=C(),tw=C(),rw=C(),dre=C(),pre=C(),eit=1,bh=[null,null,null,null];function bv(e,t){return t?.isLoaded||t===e?t:null}const tit=65536;function rit(e,t){const r=e.tile,{extent:i,extentInRadians:s,surface:n}=r,o=e.localOrigin,a=e.geometryState,l=n.isWebMercator,c=a.numVerticesPerSide,u=c-1,d=(c-2)**2,p=l&&(t===Eu.HAS_SOUTH_POLE||t===Eu.HAS_BOTH_POLES),g=l&&(t===Eu.HAS_NORTH_POLE||t===Eu.HAS_BOTH_POLES),y=6,_=((p?1:0)+(g?1:0))*y*(u+1),v=a.neighborData,w=v.edgeResolutions.reduce(($,P)=>$+P+1,0),T=Nve(d+_+w),x=e.geometry;x.numVerticesPerSide=a.numVerticesPerSide,x.vertexAttributes=T;const S=x.boundingBox;mi(S);const O=DW(e);Kn.update(u,s,O),iit(e),i1e(e,d),Xve(e);const A=[];if((()=>{let $=d+w;const P=o[0],U=o[1],I=o[2],L=r.ellipsoid.radius,N=i[1],Z=i[3],W=(V,J)=>{const R=J*c;ju(-P,-U,V*L-I,S),A.push({connectedRowOffset:R,connectedOuterEdgeOffset:V===1?0:2,rowOffset:$,latitudeResolution:y});const k=Jve(V===-1?N:Z,L),z=V*Math.PI/2-k,H=.99*(V===1?1:-1),X=L+0,Y=T.position,ee=T.uv0,{typedBuffer:me,typedBufferStride:$e}=T.normalCompressed;for(let pt=1;pt<=y;++pt){const St=k+z*(pt/y),it=Math.cos(St),ft=Math.sin(St);for(let ge=0;ge<=u;ge++){const Ee=ge/u,_t=Kn.sinLonLUT[ge],_e=Kn.cosLonLUT[ge]*it,ke=_t*it,Ve=ft,ct=_e*X-P,nt=ke*X-U,ze=Ve*X-I;ju(ct,nt,ze,S),Y.setValues($,ct,nt,ze),fd(ee,$,Ee,H),z1(me,$,_e,ke,Ve,$e),++$}}};p&&W(-1,0),g&&W(1,u)})(),r1e(x,a.numVerticesPerSide,A,[0,c-1],[0,c-1],a.wireframe),e.intersectionData=null,Js)for(let $=0;$<4;++$)we(x.outerEdges[$].count===v.edgeResolutions[$]+1)}function iit(e){const t=e.tile;if(!t.intersectsClippingArea)return;const r=e.geometryState,i=r.numVerticesPerSide,s=i-2,n=i-1,o=e.geometry,a=o.vertexAttributes,l=a.position,c=a.uv0,{typedBuffer:u,typedBufferStride:d}=a.normalCompressed,p=t.extent,g=p[0],y=p[2],_=p[1],v=p[3],w=t.ellipsoid.radius,T=r.samplerData,x=e.localOrigin,S=x[0],O=x[1],A=x[2],$=l.typedBuffer,P=l.typedBufferStride,U=1/n,I=o.boundingBox;let L=0;if(1<=s){const N=U,Z=_*(1-N)+v*N,W=Kn.sinLatLUT[1],V=Kn.cosLatLUT[1];for(let J=1;J<=s;J++){const R=J*U,k=g*(1-R)+y*R,z=Kn.sinLonLUT[J],H=Kn.cosLonLUT[J],X=w+ki(k,Z,T),Y=X*H*V-S,ee=X*z*V-O,me=X*W-A;ju(Y,ee,me,I);const $e=(J-1)*P;$[$e]=Y,$[$e+1]=ee,$[$e+2]=me,fd(c,J-1,R,N)}}for(let N=1;N<=s;N++){const Z=N*U,W=_*(1-Z)+v*Z,V=Kn.sinLatLUT[N],J=Kn.cosLatLUT[N],R=N+1,k=R*U,z=_*(1-k)+v*k,H=Kn.sinLatLUT[R],X=Kn.cosLatLUT[R],Y=Kn.sinLonLUT[0],ee=Kn.cosLonLUT[0],me=w+ki(g,W,T);let $e=ee*J*me-S,pt=Y*J*me-O,St=V*me-A;const it=L*P;let ft=$[it],ge=$[it+1],Ee=$[it+2];for(let _t=1;_t<=s;_t++){const _e=_t*U,ke=g*(1-_e)+y*_e,Ve=Kn.sinLonLUT[_t],ct=Kn.cosLonLUT[_t];let nt=0,ze=0,mt=0;if(_t<s){const lr=(L+1)*P;nt=$[lr],ze=$[lr+1],mt=$[lr+2]}else{const lr=Kn.sinLonLUT[n],Qr=Kn.cosLonLUT[n],Ls=w+ki(y,W,T);nt=Qr*J*Ls-S,ze=lr*J*Ls-O,mt=V*Ls-A}const ir=$e,qt=pt,ai=St;$e=ft,pt=ge,St=Ee,ft=nt,ge=ze,Ee=mt;const Je=nt-ir,Ke=ze-qt,ht=mt-ai;let kt=0,Xt=0,Fr=0;if(N>1){const lr=(L-s)*P;kt=$[lr],Xt=$[lr+1],Fr=$[lr+2]}else{const lr=Kn.sinLatLUT[0],Qr=Kn.cosLatLUT[0],Ls=w+ki(ke,_,T);kt=ct*Qr*Ls-S,Xt=Ve*Qr*Ls-O,Fr=lr*Ls-A}const li=w+ki(ke,z,T),zt=ct*X*li-S,ci=Ve*X*li-O,Ai=H*li-A;if(N<s){const lr=L+s,Qr=lr*P;$[Qr]=zt,$[Qr+1]=ci,$[Qr+2]=Ai,ju(zt,ci,Ai,I),fd(c,lr,_e,k)}const Ir=kt-zt,fr=Xt-ci,Di=Fr-Ai;let us=ct*J,Tr=Ve*J,qr=V;qr*qr<.999&&(us=ht*fr-Ke*Di,Tr=Je*Di-ht*Ir,qr=Ke*Ir-Je*fr);const Ur=1/Math.sqrt(us*us+Tr*Tr+qr*qr);z1(u,L,us*Ur,Tr*Ur,qr*Ur,d),++L}}}function sit(e){e.tile.intersectsClippingArea&&(Xve(e),n5(e))}function nit(e){e.tile.intersectsClippingArea&&(Yve(e),Zve(e,!0),n5(e))}function Xve(e){e.tile.intersectsClippingArea&&(Yve(e),Zve(e))}function Zve(e,t=!1){const r=e.geometryState,i=e.geometry,s=r.neighborData,n=e.tile,o=n.level,a=n.extent,l=n.ellipsoid.radius,c=n.extentInRadians,u=c[0],d=c[2],p=c[1],g=c[3],y=r.samplerData,_=a[0],v=a[2],w=a[1],T=a[3],x=DW(e),S=i.boundingBox,O=e.localOrigin,A=O[0],$=O[1],P=O[2],U=i.vertexAttributes,I=U.position,L=I.typedBuffer,N=I.typedBufferStride,Z=U.uv0;for(let W=0;W<4;++W){const V=W===1||W===3,J=s.edgeResolutions[W];we(r1(J));const R=J+1,k=bv(n,s.edgePeerNeighbors[W]);if(o1e(n,k,W)){s1e(e,W,k);continue}const z=k!=null;we(!z||k.level===n.level),we(!z||Cm(n,k)<=0);const H=k?.renderData,X=H?.geometryState;if(Js){const Je=n.surface;if(!k&&Je&&!Je.updatingRootTiles){const Ke=$p[W],ht=n.findNeighborTile(Ke,kt=>kt.isLoaded||kt.isLeaf||kt.level===n.level);ht?ht.intersectsClippingArea&&(we(!ht.isLoaded),we(!ht.isLeaf),we(ht.level===o)):we(Je?.rootTiles==null||!n.shouldHaveNeighbor(Ke))}}const Y=W===1?a[2]:a[0],ee=k?.extent,me=ee&&V?W===1?ee[0]:ee[2]:Y,$e=W===0?a[3]:a[1],pt=W===1?1:0,St=W===0?1:0,it=W===1?d:u,ft=W===0?g:p,ge=Math.sin(it),Ee=Math.cos(it),_t=Math.sin(ft),_e=Math.cos(ft),ke=X?.samplerData,Ve=z?(Je,Ke,ht)=>.5*(ki(Je,Ke,y)+ki(ht,Ke,ke)):(Je,Ke,ht)=>ki(Je,Ke,y),ct=i.outerEdges[W],nt=t&&R>3?R-3:1,ze=y!=null&&y.some(Je=>Je!=null),mt=ke!=null&&ke.some(Je=>Je!=null),ir=ze||mt,qt=1/J,ai=ct.index0;we(!ee||Au(ee[2]-ee[0],a[2]-a[0])),(()=>{const Je=W===1?-1:W===3?1:0,Ke=W===0?-1:W===2?1:0,ht=(a[2]-a[0])*qt,kt=Je*ht,Xt=Ke*ht,Fr=V?Je*((d-u)*qt):0,li=V?0:Ke*qt,zt=St,ci=V?it+Fr:it,Ai=V?Math.sin(ci):ge,Ir=V?Math.cos(ci):Ee,fr=V?it-Fr:it,Di=V?Math.sin(fr):ge,us=V?Math.cos(fr):Ee,Tr=V?ft:x(zt+li),qr=V?_t:Math.sin(Tr),Ur=V?_e:Math.cos(Tr),lr=V?ft:x(zt-li),Qr=V?_t:Math.sin(lr),Ls=V?_e:Math.cos(lr);let Bn=0,Vn=0,tn=0;{const kr=0*qt,vn=V?Y:_*(1-kr)+v*kr,lo=V?me:vn,Jo=V?w*(1-kr)+T*kr:$e,ie=V?it:u*(1-kr)+d*kr,yi=V?ge:Math.sin(ie),ah=V?Ee:Math.cos(ie),bn=V?x(kr):ft,lh=V?Math.sin(bn):_t,Xe=V?Math.cos(bn):_e,tl=l+Ve(vn,Jo,lo);Bn=ah*Xe*tl,Vn=yi*Xe*tl,tn=lh*tl}let rn=0,Ni=0,sn=0;{const kr=1*qt,vn=V?Y:_*(1-kr)+v*kr,lo=V?me:vn,Jo=V?w*(1-kr)+T*kr:$e,ie=V?it:u*(1-kr)+d*kr,yi=V?ge:Math.sin(ie),ah=V?Ee:Math.cos(ie),bn=V?x(kr):ft,lh=V?Math.sin(bn):_t,Xe=V?Math.cos(bn):_e,tl=l+Ve(vn,Jo,lo);rn=ah*Xe*tl,Ni=yi*Xe*tl,sn=lh*tl}for(let kr=1;kr<R-1;kr+=nt){let vn=0,lo=0,Jo=0;{const Ko=(kr+1)*qt,rl=V?Y:_*(1-Ko)+v*Ko,Od=V?me:rl,xn=V?w*(1-Ko)+T*Ko:$e,Hi=V?it:u*(1-Ko)+d*Ko,lg=V?ge:Math.sin(Hi),Gy=V?Ee:Math.cos(Hi),jy=V?x(Ko):ft,hb=V?Math.sin(jy):_t,Hy=V?Math.cos(jy):_e,cg=l+Ve(rl,xn,Od);vn=Gy*Hy*cg,lo=lg*Hy*cg,Jo=hb*cg}const ie=vn,yi=lo,ah=Jo,bn=rn,lh=Ni,Xe=sn;rn=ie,Ni=yi,sn=ah;{const Ko=ai+kr,rl=Ko*N,Od=bn-A,xn=lh-$,Hi=Xe-P;L[rl]=Od,L[rl+1]=xn,L[rl+2]=Hi,ju(Od,xn,Hi,S);const lg=kr*qt;fd(Z,Ko,V?pt:lg,V?lg:St)}const tl=Bn,wn=Vn,zy=tn;Bn=bn,Vn=lh,tn=Xe;const By=bn,Ea=lh,mf=Xe,Vy=1/Math.sqrt(By*By+Ea*Ea+mf*mf),Bt=mf*Vy;let og=0,gf=0,ag=0;if(ir&&Bt*Bt<.999){let Ko=0,rl=0,Od=0;{const xn=W===0?-1:1;Ko=xn*(ie-tl),rl=xn*(yi-wn),Od=xn*(ah-zy)}{const xn=kr*qt,Hi=V?Y:_*(1-xn)+v*xn,lg=V?me:Hi,Gy=V?w*(1-xn)+T*xn:$e,jy=V?it:u*(1-xn)+d*xn,hb=V?ge:Math.sin(jy),Hy=V?Ee:Math.cos(jy),cg=V?x(xn):ft,mO=V?Math.sin(cg):_t,Ca=V?Math.cos(cg):_e;let $2=By,L2=Ea,j=mf;if(z){const he=l+ki(lg-kt,Gy-Xt,ke),Te=V?Ca:Ls;$2=(V?us:Hy)*Te*he,L2=(V?Di:hb)*Te*he,j=(V?mO:Qr)*he}{const he=l+ki(Hi+kt,Gy+Xt,y),Te=V?Ca:Ur,sr=(V?Ir:Hy)*Te*he,Ds=(V?Ai:hb)*Te*he,ui=(V?mO:qr)*he;z||($2=2*By-sr,L2=2*Ea-Ds,j=2*mf-ui);const Qo=W===3?-1:1,Wy=Qo*($2-sr),KW=Qo*(L2-Ds),QW=Qo*(j-ui);og=Od*KW-rl*QW,gf=Ko*QW-Od*Wy,ag=rl*Wy-Ko*KW;const P5=1/Math.sqrt(og*og+gf*gf+ag*ag);og*=P5,gf*=P5,ag*=P5}}}else og=By*Vy,gf=Ea*Vy,ag=mf*Vy;ct.setNormalFromValues(kr,og,gf,ag)}})()}}function Yve(e){n1e(e)}function Jve(e,t){return Math.PI/2-2*Math.atan(Math.exp(-e/t))}function oit(e,t,r,i){return Jve(e*(1-i)+t*i,r)}function ait(e,t,r){return e*(1-r)+t*r}function DW(e){const t=e.tile;if(t.surface.isWebMercator){const i=t.extent,s=t.ellipsoid.radius;return n=>oit(i[1],i[3],s,n)}const r=t.extentInRadians;return i=>ait(r[1],r[3],i)}function lit(e,t){const r=e.tile.extent,i=e.geometryState,s=r[0],n=r[1],o=r[2]-s,a=r[3]-n,l=i.clippingArea,c=l!=null?Math.max(0,(l[0]-s)/o):0,u=l!=null?Math.max(0,(l[1]-n)/a):0,d=l!=null?Math.min(1,(l[2]-s)/o):1,p=l!=null?Math.min(1,(l[3]-n)/a):1,g=i.numVerticesPerSide,y=(g-2)**2,_=i.neighborData.edgeResolutions.reduce((x,S)=>x+S+1,0),v=Nve(y+_),w=e.geometry,T=w.boundingBox;mi(T),w.numVerticesPerSide=i.numVerticesPerSide,w.vertexAttributes=v,pi(w.uvRange,c,u,d,p),cit(e),i1e(e,y),Kve(e),r1e(w,i.numVerticesPerSide,[],[0,g-1],[0,g-1],i.wireframe),e.intersectionData=null}function cit(e){const t=e.tile;if(!t.intersectsClippingArea)return;const r=t.surface,i=e.geometryState,s=i.samplerData,n=e.localOrigin,o=r.isWebMercatorOnPlateeCarree,a=i.clippingArea,l=a??NW,c=t.extent,u=c[0],d=c[1],p=c[2],g=c[3],y=Math.max(u,l[0]),_=Math.min(p,l[2]),v=Math.max(d,l[1]),w=Math.min(g,l[3]),T=t.ellipsoid.radius,x=t.horizontalScale,S=i.numVerticesPerSide,O=S-1,A=S-2,$=e.geometry,P=$.vertexAttributes,U=P.position,I=P.uv0,{typedBuffer:L,typedBufferStride:N}=P.normalCompressed,Z=$.uvRange,W=Z[0],V=Z[1],J=Z[2],R=Z[3],k=$.boundingBox,z=n[0],H=n[1],X=n[2],Y=U.typedBuffer,ee=U.typedBufferStride;let me=0;const $e=fe(d,v,w),pt=o?(Math.PI/2-2*Math.atan(Math.exp(-$e/T)))*T:$e*x,St=1/O,it=fe(d*(1-St)+g*St,v,w);let ft=pt,ge=o?(Math.PI/2-2*Math.atan(Math.exp(-it/T)))*T:it*x;for(let Ee=1;Ee<=A;Ee++){const _t=Ee/O,_e=fe(d*(1-_t)+g*_t,v,w),ke=fe(_t,V,R),Ve=ge,ct=(Ee-1)/O,nt=fe(d*(1-ct)+g*ct,v,w),ze=ft,mt=(Ee+1)/O,ir=fe(d*(1-mt)+g*mt,v,w),qt=o?(Math.PI/2-2*Math.atan(Math.exp(-ir/T)))*T:ir*x,ai=fe(mt,V,R);ft=ge,ge=qt;const Je=fe(u,y,_);let Ke=Je*x,ht=ki(Je,_e,s);const kt=1/O,Xt=fe(kt,W,J),Fr=fe(u*(1-Xt)+p*Xt,y,_);let li=Xt,zt=Fr,ci=Fr*x,Ai=ki(Fr,_e,s);if(Ee===1){const Ir=ci-z,fr=ft-H,Di=Ai-X,us=0*ee;Y[us]=Ir,Y[us+1]=fr,Y[us+2]=Di,ju(Ir,fr,Di,k);const Tr=fe(kt,W,J);fd(I,me,Tr,ke)}for(let Ir=1;Ir<=A;Ir++){const fr=ci,Di=Ai,us=(Ir+1)/O,Tr=fe(us,W,J),qr=fe(u*(1-us)+p*us,y,_),Ur=zt;zt=qr;{const Ni=me+1,sn=Ni*ee;if(Ee===1||Ir===A){const kr=qr*x,vn=ki(qr,_e,s);if(Ee===1&&Ir<A){const lo=kr-z,Jo=Ve-H,ie=vn-X;Y[sn]=lo,Y[sn+1]=Jo,Y[sn+2]=ie,ju(lo,Jo,ie,k),fd(I,Ni,Tr,ke)}ci=kr,Ai=vn}else ci=Y[sn]+z,Ai=Y[sn+2]+X}const lr=ci,Qr=Ai,Ls=Ke,Bn=ht;Ke=fr,ht=Di;const Vn=(me-A)*ee,tn=Ee===1?ki(Ur,nt,s):Y[Vn+2]+X,rn=ki(Ur,ir,s);if(Ee<A){const Ni=me+A,sn=Ni*ee,kr=fr-z,vn=qt-H,lo=rn-X;Y[sn]=kr,Y[sn+1]=vn,Y[sn+2]=lo,ju(kr,vn,lo,k);const Jo=li;li=Tr,fd(I,Ni,Jo,ai)}{const Ni=lr-Ls,sn=ze-qt,kr=sn*(Qr-Bn),vn=Ni*(tn-rn),lo=-sn*Ni,Jo=kr*kr+vn*vn+lo*lo;if(Jo===0)z1(L,me,0,0,1,N);else{const ie=1/Math.sqrt(Jo);z1(L,me,kr*ie,vn*ie,lo*ie,N)}}++me}}}function uit(e,t){e.tile.intersectsClippingArea&&(e1e(e),Qve(e,!0),n5(e))}function hit(e,t){e.tile.intersectsClippingArea&&(Kve(e),n5(e))}function Kve(e,t){e.tile.intersectsClippingArea&&(e1e(e),Qve(e,!1))}function Qve(e,t){const r=e.geometryState,i=r.neighborData,s=e.tile,n=s.surface,o=s.extent,a=r.clippingArea,l=a??NW,c=o[0],u=o[2],d=o[1],p=o[3],g=[p>l[3],u>l[2],d<l[1],c<l[0]],y=e.geometry,_=s.horizontalScale,v=t1e(n.isWebMercatorOnPlateeCarree,s.ellipsoid.radius,_),w=y.boundingBox,T=y.uvRange[0],x=y.uvRange[1],S=y.uvRange[2],O=y.uvRange[3],A=Math.max(c,l[0]),$=Math.min(u,l[2]),P=Math.max(d,l[1]),U=Math.min(p,l[3]),I=e.localOrigin,L=I[0],N=I[1],Z=I[2],W=r.samplerData;for(let V=0;V<4;++V){const J=V===1||V===3,R=i.edgeResolutions[V];we(r1(R));const k=R+1,z=g[V],H=bv(s,i.edgePeerNeighbors[V]);if(!z&&o1e(s,H,V)){s1e(e,V,H);continue}const X=H!=null&&!z,Y=H?.renderData,ee=Y?.geometryState;if(Js&&(we(!X||H.level===s.level),we(!X||Cm(s,H)<=0),s&&!H&&!n.updatingRootTiles)){const Je=$p[V],Ke=s.findNeighborTile(Je,ht=>ht.isLoaded||ht.isLeaf||ht.level===s.level);n.updatingRootTiles||(Ke?Ke.intersectsClippingArea&&(we(!Ke.isLoaded),we(!Ke.isLeaf),we(Ke.level===s.level)):we(n?.rootTiles==null||!s.shouldHaveNeighbor(Je)))}const me=fe(V===1?u:c,A,$),$e=fe(V===0?p:d,P,U),pt=ee?.samplerData,St=y.outerEdges[V],it=t&&k>3?k-3:1,ft=fe(V===1?1:0,T,S),ge=fe(V===0?1:0,x,O),Ee=X?(Je,Ke)=>.5*(ki(Je,Ke,pt)+ki(Je,Ke,W)):(Je,Ke)=>ki(Je,Ke,W),_t=(u-c)/R,_e=J?V===1?_t:-_t:0,ke=J?0:V===0?_t:-_t,Ve=-_e,ct=-ke;let nt=0,ze=0,mt=0;{const Je=0/R,Ke=J?me:fe(c*(1-Je)+u*Je,A,$),ht=J?fe(d*(1-Je)+p*Je,P,U):$e,kt=Ee(Ke,ht);nt=Ke*_,ze=v(ht),mt=kt}let ir=0,qt=0,ai=0;{const Je=1/R,Ke=J?me:fe(c*(1-Je)+u*Je,A,$),ht=J?fe(d*(1-Je)+p*Je,P,U):$e,kt=Ee(Ke,ht);ir=Ke*_,qt=v(ht),ai=kt}for(let Je=1;Je<k-1;Je+=it){const Ke=Je/R,ht=ir,kt=qt,Xt=ai;{const Tr=J?ft:fe(Ke,T,S),qr=J?fe(Ke,x,O):ge,Ur=ht-L,lr=kt-N,Qr=Xt-Z;ju(ht,lr,Qr,w),St.setVertexFromValuesRawPositionUV(Je,Ur,lr,Qr,Tr,qr)}{const Tr=(Je+1)/R,qr=J?me:fe(c*(1-Tr)+u*Tr,A,$),Ur=J?fe(d*(1-Tr)+p*Tr,P,U):$e,lr=Ee(qr,Ur);ir=qr*_,qt=v(Ur),ai=lr}const Fr=ir,li=ai,zt=nt,ci=ze,Ai=mt;nt=ht,ze=kt,mt=Xt;let Ir=0,fr=0,Di=0;if(J){const Tr=qt-kt,qr=li-Xt,Ur=ci-kt,lr=Ai-Xt,Qr=fe(d*(1-Ke)+p*Ke,P,U),Ls=me+Ve,Bn=Ls*_-ht,Vn=ki(Ls,Qr,W)-Xt,tn=V===3?-1:1;if(Ir=tn*(-Ur+Tr)*Vn,fr=tn*Bn*(-lr+qr),Di=-tn*Bn*(-Ur+Tr),X){const rn=me+_e,Ni=rn*_-ht;Ir=(-Ur+Tr)*(Vn-(ki(rn,Qr,pt)-Xt)),fr=(Bn-Ni)*(-lr+qr),Di=-(Bn-Ni)*(-Ur+Tr)}}else{const Tr=Fr-ht,qr=li-Xt,Ur=zt-ht,lr=Ai-Xt,Qr=fe(c*(1-Ke)+u*Ke,A,$),Ls=$e+ct,Bn=ki(Qr,Ls,W)-Xt,Vn=v(Ls)-kt,tn=V===2?-1:1;if(Ir=tn*Vn*(-lr+qr),fr=tn*(-Ur+Tr)*Bn,Di=-tn*Vn*(-Ur+Tr),X){const rn=Qr,Ni=$e+ke,sn=v(Ni)-kt;Ir=(-Vn+sn)*(-lr+qr),fr=(-Ur+Tr)*(-Bn+(ki(rn,Ni,pt)-Xt)),Di=-(-Vn+sn)*(-Ur+Tr)}}const us=1/Math.sqrt(Ir*Ir+fr*fr+Di*Di);St.setNormalFromValues(Je,Ir*us,fr*us,Di*us)}}}function e1e(e,t){n1e(e)}function dit(e,t){return(Math.PI/2-2*Math.atan(Math.exp(-e/t)))*t}function pit(e,t){return e*t}function t1e(e,t,r){return e?i=>dit(i,t):i=>pit(i,r)}function r1e(e,t,r,i,s,n){const o=t-1,a=e.vertexAttributes.count,l=2*(Math.min(t-2,i[1])-Math.max(1,i[0]))*(Math.min(t-2,s[1])-Math.max(1,s[0])),c=$p.map((x,S)=>S===0&&s[1]<t-2||S===1&&i[1]<t-2||S===2&&s[0]>1||S===3&&i[0]>1),u=e.outerEdges.reduce((x,S,O)=>x+(c[O]?0:o-2+S.count-1),0),d=r.reduce((x,S)=>x+o*(2*(S.latitudeResolution-1)+1),0),p=n?2:1,g=3*(l+u+d)*p,y=a>=tit?new Uint32Array(g):new Uint16Array(g);let _=0;const v=t-2,w=o-2;we(w>=0);const T=(x,S,O,A,$,P)=>{const U=x*$,I=P[U],L=P[U+1],N=P[U+2],Z=S*$,W=P[Z],V=P[Z+1],J=P[Z+2],R=O*$,k=P[R],z=P[R+1],H=P[R+2],X=A*$,Y=P[X],ee=P[X+1],me=P[X+2];return(W-Y)*(W-Y)+(V-ee)*(V-ee)+(J-me)*(J-me)>(I-k)*(I-k)+(L-z)*(L-z)+(N-H)*(N-H)};if(n){const x=(O,A,$)=>{y[_++]=O,y[_++]=A,y[_++]=A,y[_++]=$,y[_++]=$,y[_++]=O,Js&&(we(O<a),we(A<a),we($<a),we(_<=g))};(()=>{for(let O=Math.max(s[0],1)-1;O<Math.min(s[1],t-2)-1;++O){const A=O*v;for(let $=Math.max(i[0],1)-1;$<Math.min(i[1],t-2)-1;++$){const P=O*v+$,U=P+1,I=U+v,L=I-1,N=A+$,Z=N+1,W=Z+v,V=W-1,J=e.vertexAttributes.position.typedBuffer,R=e.vertexAttributes.position.typedBufferStride;T(N,Z,W,V,R,J)?(x(P,U,I),x(I,L,P)):(x(P,U,L),x(L,I,U))}}})(),we(_===3*l*p),(()=>{for(let O=0;O<4;++O){const A=_;if(c[O])continue;const $=e.outerEdges[O],P=e.innerEdges[O];let U=0,I=0;const L=$.count,N=P.count;we(N===o-1);let Z=0;const W=O===1||O===2?(V,J,R)=>x(V,J,R):(V,J,R)=>x(V,R,J);for(;U<L-1||I<N-1;){const V=P.getVertexIndex(I),J=$.getVertexIndex(U),R=U<L-1,k=I<N-1;R&&(!k||(R?0+o*(U+.5)/(L-1):0)<=(k?1+w*(I+.5)/(N-1):0))?(++U,Js&&we(U<L),W(V,J,$.getVertexIndex(U)),Z++):(++I,Js&&we(I<N),W(V,J,P.getVertexIndex(I)),Z++)}Js&&(we(U===L-1),we(I===N-1),we(Z===L+N-2),we(Z===o-2+$.count-1),we(_===A+3*Z*p))}})(),we(_===3*(l+u)*p);const S=O=>{const A=e.outerEdges[O.connectedOuterEdgeOffset];let $=A.getVertexIndex(0),P=A.stride;for(let U=0;U<O.latitudeResolution;++U){const I=U===0?O.rowOffset:$+t;for(let L=0;L<o;L++)x($,$+1,I+L),U<O.latitudeResolution-1&&x($+1,I+L+1,I+L),$+=P;$=I,P=1}};r.forEach(S)}else{(()=>{const S=Math.max(s[0],1)-1,O=Math.min(s[1],t-2)-1,A=Math.max(i[0],1)-1,$=Math.min(i[1],t-2)-1;for(let P=S;P<O;++P){const U=P*v;for(let I=A;I<$;++I){const L=U+I,N=L+1,Z=N+v,W=Z-1,V=e.vertexAttributes.position.typedBuffer,J=e.vertexAttributes.position.typedBufferStride;T(L,N,Z,W,J,V)?(y[_]=L,y[_+1]=N,y[_+2]=Z,y[_+3]=Z,y[_+4]=W,y[_+5]=L):(y[_]=L,y[_+1]=N,y[_+2]=W,y[_+3]=W,y[_+4]=N,y[_+5]=Z),_+=6}}})(),we(_===3*l*p),(()=>{for(let S=0;S<4;++S){if(c[S])continue;const O=e.outerEdges[S],A=e.innerEdges[S];let $=0,P=0;const U=O.count,I=A.count;we(I===o-1);const L=S===1||S===2,N=L?1:2,Z=L?2:1,W=O.index0,V=O.stride,J=A.index0,R=A.stride;for(;$<U-1||P<I-1;){const k=J+P*R,z=W+$*V,H=$<U-1,X=P<I-1,Y=H&&(!X||(H?0+o*($+.5)/(U-1):0)<=(X?1+w*(P+.5)/(I-1):0));Y?++$:++P;const ee=Y?z+V:k+R;y[_]=k,y[_+N]=z,y[_+Z]=ee,_+=3}}})(),we(_===3*(l+u)*p);const x=S=>{const O=e.outerEdges[S.connectedOuterEdgeOffset];let A=O.getVertexIndex(0),$=O.stride;for(let P=0;P<S.latitudeResolution;++P){const U=P===0?S.rowOffset:A+t;for(let I=0;I<o;I++){const L=U+I;y[_]=A,y[_+1]=A+1,y[_+2]=L,P<S.latitudeResolution-1?(y[_+3]=A+1,y[_+4]=L+1,y[_+5]=L,_+=6):_+=3,A+=$}A=U,$=1}};r.forEach(x)}we(_===g),e.indices=y,e.indexCount=g}function i1e(e,t){const r=e.localOrigin,i=e.geometry,s=e.geometryState.neighborData.edgeResolutions,n=i.numVerticesPerSide-2,o=i.vertexAttributes;let a=t;for(let l=0;l<4;++l){{const c=l===0||l===2,u=(l===0?n-1:0)*n+(l===1?n-1:0),d=(c?0:1)*n+(c?1:0);i.innerEdges[l]=new rre(o,r,u,d,n)}{const c=a,u=s[l]+1;i.outerEdges[l]=new rre(o,r,c,1,u),a+=u}}}function s1e(e,t,r){const i=(t+2)%4,s=e.geometryState,n=e.tile,o=s.neighborData,a=n.level-r.level,l=t===1||t===3,c=o.edgeResolutions[t];we(r1(c));const u=c+1,d=e.geometry,p=d.boundingBox,g=d.outerEdges[t],y=d.uvRange[0],_=d.uvRange[1],v=d.uvRange[2],w=d.uvRange[3],T=fe(t===1?1:0,y,v),x=fe(t===0?1:0,_,w),S=r.renderData,O=S.geometryState,A=S.geometry.outerEdges[i],$=n.getNeighborEdgeStartVertexIndex(t,r)*c,P=c*2**a;we(O.neighborData.edgeResolutions[i]===P),we(A.count-1===P);const U=S.localOrigin[0]-e.localOrigin[0],I=S.localOrigin[1]-e.localOrigin[1],L=S.localOrigin[2]-e.localOrigin[2],N=g.attributes,Z=g.index0,W=g.stride,V=N.position.typedBuffer,J=N.position.typedBufferStride,R=N.normalCompressed.typedBuffer,k=N.normalCompressed.typedBufferStride,z=N.uv0,H=A.attributes,X=A.index0,Y=A.stride,ee=H.position.typedBuffer,me=H.position.typedBufferStride,$e=H.normalCompressed.typedBuffer,pt=H.normalCompressed.typedBufferStride;for(let St=1;St<u-1;++St){const it=Z+W*St,ft=X+Y*($+St),ge=it*J,Ee=ft*me,_t=ee[Ee]+U,_e=ee[Ee+1]+I,ke=ee[Ee+2]+L;V[ge]=_t,V[ge+1]=_e,V[ge+2]=ke,ju(_t,_e,ke,p);const Ve=it*k,ct=ft*pt;R[Ve]=$e[ct],R[Ve+1]=$e[ct+1];const nt=St/c,ze=l?T:fe(nt,y,v),mt=l?fe(nt,_,w):x;fd(z,it,ze,mt)}}function n1e(e){const t=e.geometryState,r=t.neighborData,i=e.localOrigin,s=r.cornerNeighborData,n=e.geometry,o=n.outerEdges,a=n.boundingBox,l=e.tile,c=e.tile.surface.view?.viewingMode==="local",u=l.ellipsoid.radius,d=l.extentInRadians,p=l.horizontalScale;let g=0,y=0,_=0;const v=(ge,Ee,_t)=>{const _e=d[Ee===0?1:3],ke=d[ge===0?0:2],Ve=Math.cos(_e),ct=Math.sin(_e),nt=Math.sin(ke),ze=Math.cos(ke),mt=u+_t;g=ze*Ve*mt,y=nt*Ve*mt,_=ct*mt},w=c?(()=>{const ge=e.geometryState.clippingArea,Ee=l.extent,_t=ge!=null&&(Ee[3]>ge[3]||Ee[2]>ge[2]||Ee[1]<ge[1]||Ee[0]<ge[0]),_e=t1e(l.surface.isWebMercatorOnPlateeCarree,l.ellipsoid.radius,p);return(ke,Ve,ct)=>{const nt=ke===0?Z[0]:Z[2],ze=Ve===0?Z[1]:Z[3],mt=_t?fe(nt,ge[0],ge[2]):nt,ir=_t?fe(ze,ge[1],ge[3]):ze,qt=ct;g=mt*p,y=_e(ir),_=qt}})():v;let T=0,x=0,S=0,O=0,A=0,$=0,P=0,U=0,I=0;const L=c&&e.tile.surface.isWebMercatorOnPlateeCarree,N=(ge,Ee,_t,_e,ke)=>{let Ve=0,ct=0,nt=0;if(c){const ze=Ee*p,mt=L?(Math.PI/2-2*Math.atan(Math.exp(-_t/u)))*u:_t*p;Ve=ze-g,ct=mt-y,nt=_e-_}else{const ze=DW(ge),mt=ge.tile,ir=mt.extent,qt=mt.extentInRadians,ai=(Ee-ir[0])/(ir[2]-ir[0]),Je=(_t-ir[1])/(ir[3]-ir[1]),Ke=qt[0]*(1-ai)+qt[2]*ai,ht=ze(Je),kt=Math.cos(ht),Xt=Math.sin(ht),Fr=Math.sin(Ke),li=Math.cos(Ke),zt=u+_e;Ve=li*kt*zt-g,ct=Fr*kt*zt-y,nt=Xt*zt-_}switch(ke){case 0:P+=Ve,U+=ct,I+=nt;break;case 1:O-=Ve,A-=ct,$-=nt;break;case 2:P-=Ve,U-=ct,I-=nt;break;case 3:O+=Ve,A+=ct,$+=nt}},Z=l.extent,W=t.clippingArea,V=W??NW,J=Z[0],R=Z[2],k=Z[1],z=Z[3],H=[z>V[3],R>V[2],k<V[1],J<V[0]],X=Math.max(J,V[0]),Y=Math.min(R,V[2]),ee=Math.max(k,V[1]),me=Math.min(z,V[3]),$e=n.uvRange[0],pt=n.uvRange[1],St=n.uvRange[2],it=n.uvRange[3],ft=ge=>{const Ee=s[ge].cornerTiles;T=0,x=0,S=1,O=0,A=0,$=0,P=0,U=0,I=0;let _t=1/0;for(let ze=0;ze<4;++ze)_t=Math.min(_t,Ee[ze]?.level??1/0);for(let ze=0;ze<4;++ze){const mt=Ee[ze];IS[ze]=mt?.level===_t?mt:null}let _e=1,ke=0;for(let ze=0;ze<4;++ze){const mt=IS[ze];mt&&(_e=Math.max(_e,mt?.renderData.geometryState.numVerticesPerSide),ke=mt.extent[2]-mt.extent[0])}const Ve=ke,ct=_e;we(ct>1);const nt=Ve/ct;for(let ze=0;ze<4;++ze){const mt=IS[(ze+3)%4],ir=IS[ze%4];if(!mt&&!ir)continue;const qt=ze===0?1:ze===1?2:ze===2?3:0,ai=ze===0?2:ze===1?3:ze===2?0:1;if(mt&&ir){const Je=MU[ze][0]*nt,Ke=MU[ze][1]*nt,ht=mt.extent,kt=ht[qt===0||qt===1?2:0]+Je,Xt=ht[qt===0||qt===3?3:1]+Ke,Fr=ir.extent,li=Fr[ai===0||ai===1?2:0]+Je,zt=Fr[ai===0||ai===3?3:1]+Ke,ci=mt.renderData,Ai=ir.renderData,Ir=ki(kt,Xt,ci.geometryState.samplerData),fr=ki(li,zt,Ai.geometryState.samplerData);N(ci,kt,Xt,.5*(Ir+fr),ze)}else{const Je=mt??ir,Ke=mt?qt:ai,ht=Je.extent,kt=MU[ze],Xt=ht[Ke===0||Ke===1?2:0]+kt[0]*nt,Fr=ht[Ke===0||Ke===3?3:1]+kt[1]*nt,li=Je.renderData,zt=ki(Xt,Fr,li.geometryState.samplerData);N(li,Xt,Fr,zt,ze)}}if(!c){const ze=Math.sqrt(g*g+y*y+_*_);T=g/ze,x=y/ze,S=_/ze}if(c||S*S<.999){const ze=Math.sqrt(O*O+A*A+$*$);O/=ze,A/=ze,$/=ze;const mt=Math.sqrt(P*P+U*U+I*I);P/=mt,U/=mt,I/=mt,T=$*U-A*I,x=O*I-$*P,S=A*P-O*U;const ir=1/Math.sqrt(T*T+x*x+S*S);T*=ir,x*=ir,S*=ir}};for(let ge=0;ge<4;++ge){const Ee=ge,_t=(ge+1)%4,_e=ge===0||ge===1?1:0,ke=ge===0||ge===3?1:0,Ve=fe(_e,$e,St),ct=fe(ke,pt,it),nt=o[Ee],ze=ge===0||ge===3?nt.count-1:0,mt=o[_t],ir=ge===0||ge===1?mt.count-1:0,qt=s[ge].cornerTiles;let ai=-1;for(let ht=0;ht<4;++ht){const kt=qt[ht];kt&&(ai===-1||Cm(qt[ai],kt)>0)&&(ai=ht)}const Je=ai,Ke=qt[Je];if(Ke!==l){const ht=l.level-Ke.level,kt=2**ht,Xt=[Ke.lij[0]+ht,Ke.lij[1]*kt,Ke.lij[2]*kt],Fr=[Xt[1]+kt===l.lij[1],ge===0&&(Je===1||Je===0&&Ke!==qt[3])||ge===1&&(Je===0||Je===1&&Ke!==qt[2]),Xt[1]===l.lij[1]+1,ge===2&&(Je===3||Je===2&&Ke!==qt[1])||ge===3&&(Je===2||Je===3&&Ke!==qt[0])],li=Fr.reduce((fr,Di)=>fr+(Di?1:0),0);we(li===1||li===2);let zt=-1,ci=-1;const Ai=Ke.renderData;if(li===1){const fr=Fr.findIndex(us=>us);we(0<=fr&&fr<=3),zt=(fr+2)%4;const Di=e.geometryState.neighborData.edgeResolutions[fr];ci=l.getNeighborEdgeStartVertexIndex(fr,Ke)*Di+Di*(fr===0&&ge===0||fr===1&&ge===0||fr===2&&ge===1||fr===3&&ge===3?1:0)}else{we(Fr[1]||Fr[3]),zt=Fr[1]?3:1;const fr=Ai.geometryState.neighborData.edgeResolutions[zt];ci=ge===0||ge===3?0:fr}const Ir=Ai.geometry.outerEdges[zt];{const fr=nt.index0+ze*nt.stride,Di=mt.index0+ir*mt.stride,us=Ir.index0+ci*Ir.stride;{const Tr=Ir.attributes.position,qr=Tr.typedBuffer,Ur=us*Tr.typedBufferStride,lr=e.localOrigin,Qr=Ir.localOrigin,Ls=qr[Ur]+Qr[0]-lr[0],Bn=qr[Ur+1]+Qr[1]-lr[1],Vn=qr[Ur+2]+Qr[2]-lr[2];ju(Ls,Bn,Vn,a);{const tn=nt.attributes.position,rn=tn.typedBuffer,Ni=fr*tn.typedBufferStride;rn[Ni]=Ls,rn[Ni+1]=Bn,rn[Ni+2]=Vn}{const tn=mt.attributes.position,rn=tn.typedBuffer,Ni=Di*tn.typedBufferStride;rn[Ni]=Ls,rn[Ni+1]=Bn,rn[Ni+2]=Vn}}fd(nt.attributes.uv0,fr,Ve,ct),fd(mt.attributes.uv0,Di,Ve,ct);{const Tr=Ir.attributes.normalCompressed.typedBuffer,qr=us*Ir.attributes.normalCompressed.typedBufferStride;{const Ur=nt.attributes.normalCompressed,lr=Ur.typedBuffer,Qr=fr*Ur.typedBufferStride;lr[Qr]=Tr[qr],lr[Qr+1]=Tr[qr+1]}{const Ur=mt.attributes.normalCompressed,lr=Ur.typedBuffer,Qr=Di*Ur.typedBufferStride;lr[Qr]=Tr[qr],lr[Qr+1]=Tr[qr+1]}}}}else{const ht=H[Ee],kt=H[_t];let Xt;if(ht||kt){const ci=fe(J*(1-_e)+R*_e,X,Y),Ai=fe(k*(1-ke)+z*ke,ee,me),Ir=t.samplerData;Xt=ki(ci,Ai,Ir)}else Xt=fit(qt);w(_e,ke,Xt),ft(ge);const Fr=g-i[0],li=y-i[1],zt=_-i[2];ju(Fr,li,zt,a),nt.setVertexFromValuesRawPositionUVNormal(ze,Fr,li,zt,Ve,ct,T,x,S),mt.setVertexFromValuesRawPositionUVNormal(ir,Fr,li,zt,Ve,ct,T,x,S)}}for(let ge=0;ge<4;++ge)IS[ge]=null}function fit(e){const t=e.reduce((n,o)=>Math.min(n,o?.level??1/0),1/0);Js&&(we(!e[0]||!e[2]||PB(e[0],e[2],et.SOUTH_WEST)),we(!e[1]||!e[3]||PB(e[1],e[3],et.NORTH_WEST)));let r=0,i=0;for(let n=0;n<4;++n){const o=e[n];if(o&&o.level===t){const a=n===0||n===1,l=n===0||n===3,c=o.extent,u=c[a?0:2],d=c[l?1:3],p=o.renderData?.geometryState?.samplerData;i+=ki(u,d,p),r++}}const s=r?i/r:0;return we(s!=null),s}function n5(e){const t=e.vao,r=e.geometry.vertexAttributes.position.typedBuffer;t.vertexBuffers.geometry.setSubData(r,0,0,r.length)}const MU=[[0,1],[1,0],[0,-1],[-1,0]],Kn=new ert,NW=k7(-1/0,-1/0,1/0,1/0),IS=[null,null,null,null];function o1e(e,t,r){if(!t)return!1;const i=Cm(e,t);return i>0||i===0&&r>=2}class mit extends MW{get horizontalScale(){return this._horizontalScaleFactor}constructor(t,r,i){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=Nt(),t!==void 0&&this.init(t,r,i)}init(t,r,i){super.init(t,r,i);const s=i.view.renderSpatialReference,n=i.spatialReference,o=s!=null&&M7(s)&&n!=null&&n.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this._extentInRenderSR,c=this.extent;if(a){const u=Ce(c[0],c[1],0);yn(u,st.WebMercator,u,st.PlateCarree);const d=Ce(c[2],c[3],0);yn(d,st.WebMercator,d,st.PlateCarree),l[0]=u[0],l[1]=u[1],l[2]=d[0],l[3]=d[1]}else for(let u=0;u<4;++u)l[u]=c[u]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const t=this._extentInRenderSR,r=.5*(t[2]-t[0]),i=.5*(t[3]-t[1]),s=Math.sqrt(r*r+i*i),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(s,n);this._center[Rs.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(t){const r=this._aabb(),i=r[0],s=r[1],n=r[2],o=r[3],a=r[4],l=r[5];let c=!0;for(let u=0;u<6;u++){const d=t[u],p=d[0],g=d[1],y=d[2],_=d[3];if(p*(p>0?i:o)+g*(g>0?s:a)+y*(y>0?n:l)+_>=0)return Uo.OUTSIDE;c=c&&p*(p<0?i:o)+g*(g<0?s:a)+y*(y<0?n:l)+_<=0}return c?Uo.INSIDE:Uo.INTERSECTS}_aabb(){const t=this._extentInRenderSR;return pMe(t[0],t[1],this.elevationBounds[0],t[2],t[3],this.elevationBounds[1])}intersectsRay(t,r,i,s){return zP[0]=1/r[0],zP[1]=1/r[1],zP[2]=1/r[2],dH(this._aabb(),t,zP,i,s)}createGeometry(){lit(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){uit(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){hit(this.renderData,this._horizontalScaleFactor)}}const zP=C();class git{constructor(){this.extent=Ht(),this.minLevel=0,this.maxLevel=0,this.callback=null}}let RI=class extends xe{constructor(){super(...arguments),this._queries=new Mt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Mt({initialSize:30}),this._queryPool=new fn(git)}queryVisibleLevelRange(e,t,r,i){const s=this._queryPool.acquire();$u(s.extent,e),s.minLevel=t??-Number.MAX_VALUE,s.maxLevel=r??Number.MAX_VALUE,s.callback=i,this._queryQueue.push(s),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const t=this._queries.data[e];this._queryPool.release(t),t.callback(e>=this._queriesInvPtr),t.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const t=e.level;let r=0;for(;r<this._queriesInvPtr;){const i=this._queries.data[r],s=i.extent;t>=i.minLevel&&t<=i.maxLevel&&s[0]<=e.extent[2]&&s[2]>=e.extent[0]&&s[1]<=e.extent[3]&&s[3]>=e.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}};h([f()],RI.prototype,"updating",null),RI=h([F("esri.views.3d.terrain.ScaleRangeQueries")],RI);class yit extends MW{get convexHull(){return this._convexHull}constructor(t,r,i){super(),this._convexHull=new Array(24),this._boundingSphere=ls(),t!==void 0&&this.init(t,r,i)}init(t,r,i){super.init(t,r,i);const s=this.ellipsoid.radius,n=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=t[0],u=yt(o,l,.5),d=yt(n,a,.5),p=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-n)*Math.cos(p)*s,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=s-Math.sqrt(s*s-this._edgeLen2/4),rde(this.centerAtSeaLevel,d,u,this.ellipsoid.radius),pe(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const t=this._center;if(this.lij[0]===0)se(t[Rs.MIDDLE],0,0,0),se(t[Rs.TOP],0,0,0),se(t[Rs.BOTTOM],0,0,0),t[Rs.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const r=t[Rs.MIDDLE],i=this.convexHull;let s=0;for(let n=0;n<8;++n)s=Math.max(s,_it(r,i,3*n));t[Rs.MIDDLE][3]=Math.sqrt(s)}}_calculateFrustumVisibilityStatus(t){if(!Z0(t,this._boundingSphere))return Uo.OUTSIDE;if(this.lij[0]<10)return Uo.INTERSECTS;const r=this.convexHull,i=this.surface.view.state.camera.near;let s=!0;for(let n=0;n<b2;n++){const o=n===ti.NEAR,a=t[n],l=a[0],c=a[1],u=a[2],d=a[3]-(o?i:0);let p=!1;for(let g=0;g<8;++g){const y=3*g;if(l*r[y]+c*r[y+1]+u*r[y+2]+d<0){if(p=!0,!s)break}else s=!1}if(!p)return Uo.OUTSIDE}return s?Uo.INSIDE:Uo.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){rit(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),Js&&this._checkBVs()}_updateBoundingSphere(){const t=this._boundingSphere,r=t,i=this.elevationBounds,s=this.ellipsoid.radius,n=i[1];if(this.level===0)se(r,0,0,0),t[3]=s+n;else{const o=this.extentInRadians,a=.5*(o[0]+o[2]),l=o[1],c=o[3];E_(gre,a,l,s),E_(yre,a,c,s),oe(r,gre,yre);const u=.5*(i[0]+i[1]);te(r,r,(s+u)/bl(r));const d=this.convexHull;let p=0;const g=(_,v)=>{const w=_[0]-d[3*v],T=_[1]-d[3*v+1],x=_[2]-d[3*v+2];return Math.sqrt(w*w+T*T+x*x)};for(let _=0;_<8;++_){const v=g(r,_);p=Math.max(p,v)}const y=p;t[3]=y+2}}_updateConvexHull(){const t=this.extentInRadians,r=this.ellipsoid.radius;if(this.level===0)return;const i=this.elevationBounds,s=this._getPatchType(),n=this.surface.isWebMercator,o=n&&s===Eu.HAS_NORTH_POLE,a=n&&s===Eu.HAS_SOUTH_POLE,l=a||o,c=Math.PI/2,u=t[0],d=t[2],p=a?-c:t[1],g=o?c:t[3],y=.5*(u+d),_=i[0],v=r+(l?Math.min(0,_-1):_),w=(J,R,k)=>E_(J,R,k,v),T=C(),x=C(),S=C(),O=C();w(T,u,p),w(x,u,g),w(S,d,g),w(O,d,p);const A=(J,R)=>{for(let k=0;k<3;++k)this._convexHull[3*R+k]=J[k]};A(T,0),A(x,1),A(S,2),A(O,3);const $=i[1],P=r+(l?Math.max(0,$+1):$),U=C(),I=C(),L=C();E_(I,y,g,v),E_(L,y,p,v),oe(U,I,L),pe(U,U);const N=C(),Z=C(),W=(J,R)=>{Ln(Z,J,R),pe(Z,Z);const k=-de(J,N)/de(Z,N);we(k>=0),te(Z,Z,k),oe(J,J,Z)};if(2**this.lij[0]>2*this.lij[1]){const J=L,R=C();rt(R,mre,J),pe(R,R),rt(N,J,R),pe(N,N),we(Au(de(N,J)/bl(J),0)),W(T,x),W(O,S),A(T,0),A(O,3)}else if(2**this.lij[0]!==2*this.lij[1]){const J=I,R=C();rt(R,mre,J),pe(R,R),rt(N,R,J),pe(N,N),W(x,T),W(S,O),A(x,1),A(S,2)}const V=(J,R)=>{const k=P/de(R,U);for(let z=0;z<3;++z)this._convexHull[3*J+z]=R[z]*k};V(4,T),V(5,x),V(6,S),V(7,O)}_getPatchType(){const t=this.lij[1],r=t===0,i=t===(1<<this.level)-1;return r?i?Eu.HAS_BOTH_POLES:Eu.HAS_NORTH_POLE:i?Eu.HAS_SOUTH_POLE:Eu.REGULAR}intersectsRay(t,r,i,s){const n=this._boundingSphere,o=n[3]+i,a=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],l=n[0]-t[0],c=n[1]-t[1],u=n[2]-t[2],d=(l*r[0]+c*r[1]+u*r[2])/a,p=r[0]*d-l,g=r[1]*d-c,y=r[2]*d-u;return p*p+g*g+y*y<o*o}getDefaultVerticesPerSide(){return this.level<fre.length?fre[this.level]+1:2}updateCornerElevations(){nit(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){sit(this.renderData),this._updateBoundingVolumes()}_checkBVs(){if(!Js||this.level<=2)return;const t=this._boundingSphere,r=t[3],i=t,s=C(),n=this.ellipsoid.radius,o=this.elevationBounds;o[1],o[0];const a=n+o[0],l=1,c=0,u=this._center[Rs.MIDDLE][3],d=this.convexHull,p=(_e,ke)=>{for(let Ve=0;Ve<3;++Ve)_e[Ve]=d[3*ke+Ve]};{const _e=C(),ke=C(),Ve=C(),ct=C(),nt=C(),ze=(mt,ir,qt,ai)=>{p(ke,mt),p(Ve,ir),p(ct,qt),Ln(ke,ke,Ve),Ln(ct,ct,Ve),rt(_e,ke,ct),pe(_e,_e);const Je=de(_e,Ve);p(nt,ai);const Ke=de(_e,nt),ht=Math.abs(Ke-Je);we(Au(ht,0),`Non coplanar ${mt},${ir},${qt},${ai} diff = ${ht}`)};ze(0,1,2,3),ze(4,5,6,7),ze(0,1,4,5),ze(1,2,5,6),ze(2,3,6,7),ze(3,0,7,4)}const g=To(24),y=(_e,ke,Ve)=>{const ct=4*_e;for(let nt=0;nt<3;++nt)g[ct+nt]=ke[nt];g[ct+3]=Ve},_=C(),v=C(),w=C(),T=C(),x=(_e,ke,Ve,ct)=>{p(_,ke),p(v,Ve),p(w,ct),Ln(_,_,v),pe(_,_),Ln(w,w,v),pe(w,w),rt(T,_,w),pe(T,T);const nt=de(T,v);y(_e,T,nt)};x(0,0,1,2),x(1,1,0,4),x(2,1,5,2),x(3,3,2,6),x(4,4,0,3),x(5,4,6,5);const S=1,O=(_e,ke,Ve,ct)=>{const nt=4*_e;return g[nt]*ke+g[nt+1]*Ve+g[nt+2]*ct-g[nt+3]},A=(_e,ke,Ve,ct)=>O(_e,ke,Ve,ct)>=-S,$=(_e,ke)=>A(_e,ke[0],ke[1],ke[2]),P=2**this.lij[0]>2*this.lij[1],U=(_e,ke,Ve)=>Math.sqrt(a1e(_e,ke,Ve,i[0],i[1],i[2]))<r,I=_e=>U(_e[0],_e[1],_e[2]),L=(_e,ke)=>U(_e[ke],_e[ke+1],_e[ke+2]),N=this.extentInRadians,Z=.5*(N[0]+N[2]),W=N[1],V=N[3],J=C(),R=C();E_(J,Z,V,a),E_(R,Z,W,a);const k=P?"Upper":"Lower";let z=!0;for(let _e=0;_e<6;++_e){for(let ke=0;ke<8;++ke){const Ve=3*ke,ct=A(_e,d[Ve],d[Ve+1],d[Ve+2]);z&&(z=ct),we(ct,`Tile[${this.lij}] Convex hull point ${ke} outside of plane ${_e}`)}we($(_e,R),`Tile[${this.lij}] (${k}) bottom mid outside of plane ${_e}`),we($(_e,J),`Tile[${this.lij}] (${k}) top mid outside of plane ${_e}`)}we(z,"Not all convex hull points are inside  convex hull polyhedron"),we(I(R),`Tile[${this.lij}] (${k}) bottom mid outside of bounding sphere`),we(I(J),`Tile[${this.lij}] (${k}) top mid outside of bounding sphere`);for(let _e=0;_e<8;++_e){const ke=L(d,3*_e);we(ke,`Tile[${this.lij}] Convex hull point ${_e} outside of bounding sphere`)}for(let _e=0;_e<6;++_e)for(let ke=0;ke<8;++ke){const Ve=3*ke;A(_e,d[Ve],d[Ve+1],d[Ve+2])||console.error(`Tile[${this.lij}] Convex hull point ${ke} outside of plane ${_e}`)}const H=this.extentInRadians,X=Math.max(H[2]-H[0],H[3]-H[1]),Y=Math.round(X*n),ee=this.renderData;if(!ee)return;const{geometry:me,localOrigin:$e}=ee,pt=me.vertexAttributes?.position;if(!pt)return;const St=pt.count,it=C(),ft=me.numVerticesPerSide-2,ge=ft*ft,Ee=ee.geometryState.neighborData,_t=Ee.edgeResolutions.reduce((_e,ke)=>_e+ke+1,0);for(let _e=0;_e<St;++_e){const ke=_e<ge,Ve=!ke&&_e<ge+_t;let ct=!1,nt=-1;if(Ve){let zt=ge;for(let ci=0;ci<4;++ci){const Ai=Ee.edgeResolutions[ci];if(_e===zt||_e===zt+Ai-1){ct=!0;break}if(zt+=Ai,_e<zt){nt=ci;break}}}const ze=Ve?Ee.edgePeerNeighbors[nt]:null,mt=Ve&&ze&&Cm(this,ze)>0;pt.getVec(_e,s),oe(it,s,$e);const ir=bl(it)-n;let qt=0,ai=!1;const Je=o[0]-ir,Ke=ir-o[1],ht=Je>l,kt=Ke>l,Xt=ht||kt,Fr=()=>{const zt=ke?"internal":Ve&&!ct?"edge":ct?"corner":"pole";return`Tile[${this.lij}].vertex[${_e}]:${zt}`+(ht?"(below)":kt?"(above)":"")+(mt?"(Neighbor)":"")},li=_3(it,i);if(li>=r+c){const zt=li-r;Xt||(console.error(`${Fr()} is out of the bounding sphere by ${zt.toFixed(0)} / ${r.toFixed(0)}[tol=${c}] h=${ir.toFixed(0)} / [${o[0].toFixed(0)}..${o[1].toFixed(0)}] (${(zt/r).toFixed(0)})`),ai=!0)}for(let zt=0;zt<6;++zt)if(!A(zt,it[0],it[1],it[2])){const ci=O(zt,it[0],it[1],it[2]),Ai=_e%ft,Ir=(_e-Ai)/ft;zt===0&&Je||zt===5&&Ke||(console.error(`${Fr()} (${Ai},${Ir})|${ft}] is out of the bounding trapezoid plane ${zt} h=${Math.round(ir)} / [${Math.round(o[0])}..${Math.round(o[1])}] dist=${Math.round(ci)} radii = ${Math.round(r)}/${Math.round(u)}} : maxL = ${Y}`),++qt)}if(ai||qt>0)break}}}const fre=[128,64,64,32,16,8,8,4];function _it(e,t,r){return a1e(e[0],e[1],e[2],t[r],t[r+1],t[r+2])}function a1e(e,t,r,i,s,n){const o=i-e,a=s-t,l=n-r;return o*o+a*a+l*l}const E_=(e,t,r,i)=>{const s=Math.cos(t),n=Math.sin(t),o=Math.cos(r),a=Math.sin(r);e[0]=i*o*s,e[1]=i*o*n,e[2]=i*a},mre=[0,0,1],gre=C(),yre=C();let Dh=class extends xe{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};h([f()],Dh.prototype,"fovX",void 0),h([f()],Dh.prototype,"fovY",void 0),h([f()],Dh.prototype,"relativeWidthLimit",void 0),h([f()],Dh.prototype,"relativeHeightLimit",void 0),h([f()],Dh.prototype,"maxLod",void 0),h([f()],Dh.prototype,"angledSplitBias",void 0),h([f()],Dh.prototype,"aboveGround",void 0),h([f()],Dh.prototype,"frustum",void 0),Dh=h([F("esri.views.3d.terrain.SplitLimits")],Dh);class l1e extends Yo{constructor(){super(...arguments),this.blendMode=Oe.Normal}}h([B({count:Oe.COUNT})],l1e.prototype,"blendMode",void 0);class XC extends l1e{constructor(){super(...arguments),this.output=dn.Composite,this.baseOpacityMode=ad.NotRequired,this.premultipliedSource=qh.Off}}h([B({count:dn.COUNT})],XC.prototype,"output",void 0),h([B({count:ad.COUNT})],XC.prototype,"baseOpacityMode",void 0),h([B()],XC.prototype,"premultipliedSource",void 0);var j1;function vit(e){const t=new pr;if(t.include(Gve),e.background===j1.Only){const r=e.output===dn.ColorComposite;return r?t.fragment.uniforms.add(new Rt("backgroundColor",i=>i.backgroundColor)):t.fragment.include(PW),t.fragment.code.add(b`
    void main() {
      fragColor = vec4(${r?b`backgroundColor`:b`gridColor(uv)`}, 1.0);
    }
  `),t}return t.include(jve,e),t.fragment.uniforms.add(new qe("tex",r=>r.texture)),t.fragment.uniforms.add(new Ae("opacity",r=>r.opacity)),t.fragment.code.add(b`void main() {
vec4 bgColor = getBackground(uv);
fragColor = blendLayers(bgColor, texture(tex, uv), opacity);
}`),t}(function(e){e[e.BelowLayer=0]="BelowLayer",e[e.Only=1]="Only",e[e.COUNT=2]="COUNT"})(j1||(j1={}));const bit=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return j1},build:vit},Symbol.toStringTag,{value:"Module"}));class wit extends Vve{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=wa}}class o5 extends xr{initializeProgram(t){return new vr(t.rctx,o5.shader.get().build(this.configuration),dr)}initializePipeline(){return Tt({blending:Vl(ve.ONE,ve.ONE_MINUS_SRC_ALPHA),colorWrite:It})}}o5.shader=new _r(bit,()=>ue(()=>import("./BlendLayers.glsl.08bfa5a7.js"),[]));class c1e extends XC{constructor(){super(...arguments),this.background=j1.BelowLayer}}h([B()],c1e.prototype,"background",void 0);class IU{constructor(t,r,i,s,n,o){this.texture=t,this.type=r,t.retain(),this.offsetAndScale=At(i.offset[0],i.offset[1],i.scale,i.scale),this.opacities=Ce(s,n,o)}destroy(){this.texture.release()}}function xit(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Tit(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function Sit(e,t,r,i,s,n,o){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e[4]=n,e[5]=o,e}function u1e(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5];let l=r*n-i*s;return l?(l=1/l,e[0]=n*l,e[1]=-i*l,e[2]=-s*l,e[3]=r*l,e[4]=(s*a-n*o)*l,e[5]=(i*o-r*a)*l,e):null}function Eit(e){return e[0]*e[3]-e[1]*e[2]}function h1e(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=r[0],u=r[1],d=r[2],p=r[3],g=r[4],y=r[5];return e[0]=i*c+n*u,e[1]=s*c+o*u,e[2]=i*d+n*p,e[3]=s*d+o*p,e[4]=i*g+n*y+a,e[5]=s*g+o*y+l,e}function FW(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=Math.sin(r),u=Math.cos(r);return e[0]=i*u+n*c,e[1]=s*u+o*c,e[2]=i*-c+n*u,e[3]=s*-c+o*u,e[4]=a,e[5]=l,e}function d1e(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=r[0],u=r[1];return e[0]=i*c,e[1]=s*c,e[2]=n*u,e[3]=o*u,e[4]=a,e[5]=l,e}function UW(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=r[0],u=r[1];return e[0]=i,e[1]=s,e[2]=n,e[3]=o,e[4]=i*c+n*u+a,e[5]=s*c+o*u+l,e}function Cit(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e[4]=0,e[5]=0,e}function Ait(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function kW(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function Oit(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function Rit(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)}function Pit(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e}function p1e(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}function Mit(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e}function Iit(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e}function $it(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function Lit(e,t){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=t[0],c=t[1],u=t[2],d=t[3],p=t[4],g=t[5],y=Ta();return Math.abs(r-l)<=y*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=y*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(s-u)<=y*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(n-d)<=y*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(o-p)<=y*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-g)<=y*Math.max(1,Math.abs(a),Math.abs(g))}const Dit=h1e,Nit=p1e;Object.freeze(Object.defineProperty({__proto__:null,add:Pit,copy:xit,determinant:Eit,equals:Lit,exactEquals:$it,frob:Rit,fromRotation:Cit,fromScaling:Ait,fromTranslation:kW,identity:Tit,invert:u1e,mul:Dit,multiply:h1e,multiplyScalar:Mit,multiplyScalarAndAdd:Iit,rotate:FW,scale:d1e,set:Sit,str:Oit,sub:Nit,subtract:p1e,translate:UW},Symbol.toStringTag,{value:"Module"}));function f1e(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function Fit(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Uit(e,t,r,i,s,n){const o=new Float32Array(6);return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function kit(e,t){return new Float32Array(e,t,6)}function m1e(e,t,r,i){const s=t[i],n=t[i+1];e[i]=r[0]*s+r[2]*n+r[4],e[i+1]=r[1]*s+r[3]*n+r[5]}function zit(e,t,r,i=0,s=0,n=2){const o=s||t.length/n;for(let a=i;a<o;a++)m1e(e,t,r,a*n)}Object.freeze(Object.defineProperty({__proto__:null,clone:Fit,create:f1e,createView:kit,fromValues:Uit,transform:m1e,transformMany:zit},Symbol.toStringTag,{value:"Module"}));function PI(){return[1,0,0,1,0,0]}function Bit(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function Vit(e,t,r,i,s,n){return[e,t,r,i,s,n]}function Git(e,t){return new Float64Array(e,t,6)}Object.freeze(Object.defineProperty({__proto__:null,clone:Bit,create:PI,createView:Git,fromValues:Vit},Symbol.toStringTag,{value:"Module"}));function jit(e){return e instanceof Float32Array&&e.length>=2}function Hit(e){return Array.isArray(e)&&e.length>=2}function $U(e){return jit(e)||Hit(e)}const Wit=96,qit=39.37;function zW(e,t){return t.type?Qt(e,t.x,t.y):en(e,t)}function Xit(e){return Sa(e)}function Zit(e,t){const r=e.targetGeometry,i=t.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}const Yit=function(){const e=Ne();return function(t,r,i){const s=r.targetGeometry;zW(e,s);const n=.5*a5(r);return t.xmin=e[0]-n*i[0],t.ymin=e[1]-n*i[1],t.xmax=e[0]+n*i[0],t.ymax=e[1]+n*i[1],t.spatialReference=s.spatialReference,t}}();function a5(e){return e.scale*Jit(e.targetGeometry)}function Jit(e){return e!=null&&jo(e.spatialReference)?1/(Xit(e.spatialReference)*qit*Wit):1}function Kit(e){return TD(e.rotation)||0}const BW=function(){const e=Ne(),t=Ne(),r=Ne();return function(i,s,n,o,a,l){return sj(e,s),Pl(t,n,.5*l),Qt(r,1/o*l,-1/o*l),kW(i,t),a&&FW(i,i,a),d1e(i,i,r),UW(i,i,e),i}}(),Qit=function(){const e=Ne();return function(t,r,i,s){const n=a5(r),o=Kit(r);return zW(e,r.targetGeometry),BW(t,e,i,n,o,s)}}(),est=function(){const e=Ne();return function(t,r,i,s){const n=a5(r);return zW(e,r.targetGeometry),BW(t,e,i,n,0,s)}}();function tst(e){const t=Fv(e);return t?t.valid[1]-t.valid[0]:0}function rst(e,t){return Math.round(tst(e)/t)}var IB;const Pf=[0,0];let f0=IB=class extends Pe{constructor(e){super(e),this._viewpoint2D={center:Ne(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new Pr,this.id=0,this.inverseTransform=PI(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=PI(),this.transformNoRotation=PI(),this.displayMat3=Ya(),this.displayViewMat3=Ya(),this.viewMat3=Ya(),this.viewMat2d=f1e(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){const t=this._viewpoint2D,r=e.targetGeometry;t.center[0]=r.x,t.center[1]=r.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=r.spatialReference}this._update()}copy(e){const t=this.size,r=this.viewpoint;return r&&t?(this.viewpoint=Zit(r,e.viewpoint),this._set("size",en(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new IB({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,r){return $U(t)?W_(e,t,this.inverseTransform):(Pf[0]=t,Pf[1]=r,W_(e,Pf,this.inverseTransform))}toScreen(e,t,r){return $U(t)?W_(e,t,this.transform):(Pf[0]=t,Pf[1]=r,W_(e,Pf,this.transform))}toScreenNoRotation(e,t,r){return $U(t)?W_(e,t,this.transformNoRotation):(Pf[0]=t,Pf[1]=r,W_(e,Pf,this.transformNoRotation))}getScreenTransform(e,t){const{center:r}=this._viewpoint2D,i=this._get("pixelRatio")||1,s=this._get("size");return BW(e,r,s,t,0,i),e}_update(){const{center:e,spatialReference:t,scale:r,rotation:i}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new zl({targetGeometry:new ut(e[0],e[1],t),scale:r,rotation:i});if(this._set("viewpoint",o),!n||!t||!r)return;this.resolution=a5(o),this.rotation=i,this.scale=r,this.spatialReference=t,en(this.center,e);const a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;yj(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=_j(this.viewMat3),u=Cu(n[0]/2,n[1]/2),d=Cu(-n[0]/2,-n[1]/2),p=TD(i);hL(c,c,u),vj(c,c,p),hL(c,c,d),AT(this.displayViewMat3,this.displayMat3,c);const g=kW(this.viewMat2d,u);return FW(g,g,p),UW(g,g,d),Yit(this.extent,o,n),Qit(this.transform,o,n,s),u1e(this.inverseTransform,this.transform),est(this.transformNoRotation,o,n,s),this.worldScreenWidth=rst(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};h([f({readOnly:!0})],f0.prototype,"id",void 0),h([f({value:1,json:{write:!0}})],f0.prototype,"pixelRatio",null),h([f({json:{write:!0}})],f0.prototype,"size",null),h([f()],f0.prototype,"spatialReference",void 0),h([f({type:zl,json:{write:!0}})],f0.prototype,"viewpoint",null),f0=IB=h([F("esri.views.2d.ViewState")],f0);const ist=f0;var $B,LB,_re,vre,bre,wre,xre,Tre,Sre,Ere,Cre,Are,Ore,Rre,Pre,Mre,Ire,$re,Lre,Dre,Nre,Fre,Ure,kre,zre,Bre,Vre,Gre,jre,Hre,Wre,qre,Xre,Zre,Yre,Jre,Kre,Qre,eie,tie,rie,iie,sie,nie,oie,aie,lie,cie,uie,hie,die,pie,fie,mie,gie,yie,_ie,vie,bie,wie,xie;(function(e){e[e.BUTT=0]="BUTT",e[e.ROUND=1]="ROUND",e[e.SQUARE=2]="SQUARE",e[e.UNKNOWN=4]="UNKNOWN"})($B||($B={})),function(e){e[e.BEVEL=0]="BEVEL",e[e.ROUND=1]="ROUND",e[e.MITER=2]="MITER",e[e.UNKNOWN=4]="UNKNOWN"}(LB||(LB={})),function(e){e[e.SCREEN=0]="SCREEN",e[e.MAP=1]="MAP"}(_re||(_re={})),function(e){e[e.Tint=0]="Tint",e[e.Ignore=1]="Ignore",e[e.Multiply=99]="Multiply"}(vre||(vre={})),function(e){e.Both="Both",e.JustBegin="JustBegin",e.JustEnd="JustEnd",e.None="None"}(bre||(bre={})),function(e){e[e.Mosaic=0]="Mosaic",e[e.Centered=1]="Centered"}(wre||(wre={})),function(e){e[e.Normal=0]="Normal",e[e.Superscript=1]="Superscript",e[e.Subscript=2]="Subscript"}(xre||(xre={})),function(e){e[e.MSSymbol=0]="MSSymbol",e[e.Unicode=1]="Unicode"}(Tre||(Tre={})),function(e){e[e.Unspecified=0]="Unspecified",e[e.TrueType=1]="TrueType",e[e.PSOpenType=2]="PSOpenType",e[e.TTOpenType=3]="TTOpenType",e[e.Type1=4]="Type1"}(Sre||(Sre={})),function(e){e[e.Display=0]="Display",e[e.Map=1]="Map"}(Ere||(Ere={})),function(e){e.None="None",e.Loop="Loop",e.Oscillate="Oscillate"}(Cre||(Cre={})),function(e){e[e.Z=0]="Z",e[e.X=1]="X",e[e.Y=2]="Y"}(Are||(Are={})),function(e){e[e.XYZ=0]="XYZ",e[e.ZXY=1]="ZXY",e[e.YXZ=2]="YXZ"}(Ore||(Ore={})),function(e){e[e.Rectangle=0]="Rectangle",e[e.RoundedRectangle=1]="RoundedRectangle",e[e.Oval=2]="Oval"}(Rre||(Rre={})),function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.Screen=2]="Screen",e[e.Multiply=3]="Multiply",e[e.Add=4]="Add"}(Pre||(Pre={})),function(e){e[e.TTB=0]="TTB",e[e.RTL=1]="RTL",e[e.BTT=2]="BTT"}(Mre||(Mre={})),function(e){e[e.None=0]="None",e[e.SignPost=1]="SignPost",e[e.FaceNearPlane=2]="FaceNearPlane"}(Ire||(Ire={})),function(e){e[e.Float=0]="Float",e[e.String=1]="String",e[e.Boolean=2]="Boolean"}($re||($re={})),function(e){e[e.Intersect=0]="Intersect",e[e.Subtract=1]="Subtract"}(Lre||(Lre={})),function(e){e.OpenEnded="OpenEnded",e.Block="Block",e.Crossed="Crossed"}(Dre||(Dre={})),function(e){e.FullGeometry="FullGeometry",e.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",e.ReversedFirstSegment="ReversedFirstSegment",e.PerpendicularToSecondSegment="PerpendicularToSecondSegment",e.SecondSegmentWithTicks="SecondSegmentWithTicks",e.DoublePerpendicular="DoublePerpendicular",e.OppositeToFirstSegment="OppositeToFirstSegment",e.TriplePerpendicular="TriplePerpendicular",e.HalfCircleFirstSegment="HalfCircleFirstSegment",e.HalfCircleSecondSegment="HalfCircleSecondSegment",e.HalfCircleExtended="HalfCircleExtended",e.OpenCircle="OpenCircle",e.CoverageEdgesWithTicks="CoverageEdgesWithTicks",e.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",e.GapExtentMidline="GapExtentMidline",e.Chevron="Chevron",e.PerpendicularWithArc="PerpendicularWithArc",e.ClosedHalfCircle="ClosedHalfCircle",e.TripleParallelExtended="TripleParallelExtended",e.ParallelWithTicks="ParallelWithTicks",e.Parallel="Parallel",e.PerpendicularToFirstSegment="PerpendicularToFirstSegment",e.ParallelOffset="ParallelOffset",e.OffsetOpposite="OffsetOpposite",e.OffsetSame="OffsetSame",e.CircleWithArc="CircleWithArc",e.DoubleJog="DoubleJog",e.PerpendicularOffset="PerpendicularOffset",e.LineExcludingLastSegment="LineExcludingLastSegment",e.MultivertexArrow="MultivertexArrow",e.CrossedArrow="CrossedArrow",e.ChevronArrow="ChevronArrow",e.ChevronArrowOffset="ChevronArrowOffset",e.PartialFirstSegment="PartialFirstSegment",e.Arch="Arch",e.CurvedParallelTicks="CurvedParallelTicks",e.Arc90Degrees="Arc90Degrees"}(Nre||(Nre={})),function(e){e.Mitered="Mitered",e.Bevelled="Bevelled",e.Rounded="Rounded",e.Square="Square",e.TrueBuffer="TrueBuffer"}(Fre||(Fre={})),function(e){e.ClosePath="ClosePath",e.ConvexHull="ConvexHull",e.RectangularBox="RectangularBox"}(Ure||(Ure={})),function(e){e.BeginningOfLine="BeginningOfLine",e.EndOfLine="EndOfLine"}(kre||(kre={})),function(e){e.Mitered="Mitered",e.Bevelled="Bevelled",e.Rounded="Rounded",e.Square="Square"}(zre||(zre={})),function(e){e.Fast="Fast",e.Accurate="Accurate"}(Bre||(Bre={})),function(e){e.BeginningOfLine="BeginningOfLine",e.EndOfLine="EndOfLine"}(Vre||(Vre={})),function(e){e.Sinus="Sinus",e.Square="Square",e.Triangle="Triangle",e.Random="Random"}(Gre||(Gre={})),function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Force=2]="Force"}(jre||(jre={})),function(e){e[e.Buffered=0]="Buffered",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.AlongLine=3]="AlongLine"}(Hre||(Hre={})),function(e){e[e.Linear=0]="Linear",e[e.Rectangular=1]="Rectangular",e[e.Circular=2]="Circular",e[e.Buffered=3]="Buffered"}(Wre||(Wre={})),function(e){e[e.Discrete=0]="Discrete",e[e.Continuous=1]="Continuous"}(qre||(qre={})),function(e){e[e.AcrossLine=0]="AcrossLine",e[e.AloneLine=1]="AloneLine"}(Xre||(Xre={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Center=2]="Center",e[e.Justify=3]="Justify"}(Zre||(Zre={})),function(e){e[e.Base=0]="Base",e[e.MidPoint=1]="MidPoint",e[e.ThreePoint=2]="ThreePoint",e[e.FourPoint=3]="FourPoint",e[e.Underline=4]="Underline",e[e.CircularCW=5]="CircularCW",e[e.CircularCCW=6]="CircularCCW"}(Yre||(Yre={})),function(e){e.Butt="Butt",e.Round="Round",e.Square="Square"}(Jre||(Jre={})),function(e){e.NoConstraint="NoConstraint",e.HalfPattern="HalfPattern",e.HalfGap="HalfGap",e.FullPattern="FullPattern",e.FullGap="FullGap",e.Custom="Custom"}(Kre||(Kre={})),function(e){e[e.None=-1]="None",e[e.Custom=0]="Custom",e[e.Circle=1]="Circle",e[e.OpenArrow=2]="OpenArrow",e[e.ClosedArrow=3]="ClosedArrow",e[e.Diamond=4]="Diamond"}(Qre||(Qre={})),function(e){e[e.ExtraLeading=0]="ExtraLeading",e[e.Multiple=1]="Multiple",e[e.Exact=2]="Exact"}(eie||(eie={})),function(e){e.Bevel="Bevel",e.Round="Round",e.Miter="Miter"}(tie||(tie={})),function(e){e[e.Default=0]="Default",e[e.String=1]="String",e[e.Numeric=2]="Numeric"}(rie||(rie={})),function(e){e[e.InsidePolygon=0]="InsidePolygon",e[e.PolygonCenter=1]="PolygonCenter",e[e.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(iie||(iie={})),function(e){e[e.Tint=0]="Tint",e[e.Replace=1]="Replace",e[e.Multiply=2]="Multiply"}(sie||(sie={})),function(e){e[e.ClipAtBoundary=0]="ClipAtBoundary",e[e.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",e[e.DoNotTouchBoundary=2]="DoNotTouchBoundary",e[e.DoNotClip=3]="DoNotClip"}(nie||(nie={})),function(e){e.NoConstraint="NoConstraint",e.WithMarkers="WithMarkers",e.WithFullGap="WithFullGap",e.WithHalfGap="WithHalfGap",e.Custom="Custom"}(oie||(oie={})),function(e){e.Fixed="Fixed",e.Random="Random",e.RandomFixedQuantity="RandomFixedQuantity"}(aie||(aie={})),function(e){e.LineMiddle="LineMiddle",e.LineBeginning="LineBeginning",e.LineEnd="LineEnd",e.SegmentMidpoint="SegmentMidpoint"}(lie||(lie={})),function(e){e.OnPolygon="OnPolygon",e.CenterOfMass="CenterOfMass",e.BoundingBoxCenter="BoundingBoxCenter"}(cie||(cie={})),function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High"}(uie||(uie={})),function(e){e[e.MarkerCenter=0]="MarkerCenter",e[e.MarkerBounds=1]="MarkerBounds"}(hie||(hie={})),function(e){e[e.None=0]="None",e[e.PropUniform=1]="PropUniform",e[e.PropNonuniform=2]="PropNonuniform",e[e.DifUniform=3]="DifUniform",e[e.DifNonuniform=4]="DifNonuniform"}(die||(die={})),function(e){e.Tube="Tube",e.Strip="Strip",e.Wall="Wall"}(pie||(pie={})),function(e){e[e.Random=0]="Random",e[e.Increasing=1]="Increasing",e[e.Decreasing=2]="Decreasing",e[e.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(fie||(fie={})),function(e){e[e.Relative=0]="Relative",e[e.Absolute=1]="Absolute"}(mie||(mie={})),function(e){e[e.Normal=0]="Normal",e[e.LowerCase=1]="LowerCase",e[e.Allcaps=2]="Allcaps"}(gie||(gie={})),function(e){e[e.LTR=0]="LTR",e[e.RTL=1]="RTL"}(yie||(yie={})),function(e){e.Draft="Draft",e.Picture="Picture",e.Text="Text"}(_ie||(_ie={})),function(e){e[e.Top=0]="Top",e[e.Center=1]="Center",e[e.Baseline=2]="Baseline",e[e.Bottom=3]="Bottom"}(vie||(vie={})),function(e){e[e.Right=0]="Right",e[e.Upright=1]="Upright"}(bie||(bie={})),function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Large=2]="Large"}(wie||(wie={})),function(e){e[e.Calm=0]="Calm",e[e.Rippled=1]="Rippled",e[e.Slight=2]="Slight",e[e.Moderate=3]="Moderate"}(xie||(xie={}));var DB,wv,NB,pD,FB,fD,UB,xv,kB;(function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.FILL=1]="FILL",e[e.LINE=2]="LINE",e[e.SYMBOL=3]="SYMBOL",e[e.CIRCLE=4]="CIRCLE"})(DB||(DB={})),function(e){e[e.VISIBLE=0]="VISIBLE",e[e.NONE=1]="NONE"}(wv||(wv={})),function(e){e[e.POINT=0]="POINT",e[e.LINE=1]="LINE",e[e.LINE_CENTER=2]="LINE_CENTER"}(NB||(NB={})),function(e){e[e.MAP=0]="MAP",e[e.VIEWPORT=1]="VIEWPORT",e[e.AUTO=2]="AUTO"}(pD||(pD={})),function(e){e[e.AUTO=0]="AUTO",e[e.LEFT=1]="LEFT",e[e.CENTER=2]="CENTER",e[e.RIGHT=3]="RIGHT"}(FB||(FB={})),function(e){e[e.CENTER=0]="CENTER",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.TOP=3]="TOP",e[e.BOTTOM=4]="BOTTOM",e[e.TOP_LEFT=5]="TOP_LEFT",e[e.TOP_RIGHT=6]="TOP_RIGHT",e[e.BOTTOM_LEFT=7]="BOTTOM_LEFT",e[e.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(fD||(fD={})),function(e){e[e.NONE=0]="NONE",e[e.UPPERCASE=1]="UPPERCASE",e[e.LOWERCASE=2]="LOWERCASE"}(UB||(UB={})),function(e){e[e.MAP=0]="MAP",e[e.VIEWPORT=1]="VIEWPORT"}(xv||(xv={})),function(e){e[e.HORIZONTAL=0]="HORIZONTAL",e[e.VERTICAL=1]="VERTICAL"}(kB||(kB={}));class wh{}wh.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:wv.VISIBLE}},wh.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:wv.VISIBLE}},wh.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:wv.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:$B.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:LB.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},wh.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:wv.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:NB.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:fD.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:pD.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:fD.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:FB.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:pD.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:UB.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[kB.HORIZONTAL]}},wh.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:wv.VISIBLE}},wh.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},wh.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:xv.MAP}},wh.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:xv.MAP},"line-width":{type:"number",minimum:0,default:1}},wh.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:xv.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:xv.MAP}},wh.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},wh.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:xv.MAP}};const sst=.125;class nst{constructor(){this._renderParams={context:null,drawPhase:1,state:new ist({viewpoint:new zl({targetGeometry:new ut(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null}}dispose(){this._renderParams=null}render(t,r,i,s,n,o,a,l,c,u,d){this._render(t,r,i,s,n,o,a,l,c,u,d)}renderSymbols(t,r,i,s,n,o,a,l,c,u,d){this._render(t,r,i,s,n,o,a,l,c,u,d,DB.SYMBOL)}_render(t,r,i,s,n,o,a,l,c,u,d,p){const g=r[0]-o.getLevelShift(r[0]),y=this._renderParams;y.context=t,y.painter=s,y.glyphMosaic=s.glyphMosaic,y.spriteMosaic=s.spriteMosaic,y.pixelRatio=u*d,y.displayLevel=g,y.requiredLevel=g;const _=o.getScale(r[0]),[v,w]=o.getOffset(r,a*_),T=sst*a*_/c,x=i.transforms.dvs;x[0]=T,x[4]=-T,x[6]=-1-v-l[0]*a*2,x[7]=1+w+(1-l[1])*a*2-2,y.state.size[0]=c/d,y.state.size[1]=c/d,y.state.pixelRatio=d,i.stage||i.attachWithContext(t),i.triangleCount=0,s.drawTile(y,i,n,p)}}class l5 extends xr{initializeProgram(t){return new vr(t.rctx,l5.shader.get().build(this.configuration),dr)}initializePipeline(){return Tt({blending:Vl(ve.ONE,ve.ONE_MINUS_SRC_ALPHA),colorWrite:It})}}l5.shader=new _r(Srt,()=>ue(()=>import("./RasterColorizer.glsl.86ee1a10.js"),[]));class GE extends XC{constructor(){super(...arguments),this.colorizerType=Kv.Stretch,this.stretchType=G1.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}}h([B({count:Kv.COUNT})],GE.prototype,"colorizerType",void 0),h([B({count:G1.COUNT})],GE.prototype,"stretchType",void 0),h([B()],GE.prototype,"applyColormap",void 0),h([B()],GE.prototype,"requireBilinearWithNN",void 0);class Tie{constructor(t){this._rctx=t,this._fbos=new Map}get(t){return this._getPool(t)}dispose(){this._fbos.forEach(t=>t.dispose()),this._fbos.clear()}_getPool(t){const r=this._fbos.get(t);if(r)return r;const i=new Bi(this._rctx,new hr(t),new pL(Ns.DEPTH_COMPONENT16,t));return this._fbos.set(t,i),i}}const ost=K.getLogger("esri.views.3d.terrain");class ast{constructor(t,r){this._rctx=t,this._techniqueRepository=r,this._fbos=[],this._vectorTileHelper=new nst,this._bindParameters=new BN(null,null,null),this._blendLayersTechniqueConfig=new c1e,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=el(this._rctx,G3)}dispose(){this._fbos.forEach(De),this._fbos=null,this._vtFBO=De(this._vtFBO),this._vaoQuad=De(this._vaoQuad),this._vectorTileHelper=De(this._vectorTileHelper),this._backgroundTechnique=Mi(this._backgroundTechnique),this._applyOpacityTechnique=Mi(this._applyOpacityTechnique),this._blendLayersTechnique=Mi(this._blendLayersTechnique)}_getBlendLayersTechnique(t,r,i,s=qh.Off,n=j1.BelowLayer){return this._blendLayersTechniqueConfig.output=r,this._blendLayersTechniqueConfig.blendMode=t,this._blendLayersTechniqueConfig.baseOpacityMode=i,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechniqueConfig.background=n,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(o5,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(t,r){const i=this._getBlendLayersTechnique(Oe.Normal,r?dn.ColorComposite:dn.GridComposite,ad.NotRequired,qh.Off,j1.Only),s=this._rctx.bindTechnique(i,t,this._bindParameters);this._render(s)}_render(t){this._rctx.bindVAO(this._vaoQuad),t.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(bt.TRIANGLE_STRIP,0,vo(this._vaoQuad,"geometry"))}drawGroup(t,r,i,s,n,o=qh.On){r===dn.Composite&&(t.fboTexture=this._fbos[this.getLastOnHoldId()].get(i).colorTexture),t.texture=this.currentFBO(i).colorTexture,this.closeGroup(i);const a=this._getBlendLayersTechnique(s,r,n,o),l=this._rctx.bindTechnique(a,t,this._bindParameters);this._render(l)}drawRasterData(t,r,i,s,n,o=qh.Off){if(t.texture==null)return;t.fboTexture=r===dn.GroupBackgroundComposite||s===Oe.Normal&&n===ad.NotRequired&&o===qh.Off?null:this.switch(i).colorTexture;const a=this._getBlendLayersTechnique(s,r,n,o),l=this._rctx.bindTechnique(a,t,this._bindParameters);this._render(l)}drawImageryTileData(t,r,i,s,n,o){const a=o.sourceLayerInfo.data;if(!a.source||(o.tile.surface.layerViewByIndex(o.layerIndex,jt.MAP).ensureSymbolizerParameters(a),!a.bind(this._rctx)))return;t.fboTexture=s===Oe.Normal&&n===ad.NotRequired?null:this.switch(i).colorTexture;const l=this._getRasterColorizerTechnique(a,r,s,n);a.opacity=t.opacity;const c=a.getUniforms();c.scale=o.scale,c.offset=o.offset,c.backgroundColor=t.backgroundColor,c.fboTexture=t.fboTexture,c.baseOpacity=t.baseOpacity;const u=this._rctx.bindTechnique(l,c,null);this._render(u)}_getRasterColorizerTechnique(t,r,i,s){const n=t.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new GE,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=r,this._rasterColorizerConfig.blendMode=i,this._rasterColorizerConfig.baseOpacityMode=s,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.requireBilinearWithNN=t.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=t.hasStretchTypeNone()?G1.Noop:G1.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(l5,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(t,r,i,s,n,o,a,l,c){const u=this._rctx,d=o.sourceLayerInfo.data,p=o.tile.surface.layerViewByIndex(o.layerIndex,jt.MAP),g=n===ad.Required||t.opacity<1||s!==Oe.Normal||r!==dn.Composite,y=g?qh.On:qh.Off;this._getBlendLayersTechnique(s,r,n,y).bindPipelineState(u);let _=null,v=null;g?(v=this.currentFBO(i),this._vtFBO==null&&(this._vtFBO=new Tie(this._rctx)),_=this._vtFBO.get(i),u.bindFramebuffer(_),this._clearCurrentFBO()):c&&u.clearSafe(fi.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(u,o.sourceLod,d,p.painter,p.layer.styleRepository,p.schemaHelper,Math.round(1/o.scale),o.offset,l,a,p.contentZoom),o.vtlNeighborInfos.forAll(w=>this._vectorTileHelper.renderSymbols(u,w.sourceLod,w.sourceLayerInfo.data,p.painter,p.layer.styleRepository,p.schemaHelper,1,w.offset,l,a,p.contentZoom))}catch(w){ost.warnOnce("A render call containing vector tiles did not resolve correctly.",w)}return _==null||(u.bindFramebuffer(v),t.texture=_.colorTexture,t.offset=vd,t.scale=1,this.drawRasterData(t,r,i,s,n,y),c)}copyFBOToTexture(t){const r=this._rctx,i=r.bindTexture(t.texture,wt.TEXTURE_UNIT_FOR_UPDATES),s=t.descriptor;r.gl.copyTexImage2D(Ji.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),t.generateMipmap(),r.bindTexture(i,wt.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(fi.COLOR_BUFFER_BIT|fi.DEPTH_BUFFER_BIT)}_initFBO(t,r,i){this._rctx.bindFramebuffer(t),i&&(this._rctx.setViewport(0,0,r,r),this._clearCurrentFBO())}ensureBuffer(t){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(t)}bind(t,r=0,i=!0){if(this._current=r,r>=this._fbos.length)for(let s=this._fbos.length;s<=r;s++)this._fbos.push(new Tie(this._rctx));this._initFBO(this._fbos[r].get(t),t,i)}_bindNextFreeBuffer(t){this._lastUsedIds.length>0?this.bind(t,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(t,this._lastCreatedBufferId))}openGroup(t){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(t)}switch(t){const r=this.currentFBO(t),i=this._current;return this._bindNextFreeBuffer(t),this._lastUsedIds.push(i),r}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(t){const r=this._current;this._bindNextFreeBuffer(t),this._lastUsedIds.push(r),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(t){return this._fbos[this._current].get(t)}}class lst{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.vtlNeighborInfos=new Mt({allocator:t=>t||new cst})}}class cst{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}}class ust{constructor(t,r,i,s){this.start=t,this.end=r,this.blendMode=i,this.opacity=s}}class hst{constructor(t,r,i){this._rctx=t,this.tileSize=r,this._techniqueRepository=i,this._passParameters=new wit,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new ast(this._rctx,this._techniqueRepository),this._blackTex=new jw(S5e(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=De(this._composition),this._backgroundTexture=Mi(this._backgroundTexture),this._blackTex=Mi(this._blackTex)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateTileTexture(t,r){if(!t.renderData)return;const i=t.surface,s=i.baseOpacity;let n=0,o=0,a=this.tileSize,l=!1;const c=i.view.state.contentPixelRatio;let u=!1;mD.clear(),iw.length=0;const d=t.layerInfo[jt.MAP];let p=d.length,g=0,y=null;for(;g<d.length;g++){const v=i.layerViewByIndex(g,jt.MAP),w=v.layer.opacity;Sie[g]=w;const T=v.fullOpacity;if(Eie[g]=T,rpe(v.layer)&&p>=d.length&&(p=g),lD(v)){Cie[g]=v.layer.blendMode;let S=v.layer.blendMode!=="normal";if(vT(v.layer.parent)){const O=zB(v.layer.parent);O!=null&&O!==""&&(S=g1e(v.layer.parent)||S)}S&&(u=S,l=!1)}if(w===0&&!u){d[g].pendingUpdates&=~(dt.TEXTURE_NOFADING&dt.TEXTURE_FADING);continue}++o;const x=LU(t,g);if(x){if(d[g].pendingUpdates&=~(dt.TEXTURE_NOFADING&dt.TEXTURE_FADING),vT(v.layer.parent)){const S=zB(v.layer.parent);S!=null&&S!==""&&y1e(v.layer.parent,g)}o3(v)?a=Math.max(a,this.tileSize*c):s===1&&T===1&&(v.isOpaque||this._dataToTexture(x)&&x.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n,y===null&&(y=g)}}const _=a/this.tileSize;this._ensureBackgroundTexture(this.tileSize),n!==0&&y!==null?n===1&&!u&&this._useLayerTexture(t,y,p,Eie[y])||this._composeMapLayers(t,r,g-1,p,Sie,Cie,a,_,!l||u,mD,u):this._useBackgroundTexture(t,o)}_ensureBackgroundTexture(t){this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(t),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(t),this._passParameters.offset=vd,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor!=null&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,this.backgroundColor!=null),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1)}_useBackgroundTexture(t,r){let i=Em.Immediate;(t.surface.view.layerViewManager.updating||r>0)&&(i=Em.Delayed);const s=t.renderData;this._backgroundTexture&&s.textureReference==null&&(i=Em.Immediate),s.setTextureReference(this._backgroundTexture!=null?new IU(this._backgroundTexture,js.FADING,Aie,t.surface.baseOpacity,0,1):null,i)}_useLayerTexture(t,r,i,s){const n=r<i,o=n?1:t.surface.baseOpacity,a=n?t.surface.baseOpacity:1,l=LU(t,r);return!!this._dataToTexture(l)&&(t.renderData.setTextureReference(new IU(l.sourceLayerInfo.data,js.FADING,l,o,a,s)),!0)}_composeMapLayers(t,r,i,s,n,o,a,l,c,u,d){this._composition.ensureBuffer(a);const p=t.surface.baseOpacity;let g=!1,y=xt.LINEAR_MIPMAP_LINEAR,_=!1,v=0;for(let x=i;x>=0;x--){const S=LU(t,x);if(!S||n[x]===0&&!d)continue;const O=x<s&&p<1&&!g;this._passParameters.baseOpacity=O?p:1;const A=this._passParameters.baseOpacity<1?ad.Required:ad.NotRequired;O&&(g=!0);let $=!1;u.forEach(L=>{L.start===x&&(iw.push(L),this._composition.openGroup(a),$=!0)});const P=v===0,U=$?dn.GroupBackgroundComposite:c&&P?this.backgroundIsGrid?dn.GridComposite:dn.ColorComposite:dn.Composite,I=RB[o[x]];for(Ove(S)?(this._passParameters.opacity=n[x],_=this._composition.drawVectorData(this._passParameters,U,a,I,A,S,l,this.tileSize,_)):qet(S)?(this._passParameters.opacity=n[x],this._composition.drawImageryTileData(this._passParameters,U,a,I,A,S),this._hasNearestInterpolation(S)&&(y=xt.NEAREST)):this._dataToTexture(S)&&(this._passParameters.texture=S.sourceLayerInfo.data.texture,this._passParameters.offset=S.offset,this._passParameters.scale=S.scale,this._passParameters.opacity=n[x],this._composition.drawRasterData(this._passParameters,U,a,I,A));iw.length>0&&iw[iw.length-1].end===x;){const L=iw.pop();this._passParameters.opacity=L.opacity,this._passParameters.offset=vd,this._passParameters.scale=1;const N=c&&P?this.backgroundIsGrid?dn.GridComposite:dn.ColorComposite:dn.Composite;this._composition.drawGroup(this._passParameters,N,a,RB[L.blendMode],A)}v++}const w=t.renderData,T=w.ensureTexture(a,()=>this._buildTexture(a,y));this._composition.copyFBOToTexture(T),this._composition.unbind(),w.setTextureReference(new IU(T,r,Aie,g?1:p,0,1))}_hasNearestInterpolation(t){const r=t.sourceLayerInfo.data;return!!r.source&&r.interpolation==="nearest"}_dataToTexture(t){if(Zet(t)){const r=t.sourceLayerInfo;r.data=this._buildTexture(r.data),t.tile.setMemoryDirty()}return Xet(t)}setBackground(t){this._backgroundColor!==t&&(this._backgroundColor=t,this._backgroundDirty=!0)}_buildTexture(t,r=xt.LINEAR_MIPMAP_LINEAR){if(t==null)return null;const i=new hr;i.wrapMode=Ct.CLAMP_TO_EDGE,i.samplingMode=r,i.maxAnisotropy=this._maxAnisotropy,i.preMultiplyAlpha=!0,i.flipped=!0,i.hasMipmap=!0;const s=this._rctx;let n;if(typeof t=="number")i.width=i.height=t,n=new jw(new wt(s,i));else if(t instanceof Q4)i.isOpaque=t.isOpaque,n=new jw(new wt(s,i,t.image)),t.release();else try{i.width=t.width,i.height=t.height,n=new jw(new wt(s,i,t))}catch{n=new jw(afe(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=s.bindTexture(n.texture,wt.TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),s.bindTexture(o,wt.TEXTURE_UNIT_FOR_UPDATES),n}get test(){return{backgroundTexture:this._backgroundTexture}}}function LU(e,t){ra.layerIndex=t,ra.vtlNeighborInfos.clear();const r=e.layerInfo[jt.MAP][t];if(r.data)return Qt(ra.offset,0,0),ra.tile=e,ra.scale=1,ra.sourceLod=e.lij,ra.sourceLayerInfo=r,Ove(ra)&&e.forEachLoadedNeighbor((s,n)=>{if(s.level!==e.level)return;const o=s.layerInfo[jt.MAP][t];if(!Rve(o)||r.data===o.data)return;const a=ra.vtlNeighborInfos.pushNew();a.offset=Zf[n],a.sourceLod=s.lij,a.sourceLayerInfo=o}),ra;const i=r.upsampleInfo;if(i){const s=i.tile.layerInfo[jt.MAP][t];return ra.tile=i.tile,en(ra.offset,i.offset),ra.scale=i.scale,ra.sourceLod=i.tile.lij,ra.sourceLayerInfo=s,ra}return null}function zB(e){return e.get("uid")}function g1e(e){let t=e.blendMode!=="normal";return vT(e.parent)&&(t=g1e(e.parent)||t),t}function y1e(e,t){vT(e.parent)&&y1e(e.parent,t);const r=zB(e);if(r!=null&&r!==""){const i=mD.get(r);i?i.start=t:mD.set(r,new ust(t,t,e.blendMode,e.opacity))}}const Sie=new Array,Eie=new Array,Cie=new Array,mD=new Map,iw=new Array,ra=new lst,Aie={offset:[0,0],scale:1},Zf=new Array;Zf[et.NORTH]=[0,-1],Zf[et.NORTH_EAST]=[-1,-1],Zf[et.EAST]=[-1,0],Zf[et.SOUTH_EAST]=[-1,1],Zf[et.SOUTH]=[0,1],Zf[et.SOUTH_WEST]=[1,1],Zf[et.WEST]=[1,0],Zf[et.NORTH_WEST]=[1,-1];const _1e=200,DU=40,dst=.8,pst=10,jE=1e-6;function fst(e,t,r){const i=t,s=r;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=e[a];if(i[a]<l){if(s[a]<=jE)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-jE){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=e[a+3];if(i[a]>l){if(s[a]>=-jE)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]>=jE){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}class Oie{constructor(t,r,i,s,n){this.aabb=t,this.axis=r,this.d=i,this.midStartIndex=s,this.rightStartIndex=n}}class KT{constructor(t,r,i,s){this.globalTriangleVertexIndices=t,this.firstTriangleIndex=r,this.positionAttribute=s,this._rayDirection=C(),this.bspNodeTree=new Array;const n=i-r,o=n<=v1e?new Uint16Array(n):new Uint32Array(n);this.indices=o;for(let a=0;a<n;++a)o[a]=a;{const a=vst(t,r,i,s.data,s.stride),l=fe(Math.log2(n/DU),2,pst),c=(u,d,p)=>{const g=yst(o,a,u,d),y=d-u;if(y<=DU){const S=new Oie(g,void 0,0,u,d);return this.bspNodeTree.push(S),S}const{axis:_,midValue:v}=_st(g),w=gst(o,a,u,d,_,v),T=(S,O)=>{if(p>l)return;const A=O-S;return A<DU||A>=dst*y?void 0:c(S,O,p+1)},x=new Oie(g,_,v,w.next,w.mid);return this.bspNodeTree.push(x),x.leftNode=T(u,w.next),x.rightNode=T(w.mid,d),x};c(0,n,0),this.triangleVertexIndices=bst(o,t,r,i)}}intersectRayTriangleRange(t,r){{if(t>=r)return;const i=this.triangleVertexIndices,s=this.positionAttribute.data,n=this.positionAttribute.stride,o=this._rayOrigin,a=o[0],l=o[1],c=o[2],u=this._rayDirection,d=u[0],p=u[1],g=u[2];for(let y=t,_=3*t;y<r;++y){let v=i[_++]*n;const w=s[v++],T=s[v++],x=s[v];v=i[_++]*n;const S=s[v++],O=s[v++],A=s[v];v=i[_++]*n;const $=S-w,P=O-T,U=A-x,I=s[v++]-w,L=s[v++]-T,N=s[v]-x,Z=p*N-L*g,W=g*I-N*d,V=d*L-I*p,J=$*Z+P*W+U*V;if(Math.abs(J)<=Number.EPSILON)continue;const R=a-w,k=l-T,z=c-x,H=R*Z+k*W+z*V;if(J>0){if(H<0||H>J)continue}else if(H>0||H<J)continue;const X=k*U-P*z,Y=z*$-U*R,ee=R*P-$*k,me=d*X+p*Y+g*ee;if(J>0){if(me<0||H+me>J)continue}else if(me>0||H+me<J)continue;const $e=(I*X+L*Y+N*ee)/J;if($e>=0){const pt=this.indices[y]+this.firstTriangleIndex,St=uH($,P,U,I,L,N,mst);this._callback($e,St,pt,!1)}}}KT.numFacesTested+=r-t}intersectRay(t,r){KT.numFacesTested=0;const i=Ce(t.r0[0],t.r0[1],t.r0[2]),s=Ce(t.r1[0],t.r1[1],t.r1[2]),n=s[0]-i[0],o=s[1]-i[1],a=s[2]-i[2];if(n*n+o*o+a*a<jE)return;this._rayOrigin=i;const l=this._rayDirection;l[0]=n,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this._callback=r;const u=this.bspNodeTree[0];this.intersectRayBSP(u,0,c)}intersectRayBSP(t,r,i){const s=this._rayOrigin,n=this._rayDirection;if(!fst(t.aabb,s,n))return;const o=t.axis,a=t.d;if(s[o]<a||n[o]<0){const l=r,c=t.midStartIndex;if(l<c){const u=t.leftNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(t.midStartIndex,t.rightStartIndex),s[o]>a||n[o]>0){const l=t.rightStartIndex,c=i;if(l<c){const u=t.rightNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}KT.numFacesTested=0;const mst=C(),sw=[1/0,1/0,1/0],nw=[-1/0,-1/0,-1/0];function gst(e,t,r,i,s,n){let o=r,a=i;for(;o<a;){const c=e[o];t[6*c+s+3]<=n?++o:(--a,e[o]=e[a],e[a]=c)}let l=o;for(a=i;l<a;){const c=e[a-1];t[6*c+s]>=n?--a:(e[a-1]=e[l],e[l]=c,++l)}return{next:o,mid:l}}function yst(e,t,r,i){if(i<=r)return g1(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*e[r];for(let n=0;n<3;++n)sw[n]=t[s+0+n],nw[n]=t[s+3+n]}for(let s=r+1;s<i;++s){const n=6*e[s];for(let o=0;o<3;++o)sw[o]=Math.min(sw[o],t[n+0+o]),nw[o]=Math.max(nw[o],t[n+3+o])}return g1(sw[0],sw[1],sw[2],nw[0],nw[1],nw[2])}function _st(e){const t=e[3]-e[0],r=e[4]-e[1],i=e[5]-e[2],s=t>r?t>i?0:r>i?1:2:r>i?1:i>t?2:0;return{axis:s,midValue:(e[s]+e[s+3])/2}}function vst(e,t,r,i,s){const n=r-t,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+t),c=e[l]*s,u=e[l+1]*s,d=e[l+2]*s;for(let p=0;p<3;++p){const g=i[c+p],y=i[u+p],_=i[d+p];o[6*a+p]=Math.min(g,y,_),o[6*a+3+p]=Math.max(g,y,_)}}return o}function bst(e,t,r,i){const s=i-r;let n=0;for(let a=r;a<i;++a)for(let l=0;l<3;++l)n=Math.max(t[3*a+l],n);const o=n<=v1e?new Uint16Array(3*s):new Uint32Array(3*s);for(let a=0;a<s;++a){const l=3*(e[a]+r);for(let c=0;c<3;++c){const u=t[l+c];o[3*a+c]=u}}return o}const v1e=65535;class As extends bo{constructor(){super(...arguments),this.output=D.Color,this.overlayMode=Am.Disabled,this.tileBlendInput=Lp.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=Qe.Terrain}}h([B({count:D.COUNT})],As.prototype,"output",void 0),h([B({count:Am.COUNT})],As.prototype,"overlayMode",void 0),h([B({count:Lp.COUNT})],As.prototype,"tileBlendInput",void 0),h([B()],As.prototype,"spherical",void 0),h([B()],As.prototype,"doublePrecisionRequiresObfuscation",void 0),h([B()],As.prototype,"receiveShadows",void 0),h([B()],As.prototype,"hasSlicePlane",void 0),h([B()],As.prototype,"backfaceCullingEnabled",void 0),h([B()],As.prototype,"textureFadingEnabled",void 0),h([B()],As.prototype,"renderOccluded",void 0),h([B()],As.prototype,"hasScreenSpaceReflections",void 0),h([B()],As.prototype,"hasCloudsReflections",void 0),h([B()],As.prototype,"invisible",void 0),h([B()],As.prototype,"tileBorders",void 0),h([B()],As.prototype,"visualizeNormals",void 0),h([B()],As.prototype,"screenSizePerspective",void 0),h([B()],As.prototype,"receiveAmbientOcclusion",void 0),h([B({count:Qe.COUNT})],As.prototype,"pbrMode",void 0),h([B({constValue:wr.Compressed})],As.prototype,"normalType",void 0),h([B({constValue:ws.Compressed})],As.prototype,"textureCoordinateType",void 0),h([B({constValue:!1})],As.prototype,"highStepCount",void 0),h([B({constValue:!1})],As.prototype,"useCustomDTRExponentForWater",void 0),h([B({constValue:!1})],As.prototype,"useFillLights",void 0);const NU=7,wst=10,FU=Qs();var cn;(function(e){e[e.Opaque=0]="Opaque",e[e.Semitransparent=1]="Semitransparent",e[e.TransparentWithDraped=2]="TransparentWithDraped",e[e.Empty=3]="Empty"})(cn||(cn={}));let pl=class extends xe{get _isGlobal(){return this._stage.viewingMode===Ie.Global}constructor(e){super(e),this.type=Ii.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new As,this._passParameters=new Wve,this._rctx=null,this._renderDataPool=new fn(Qrt),this._patchGroups=new Map,this._patchGroupsDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new Fve,this._highestVisibleLODTile=null,this._visible=!0,this._transparencyState=cn.Opaque,this._castShadows=!0,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=Ei.Occlude}initialize(){const e=[ae.OPAQUE_TERRAIN,ae.TRANSPARENT_TERRAIN,ae.OCCLUDED_TERRAIN];this._stage.addRenderPlugin(e,this)}destroy(){this._stage.removeRenderPlugin(this),Ktt()}get canRender(){return this._visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===cn.TransparentWithDraped||e===cn.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get needsLinearDepth(){return this._overlayRenderer.hasWater}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return R0}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?YL:Ei.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,dt.TEXTURE_FADING)}updateTileTexture(e,t){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,t===dt.TEXTURE_FADING?js.FADING:js.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(t))}updateTileGeometryState(e){for(const r of e.layerInfo[jt.ELEVATION])r.pendingUpdates&=~dt.GEOMETRY;e.resetPendingUpdate(dt.GEOMETRY);const t=e.renderData.updateGeometryState();return t&&this.setDirty(),t}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const t=e.renderData;t&&(t.releaseGeometry(),this._renderDataPool.release(t),t.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const t=wst-NU,r=Math.max(0,Math.floor((e.level-t)/NU)*NU);if(this._isGlobal&&r===0)return wa;for(;e.parent&&e.level>r;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this._visible=e,this.setDirty()}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=ns.UPDATE){this._patchGroupsDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=ns.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=ns.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._rctx=e.renderContext.rctx,this._techniqueRepository=e.techniqueRepository,this._tileRenderer=new hst(this._rctx,this._tileSize,this._techniqueRepository),this.updateTileBackground(),this._emptyTex=afe(this._rctx)}uninitializeRenderContext(){this._emptyTex=De(this._emptyTex),this._tileRenderer=De(this._tileRenderer)}intersect(e,t,r,i){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==cn.Opaque)return;const s=xst,n=Tst;ce(s,i,r),se(n,1/s[0],1/s[1],1/s[2]);const o=e.results.min,a=e.results.max,l=e.results.ground,c=e.options.store===so.MIN,u=!!e.results.ground.target,d=L8e(e.verticalOffset),p=e.tolerance;let g,y=c&&o.dist!=null?o.dist:1/0;const _=w=>{const T=w.renderData;if(!T?.vao)return;const x=T.geometry;aN(FU,x.boundingBox);const S=T.localOrigin;d!=null&&(d.localOrigin=S,d.applyToAabb(FU));const O=FU;if(ow[0]=r[0]-S[0],ow[1]=r[1]-S[1],ow[2]=r[2]-S[2],!dH(O,ow,n,p,y))return;const A=(W,V,J)=>{W.set(this.type,w,V,J,Ks),y=c&&o.dist!=null?o.dist:1/0},$=(W,V)=>{if(V!=null&&W>=0&&(e.options.backfacesTerrain||de(V,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||t==null||t(r,i,W))){if((l.dist==null||W<l.dist)&&A(l,W,V),e.options.isFiltered)return;e.options.store===so.ALL&&(g==null?(g=Nj(e.ray),A(g,W,V),e.results.all.push(g)):W<g.dist&&A(g,W,V)),(o.dist==null||W<o.dist)&&A(o,W,V),e.options.store!==so.MIN&&(a.dist==null||W>a.dist)&&A(a,W,V)}},P=Sst;ce(P,i,S);const U=x.indices,I=x.vertexAttributes,L=I.getField(E.POSITION,Es),N=new Fe(L.typedBuffer,3,!1,I.stride/4),Z=x.indexCount/3;if(!d&&Z>_1e){const W=w.renderData;W.intersectionData==null&&(W.intersectionData=new KT(U,0,Z,N)),W.intersectionData.intersectRay({r0:ow,r1:P},$)}else Y3(ow,P,0,Z,U,N,null,d,$)},v=this._rootTiles;v!=null&&(()=>{const w=this._tileIterator;w.reset(v);const T=e.options.invisibleTerrain;for(let x=w.next();x;x=w.next())!(x.visible||T&&x.intersectsClippingArea)||d==null&&!x.intersectsRay(r,s,p,y)||u&&this._useStencilForTile(x)?w.skipSubtree():_(x)})()}processScaleRangeQueries(e,t){if(!t.done)for(this._updatePatchGroups();e.updating&&!t.done;){e.prepare();for(const r of this._patchGroups.values())for(const i of r)i.renderData?.textureReference!=null&&e.queriesForTile(i);e.process(),t.madeProgress()}}prepareTechnique(e){if(e.bindParameters.slot===ae.OCCLUDED_TERRAIN){if((e.renderOccludedMask&YL)==0)return null}else{const t=this.transparency===cn.Opaque?ae.OPAQUE_TERRAIN:ae.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==t)return null}switch(e.output){case D.Color:return this.transparency===cn.Empty?null:(this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=e.bindParameters.cloudsFade.data!=null,this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.active,this._techniqueConfiguration.overlayMode=this._overlayRenderer.isEmpty?Am.Disabled:this._overlayRenderer.hasWater?Am.EnabledWithWater:Am.Enabled,this._updateTechnique(D.Color,e.bindParameters.slot===ae.OCCLUDED_TERRAIN));case D.Shadow:case D.ShadowExcludeHighlight:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(D.Shadow,!1)):null;case D.Depth:return this.transparency===cn.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(D.Depth,!1));case D.Normal:return this.transparency===cn.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(D.Normal,!1));case D.ObjectAndLayerIdColor:return this.transparency===cn.Empty?null:this._updateTechnique(D.ObjectAndLayerIdColor,!1);case D.Highlight:return this.transparency!==cn.Empty&&this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(D.Highlight,!1)):null}return null}render(e,t){const r=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),t.useStencil=!1,e.output){case D.Color:{const i=e.bindParameters.slot===ae.OCCLUDED_TERRAIN?da.Occluded:da.ColorAndWater;this.transparency===cn.Opaque?this._renderMaterialPass(e,t,i):e.offscreenRenderingHelper.renderToTargets(()=>this._renderMaterialPass(e,t,i),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]);break}case D.Depth:case D.Normal:this._renderAuxiliaryPass(e,t,da.ColorAndWater);break;case D.Highlight:this.needsHighlight&&this._renderAuxiliaryPass(e,t,da.Highlight);break;case D.Shadow:case D.ShadowExcludeHighlight:this._castShadows&&r&&this._renderAuxiliaryPass(e,t,da.None);break;case D.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,t,da.ObjectAndLayerIdColor)}}_renderMaterialPass(e,t,r){const{rctx:i}=e;this._passParameters.overlaySource=r,i.bindTechnique(t,this._passParameters,e.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this._renderPatchGroups(e,t,r)}_renderAuxiliaryPass(e,t,r){const i=e.rctx;this._passParameters.overlaySource=r,i.bindTechnique(t,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,t,r)}updateTileBackground(e=null){if(this._tileRenderer==null)return;const t=this._tileRenderer;let r=null;if(e!=null){const i=ot.toUnitRGBA(e);r=Ce(i[0]||0,i[1]||0,i[2]||0)}t.setBackground(r),this._allTiles.forAll(i=>t.updateTileTexture(i,js.FADING)),this._techniqueConfiguration.tileBlendInput=t.backgroundIsGrid?Lp.GridComposite:t.backgroundColor!=null?Lp.ColorComposite:Lp.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchGroupsDirty&&(this._highestVisibleLODTile=null,this._rebuildPatchGroups(),this._patchGroupsDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==JT.NONE){const e=Array.from(this._patchGroups.values()),t=this._stencilEnabledLayerExtents;for(const r of e)Uve(this.renderOrder,r,t);e.sort((r,i)=>kve(r[0],i[0],this.renderOrder)),this._patchGroups=new Map(e.map(r=>[r[0].renderData.localOrigin,r])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){const e=this._rootTiles;if(e!=null){e[0]?.surface.checkAllTilesWaterproofness(),this._patchGroups.clear();for(const t of e)this._rebuildPatchGroupsForRootTile(t)}}_rebuildPatchGroupsForRootTile(e){const t=this._tileIterator;for(t.resetOne(e);!t.done;){const r=t.next(),i=r.renderData;if(!i){this._numTilesCulled++;continue}if(!r.visible){this._numTilesCulled++,t.skipSubtree();continue}const s=i.localOrigin;let n=this._patchGroups.get(s);n||(n=new Array,this._patchGroups.set(s,n)),n.push(r),(!this._highestVisibleLODTile||r.elevationLevel>this._highestVisibleLODTile.elevationLevel)&&(this._highestVisibleLODTile=r),t.skipSubtree()}}_useStencilForTile(e){for(const t of this._stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1}_renderPatchGroupsAuxiliary(e,t,r){const i=this._stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(s=>{const n=s[0].renderData.localOrigin;t.program.bindDraw(new pB(n),e.bindParameters,this._passParameters);for(let o=0;o<s.length;o++)this._renderPatch(e,t,s[o],bt.TRIANGLES,i,r)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,t,r){const i=e.bindParameters.camera,s=t.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const u=age(this._stage.viewingMode,this._ellipsoidRadius),d=this.pointsOfInterest.centerOnSurfaceFrequent.distance;u.update({distance:d,fovY:i.fovY})}const n=this._stencilEnabledLayerExtents.length>0,o=r===da.Occluded;o&&(s.bindTexture("tex",this._emptyTex),s.setUniform3fv("textureOpacities",wa),s.setUniform4fv("texOffsetAndScale",Up));const a=this._tileRenderer!=null&&this._tileRenderer.backgroundColor!=null?this._tileRenderer.backgroundColor:wa;this._techniqueConfiguration.tileBlendInput===Lp.ColorComposite&&s.setUniform3fv("backgroundColor",a);const l=this.wireframe?bt.LINES:bt.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&s.bindTexture("texNext",this._emptyTex);const c=this._patchGroups;for(const u of c.values()){const d=u[0].renderData.localOrigin;t.program.bindDraw(new pB(d),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const p of u){const g=p.renderData,y=g.textureReference;if(y!=null){if(!o){s.setUniform4fv("texOffsetAndScale",y.offsetAndScale),s.bindTexture("tex",y.texture.texture);const _=g.textureFadeFactor,v=_<1?g.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&v!=null&&_<1?(s.setUniform1f("fadeFactor",_),s.setUniform4fv("nextTexOffsetAndScale",v.offsetAndScale),s.setUniform3fv("nextTexOpacities",v.opacities),s.bindTexture("texNext",v.texture.texture)):s.setUniform1f("fadeFactor",1),g.textureIsFading&&this.setNeedsRender(),s.setUniform3fv("textureOpacities",y.opacities)}this._renderPatch(e,t,p,l,n,r),p.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,t,r,i,s,n){const o=r.renderData,a=o.vao,l=a.indexBuffer;if(l==null)return void(Js&&console.error("Rendered tile with no indices: ",r.lij," : ",o));const c=t.program;n===da.None||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(c,o.overlay),s&&(t.useStencil=this._useStencilForTile(r),t.bindPipelineState(e.rctx,e.bindParameters.slot));const u=o.geometry.indexCount;e.rctx.bindVAO(a),c.assertCompatibleVertexAttributeLocations(a),e.rctx.drawElements(i,u,l.indexType,0)}_bindOverlayPatchData(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales)}_updateTechnique(e,t){return this._techniqueConfiguration.output=e,this._techniqueConfiguration.renderOccluded=t,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(s5,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};h([f({constructOnly:!0})],pl.prototype,"_overlayRenderer",void 0),h([f({constructOnly:!0})],pl.prototype,"_stage",void 0),h([f({readOnly:!0})],pl.prototype,"_isGlobal",null),h([f({constructOnly:!0})],pl.prototype,"_allTiles",void 0),h([f({constructOnly:!0})],pl.prototype,"_ellipsoidRadius",void 0),h([f({value:!1})],pl.prototype,"renderingDisabled",null),h([f()],pl.prototype,"renderPatchBorders",null),h([f()],pl.prototype,"visualizeNormals",null),h([f()],pl.prototype,"cullBackFaces",null),h([f({value:JT.FRONT_TO_BACK})],pl.prototype,"renderOrder",null),h([f()],pl.prototype,"wireframe",null),pl=h([F("esri.views.3d.terrain.TerrainRenderer")],pl);const xst=C(),Tst=C(),ow=C(),Sst=C();class Est{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}}let pp=class extends xe{constructor(e){super(e),this._handles=new gi}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(le(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=Re(this._handles),this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(t=>!(!vC(t)||t.isRejected())&&!(t.isFulfilled()&&!Cst(t,this.viewSpatialReference,this.viewingMode))&&(e=t,!(t?.type==="vector-tile"||aD(t)))),e)if(e.isResolved()){const t=t5(e,this.viewSpatialReference,this.viewingMode);if(t!=null){const r=new Pi(t.tileInfo);this._lockTilingScheme(r)}}else this._updateWhen(e)}_updateWhen(e){const t=e.when().catch(()=>{}).then(()=>{t!==this._waitTask||this.destroyed||this._update()});this._waitTask=t}_lockTilingScheme(e){if(this.viewingMode===Ie.Global){const t=e.levels.length-1;e.spatialReference.isWebMercator?e=Pi.makeWebMercatorAuxiliarySphere(t):gy(e.spatialReference)&&(e=Pi.makeGCSWithTileSize(e.spatialReference,e.pixelSize,t))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(le(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Ie.Global){const e=this.extentHelper.viewSpatialReference,t=gy(e)||af(e)||lf(e);e.isWebMercator?this.tilingScheme=Pi.WebMercatorAuxiliarySphere:t&&(this.tilingScheme=Pi.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||kv(e,this.extent)||(this.tilingScheme=Pi.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function Cst(e,t,r){return t5(e,t,r)!=null}h([f()],pp.prototype,"tilingScheme",void 0),h([f({readOnly:!0})],pp.prototype,"extent",void 0),h([f({value:!1})],pp.prototype,"tilingSchemeLocked",void 0),h([f({constructOnly:!0})],pp.prototype,"viewSpatialReference",void 0),h([f({constructOnly:!0})],pp.prototype,"layers",void 0),h([f({constructOnly:!0})],pp.prototype,"extentHelper",void 0),h([f({constructOnly:!0})],pp.prototype,"viewingMode",void 0),pp=h([F("esri.views.3d.terrain.TilingSchemeLogic")],pp);class Ast{constructor(){this.offset=Ne(),this.scale=0,this.tile=null}init(t,r,i,s){this.tile=t,this.offset[0]=r,this.offset[1]=i,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}}let Dt=class extends cs.EventedMixin(xe){constructor(e){super(e),this._scaleRangeQueries=new RI,this._iteratorPool=new fn(Fve,t=>t.remove=()=>this._iteratorPool.release(t)),this._postorderIterator=new irt,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visibleCached=!1,this._usedMemory=null,this._performanceInfo=new Est,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=C(),this._eyePosSurfaceSR=C(),this._splitLimits=new Dh,this._frustum=OA(),this._viewProjectionMatrix=be(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new gi,this._watchUpdatingTracking=new Fp,this._frameTask=wT,this._allTiles=new Mt,this._upsampleInfoPool=new fn(Ast),this._rootTilesExtent=Nt(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=st.WebMercator,this.visibleElevationBounds=new _x(1/0,-1/0),this.rootTileElevationBounds=new _x(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this.oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this.overlayManager=new aa({...e,surface:this}),this._isGlobal=!e.view?.state?.isLocal}initialize(){this._lercDecoder=Ott(this.view.resourceController),this._tilePool=this.view.state.isLocal?new fn(mit):new fn(yit);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("terrain-upsample",n=>n.unloadMapData()),this._elevationQueryCache=new Ctt(e.newCache("elevation-query")),this._handles.add([le(()=>this.overlayManager.hasHighlights,n=>this._renderer.setNeedsHighlight(n)),le(()=>this.overlayManager.rendersOccluded,n=>this._renderer.setRenderOccludedOverlay(n)),le(()=>this.overlayManager.renderer.isEmpty,()=>this._evaluateTransparency())],"overlayManager"),this._renderer=new pl({_overlayRenderer:this.overlayManager.renderer,_ellipsoidRadius:Mr(this.view.spatialReference).radius,_stage:this.view._stage,_allTiles:this._allTiles}),this._handles.add([le(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?js.UNFADED:js.IMMEDIATE)},_s),le(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?js.UNFADED:js.IMMEDIATE),_s),le(()=>this.renderingDisabled,()=>this.view?._stage?.renderer.setParameters({terrainRenderingEnabled:!this.renderingDisabled}),Vr),le(()=>this.backgroundColor,n=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(n)},_s),le(()=>this.snapLevel,()=>this._viewChanged=!0,Vr),le(()=>this.view.pointsOfInterest,n=>{this._renderer.pointsOfInterest=n,this._watchUpdatingTracking.removeAll(),n&&this._watchUpdatingTracking.add(()=>n.focus.renderLocation,()=>this._allTilesSorted=!1)}),le(()=>Kr.TERRAIN_TILE_TREE_SHOW_TILES,n=>{n&&!this._treeDebugger?ue(()=>import("./TerrainTileTree3DDebugger.2d5edf7b.js"),["assets/TerrainTileTree3DDebugger.2d5edf7b.js","assets/TileTreeDebugger.f46f3b0e.js"]).then(({TerrainTileTree3DDebugger:o})=>{!this._treeDebugger&&Kr.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new o({view:this.view}))}):n||(this._treeDebugger=Re(this._treeDebugger))},Rr)]);const{spatialReference:t}=this.view;this._extentHelper=jtt(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:t});const r=new TA({getCollections:()=>this.view?.defaultsFromMap?.mapCollections?.map(({layers:n})=>n),getChildrenFunction:n=>n&&"layers"in n?n.layers:null}),i=new pp({layers:r,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:t});this._set("tilingSchemeLogic",i),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(Pp.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(Pp.BASEMAP);const s=this.view.resourceController.scheduler;this._frameTask=s.registerTask(at.TERRAIN_SURFACE,this),this._handles.add([le(()=>this._extentHelper.stencilEnabledExtents,n=>this._renderer.setStencilEnabledLayerExtents(n),Rr),le(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Vr),le(()=>this.extent,()=>this._updateRootTiles(),Rr),this.view.on("resize",()=>this._viewChangeUpdate()),le(()=>{const n=this.view,o=n.state;return[this._lodBias,this.lodSnapping,n.resourceController?.memoryController?.memoryFactor,o.camera,o.contentCamera,o.fixedContentCamera]},()=>this._viewChangeUpdate(),_s),le(()=>this.view.qualitySettings?.tiledSurface?.textureFadeDuration,n=>this._renderer.textureFadingEnabled=n>0,Rr),le(()=>this.view.qualitySettings?.physicallyBasedRenderingEnabled,n=>this._renderer.pbrMode=n?Qe.Terrain:Qe.Disabled,Rr),le(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Vr)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=Mi(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=Re(this._upsampleMapCache),this._elevationQueryCache=Re(this._elevationQueryCache),this._set("tilingSchemeLogic",Re(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((e,t)=>this._unregisterTiledLayerView(t)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Re(this.overlayManager)),this._tilePool=Re(this._tilePool),MW.prune(),this._treeDebugger=Re(this._treeDebugger),this._renderer=Re(this._renderer),this._iteratorPool=Re(this._iteratorPool),this._set("view",null),this._extentHelper=Re(this._extentHelper),this._upsampleInfoPool=Re(this._upsampleInfoPool),ktt(),Irt()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnapping===RC.ON){const e=this.view,t=this.tilingScheme,r=e.pointsOfInterest?.cameraOnSurface?.scale;if(t&&r){const i=e.state.contentCamera;let s=t4(e,i.eye,i.viewForward,i.up).tilt;s>90&&(s=180-s);const n=2*(s/90)**2,o=t.levelAtScale(r)-n,a=Math.min(o,this._splitLimits.maxLod||1/0);return a<=0?null:a}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?RC.ON:RC.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:t}=this.view;if(t==null||e==null)return null;const r=Nt(),i=yve(t,r,e)?r:null,s=this._get("extent");return kv(i,s)?s:i}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=c9(this.groundExtent,this._userClippingExtent,Nt()),t=this._get("extent");return kv(e,t)?t:e}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){return this.tilingSchemeLogic?.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||this._watchUpdatingTracking?.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager?.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view?.map?.ground?.opacity??1}set baseOpacity(e){this.view.map.ground.opacity=e}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get rootTiles(){return this._rootTiles}get spatialReference(){return this.tilingScheme?.spatialReference??null}get backgroundColor(){return this.view.map.ground.surfaceColor}set backgroundColor(e){this.view.map.ground.surfaceColor=e}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._evaluateTransparency()}get tilingSchemeLocked(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}get wireframe(){return this._renderer?.wireframe}set wireframe(e){e!==this._renderer.wireframe&&(this._renderer.wireframe=e,this._updateAllTileGeometries())}set _visible(e){e!==this._visibleCached&&(this._visibleCached=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.transparency===cn.Opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}get textureFadeDuration(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}intersect(e,t,r,i){this._renderer.intersect(e,t,r,i)}getElevation(e,t,r,i){const s=this._rootTiles;if(s==null||!s.length||s[0].layerInfo[jt.ELEVATION].length===0)return null;const n=$a;return n[0]=e,n[1]=t,n[2]=r,yn(n,i,n,this._spatialReference)?Pie(s,n[0],n[1]):(K.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(e,t,r){const i=this._rootTiles,s=i?i[0].layerInfo[jt.ELEVATION].length:0;if(i!=null&&i.length&&s!==0)for(let n=0;n<t;++n){const o=3*n;r(n,Pie(i,e[o],e[o+1]))}else for(let n=0;n<t;++n)r(n,null)}getScale(e){if(!this.tilingScheme)return null;if(!no(e,$a,this.spatialReference))return K.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const t=this._rootTiles;if(t!=null){for(const r of t)if(r?.containsPoint($a)){let i=r;for(;i.children[0]&&!i.rendered;){const s=i.children[0].extent;let n=0;$a[0]>s[2]&&(n+=1),$a[1]<s[1]&&(n+=2),i=i.children[n]}return this._getLodBiasCorrectedScale(i.level)}}return 1/0}getSphereElevationBounds(e,t){if($a[0]=e[0],$a[1]=e[1],$a[2]=e[2],$a[3]=e[3],!yn($a,t,$a,this.tilingScheme?.spatialReference))return K.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let r=1/0,i=-1/0;const s=o=>{if(o&&sZ(o.extent,$a))if(o.isLeaf||o.rendered)r=Math.min(r,o.elevationBounds[0]),i=Math.max(i,o.elevationBounds[1]);else for(const a of o.children)s(a)},n=this._rootTiles;if(n!=null)for(const o of n)s(o);return{min:r,max:i}}getSphereScale(e,t){if(!this.tilingScheme)return null;if(!no(e,$a,this.spatialReference))return K.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;$a[3]=t;let r=null;const i=n=>{if(n&&sZ(n.extent,$a)){const o=n.children;if(o[0]&&!n.rendered)for(const a of o)i(a);else{const a=this._getLodBiasCorrectedScale(n.level);r=r==null?a:Math.min(r,a)}}},s=this._rootTiles;if(s!=null)for(const n of s)i(n);return r}queryVisibleScaleRange(e,t,r,i){const s=t?this.tilingScheme.levelAtScale(t):0,n=r?this.tilingScheme.levelAtScale(r):1/0,o=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(e,s+o,n+o,i)}_evaluateTransparency(){const e=this.baseOpacity,t=this.overlayManager.renderer.isEmpty,r=this._renderer.transparency,i=this._allSurfaceLayersTransparent()?t?cn.Empty:cn.TransparentWithDraped:e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?cn.Opaque:cn.Semitransparent,s=r!==i;return s&&(this._renderer.transparency=i,this.view?._stage?.renderer.setParameters({terrainTransparency:this._renderer.transparency})),s}_updateTilingScheme(){const e=this.tilingSchemeLogic.tilingScheme;if(e===this.tilingScheme)return;wp(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!this.view?.state?.isLocal,this.tilingScheme&&this._removeAllTiles();const t=e?.spatialReference??st.WebMercator;this._spatialReference=t,this._isWebMercator=!!t?.isWebMercator,this._isWebMercatorOnPlateeCarree=this._isWebMercator&&M7(this.view?.renderSpatialReference),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles())}_acquireTile(e,t,r,i){const s=this._tilePool.acquire();return BP[0]=e,BP[1]=t,BP[2]=r,s.init(BP,i,this),s}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:t}=this;if(!t)return;const r=Pst;let i=t.rootTilesInExtent(e,r,5*ox);if(this._rootTiles!=null){if(i.length>ox)return void K.getLogger(this).warn(oDe);const s=this._rootTiles.map(o=>o.lij),n=gwe(s,i,Rie);if(this._updatingRootTiles=!0,n.removed.length>0||n.added.length>0){const o=this._rootTiles.filter(a=>!(n.removed.findIndex(l=>Rie(l,a.lij))>-1)||(this._purgeTile(a),!1));n.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,i.length>ox&&(K.getLogger(this).warn(aDe),i=t.rootTilesInExtent(e,r,ox)),this._setRootTiles(i.map(s=>this._newRootTile(s)));kv(r,this._rootTilesExtent)||(this._rootTilesExtent=Nt(r)),this._visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const e=this._allTiles.filter(t=>t.isLoaded&&t.intersectsClippingArea);e.forEach(t=>this._renderer.updateTileGeometryState(t)),e.forEach(t=>t.renderData.updateNeighborData()),this._updateTilesGeometries(e),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(e){if(e.length===0)return;e.sort(Cm);const t=this.renderer;e.forEach(r=>t.updateGeometryIfNeeded(r)),e.forEach(r=>this._pendingTilesForElevationUpdateEvent.add(r))}_shouldSplit(e){return e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===dt.SPLIT}_newRootTile(e){const t=this._acquireTile(0,e[1],e[2],null);return this._shouldSplit(t)&&t.setPendingUpdate(dt.SPLIT),this._loadTile(t),this._markTileToUpdate(t),this._updateRootTileElevationBounds(),t}_setRootTiles(e){if(this._rootTiles=e,this._allTiles.clear(),e!=null){const t=this._iteratorPool.acquire();for(t.reset(e);!t.done;)this._allTiles.push(t.next());t.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visibleCached&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(dt.GEOMETRY)&&this._updateTileGeometryState(e)}_updateTilesVisibility(e){if(e==null)return;const t=urt(e),r=this.visibleElevationBounds;let i=t?r.min:1/0,s=t?r.max:-1/0;const n=this.extent,o=this._viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(e);!a.done;){const l=a.next();l.updateClippingStatus(n)&&l.resetPendingUpdate(dt.GEOMETRY)&&this._updateTileGeometryState(l),l.setPendingUpdate(dt.RENDERDATA),l.computeVisibility(),l.updateScreenDepth(o),l.renderData&&(i=Math.min(l.elevationBounds[0],i),s=Math.max(l.elevationBounds[1],s))}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._batchUpdatePendingTileGeometries(),isFinite(i)&&isFinite(s)&&(r.min!==i||r.max!==s)&&(this.visibleElevationBounds=new _x(i,s))}_updateRootTileElevationBounds(){let e=1/0,t=-1/0;const r=this._rootTiles;r?.forEach(({elevationBounds:s})=>{e=Math.min(e,s[0]),t=Math.max(t,s[1])});const i=this.rootTileElevationBounds;i.min===e&&i.max===t||(this.rootTileElevationBounds=new _x(e,t))}_updateViewDependentParameters(){const{camera:e,contentCamera:t}=this.view.state,r=Math.tan(.5*t.fovX),i=Math.tan(.5*t.fovY),s=this.tilingScheme.pixelSize,n=2**-this._lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=r,this._splitLimits.fovY=i,this._splitLimits.relativeWidthLimit=s/e.width*this.maxTextureScale*n,this._splitLimits.relativeHeightLimit=s/e.height*this.maxTextureScale*n,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(this._splitLimits.frustum==null&&(this._splitLimits.frustum=OA()),fL(this._splitLimits.frustum,t.frustum)):this._splitLimits.frustum=null,fL(this._frustum,e.frustum),Jr(this._viewProjectionMatrix,t.projectionMatrix,t.viewMatrix),re(this._eyePosRenderSR,t.eye),yn(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(b1e(e)?this._loadChildren(e):Rst(e)&&this._loadParent(e))}_updateTileGeometryState(e){e.updateVisibility(),this._renderer.updateTileGeometryState(e)&&this._markTileToUpdate(e),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(e){const t=this._pendingTilesToUpdate;e.forEachLoadedNeighbor(r=>{t.add(r)})}_updateTileTexture(e,t){const r=e.resetPendingUpdate(dt.TEXTURE_FADING)?dt.TEXTURE_FADING:!!e.resetPendingUpdate(dt.TEXTURE_NOFADING)&&dt.TEXTURE_NOFADING;r&&(this._renderer.updateTileTexture(e,r),this._usedMemory=null,t.madeProgress())}_emitElevationUpdateEventForTiles(){const e=kU.extent;qu(e),this._pendingTilesForElevationUpdateEvent.forEach(t=>ry(e,t.extent,e)),this._pendingTilesForElevationUpdateEvent.clear(),kU.spatialReference=this.spatialReference,this.emit("elevation-change",kU)}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(e),this._sortTiles(e);const t=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,t),this._updateElevation(e),this._updateTextures(e),t||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._batchUpdatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),e.done&&e.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(e){if(!this._viewChanged||!this._rootTiles||e.done)return;this._viewChanged=!1;const t=this._iteratorPool.acquire();t.reset(this._rootTiles);const r=this.snapLevel,i=this._splitLimits,s=this._eyePosRenderSR;for(;!t.done;){const n=t.next(),o=n.shouldSplit(i,s,r);if(o!==dt.SPLIT){if(n.resetPendingUpdate(dt.SPLIT)&&n.updateAgentSuspension(),o===dt.ELEVATION&&n.updateAgents(jt.ELEVATION),t.skipSubtree(),!n.isLeaf){n.setPendingUpdate(dt.MERGE),n.resetPendingUpdate(dt.SPLIT);const a=this._iteratorPool.acquire();a.resetOne(n);const l=this._viewProjectionMatrix;for(let c=a.next();!a.done;c=a.next())this._updateClippingStatus(c),c.updateVisibility(),c.updateScreenDepth(l);a.remove()}}else n.resetPendingUpdate(dt.MERGE),n.isLeaf&&(n.setPendingUpdate(dt.SPLIT),t.skipSubtree()),n.rendered&&n.setPendingUpdate(dt.RENDERDATA)}t.remove(),this.requestUpdate(),(this.shortBatches||!this.oneBatchPerFrameTask)&&this._batchUpdatePendingTileGeometries(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(lrt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_markTileToUpdate(e){we(e.isLoaded),e.intersectsClippingArea&&(this._pendingTilesToUpdate.add(e),this._markAllTileNeighborsForGeometryUpdate(e))}_batchUpdatePendingTileGeometries(){const e=this._pendingTilesToUpdate;if(e.size===0)return;const t=Array.from(this._pendingTilesToUpdate.keys()).filter(s=>s.isLoaded&&s.intersectsClippingArea),r=(s,n)=>{!n?.isLoaded||!n.intersectsClippingArea||n.level<s.level||e.has(n)||(e.add(n),t.push(n),n.renderData.updateNeighborData())};t.sort(Cm);const i=t.length;for(let s=0;s<i;++s){const n=t[s];we(n.isLoaded),we(n.intersectsClippingArea);const o=n.renderData;o.updateNeighborData();const a=o._dirtyEdgeResolutions,l=o.geometryState.neighborData.cornerPeerNeighbors,c=u=>{const d=l3[u];r(n,l[u]?.findCorner(cD(d),p=>p.isLoaded))};for(let u=0;u<4;++u)if(a&1<<u){const d=o.geometryState.neighborData.edgePeerNeighbors[u];d&&d?.level>=n.level&&d.forAllSubtreeOnSide(uD($p[u]),p=>!(!p.isLoaded||!p.intersectsClippingArea)&&(we(e.has(p)||Cm(n,p)<0),r(n,p),!0)),c((u+1)%4),c(u)}}e.clear(),this._updateTilesGeometries(t),Js&&oD&&this.checkAllTilesWaterproofness()}_mergeAndSplit(e,t){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let r=!1;const i=this.view.state.fixedContentCamera;let s=!1;for(;!e.done;){s=!0;let n=!1;const o=!this._allTiles.some(a=>{if(!r&&!i&&!a.visible)return e.done;let l=a;if(a.resetPendingUpdate(dt.MERGE)){if(!t)return a.setPendingUpdate(dt.MERGE),e.done;for(;l.parent?.resetPendingUpdate(dt.MERGE);)l=l.parent;this._mergeTile(l),n=!0,e.madeProgress()}else a.resetPendingUpdate(dt.SPLIT)&&(this._splitTile(a),n=!0,e.madeProgress());return!e.done&&l===a&&a.resetPendingUpdate(dt.RENDERDATA)&&(this._updateRenderData(a),e.madeProgress()),e.done});if(n&&(this._allTilesSorted=!1,this._allTilesDirty=!0),o){if(!r){r=!0;continue}if(!n)break}else this._allTilesDirty=!0}s?e.madeProgress():this._allTilesDirty=!0,!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries(),this._sortTiles(e)}_updateElevation(e){e.done||(this._allTiles.some(t=>(t.resetPendingUpdate(dt.GEOMETRY)&&(this._updateTileGeometryState(t),this._updateTileTexture(t,e),this.shortBatches&&this._batchUpdatePendingTileGeometries(),e.madeProgress()),e.done)),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries())}_updateTextures(e){e.done||this._allTiles.some(t=>(this._updateTileTexture(t,e),e.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(ns.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*sDe}_getLodBiasCorrectedScale(e){const t=this.tilingScheme.levels,r=fe(e-this._lodBias,0,t.length-1),i=r-Math.floor(r);return t[Math.floor(r)].scale*(1-i)+t[Math.ceil(r)].scale*i}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(e=>this._purgeTile(e)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this._visible=!1}_purgeDescendantTiles(e){if(!e.children[0])return!1;let t=!1;for(let r=0;r<4;++r)t=this._purgeTile(e.children[r])||t;return e.unsetChildren(),t}_purgeTile(e){const t=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),this._tilePool.release(e),t}_unloadTile(e){this._pendingTilesToUpdate.delete(e),this._pendingTilesForElevationUpdateEvent.delete(e),e.unload(this._renderer)}_splitTile(e){wp(e.isLeaf,"tile that is already split should not be split again!");const t=e.level+1,r=2*e.lij[1],i=2*e.lij[2];e.setChildren(this._createTile(t,r,i,e),this._createTile(t,r,i+1,e),this._createTile(t,r+1,i,e),this._createTile(t,r+1,i+1,e)),e.setPendingUpdate(dt.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(e,t=e.level){VP.spatialReference=this.spatialReference,VP.extent=e.extent,VP.scale=this._getLodBiasCorrectedScale(t),this.emit("scale-change",VP)}_createTile(e,t,r,i){wp(!!i,"_createTile sanity check");const s=this._acquireTile(e,t,r,i);return s.updateClippingStatus(this.extent),s.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(s)&&s.setPendingUpdate(dt.SPLIT),s}get shortBatches(){return this.view.state.mode!==Er.IDLE}_mergeTile(e){wp(!e.hasPendingUpdate(dt.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(wp(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e),this.shortBatches&&this._batchUpdatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(e){wp(e.rendered,"parent should be rendered"),this._unloadTile(e);const t=e.children;t.forEach(r=>this._loadTile(r)),t.forEach(r=>this._pendingTilesToUpdate.add(r)),this._markAllTileNeighborsForGeometryUpdate(e),this._emitTileScaleChange(e,e.level+1),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_loadParent(e){const t=e.parent;this._unloadChildren(t),this._loadTile(t),this._markTileToUpdate(t),this._emitTileScaleChange(t,t.level),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_unloadChildren(e){const t=e.children;if(t[0])for(let r=0;r<4;++r){const i=t[r];this._unloadChildren(i),this._unloadTile(i)}}_loadTile(e){e.load(),e.setPendingUpdate(dt.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e)}_elevationDataArrived(e,t,r){const i=new Vtt(e.lij,e.extent,r);e.dataArrived(t,jt.ELEVATION,i);const s=[e],n=e.level,o=this._iteratorPool.acquire();for(o.reset(s);!o.done;){const a=o.next();a.findElevationBoundsForLayer(t,n),a.computeElevationBounds()}n===0&&this._updateRootTileElevationBounds(),o.remove(),this._updateTilesVisibility(s)}_handleLayerViewChanges(e=_a){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let t=!1;const r=new Set;let i=-1;for(const s of this.view.allLayerViews.items)if(r.add(s.uid),a3(s)||OS(s))if(this._basemapLayerViewHandles.has(s.uid)&&!OS(s)){const n=this._layerClassFromLayerView(s),o=this._getLayerIdxByUID(n,s.uid);o!=null&&((o<i||i==null)&&(t=!0),i=o)}else this._registerTiledLayerView(s),s.layer.loaded&&(t=!0);this._basemapLayerViewHandles.forEach((s,n)=>{r.has(n)||(this._unregisterTiledLayerView(n),t=!0)}),t&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),e.madeProgress()}_allSurfaceLayersTransparent(){let e=this.view.map?.ground?.opacity===0;for(const t of this.view.allLayerViews.items)if(CB(t)&&!rpe(t.layer)&&t.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if((lD(e)||OS(e))&&grt(RB[e.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(e){return EB(e)?jt.ELEVATION:jt.MAP}_registerTiledLayerView(e){const t=[];if((lD(e)||OS(e))&&t.push(le(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(js.UNFADED)})),!OS(e)){const r=this._layerClassFromLayerView(e);t.push(le(()=>e.suspended,()=>this._updateTiledLayers())),t.push(le(()=>e.fullOpacity,()=>this._updateTileTextures(js.UNFADED))),t.push(le(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(r))),t.push(e.on("data-changed",()=>{const i=this._getLayerIdxByUID(r,e.uid);i!=null&&this._invalidateLayerData(i,r)}))}this._unregisterTiledLayerView(e.uid),this._basemapLayerViewHandles.set(e.uid,t)}_unregisterTiledLayerView(e){const t=this._basemapLayerViewHandles.get(e);if(t){for(const r of t)r.remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,t=[[],[]];let r=null;e.forEach(i=>{if(!i.layer||i.suspended||!a3(i)||!i.fullExtent)return;const s=this._layerClassFromLayerView(i);if(s===jt.MAP){const n=i.displayLevelRange.maxLevel;n!==1/0&&(r===null||n>r)&&(r=n)}t[s].push(i)});for(const i of rv){const s=this._layerViews[i],n=t[i];n.reverse();const o=n.length;let a=s.length!==o;const l=new Array(o),c=new Array(s.length);this._layerIndexByUid[i].clear();for(let u=0;u<o;u++){const d=n[u].uid;this._layerIndexByUid[i].set(d,u);const p=s.indexOf(n[u]);l[u]=p,u!==p&&(a=!0),p>-1&&(c[p]=u)}if(a){const u=this._postorderIterator;for(u.reset(this._rootTiles);!u.done;)u.next().modifyLayers(c,l,i);this._layerViews[i]=n,this._restartAllAgents(i),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(r)&&this._viewChangeUpdate()}_restartAllAgents(e){const t=this._postorderIterator;for(t.reset(this._rootTiles);!t.done;){const r=t.next();r.restartAgents(e),e===jt.ELEVATION&&r.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(e,t){return this._layerViews[t][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(t=>{t.updateAgents(jt.MAP),e===js.IMMEDIATE?this.renderer.updateTileTexture(t,dt.TEXTURE_NOFADING):t.updateRenderData(jt.MAP,e)}),this._evaluateTransparency()}_invalidateLayerData(e,t){this._allTiles.forAll(r=>r.removeLayerAgent(e,t)),this._allTiles.forAll(r=>r.invalidateLayerData(e,t))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=ns.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,t,r,i){const s=this.layerViewByIndex(t,r),n=s.layer;return!n.tilemapCache||o3(s)?this._requestTileData(e,r,s,i):(++this._asyncWorkItems,n.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...i,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,Jt(i),$s(o)||this._dataMissing(e,r,s,{notInTilemap:!0}),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,r,s,i),i.signal)))}_requestTileData(e,t,r,i){return t===jt.ELEVATION?EB(r)?this._requestElevationTileData(e,r,i):Promise.reject():CB(r)?this._requestMapTileData(e,r,i):Promise.reject()}_requestElevationTileData(e,t,r){++this._asyncWorkItems;const i=o=>{if(Hs(r))return;const a=this._layerIndexByUid[jt.ELEVATION].get(t.uid);a!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,a,o)):K.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",jt.ELEVATION,e.lij.toString())},s=o=>{$s(o)||(this._dataMissing(e,jt.ELEVATION,t,o),this.requestUpdate())};if(jte(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:vA,signal:r.signal}).then(o=>{if(!Hs(r))return this._frameTask.schedule(()=>i(o),r.signal,s);K.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},s).finally(()=>{--this._asyncWorkItems});const n=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(n,"binary",r).then(o=>this._lercDecoder.decode(o,{noDataValue:vA},r.signal)).then(o=>{o?i(new Att(o)):s(new Error("LERC decoding failed"))},s).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,t,r){++this._asyncWorkItems;const i=(c,u)=>{--this._asyncWorkItems,Gx(u),Hs(r)||(this._dataMissing(e,jt.MAP,t,c),this.requestUpdate())},s=c=>u=>i(u,c),n=c=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),Hs(r)?Gx(c):this._mapTileDataArrived(e,t,c)},r.signal,s(c)).catch(s(c)),o=(c,u=null)=>this._frameTask.schedule(()=>i(c,u));if(o3(t)){const c=t.schemaHelper.getLevelRowColumn(e.lij);return t.fetchTile(c[0],c[1],c[2],r).then(n,o)}if(e5(t))return t.fetchTile(e.lij[0],e.lij[1],e.lij[2],r).then(n,o);if(CW(t)&&jte(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],r).then(c=>{if(Hs(r))return K.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void o(Cr());n(c)},o);let a=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);Ett(t.layer)&&t.layer.refreshTimestamp&&(a+=`${a.includes("?")?"&":"?"}_ts=${t.layer.refreshTimestamp}`);const l=t.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(a,l,r).then(n,o)}_mapTileDataArrived(e,t,r){const i=this._getLayerIdxByUID(jt.MAP,t.uid);i!=null?e.dataArrived(i,jt.MAP,r):(Gx(r),K.getLogger(this).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,t){return this._layerIndexByUid[e].get(t)}_dataMissing(e,t,r,i){const s=this._getLayerIdxByUID(t,r.uid);s!=null?e.dataMissing(s,t,i):K.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(t=>{t.renderData&&this.overlayManager.setTileParameters(t)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(t=>{t.isLeaf&&e.numLeaves++;const r=t.level;t.renderData&&(e.numLoadedPerLevel[r]=(e.numLoadedPerLevel[r]||0)+1),t.visible&&(e.numVisible++,t.rendered&&(e.numRenderedPerLevel[r]=(e.numRenderedPerLevel[r]||0)+1,e.numRendered++))}),e}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory!=null?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,t)=>e+t.usedMemory,0):null}getUsedMemoryForLayerView(e){let t=this.overlayManager.gpuMemoryUsage;const r=this._layerClassFromLayerView(e),i=this._getLayerIdxByUID(r,e.uid);return i!=null&&this._allTiles.forAll(s=>t+=s.getUsedMemoryForLayer(r,i)),t}getTile(e){if(e==null||this._rootTiles==null)return null;const t=e.split("/").map(o=>+o);if(t[0]===0)return this._rootTiles.find(o=>o.lij[1]===t[1]&&o.lij[2]===t[2]);const r=2**t[0],i=Math.floor(t[1]/r),s=Math.floor(t[2]/r);let n;if(this._rootTiles.some(o=>o.lij[1]===i&&o.lij[2]===s&&(n=o,!0)),n){let o=1<<t[0]-1;for(;n.lij[0]<t[0];){let a=t[1]&o?2:0;if((t[2]&o)>0&&a++,!n.children[a])return null;n=n.children[a],o>>=1}return wp(n.lij[0]===t[0]&&n.lij[1]===t[1]&&n.lij[2]===t[2],"not the right tile?"),n}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(e){this._renderer.renderPatchBorders=e}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(e){this._renderer.visualizeNormals=e}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(e){this._renderer.renderingDisabled=e}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{e._rootTiles!=null&&e._rootTiles.length>0&&(e._mergeTile(e._rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){UU.clear(),e._allTiles.forAll(r=>{r.visible&&r.rendered&&UU.push(r)});const t=UU.toArray();return Uve(e.renderOrder,t),t},lockTilingScheme(t,r){e._extentHelper.defaultTiledLayersExtent=r,e.tilingSchemeLogic.test.lockTilingScheme(t)}}}checkAllTilesWaterproofness(){if(!oD)return;const e=this._rootTiles;if(e==null)return;const t=n=>n?.renderData?.geometry?.indices?.length>0,r=(n,o)=>{t(n)&&console.error("Tile[",n.lij,"] has geometry although parent[",o.lij,"] has geom")},i=n=>{if(n.intersectsClippingArea)if(n.renderData&&!n.renderData.geometryState&&console.error("Tile[",n.lij,"] has renderData but not geometryState"),n.renderData&&!n.renderData.geometry&&console.error("Tile[",n.lij,"] has renderData but not geometryInfo"),!n.renderData?.geometry||(n.renderData.geometry.indices?.length??0)>0||console.error("Tile[",n.lij,"] has renderData but no indices - geometryInfo: ",n.renderData.geometry),t(n)){n.checkGeometryWaterproofness();for(const o of n.children)r(o,n)}else if(n.isLeaf)console.error("Tile[",n.lij,"] has no geometry and no children, from root to leaf");else for(const o of n.children)i(o)},s=n=>{const o=n.parent?.visible??!0,a=n.visible;n.computeVisibility();const l=n.visible;if(a!==l&&o&&console.error(" Tile[",n.lij,"] has out of date visibility: ",a," instead of ",l),!n.isLeaf)for(const c of n.children)s(c)};for(const n of e)i(n),s(n)}get isGlobal(){return this._isGlobal}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(this.spatialReference!=null&&this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const t=this.lijEastEnd(e[0]),r=e[2];if(0<=r&&r<t)return e;if(!this.isGlobal)return null;const i=(r+(r<0?t:0))%t;return[e[0],e[1],i]}enableInternalChecks(e){Wet(e)}enableWaterproofnessChecks(e){Het(e)}};h([f()],Dt.prototype,"_renderer",void 0),h([f({constructOnly:!0})],Dt.prototype,"_scaleRangeQueries",void 0),h([f({constructOnly:!0})],Dt.prototype,"view",void 0),h([f({constructOnly:!0})],Dt.prototype,"overlayManager",void 0),h([f()],Dt.prototype,"_hasPendingUpdates",void 0),h([f()],Dt.prototype,"_asyncWorkItems",void 0),h([f()],Dt.prototype,"_allTilesDirty",void 0),h([f()],Dt.prototype,"_allTilesSorted",void 0),h([f()],Dt.prototype,"_viewChanged",void 0),h([f()],Dt.prototype,"_splitLimits",void 0),h([f({readOnly:!0})],Dt.prototype,"_watchUpdatingTracking",void 0),h([f()],Dt.prototype,"_frameTask",void 0),h([f({readOnly:!0})],Dt.prototype,"snapLevel",null),h([f({readOnly:!0})],Dt.prototype,"lodSnapping",null),h([f()],Dt.prototype,"_userClippingExtent",null),h([f()],Dt.prototype,"_rootTilesExtent",void 0),h([f({readOnly:!0})],Dt.prototype,"extent",null),h([f({readOnly:!0})],Dt.prototype,"groundExtent",null),h([f({readOnly:!0})],Dt.prototype,"_tilingSchemeExtent",null),h([f({readOnly:!0})],Dt.prototype,"updating",null),h([f({readOnly:!0})],Dt.prototype,"running",null),h([f(ztt)],Dt.prototype,"updatingProgress",void 0),h([f({readOnly:!0})],Dt.prototype,"updatingProgressValue",null),h([f()],Dt.prototype,"_maxNumUpdating",void 0),h([f()],Dt.prototype,"baseOpacity",null),h([f()],Dt.prototype,"hasCompositeBlendMode",void 0),h([f({readOnly:!0})],Dt.prototype,"viewingMode",null),h([f()],Dt.prototype,"maxTextureScale",void 0),h([f({readOnly:!0})],Dt.prototype,"ready",null),h([f({value:JT.FRONT_TO_BACK})],Dt.prototype,"renderOrder",null),h([f({readOnly:!0})],Dt.prototype,"rootTiles",null),h([f()],Dt.prototype,"_rootTiles",void 0),h([f({readOnly:!0})],Dt.prototype,"spatialReference",null),h([f({type:ot})],Dt.prototype,"backgroundColor",null),h([f({value:!1})],Dt.prototype,"slicePlaneEnabled",null),h([f({readOnly:!0})],Dt.prototype,"tilingScheme",void 0),h([f({readOnly:!0})],Dt.prototype,"tilingSchemeLocked",null),h([f({readOnly:!0})],Dt.prototype,"tilingSchemeLogic",void 0),h([f()],Dt.prototype,"wireframe",null),h([f({value:!1})],Dt.prototype,"suspended",null),h([f()],Dt.prototype,"textureFadeDuration",null),h([f()],Dt.prototype,"visibleElevationBounds",void 0),h([f()],Dt.prototype,"rootTileElevationBounds",void 0),h([f()],Dt.prototype,"_layerViewsDirty",void 0),h([f()],Dt.prototype,"renderPatchBorders",null),h([f()],Dt.prototype,"visualizeNormals",null),h([f()],Dt.prototype,"renderingDisabled",null),Dt=h([F("esri.views.3d.terrain.TerrainSurface")],Dt);const Ost=Dt;function Rie(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function b1e(e){const t=e.children;if(!t[0])return!1;for(const r of t)if(r.shouldLoad)return!0;for(const r of t)if(b1e(r))return!0;return!1}function Rst(e){return e.isLeaf&&(e.parent?.shouldLoad??!1)}const $a=Ht(),Pst=Nt(),BP=[0,0,0],UU=new Mt,kU={spatialReference:null,extent:Nt(),context:"ground"},VP={spatialReference:null,extent:null,scale:0};function Pie(e,t,r){for(const i of e){if(!i.containsPointXY(t,r))continue;let s=i;for(;s&&!s.renderData;){const o=(t>s.extentMidX?1:0)+(r<s.extentMidY?2:0);s=s.children[o]}const n=s?.renderData?.geometryState.samplerData??null;return ki(t,r,n)}return null}class Mst{constructor(t,r,i){this.operation=t,this.geometry=r,this.states=i}}let HE=class extends xe{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,t){const r=this._dirtyGeomRecords.get(e);r&&(r.forEach((i,s)=>{const n=this._ensureGeomRecord(e,s);i.forEach(({geometry:o,operation:a,states:l},c)=>{let u=!1;if(a===Fi.UPDATE){const d=n.get(c);if(d){if(l&hn.TRANSFORMATION){const p=this.model.getObject(s);this.model.updateRenderGeometryTransformation(p,o,d)&&(u=!0)}u||t.updates.push({renderGeometry:d,updateType:l})}else Ye(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(a===Fi.REMOVE||u){const d=n.get(c);d?(t.removes.push(d),n.delete(c)):a===Fi.REMOVE&&Ye(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(a===Fi.ADD||u){const d=this.model.getObject(s);if(d!=null){const p=this.model.getRenderGeometry(d,o);t.adds.push(p),n.set(c,p)}}}),n.size===0&&this._residentGeomRecords.get(e).delete(s)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}getResidentRenderGeometries(e,t){const r=this._residentGeomRecords.get(e);r&&r.forEach(i=>i.forEach(s=>t.push(s)))}_objectStateChanged(e,t){for(const r of t.geometries)this._updateOrCreateDirtyRecord(t,r,null,Fi.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(hn.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(hn.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(hn.OCCLUDEE,e)}objectGeometryUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.geometry,null,Fi.UPDATE,hn.GEOMETRY)}layerAdded(e){e.objects.forAll(t=>this._layerObjectAdded(e,t))}layerRemoved(e){e.objects.forAll(t=>this._layerObjectRemoved(e,t))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,t){const r=e.id;for(const i of t.geometries)this._objectGeometryAdded(t,i,r)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const t of e.objects)this._layerObjectAdded(e.layer,t)}layerObjectsRemoved(e){for(const t of e.objects)this._layerObjectRemoved(e.layer,t)}_layerObjectRemoved(e,t){const r=e.id;for(const i of t.geometries)this._objectGeometryRemoved(t,i,r)}shaderTransformationChanged(e){const t=this._residentGeomRecords.get(e.id);t&&t.forEach((r,i)=>{const s=this.model.getObject(i);s&&s.hasVolativeTransformation()&&r.forEach(n=>n.shaderTransformationChanged())})}objectTransformation(e){const t=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(t,r).forEach(i=>{this._updateOrCreateDirtyRecord(e,i.geometry,t,Fi.UPDATE,hn.TRANSFORMATION)})}objectShaderTransformation(){}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.geometry)}_objectGeometryAdded(e,t,r=null){this._updateOrCreateDirtyRecord(e,t,r,Fi.ADD)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.geometry)}_objectGeometryRemoved(e,t,r=null){this._updateOrCreateDirtyRecord(e,t,r,Fi.REMOVE)}_updateOrCreateDirtyRecord(e,t,r,i,s=hn.NONE){r=r??this._getParentLayerId(e);const n=e.id,o=t.id,a=this._ensureDirtyRecord(r,n),l=a.get(o);if(l){const c=l.operation;c===Fi.REMOVE&&i===Fi.ADD&&l.states!==hn.NONE?l.operation=Fi.UPDATE:c===Fi.REMOVE&&i===Fi.ADD||c===Fi.ADD&&i===Fi.REMOVE?a.delete(o):c!==Fi.UPDATE||i!==Fi.REMOVE&&i!==Fi.UPDATE?(Ye((c===Fi.REMOVE||c===Fi.ADD)&&i===Fi.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),l.states|=s):(l.operation=i,l.states|=s)}else a.set(o,new Mst(i,t,s));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,t){let r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));let i=r.get(t);return i||(i=new Map,r.set(t,i)),i}get _hasDirtyGeometryRecords(){return _o(this._dirtyGeomRecords,e=>_o(e,t=>t&&t.size>0))}_ensureDirtyRecord(e,t){let r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));let i=r.get(t);return i||(i=new Map,r.set(t,i)),i}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:uxe}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let t="";return this._dirtyGeomRecords.forEach((r,i)=>{r.forEach((s,n)=>{t.length>0&&(t+=`
`),t+=i+"."+n;const o=[];s.forEach(a=>{const l=a.operation;o[l]||(o[l]=[]),o[l].push(a.geometry.id)});for(let a=0;a<o.length;a++)if(o[a]){t+=" "+e[a-1]+": ";for(let l=0;l<o[a].length;l++)t+=o[a][l]+", "}})}),t}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((t,r)=>t+r.size,0)},commit:t=>e._dirtyGeomRecords.forEach((r,i)=>e.commitLayer(i,t))}}};h([f({constructOnly:!0})],HE.prototype,"model",void 0),h([f()],HE.prototype,"dirty",void 0),HE=h([F("esri.views.3d.webgl-engine.lib.ModelDirtySet")],HE);const Ist=HE;let MI=class extends xe{constructor(){super(...arguments),this.dirtySet=new Ist({model:this}),this._content=new Map,this._originFactory=new WH(null)}getObject(e){return this._content.get(e)}add(e){const t=e.id;Ye(!this._content.has(t),"Model/Stage already contains object to be added"),this._content.set(t,e),WL(e)&&this.dirtySet.layerAdded(e)}remove(e){Ye(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),WL(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const t of e)t!=null&&(Ye(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t))}removeMany(e){for(const t of e)Ye(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id),t.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,t){this._content.forEach(r=>{r.type===e&&t(r)})}getRenderGeometry(e,t){const{shaderTransformer:r,localOrigin:i}=t,s=new YT(t,{shaderTransformer:r,castShadow:e.castShadow});return s.updateTransformation(n=>e.getCombinedStaticTransformation(t,n)),s.localOrigin=i??this._originFactory.getOrigin(s.boundingSphere),s}updateRenderGeometryTransformation(e,t,r){if(e==null)return!1;r.updateTransformation(s=>e.getCombinedStaticTransformation(t,s));const i=this._originFactory.getOrigin(r.boundingSphere);return r.localOrigin!==i}getStats(){const e={},t=Array.from(this._content.values());for(let r=0;r<Ki.COUNT;++r)e[r]=t.filter(i=>i.type===r).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};h([f({constructOnly:!0})],MI.prototype,"dirtySet",void 0),MI=h([F("esri.views.3d.webgl-engine.parts.Model")],MI);function $st(){const e=new Float32Array(4);return e[3]=1,e}function w1e(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Lst(e,t,r,i){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s}function x1e(e,t){return new Float32Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:w1e,create:$st,createView:x1e,fromValues:Lst},Symbol.toStringTag,{value:"Module"}));const QT=1e-6,$S=[0,0,0],GP=[0,0,0];function Dst(e,t){const{data:r,size:i}=e,s=r.length/i;if(s<=0)return;const n=new jst(e);II($S,n.minProj,n.maxProj),Tv($S,$S,.5),Ou(GP,n.maxProj,n.minProj);const o=BB(GP),a=new Hst;a.quality=o,s<14&&(e=new Fe(new Float64Array(n.buffer,112,42),3));const l=[0,0,0],c=[0,0,0],u=[0,0,0],d=[0,0,0],p=[0,0,0],g=[0,0,0],y=[0,0,0];switch(Nst(n,e,y,l,c,u,d,p,g,a)){case 1:return void Lie($S,GP,t);case 2:return void Gst(e,d,t)}Fst(e,y,l,c,u,d,p,g,a),T1e(e,a.b0,a.b1,a.b2,qx,Xx);const _=[0,0,0];Ou(_,Xx,qx),a.quality=BB(_),a.quality<o?S1e(a.b0,a.b1,a.b2,qx,Xx,_,t):Lie($S,GP,t)}function Nst(e,t,r,i,s,n,o,a,l,c){return Ust(e,i,s),VB(i,s)<QT?1:(Ou(o,i,s),fo(o,o),kst(t,i,o,n)<QT?2:(Ou(a,s,n),fo(a,a),Ou(l,n,i),fo(l,l),Ru(r,a,o),fo(r,r),iv(t,r,o,a,l,c),0))}const LS=[0,0,0],DS=[0,0,0],Yc=[0,0,0],Jc=[0,0,0],Kc=[0,0,0],Fg=[0,0,0],Ug=[0,0,0],kg=[0,0,0];function Fst(e,t,r,i,s,n,o,a,l){zst(e,t,r,LS,DS),LS[0]!==void 0&&(Ou(Yc,LS,r),fo(Yc,Yc),Ou(Jc,LS,i),fo(Jc,Jc),Ou(Kc,LS,s),fo(Kc,Kc),Ru(Fg,Jc,n),fo(Fg,Fg),Ru(Ug,Kc,o),fo(Ug,Ug),Ru(kg,Yc,a),fo(kg,kg),iv(e,Fg,n,Jc,Yc,l),iv(e,Ug,o,Kc,Jc,l),iv(e,kg,a,Yc,Kc,l)),DS[0]!==void 0&&(Ou(Yc,DS,r),fo(Yc,Yc),Ou(Jc,DS,i),fo(Jc,Jc),Ou(Kc,DS,s),fo(Kc,Kc),Ru(Fg,Jc,n),fo(Fg,Fg),Ru(Ug,Kc,o),fo(Ug,Ug),Ru(kg,Yc,a),fo(kg,kg),iv(e,Fg,n,Jc,Yc,l),iv(e,Ug,o,Kc,Jc,l),iv(e,kg,a,Yc,Kc,l))}function Ust(e,t,r){let i=VB(e.maxVert[0],e.minVert[0]),s=0;for(let n=1;n<7;++n){const o=VB(e.maxVert[n],e.minVert[n]);o>i&&(i=o,s=n)}Dl(t,e.minVert[s]),Dl(r,e.maxVert[s])}const Qc=[0,0,0];function kst(e,t,r,i){const{data:s,size:n}=e;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){Qc[0]=s[l]-t[0],Qc[1]=s[l+1]-t[1],Qc[2]=s[l+2]-t[2];const c=r[0]*Qc[0]+r[1]*Qc[1]+r[2]*Qc[2],u=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],d=Qc[0]*Qc[0]+Qc[1]*Qc[1]+Qc[2]*Qc[2]-c*c/u;d>o&&(o=d,a=l)}return Dl(i,s,a),o}const un=[0,0];function zst(e,t,r,i,s){Vst(e,t,un,s,i);const n=C1e(r,t);un[1]-QT<=n&&(i[0]=void 0),un[0]+QT>=n&&(s[0]=void 0)}const Mie=[0,0,0],Iie=[0,0,0],$ie=[0,0,0],aw=[0,0,0],lw=[0,0,0],jP=[0,0,0];function iv(e,t,r,i,s,n){if(E1e(t)<QT)return;Ru(Mie,r,t),Ru(Iie,i,t),Ru($ie,s,t),Wx(e,t,un),lw[1]=un[0],aw[1]=un[1],jP[1]=aw[1]-lw[1];const o=[r,i,s],a=[Mie,Iie,$ie];for(let l=0;l<3;++l){Wx(e,o[l],un),lw[0]=un[0],aw[0]=un[1],Wx(e,a[l],un),lw[2]=un[0],aw[2]=un[1],jP[0]=aw[0]-lw[0],jP[2]=aw[2]-lw[2];const c=BB(jP);c<n.quality&&(Dl(n.b0,o[l]),Dl(n.b1,t),Dl(n.b2,a[l]),n.quality=c)}}const Bst=[0,0,0];function Wx(e,t,r){const{data:i,size:s}=e;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<i.length;n+=s){const o=i[n]*t[0]+i[n+1]*t[1]+i[n+2]*t[2];r[0]=Math.min(r[0],o),r[1]=Math.max(r[1],o)}}function Vst(e,t,r,i,s){const{data:n,size:o}=e;Dl(i,n),Dl(s,i),r[0]=C1e(Bst,t),r[1]=r[0];for(let a=o;a<n.length;a+=o){const l=n[a]*t[0]+n[a+1]*t[1]+n[a+2]*t[2];l<r[0]&&(r[0]=l,Dl(i,n,a)),l>r[1]&&(r[1]=l,Dl(s,n,a))}}function Lie(e,t,r){Dl(r.center,e),Tv(r.halfSize,t,.5),r.quaternion[0]=0,r.quaternion[1]=0,r.quaternion[2]=0,r.quaternion[3]=1}const Mf=[0,0,0],cw=[0,0,0],NS=[0,0,0],qx=[0,0,0],Xx=[0,0,0],Die=[0,0,0];function Gst(e,t,r){Dl(Mf,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?Mf[0]=0:Math.abs(t[1])>Math.abs(t[2])?Mf[1]=0:Mf[2]=0,E1e(Mf)<QT&&(Mf[0]=Mf[1]=Mf[2]=1),Ru(cw,t,Mf),fo(cw,cw),Ru(NS,t,cw),fo(NS,NS),T1e(e,t,cw,NS,qx,Xx),Ou(Die,Xx,qx),S1e(t,cw,NS,qx,Xx,Die,r)}function T1e(e,t,r,i,s,n){Wx(e,t,un),s[0]=un[0],n[0]=un[1],Wx(e,r,un),s[1]=un[0],n[1]=un[1],Wx(e,i,un),s[2]=un[0],n[2]=un[1]}const HP=[0,0,0],Xd=[1,0,0,0,1,0,0,0,1],uw=[0,0,0];function S1e(e,t,r,i,s,n,o){Xd[0]=e[0],Xd[1]=e[1],Xd[2]=e[2],Xd[3]=t[0],Xd[4]=t[1],Xd[5]=t[2],Xd[6]=r[0],Xd[7]=r[1],Xd[8]=r[2],Wst(o.quaternion,Xd),II(uw,i,s),Tv(uw,uw,.5),Tv(o.center,e,uw[0]),Tv(HP,t,uw[1]),II(o.center,o.center,HP),Tv(HP,r,uw[2]),II(o.center,o.center,HP),Tv(o.halfSize,n,.5)}const ec=7;class jst{constructor(t){this.minVert=new Array(ec),this.maxVert=new Array(ec);const r=64*ec;this.buffer=new ArrayBuffer(r);let i=0;this.minProj=new Float64Array(this.buffer,i,ec),i+=8*ec,this.maxProj=new Float64Array(this.buffer,i,ec),i+=8*ec;for(let l=0;l<ec;++l)this.minVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<ec;++l)this.maxVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<ec;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(ec),n=new Array(ec),{data:o,size:a}=t;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<ec;++l){let c=s[l];Dl(this.minVert[l],o,c),c=n[l],Dl(this.maxVert[l],o,c)}}}class Hst{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}}function BB(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function II(e,t,r){e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2]}function Ou(e,t,r){e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2]}function Tv(e,t,r){e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}function Dl(e,t,r=0){e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2]}function Ru(e,t,r){const i=t[0],s=t[1],n=t[2],o=r[0],a=r[1],l=r[2];e[0]=s*l-n*a,e[1]=n*o-i*l,e[2]=i*a-s*o}function fo(e,t){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(r>0){const i=1/Math.sqrt(r);e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}}function E1e(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function VB(e,t){const r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2];return r*r+i*i+s*s}function C1e(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Wst(e,t){const r=t[0]+t[4]+t[8];if(r>0){let i=Math.sqrt(r+1);e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i}else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);const s=(i+1)%3,n=(i+2)%3;let o=Math.sqrt(t[3*i+i]-t[3*s+s]-t[3*n+n]+1);e[i]=.5*o,o=.5/o,e[3]=(t[3*s+n]-t[3*n+s])*o,e[s]=(t[3*s+i]+t[3*i+s])*o,e[n]=(t[3*n+i]+t[3*i+n])*o}}const Qv=rh(),ha=C(),GB=C(),qst=$i();class tgt{constructor(t){const o=t*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(t);for(let a=0;a<t;a++)this.obbs[a]={center:SV(this.buffer,56*a+0),halfSize:ffe(this.buffer,56*a+24),quaternion:x1e(this.buffer,56*a+36)}}}function A1e(e=[0,0,0],t=[-1,-1,-1],r=rh()){return{center:Ts(e),halfSize:dL(t),quaternion:w1e(r)}}function Nie(e){return A1e(e.center,e.halfSize,e.quaternion)}function rgt(e,t){re(t.center,e.center),re(t.halfSize,e.halfSize),Mj(t.quaternion,e.quaternion)}function igt(e,t){return t=t||A1e(),Dst(e,t),t}function sv(e,t){const r=ri(t,e.center),i=c5(e,t);return r>i?1:r<-i?-1:0}function sgt(e,t){return ha[0]=e.center[0]-t[0],ha[1]=e.center[1]-t[1],ha[2]=e.center[2]-t[2],Sy(Qv,e.quaternion),Uu(ha,ha,Qv),ZI(ha,ha),OV(GB,ha,e.halfSize),ED(GB,ha)<t[3]*t[3]}function ngt(e,t){t||(t=Qs());const r=wj(qst,e.quaternion),i=e.halfSize[0]*Math.abs(r[0])+e.halfSize[1]*Math.abs(r[3])+e.halfSize[2]*Math.abs(r[6]),s=e.halfSize[0]*Math.abs(r[1])+e.halfSize[1]*Math.abs(r[4])+e.halfSize[2]*Math.abs(r[7]),n=e.halfSize[0]*Math.abs(r[2])+e.halfSize[1]*Math.abs(r[5])+e.halfSize[2]*Math.abs(r[8]);return t[0]=e.center[0]-i,t[1]=e.center[1]-s,t[2]=e.center[2]-n,t[3]=e.center[0]+i,t[4]=e.center[1]+s,t[5]=e.center[2]+n,t}function ogt(e,t){return ri(t,e.center)-c5(e,t)}function agt(e,t){return ri(t,e.center)+c5(e,t)}function lgt(e,t){return sv(e,t[0])<=0&&sv(e,t[1])<=0&&sv(e,t[2])<=0&&sv(e,t[3])<=0&&sv(e,t[4])<=0&&sv(e,t[5])<=0}function cgt(e,t,r,i=0){Sy(Qv,e.quaternion),ce(ha,t,e.center);const s=Uu(ha,ha,Qv),n=Uu(GB,r,Qv);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(n[l])>1e-6){const c=(i+e.halfSize[l]-s[l])/n[l],u=(-i-e.halfSize[l]-s[l])/n[l];o=Math.max(o,Math.min(c,u)),a=Math.min(a,Math.max(c,u))}else if(s[l]>e.halfSize[l]+i||s[l]<-e.halfSize[l]-i)return!1;return o<=a}(()=>{const e=new Int8Array(162);let t=0;const r=i=>{for(let s=0;s<i.length;s++)e[t+s]=i[s];t+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),e})();function c5(e,t){Sy(Qv,e.quaternion),Uu(ha,t,Qv);const r=e.halfSize;return Math.abs(ha[0]*r[0])+Math.abs(ha[1]*r[1])+Math.abs(ha[2]*r[2])}function ugt(e,t){for(let r=0;r<8;++r){const i=t[r];i[0]=1&r?-e.halfSize[0]:e.halfSize[0],i[1]=2&r?-e.halfSize[1]:e.halfSize[1],i[2]=4&r?-e.halfSize[2]:e.halfSize[2],Uu(i,i,e.quaternion),oe(i,i,e.center)}}function Xst(e){return bl(e.halfSize)}function Zst(e,t,r,i,s){if(Mj(s.quaternion,e.quaternion),i===Ie.Global){Sy(WP,e.quaternion),Uu(zg,e.center,WP),ZI(hw,zg),OV(dw,hw,e.halfSize),Ln(dw,hw,dw);const n=Se(dw);oe(dw,hw,e.halfSize);const o=Se(dw);if(n<r)re(s.center,e.center),se(zg,r,r,r),oe(s.halfSize,e.halfSize,zg);else{const a=o>0?1+t/o:1,l=n>0?1+r/n:1,c=(l+a)/2,u=(l-a)/2;te(s.halfSize,hw,u),Ev(s.halfSize,s.halfSize,e.halfSize,c),te(s.center,hw,c),Ev(s.center,s.center,e.halfSize,u),Cne(zg,zg),SD(s.center,s.center,zg),Uu(s.center,s.center,s.quaternion)}}else{const n=se(zg,0,0,1);Ev(s.center,e.center,n,(r+t)/2),Sy(WP,e.quaternion),Uu(n,n,WP),ZI(n,n),Ev(s.halfSize,e.halfSize,n,(r-t)/2)}return s}const zg=C(),hw=C(),dw=C(),WP=rh();class Yst{constructor(t){this._totalCount=t,this._indexRanges=[0,t]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const t=this._indexRanges;let r=0;for(let i=0;i<t.length;i+=2)r+=t[i+1];return r}reset(t){t==="all"||t.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=Jst(t)}forEachComponent(t){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i],n=s+r[i+1];for(let o=s;o<n;o++)if(!t(o))return!1}return!0}forEachComponentRange(t){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i];if(!t(s,s+r[i+1]))return!1}return!0}computeOffsetRanges(t){const r=new Array(this._indexRanges.length),i=this._indexRanges;for(let s=0;s<i.length;s+=2){const n=i[s],o=n+i[s+1],a=t[n],l=t[o];r[s]=a,r[s+1]=l-a}return r}}function Jst(e){const t=new Array;if(e.length===0)return t;let r=e[0],i=1;for(let s=1;s<e.length;s++){const n=e[s];r+i===n?i+=1:(t.push(r),t.push(i),r=n,i=1)}return t.push(r),t.push(i),t}class Kst{constructor(t,r){this.offsets=r,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const i=this.count;this.visibility=new Yst(i),this.materialDataBuffer=t.getBuffer(i),this.materialDataIndices=new Uint16Array(i);for(let s=0;s<i;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let t=0;t<this.count;t++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[t])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return this.highlightCounts==null?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return this.highlightCounts==null?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((this.cachedHighlightRanges==null||this.cachedDefaultRanges==null)&&this.highlightCounts!=null){const{highlightRanges:t,defaultRanges:r}=Qst(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=t,this.cachedDefaultRanges=r}}}function Qst(e,t,r){const i=[],s=[];let n=r.length,o=r.length;return t.forEachComponent(a=>(e[a]>0?(n!==a-1&&(i.length&&i.push(r[n+1]-i[i.length-1]),i.push(r[a])),n=a):(o!==a-1&&(s.length&&s.push(r[o+1]-s[s.length-1]),s.push(r[a])),o=a),!0)),i.length&&i.push(r[n+1]-i[i.length-1]),s.length&&s.push(r[o+1]-s[s.length-1]),{highlightRanges:i,defaultRanges:s}}let WE=class extends xe{constructor(){super(...arguments),this.visible=Zx.Hidden}};var Zx;h([f({autoDestroy:!0})],WE.prototype,"renderable",void 0),h([f({autoDestroy:!0})],WE.prototype,"components",void 0),WE=h([F("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],WE),function(e){e[e.Hidden=0]="Hidden",e[e.Visible=1]="Visible"}(Zx||(Zx={}));function ent(e,t,r,i){if(r>=t)return e;e==null&&(e=tnt());const s=e.isVisibleBit;let n=e.data;const o=R1e(n),a=r/o|0,l=r-o*a,c=(t-1)/o|0,u=n,d=i===s;if(!(r<u.length*o)&&d){const p=a+1,g=Math.ceil(u.length*CD),y=c+1;let _=Math.max(p,g);_=Math.min(_,y),n=new Uint32Array(_),n.set(u)}return a<n.length&&(n[a]=int(n[a],l,d)),e.data=n,e}function O1e(e,t){if(e==null)return!0;const{isVisibleBit:r,data:i}=e,s=R1e(i);return t<i.length*s?rnt(r,i,t,s):!e.isVisibleBit}function tnt(e=!0){return{isVisibleBit:!e,data:new Uint32Array(0)}}function rnt(e,t,r,i){const s=r/i|0,n=r-s*i;return snt(t[s],n)===e}function R1e(e){return e.BYTES_PER_ELEMENT*8}function int(e,t,r){return e&~(1<<t)|(r?1:0)<<t}function snt(e,t){return(e&1<<t)!=0}class nnt{constructor(t,r){this._components=r,this._indices=t.indices!=null?Vp(t.indices):NT(t.positions.length/3),this._positions=t.positions,this._componentIntersectionData=new Array(r.count)}getComponentAabb(t,r){this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs());for(let i=0;i<6;i++)r[i]=this._perComponentAabbs[6*t+i];return r}getComponentPositions(t,r){r.indices=this._indices,r.data=this._positions,r.stride=3,r.startIndex=this._components.offsets[t],r.endIndex=this._components.offsets[t+1]}intersect(t,r,i,s,n,o,a){const l=new Fe(this._positions,3,!1,3),c=this._indices,u=this._components.offsets,d=wge(t,r,ont),p=t[2],g=r[2];this._components.visibility.forEachComponent(y=>{if(!O1e(this._components.pickability,y))return!0;const _=this.getComponentAabb(y,ant);if(o!=null){const x=o[y];n!=null?n.componentOffset=x:(t[2]=p-x,r[2]=g-x)}if(n?.applyToAabb(_),!hH(_,t,d,i))return!0;const v=u[y]/3,w=u[y+1]/3,T=(x,S,O)=>a(y,x,Il(S,S,s),O);return n==null&&w-v>_1e?(this._componentIntersectionData[y]==null&&(this._componentIntersectionData[y]=new KT(this._indices,v,w,l)),this._componentIntersectionData[y].intersectRay({r0:t,r1:r},T)):Y3(t,r,v,w,c,l,void 0,n,T),!0})}_computePerComponentAabbs(){const t=this._components.count,r=Vi(6*t),i=this._indices,s=this._positions,n=this._components.offsets;let o=0;for(let a=0;a<t;a++){const l=n[a],c=n[a+1];let u=1/0,d=1/0,p=1/0,g=-1/0,y=-1/0,_=-1/0;for(let v=l;v<c;v++){const w=3*i[v],T=s[w],x=s[w+1],S=s[w+2];u=Math.min(u,T),d=Math.min(d,x),p=Math.min(p,S),g=Math.max(g,T),y=Math.max(y,x),_=Math.max(_,S)}r[o++]=u,r[o++]=d,r[o++]=p,r[o++]=g,r[o++]=y,r[o++]=_}return r}get positions(){return this._positions}get indices(){return this._indices}}const ont=C(),ant=Qs();class lnt{constructor(t,r,i){this.material=t,this.geometry=r,this.meta=i}destroy(){this.material.dispose(),this.geometry.dispose()}}class cnt{constructor(t,r,i,s){this.vao=t,this.primitiveType=r,this.parameters=i,this.indexed=s}dispose(){this.vao.dispose()}}class unt{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}}function hnt(e,t){return{near:e,far:t}}function pO(e){return e?h3(e,1/0,-1/0):hnt(1/0,-1/0)}function h3(e,t,r){return e.near=t,e.far=r,e}function e2(e,t,r=e){return t!=null&&(r.near=Math.min(e.near,t.near),r.far=Math.max(e.far,t.far)),r}function qP(e,t){return e.near<=t&&t<=e.far}const jB={near:0,far:0};function dnt(e,t){const r=pO(),{eye:i,frustum:s,viewForward:n}=e;t.forAll(o=>{const a=o.offsetObb!=null?o.offsetObb:o.obb,l=de(Ln(nc,a.center,i),n),c=c5(a,n);if(qP(r,l-c)&&qP(r,l+c))return;const u=ynt(a,s);if(u===-1)return;if(u===0)return If.far=l+c,If.near=l-c,void e2(r,If);const d=XP.pushNew();d.near=l-c,d.far=l+c,d.mask=u,d.object=o});for(let o=0;o<XP.length;o++){const a=XP.data[o];if(qP(r,a.near)&&qP(r,a.far))continue;If.far=a.far,If.near=1/0,gnt(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,i,pnt,c=>{let u=fnt;for(let d=0;d<P1e&&c.length>0;d++){if((a.mask&1<<d)==0)continue;mnt(s[d],c,u);const p=c;c=u,u=p}for(let d=0;d<c.length;d+=3){se(za,c.data[d],c.data[d+1],c.data[d+2]);const p=de(Ln(za,za,i),n);If.near=Math.min(If.near,p)}})===0&&(If.near=0),e2(r,If)}return XP.length=0,r}const XP=new Mt({allocator:e=>e||{near:1/0,far:-1/0,mask:0,object:null},deallocator:e=>(e.object=s2(e.object),e)}),If=pO(),za=C(),C_=C(),pnt=new Mt({deallocator:null}),fnt=new Mt({deallocator:null});function mnt(e,t,r){r.length=0;const i=t.length-3;zU(za,t,i);const s=ri(e,za);s<=0&&(r.push(za[0]),r.push(za[1]),r.push(za[2]));let n=0,o=s;for(;n<i;n+=3){zU(C_,t,n);const a=ri(e,C_);o*a<0&&(Lr(za,C_,za,a/(a-o)),Ba(r,za)),a<=0&&Ba(r,C_),o=a,re(za,C_)}o*s<0&&(zU(C_,t,i),Lr(za,C_,za,s/(s-o)),Ba(r,za))}function zU(e,t,r){return se(e,t.data[r],t.data[r+1],t.data[r+2])}function Ba(e,t){e.push(t[0]),e.push(t[1]),e.push(t[2])}function gnt(e,t,r,i){Sy(Uie,e.quaternion),Ln(nc,t,e.center),Uu(nc,nc,Uie);const s=8*((nc[0]<-e.halfSize[0]?-1:nc[0]>e.halfSize[0]?1:0)+3*(nc[1]<-e.halfSize[1]?-1:nc[1]>e.halfSize[1]?1:0)+9*(nc[2]<-e.halfSize[2]?-1:nc[2]>e.halfSize[2]?1:0)+13),n=Fie[s];if(n===0)return n;wj(ZP,e.quaternion),bj(ZP,ZP,e.halfSize);const o=(a,l)=>{const c=Fie[s+l+1];return se(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),Il(a,a,ZP),oe(a,e.center,a)};return r.length=0,Ba(r,o(BU,0)),Ba(r,o(kie,1)),Ba(r,o(nc,2)),Ba(r,o(zie,3)),i(r),n===1||(r.length=0,Ba(r,BU),Ba(r,zie),Ba(r,o(nc,4)),Ba(r,o(Bie,5)),i(r),n===2||(r.length=0,Ba(r,BU),Ba(r,Bie),Ba(r,o(nc,6)),Ba(r,kie),i(r))),n}const Fie=(()=>{const e=new Array(216);let t=0;const r=i=>{for(let s=0;s<i.length;s++)e[t+s]=i[s];t+=8};return r([3,0,6,2,3,1,5,4]),r([2,0,2,3,1,5,4,0]),r([3,1,0,2,3,7,5,4]),r([2,0,1,3,2,6,4,0]),r([1,0,1,3,2,0,0,0]),r([2,1,5,7,3,2,0,0]),r([3,2,0,1,3,7,6,4]),r([2,2,0,1,3,7,6,0]),r([3,3,0,1,5,7,6,2]),r([2,0,1,5,4,6,2,0]),r([1,0,1,5,4,0,0,0]),r([2,1,3,7,5,4,0,0]),r([1,0,2,6,4,0,0,0]),r([0,0,0,0,0,0,0,0]),r([1,1,3,7,5,0,0,0]),r([2,2,3,7,6,4,0,0]),r([1,2,3,7,6,0,0,0]),r([2,3,1,5,7,6,2,0]),r([3,4,0,1,5,7,6,2]),r([2,5,7,6,4,0,1,0]),r([3,5,0,1,3,7,6,4]),r([2,4,5,7,6,2,0,0]),r([1,4,5,7,6,0,0,0]),r([2,5,1,3,7,6,4,0]),r([3,6,0,2,3,7,5,4]),r([2,6,2,3,7,5,4,0]),r([3,7,6,2,3,1,5,4]),e})(),P1e=4;function ynt(e,t){let r=0;for(let i=0;i<P1e;i++){const s=sv(e,t[i]);if(s>0)return-1;s===0&&(r|=1<<i)}return r}const ZP=$i(),Uie=rh(),nc=C(),BU=C(),kie=C(),zie=C(),Bie=C();class _nt{constructor(t){this._objects=t}submit(t,r){this._objects.preSubmit(r),this._objects.visibleObjects.forAll(i=>i.renderable.material.submit(t,r,i))}queryShadowCasterDepthRange(t){return this._objects.visibleObjects.length?dnt(t,this._objects.visibleObjects):null}}function vnt(e){const t=Li().vec3f(E.POSITION);return e.normals&&t.vec2i16(E.NORMALCOMPRESSED,{glNormalized:!0}),e.textureCoordinates===ws.Default?t.vec2f(E.UV0):e.textureCoordinates===ws.Atlas&&(t.vec2f(E.UV0),t.vec4u16(E.UVREGION,{glNormalized:!0})),e.colors&&t.vec4u8(E.COLOR,{glNormalized:!0}),t}class bnt{constructor(){this.externalColor=Ht(),this.externalColorMixMode=Xs.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}}class wnt extends es{constructor(t,r){super(t,"int",jr.Draw,(i,s,n)=>i.setUniform1i(t,r(s,n)))}}var Hp;(function(e){e[e.Uniform=0]="Uniform",e[e.Varying=1]="Varying",e[e.COUNT=2]="COUNT"})(Hp||(Hp={}));const VW=429496.7296;function M1e(e,t){XA(e/VW*.5+.5,t)}function xnt(e,t){switch(t.componentData){case Hp.Varying:return Tnt(e,t);case Hp.Uniform:return Snt(e);case Hp.COUNT:return;default:t.componentData}}function Tnt(e,t){const{vertex:r,fragment:i}=e;r.include(Hl),r.uniforms.add(new zu("componentColorTex",n=>n.componentParameters.texture.texture)),e.attributes.add(E.COMPONENTINDEX,"float"),e.varyings.add("vExternalColorMixMode","mediump float"),e.varyings.add("vExternalColor","vec4");const s=t.output===D.ObjectAndLayerIdColor;s&&e.varyings.add("vObjectAndLayerIdColor","vec4"),e.include(c_e),r.constants.add("elevationScale","float",2*VW),r.constants.add("stride","float",ne("enable-feature:objectAndLayerId-rendering")?3:2),r.code.add(b`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),r.code.add(b`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${s?b`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:b`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),i.code.add(b`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${s?b`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function Snt(e){const{vertex:t,fragment:r}=e;t.uniforms.add(new hD("externalColor",i=>i.componentParameters.externalColor)),r.uniforms.add(new wnt("externalColorMixMode",i=>i.componentParameters.externalColorMixMode)),e.varyings.add("vExternalColor","vec4"),t.code.add(b`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),r.code.add(b`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}
void outputObjectAndLayerIdColor() {
fragColor = vec4(1.0,0.0,0.0,0.0);
}`)}var Iu;function Ent(e,t){const r=e.vertex;switch(r.code.add(b`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),t.vertexDiscardMode){case Iu.None:r.code.add(b`#define vertexDiscardByOpacity(_opacity_) {}`);break;case Iu.Opaque:r.code.add(b`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Iu.Transparent:r.code.add(b`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"})(Iu||(Iu={}));var Wp;function hgt(e){return e&&af(e)?Wp.Mars:e&&lf(e)?Wp.Moon:Wp.Earth}(function(e){e[e.Earth=1]="Earth",e[e.Mars=2]="Mars",e[e.Moon=3]="Moon",e[e.COUNT=4]="COUNT"})(Wp||(Wp={}));var _c;(function(e){e[e.None=0]="None",e[e.NoOverlay=1]="NoOverlay",e[e.ColorOverlay=2]="ColorOverlay",e[e.ColorOverlayWithWater=3]="ColorOverlayWithWater",e[e.COUNT=4]="COUNT"})(_c||(_c={}));class nr extends Yo{constructor(){super(...arguments),this.output=D.Color,this.textureCoordinateType=ws.None,this.componentData=Hp.Uniform,this.cullFace=oi.Back,this.vertexDiscardMode=Iu.None,this.doubleSidedMode=Gi.WindingOrder,this.alphaDiscardMode=Gr.Opaque,this.integratedMeshMode=_c.None,this.transparencyPassType=tt.NONE,this.ellipsoidMode=Wp.Earth,this.pbrMode=Qe.Disabled,this.normalType=wr.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1}}h([B({count:D.COUNT})],nr.prototype,"output",void 0),h([B({count:ws.COUNT})],nr.prototype,"textureCoordinateType",void 0),h([B({count:Hp.COUNT})],nr.prototype,"componentData",void 0),h([B({count:oi.COUNT})],nr.prototype,"cullFace",void 0),h([B({count:Iu.COUNT})],nr.prototype,"vertexDiscardMode",void 0),h([B({count:Gi.COUNT})],nr.prototype,"doubleSidedMode",void 0),h([B({count:Gr.COUNT})],nr.prototype,"alphaDiscardMode",void 0),h([B({count:_c.COUNT})],nr.prototype,"integratedMeshMode",void 0),h([B({count:tt.COUNT})],nr.prototype,"transparencyPassType",void 0),h([B({count:Wp.COUNT})],nr.prototype,"ellipsoidMode",void 0),h([B({count:Qe.COUNT})],nr.prototype,"pbrMode",void 0),h([B({count:wr.COUNT})],nr.prototype,"normalType",void 0),h([B()],nr.prototype,"spherical",void 0),h([B()],nr.prototype,"doublePrecisionRequiresObfuscation",void 0),h([B()],nr.prototype,"hasVertexColors",void 0),h([B()],nr.prototype,"hasNormals",void 0),h([B()],nr.prototype,"hasSlicePlane",void 0),h([B()],nr.prototype,"hasBaseColorTexture",void 0),h([B()],nr.prototype,"receiveAmbientOcclusion",void 0),h([B()],nr.prototype,"receiveShadows",void 0),h([B()],nr.prototype,"blendingEnabled",void 0),h([B()],nr.prototype,"hasScreenSpaceReflections",void 0),h([B()],nr.prototype,"hasPolygonOffset",void 0),h([B()],nr.prototype,"hasMetallicRoughnessTexture",void 0),h([B()],nr.prototype,"hasEmissionTexture",void 0),h([B()],nr.prototype,"hasOcclusionTexture",void 0),h([B()],nr.prototype,"hasNormalTexture",void 0),h([B()],nr.prototype,"hasOccludees",void 0),h([B()],nr.prototype,"hasMultipassTerrain",void 0),h([B()],nr.prototype,"cullAboveGround",void 0),h([B()],nr.prototype,"hasCloudsReflections",void 0),h([B()],nr.prototype,"snowCover",void 0),h([B()],nr.prototype,"objectAndLayerIdColor",void 0),h([B({constValue:jr.Draw})],nr.prototype,"pbrTextureBindType",void 0),h([B({constValue:!0})],nr.prototype,"hasSliceHighlight",void 0),h([B({constValue:!1})],nr.prototype,"hasSliceInVertexProgram",void 0),h([B({constValue:!1})],nr.prototype,"useCustomDTRExponentForWater",void 0),h([B({constValue:!1})],nr.prototype,"hasVertexTangents",void 0),h([B({constValue:!0})],nr.prototype,"supportsTextureAtlas",void 0),h([B({constValue:!1})],nr.prototype,"highStepCount",void 0),h([B({constValue:!1})],nr.prototype,"instancedDoublePrecision",void 0),h([B({constValue:!0})],nr.prototype,"useFillLights",void 0),h([B({constValue:!1})],nr.prototype,"objectAndLayerIdColorInstanced",void 0);function Vie(e,t){e.include(ub,t),e.fragment.include(t3);const r=e.fragment;r.uniforms.add(new hD("baseColor",i=>i.baseColor)),r.uniforms.add(new Zv("objectOpacity",i=>i.objectOpacity)),t.hasVertexColors?r.code.add(b`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):r.code.add(b`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),r.code.add(b`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function Gie(e,t){const r=e.fragment;switch(t.doubleSidedMode){case Gi.None:r.code.add(b`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case Gi.View:e.include($x,t),r.code.add(b`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case Gi.WindingOrder:r.code.add(b`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:t.doubleSidedMode;case Gi.COUNT:}switch(t.normalType){case wr.Attribute:case wr.Compressed:e.include(C4,t),r.code.add(b`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case wr.ScreenDerivative:e.include($x,t),r.code.add(b`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case wr.Ground:t.spherical?(e.include($x,t),r.code.add(b`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):r.code.add(b`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),r.code.add(b`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:t.normalType;case wr.COUNT:}}function Cnt(e,t){const r=e.fragment;if(t.hasBaseColorTexture&&(t.output===D.Color||t.alphaDiscardMode!==Gr.Opaque)){e.include(dj,t);const i=t.textureCoordinateType===ws.Atlas;r.uniforms.add(new zu("baseColorTexture",s=>s.texture)),i?(e.include(cfe),r.code.add(b`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):r.code.add(b`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`)}else r.code.add(b`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function Ant(e){const t=new pr;t.include($x,e),t.include(C4,e),t.include(ub,e),t.include(zp,e),t.include(w2,e),t.include(xnt,e),t.include(zWe,e),t.include(cVe,e),t.include(Cnt,e),t.include(Ent,e);const{vertex:r,fragment:i}=t;e.pbrMode!==Qe.Normal&&e.pbrMode!==Qe.Schematic||(t.include(fj,e),e.hasNormalTexture&&t.include(p_e,e));const s=e.output===D.Shadow||e.output===D.ShadowHighlight||e.output===D.ShadowExcludeHighlight;s&&e.componentData===Hp.Varying?r.code.add(b`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):r.code.add(b`#define discardShadows(castShadows) {}`);const n=e.integratedMeshMode===_c.ColorOverlay||e.integratedMeshMode===_c.ColorOverlayWithWater,o=n&&e.output===D.Color&&e.pbrMode===Qe.WaterOnIntegratedMesh;return n&&(t.include(B1,e),t.include(jrt,e),e.spherical?r.code.add(b`
      const float invEllipsoidRadius = ${b.float(1/(e.ellipsoidMode===Wp.Earth?Kt.radius:e.ellipsoidMode===Wp.Mars?Np.radius:Mm.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):r.code.add(b`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),t.varyings.add("groundNormal","vec3")),r.code.add(b`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${e.output===D.ObjectAndLayerIdColor?b`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${b.float(to)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${e.output===D.ObjectAndLayerIdColor?b`forwardObjectAndLayerIdColor();`:""}
      ${o?e.spherical?b`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:b`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${n?b`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),e.output===D.Alpha&&(i.include(Uc),t.include(kc,e),t.include(Vie,e),n&&i.uniforms.add(new qe("ovColorTex",(a,l)=>MB(a,l))),i.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?b`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?b`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        fragColor = vec4(materialColor.a);
      }
    `)),e.output===D.Color&&(i.include(Uc),t.include(kc,e),t.include(Vie,e),t.include(Gie,e),t.include(B1,e),e.receiveShadows?(t.include(A4,e),i.code.add(b`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):i.code.add(b`float evaluateShadow() { return 0.0; }`),n&&i.uniforms.add(new qe("ovColorTex",(a,l)=>MB(a,l))),i.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?b`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?b`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),e.pbrMode===Qe.Normal||e.pbrMode===Qe.Schematic?(hf(i),i.code.add(b`
        ${e.pbrMode===Qe.Normal?b`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),e.hasNormalTexture?i.code.add(b`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):i.code.add(b`vec3 shadingNormal = normalVertex;`),i.code.add(b`${e.spherical?b`vec3 normalGround = normalize(positionWorld());`:b`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),i.code.add(b`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${e.snowCover?b`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${n?b` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(e.receiveShadows?i.code.add(b`float shadow = evaluateShadow();`):e.spherical?(M2(i),i.code.add(b`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):i.code.add(b`float shadow = 0.0;`),o&&i.uniforms.add(new qe("ovNormalTex",(a,l)=>GW(l))),e.snowCover&&i.code.add(b`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),i.code.add(b`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${n?b` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?b`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),i.code.add(b`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${e.transparencyPassType===tt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `)),(e.output===D.Depth||s)&&(t.include(jm,e),i.code.add(b`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),e.output===D.Normal&&(t.include(Gie,e),i.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${e.normalType===wr.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),e.output===D.ObjectAndLayerIdColor&&t.fragment.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?b`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),e.output===D.Highlight&&(t.include(ig,e),i.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?b`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),t}function GW(e){return e.overlays.length===0?null:e.overlays[Si.INNER].getValidTexture(Zi.Water)}const Ont=Object.freeze(Object.defineProperty({__proto__:null,build:Ant,getOverlayNormalTexture:GW},Symbol.toStringTag,{value:"Module"}));class u5 extends xr{initializeConfiguration(t,r){r.spherical=t.viewingMode===Ie.Global,r.doublePrecisionRequiresObfuscation=t.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(t){return new vr(t.rctx,u5.shader.get().build(this.configuration),I1e)}_setPipelineState(t){const r=this.configuration,i=r.integratedMeshMode!==_c.None,s=t===tt.NONE,n=t===tt.FrontFace;return Tt({blending:r.output!==D.Color&&r.output!==D.Alpha||!r.blendingEnabled?null:s?Pc:sg(t),culling:FN(r.cullFace),depthTest:{func:Uy(t)},depthWrite:s||n?Ka:null,colorWrite:It,stencilWrite:i||r.hasOccludees?ef:null,stencilTest:i?gHe(Za.IntegratedMeshMaskExcluded):r.hasOccludees?ky:null,polygonOffset:s||n?r.hasPolygonOffset?{factor:2,units:2}:null:h4})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}u5.shader=new _r(Ont,()=>ue(()=>import("./ComponentShader.glsl.206aaa73.js"),[]));const I1e=new Map([[E.POSITION,0],[E.NORMAL,1],[E.NORMALCOMPRESSED,1],[E.COLOR,2],[E.UV0,3],[E.UVREGION,4],[E.COMPONENTINDEX,5]]);class Rnt extends Wr{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const t of this._parameterBlocks)this[t]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const t of this._parameterBlocks)if(this[t].dirty)return!0;return!1}}class jW{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}function qi(e={}){return(t,r)=>{const i=t._parameterCount??0;if(t._parameterCount=i+1,e.vectorOps){const s=e.vectorOps;Object.defineProperty(t,r,{get(){return this[i]},set(n){const o=this[i];if(o==null)this[i]=n;else{if(s.equals(o,n))return;s.copy(o,n)}this._setDirty()}})}else Object.defineProperty(t,r,{get(){return this[i]},set(s){this[i]!==s&&(e.dispose&&this[i]&&this[i].dispose(),this[i]=s,this._setDirty())}})}}function jie(){return(e,t)=>{const r=e._parameterCount??0;e._parameterCount=r+1,e._parameterBlocks=e._parameterBlocks||[],e._parameterBlocks.push(r),Object.defineProperty(e,t,{get(){return this[r]},set(i){this[r]!==i&&(this[r]=i,this._setDirty())}})}}class h5{constructor(t){this._low=C(),this._high=C(),t&&this.set(t)}get low(){return this._low}get high(){return this._high}set(t){re(this._low,re(Hie,t));const r=Ln(Hie,t,this._low);re(this._high,r)}get(t){return oe(t,this._low,this._high)}getLowScaled(t){return te(t,this._low,1)}}const Hie=Yi();class An extends Rnt{constructor(t,r){super(),this.toMapSpace=r,this.baseColor=At(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=fa(I4),this.emissiveFactor=Ce(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new $I,this.componentParameters=new ZC,this.textureAlphaCutoff=BL,this.alphaDiscardMode=Gr.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=Wp.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new nr;const i=new h5(t.position),s=f_e(t.rotationScale);nb(s,s),this.transformNormalGlobalFromModel=ude(Qu(s,s)),this.transformWorldFromModelTL=i.low,this.transformWorldFromModelTH=i.high,this.transformWorldFromModelRS=t.rotationScale}dispose(){this._technique=Mi(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture!=null?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return this.metallicRoughnessTexture!=null?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return this.emissionTexture!=null?this.emissionTexture.glTexture:null}get textureOcclusion(){return this.occlusionTexture!=null?this.occlusionTexture.glTexture:null}get textureNormal(){return this.normalTexture!=null?this.normalTexture.glTexture:null}prepareTechnique(t,r,i,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.normals,n.textureCoordinateType=s.textureCoordinates,n.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,n.hasEmissionTexture=this.emissionTexture!=null,n.hasOcclusionTexture=this.occlusionTexture!=null,n.hasNormalTexture=this.normalTexture!=null,n.transparencyPassType=r.identifier===Ml.Material&&i.transparencyPassType!=null?i.transparencyPassType:tt.NONE,n.hasMultipassTerrain=r.identifier===Ml.Material&&i.multipassTerrain!=null&&i.multipassTerrain.enabled,n.cullAboveGround=r.identifier===Ml.Material&&i.multipassTerrain!=null&&i.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?Gi.View:Gi.None,n.hasBaseColorTexture=this.baseColorTexture!=null;const o=this._computeWhichMaterialPass();n.blendingEnabled=o===ca.Transparent||o===ca.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?Mnt(i)?GW(i)?_c.ColorOverlayWithWater:_c.ColorOverlay:_c.NoOverlay:_c.None,n.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&this.baseColorTexture==null;if(n.pbrMode=n.integratedMeshMode===_c.ColorOverlayWithWater?Qe.WaterOnIntegratedMesh:this.usePBR?a?Qe.Schematic:Qe.Normal:Qe.Disabled,n.normalType=n.integratedMeshMode===_c.None?n.hasNormals?wr.Compressed:wr.ScreenDerivative:wr.Ground,n.hasSlicePlane=i.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,r.identifier===Ml.ShadowMap)n.output=D.Shadow,n.vertexDiscardMode=Iu.None;else if(r.identifier===Ml.Highlight)n.output=D.Highlight,n.vertexDiscardMode=Iu.None;else{switch(this._computeWhichMaterialPass()===ca.OpaqueAndTransparent?n.vertexDiscardMode=r.transparent?Iu.Opaque:Iu.Transparent:n.vertexDiscardMode=Iu.None,n.output=r.output,n.receiveAmbientOcclusion=!1,n.receiveShadows=!1,r.output){case D.Color:n.receiveAmbientOcclusion=i.ssaoHelper.active,n.hasOccludees=i.hasOccludees,n.receiveShadows=i.shadowMap.ready,n.hasScreenSpaceReflections=i.ssr.enabled,n.hasCloudsReflections=i.cloudsFade.data!=null;break;case D.Alpha:n.hasOccludees=i.hasOccludees;break;case D.ObjectAndLayerIdColor:n.objectAndLayerIdColor=!0}n.snowCover=this.hasSnowCover(i)}return this._technique=t.releaseAndAcquire(u5,n,this._technique),this._setClean(),this._technique}hasSnowCover(t){return t.weather!=null&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}submit(t,r,i){if(this.objectOpacity===0)return;const s=i.renderable.geometry,n=i.components,o=i.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case ca.Opaque:t.materialOpaque.submitDraw(this,s,a,o);break;case ca.Transparent:t.materialTransparent.submitDraw(this,s,a,o);break;case ca.OpaqueAndTransparent:t.materialOpaque.submitDraw(this,s,a,o),t.materialTransparent.submitDraw(this,s,a,o);break;case ca.IntegratedMesh:t.materialIntegratedMesh.submitDraw(this,s,a,o),Pnt(r)&&t.highlightIntegratedMesh.submitDraw(this,s,a,o)}const u=this.componentParameters.castShadows!==pn.None;u&&t.shadowMap.submitDraw(this,s,a,o),l!=null&&(t.highlight.submitDraw(this,s,l,o),u&&t.highlightShadowMap.submitDraw(this,s,l,o)),u&&c!=null&&t.defaultShadowMap.submitDraw(this,s,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?ca.IntegratedMesh:this.objectOpacity<1?ca.Transparent:this.componentParameters.opaqueOverride===pn.All?ca.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Gr.Blend||this.alphaDiscardMode===Gr.MaskBlend?ca.Transparent:this.componentParameters.transparent===pn.None?ca.Opaque:this.componentParameters.transparent===pn.All?ca.Transparent:ca.OpaqueAndTransparent}}var ca,pn;h([qi({vectorOps:Lne})],An.prototype,"baseColor",void 0),h([qi()],An.prototype,"usePBR",void 0),h([qi()],An.prototype,"hasParametersFromSource",void 0),h([qi({vectorOps:eq})],An.prototype,"mrrFactors",void 0),h([qi({vectorOps:eq})],An.prototype,"emissiveFactor",void 0),h([qi({dispose:!0})],An.prototype,"baseColorTexture",void 0),h([qi({dispose:!0})],An.prototype,"metallicRoughnessTexture",void 0),h([qi({dispose:!0})],An.prototype,"emissionTexture",void 0),h([qi({dispose:!0})],An.prototype,"occlusionTexture",void 0),h([qi({dispose:!0})],An.prototype,"normalTexture",void 0),h([qi()],An.prototype,"objectOpacity",void 0),h([jie()],An.prototype,"commonMaterialParameters",void 0),h([jie()],An.prototype,"componentParameters",void 0),h([qi()],An.prototype,"textureAlphaCutoff",void 0),h([qi()],An.prototype,"alphaDiscardMode",void 0),h([qi()],An.prototype,"isIntegratedMesh",void 0),h([qi()],An.prototype,"polygonOffsetEnabled",void 0),h([qi()],An.prototype,"ellipsoidMode",void 0),h([qi()],An.prototype,"hasOccludees",void 0),function(e){e[e.Opaque=0]="Opaque",e[e.Transparent=1]="Transparent",e[e.OpaqueAndTransparent=2]="OpaqueAndTransparent",e[e.IntegratedMesh=3]="IntegratedMesh"}(ca||(ca={}));class $I extends jW{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=oi.Back,this.hasSlicePlane=!0}}h([qi()],$I.prototype,"doubleSided",void 0),h([qi()],$I.prototype,"cullFace",void 0),h([qi()],$I.prototype,"hasSlicePlane",void 0);class ZC extends jW{constructor(){super(...arguments),this.externalColor=At(1,1,1,1),this.externalColorMixMode=Xs.Multiply,this.castShadows=pn.All}get transparent(){return this.externalColor[3]<1?pn.All:pn.None}get opaqueOverride(){return this.externalColorMixMode===Xs.Replace&&this.externalColor[3]===1?pn.All:pn.None}get visible(){return this.externalColor[3]>0?pn.All:pn.None}get type(){return Hp.Uniform}}h([qi({vectorOps:Lne})],ZC.prototype,"externalColor",void 0),h([qi()],ZC.prototype,"externalColorMixMode",void 0),h([qi()],ZC.prototype,"castShadows",void 0),function(e){e[e.All=0]="All",e[e.Some=1]="Some",e[e.None=2]="None"}(pn||(pn={}));class qE extends jW{constructor(){super(...arguments),this.texture=null,this.transparent=pn.None,this.opaqueOverride=pn.None,this.castShadows=pn.None}get type(){return Hp.Varying}}function Pnt(e){return e.overlays.length!==0&&e.overlays[Si.INNER].getValidTexture(Zi.Highlight)!=null}function Mnt(e){return e.overlays.length!==0&&e.overlays[Si.INNER].getColorTextureNoRasterImage()!=null}h([qi()],qE.prototype,"texture",void 0),h([qi()],qE.prototype,"transparent",void 0),h([qi()],qE.prototype,"opaqueOverride",void 0),h([qi()],qE.prototype,"castShadows",void 0);const gD=Li().vec3f(E.POSITION).u16(E.COMPONENTINDEX).u16(E.U16PADDING),$1e=Li().vec2u8(E.SIDENESS),Int=Wl($1e),L1e=Li().vec3f(E.POSITION0).vec3f(E.POSITION1).u16(E.COMPONENTINDEX).u8(E.VARIANTOFFSET,{glNormalized:!0}).u8(E.VARIANTSTROKE).u8(E.VARIANTEXTENSION,{glNormalized:!0}).u8(E.U8PADDING,{glPadding:!0}).u16(E.U16PADDING,{glPadding:!0}),HB=L1e.clone().vec3f(E.NORMAL),WB=L1e.clone().vec3f(E.NORMALA).vec3f(E.NORMALB),D1e=new Map([[E.POSITION0,0],[E.POSITION1,1],[E.COMPONENTINDEX,2],[E.VARIANTOFFSET,3],[E.VARIANTSTROKE,4],[E.VARIANTEXTENSION,5],[E.NORMAL,6],[E.NORMALA,6],[E.NORMALB,7],[E.SIDENESS,8]]);function Wie(e,t,r){const i=t/3,s=new Uint32Array(r+1),n=new Uint32Array(r+1),o=(w,T)=>{w<T?s[w+1]++:n[T+1]++};for(let w=0;w<i;w++){const T=e[3*w],x=e[3*w+1],S=e[3*w+2];o(T,x),o(x,S),o(S,T)}let a=0,l=0;for(let w=0;w<r;w++){const T=s[w+1],x=n[w+1];s[w+1]=a,n[w+1]=l,a+=T,l+=x}const c=new Uint32Array(6*i),u=s[r],d=(w,T,x)=>{if(w<T){const S=s[w+1]++;c[2*S]=T,c[2*S+1]=x}else{const S=n[T+1]++;c[2*u+2*S]=w,c[2*u+2*S+1]=x}};for(let w=0;w<i;w++){const T=e[3*w],x=e[3*w+1],S=e[3*w+2];d(T,x,w),d(x,S,w),d(S,T,w)}const p=(w,T)=>{const x=2*w,S=T-w;for(let O=1;O<S;O++){const A=c[x+2*O],$=c[x+2*O+1];let P=O-1;for(;P>=0&&c[x+2*P]>A;P--)c[x+2*P+2]=c[x+2*P],c[x+2*P+3]=c[x+2*P+1];c[x+2*P+2]=A,c[x+2*P+3]=$}};for(let w=0;w<r;w++)p(s[w],s[w+1]),p(u+n[w],u+n[w+1]);const g=new Int32Array(3*i),y=(w,T)=>w===e[3*T]?0:w===e[3*T+1]?1:w===e[3*T+2]?2:-1,_=(w,T)=>{const x=y(w,T);g[3*T+x]=-1},v=(w,T,x,S)=>{const O=y(w,T);g[3*T+O]=S;const A=y(x,S);g[3*S+A]=T};for(let w=0;w<r;w++){let T=s[w];const x=s[w+1];let S=n[w];const O=n[w+1];for(;T<x&&S<O;){const A=c[2*T],$=c[2*u+2*S];A===$?(v(w,c[2*T+1],$,c[2*u+2*S+1]),T++,S++):A<$?(_(w,c[2*T+1]),T++):(_($,c[2*u+2*S+1]),S++)}for(;T<x;)_(w,c[2*T+1]),T++;for(;S<O;)_(c[2*u+2*S],c[2*u+2*S+1]),S++}return g}class N1e{updateSettings(t){this.settings=t,this._edgeHashFunction=t.reducedPrecision?Lnt:$nt}write(t,r,i){const s=this._edgeHashFunction(i);JP.seed=s;const n=JP.getIntRange(0,255),o=JP.getIntRange(0,this.settings.variants-1),a=.7,l=JP.getFloat(),c=255*(.5*Dnt(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);t.position0.setVec(r,i.position0),t.position1.setVec(r,i.position1),t.componentIndex.set(r,i.componentIndex),t.variantOffset.set(r,n),t.variantStroke.set(r,o),t.variantExtension.set(r,c)}trim(t,r){return t.slice(0,r)}}const HW=new Float32Array(6),yD=new Uint32Array(HW.buffer),Q0=new Uint32Array(1);function $nt(e){const t=HW;t[0]=e.position0[0],t[1]=e.position0[1],t[2]=e.position0[2],t[3]=e.position1[0],t[4]=e.position1[1],t[5]=e.position1[2],Q0[0]=5381;for(let r=0;r<yD.length;r++)Q0[0]=31*Q0[0]+yD[r];return Q0[0]}function Lnt(e){const t=HW;t[0]=pw(e.position0[0]),t[1]=pw(e.position0[1]),t[2]=pw(e.position0[2]),t[3]=pw(e.position1[0]),t[4]=pw(e.position1[1]),t[5]=pw(e.position1[2]),Q0[0]=5381;for(let r=0;r<yD.length;r++)Q0[0]=31*Q0[0]+yD[r];return Q0[0]}const qie=1e4;function pw(e){return Math.round(e*qie)/qie}function Dnt(e,t){const r=e<0?-1:1;return Math.abs(e)**t*r}class _D{constructor(){this._commonWriter=new N1e}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return HB.createBuffer(t)}write(t,r,i){this._commonWriter.write(t,r,i),oe(YP,i.faceNormal0,i.faceNormal1),pe(YP,YP),t.normal.setVec(r,YP)}trim(t,r){return this._commonWriter.trim(t,r)}}_D.Layout=HB,_D.glLayout=Wl(HB,1);class vD{constructor(){this._commonWriter=new N1e}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return WB.createBuffer(t)}write(t,r,i){this._commonWriter.write(t,r,i),t.normalA.setVec(r,i.faceNormal0),t.normalB.setVec(r,i.faceNormal1)}trim(t,r){return this._commonWriter.trim(t,r)}}vD.Layout=WB,vD.glLayout=Wl(WB,1);const YP=C(),JP=new xu,nv=-1;var bD;function Nnt(e,t,r,i=Vnt){const s=e.vertices.position,n=e.vertices.componentIndex,o=Ot(i.anglePlanar),a=Ot(i.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),u=qB.edge,d=u.position0,p=u.position1,g=u.faceNormal0,y=u.faceNormal1,_=Bnt(e),v=znt(e),w=v.length/4,T=t.allocate(w);let x=0;const S=w,O=r.allocate(S);let A=0,$=0,P=0;const U=vwe(0,w),I=new Float32Array(w);I.forEach((V,J,R)=>{s.getVec(v[4*J],d),s.getVec(v[4*J+1],p),R[J]=ni(d,p)}),U.sort((V,J)=>I[J]-I[V]);const L=new Array,N=new Array;for(let V=0;V<w;V++){const J=U[V],R=I[J],k=v[4*J],z=v[4*J+1],H=v[4*J+2],X=v[4*J+3],Y=X===nv;if(s.getVec(k,d),s.getVec(z,p),Y)se(g,_[3*H],_[3*H+1],_[3*H+2]),re(y,g),u.componentIndex=n.get(k),u.cosAngle=de(g,y);else{if(se(g,_[3*H],_[3*H+1],_[3*H+2]),se(y,_[3*X],_[3*X+1],_[3*X+2]),u.componentIndex=n.get(k),u.cosAngle=de(g,y),Unt(u,c))continue;u.cosAngle<-.9999&&re(y,g)}$+=R,P++,Y||Fnt(u,l)?(t.write(T,x++,u),L.push(R)):knt(u,o)&&(r.write(O,A++,u),N.push(R))}const Z=new Float32Array(L.reverse()),W=new Float32Array(N.reverse());return{regular:{instancesData:t.trim(T,x),lodInfo:{lengths:Z}},silhouette:{instancesData:r.trim(O,A),lodInfo:{lengths:W}},averageEdgeLength:$/P}}function Fnt(e,t){return e.cosAngle<t}function Unt(e,t){return e.cosAngle>t}function knt(e,t){const r=_n(e.cosAngle),i=qB.fwd,s=qB.ortho;return Hm(i,e.position1,e.position0),r*(de(rt(s,e.faceNormal0,e.faceNormal1),i)>0?-1:1)>t}function znt(e){const t=e.faces.length/3,r=e.faces,i=e.neighbors;let s=0;for(let a=0;a<t;a++){const l=i[3*a],c=i[3*a+1],u=i[3*a+2],d=r[3*a],p=r[3*a+1],g=r[3*a+2];s+=l===nv||d<p?1:0,s+=c===nv||p<g?1:0,s+=u===nv||g<d?1:0}const n=new Int32Array(4*s);let o=0;for(let a=0;a<t;a++){const l=i[3*a],c=i[3*a+1],u=i[3*a+2],d=r[3*a],p=r[3*a+1],g=r[3*a+2];(l===nv||d<p)&&(n[o++]=d,n[o++]=p,n[o++]=a,n[o++]=l),(c===nv||p<g)&&(n[o++]=p,n[o++]=g,n[o++]=a,n[o++]=c),(u===nv||g<d)&&(n[o++]=g,n[o++]=d,n[o++]=a,n[o++]=u)}return n}function Bnt(e){const t=e.faces.length/3,r=e.vertices.position,i=e.faces,s=VU.v0,n=VU.v1,o=VU.v2,a=new Float32Array(3*t);for(let l=0;l<t;l++){const c=i[3*l],u=i[3*l+1],d=i[3*l+2];r.getVec(c,s),r.getVec(u,n),r.getVec(d,o),ce(n,n,s),ce(o,o,s),rt(s,n,o),pe(s,s),a[3*l]=s[0],a[3*l+1]=s[1],a[3*l+2]=s[2]}return a}(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH"})(bD||(bD={}));const qB={edge:{position0:C(),position1:C(),faceNormal0:C(),faceNormal1:C(),componentIndex:0,cosAngle:0},ortho:C(),fwd:C()},VU={v0:C(),v1:C(),v2:C()},Vnt={anglePlanar:4,angleSignificantEdge:35};function Gnt(e){const t=jnt(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return Xie.updateSettings(e.writerSettings),Zie.updateSettings(e.writerSettings),Nnt(t,Xie,Zie)}function jnt(e,t,r,i){if(t){const o=Wie(r,i,e.count);return new Hnt(r,i,o,e)}const s=cB(e.buffer,e.stride/4,{originalIndices:r,originalIndicesLength:i}),n=Wie(s.indices,i,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:gD.createView(s.buffer)}}class Hnt{constructor(t,r,i,s){this.faces=t,this.facesLength=r,this.neighbors=i,this.vertices=s}}const Xie=new _D,Zie=new vD,dgt=Li().vec3f(E.POSITION0).vec3f(E.POSITION1),Wnt=Li().vec3f(E.POSITION0).vec3f(E.POSITION1).u16(E.COMPONENTINDEX).u16(E.U16PADDING,{glPadding:!0});class qnt{constructor(t){this._maxCount=t,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(t){this._recycledIndices.push(t)}}class Xnt{constructor(t,r=1){this._rctx=t,this._fieldCount=r,this.textureWidth=4096,this._dirty=!0;const i=new hr;i.samplingMode=xt.NEAREST,i.wrapMode=Ct.CLAMP_TO_EDGE,i.width=this.textureWidth,i.height=1,this._texture=new wt(this._rctx,i),this._data=new zn(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(t,r,i,s,n,o){const a=t*this._fieldCount+r;this._dirty=!0,this._data.set(a,0,i),this._data.set(a,1,s),this._data.set(a,2,n),this._data.set(a,3,o)}setDataElement(t,r,i,s){const n=t*this._fieldCount+r;this._dirty=!0,this._data.set(n,i,s)}getDataElement(t,r,i){const s=t*this._fieldCount+r;return this._dirty=!0,this._data.get(s,i)}resizeToFit(t){const r=(t+1)*this._fieldCount;if(r>this._data.count){const i=Math.ceil(r/this.textureWidth)*this.textureWidth,s=new zn(new ArrayBuffer(4*i));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const t=this._texture.descriptor.width,r=this._texture.descriptor.height;this._data.count>t*r&&this._texture.resize(t,this._data.count/t),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}}const F1e=65536;class Znt{constructor(t,r=1){this.textureBuffer=new Xnt(t,r),this._indexManager=new qnt(F1e)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const t=this._indexManager.acquire();return this.textureBuffer.resizeToFit(t),t}releaseIndex(t){this._indexManager.release(t)}}class U1e{constructor(t,r=1){this._rctx=t,this._fieldCount=r,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(t=>t.activeCount!==0||(t.dispose(),!1))}destroy(){this._buffers.forEach(t=>t.dispose()),this._buffers=[]}getBuffer(t){for(const i of this._buffers)if(i.availableCount>=t)return i;if(t>F1e)return null;const r=new Znt(this._rctx,this._fieldCount);return this._buffers.push(r),r}updateTextures(){for(const t of this._buffers)t.textureBuffer.updateTexture()}}const Yie=K.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class Ynt{constructor(t,r){this._renderManager=t,this._viewingMode=r,this._objects=[new Mt,new Mt],this._renderSubmit=new _nt(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=ne("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new U1e(t.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){Ye(this._objects[Zx.Hidden].length===0&&this._objects[Zx.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy();const t=this._objects.flatMap(r=>r.toArray());for(const r of t)r?.destroy()}createObject(t){const r=new WE;return r.toMapSpace=t.toMapSpace,r.transform=t.transform,r.obb=Nie(t.obb),r.components=new Kst(this._componentBufferManager,Vp(t.geometry.componentOffsets)),r.renderable=this._createRenderable(t,r.components),r.intersectionGeometry=new nnt(t.geometry.positionData,r.components),this._objects[r.visible].push(r),r}destroyObject(t){const r=t;this._objects[r.visible].removeUnordered(r),r.destroy(),this._notifyDirty()}setObjectVisibility(t,r){const i=t;r!==i.visible&&(this._objects[i.visible].removeUnordered(i),this._objects[r].push(i),i.visible=r,this._notifyDirty())}preSubmit(t){const r=t.camera.eye;this.visibleObjects.forAll(i=>i.renderable.meta.cameraDepthSquared=gn(r,i.obb.center))}getMaterial(t){return t.renderable.material}updateMaterial(t,r){const i=t.renderable.material;r(i),i.dirty&&this._notifyDirty()}setAllComponentVisibilities(t,r){const i=t;i.components.visibility.reset(r),i.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(t,r){return t.components.visibility.forEachComponent(r)}getComponentCount(t){const r=t,i=r.components.visibility.componentCount();return{visible:i,invisible:r.components.count-i}}setComponentData(t,r){const i=t,s=i.renderable.material,n=i.components,o=n.materialDataBuffer,a=n.materialDataIndices,l=new bnt,c=o.textureBuffer,u=new Uint8Array(4),d=new Uint32Array(u.buffer);let p=0,g=0,y=0,_=n.verticalOffsets,v=1/0,w=-1/0,T=!1,x=!1,S=0;for(let O=0;O<n.count;O++){r(O,l),p+=+(l.externalColor[3]<1),g+=+(l.externalColorMixMode===Xs.Replace&&l.externalColor[3]===1),y+=+l.castShadows,l_e(l.externalColor,l.externalColorMixMode,u),u[2]=254&u[2]|+l.castShadows,c.setData(a[O],0,u[0],u[1],u[2],u[3]),T||(T=O>0&&S!==d[0]),S=d[0],x||(x=l.elevationOffset!==0),x&&_==null&&(_=new Array(O).fill(0)),_!=null&&(_[O]=l.elevationOffset),v=Math.min(v,l.elevationOffset),w=Math.max(w,l.elevationOffset),M1e(l.elevationOffset,u),c.setData(a[O],1,u[0],u[1],u[2],u[3]);const A=l.objectAndLayerIdColor;A!=null&&c.setData(a[O],2,A[0],A[1],A[2],A[3]),l.pickable!==O1e(n.pickability,O)&&(n.pickability=ent(n.pickability,n.count,O,l.pickable))}n.verticalOffsets=x?_:null,i.offsetObb=x?Zst(i.obb,v,w,this._viewingMode,i.offsetObb!=null?i.offsetObb:Nie(i.obb)):null,T||x||this._hasObjectAndLayerId?(s.componentParameters=new qE,s.componentParameters.castShadows=GU(y,n.count),s.componentParameters.transparent=GU(p,n.count),s.componentParameters.opaqueOverride=GU(g,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new ZC,s.componentParameters.castShadows=l.castShadows?pn.All:pn.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(t,r,i,s=!1){t.intersectionGeometry.getComponentAabb(r,i);const n=t,o=n.components.verticalOffsets;if(s||o==null)return i;const a=o[r];if(this._viewingMode===Ie.Local||a===0)return i[2]+=a,i[5]+=a,i;const l=$8e(a);return l.localOrigin=n.transform.position,l.applyToAabb(i)}getComponentObb(t){return t.obb}getObjectTransform(t){return t.transform}getComponentPositions(t,r,i){return t.intersectionGeometry.getComponentPositions(r,i)}intersect(t,r,i,s,n,o){const a=t;n!=null&&(n.localOrigin=a.transform.position);const l=nb(Jie,a.transform.rotationScale);Ln(KP,r,a.transform.position),Ln(QP,i,a.transform.position),Il(KP,KP,l),Il(QP,QP,l);const c=Qu(Jie,l);return a.intersectionGeometry.intersect(KP,QP,s,c,n,a.components.verticalOffsets,o)}addEdges(t,r,i,s){const n=t,{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets;return r.addComponentObject(t,n.transform,{center:n.obb.center,radius:Xst(n.obb)},a,o,l,i,s)}async extractEdgeInformation(t,r,i){const s=t,n=s.components.visibility;if(n.allInvisible())return{buffer:Wnt.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=gD.createBuffer(a.length/3);dO(c.position.typedBuffer,a,c.position.typedBufferStride,3),dye(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const u=c.count,d=this._computeVisibilityIndices(o,n,l,u);return{origin:Ts(s.transform.position),buffer:await r.extractComponentsEdgeLocations({indices:d,indicesLength:d.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},i)}}_setComponentIndices(t,r,i){let s=0;for(let n=0;n<i.length-1;n++){const o=i[n],a=i[n+1];for(let l=o;l<a;l++){const c=r?r[l]:l;t.set(c,s)}s++}}_computeVisibilityIndices(t,r,i,s){if(t&&r.allVisible())return t;let n=0;r.forEachComponentRange((l,c)=>(n+=i[c]-i[l],!0));const o=md(t)?new Array(n):t?.BYTES_PER_ELEMENT===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return r.forEachComponentRange((l,c)=>{const u=i[l],d=i[c];for(let p=u;p<d;p++)o[a++]=t?t[p]:p;return!0}),o}addComponentHighlight(t,r){const i=t.components;i.highlightCounts==null&&(i.highlightCounts=new Uint32Array(i.count+1)),i.highlightCounts[r]++===0&&(i.highlightsDirty(),this._notifyDirty()),i.highlightCounts[i.count]++}removeComponentHighlight(t,r){const i=t.components;if(i.highlightCounts==null)return void Yie.warn("Removing non-existing highlight.");const s=i.highlightCounts[r],n=i.highlightCounts[i.count];if(s!==0){if(s>1)return i.highlightCounts[r]=s-1,void(i.highlightCounts[i.count]=n-1);i.highlightCounts[r]=0,i.highlightsDirty(),this._notifyDirty(),n===1?i.highlightCounts=null:i.highlightCounts[i.count]=n-1}else Yie.warn("Removing non-existing highlight.")}clearHighlights(t){const r=t.components;r.highlightCounts!=null&&(r.highlightCounts=null,r.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(t){return t.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[Zx.Visible]}_createRenderable(t,r){const i=this._renderManager.rctx,s=t.geometry,n=s.vertices.layoutParameters,o=rr.createVertex(i,gr.STATIC_DRAW,s.vertices.data),a=Lu(s.indices,_=>rr.createIndex(i,gr.STATIC_DRAW,_)),l=Wl(vnt(n)),c=new Uint16Array(s.vertices.count);for(let _=0;_<r.count;_++){const v=r.offsets[_],w=r.offsets[_+1],T=r.materialDataIndices[_];if(s.indices!=null)for(let x=v;x<w;x++)c[s.indices[x]]=T;else for(let x=v;x<w;x++)c[x]=T}const u=rr.createVertex(i,gr.STATIC_DRAW,c.buffer),d=new An(t.transform,t.toMapSpace),p=new Ju(i,I1e,{data:l,componentIndices:Jnt},{data:o,componentIndices:u},a),g=new cnt(p,bt.TRIANGLES,n,a!=null),y={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteLength+u.byteLength+(a!=null?a.byteLength:0)};return new lnt(d,g,y)}_notifyDirty(){this._renderManager.notifyDirty()}}const Jnt=Wl(Li().u16(E.COMPONENTINDEX));function GU(e,t){return e===t?pn.All:e===0?pn.None:pn.Some}const Jie=Ya(),KP=C(),QP=C();class k1e extends Wr{constructor(){super(...arguments),this.scale=Ne()}}function Knt(e){const t=new pr;t.attributes.add(E.POSITION,"vec2"),t.varyings.add("uv0","vec2"),t.varyings.add("uv1","vec2"),t.vertex.uniforms.add(new yr("scale",i=>i.scale)),t.vertex.code.add(b`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv0 = position * 0.5 + vec2(0.5);
uv1 = (position * 0.5 + vec2(0.5)) * scale;
}`),t.fragment.uniforms.add(new qe("tex",i=>i.texture),new qe("depthTexture",i=>i.depthTexture),new yr("scale",i=>i.scale),new yr("clampUV",i=>Qnt(i)));const r=e.haze;return t.fragment.code.add(b`
    void main() {
      ${r?b`vec4`:b`float`} depthSample = texture(depthTexture, uv0) ${r?"":b`.r`};
      if (depthSample ${r?b`== vec4(0)`:b`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(tex, min(uv1, clampUV));
    }
    `),t}function Qnt(e){if(!e.texture)return Kie;const t=Qt(Kie,e.texture.descriptor.width,e.texture.descriptor.height),r=rj(t,t,e.scale),i=zpe(r,r);return jpe(i,e.scale,i)}const Kie=Ne(),eot=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:k1e,build:Knt},Symbol.toStringTag,{value:"Module"}));class d5 extends xr{initializeProgram(t){return new vr(t.rctx,d5.shader.get().build(this.configuration),dr)}initializePipeline(){return this.configuration.haze?Tt({blending:oo(ve.ONE,ve.ZERO,ve.ONE_MINUS_SRC_COLOR,ve.ONE),depthTest:{func:Hr.ALWAYS},colorWrite:It}):Tt({blending:Vl(ve.SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),depthTest:{func:Hr.ALWAYS},colorWrite:It})}}d5.shader=new _r(eot,()=>ue(()=>import("./AtmosphereCompositing.glsl.b41b8afb.js"),[]));class z1e extends Wr{constructor(){super(...arguments),this.opacity=1}}function tot(e){const t=new pr;return t.include(ih),t.fragment.uniforms.add(new qe("tex",r=>r.texture)),e.hasOpacityFactor&&t.fragment.uniforms.add(new Ae("opacity",r=>r.opacity)),t.fragment.code.add(b`
    void main() {
      fragColor = texture(tex, uv) ${e.hasOpacityFactor?"* opacity":""};
    }`),t}const rot=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:z1e,build:tot},Symbol.toStringTag,{value:"Module"}));var Vo;(function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.PremultipliedAlpha=2]="PremultipliedAlpha",e[e.COUNT=3]="COUNT"})(Vo||(Vo={}));class XB extends Yo{constructor(){super(...arguments),this.alphaMode=Vo.None,this.hasOpacityFactor=!1}}h([B({count:Vo.COUNT})],XB.prototype,"alphaMode",void 0),h([B()],XB.prototype,"hasOpacityFactor",void 0);class p5 extends xr{initializeProgram(t){return new vr(t.rctx,p5.shader.get().build(this.configuration),dr)}initializePipeline(){switch(this.configuration.alphaMode){case Vo.None:return Tt({colorWrite:It});case Vo.Alpha:return Tt({blending:oo(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),colorWrite:It});case Vo.PremultipliedAlpha:case Vo.COUNT:return Tt({blending:Vl(ve.ONE,ve.ONE_MINUS_SRC_ALPHA),colorWrite:It})}}}p5.shader=new _r(rot,()=>ue(()=>import("./Compositing.glsl.5717808e.js"),[]));class B1e extends Wr{}function iot(){const e=new pr;return e.include(ih),e.fragment.uniforms.add(new qe("tex",t=>t.texture)),e.fragment.code.add(b`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`),e}const sot=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:B1e,build:iot},Symbol.toStringTag,{value:"Module"}));class f5 extends xr{initializeProgram(t){return new vr(t.rctx,f5.shader.get().build(),dr)}initializePipeline(){return Tt({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}}f5.shader=new _r(sot,()=>ue(()=>import("./HUDCompositing.glsl.9ff0c67e.js"),[]));class V1e extends Wr{}function not(){const e=new pr;return e.include(ih),e.fragment.uniforms.add(new qe("colorTexture",t=>t.colorTexture),new qe("alphaTexture",t=>t.alphaTexture),new qe("frontFaceTexture",t=>t.frontFaceTexture)),e.fragment.code.add(b`void main() {
vec4 srcColor = texture(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture(alphaTexture, uv).r;
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),e}const oot=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:V1e,build:not},Symbol.toStringTag,{value:"Module"}));class m5 extends xr{initializeProgram(t){return new vr(t.rctx,m5.shader.get().build(),dr)}initializePipeline(){return Tt({blending:oo(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),colorWrite:It})}}m5.shader=new _r(oot,()=>ue(()=>import("./OITCompositing.glsl.1f7edce5.js"),[]));class G1e extends Wr{constructor(){super(...arguments),this.overlayIndex=Si.INNER,this.opacity=1}}function aot(){const e=new pr;return e.include(ih),e.fragment.uniforms.add(new qe("tex",t=>t.texture)),e.fragment.uniforms.add(new oO("overlayIdx",t=>t.overlayIndex)),e.fragment.uniforms.add(new Ae("opacity",t=>t.opacity)),e.fragment.code.add(b`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),e}const lot=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:G1e,build:aot},Symbol.toStringTag,{value:"Module"}));class g5 extends xr{initializeProgram(t){return new vr(t.rctx,g5.shader.get().build(),dr)}initializePipeline(){return Tt({blending:Vl(ve.ONE,ve.ONE_MINUS_SRC_ALPHA),colorWrite:It})}}g5.shader=new _r(lot,()=>ue(()=>import("./OverlayCompositing.glsl.1c26fad6.js"),[]));class cot{constructor(t,r){this._rctx=t,this._techniqueRepository=r,this._configuration=new XB,this._atmosphereConfiguration=new uL,this._passParameters=new z1e,this._atmosphereParameters=new k1e,this._oitParameters=new V1e,this._hudParameters=new B1e,this._overlayParameters=new G1e}destroy(){this._vao=De(this._vao)}compositeOIT(t,r,i,s){this._oitParameters.colorTexture=r,this._oitParameters.alphaTexture=i,this._oitParameters.frontFaceTexture=s;const n=this._rctx,o=this._techniqueRepository.acquire(m5);n.bindTechnique(o,this._oitParameters,t);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(bt.TRIANGLE_STRIP,0,vo(a,"geometry")),o.release()}compositeHUD(t,r){this._hudParameters.texture=r;const i=this._rctx,s=this._techniqueRepository.acquire(f5);i.bindTechnique(s,this._hudParameters,t);const n=this._ensureVAO();i.bindVAO(n),i.drawArrays(bt.TRIANGLE_STRIP,0,vo(n,"geometry")),s.release()}compositeOverlay(t,r,i,s){this._overlayParameters.texture=r,this._overlayParameters.opacity=i,this._overlayParameters.overlayIndex=s;const n=this._rctx,o=this._techniqueRepository.acquire(g5);n.bindTechnique(o,this._overlayParameters,t);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(bt.TRIANGLE_STRIP,0,vo(a,"geometry")),o.release()}compositeAtmosphere(t,r,i,s,n){const o=this._rctx;this._atmosphereParameters.texture=r,this._atmosphereParameters.depthTexture=i,this._atmosphereParameters.scale=s,this._atmosphereConfiguration.haze=n;const a=this._techniqueRepository.acquire(d5,this._atmosphereConfiguration);o.bindTechnique(a,this._atmosphereParameters,t);const l=this._ensureVAO();o.bindVAO(l),o.drawArrays(bt.TRIANGLE_STRIP,0,vo(l,"geometry")),a.release()}composite(t,r,i=Vo.None,s=1){const n=this._rctx;this._configuration.alphaMode=i,this._configuration.hasOpacityFactor=s!==1,this._passParameters.texture=r,this._passParameters.opacity=s;const o=this._techniqueRepository.acquire(p5,this._configuration);n.bindTechnique(o,this._passParameters,t);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(bt.TRIANGLE_STRIP,0,vo(a,"geometry")),o.release()}_ensureVAO(){return this._vao==null&&(this._vao=el(this._rctx)),this._vao}}const uot=1e4,ZB=100,hot=500,dot=500,pot=.1;function fot(e,t,r){return gH(t,e)*(r[1]-r[0])+r[0]}function mot(e,t,r){let i=0;if(!t.some(n=>(i+=n.numGeometries,i>=uot)))return Tot.compute(e,t);const s=pO();return r.forAll(n=>{n.visible&&e2(s,got(e,n))}),s}function got(e,t){if(!t.visible)return;const r=pO(),i=t.getSpatialQueryAccelerator();return i!=null?yot(r,e,i):_ot(r,e,t.objects),r}function yot(e,t,r){const i=t.eye,s=t.viewForward,n=t.frustum,o=l=>l.visible,a=r.objectCount;if(a<hot)h3(bu,t.near,Math.min(e.near,t.far)),r.forEachInDepthRange(i,s,nd.DepthOrder.FRONT_TO_BACK,bu,(l,c)=>{YB(e,t,l),bu.far=e.near,c.setRange(bu)},n,o),h3(bu,Math.max(e.far,t.near),t.far),r.forEachInDepthRange(i,s,nd.DepthOrder.BACK_TO_FRONT,bu,(l,c)=>{YB(e,t,l),bu.near=e.far,c.setRange(bu)},n,o);else{const l=Math.max(Math.min(a,dot),Math.ceil(a*pot)),c=r.findClosest(s,nd.DepthOrder.FRONT_TO_BACK,n,o,l),u=r.findClosest(s,nd.DepthOrder.BACK_TO_FRONT,n,o,l);c&&u&&(Qie(e,t,c.boundingVolumeWorldSpace.bounds),Qie(e,t,u.boundingVolumeWorldSpace.bounds))}}function _ot(e,t,r){fw.clear(),r.forAll(i=>{i.visible&&i.geometries.length!==0&&fw.add(i)}),fw.empty||(fw.sort(t),h3(bu,t.near,Math.min(e.near,t.far)),fw.forEachInDepthRange(bu,nd.DepthOrder.FRONT_TO_BACK,(i,s)=>{s<e.near&&YB(e,t,i)}),h3(bu,Math.max(e.far,t.near),t.far),fw.forEachInDepthRange(bu,nd.DepthOrder.BACK_TO_FRONT,(i,s,n)=>{e.far=Math.max(e.far,n)}))}function YB(e,t,r){if(!r.visible||!Z0(t.frustum,r.boundingVolumeWorldSpace.bounds))return;const i=r.transformation,s=xot;r.geometries.forEach(n=>{Jr(s,i,n.shaderTransformation);const o=_T(s);j1e(e,t,n.boundingInfo,s,o)})}function j1e(e,t,r,i,s){if(r==null)return;Ue(pa,r.center,i);const{eye:n,viewForward:o}=t,a=o[0]*(pa[0]-n[0])+o[1]*(pa[1]-n[1])+o[2]*(pa[2]-n[2]);if(pa[3]=r.radius*s,!(a-pa[3]>e.near&&a+pa[3]<e.far)&&Z0(t.frustum,pa))if(r.radius>ZB&&r.getChildren())for(const l of r.getChildren())j1e(e,t,l,i,s);else JB.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,i,r.bbMin,r.bbMax)}function Qie(e,t,r){const i=t.eye,s=t.viewForward,n=(r[0]-i[0])*s[0]+(r[1]-i[1])*s[1]+(r[2]-i[2])*s[2];e.near=Math.min(e.near,n-r[3]),e.far=Math.max(e.far,n+r[3])}class vot{constructor(){this._items=new Mt({allocator:t=>t||{obj:null,distance:0,near:0,far:0},deallocator:t=>(t.obj=null,t.distance=0,t.near=0,t.far=0,t)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(t){this._items.pushNew().obj=t}sort(t){const r=t.eye,i=t.viewForward;this._items.forAll(s=>{const n=s.obj.boundingVolumeWorldSpace.bounds,o=(n[0]-r[0])*i[0]+(n[1]-r[1])*i[1]+(n[2]-r[2])*i[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(t,r,i){if(r===nd.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<t.near||n.near>t.far||i(n.obj,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<t.near||n.near>t.far||i(n.obj,n.near,n.far)}}}class bot{constructor(){this._view=be(),this._viewProj=be(),this._frustum=OA(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(t,r){this._reset(),Ss(this._view,t.viewMatrix),Jr(this._viewProj,t.projectionMatrix,this._view),fL(this._frustum,t.frustum);const i=this._view,s=i[2],n=i[6],o=i[10],a=i[14];r.forAll(p=>p.forEachGeometry(g=>{if(!g.visible||!g.castShadow)return;const y=g.boundingSphere,_=s*y[0]+n*y[1]+o*y[2]+a,v=_-y[3],w=_+y[3];this._geometries.push(g),this._near.push(-w),this._far.push(-v)}));const l=new unt;if(this._geometries.length===0)return l;for(let p=0;p<this._geometries.length;++p)this._near[p]>l.far&&(l.far=this._near[p]),this._near[p]>2&&this._far[p]<l.near&&(l.near=this._far[p]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let u=0,d=0;for(let p=0;p<this._geometries.length;++p)this._near[p]<l.near&&(this._near[p]>=c.near?l.near=this._near[p]:this._nearCandidates[u++]=p),this._far[p]>l.far&&(this._far[p]<=c.far?l.far=this._far[p]:this._farCandidates[d++]=p);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((p,g)=>this._near[p]<this._near[g]?-1:this._near[p]>this._near[g]?1:0),this._farCandidates.sort((p,g)=>this._far[p]<this._far[g]?1:this._far[p]>this._far[g]?-1:0);for(let p=0;p<this._nearCandidates.length;++p){const g=this._nearCandidates[p];if(this._near[g]<l.near){const y=this._geometries[g],_=y.boundingInfo;this._includeNearBoundingInfoRec(_,y.shaderTransformation,l)}}for(let p=0;p<this._farCandidates.length;++p){const g=this._farCandidates[p];if(this._far[g]>l.far){const y=this._geometries[g],_=y.boundingInfo;this._includeFarBoundingInfoRec(_,y.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(t,r,i){if(t==null)return;const s=t.center;Ue(pa,s,r);const n=_T(r),o=pa[0],a=pa[1],l=pa[2],c=t.radius*n,u=this._frustum;if(u[0][0]*o+u[0][1]*a+u[0][2]*l+u[0][3]>c||u[1][0]*o+u[1][1]*a+u[1][2]*l+u[1][3]>c||u[2][0]*o+u[2][1]*a+u[2][2]*l+u[2][3]>c||u[3][0]*o+u[3][1]*a+u[3][2]*l+u[3][3]>c)return;const d=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],p=d+c;if(!(-(d-c)<2||-p>=i.near))if(-p>this._looseRange.near)i.near=-p;else{if(c>ZB){const g=t.getChildren();if(g!==void 0){for(const y of g)this._includeNearBoundingInfoRec(y,r,i);return}}JB.unionDepthRangeWithAABB(i,this._viewProj,r,t.bbMin,t.bbMax)}}_includeFarBoundingInfoRec(t,r,i){if(t==null)return;let s=t.radius;const n=t.center;Ue(pa,n,r);const o=_T(r),a=pa[0],l=pa[1],c=pa[2];s*=o;const u=this._frustum;if(u[0][0]*a+u[0][1]*l+u[0][2]*c+u[0][3]>s||u[1][0]*a+u[1][1]*l+u[1][2]*c+u[1][3]>s||u[2][0]*a+u[2][1]*l+u[2][2]*c+u[2][3]>s||u[3][0]*a+u[3][1]*l+u[3][2]*c+u[3][3]>s)return;const d=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-s;if(!(-d<=i.far))if(-d<this._looseRange.far)i.far=-d;else{if(s>ZB){const p=t.getChildren();if(p!==void 0){for(const g of p)this._includeFarBoundingInfoRec(g,r,i);return}}JB.unionDepthRangeWithAABB(i,this._viewProj,r,t.bbMin,t.bbMax)}}}class wot{constructor(){this._modelViewProj=be(),this._clipPosition=[Ht(),Ht(),Ht(),Ht(),Ht(),Ht(),Ht(),Ht()]}unionDepthRangeWithAABB(t,r,i,s,n){const o=this._modelViewProj;Jr(o,r,i);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],u=l===0||l===3||l===4||l===7?s[0]:n[0],d=l===0||l===1||l===4||l===5?s[1]:n[1],p=l<4?s[2]:n[2];c[0]=o[0]*u+o[4]*d+o[8]*p+o[12],c[1]=o[1]*u+o[5]*d+o[9]*p+o[13],c[2]=o[2]*u+o[6]*d+o[10]*p+o[14],c[3]=o[3]*u+o[7]*d+o[11]*p+o[15]}for(let l=0;l<12;++l){const c=this._clipPosition[jU[l][0]],u=this._clipPosition[jU[l][1]],d=this._clipPosition[jU[l][2]],p=this._clipTriangle(c,u,d);let g=!0;for(let y=0;y<p.length;++y)if(p[y][3]>=2){g=!1;break}if(!g){a=!0;for(let y=0;y<p.length;++y){const _=p[y][3];Number.isFinite(_)&&(t.near=Math.min(_,t.near),t.far=Math.max(_,t.far))}}}return a}_inside(t,r){return r===0?t[0]>=-t[3]:r===1?t[1]>=-t[3]:r===2?t[0]<=t[3]:r===3?t[1]<=t[3]:void Ye(!1)}_intersect(t,r,i){let s=0;return i===0?s=(-t[3]-t[0])/(r[0]-t[0]+r[3]-t[3]):i===1?s=(-t[3]-t[1])/(r[1]-t[1]+r[3]-t[3]):i===2?s=(t[3]-t[0])/(r[0]-t[0]-r[3]+t[3]):i===3&&(s=(t[3]-t[1])/(r[1]-t[1]-r[3]+t[3])),IV(Ht(),t,r,s)}_clipTriangle(t,r,i){let s=[t,r,i];for(let n=0;n<4;++n){const o=s;s=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,n)?(this._inside(l,n)||s.push(this._intersect(l,c,n)),s.push(c)):this._inside(l,n)&&s.push(this._intersect(l,c,n))}}return s}}const jU=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],pa=ls(),xot=be(),bu=pO(),fw=new vot,Tot=new bot,JB=new wot;class Sot{}class Eot extends Wr{constructor(){super(...arguments),this.textures=new Sot}}function Cot(){const e=new pr;return e.attributes.add(E.POSITION,"vec2"),e.vertex.uniforms.add(new Zt("drawPosition",(t,r)=>Aot(t,r))),e.varyings.add("vUV","vec2"),e.vertex.code.add(b`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),e.fragment.uniforms.add(new qe("textureInput",t=>t.textures.input)),e.fragment.uniforms.add(new qe("textureMask",t=>t.textures.mask)),e.fragment.uniforms.add(new qe("textureOverlay",t=>t.textures.overlay)),e.fragment.uniforms.add(new Bp("maskEnabled",t=>t.magnifier.maskEnabled)),e.fragment.uniforms.add(new Bp("overlayEnabled",t=>t.magnifier.overlayEnabled)),e.fragment.code.add(b`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),e}function Aot(e,t){const r=t.camera.pixelRatio,i=e.magnifier.offset.x*r,s=e.magnifier.offset.y*r;Sp(e.magnifier.position,ese);const n=t.camera.screenToRender(ese,Oot),o=Math.ceil(r*e.magnifier.size),a=t.camera.fullWidth,l=t.camera.fullHeight;return pi(Rot,(n[0]+i)/a*2-1,(n[1]-s)/l*2-1,o/a*2,o/l*2)}const ese=zi(),Oot=Due(),Rot=Ht();async function Pot(e){const t=ue(()=>import("./mask-svg.0f2388f0.js"),[]),r=ue(()=>import("./overlay-svg.d3b68a97.js"),[]),i=Vm((await t).default,{signal:e}),s=Vm((await r).default,{signal:e}),n={mask:await i,overlay:await s};return Jt(e),n}let Hw=class extends xe{constructor(){super(...arguments),this._handles=new gi,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new Eot,this.events=new cs,this.attributeLocations=new Map([[E.POSITION,0]]),this._tmpScreenPoint=zi(),this._tmpRenderPoint=Due()}get updating(){return this._imageSources==null&&this._imageLoadTask!=null&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const t=()=>{this._updateResourceLoading(),this.events.emit("request-render")};this._magnifier!=null&&this._handles.add(le(()=>Lu(this._magnifier,r=>r.version),t)),t()}get enabled(){return this._validMagnifier!=null}get _validMagnifier(){return this._magnifier!=null&&this._magnifier.visible&&this._magnifier.position!=null&&this._magnifier.size>0?this._magnifier:null}get _factor(){return this._magnifier!=null&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._handles.destroy(),this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,t){const r=this._validMagnifier;if(r==null)return;const i=t.camera.pixelRatio,s=Math.ceil(i*r.size);if(this._updateResources(e,s),this._resources==null)return;const n=this._passParameters.textures,o=Math.ceil(1/this._factor*s);n.input.resize(o,o),Sp(r.position,this._tmpScreenPoint);const a=t.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),l=t.camera.fullWidth,c=t.camera.fullHeight,u=.5*o,d=.5*o;a[0]=fe(a[0],u,l-u-1),a[1]=fe(a[1],d,c-d-1);const p=Math.floor(a[0]-u),g=Math.floor(a[1]-d),y=this._resources.program;y.bindTexture("textureInput",n.input),e.gl.copyTexImage2D(n.input.descriptor.target,0,n.input.descriptor.pixelFormat,p,g,o,o,0),this._passParameters.magnifier=r,e.useProgram(y),y.bindPass(this._passParameters,t),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(bt.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(e==null)return;const t=e.maskUrl,r=e.overlayUrl;this._imageLoadTask==null||this._imageLoadTask.maskUrl===t&&this._imageLoadTask.overlayUrl===r||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),this._imageSources==null&&this._imageLoadTask==null&&(this._imageLoadTask={maskUrl:t,overlayUrl:r,task:v2(async i=>{const s=t==null||r==null?Pot(i):null,n=t!=null?Vm(t,{signal:i}):s.then(a=>a.mask),o=r!=null?Vm(r,{signal:i}):s.then(a=>a.overlay);this._imageSources={mask:await n,overlay:await o},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,t){if(!this.enabled)return void this._disposeResources();if(this._resources!=null){if(this._passParameters.textures.size!==t){const i=this._createTextureResources(e,t);if(i==null)return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=i}return}const r=this._createTextureResources(e,t);r!=null&&(this._resources={program:this._createProgram(e),vao:el(e,aj,this.attributeLocations,0,1),pipelineState:Tt({blending:Vl(ve.ONE,ve.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:It})},this._passParameters.textures=r)}_disposeResources(){this._resources!=null&&(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,t){if(this._imageSources==null)return null;this._imageSources.overlay.width=t,this._imageSources.overlay.height=t,this._imageSources.mask.width=t,this._imageSources.mask.height=t;const r=new hr;r.internalFormat=vt.RGBA,r.wrapMode=Ct.CLAMP_TO_EDGE,r.flipped=!0,r.preMultiplyAlpha=!Poe(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result;const i=new wt(e,r,this._imageSources.overlay);r.pixelFormat=r.internalFormat=vt.ALPHA,r.preMultiplyAlpha=!1;const s=new wt(e,r,this._imageSources.mask);return r.pixelFormat=r.internalFormat=vt.RGBA,r.flipped=!1,{input:new wt(e,r),mask:s,overlay:i,size:t}}_createProgram(e){return new vr(e,Cot(),this.attributeLocations)}};h([f()],Hw.prototype,"_imageSources",void 0),h([f()],Hw.prototype,"_imageLoadTask",void 0),h([f({readOnly:!0})],Hw.prototype,"updating",null),Hw=h([F("esri/views/3d/webgl-engine/lib/MagnifierHelper")],Hw);class Mot{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new zn(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(t,r,i,s,n,o=null,a=null,l=null){if(!(t&&r&&i&&s)||(this._layerUidToId.set(s,i),this._layerUidToPopupEnabled.set(s,n),!n))return;let c=this._layerUidToGraphicsUidToObjectId.get(s);c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(s,c)),c.set(r,{objectId:t,attributeNodeId:o,attributeIndex:a,subLayerId:l})}getObjectAndLayerIdColor(t){const r=this.getObjectAndLayerIdColorArray(t);return At(r.get(0,1),r.get(0,2),r.get(0,3),255)}getObjectAndLayerIdColorArray(t){if(!t.layerUid||!t.graphicUid)return this.colorZero;const r=this._layerUidToPopupEnabled.get(t.layerUid);if(r===void 0)return K.getLogger(this).warn("popupEnabled is undefined for layerUid "+t.layerUid),this.colorZero;if(r===!1)return this.colorZero;let i=this._uidToRenderColor.get(t.layerUid);i||(i=new Map,this._uidToRenderColor.set(t.layerUid,i));let s=i.get(t.graphicUid);if(!s){for(;!s;){const o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(s=o)}if(s>16777215)throw new Error("Object ID Overflow");i.set(t.graphicUid,s),this._colorToUID.set(s,t)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new zn(n)}getColorToObjectAndLayerIdMapping(){const t=new Map;for(const[r,i]of this._colorToUID.entries()){const s=this._layerUidToGraphicsUidToObjectId.get(i.layerUid);let n=null;s?(n=s.get(i.graphicUid),n||K.getLogger(this).warn("getColorMapping: no entry found for graphicsId "+i.graphicUid)):K.getLogger(this).warn("getColorMapping: no entry found for layerUid "+i.layerUid);const o=this._layerUidToId.get(i.layerUid);o||K.getLogger(this).warn("no layerId found for uid "+i.layerUid),n&&o&&t.set(r,n.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:n.objectId,lid:o,attrId:n.attributeNodeId,attrIdx:n.attributeIndex,subLayerId:n.subLayerId}:{type:"object-and-layer-id",oid:n.objectId,lid:o})}return t}}var d3;(function(e){e[e.FrontToBack=0]="FrontToBack",e[e.BackToFront=1]="BackToFront"})(d3||(d3={}));class Bg{constructor(t,r,i=d3.FrontToBack){this._rctx=t,this._techniqueRepository=r,this._sorting=i,this._draws=new Mt({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(t,r,i,s){const n=this._draws.pushNew();n.geometry=r,n.geometryRanges=i,n.material=t,n.depthSquaredHint=s,n.indexType=(r.indexed?r.vao.indexBuffer.indexType:null)??0}prepare(t,r){return this._draws.map(i=>i.material.prepareTechnique(this._techniqueRepository,t,r,i.geometry.parameters))}dispatch(t,r,i){const s=this._rctx;this._previouslyBoundDraw.clear();let n=null;const o=this._draws.length;for(let a=0;a<o;a++){const l=i[a];l===n&&l.configuration.transparencyPassType===tt.NONE||(s.bindTechnique(l,t,r),n=l);const c=this._draws.data[a],u=c.geometry;s.bindVAO(u.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,r,t),this._previouslyBoundDraw.set(l,c.material));const d=c.geometryRanges,p=d.length;if(c.indexType!==0){const g=LI.get(c.indexType);for(let y=0;y<p;y+=2){const _=d[y],v=d[y+1];s.drawElements(u.primitiveType,v,c.indexType,_*g)}}else for(let g=0;g<p;g+=2){const y=d[g],_=d[g+1];s.drawArrays(u.primitiveType,y,_)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const t=this._sorting===d3.FrontToBack?1:-1;this._draws.sort((r,i)=>{const s=t*(r.depthSquaredHint-i.depthSquaredHint);return s!==0?s:r.geometry.vao.byteSize-i.geometry.vao.byteSize})}get count(){return this._draws.length}}const LI=new Map;LI.set(Ze.UNSIGNED_BYTE,1),LI.set(Ze.UNSIGNED_SHORT,2),LI.set(Ze.UNSIGNED_INT,4);class Iot{constructor(t,r){this.rctx=t,this.shaderTechniqueRepository=r,this.canRender=!0,this._materialPassParameters=new Brt,this._shadowPassParameters=new Vrt,this._highlightPassParameters=new Grt,this._systems=new Set,this._passes={materialOpaque:new Bg(t,r),materialTransparent:new Bg(t,r,d3.BackToFront),materialIntegratedMesh:new Bg(t,r),shadowMap:new Bg(t,r),highlight:new Bg(t,r),highlightIntegratedMesh:new Bg(t,r),highlightShadowMap:new Bg(t,r),defaultShadowMap:new Bg(t,r)}}destroy(){this._context=null,this._systems.clear()}register(t){this._systems.add(t)}prepareRender(t){if(this._systems.size!==0){for(const r of Object.values(this._passes))r.prepareSubmit();this._systems.forEach(r=>r.submit(this._passes,t.bindParameters));for(const r of Object.values(this._passes))r.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}prepareTechniques(t){return this._systems.size===0?null:(this._configure(t),this._materialPassParameters.output=t.output,this._invoke(t,(r,i)=>r.prepare(i,t.bindParameters)))}render(t,r){this._invoke(t,(i,s)=>i.dispatch(s,t.bindParameters,r))}_invoke(t,r){switch(t.bindParameters.slot){case ae.OPAQUE_MATERIAL:switch(t.output){case D.Color:case D.Depth:case D.Normal:case D.ObjectAndLayerIdColor:return r(this._passes.materialOpaque,this._materialPassParameters);case D.Highlight:return r(this._passes.highlight,this._highlightPassParameters);case D.Shadow:return r(this._passes.shadowMap,this._shadowPassParameters);case D.ShadowHighlight:return r(this._passes.highlightShadowMap,this._shadowPassParameters);case D.ShadowExcludeHighlight:return r(this._passes.defaultShadowMap,this._shadowPassParameters)}break;case ae.TRANSPARENT_MATERIAL:switch(t.output){case D.Color:case D.Alpha:case D.Depth:case D.Normal:case D.ObjectAndLayerIdColor:return r(this._passes.materialTransparent,this._materialPassParameters)}break;case ae.INTEGRATED_MESH:switch(t.output){case D.Color:case D.Depth:case D.Normal:case D.ObjectAndLayerIdColor:return r(this._passes.materialIntegratedMesh,this._materialPassParameters);case D.Highlight:return r(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}slots(){return[ae.OPAQUE_MATERIAL,ae.TRANSPARENT_MATERIAL,ae.INTEGRATED_MESH]}initializeRenderContext(t){this._context=t}uninitializeRenderContext(){}queryDepthRange(t){const r={near:1/0,far:-1/0};return this._systems.forEach(i=>{const s=i.queryShadowCasterDepthRange(t);s!=null&&e2(r,s,r)}),r}_configure(t){const r=t.output===D.Shadow||t.output===D.ShadowHighlight||t.output===D.ShadowExcludeHighlight?this._shadowPassParameters:t.output===D.Highlight?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(t,r)}_updateParameters(t,r){const i=t.bindParameters.camera,s=i.viewInverseTransposeMatrix;se(HU,s[3],s[7],s[11]),WU.set(HU),re(r.transformWorldFromViewTH,WU.high),re(r.transformWorldFromViewTL,WU.low),re(r.slicePlaneLocalOrigin,HU),Ku(r.transformViewFromCameraRelativeRS,i.viewMatrix),Ss(r.transformProjFromView,i.projectionMatrix),r.identifier===Ml.Material&&(this._materialPassParameters.transparent=t.bindParameters.slot===ae.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=t.bindParameters.slot===ae.INTEGRATED_MESH,Qu(tse,r.transformViewFromCameraRelativeRS),nb(r.transformNormalViewFromGlobal,tse))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}}const HU=C(),tse=$i(),WU=new h5;class $ot{constructor(){this._step=sse,this._dilation=1,this._firstIdleTime=0}frame(t,r){if(r?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,ne("disable-feature:high-quality-idle"))this._dilation=1;else{const s=r?performance.now()-this._firstIdleTime:0;if(s>=rse+Dot)return this._step=1/0,void(this._dilation=1);this._dilation=s>=rse?Not:1}const i=fe(t/Lot,sse,Uot);this._step===1/0?this._step=i:this._step=this._step*ise+i*(1-ise)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}}const Lot=.5,rse=12e4,Dot=1e4,Not=10,ise=.9,Fot=30,sse=1e3/1,Uot=1e3/Fot,kot=8.6,zot=.4;function Bot(){const e=new pr,{vertex:t,fragment:r}=e,i=t.code,s=r.code;return e.attributes.add(E.POSITION,"vec2"),e.varyings.add("uv","vec2"),e.attributes.add(E.UV0,"vec2"),t.uniforms.add(new qe("coverageTex",n=>n.coverageTexture)),i.add(b`void main() {
vec4 cov = texture(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),r.uniforms.add(new qe("tex",n=>n.blurColorTexture),new qe("origin",n=>n.highlightColorTexture),new Zt("uColor",n=>n.color),new Zt("haloColor",n=>n.haloColor),new Zt("opacities",n=>pi(Vot,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),r.constants.add("outlineSize","float",kot),r.constants.add("blurSize","float",zot),s.add(b`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),e}const Vot=Ht(),Got=Object.freeze(Object.defineProperty({__proto__:null,build:Bot},Symbol.toStringTag,{value:"Module"}));class y5 extends xr{initializeProgram(t){return new vr(t.rctx,y5.shader.get().build(),dr)}initializePipeline(){return Tt({blending:oo(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),colorWrite:It})}}y5.shader=new _r(Got,()=>ue(()=>import("./HighlightApply.glsl.54900f3b.js"),[]));class H1e extends Wr{constructor(){super(...arguments),this.blurSize=Ne()}}function jot(){const e=new pr,{vertex:t,fragment:r}=e,i=t.code,s=r.code;return e.attributes.add(E.POSITION,"vec2"),e.attributes.add(E.UV0,"vec2"),e.varyings.add("blurCoordinate","vec3"),t.uniforms.add(new qe("coverageTex",n=>n.coverageTexture)),r.uniforms.add(new QH("blurSize",n=>n.blurSize)),i.add(b`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),r.uniforms.add(new zu("tex",n=>n.blurInputTexture)),s.add(b`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`),e}const Hot=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:H1e,build:jot},Symbol.toStringTag,{value:"Module"}));class _5 extends xr{initializeProgram(t){return new vr(t.rctx,_5.shader.get().build(),dr)}initializePipeline(){return Tt({colorWrite:It})}}_5.shader=new _r(Hot,()=>ue(()=>import("./HighlightBlur.glsl.a67b52b4.js"),[]));class W1e extends Wr{constructor(){super(...arguments),this.invFramebufferDim=Ne()}}function Wot(){const e=new pr,{vertex:t,fragment:r}=e,i=t.code,s=r.code;return e.attributes.add(E.POSITION,"vec2"),i.add(b`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),r.uniforms.add(new zu("tex",n=>n.inputTexture)),r.uniforms.add(new QH("invFramebufferDim",n=>n.invFramebufferDim)),s.add(b`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture(tex, coord);
float mx = floor(max(value.g, value.b));
fragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),e}const qot=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:W1e,build:Wot},Symbol.toStringTag,{value:"Module"}));class v5 extends xr{initializeProgram(t){return new vr(t.rctx,v5.shader.get().build(),dr)}initializePipeline(){return Tt({colorWrite:It})}}v5.shader=new _r(qot,()=>ue(()=>import("./HighlightDownsample.glsl.1493a0aa.js"),[]));class nse extends Wr{constructor(){super(...arguments),this.color=rf(1,0,1,1),this.haloColor=rf(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=At(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}}const Xot=32;class Zot{constructor(t,r){this._techniqueRep=t,this._rctx=r,this._viewportToRestore=Ht(),this._passParameters=new nse,this._downsampleDrawParameters=new W1e,this._blurDrawParameters=new H1e,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this._quadVAO)return;this._quadVAO=el(this._rctx);const t=new hr;t.wrapMode=Ct.CLAMP_TO_EDGE,this._blur0Fbo=new Bi(this._rctx,t),this._blur1Fbo=new Bi(this._rctx,t),this._blurTechnique=this._techniqueRep.acquire(_5),this._downsampleTechnique=this._techniqueRep.acquire(v5),this._applyTechnique=this._techniqueRep.acquire(y5)}dispose(){if(this._blurTechnique=Mi(this._blurTechnique),this._downsampleTechnique=Mi(this._downsampleTechnique),this._applyTechnique=Mi(this._applyTechnique),this._grid.coverageMipmap)for(let t=1;t<this._grid.coverageMipmap.length;t++)this._grid.coverageMipmap[t].dispose();this._grid.vao&&this._grid.vao.dispose(),this._quadVAO&&(this._quadVAO.dispose(),this._quadVAO=null),this._blur0Fbo=De(this._blur0Fbo),this._blur1Fbo=De(this._blur1Fbo)}setDefaultOptions(t){this._passParameters={...new nse,...t}}render(t,r,i){this._passParameters.highlightColorTexture=r.colorTexture,this._assertResources();const s=t.camera;$u(this._viewportToRestore,s.fullViewport);const n=s.fullWidth,o=s.fullHeight,a=s.pixelRatio,l=Math.ceil(n/a),c=Math.ceil(o/a);this._blur0Fbo.resize(l,c),this._blur1Fbo.resize(l,c);const u=this._rctx;u.bindVAO(this._quadVAO);let d=null;this._gridUpdateResources(r,Xot),this._gridComputeMipmap(t),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,d=this._grid.vao;const p=u.bindTechnique(this._blurTechnique,this._passParameters,t);u.bindVAO(d),u.bindFramebuffer(this._blur0Fbo),u.setViewport(0,0,l,c),u.setClearColor(0,0,0,0),u.clear(fi.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=r.colorTexture,Qt(this._blurDrawParameters.blurSize,1/l,0),p.bindDraw(this._blurDrawParameters,t,this._passParameters),u.drawArrays(this._blurTechnique.primitiveType,0,vo(d,"geometry")),u.bindFramebuffer(this._blur1Fbo),u.clear(fi.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this._blur0Fbo.colorTexture,Qt(this._blurDrawParameters.blurSize,0,1/c),p.bindDraw(this._blurDrawParameters,t,this._passParameters),u.drawArrays(this._blurTechnique.primitiveType,0,vo(d,"geometry")),u.bindFramebuffer(i),u.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]),this._passParameters.blurColorTexture=this._blur1Fbo.colorTexture,u.bindTechnique(this._applyTechnique,this._passParameters,t),u.drawArrays(this._applyTechnique.primitiveType,0,vo(d,"geometry")),u.bindVAO(null)}_gridUpdateResources(t,r){const i=this._rctx,s=this._grid;let n=!1;if(s.coverageMipmap===null&&(s.coverageMipmap=[t],n=!0),s.viewportWidth===t.width&&s.viewportHeight===t.height||(n=!0,s.viewportWidth=t.width,s.viewportHeight=t.height),s.coverageMipmap[0]=t,s.cellPixelSize!==r&&(s.cellPixelSize=r,n=!0),n){for(let l=1;l<s.coverageMipmap.length;l++)s.coverageMipmap[l].dispose();s.mipmapLevels=Math.ceil(Math.log(s.cellPixelSize)*Math.LOG2E),s.coverageMipmap.length=s.mipmapLevels+1;for(let l=0;l<s.mipmapLevels;l++){const c=s.coverageMipmap[l],u=new hr(Math.ceil(c.width/2),Math.ceil(c.height/2));u.pixelFormat=vt.RGB,u.dataType=Is.UNSIGNED_SHORT_5_6_5,u.wrapMode=Ct.CLAMP_TO_EDGE,s.coverageMipmap[l+1]=new Bi(i,u)}}const o=Math.ceil(t.height/s.cellPixelSize),a=Math.ceil(t.width/s.cellPixelSize);if(!s.vao||s.verticalCellCount!==o||s.horizontalCellCount!==a){s.verticalCellCount=o,s.horizontalCellCount=a;const l=o+1,c=a+1,u=1/o,d=1/a,p=6,g=4,y=new Float32Array(p*g*l*c);let _=0;for(let v=0;v<l;v++)for(let w=0;w<c;w++)y[_]=(w-.5)*d*2-1,y[_+1]=(v-.5)*u*2-1,y[_+2]=w*d,y[_+3]=v*u,y[_+4]=(w+.5)*d*2-1,y[_+5]=(v-.5)*u*2-1,y[_+6]=w*d,y[_+7]=v*u,y[_+8]=(w-.5)*d*2-1,y[_+9]=(v+.5)*u*2-1,y[_+10]=w*d,y[_+11]=v*u,y[_+12]=(w-.5)*d*2-1,y[_+13]=(v+.5)*u*2-1,y[_+14]=w*d,y[_+15]=v*u,y[_+16]=(w+.5)*d*2-1,y[_+17]=(v-.5)*u*2-1,y[_+18]=w*d,y[_+19]=v*u,y[_+20]=(w+.5)*d*2-1,y[_+21]=(v+.5)*u*2-1,y[_+22]=w*d,y[_+23]=v*u,_+=p*g;s.vao&&s.vao.dispose(),s.vao=new Ed(i,dr,{geometry:G3},{geometry:rr.createVertex(i,gr.STATIC_DRAW,y)})}}_gridComputeMipmap(t){const r=this._rctx,i=this._grid,s=r.bindTechnique(this._downsampleTechnique,this._passParameters,t);r.bindVAO(this._quadVAO);for(let n=0;n<i.mipmapLevels;n++){r.bindFramebuffer(i.coverageMipmap[n+1]);const o=i.coverageMipmap[n+1].width,a=i.coverageMipmap[n+1].height;this._downsampleDrawParameters.inputTexture=i.coverageMipmap[n].colorTexture,Qt(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),s.bindDraw(this._downsampleDrawParameters,t,this._passParameters),r.setViewport(0,0,o,a),r.drawArrays(bt.TRIANGLE_STRIP,0,vo(this._quadVAO,"geometry"))}}get gpuMemoryUsage(){let t=(this._blur0Fbo!=null?this._blur0Fbo.gpuMemoryUsage:0)+(this._blur1Fbo!=null?this._blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const r of this._grid.coverageMipmap)t+=r.gpuMemoryUsage;return t}get test(){return{coverage:this._grid.coverageMipmap,blur:[this._blur0Fbo,this._blur1Fbo]}}}const Yot={dataType:Is.UNSIGNED_BYTE,internalFormat:vt.RGBA},Jot={};class Kot{constructor(t){this._rctx=t,this._activeTargets=new Set,this._colorTextures=new Map,this._depthTextures=new Map,this._fbos=new Map}dispose(){this._depthTextures.forEach(t=>t.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(t=>t.dispose()),this._colorTextures.clear(),this._fbos.forEach(t=>t.dispose()),this._fbos.clear(),this._activeTargets.clear()}disposeTargetResource(t){const r=t.id;this._activeTargets.has(r)&&(this._activeTargets.delete(r),this._disposeWithFramebuffers(this._depthTextures,r),this._disposeWithFramebuffers(this._colorTextures,r))}_disposeWithFramebuffers(t,r){const i=t.get(r);i&&(this._fbos.forEach((s,n)=>{s.colorTexture!==i&&s.depthStencilAttachment!==i||(s.detachColorTexture(),s.detachDepthStencilTexture(),s.dispose(),this._fbos.delete(n))}),i.dispose(),t.delete(r))}_getDepthTexture(t,r,i){let s=this._depthTextures.get(t.id);if(!s||s.descriptor.width===r&&s.descriptor.height===i||(s.dispose(),s=null),!s){const n=new hr(r,i);n.pixelFormat=vt.DEPTH_STENCIL,n.dataType=Is.UNSIGNED_INT_24_8,n.samplingMode=xt.NEAREST,n.wrapMode=Ct.CLAMP_TO_EDGE,s=new wt(this._rctx,n),this._depthTextures.set(t.id,s),this._activeTargets.add(t.id)}return s}getAllocatedDepthTexture(t){return this._depthTextures.get(t.id)}getColorTexture(t,r,i){let s=this._colorTextures.get(t.id);if(s&&(s.descriptor.width===r&&s.descriptor.height===i||(s.dispose(),s=s2())),!s){const n=new hr(r,i);n.internalFormat=t.internalFormat,n.dataType=t.dataType,n.samplingMode=t.samplingMode!=null?t.samplingMode:xt.LINEAR,n.wrapMode=Ct.CLAMP_TO_EDGE,s=new wt(this._rctx,n),this._colorTextures.set(t.id,s),this._activeTargets.add(t.id)}return s}getAllocatedColorTexture(t){return this._colorTextures.get(t.id)}registerDepthTarget(t={}){return{id:Nl(),...Jot,...t}}registerColorTarget(t={}){return{id:Nl(),...Yot,...t}}getFramebuffer(t,r,i,s){const n=this._getKey(i,s);let o=this._fbos.get(n);const a=this.getColorTexture(i,t,r),l=s?this._getDepthTexture(s,t,r):void 0;return o?((o.width!==t||o.height!==r||o.colorTexture!==a||o.depthStencilAttachment!==l)&&(o.detachColorTexture(),o.detachDepthStencilTexture(),o.resize(t,r),o.attachColorTexture(a),o.attachDepthStencil(l)),o):(o=new Bi(this._rctx,a,l),this._fbos.set(n,o),o)}_getKey(t,r){return`${t.id}_${r?r.id:"X"}_${t.name}${r?"_"+r.name:""}`}get gpuMemoryUsage(){let t=0;const r=new Set,i=s=>{r.has(s)||(r.add(s),t+=s.gpuMemoryUsage)};return this._colorTextures.forEach(i),this._depthTextures.forEach(i),t}}class Qot{constructor(t,r){this._rctx=t,this._compositingHelper=r,this._mainColorTarget=0,this.width=4,this.height=4,this._background={type:"color",color:[0,0,0,1]},this._renderTargetHelper=new Kot(t);const i=this._renderTargetHelper;this._mainColorTargets=[i.registerColorTarget({name:"mainColorTarget0"}),i.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=i.registerColorTarget({name:"frontFaceTarget"}),this.colorFloatTarget=i.registerColorTarget({name:"colorFloatTarget",dataType:Is.HALF_FLOAT,internalFormat:He.RGBA16F,samplingMode:xt.NEAREST}),this.alphaFloatTarget=i.registerColorTarget({name:"alphaFloatTarget",dataType:Is.HALF_FLOAT,internalFormat:He.R16F,samplingMode:xt.NEAREST}),this.mainDepth=i.registerDepthTarget({name:"mainDepth"}),this.linearDepth=i.registerColorTarget({name:"linearDepth",samplingMode:xt.NEAREST}),this.terrainLinearDepth=i.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=i.registerColorTarget({name:"geometryLinearDepth"}),this.normal=i.registerColorTarget({name:"normal"}),this.highlight=i.registerColorTarget({name:"highlight",internalFormat:He.RGBA4,dataType:Is.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=i.registerColorTarget({name:"hudVisibility",internalFormat:He.RGBA4,dataType:Is.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=i.registerColorTarget({name:"tmpColor"}),this.tmpDepth=i.registerDepthTarget({name:"tmpDepth"}),this.hudColor=i.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}set background(t){this._background=t}get background(){return this._background}get currentColorTarget(){return this._mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this._mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(t,r){return this._renderTargetHelper.getFramebuffer(this.width,this.height,t,r)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}setupRenderTarget(t){t?this._mainColorTarget=this._mainColorTarget?0:1:(this._mainColorTarget=0,this.disposeTarget(this._mainColorTargets[1]))}initializeFrame(t){const r=this._rctx;this.width=t.fullWidth,this.height=t.fullHeight,Iv(this,r.parameters.maxTextureSize),this.bindTarget(this.currentColorTarget,this.mainDepth),r.setClearStencil(0);const i=this._background.color;r.setClearColor(i[0]*i[3],i[1]*i[3],i[2]*i[3],i[3]),r.clearSafe(fi.COLOR_BUFFER_BIT|fi.DEPTH_BUFFER_BIT|fi.STENCIL_BUFFER_BIT)}composite(t){this.colorTexture!=null&&this._compositingHelper.composite(t,this.colorTexture,Vo.None)}renderTmpAndCompositeToMain(t,r,i,s=!1){this.renderToTargets(t,this.tmpColor,s?this.tmpDepth:this.mainDepth,eat),this._compositingHelper.composite(r,this._getColorTexture(this.tmpColor),i)}compositeAtmosphereToMain(t,r,i,s){this.bindTarget(this.currentColorTarget),this._compositingHelper.compositeAtmosphere(t,this._renderTargetHelper.getColorTexture(this.tmpColor,this.width,this.height),i,s,r),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderHUDVisibility(t,r=!1){this.renderToTargets(t,this.hudVisibility,r?this.tmpDepth:this.mainDepth,tat)}compositeTransparentTerrainOntoHUDVisibility(t){this.renderToTargets(()=>this._compositingHelper.compositeHUD(t,this._getColorTexture(this.tmpColor)),this.hudVisibility,this.tmpDepth)}renderOITPass(t,r,i){let s,n;switch(r){case tt.Color:s=this.colorFloatTarget,n=[0,0,0,0];break;case tt.Alpha:s=this.alphaFloatTarget,n=[1,1,1,1];break;case tt.FrontFace:s=this.frontFaceTarget,n=[0,0,0,0];break;case tt.NONE:case tt.COUNT:return}i?this.renderToTargets(t,s,this.tmpDepth,n,!0,!0):this.renderToTargets(t,s,this.mainDepth,n,!1)}compositeTransparentTerrainOntoMain(t){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),Vo.PremultipliedAlpha)}compositeOccludedOntoMain(t,r){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),Vo.PremultipliedAlpha,r)}compositeTransparentOntoOpaque(t,r){r?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(fi.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeOIT(t,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(t){this.bindTarget(this.currentColorTarget),t(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(t){this._renderTargetHelper.disposeTargetResource(t)}renderToFBO(t,r,i=!1,s=!1){const n=this._rctx;let o=0;if(r){const l=Math.max(1e-13,r[3]);n.setClearColor(r[0],r[1],r[2],l),o|=fi.COLOR_BUFFER_BIT}i&&(o|=fi.DEPTH_BUFFER_BIT),s===!1?s=0:(s===!0&&(s=255),o|=fi.STENCIL_BUFFER_BIT),o&&n.clearSafe(o,s),t(),n.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderToTargets(t,r,i,s,n=!1,o=!1){const a=this.bindTarget(r,i);return this.renderToFBO(t,s,n,o),a}bindTarget(t,r){const i=this._renderTargetHelper.getFramebuffer(this.width,this.height,t,r);return this._rctx.bindFramebuffer(i),i}_getColorTexture(t){return this._renderTargetHelper.getColorTexture(t,this.width,this.height)}get gpuMemoryUsage(){let t=0;return this._renderTargetHelper&&(t+=this._renderTargetHelper.gpuMemoryUsage),t}}const eat=[0,0,0,0],tat=[0,1,0,1];let XE=class extends xe{constructor(e){super({}),this._context=e,this._renderPlugins=new Mt,this._slots=[];for(let t=0;t<ae.MAX_SLOTS;++t)this._slots[t]=[]}normalizeCtorArgs(){return{}}add(e,t,r){const i=()=>{if(r?.aborted)throw t.uninitializeRenderContext(),Cr();this._renderPlugins.push(t);for(const n of e)this._slots[n].push(t);this._context.requestRender()},s=t.initializeRenderContext(this._context,r);if(zc(s))return s.then(i);i(),this.notifyChange("_renderPlugins")}remove(e){if(this._renderPlugins.removeUnordered(e)!=null){for(let t=0;t<this._slots.length;++t)this._slots[t]=this._slots[t].filter(r=>r!==e);e.uninitializeRenderContext(),this._context.requestRender(),this.notifyChange("_renderPlugins")}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let t=!1;return this._renderPlugins.forAll(r=>{r.updateAnimation&&(t=r.updateAnimation(e)||t)}),t}prepareSlots(e){for(const t of e)this._context.renderContext.bindParameters.slot=t,this._slots[t].filter(r=>{r.canRender&&(ose(r)&&r.prepareTechnique(this._context.renderContext),ase(r)&&r.prepareTechniques(this._context.renderContext))})}render(){const e=this._slots[this._context.renderContext.bindParameters.slot],t=new Array;e.filter(r=>{if(!r.canRender)return!1;if(ose(r)){const i=r.prepareTechnique(this._context.renderContext);return i!=null&&(t.push(i),!0)}if(ase(r)){const i=r.prepareTechniques(this._context.renderContext);return i!=null&&(t.push(i),!0)}return t.push(null),!0}).forEach((r,i)=>r.render(this._context.renderContext,t[i]))}queryDepthRange(e){const t=rat;return t.near=1/0,t.far=-1/0,this._renderPlugins.forAll(r=>{if(r.queryDepthRange){const i=r.queryDepthRange(e);i&&e2(t,i,t)}}),t}get updating(){return this._renderPlugins.some(e=>e.running)}get needsTransparentPass(){return this._renderPlugins.some(e=>e.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(e=>e.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(e=>e.needsLinearDepth)}get needsLaserlineWithContrastControl(){const e=this._slots[ae.LASERLINES_CONTRAST_CONTROL];return!!e&&e.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((e,t)=>e|t.renderOccludedFlags,Ei.None)}};function ose(e){return"prepareTechnique"in e}function ase(e){return"prepareTechniques"in e}h([f()],XE.prototype,"_renderPlugins",void 0),h([f({readOnly:!0})],XE.prototype,"updating",null),XE=h([F("esri.views.3d.webgl-engine.lib.RenderPluginManager")],XE);const rat={near:0,far:0};class q1e extends YH{}const b5=255,iat=1/b5;function sat(e){const t=new pr,r=t.fragment;return r.include(Hl),r.include(Uc),t.include(P4),t.include(ih),t.include(A4,e),r.uniforms.add(new qe("depthMap",i=>i.linearDepthTexture),new Ci("inverseViewMatrix",(i,s)=>Fn(lse,Ja(lse,s.camera.viewMatrix,s.camera.center))),new yr("nearFar",(i,s)=>s.camera.nearFar)),r.constants.add("sampleValue","float",iat),r.code.add(b`void main(void) {
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
fragColor = vec4(sampleValue);
}`),t}const lse=be(),nat=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:q1e,ShadowCastMaxSamples:b5,build:sat},Symbol.toStringTag,{value:"Module"}));var H1;(function(e){e[e.Gradient=0]="Gradient",e[e.Threshold=1]="Threshold",e[e.COUNT=2]="COUNT"})(H1||(H1={}));class KB extends Yo{constructor(){super(...arguments),this.visualization=H1.Gradient,this.bandsEnabled=!1}}h([B({count:H1.COUNT})],KB.prototype,"visualization",void 0),h([B()],KB.prototype,"bandsEnabled",void 0);class X1e extends Wr{constructor(t){super(),this._data=t,this.sampleScale=0,this.opacityFromElevation=1,this.color=z3(oat),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}}const oat=At(.01,0,.25,1);function aat(e){const t=new pr,r=t.fragment;r.include(Hl),r.include(Uc),t.include(P4),t.include(ih);const{visualization:i,bandsEnabled:s}=e;r.constants.add("inverseSampleValue","float",b5),r.uniforms.add(new qe("shadowCastMap",a=>a.shadowCastMap),new Ae("sampleScale",a=>a.sampleScale),new Ae("opacityFromElevation",a=>a.opacityFromElevation),new Zt("uColor",a=>a.color));const n=i===H1.Gradient,o=i===H1.Threshold;return n&&s?r.uniforms.add(new Ae("bandSize",a=>a.bandSize)):o&&r.uniforms.add(new Ae("threshold",a=>a.threshold)),r.code.add(b`
      void main(void) {
        vec4 record = texture(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?b`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${n&&s?b`strength = ceil(strength / bandSize) * bandSize;`:""}

        fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?b`* strength`:""});
      }
    `),t}const lat=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:X1e,build:aat},Symbol.toStringTag,{value:"Module"}));class w5 extends xr{constructor(t,r){super(t,r,()=>this.destroy())}initializeProgram(t){return new vr(t.rctx,w5.shader.get().build(this.configuration),dr)}initializePipeline(){return Tt({blending:Pc,colorWrite:It,depthTest:null,depthWrite:null})}get primitiveType(){return bt.TRIANGLE_STRIP}}w5.shader=new _r(lat,()=>ue(()=>import("./ShadowCastVisualize.glsl.e1167bdd.js"),[]));const cat=4e4,uat=5e4,Z1e=1/512;let DI=class extends xe{constructor(e,t,r,i){super({}),this._techniqueRepository=e,this._rctx=t,this._data=r,this._requestRender=i,this._passParameters=new X1e(this._data),this._techniqueConfig=new KB,this._enabled=!1,this._vao=el(t),this._techniqueConfig.visualization=H1.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=De(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(w5,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const t=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(t,this._passParameters,e),this._rctx.drawArrays(t.primitiveType,0,vo(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>Z1e}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const t=this._passParameters.color;Tx(e,t)||($u(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};h([f()],DI.prototype,"opacityFromElevation",null),DI=h([F("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],DI);class WW extends Yo{constructor(){super(...arguments),this.receiveShadows=!0}}h([B()],WW.prototype,"receiveShadows",void 0);class x5 extends xr{constructor(t){super(t,new WW,()=>this.destroy())}initializeProgram(t){return new vr(t.rctx,x5.shader.get().build(this.configuration),dr)}initializePipeline(){return Tt({blending:oo(ve.ONE,ve.ONE,ve.ONE,ve.ONE),colorWrite:It,depthTest:null,depthWrite:null})}get primitiveType(){return bt.TRIANGLE_STRIP}}x5.shader=new _r(nat,()=>ue(()=>import("./ShadowCastAccumulate.glsl.38b5b98a.js"),[]));let Ua=class extends xe{constructor(e,t,r,i,s,n){super({}),this._rctx=e,this._stage=r,this._prepareForShadowMapPass=i,this._renderToShadowMap=s,this._requestRender=n,this._progress=0,this._sampleCount=0,this._passParameters=new q1e,this._cachedLightDirections=[],this._depthRange=jB,this._previewing=!1,this._handles=new gi,this._cameraForcedForScreenshot=!1,this._bindParameters=new BN(new XH(e,r.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._vao=el(e),this._accumulationRenderer=new DI(t,e,this,n);const o=this._stage.view.resourceController.scheduler;this._handles.add([o.registerTask(at.SHADOW_ACCUMULATOR,this),le(()=>r.renderView,a=>{this._handles.remove(cse),a!=null&&this._handles.add(a.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),cse)},_s),le(()=>this._previewing,()=>this._requestRenderIfEnabled(),Vr)])}normalizeCtorArgs(){return{}}dispose(){this._disable(),this._handles.destroy(),this._accumulationRenderer=De(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=De(this._fbo),this._vao=De(this._vao),this._accumulationTechniqueCached=Mi(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo?.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(this._accumulationTechniqueCached==null){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new x5(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==jB&&this._opacityFromElevation>Z1e}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const t=this._cachedLightDirections;if(Om(t,e,ly))return;const r=Math.min(b5,e.length);t.length=r,this._sampleCount=r;for(let i=0;i<r;++i)t[i]=re(t[i]??C(),e[i]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,t,r,i){if(this._depthRange=t,this._updateCamera(r),this._bindParameters.contentCamera=i,this._passParameters.linearDepthTexture=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(hat,this._sampleCount-this._progress);for(let n=0;n<s;++n)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){const t=this._fbo!=null;e.enabled!==t&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,t){return!this._isActive||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||t<0||t>=this._fbo.height?0:(this._fbo.readPixels(e,t,1,1,vt.RGBA,Is.UNSIGNED_BYTE,use),use[0]/this._progress)}_enable(){this._progress=0;const e=new hr;e.wrapMode=Ct.CLAMP_TO_EDGE,this._fbo=new Bi(this._rctx,e)}_disable(){this._fbo=De(this._fbo)}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(fi.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._sampleLightDirection(),this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,vo(this._vao,"geometry"))}_sampleLightDirection(){return this._progress++,this._lightDirections[this._progress*dat%this._lightDirections.length]}_updateCamera(e){!e.equals(this._bindParameters.camera)&&this._fbo&&(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-QC(cat,uat,e.relativeElevation))}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};h([f()],Ua.prototype,"_progress",void 0),h([f()],Ua.prototype,"_sampleCount",void 0),h([f()],Ua.prototype,"_fbo",void 0),h([f()],Ua.prototype,"_depthRange",void 0),h([f()],Ua.prototype,"_previewing",void 0),h([f()],Ua.prototype,"_accumulationRenderer",void 0),h([f()],Ua.prototype,"_isRefining",null),h([f()],Ua.prototype,"_isActive",null),h([f()],Ua.prototype,"canAccumulate",null),h([f()],Ua.prototype,"_isDoneAccumulating",null),h([f()],Ua.prototype,"_opacityFromElevation",null),h([f()],Ua.prototype,"running",null),Ua=h([F("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],Ua);const hat=6,cse="renderView",dat=104729,use=new Uint8Array(4),hse={highlightedThreshold:.99999,selfShadowThreshold:.025};function pat(e){const t=new pr;t.include(k1,e);const r=t.fragment;return r.include(Hl),r.include(Uc),t.include(P4),t.include(ih),r.uniforms.add(new qe("defaultDepthTex",(i,s)=>s.shadowMap.getSnapshot(ZT.Default)),new qe("highlightDepthTex",(i,s)=>s.shadowMap.getSnapshot(ZT.Highlight)),new qe("depthMap",(i,s)=>s.linearDepthTexture),new qe("highlightMap",(i,s)=>s.highlightColorTexture),new Zt("uColor",i=>i.shadowColor),new yr("nearFar",(i,s)=>s.camera.nearFar),new Ae("opacity",i=>i.shadowOpacity),new Ae("occludedOpacity",i=>i.occludedShadowOpacity),new Ae("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new Rt("lightingMainDirectionView",(i,s)=>pe(pse,Ue(pse,s.lighting.mainLight.direction,s.camera.viewInverseTransposeMatrix))),new yr("texelSize",(i,s)=>s.linearDepthTexture!=null?Qt(fat,1/s.linearDepthTexture.descriptor.width,1/s.linearDepthTexture.descriptor.height):vd),new Ci("inverseViewMatrix",(i,s)=>Fn(dse,Ja(dse,s.camera.viewMatrix,s.camera.center)))),r.constants.add("unoccludedHighlightFlag","vec4",Xge).add("highlightedThreshold","float",hse.highlightedThreshold).add("selfShadowThreshold","float",hse.selfShadowThreshold),r.code.add(b`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),r.code.add(b`void main(void) {
vec4 highlightInfo = texture(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),t}const dse=be(),pse=C(),fat=Ne(),mat=Object.freeze(Object.defineProperty({__proto__:null,build:pat},Symbol.toStringTag,{value:"Module"}));class gat extends YH{constructor(){super(...arguments),this.shadowColor=At(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}}class T5 extends xr{constructor(t){super(t,new WW,()=>this.destroy())}initializeProgram(t){return new vr(t.rctx,T5.shader.get().build(this.configuration),dr)}initializePipeline(){return Tt({blending:oo(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),colorWrite:It,depthTest:null,depthWrite:null})}get primitiveType(){return bt.TRIANGLE_STRIP}}T5.shader=new _r(mat,()=>ue(()=>import("./ShadowHighlight.glsl.a5f43739.js"),[]));const yat=.001953125,_at=4e4,vat=5e4;class bat{constructor(t,r){this._rctx=t,this._viewingMode=r,this._maxOpacity=1,this._passParameters=new gat,this._drawParameters=new WHe,this._vao=el(this._rctx)}get _technique(){return this._techniqueCached==null&&(this._techniqueCached=new T5({rctx:this._rctx,viewingMode:this._viewingMode})),this._techniqueCached}render(t,r){if(!t.shadowMap.enabled||!t.linearDepthTexture||!this.isVisible)return;const i=this._technique;this._drawParameters.origin=t.camera.center,this._rctx.bindFramebuffer(r),this._rctx.bindTechnique(i,this._passParameters,t).bindDraw(this._drawParameters,t,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(i.primitiveType,0,vo(this._vao,"geometry"))}get gpuMemoryUsage(){return this._vao?.memoryEstimate??0}setDefaultOptions(t){this._passParameters={...this._passParameters,...t},this._updateMaxOpacity()}updateParameters(t,r){this._passParameters.opacityElevation=1-QC(_at,vat,t.relativeElevation);const i=this._viewingMode===Ie.Global?pe(fse,t.center):se(fse,0,0,1),s=de(i,r);this._passParameters.dayNightTerminator=QC(0,1,fe(30*s,0,1))}dispose(){this._vao=De(this._vao),this._techniqueCached=Mi(this._techniqueCached)}get isVisible(){const{opacityElevation:t,dayNightTerminator:r}=this._passParameters;return this._maxOpacity*t*r>=yat}_updateMaxOpacity(){const t=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=t*this._passParameters.shadowColor[3]}}const fse=C(),mse=Xm();class wat{constructor(){this._plane=Xm()}get isEnabled(){return!Zde(this.plane,mse)}get plane(){return this._plane}set plane(t){sb(t||mse,this._plane)}}class xat extends Wr{}function p3(e){e.uniforms.add(new Zt("resolution",t=>{const{descriptor:r}=t.colorTexture,i=r.width,s=r.height;return pi(Tat,1/i,1/s,i,s)}))}const Tat=Ht(),mw={maxSearchSteps:8,maxDistanceAreaTex:16};function Sat(){const e=new pr,{attributes:t,varyings:r,vertex:i,fragment:s}=e;return t.add(E.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),r.add("maxOffset","vec4"),r.add("pixelCoord","vec2"),p3(i),i.code.add(b`
      void main() {
        uv = position * 0.5 + vec2(0.5);
        gl_Position = vec4(position, 0, 1);

        pixelCoord = uv * resolution.zw;
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${b.int(mw.maxSearchSteps)} );
      }
    `),s.uniforms.add(new qe("edgesTexture",n=>n.edges.colorTexture)),s.uniforms.add(new qe("areaTexture",n=>n.areaTexture)),s.uniforms.add(new qe("searchTexture",n=>n.searchTexture)),p3(s),s.code.add(b`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset) {
        return texture(tex, coord + offset.x * resolution.xy, 0.0);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.int(mw.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.int(mw.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.int(mw.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.int(mw.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${b.int(mw.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y );
          d.y = coords.x;
          d = d * resolution.z - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w );
          d.y = coords.y;
          d = d * resolution.w - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0)).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        fragColor = weights;
      }
    `),e}const Eat=Object.freeze(Object.defineProperty({__proto__:null,build:Sat},Symbol.toStringTag,{value:"Module"}));class S5 extends xr{initializeProgram(t){return new vr(t.rctx,S5.shader.get().build(),dr)}initializePipeline(){return Tt({colorWrite:It})}}S5.shader=new _r(Eat,()=>ue(()=>import("./BlendWeights.glsl.c32b15b1.js"),[]));function Cat(){const e=new pr,{attributes:t,varyings:r,vertex:i,fragment:s}=e;return t.add(E.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),p3(i),i.code.add(b`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}`),s.uniforms.add(new qe("blendWeightsTexture",n=>n.blend.colorTexture),new qe("colorTexture",n=>n.colorTexture)),p3(s),s.code.add(b`void main() {
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets[1].zw).g;
a.a = texture(blendWeightsTexture, offsets[1].xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`),e}const Aat=Object.freeze(Object.defineProperty({__proto__:null,build:Cat},Symbol.toStringTag,{value:"Module"}));class E5 extends xr{initializeProgram(t){return new vr(t.rctx,E5.shader.get().build(),dr)}initializePipeline(){return Tt({colorWrite:It})}}E5.shader=new _r(Aat,()=>ue(()=>import("./Blur.glsl.d2600c9f.js"),[]));const gse={threshold:.05,localConstrastAdaption:2};function Oat(){const e=new pr,{attributes:t,varyings:r,vertex:i,fragment:s}=e;return t.add(E.POSITION,"vec2"),p3(i),r.add("uv","vec2"),r.add("offsets[3]","vec4"),i.code.add(b`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
offsets[2] = uv.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}`),s.uniforms.add(new qe("colorTexture",n=>n.colorTexture)),s.code.add(b`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${b.float(gse.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges.xy *= step(maxDelta, float(${b.float(gse.localConstrastAdaption)}) * delta.xy);

      fragColor = vec4(edges, 0.0, 0.0);
    }
  `),e}const Rat=Object.freeze(Object.defineProperty({__proto__:null,build:Oat},Symbol.toStringTag,{value:"Module"}));class C5 extends xr{initializeProgram(t){return new vr(t.rctx,C5.shader.get().build(),dr)}initializePipeline(){return Tt({colorWrite:It})}}C5.shader=new _r(Rat,()=>ue(()=>import("./EdgeDetect.glsl.689c4737.js"),[]));let ZE=class extends xe{constructor(e,t){super({}),this._rctx=e,this._techniqueRep=t,this._passParameters=new xat,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=$c(this._abortController),this.disable()}_loadResources(e){if(this._abortController!=null)return!1;if(this._passParameters.searchTexture!=null)return!0;this._abortController=new AbortController;const t=this._abortController.signal;return ue(()=>import("./SmaaRenderPassData.dce7befa.js"),[]).then(r=>this._loadTextures(r,t)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,t){return Jt(t),Promise.all([this._loadTextureFromBase64(e.areaTexture,xt.LINEAR,vt.RGB),this._loadTextureFromBase64(e.searchTexure,xt.NEAREST,vt.LUMINANCE)]).then(([r,i])=>{Hs(t)?(r.dispose(),i.dispose(),Jt(t)):(this._passParameters.areaTexture=r,this._passParameters.searchTexture=i)})}get updating(){return this._abortController!=null}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const i=new Yo;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(C5,i,this._edgeDetectTechnique),this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(S5,i,this._blendWeightsTechnique),this._blurTechnique=this._techniqueRep.releaseAndAcquire(E5,i,this._blurTechnique)}if(!this._loadResources(e))return!1;this._vao=T5e(this._rctx);const t=new hr(4,4);t.pixelFormat=vt.RG,t.internalFormat=He.RG8,t.wrapMode=Ct.CLAMP_TO_EDGE,this._passParameters.edges=new Bi(this._rctx,t);const r=new hr(4,4);return r.pixelFormat=vt.RGBA,r.wrapMode=Ct.CLAMP_TO_EDGE,this._passParameters.blend=new Bi(this._rctx,r),this._isEnabled=!0,!0}disable(){this._isEnabled&&(this._vao=De(this._vao),this._passParameters.areaTexture=De(this._passParameters.areaTexture),this._passParameters.searchTexture=De(this._passParameters.searchTexture),this._passParameters.blend=De(this._passParameters.blend),this._passParameters.edges=De(this._passParameters.edges),this._isEnabled=!1)}get _validPassParameters(){return this._isEnabled?this._passParameters:null}render(e){const t=this._validPassParameters;if(t==null)return;t.colorTexture=e;const r=this._rctx,i=r.getBoundFramebufferObject(),s=e.descriptor.width,n=e.descriptor.height;r.bindVAO(this._vao),r.setViewport(0,0,s,n),t.edges.resize(s,n),r.bindFramebuffer(t.edges),r.setClearColor(0,0,0,1),r.clear(fi.COLOR_BUFFER_BIT),r.bindTechnique(this._edgeDetectTechnique,t,null),r.drawArrays(bt.TRIANGLES,0,3),t.blend.resize(s,n),r.bindFramebuffer(t.blend),r.setClearColor(0,0,1,1),r.clear(fi.COLOR_BUFFER_BIT),r.bindTechnique(this._blendWeightsTechnique,t,null),r.drawArrays(bt.TRIANGLES,0,3),r.bindFramebuffer(i),r.setClearColor(0,1,0,1),r.clear(fi.COLOR_BUFFER_BIT),r.bindTechnique(this._blurTechnique,t,null),r.drawArrays(bt.TRIANGLES,0,3)}_loadTextureFromBase64(e,t,r){return Vm(e).then(i=>{const s=new hr;return s.pixelFormat=r,s.wrapMode=Ct.CLAMP_TO_EDGE,s.width=i.width,s.height=i.height,s.samplingMode=t,new wt(this._rctx,s,i)})}};h([f()],ZE.prototype,"_abortController",void 0),h([f({readOnly:!0})],ZE.prototype,"updating",null),ZE=h([F("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],ZE);function Pat(e,t){const r=-e[0],i=-e[1],s=-e[2],n=t[3],o=t[7],a=t[11],l=t[15];t[0]+=n*r,t[1]+=n*i,t[2]+=n*s,t[4]+=o*r,t[5]+=o*i,t[6]+=o*s,t[8]+=a*r,t[9]+=a*i,t[10]+=a*s,t[12]+=l*r,t[13]+=l*i,t[14]+=l*s}function Mat(e,t){const r=e[0],i=e[1],s=e[2];t[12]+=r*t[0]+i*t[4]+s*t[8],t[13]+=r*t[1]+i*t[5]+s*t[9],t[14]+=r*t[2]+i*t[6]+s*t[10],t[14]+=r*t[3]+i*t[7]+s*t[11]}class Iat{constructor(t){this._factory=t,this._originData=new Map}acquire(t){return this.register(this._factory.getOrigin(t))}register(t){const r=this._originData.get(t.id)||new $at(t);return r.refCount++,this._originData.has(r.origin.id)||this._originData.set(r.origin.id,r),r}release(t){t.refCount--,t.refCount===0&&this._originData.delete(t.origin.id)}updateViewMatrices(t){this._originData.forEach(r=>{Ss(r.viewMatrix,t),Mat(r.origin.vec3,r.viewMatrix)})}}class $at{constructor(t){this.origin=t,this.refCount=0,this.viewMatrix=be()}}class Lat extends Nfe{constructor(t,r){super(),this.distanceFalloffFactor=t,this.transparency=r,this.transformNormalViewFromGlobal=$i()}}class Dat extends Ffe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=$i(),this.slicePlaneLocalOrigin=C(),this.transformNormalGlobalFromModel=$i()}}function Nat(e){const t=b`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;e.code.add(t)}const Fat=or(.5,-4e-4);function Uat(e,t){const r=e.vertex;r.include(Nat),r.constants.add("depthBias","vec2",Fat),r.uniforms.add(new yr("inverseViewport",(i,s)=>s.inverseViewport)),t.legacy?(r.uniforms.add(new Ci("proj",(i,s)=>s.camera.projectionMatrix)),r.code.add(b`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(r.uniforms.add(new sh("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal),new Ci("transformProjFromView",i=>i.transformProjFromView)),r.code.add(b`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),r.code.add(b`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function kat(e,t){const r=e.fragment;r.constants.add("coverageTestThreshold","float",.01),t.antialiasing?r.code.add(b`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):r.code.add(b`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function zat(e,t){const r=e.vertex;t.silhouette?(r.code.add(b`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),t.legacy?r.code.add(b`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):r.code.add(b`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):r.code.add(b`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function Bat(e,t){const r=e.vertex;r.include(Hl),r.uniforms.add(new Ae("distanceFalloffFactor",i=>i.distanceFalloffFactor)),r.code.add(b`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),r.uniforms.add(new zu("componentDataTex",i=>i.componentDataTexture)),e.attributes.add(E.COMPONENTINDEX,"float"),r.constants.add("componentColorFieldOffset","float",0),r.constants.add("componentOtherFieldOffset","float",1),r.constants.add("componentVerticalOffsetFieldOffset","float",2),r.constants.add("componentFieldCount","float",3),r.constants.add("lineWidthFractionFactor","float",8),r.constants.add("extensionLengthOffset","float",128),r.constants.add("verticalOffsetScale","float",2*VW),r.code.add(b`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float texSize = float(textureSize(componentDataTex, 0).x);
float colIndex = mod(fieldIndex, texSize);
float rowIndex = floor(fieldIndex / texSize);
return vec2(colIndex, rowIndex) + 0.5;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),t.legacy?r.code.add(b`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(r.uniforms.add(new CA("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel)),r.code.add(b`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),t.silhouette?(e.attributes.add(E.NORMALA,"vec3"),e.attributes.add(E.NORMALB,"vec3"),r.code.add(b`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(e.attributes.add(E.NORMAL,"vec3"),r.code.add(b`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),t.legacy?r.code.add(b`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(r.include(gL,t),r.include(gL,t),r.uniforms.add(new sh("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new CA("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new Rc("transformWorldFromModelTL",i=>i.transformWorldFromModelTL),new Rc("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new Rt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new Rt("transformWorldFromViewTH",i=>i.transformWorldFromViewTH)),r.code.add(b`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${t.spherical?b`normalize(transformWorldFromModelTL + rotatedModelPosition);`:b`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),r.uniforms.add(new Ci("transformProjFromView",(i,s)=>s.camera.projectionMatrix)),r.code.add(b`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),r.code.add(b`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function Vat(e){return e.mode===Zs.SKETCH||e.mode===Zs.MIXED}var Zs,Sv;(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH",e[e.MIXED=2]="MIXED",e[e.COUNT=3]="COUNT"})(Zs||(Zs={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.SILHOUETTE=1]="SILHOUETTE"}(Sv||(Sv={}));function qW(e,t){const r=e.vertex;switch(e.attributes.add(E.SIDENESS,"vec2"),t.mode===Zs.MIXED?r.code.add(b`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):r.code.add(b`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),t.mode){case Zs.MIXED:r.code.add(b`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case Zs.SKETCH:r.code.add(b`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Zs.SOLID:r.code.add(b`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Zs.COUNT:break;default:t.mode}}function Gat(e,t){const r=e.vertex;switch(e.include(qW,t),t.mode){case Zs.SOLID:r.code.add(b`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case Zs.SKETCH:r.uniforms.add(new Zv("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(b`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case Zs.MIXED:r.uniforms.add(new Zv("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(b`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function jat(e,t){e.include(qW,t);const{vertex:r,fragment:i}=e;switch(Vat(t)&&(r.uniforms.add(new zu("strokesTexture",s=>s.strokesTexture.texture)),r.uniforms.add(new Zv("strokesLog2Resolution",s=>Math.log2(s.strokesTexture.resolution)),new Zv("strokeVariants",s=>s.strokesTexture.variants)),e.varyings.add("vStrokeUV","vec2"),i.uniforms.add(new zu("strokesTexture",s=>s.strokesTexture.texture),new Zv("strokesNormalizationScale",s=>s.strokesTexture.normalizationScale)),r.code.add(b`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) / vec2(textureSize(strokesTexture, 0));
vStrokeUV.x += variantOffset;
}`),e.fragment.include(Hl),i.code.add(b`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),t.mode){case Zs.SOLID:r.code.add(b`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),i.code.add(b`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case Zs.SKETCH:r.code.add(b`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),i.code.add(b`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case Zs.MIXED:e.varyings.add("vType","float"),r.code.add(b`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),i.code.add(b`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function Hat(e){const t=new pr,{vertex:r,fragment:i}=t;return e.legacy&&r.uniforms.add(new yse("model"),new yse("localView")),t.include(Uat,e),t.include(Bat,e),t.include(Gat,e),t.include(qW,e),t.include(jat,e),t.include(os,e),t.include(zat,e),t.include(kat,e),t.include(kc,e),t.varyings.add("vColor","vec4"),t.varyings.add("vRadius","float"),t.varyings.add("vPosition","vec3"),t.varyings.add("vWorldPosition","vec3"),t.varyings.add("vViewPos","vec3"),t.varyings.add("vLineLengthPixels","float"),t.varyings.add("vSizeFalloffFactor","float"),r.uniforms.add(new yr("pixelToNDC",(s,n)=>Qt(Wat,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new Zt("viewport",(s,n)=>n.camera.fullViewport),new Ae("pixelRatio",(s,n)=>n.camera.pixelRatio)),t.attributes.add(E.POSITION0,"vec3"),t.attributes.add(E.POSITION1,"vec3"),t.attributes.add(E.VARIANTOFFSET,"float"),t.attributes.add(E.VARIANTSTROKE,"float"),t.attributes.add(E.VARIANTEXTENSION,"float"),r.code.add(b`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      vViewPos = viewPos;

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${e.antialiasing?b`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:b`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${e.mode===Zs.SKETCH?b`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:e.mode===Zs.MIXED?b`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),i.code.add(b`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      fragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),t}const Wat=Ne();class yse extends es{constructor(t){super(t,"mat4")}}const qat=Object.freeze(Object.defineProperty({__proto__:null,build:Hat},Symbol.toStringTag,{value:"Module"}));class A5 extends xr{initializeProgram(t){return new vr(t.rctx,A5.shader.get().build(this.configuration),D1e)}initializePipeline(t){return t.blendMinMax?Tt({blending:oo(ve.ONE,ve.ONE,ve.ZERO,ve.ONE,Jp.ADD,t.blendMinMax.MAX),depthTest:{func:Hr.LEQUAL},colorWrite:It}):Tt({depthTest:{func:Hr.LEQUAL},depthWrite:Ka,colorWrite:It})}}A5.shader=new _r(qat,()=>ue(()=>import("./EdgeShader.glsl.1fbf6faa.js"),[]));class fp extends bo{constructor(){super(...arguments),this.mode=Zs.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}}h([B({count:Zs.COUNT})],fp.prototype,"mode",void 0),h([B()],fp.prototype,"hasSlicePlane",void 0),h([B()],fp.prototype,"silhouette",void 0),h([B()],fp.prototype,"legacy",void 0),h([B()],fp.prototype,"antialiasing",void 0),h([B()],fp.prototype,"doublePrecisionRequiresObfuscation",void 0),h([B()],fp.prototype,"hasMultipassTerrain",void 0),h([B()],fp.prototype,"cullAboveGround",void 0),h([B()],fp.prototype,"spherical",void 0);const Xat=8,qU=128,Zat={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},Yat={solid:Zs.SOLID,sketch:Zs.SKETCH,uber:Zs.MIXED};class YC{constructor(t,r,i){this._rctx=t,this._shaderTechniqueRepository=r,this._configuration=new fp,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[Lt.TRANSPARENT]:{[Lt.TRANSPARENT]:new Mt,[Lt.OPAQUE]:new Mt},[Lt.OPAQUE]:{[Lt.TRANSPARENT]:new Mt,[Lt.OPAQUE]:new Mt}},this._renderablesDirty=!1,this._drawParameters=new Dat,this._settings={...Zat,...i},this.key=YC.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const s=this._settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:Kr.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=Yat[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=t.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=i.spherical}dispose(){this._technique=Mi(this._technique)}addRenderable(t){this._renderables.add(t),this._renderablesDirty=!0}removeRenderable(t){this._renderables.delete(t),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(t,r){if(this._renderablesDirty&&this._sortRenderables(),r!==Lt.INVISIBLE){const i=this._sortedRenderables[r];i[Lt.TRANSPARENT].forAll(t),i[Lt.OPAQUE].forAll(t)}}updateTechnique(t,r){return this._configuration.hasMultipassTerrain=!!t.multipassTerrain.enabled,this._configuration.cullAboveGround=!!t.multipassTerrain.cullAboveGround,this._configuration.silhouette=r,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(A5,this._configuration,this._technique),this._technique}bindRegularEdges(t,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!1),t,r)}bindSilhouetteEdges(t,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!0),t,r)}renderRegularEdges(t,r,i,s,n){this._render(t,r,r.regular.vao,i,s,n)}renderSilhouetteEdges(t,r,i,s,n){this._render(t,r,r.silhouette.vao,i,s,n)}_render(t,r,i,s,n,o){o>0&&(this._bindDraw(t,r,s,n),this._rctx.bindVAO(i),this._rctx.capabilities.instancing.drawArraysInstanced(bt.TRIANGLE_FAN,0,4,o))}_bindDraw(t,r,i,s){if(this._drawParameters.componentDataTexture=r.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in r.transform)this._lastOriginId!==r.transform.origin.origin.id&&(t.setUniformMatrix4fv("localView",r.transform.origin.viewMatrix),this._lastOriginId=r.transform.origin.origin.id),t.setUniformMatrix4fv("model",r.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=r.transform.origin.origin.vec3;else{const n=new h5(r.transform.position),o=Qu(_se,nb(_se,r.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=n.low,this._drawParameters.transformWorldFromModelTH=n.high,this._drawParameters.transformWorldFromModelRS=r.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=s.camera.viewInverseTransposeMatrix;se(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}t.bindDraw(this._drawParameters,s,i)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[Lt.TRANSPARENT][Lt.TRANSPARENT].clear(),this._sortedRenderables[Lt.TRANSPARENT][Lt.OPAQUE].clear(),this._sortedRenderables[Lt.OPAQUE][Lt.TRANSPARENT].clear(),this._sortedRenderables[Lt.OPAQUE][Lt.OPAQUE].clear(),this._renderables.forEach(r=>{r.objectTransparency!==Lt.INVISIBLE&&r.edgeTransparency!==Lt.INVISIBLE&&this._sortedRenderables[r.objectTransparency][r.edgeTransparency].push(r)});const t=(r,i)=>"origin"in r.transform?"origin"in i.transform?r.transform.origin.origin.id<i.transform.origin.origin.id?-1:r.transform.origin.origin.id>i.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[Lt.TRANSPARENT][Lt.TRANSPARENT].sort(t),this._sortedRenderables[Lt.TRANSPARENT][Lt.OPAQUE].sort(t),this._sortedRenderables[Lt.OPAQUE][Lt.TRANSPARENT].sort(t),this._sortedRenderables[Lt.OPAQUE][Lt.OPAQUE].sort(t)}static getKey(t,r,i){return`edges-t:${t}:${r}:${i}`}}const _se=Ya();function pgt(e,t){return t.push(e.buffer),{buffer:e.buffer,layout:new e6e(e.layout)}}function eM(e){return new jN(e.layout).createView(e.buffer)}class Jat extends Ive{constructor(t){super("EdgeProcessingWorker","extract",{extract:r=>[r.dataBuffer],extractComponentsEdgeLocations:r=>[r.dataBuffer],extractEdgeLocations:r=>[r.dataBuffer]},t)}async process(t,r,i){if(i)return Gnt(t);const s=await this.invoke(new XU(t),r);return this._unpackOutput(s)}async extractEdgeLocations(t,r){const i=await this.invokeMethod("extractEdgeLocations",new XU(t),r);return eM(i)}async extractComponentsEdgeLocations(t,r){const i=await this.invokeMethod("extractComponentsEdgeLocations",new XU(t),r);return eM(i)}_unpackOutput(t){return{regular:{instancesData:eM(t.regular.instancesData),lodInfo:{lengths:new Float32Array(t.regular.lodInfo.lengths)}},silhouette:{instancesData:eM(t.silhouette.instancesData),lodInfo:{lengths:new Float32Array(t.silhouette.lodInfo.lengths)}},averageEdgeLength:t.averageEdgeLength}}}class XU{constructor(t){this.dataBuffer=t.data.buffer,this.writerSettings=t.writerSettings,this.skipDeduplicate=t.skipDeduplicate,this.indices=md(t.indices)?t.indices:t.indices.buffer,this.indicesType=md(t.indices)?"Array":RD(t.indices)?"Uint32Array":"Uint16Array",this.indicesLength=t.indicesLength}}function Kat(e){const r=FS.resolution,i=r/2,s=new Uint8Array(4*r*r),n=4*r*i,o=FS.amplitude,a=2*o,l=4*r,c=Math.log2(r)+1,u=FS.strokes.length;let d=(c-1)*u*l;for(const{distance:y,pressure:_}of FS.strokes){let v=y,w=_,T=d;for(let x=0;x<c;x++){x!==0&&(v=vse(v,f3.DISTANCE),w=vse(w,f3.PRESSURE));for(let S=0;S<FS.resolution;S++){const O=.5+(v?v[S%v.length]/a:0),A=w?w[S%w.length]:1;XA(O,s,T),XA(A,s,T+n),T+=4}T-=l*(u+1)}d+=l}const p=new hr;p.width=p.height=r;const g=new wt(e,p,s);return new elt(r,a,o,u,g)}function vse(e,t){if(!e)return null;const r=e.length/2,i=Qat*r,s=new Array(r);let n=0;const o=t===f3.PRESSURE;for(let a=0;a<e.length;a+=2){const l=(e[a]+e[a+1])/2;s[n++]=o?Math.min(i,1-(1-l)*bse):Math.min(i,l*bse)}return s}var f3;(function(e){e[e.DISTANCE=0]="DISTANCE",e[e.PRESSURE=1]="PRESSURE"})(f3||(f3={}));const Qat=.1,bse=.5;class elt{constructor(t,r,i,s,n){this.resolution=t,this.normalizationScale=r,this.amplitude=i,this.variants=s,this.texture=n}dispose(){this.texture=De(this.texture)}}const FS={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function wse(e){let t=null;for(const r of e){const i=r.type;if(tlt(r)){if(t==null)t=i;else if(t!==i)return"uber"}}return t??"uber"}function xse(e){let t=Lt.INVISIBLE;for(const{material:r}of e)if(Y1e(r)){if(r.color[3]*r.opacity<1)return Lt.TRANSPARENT;t=Lt.OPAQUE}return t}function Tse(e){let t=Lt.INVISIBLE;for(const{material:r}of e)if(Y1e(r)){switch(r.objectTransparency){case Lt.TRANSPARENT:case Lt.INVISIBLE:return Lt.TRANSPARENT;case Lt.OPAQUE:if(r.opacity<1)return Lt.TRANSPARENT}t=Lt.OPAQUE}return t}function Y1e(e){return e.size*e.color[3]*e.opacity>0}function tlt(e){return e.size*e.color[3]>0}function Sse(e,t,r,i){for(let s=0;s<e.length;s++){const n=e[s].index,o=t[s],a=t[s+1];if(i)for(let l=o;l<a;l++){const c=i[l];r.set(c,n)}else for(let l=o;l<a;l++)r.set(l,n)}}let Nh=class extends xe{constructor(e){super(e),this._updatingHandles=new Fp,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=C(),this._localOrigins=new Iat(new WH(e.renderSR))}initialize(){this._worker=new Jat(this.schedule),this._componentColorManager=new U1e(this.rctx,3);const e=$1e.createBuffer(4);for(let t=0;t<4;t++)e.sideness.set(t,0,t===0||t===3?0:1),e.sideness.set(t,1,t===0||t===1?0:1);this._verticesBufferObject=rr.createVertex(this.rctx,gr.STATIC_DRAW,e.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(e=>this._discardObjectEntry(e)),this._perObjectData.clear(),this._strokesTexture=De(this._strokesTexture),this._componentColorManager=Re(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=De(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy(),this._set("schedule",alt))}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(e,t,r,i,s,n,o,a){if(this.hasObject(e))return this.getObjectMemoryUsage(e);let l;const c=new Cse(new Promise(d=>l=d),r.center,r.radius);this._perObjectData.set(e,c);const u=await this._updatingHandles.addPromise(this._addComponentGeometry(t,c,i,s,n,o,a));return this.setNeedsRender(),l(),u}async addOrUpdateObject3D(e,t,r,i){if(this.destroyed)return void K.getLogger(this).warn("Attempt to add an object to a destroyed instance");const s=this._perObjectData.get(e);let n;s?.renderables.length>0&&this._perObjectDataEvictionCache.add(s);const o=e.boundingVolumeWorldSpace.bounds,a=new Cse(new Promise(c=>n=c),o,ym(o));this._perObjectData.set(e,a);const l=new Array;if(r.mergeGeometries&&e.geometries.length>1&&rlt(e))l.push(this._addObjectMergedGeometries(e,a,t,r,i));else for(let c=0;c<e.geometries.length;c++){const u=e.geometries[c];u.material.supportsEdges&&l.push(this._addGeometry(e,a,u,t[0],r,i))}await this._updatingHandles.addPromise(Promise.all(l)),this._perObjectDataEvictionCache.delete(a),this._discardObjectEntry(s),this.setNeedsRender(),n()}_discardObjectEntry(e){e&&(e.renderables.length&&(e.renderables.forEach(t=>this._removeRenderable(t)),this.setNeedsRender()),e.loaded=null)}hasObject(e){return this._perObjectData.has(e)}async updateAllComponentOpacities(e,t){const r=await this._updatingHandles.addPromise(this._getObjectEntry(e));if(r==null)return;const i=t instanceof Array?s=>t[s]:()=>t;r.renderables.forEach(s=>{const n=s.components.meta.length;for(let o=0;o<n;o++){const a=i(o),l=s.components.meta[o],c=l.index;l.material.opacity=a,s.components.buffer.textureBuffer.setDataElement(c,1,3,255*a)}this._updateTransparency(s)}),this.setNeedsRender()}async getObjectMemoryUsage(e){const t=await this._getObjectEntry(e);return t!=null?t.renderables.reduce((r,i)=>r+i.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(e,t,r,i){const s=e instanceof ng,n=!!r.hasSlicePlane,o=wse(t),a=YC.getKey(o,n,s),l=await this._updatingHandles.addPromise(this._getObjectEntry(e));l!=null&&(l.renderables.forEach(c=>{if(a!==c.rendererKey){const u=this._renderers.get(c.rendererKey),d=this._acquireRenderer(o,n,s);u.removeRenderable(c),--u.refCount,c.rendererKey=a,d.addRenderable(c)}for(let u=0;u<t.length;u++)c.components.meta[u].material=t[u];i&&this._updateComponentBuffer(c.components),this._updateTransparency(c)}),this.setNeedsRender())}async updateAllVerticalOffsets(e,t){const r=await this._updatingHandles.addPromise(this._getObjectEntry(e));r!=null&&(r.renderables.forEach(i=>{const s=i.components.meta;for(let n=0;n<s.length;n++)i.components.meta[n].verticalOffset=t?.[n]??0;this._updateComponentBuffer(i.components)}),this.setNeedsRender())}async updateObjectVisibility(e,t){const r=await this._updatingHandles.addPromise(this._getObjectEntry(e));r!=null&&(r.renderables.forEach(i=>i.visible=t),this.setNeedsRender())}removeObject(e){const t=this._perObjectData.get(e);t&&(this._perObjectData.delete(e),this._discardObjectEntry(t))}async _getObjectEntry(e){const t=this._perObjectData.get(e);if(!t)throw new Error("no object");return await t.loaded,t.loaded==null?null:t}render(e,t){if(this._componentColorManager==null)return;this._localOrigins.updateViewMatrices(e.camera.viewMatrix);const r=e.camera.viewInverseTransposeMatrix,i=C(),s=new h5;let n=0,o=0;if(this._renderers.forEach(l=>{if(l.refCount===0)this._renderers.delete(l.key),l.dispose();else{let c=!0,u=!0;l.forEachRenderable(d=>{d.visible&&(n+=d.statistics.averageEdgeLength,o++,c&&d.regular&&(l.updateTechnique(e,!1),c=!1),u&&d.silhouette&&(l.updateTechnique(e,!0),u=!1))},t)}}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),o===0)return;const a=new Lat(40*n/o,t);se(i,r[3],r[7],r[11]),s.set(i),re(a.transformWorldFromViewTH,s.high),re(a.transformWorldFromViewTL,s.low),Ku(a.transformViewFromCameraRelativeRS,e.camera.viewMatrix),Qu(Pse,a.transformViewFromCameraRelativeRS),nb(a.transformNormalViewFromGlobal,Pse),a.transformProjFromView=e.camera.projectionMatrix,this._updateObjectCameraDistances(e),this._renderers.forEach(l=>{this._renderRegularEdges(l,e,a),this._renderSilhouetteEdges(l,e,a)})}_updateTransparency(e){const t=xse(e.components.meta),r=Tse(e.components.meta);t===e.edgeTransparency&&r===e.objectTransparency||(e.edgeTransparency=t,e.objectTransparency=r,this._renderers.get(e.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(e,t,r){e.getCombinedShaderTransformation(t,r);const i=t.localOrigin!=null?this._localOrigins.register(t.localOrigin):this._localOrigins.acquire(se(this._tmpModelPosition,r[12],r[13],r[14]));return t.localOrigin=i.origin,Pat(i.origin.vec3,r),i}_updateComponentBuffer(e){const{meta:t,buffer:r}=e,i=new Uint8Array(4);for(let s=0;s<t.length;s++){const n=t[s].material,o=t[s].index,a=fe(Math.round(n.size*Xat),0,255),l=fe(n.extensionLength,-qU,255-qU)+qU,c=n.type==="solid"?bD.SOLID:bD.SKETCH,u=255*n.opacity,d=n.color,p=255*d[0],g=255*d[1],y=255*d[2],_=255*d[3];r.textureBuffer.setData(o,0,p,g,y,_),r.textureBuffer.setData(o,1,a,l,c,u),M1e(t[s].verticalOffset,i),r.textureBuffer.setData(o,2,i[0],i[1],i[2],i[3])}}_createComponentBuffers(e){if(this._componentColorManager==null)return null;const t=new Array,r=this._componentColorManager.getBuffer(e.length);for(let s=0;s<e.length;s++){const n=e[s],o=r.acquireIndex();t.push({index:o,verticalOffset:0,material:n})}const i=new ilt(r,t);return this._updateComponentBuffer(i),i}_extractEdges(e,t,r,i,s,n=s.length){return this._worker.process({data:t,indices:s,indicesLength:n,writerSettings:e,skipDeduplicate:r},this._workerAbort.signal,i)}_createRenderable(e,t,r,i,s){const n=c=>this._verticesBufferObject!=null?new slt(new Ed(this.rctx,D1e,{vertices:Int,instances:c===Sv.REGULAR?_D.glLayout:vD.glLayout},{vertices:this._verticesBufferObject,instances:rr.createVertex(this.rctx,gr.STATIC_DRAW,c===Sv.REGULAR?e.regular.instancesData.buffer:e.silhouette.instancesData.buffer)}),c===Sv.REGULAR?e.regular.lodInfo:e.silhouette.lodInfo):null,o=e.regular.lodInfo.lengths.length>0?n(Sv.REGULAR):null,a=e.silhouette.lodInfo.lengths.length>0?n(Sv.SILHOUETTE):null,l=(o?.vao.memoryEstimate??0)+(a?.vao.memoryEstimate??0);return new olt(o,a,{gpuMemoryUsage:l,externalMemoryUsage:s,averageEdgeLength:e.averageEdgeLength},r,xse(t.meta),Tse(t.meta),t,i)}async _addGeometry(e,t,r,i,s,n){const o=r.vertexAttributes.get(E.POSITION),a=r.indices.get(E.POSITION),l=be(),c=this._computeModelTransformWithLocalOrigin(e,r,l),u=new Rse(o,a,l,c);return this._addPositionData(t,u,r.edgeIndicesLength,i,s,n)}async _addPositionData(e,t,r,i,s,n=!1){if(e.loaded==null)return;const o=this._createComponentBuffers([i]);if(o==null||r<=0)return;const a=this._acquireRenderer(i.type,!!s.hasSlicePlane,!0),{modelTransform:l,origin:c}=t,u=t.indices,d=t.position,p=d.data.length/d.size,g=gD.createBuffer(p);for(let v=0;v<p;v++)g.position.set(v,0,d.data[v*d.size]),g.position.set(v,1,d.data[v*d.size+1]),g.position.set(v,2,d.data[v*d.size+2]);Sse(o.meta,[0,g.componentIndex.count],g.componentIndex);const y=await this._updatingHandles.addPromise(this._extractEdges(a.writerSettings,g,!1,n,u,r));if(e.loaded==null)return;const _=this._createRenderable(y,o,new nlt(l,c),a.key,!1);e.renderables.push(_),a.addRenderable(_),this._gpuMemoryUsage+=_.statistics.gpuMemoryUsage}async _addComponentGeometry(e,t,r,i,s,n,o){if(t.loaded==null)return 0;const a=this._createComponentBuffers(n);if(a==null)return 0;const l=wse(n),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),u=gD.createBuffer(r.length/3);dO(u.position.typedBuffer,r,u.position.typedBufferStride,3),Sse(a.meta,s,u.componentIndex,i);const d=!0,p=c.writerSettings,g=await this._updatingHandles.addPromise(this._extractEdges(p,u,d,!1,i));if(t.loaded==null)return 0;const y=this._createRenderable(g,a,e,c.key,!0);return t.renderables.push(y),c.addRenderable(y),y.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(e,t,r,i,s){const n=new Map;let o=0,a=null,l=0;for(let w=0;w<e.geometries.length;w++){const T=e.geometries[w];if(!T.material.supportsEdges)continue;!a&&T.localOrigin&&(a=T);const x=T.vertexAttributes.get(E.POSITION);l+=x.data.length/x.size,o+=T.edgeIndicesLength}const c=l>=65536?Uint32Array:Uint16Array,u=o?new c(o):null,d=[];let p=0;for(let w=0;w<e.geometries.length;w++){const T=e.geometries[w];if(!T.material.supportsEdges)continue;const x=T.vertexAttributes.get(E.POSITION),S=T.indices.get(E.POSITION);let O=n.get(x.data);if(O==null){O=d.length/3;for(let A=0;A<x.data.length;A+=x.size)d.push(x.data[A]),d.push(x.data[A+1]),d.push(x.data[A+2]);n.set(x.data,O)}if(S)for(let A=0;A<T.edgeIndicesLength;A++)u[p++]=O+S[A]}const g=a||e.geometries[0],y=be(),_=this._computeModelTransformWithLocalOrigin(e,g,y);for(let w=0;w<e.geometries.length;w++)e.geometries[w].localOrigin=_.origin;const v=new Rse({data:d,size:3},u,y,_);await this._updatingHandles.addPromise(this._addPositionData(t,v,u.length,r[0],i,s))}_acquireRenderer(e,t,r){const i=YC.getKey(e,t,r);let s=this._renderers.get(i);return this._strokesTexture==null&&(this._strokesTexture=Kat(this.rctx)),s||(s=new YC(this.rctx,this.techniqueRepository,{type:e,hasSlicePlane:t,strokesTexture:this._strokesTexture,legacy:r,spherical:this.viewingMode===Ie.Global}),this._renderers.set(i,s)),++s.refCount,s}_removeRenderable(e){Ese(e.regular),Ese(e.silhouette);const t=this._renderers.get(e.rendererKey);if(t){t.removeRenderable(e),--t.refCount,"origin"in e.transform&&this._localOrigins.release(e.transform.origin),this._gpuMemoryUsage-=e.statistics.externalMemoryUsage?0:e.statistics.gpuMemoryUsage;for(const r of e.components.meta)e.components.buffer.releaseIndex(r.index)}}_updateObjectCameraDistances(e){const t=e.camera.eye,r=e.camera.viewForward,i=C(),s=n=>{Ln(i,n.center,t);const o=de(i,r),a=n.radius,l=o<-a?1/0:o<a?0:o-a;n.renderables.forEach(c=>c.distanceToCamera=l)};this._perObjectData.forEach(s),this._perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(e,t,r){const i=e.bindRegularEdges(r,t),s=r.transparency,n=t.camera.perScreenPixelRatio;e.forEachRenderable(o=>{if(!Ase(o)||!o.visible)return;const a=tM(o.regular.lod.lengths,o.distanceToCamera,n);e.renderRegularEdges(i,o,r,t,a)},s)}_renderSilhouetteEdges(e,t,r){const i=e.bindSilhouetteEdges(r,t),s=r.transparency,n=t.camera.perScreenPixelRatio;e.forEachRenderable(o=>{if(!Ose(o)||!o.visible)return;const a=tM(o.silhouette.lod.lengths,o.distanceToCamera,n);e.renderSilhouetteEdges(i,o,r,t,a)},s)}get test(){return{hasRenderedPrimitives:e=>{let t=!1;const r=e.perScreenPixelRatio,i=(s,n)=>s.forEachRenderable(o=>{o.visible&&!t&&(Ase(o)&&(t=tM(o.regular.lod.lengths,o.distanceToCamera,r)>0),!t&&Ose(o)&&(t=tM(o.silhouette.lod.lengths,o.distanceToCamera,r)>0))},n);return this._renderers.forEach(s=>{t||(i(s,Lt.OPAQUE),i(s,Lt.TRANSPARENT))}),t}}}};function Ese(e){e!=null&&(e.vao.vertexBuffers.instances.dispose(),e.vao.disposeVAOOnly(),e.vao=null)}function rlt(e){let t=null,r=null;for(let i=0;i<e.geometries.length;i++){const s=e.geometries[i];if(s.material.supportsEdges){if(t){if(!Om(t,s.transformation))return!1}else t=s.transformation;if(r||s.localOrigin==null){if(r&&r.localOrigin!=null&&s.localOrigin!=null&&r.localOrigin.id!==s.localOrigin.id)return!1}else r=s}}return!0}h([f({constructOnly:!0})],Nh.prototype,"rctx",void 0),h([f({constructOnly:!0})],Nh.prototype,"renderSR",void 0),h([f({constructOnly:!0})],Nh.prototype,"viewingMode",void 0),h([f({constructOnly:!0})],Nh.prototype,"techniqueRepository",void 0),h([f({constructOnly:!0})],Nh.prototype,"setNeedsRender",void 0),h([f({constructOnly:!0})],Nh.prototype,"schedule",void 0),h([f({readOnly:!0})],Nh.prototype,"_updatingHandles",void 0),h([f({readOnly:!0})],Nh.prototype,"updating",null),Nh=h([F("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],Nh);class Cse{constructor(t,r,i){this.center=r,this.radius=i,this.renderables=new Array,this.loaded=t,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}class ilt{constructor(t,r){this.buffer=t,this.meta=r}}class slt{constructor(t,r){this.vao=t,this.lod=r}}class nlt{constructor(t,r){this.modelMatrix=t,this.origin=r}}class olt{constructor(t,r,i,s,n,o,a,l){this.regular=t,this.silhouette=r,this.statistics=i,this.transform=s,this.edgeTransparency=n,this.objectTransparency=o,this.components=a,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}}function Ase(e){return e.regular!=null}function Ose(e){return e.silhouette!=null}function tM(e,t,r){const i=t*r,s=bwe(e,i,!0);return s===-1?i<e[0]?e.length:0:e.length-s}class Rse{constructor(t,r,i,s){this.position=t,this.indices=r,this.modelTransform=i,this.origin=s}}const Pse=$i(),alt=()=>Promise.reject();function Ad(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}class Mse{constructor(t,r,i,s,n,o,a,l,c){this.createQuery=t,this.deleteQuery=r,this.resultAvailable=i,this.getResult=s,this.disjoint=n,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}}let Yf=!1;function llt(e,t){if(t.disjointTimerQuery)return null;let r=e.getExtension("EXT_disjoint_timer_query_webgl2");return r&&Ad(e)?new Mse(()=>e.createQuery(),i=>{e.deleteQuery(i),Yf=!1},i=>e.getQueryParameter(i,e.QUERY_RESULT_AVAILABLE),i=>e.getQueryParameter(i,e.QUERY_RESULT),()=>e.getParameter(r.GPU_DISJOINT_EXT),i=>{Yf||(Yf=!0,e.beginQuery(r.TIME_ELAPSED_EXT,i))},()=>{e.endQuery(r.TIME_ELAPSED_EXT),Yf=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>e.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):(r=e.getExtension("EXT_disjoint_timer_query"),r?new Mse(()=>r.createQueryEXT(),i=>{r.deleteQueryEXT(i),Yf=!1},i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_AVAILABLE_EXT),i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_EXT),()=>e.getParameter(r.GPU_DISJOINT_EXT),i=>{Yf||(Yf=!0,r.beginQueryEXT(r.TIME_ELAPSED_EXT,i))},()=>{r.endQueryEXT(r.TIME_ELAPSED_EXT),Yf=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):null)}function clt(e,t){const r=e.capabilities.disjointTimerQuery;return r==null?null:new ult(r,t)}class ult{constructor(t,r){this._timer=t,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,r.forEach(i=>{const s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(i,null)})}start(){Yf||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(t){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(t))return this.abort(),null;this._timer.endTimeElapsed();const r=this._queryResults.get(t);if(r==null)return this._queryResults.set(t,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(r))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const i=this._timer.getResult(r)/1e6;return this._queryPool.unshift(r),this._queryResults.set(t,this._currentQuery),this._currentQuery=null,i}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(t=>{this._timer.deleteQuery(t)}),this._queryResults.forEach(t=>{t!=null&&this._timer.deleteQuery(t)})}}var di;(function(e){e.OVERLAY="overlay",e.PREPARE="prepare",e.SHADOW_MAP="shadow map",e.LINEAR_DEPTH="linear depth",e.ACCUMULATED_SHADOWS="accumulated shadows",e.NORMALS="normals",e.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",e.SSAO="SSAO",e.OPAQUE="opaque",e.OPAQUE_EDGES="opaque edges",e.VOXEL="voxel",e.TRANSPARENT="transparent",e.TRANSPARENT_EDGES="transparent edges",e.HUD_VISIBILITY="HUD visibility",e.TRANSPARENT_TERRAIN="transparent terrain",e.ENVIRONMENT="environment",e.LASER_LINE="laser line",e.OCCLUDED="occluded",e.ANTIALIASING="antialiasing",e.HIGHLIGHTS="highlights",e.HUD="HUD",e.HUD_OCCLUDED="HUD occluded",e.FINISH="finish"})(di||(di={}));const Ise="Total";class hlt{constructor(t){this._rctx=t,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new hm(Ise),this._cpuTimeSamplers=new Map(Object.values(di).map(r=>[r,new hm(r)])),this._enableGPUTimer=0,this._totalGPUTime=new hm("GPU"),this._gpuTimeSamplers=new Map(Object.values(di).map(r=>[r,new hm(r)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const t=[...Object.values(di),Ise];this._gpuTimerPool=clt(this._rctx,t)}return this._gpuTimerPool==null?{hasGPUTimerSupport:!1,remove:()=>{}}:(++this._enableGPUTimer,{hasGPUTimerSupport:!0,remove:VV(()=>{--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=De(this._gpuTimerPool))})})}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool!=null&&this._gpuTimerPool.start()}advance(t){const r=performance.now();if(this._cpuTimeSamplers.get(t).record(r-this._lastTimeStampCPU),this._lastTimeStampCPU=r,this._gpuTimerPool!=null){const i=this._gpuTimerPool.stop(t);this._gpuTimeSamplers.get(t).record(i),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool!=null){const r=this._gpuTimerPool.stop(di.FINISH);this._gpuTimeSamplers.get(di.FINISH).record(r)}const t=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+t,this._totalCPUTime.record(t),this._gpuTimerPool!=null&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((r,i)=>r+(i.last||0),0)),++this._totalFrameCount}}let fl=class extends xe{get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeature(e=null,t=!ne("disable-feature:high-quality-idle")){this._renderStateFeatures=SJ(t,e),this.notifyChange("_renderStateFeatures"),this._requestRender()}isFeatureEnabled(e,t=this._state){return this._renderStateFeatures?.get(t,e)??!1}setFeatureEnabled(e,t,r){this._renderStateFeatures?.set(t,e,r),this.notifyChange("_renderStateFeatures"),this._requestRender()}get _antialiasing(){return this._antialiasingEnabled||this.isFeatureEnabled(Fs.Antialiasing)}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(Fs.HighQualityTransparency)}get hasReflections(){return this.hasWater&&(this._ssrEnabled||this.isFeatureEnabled(Fs.WaterReflection))}get hasWater(){return this._hasWater||this._hasOverlayWater}constructor(e,t,r,i,s,n,o,a){super({}),this._stage=e,this._materialRepository=t,this._techniqueRepository=i,this._rctx=s,this._compositingHelper=n,this._magnifierHelper=o,this._requestRender=a,this._materialRenderers=new Mt,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._renderOverlay=l=>{},this._isRendering=!1,this._fallbackDepthStencilTexture=null,this._sliceHelper=new wat,this._state=Er.IDLE,this._renderStateFeatures=null,this._antialiasingEnabled=!0,this._highQualityTransparencyEnabled=!0,this._terrainRenderingEnabled=!0,this._terrainTransparency=cn.Opaque,this._ssrEnabled=!1,this._ssaoEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new $ot,this._handles=new gi,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this.updateRenderFeature(e.view.qualityProfile),this._smaaPass=new ZE(this._rctx,i),a(),this._offscreen=new Qot(this._rctx,this._compositingHelper),this.performanceInfo=new hlt(this._rctx),this._shadowMap=new XH(this._rctx,e.viewingMode),this._ssaoHelper=new Qye(e.view,i,this._rctx,a),this._highlight=new Zot(i,this._rctx),this._shadowHighlight=new bat(this._rctx,e.viewingMode),this._shadowAccumulator=new Ua(this._rctx,i,e,l=>{const c=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(l.camera,l.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=c},(l,c,u)=>{l.shadowMap.start(l.camera,c,u,!0,this._stage.view.qualitySettings.maximumPixelRatio),this._renderShadowCascades(D.Shadow,l.shadowMap),l.camera.setGLViewport(this._rctx),this._prepare(l.camera,l.contentCamera)},a),this._renderContext=new CHe(this._rctx,this._offscreen,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new XE({renderContext:this._renderContext,techniqueRepository:i,textureRepository:r,materialRepository:this._materialRepository,requestRender:a,controller:e}),this.renderPassManager=new Iot(this._rctx,this._techniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([le(()=>this._stage.view.state.camera,()=>a(),_s),le(()=>Kr.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,l=>{this._renderHiddenTransparentEdges=l?()=>this._renderEdges(Lt.TRANSPARENT):()=>{},a()},Rr),le(()=>this._ssaoEnabled||this.isFeatureEnabled(Fs.SSAO),l=>this._ssaoHelper.enabled=l,_s)])}normalizeCtorArgs(){return{}}destroy(){this._handles.destroy(),this._smaaPass.dispose(),this._gpuTimerHandle=xi(this._gpuTimerHandle),this._materialRenderers.forAll(e=>e.dispose()),this._materialRenderers.clear(),this._offscreen.dispose(),this._fallbackDepthStencilTexture=De(this._fallbackDepthStencilTexture),this._shadowMap.dispose(),this._ssaoHelper.destroy(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),this._edgeView=Re(this._edgeView),this.renderPassManager.destroy(),HN.prune()}disposeOffscreenBuffers(){this._offscreen.dispose(),this._shadowMap.disposeOffscreenBuffers(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing&&this._smaaPass.updating||this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._renderPlugins.updating||!this.isCameraFinal}ensureEdgeView(){if(this._edgeView==null){const e=this._stage.view.resourceController;this._edgeView=new Nh({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._techniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:dlt(e)}),this._handles.add(le(()=>Lu(this._edgeView,t=>t.updating),()=>this._requestRender(),Vr)),this._requestRender()}return this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return wG(this._bindParameters.ssr.reprojectionMatrix,Ks)}set _reprojectionMatrix(e){$V(this._bindParameters.ssr.reprojectionMatrix,e)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){return!!this._shadowMap?.enabled}setParameters(e){const{_shadowMap:t,_bindParameters:r}=this;if(e.qualitySettings?.reflections!==void 0&&this._ssrEnabled!==e.qualitySettings.reflections&&(this._ssrEnabled=e.qualitySettings.reflections,this._requestRender()),e.qualitySettings?.ambientOcclusion!==void 0&&this._ssaoEnabled!==e.qualitySettings.ambientOcclusion&&(this._ssaoEnabled=e.qualitySettings.ambientOcclusion,this._requestRender()),e.shadowMap!==void 0&&this._shadowMap.enabled!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&t.maxCascades!==e.shadowMapMaxCascades&&(t.maxCascades=e.shadowMapMaxCascades,this._requestRender()),e.environment!=null){e.environment.weather!=null&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=!!e.weatherVisible);const i=e.environment.lighting.type!=="virtual";r.enableFillLights!==i&&(r.enableFillLights=i,this._requestRender())}e.background&&this._offscreen.background!==e.background&&(this._offscreen.background=e.background,this._requestRender()),e.antialiasingEnabled!==void 0&&this._antialiasingEnabled!==e.antialiasingEnabled&&(this._antialiasingEnabled=e.antialiasingEnabled,this._requestRender()),e.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==e.highQualityTransparency&&(this._highQualityTransparencyEnabled=e.highQualityTransparency,this._requestRender()),e.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(e.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(e.defaultHighlightOptions),this._requestRender()),e.overlays!==void 0&&this._bindParameters.overlays!==e.overlays&&(this._bindParameters.overlays=e.overlays,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.renderOverlay!==void 0&&this._renderOverlay!==e.renderOverlay&&(this._renderOverlay=e.renderOverlay,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.terrainRenderingEnabled!==void 0&&this._terrainRenderingEnabled!==e.terrainRenderingEnabled&&(this._terrainRenderingEnabled=e.terrainRenderingEnabled,this._requestRender()),e.terrainTransparency!==void 0&&this._terrainTransparency!==e.terrainTransparency&&(this._terrainTransparency=e.terrainTransparency,this._requestRender()),e.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(e.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(e,t){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:r,removes:i,updates:s}=e;if(r.length===0&&i.length===0&&s.length===0)return;const n=Bye(e);let o=!1;n.forEach((a,l)=>{if(t.done)return;let c=this._materialRenderers.find(u=>u.material===l);c==null&&a.adds.length>0&&(c=new Yye(this._rctx,this._materialRepository,l),this._materialRenderers.push(c)),c&&(c.modify(a),c.isEmpty&&(o=!0)),a.removes.forEach(u=>e.removes.removeUnordered(u)),a.adds.forEach(u=>e.adds.removeUnordered(u)),a.updates.forEach(u=>e.updates.removeUnordered(u)),t.madeProgress()}),o&&this._materialRenderers.filterInPlace(a=>!a.isEmpty||(a.dispose(),!1)),this._hasHighlights=this._materialRenderers.some(a=>a.hasHighlights),this._bindParameters.hasOccludees=this._materialRenderers.some(a=>a.hasOccludees),this._hasWater=this._materialRenderers.some(a=>a.hasWater),this._hasHUDElements=this._materialRenderers.some(a=>a.requiresSlot(ae.LINE_CALLOUTS_HUD_DEPTH,D.Color)||a.requiresSlot(ae.HUD_MATERIAL,D.Color)||a.requiresSlot(ae.LABEL_MATERIAL,D.Color)),this._requestRender()}updateAnimation(e){const t=this._hasAnimations;return this._hasAnimations=!1,this._materialRenderers.forAll(r=>this._hasAnimations=r.updateAnimation(e)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(e)||this._hasAnimations,this._hasAnimations!==t&&(this._gpuTimerHandle=t?xi(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}render(e,t,r,i,s){this._isRendering=!0,this._oitUsed=!1,this.performanceInfo.startFrame();const{camera:n,contentCamera:o,mode:a,alignPixelEnabled:l}=r;this._state=a,this._renderOverlay(s),this.performanceInfo.advance(di.OVERLAY),this._renderContext.time=s,this._bindParameters.transparencyPassType=tt.NONE,this._bindParameters.alignPixelEnabled=l;const c=this._offscreen;c.setupRenderTarget(this.hasReflections);const u=Xm(this._sliceHelper.plane);i===S1.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),n.setGLViewport(this._rctx),this._prepare(n,o),this._renderPlugins.prepareRender(),this.performanceInfo.advance(di.PREPARE);const d=this._computeDepthRange(n);this._renderShadowMap(e,n,this._bindParameters.lighting.mainLight.direction,d),this.performanceInfo.advance(di.SHADOW_MAP),c.initializeFrame(n),this._ensureBindParameters(n,o);const p=this._terrainRenderingEnabled&&(this._terrainTransparency===cn.Semitransparent||this._terrainTransparency===cn.TransparentWithDraped),g=this._highQualityTransparency&&p,y=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;this._prepareShaders(g,y),this._renderLinearDepth(),this.performanceInfo.advance(di.LINEAR_DEPTH),this._accumulateShadows(d,n,o),this.performanceInfo.advance(di.ACCUMULATED_SHADOWS),this._renderNormal(),this.performanceInfo.advance(di.NORMALS),this._ensureBindParametersSSR(s),this._renderSSAO(s),this.performanceInfo.advance(di.SSAO),this._renderContext.output=D.Color,c.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(di.OPAQUE),this._renderTerrainLinearDepth(g),this._setMultipassTerrain(g),this._renderEdges(Lt.OPAQUE),this.performanceInfo.advance(di.OPAQUE_EDGES),this._offscreen.bindTarget(this._offscreen.currentColorTarget,this._offscreen.mainDepth),this._renderSlot(ae.VOXEL),this.performanceInfo.advance(di.VOXEL),this._renderHiddenTransparentEdges(),y&&(this._oitEnabled?this._renderOITPass(vx.Geometry):this._renderTransparentGeometry()),this.performanceInfo.advance(di.TRANSPARENT),this._renderGeometryLinearDepth(g);const _=this._renderHUDVisibility(g);g||this._renderInternalSlot(ae.LINE_CALLOUTS),this.performanceInfo.advance(di.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(t),this.performanceInfo.advance(di.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(Lt.TRANSPARENT,g),this.performanceInfo.advance(di.TRANSPARENT_EDGES),this._renderTransparentTerrain(),p&&_&&(g?this._renderLineCallouts(vl.Occluded):c.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(vl.Occluded,c.framebuffer),this.performanceInfo.advance(di.HUD_OCCLUDED)),this.performanceInfo.advance(di.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),p&&(c.compositeTransparentTerrainOntoMain(this._bindParameters),g&&(this._renderEdges(Lt.OPAQUE),this.performanceInfo.advance(di.OPAQUE_EDGES),y&&(this._oitEnabled?this._renderOITPass(vx.Geometry):this._renderTransparentGeometry()),this.performanceInfo.advance(di.TRANSPARENT),this._renderEdges(Lt.TRANSPARENT),this.performanceInfo.advance(di.TRANSPARENT_EDGES))),g&&this._renderLineCallouts(vl.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),c.renderToTargets(()=>{this._renderInternalSlot(ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(ae.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(ae.LASERLINES)},c.currentColorTarget,c.mainDepth),this.performanceInfo.advance(di.ENVIRONMENT),this._renderPlugins.needsLaserlineWithContrastControl&&c.renderTmpAndCompositeToMain(()=>this._renderSlot(ae.LASERLINES_CONTRAST_CONTROL),this._bindParameters,Vo.PremultipliedAlpha),this.performanceInfo.advance(di.LASER_LINE),this._renderOccluded(),this.performanceInfo.advance(di.OCCLUDED);const v=i===S1.ON&&this._magnifierHelper.enabled,w=v&&e==null?this._offscreen.getFramebuffer(this._offscreen.tmpColor,this._offscreen.tmpDepth):e;this._rctx.bindFramebuffer(w);const T=this._offscreen.colorTexture;this._renderAntiAliasing(T)||T==null||this._compositingHelper.composite(this._bindParameters,T,Vo.None),this.performanceInfo.advance(di.ANTIALIASING),this._renderHUD(vl.NotOccluded,w),this.performanceInfo.advance(di.HUD),this._renderHighlights(w,this._bindParameters),this.performanceInfo.advance(di.HIGHLIGHTS),v&&this._magnifierHelper.render(this._rctx,this._bindParameters),w!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreen.tmpColorTexture,Vo.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=u,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.finishFrame()}_prepareShaders(e,t){this._renderContext.output=D.Color,this._prepareOpaqueGeometrySlots(),this._setMultipassTerrain(e),this._prepareSlots(ae.TRANSPARENT_TERRAIN),this._setMultipassTerrain(!1),e||this._prepareInternalSlots(this._materialRenderers,ae.LINE_CALLOUTS),t&&this._prepareTransparencySlots(),this._prepareInternalSlots(this._materialRenderers,ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._prepareSlots(ae.POSTPROCESSING_ENVIRONMENT_TRANSPARENT,ae.LASERLINES),this._rctx.gl.flush()}_renderObjectAndLayerIdColor(e){if(e!=null&&ne("enable-feature:objectAndLayerId-rendering")){const t=this._renderContext.output;this._rctx.bindFramebuffer(e),this._offscreen.renderToFBO(()=>this._renderGeometryAndTransparentTerrainPass(D.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(e),this._offscreen.renderToFBO(()=>{this._bindParameters.renderTransparentlyOccludedHUD=vl.NotOccluded,this._renderInternalSlot(ae.HUD_MATERIAL)},void 0,!0,!0),this._renderContext.output=t}}finish(e){this._hasAnimations||this._animationTimestep.clear();const t=this.performanceInfo.gpuSamplingEnabled,r=e===ns.BACKGROUND;if(r||t){const i=r?this.performanceInfo.elapsedTime:0,s=t?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),n=Math.max(i,s);this._animationTimestep.frame(n,r)}}readDepthPixels(e,t,r){const i=this._offscreen.bindTarget(this._offscreen.linearDepth,this._offscreen.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(e,e),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const s=fi.COLOR_BUFFER_BIT|fi.DEPTH_BUFFER_BIT|fi.STENCIL_BUFFER_BIT;this._rctx.clearSafe(s),this._renderGeometryAndTransparentTerrainPass(D.Depth)}i.readPixels(t[0],t[1],t[2],t[3],vt.RGBA,Is.UNSIGNED_BYTE,r)}readHUDVisibility(e,t,r,i,s){this._offscreen.bindTarget(this._offscreen.hudVisibility).readPixels(e,t,r,i,vt.RGBA,Is.UNSIGNED_BYTE,s)}readAccumulatedShadow(e){return this._shadowAccumulator.readAccumulatedShadow(e[0],e[1])}_setMultipassTerrain(e){this._setMultipassEnabled(e),this._setTerrainCulling(e)}_setMultipassEnabled(e){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_prepareSlots(...e){this._renderPlugins.prepareSlots(e)}_renderSlot(e){this._bindParameters.slot=e,this._renderPlugins.render()}_renderEdges(e,t=!1){const r=this._edgeView;r!=null&&r.shouldRender()&&this._offscreen.renderTmpAndCompositeToMain(()=>r.render(this._bindParameters,e),this._bindParameters,Vo.Alpha,t)}_renderShadowMap(e,t,r,i){const s=this._shadowMap;s.enabled&&(s.start(t,r,i,this.isFeatureEnabled(Fs.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._shadowHighlight.updateParameters(t,r),this._needsShadowHighlight?(this._renderShadowCascades(D.ShadowHighlight,this._shadowMap,n=>s.takeCascadeSnapshotTo(n,ZT.Highlight)),s.clear(),this._renderShadowCascades(D.ShadowExcludeHighlight,this._shadowMap,n=>{s.takeCascadeSnapshotTo(n,ZT.Default),this._renderGeometryAndTransparentTerrainPass(D.ShadowHighlight)})):this._renderShadowCascades(D.Shadow),s.finish(e),t.setGLViewport(this._rctx))}_renderShadowCascades(e,t=this._shadowMap,r=i=>{}){for(const i of t.cascades)i.camera.setGLViewport(this._rctx),this._prepare(i.camera,i.camera),this._renderGeometryAndTransparentTerrainPass(e),r(i)}get _needsLinearDepth(){return this._ssaoHelper.active||this._renderPlugins.needsLinearDepth||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreen.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(D.Depth),this._offscreen.linearDepth,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.linearDepth),this._bindParameters.linearDepthTexture=this._offscreen.linearDepthTexture}_renderTerrainLinearDepth(e){if(e){const t=this._renderContext.output;this._renderContext.output=D.Depth,this._offscreen.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreen.terrainLinearDepth,this._offscreen.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.output=t}else this._offscreen.disposeTarget(this._offscreen.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreen.terrainLinearDepthTexture}_renderGeometryLinearDepth(e){if(e){const t=this._renderContext.output;this._offscreen.renderToTargets(()=>this._renderGeometryPass(D.Depth),this._offscreen.geometryLinearDepth,this._offscreen.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.output=t}else this._offscreen.disposeTarget(this._offscreen.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreen.geometryLinearDepthTexture}get _needsNormal(){return this._ssaoHelper.active}_renderNormal(){this._needsNormal?this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(D.Normal)},this._offscreen.normal,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.normal)}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(e){if(!this._needsDepthRange)return jB;const t=mot(e,this._materialRenderers,this._stage.layers);return e2(t,this.renderPlugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t}_renderGeometryAndTransparentTerrainPass(e){this._renderContext.output=e,this._prepareSlots(ae.TRANSPARENT_TERRAIN),this._renderGeometryPass(e),this._renderTransparentTerrain()}_renderGeometryPass(e){this._renderContext.output=e,this._prepareSlots(ae.TRANSPARENT_MATERIAL),this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderSSAO(e){this._ssaoHelper.render(this._bindParameters,e,this._offscreen.linearDepthTexture,this._offscreen.normalTexture)}_prepareOpaqueGeometrySlots(){this._prepareSlots(ae.INTEGRATED_MESH,ae.OPAQUE_TERRAIN,ae.OPAQUE_MATERIAL,ae.POSTPROCESSING_ENVIRONMENT_OPAQUE),this._prepareInternalSlots(this._materialRenderers,ae.OPAQUE_MATERIAL)}_renderOpaqueGeometry(){this._renderSlot(ae.INTEGRATED_MESH),this._renderSlot(ae.OPAQUE_TERRAIN),this._renderInternalSlot(ae.OPAQUE_MATERIAL),this._renderSlot(ae.OPAQUE_MATERIAL),this._renderSlot(ae.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(ae.TRANSPARENT_MATERIAL),this._renderSlot(ae.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(ae.TRANSPARENT_TERRAIN)}_renderHUDVisibility(e){let t=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,t=this._renderInternalSlot(ae.OCCLUSION_PIXELS)},e),t}_renderLineCallouts(e){this._bindParameters.renderTransparentlyOccludedHUD=e,e===vl.Occluded?this._offscreen.renderToTargets(()=>this._renderInternalSlot(ae.LINE_CALLOUTS),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderInternalSlot(ae.LINE_CALLOUTS)}_renderHUD(e,t){this._hasHUDElements&&(this._oitEnabled?(this._renderOITPass(vx.HUD,e),this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._bindParameters,this._offscreen.hudColorTexture,Vo.PremultipliedAlpha)):e===vl.Occluded?this._offscreen.renderToTargets(()=>this._renderHUDElements(vl.Occluded),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderHUDElements(e))}_renderHUDElements(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._prepareInternalSlots(this._materialRenderers,ae.LINE_CALLOUTS_HUD_DEPTH,ae.HUD_MATERIAL,ae.LABEL_MATERIAL),this._renderInternalSlot(ae.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(ae.HUD_MATERIAL),this._renderInternalSlot(ae.LABEL_MATERIAL)}get _needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this._needsHighlight}_renderHighlights(e,t){if(!this._needsHighlight)return void this._offscreen.disposeTarget(this._offscreen.highlight);const r=this._highlight,i=this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(D.Highlight),this._rctx.clearSafe(fi.DEPTH_BUFFER_BIT),this._renderHUDElements(vl.Both)},this._offscreen.highlight,this._offscreen.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=i.colorTexture,this._needsShadowHighlight&&this._shadowHighlight.render(t,e),r.render(this._bindParameters,i,e)}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(e,t,r){this._needsShadowCast&&this._offscreen.linearDepthTexture!=null&&this._shadowAccumulator.renderAccumulation(this._offscreen.linearDepthTexture,e,t,r)}_prepareTransparencySlots(){this._renderContext.output=D.Alpha,this._bindParameters.transparencyPassType=tt.Alpha,this._prepareInternalSlots(this._materialRenderers,ae.TRANSPARENT_MATERIAL),this._prepareSlots(ae.TRANSPARENT_MATERIAL),this._renderContext.output=D.Color,this._bindParameters.transparencyPassType=tt.Color,this._prepareInternalSlots(this._materialRenderers,ae.TRANSPARENT_MATERIAL),this._prepareSlots(ae.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=tt.FrontFace,this._prepareInternalSlots(this._materialRenderers,ae.TRANSPARENT_MATERIAL),this._prepareSlots(ae.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=tt.NONE}_renderOITPass(e,t=vl.Both){const r=e===vx.HUD,i=r?()=>this._renderHUDElements(t):()=>this._renderTransparentGeometry(),s=o=>{this._bindParameters.transparencyPassType=o,this._offscreen.renderOITPass(i,o,r)},n=this._renderContext.output;this._renderContext.output=D.Alpha,s(tt.Alpha),this._renderContext.output=D.Color,s(tt.Color),s(tt.FrontFace),this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,r),this._bindParameters.transparencyPassType=tt.NONE,this._renderContext.output=n,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreen.disposeTarget(this._offscreen.alphaFloatTarget),this._offscreen.disposeTarget(this._offscreen.colorFloatTarget),this._offscreen.disposeTarget(this._offscreen.frontFaceTarget))}_renderOccluded(){let e=0;tc.clear(),this._materialRenderers.forAll(n=>{n.material&&n.material.isVisible()&&n.material.renderOccluded===Ei.OccludeAndTransparentStencil&&(e|=n.material.renderOccluded,tc.push(n))});const t=this._offscreen,r=(n,o,a,l,c)=>{(e&o)!=0&&(t.renderToTargets(a,t.tmpColor,t.mainDepth,[0,0,0,0],l,c),t.compositeOccludedOntoMain(this._bindParameters,n))};tc.length!==0&&(this._prepareInternalSlots(tc,ae.OCCLUDER_MATERIAL,ae.TRANSPARENT_OCCLUDER_MATERIAL),this._renderInternalSlot(ae.OCCLUDER_MATERIAL,tc),r(.5,Ei.OccludeAndTransparentStencil,()=>this._renderInternalSlot(ae.TRANSPARENT_OCCLUDER_MATERIAL,tc),!1,!1)),tc.clear(),this._materialRenderers.forAll(n=>{n.material&&n.material.isVisible()&&(n.material.renderOccluded===Ei.OccludeAndTransparent||n.material.renderOccluded===Ei.Transparent||n.material.renderOccluded===Ei.Opaque)&&(e|=n.material.renderOccluded,tc.push(n))});const i=this._renderPlugins.renderOccludedFlags;if(e|=i,!e)return;const s=n=>{this._renderContext.renderOccludedMask=n,this._prepareInternalSlots(tc,ae.OPAQUE_MATERIAL,ae.TRANSPARENT_MATERIAL,ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),i>Ei.Occlude&&this._renderSlot(ae.OCCLUDED_TERRAIN),this._renderInternalSlot(ae.OPAQUE_MATERIAL,tc),this._renderInternalSlot(ae.TRANSPARENT_MATERIAL,tc),this._renderInternalSlot(ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,tc),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=D.Color,r(.5,Ei.OccludeAndTransparent,()=>s(Ei.OccludeAndTransparent),!0,Za.OutlineVisualElementMask),r(.5,Ei.Transparent,()=>s(Ei.Transparent),!0,Za.OutlineVisualElementMask),r(1,Ei.Opaque,()=>s(Ei.Opaque),!0,Za.OutlineVisualElementMask),tc.clear()}_renderAntiAliasing(e){if(this._antialiasing){if(this._smaaPass.enable(()=>this._requestRender())&&e!=null)return this._smaaPass.render(e),!0}else this._smaaPass.disable();return!1}_prepare(e,t){this._needsTransparentPass=this._materialRenderers.some(r=>r.requiresSlot(ae.TRANSPARENT_MATERIAL,D.Color)),this._bindParameters.camera=e,this._bindParameters.contentCamera=t}_ensureBindParameters(e,t){this._bindParameters.camera=e,this._bindParameters.contentCamera=t;const r=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=r.hudVisibilityTexture,this._bindParameters.mainColorTexture=r.mainColorTexture,this._bindParameters.highlightDepthTexture=r.depthTexture??this._getFallbackDepthTexture()}_ensureBindParametersSSR(e){if(this._bindParameters.ssr.enabled=this.hasReflections,this._bindParameters.ssr.enabled){this._ssrEnableTime==null&&(this._ssrEnableTime=e),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Ks:(Fn(Lse,this._bindParameters.camera.viewMatrix),Fn($se,this._bindParameters.camera.projectionMatrix),Jr(gw,Lse,$se),Jr(gw,this._renderContext.lastFrameCamera.viewMatrix,gw),Jr(gw,this._renderContext.lastFrameCamera.projectionMatrix,gw),this._reprojectionMatrix=gw),this._bindParameters.ssr.lastFrameColorTexture=this._offscreen.lastFrameColorTexture;const t=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=t>0?Math.min(t,e-this._ssrEnableTime)/t:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=Ks,this._bindParameters.ssr.lastFrameColorTexture=null,this._ssrEnableTime=null}_prepareInternalSlots(e,...t){for(const r of t)this._bindParameters.slot=r,e.forAll(i=>{i.material.shouldRender(this._renderContext)&&i.prepareTechnique(this._renderContext)})}_renderInternalSlot(e,t=this._materialRenderers){let r=!1;return this._bindParameters.slot=e,t.forAll(i=>{if(i.material.shouldRender(this._renderContext)){const s=i.prepareTechnique(this._renderContext);s!=null&&(i.render(this._renderContext,s),r=!0)}}),r}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=lfe(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){return{offscreen:this._offscreen?.gpuMemoryUsage??0,highlights:(this._highlight?.gpuMemoryUsage??0)+(this._shadowHighlight?.gpuMemoryUsage??0),shadows:this._shadowMap?.gpuMemoryUsage??0,ssao:this._ssaoHelper?.gpuMemoryUsage??0}}get test(){const e=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{e._renderStateFeatures=SJ()},getFramebufferTexture:t=>{switch(t){case E0.Color:return e._offscreen.colorTexture;case E0.LinearDepth:return e._offscreen.linearDepthTexture;case E0.Normals:return e._offscreen.normalTexture;case E0.ShadowMap:return e._shadowMap.depthTexture;case E0.HudVisibility:return e._offscreen.hudVisibilityTexture;case E0.Highlight:return e._offscreen.highlightTexture}}}}};var vx,E0;h([f()],fl.prototype,"_renderPlugins",void 0),h([f()],fl.prototype,"_shadowAccumulator",void 0),h([f()],fl.prototype,"_state",void 0),h([f()],fl.prototype,"_renderStateFeatures",void 0),h([f()],fl.prototype,"_antialiasingEnabled",void 0),h([f({readOnly:!0})],fl.prototype,"_antialiasing",null),h([f()],fl.prototype,"_ssaoEnabled",void 0),h([f()],fl.prototype,"_smaaPass",void 0),h([f({autoDestroy:!0})],fl.prototype,"_edgeView",void 0),h([f()],fl.prototype,"updating",null),h([f()],fl.prototype,"isCameraFinal",null),fl=h([F("esri.views.3d.webgl-engine.lib.Renderer")],fl),function(e){e[e.Geometry=0]="Geometry",e[e.HUD=1]="HUD"}(vx||(vx={})),function(e){e[e.Color=0]="Color",e[e.LinearDepth=1]="LinearDepth",e[e.Normals=2]="Normals",e[e.ShadowMap=3]="ShadowMap",e[e.HudVisibility=4]="HudVisibility",e[e.Highlight=5]="Highlight"}(E0||(E0={}));const tc=new Mt,$se=be(),Lse=be(),gw=be();function dlt(e){return t=>e.immediate.schedule(t)}class O5{constructor(t){this._rctx=t,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const t=O5.getShaderSources();return this._rctx.programCache.acquire(t.vertex,t.fragment,new Map([]))}_createIndexbuffer(){return rr.createIndex(this._rctx,gr.STATIC_DRAW,new Uint32Array([0]))}resetIndicesType(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,gt.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(bt.POINTS,1,Ze.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}}class Dse{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:ve.ONE,dstRGB:ve.ZERO,srcAlpha:ve.ONE,dstAlpha:ve.ZERO},this.blendEquation={mode:Jp.ADD,modeAlpha:Jp.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=sd.BACK,this.frontFace=ET.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Hr.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:sd.FRONT_AND_BACK,func:Hr.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:sd.FRONT_AND_BACK,fail:as.KEEP,zFail:as.KEEP,zPass:as.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}}class plt{constructor(t){this._allocations=new Map,t?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(t){this._allocations.set(t,new Error().stack)}remove(t){this._allocations.delete(t)}get information(){let t="";if(this._allocations.size>0){t+=`${this._allocations.size} live object allocations:
`;const r=new Map;this._allocations.forEach(i=>{r.set(i,(r.get(i)??0)+1)}),r.forEach((i,s)=>{const n=s.split(`
`);n.shift(),n.shift(),t+=`${i}: ${n.shift()}
`,n.forEach(o=>t+=`   ${o}
`)})}return t}}const flt={RECORD_ALLOCATIONS:!1};class mlt{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new plt(flt.RECORD_ALLOCATIONS);this._current.length<mn.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(t,r){const i=++this._current[t];this._max[t]=Math.max(i,this._max[t]),this._allocations.add(r)}decrement(t,r){--this._current[t],this._allocations.remove(r)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((t,r)=>t+r,0)}get resourceInformation(){let t="";if(this.total>0){t+=`Live objects:
`;for(let r=0;r<mn.COUNT;++r){const i=this._current[r];i>0&&(t+=`${mn[r]}: ${i}
`)}}return t+=this._allocations.information,t}}class glt{constructor(t,r,i){const s=r.textureFilterAnisotropic,n=i.maxAnisotropy??1/0;this.versionString=t.getParameter(t.VERSION),this.maxVertexTextureImageUnits=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=t.getParameter(t.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=s?Math.min(t.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY),n):1,this.maxTextureImageUnits=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=t.getParameter(t.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=t.getParameter(t.MAX_VIEWPORT_DIMS),Ad(t)?(this.maxUniformBufferBindings=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=t.getParameter(t.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=t.getParameter(t.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=t.getParameter(t.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=t.getParameter(t.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=t.getParameter(t.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=t.getParameter(t.MAX_SAMPLES)):(this.maxUniformBufferBindings=0,this.maxVertexUniformBlocks=0,this.maxFragmentUniformBlocks=0,this.maxUniformBlockSize=0,this.uniformBufferOffsetAlignment=1,this.maxArrayTextureLayers=1,this.maxSamples=1)}}const ylt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var Nse,J1e={exports:{}};(Nse=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(J1e.exports=Nse);const _lt=q3(J1e.exports);var Fse,QB={exports:{}};QB.exports,Fse=QB,function(e){var t=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];t!==void 0&&(Fse.exports=t)}();const Use=q3(QB.exports);var eV={exports:{}};eV.exports,function(e){(function(t){var r=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();r!==void 0&&(e.exports=r)})()}(eV);const vlt=q3(eV.exports);var xh=999,kse=9999,ZU=0,YU=1,zse=2,Bse=3,Vse=4,rM=5,blt=6,wlt=7,xlt=8,Gse=9,Tlt=10,jse=11,Slt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function Elt(){var e,t,r,i=0,s=0,n=xh,o=[],a=[],l=1,c=0,u=0,d=!1,p=!1,g="";return function(N){return a=[],N!==null?_(N.replace?N.replace(/\r\n/g,`
`):N):v()};function y(N){N.length&&a.push({type:Slt[n],data:N,position:u,line:l,column:c})}function _(N){var Z;for(i=0,r=(g+=N).length;e=g[i],i<r;){switch(Z=i,n){case ZU:i=O();break;case YU:i=S();break;case zse:i=x();break;case Bse:i=A();break;case Vse:i=U();break;case jse:i=P();break;case rM:i=I();break;case kse:i=L();break;case Gse:i=T();break;case xh:i=w()}Z!==i&&(g[Z]===`
`?(c=0,++l):++c)}return s+=i,g=g.slice(i),a}function v(N){return o.length&&y(o.join("")),n=Tlt,y("(eof)"),a}function w(){return o=o.length?[]:o,t==="/"&&e==="*"?(u=s+i-1,n=ZU,t=e,i+1):t==="/"&&e==="/"?(u=s+i-1,n=YU,t=e,i+1):e==="#"?(n=zse,u=s+i,i):/\s/.test(e)?(n=Gse,u=s+i,i):(d=/\d/.test(e),p=/[^\w_]/.test(e),u=s+i,n=d?Vse:p?Bse:kse,i)}function T(){return/[^\s]/g.test(e)?(y(o.join("")),n=xh,i):(o.push(e),t=e,i+1)}function x(){return e!=="\r"&&e!==`
`||t==="\\"?(o.push(e),t=e,i+1):(y(o.join("")),n=xh,i)}function S(){return x()}function O(){return e==="/"&&t==="*"?(o.push(e),y(o.join("")),n=xh,i+1):(o.push(e),t=e,i+1)}function A(){if(t==="."&&/\d/.test(e))return n=rM,i;if(t==="/"&&e==="*")return n=ZU,i;if(t==="/"&&e==="/")return n=YU,i;if(e==="."&&o.length){for(;$(o););return n=rM,i}if(e===";"||e===")"||e==="("){if(o.length)for(;$(o););return y(e),n=xh,i+1}var N=o.length===2&&e!=="=";if(/[\w_\d\s]/.test(e)||N){for(;$(o););return n=xh,i}return o.push(e),t=e,i+1}function $(N){for(var Z,W,V=0;;){if(Z=Use.indexOf(N.slice(0,N.length+V).join("")),W=Use[Z],Z===-1){if(V--+N.length>0)continue;W=N.slice(0,1).join("")}return y(W),u+=W.length,(o=o.slice(W.length)).length}}function P(){return/[^a-fA-F0-9]/.test(e)?(y(o.join("")),n=xh,i):(o.push(e),t=e,i+1)}function U(){return e==="."||/[eE]/.test(e)?(o.push(e),n=rM,t=e,i+1):e==="x"&&o.length===1&&o[0]==="0"?(n=jse,o.push(e),t=e,i+1):/[^\d]/.test(e)?(y(o.join("")),n=xh,i):(o.push(e),t=e,i+1)}function I(){return e==="f"&&(o.push(e),t=e,i+=1),/[eE]/.test(e)||e==="-"&&/[eE]/.test(t)?(o.push(e),t=e,i+1):/[^\d]/.test(e)?(y(o.join("")),n=xh,i):(o.push(e),t=e,i+1)}function L(){if(/[^\d\w_]/.test(e)){var N=o.join("");return n=_lt.indexOf(N)>-1?xlt:vlt.indexOf(N)>-1?wlt:blt,y(o.join("")),n=xh,i}return o.push(e),t=e,i+1}}function Clt(e){var t=Elt(),r=[];return r=(r=r.concat(t(e))).concat(t(null))}function Alt(e){return Clt(e)}function Olt(e){return e.map(t=>t.type!=="eof"?t.data:"").join("")}const JU=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function Rlt(e,t="100",r="300 es"){const i=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of e)if(s.type==="preprocessor"){const n=i.exec(s.data);if(n){const o=n[1].replaceAll(/\s\s+/g," ");if(o===r)return o;if(o===t)return s.data="#version "+r,t;throw new Error("unknown glsl version: "+o)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:`
`}),null}function Plt(e,t){for(let r=t-1;r>=0;r--){const i=e[r];if(i.type!=="whitespace"&&i.type!=="block-comment"){if(i.type!=="keyword")break;if(i.data==="attribute"||i.data==="in")return!0}}return!1}function YE(e,t,r,i){i=i||r;for(const s of e)if(s.type==="ident"&&s.data===r)return i in t?t[i]++:t[i]=0,YE(e,t,i+"_"+t[i],i);return r}function K1e(e,t,r="afterVersion"){function i(l,c){for(let u=c;u<l.length;u++){const d=l[u];if(d.type==="operator"&&d.data===";")return u}return null}function s(l){let c=-1,u=0,d=-1;for(let p=0;p<l.length;p++){const g=l[p];if(g.type==="preprocessor"&&(/\#(if|ifdef|ifndef)\s+.+/.test(g.data)?++u:/\#endif\s*.*/.test(g.data)&&--u),r!=="afterVersion"&&r!=="afterPrecision"||g.type==="preprocessor"&&/^#version/.test(g.data)&&(d=Math.max(d,p)),r==="afterPrecision"&&g.type==="keyword"&&g.data==="precision"){const y=i(l,p);if(y===null)throw new Error("precision statement not followed by any semicolons!");d=Math.max(d,y)}c<d&&u===0&&(c=p)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<e.length&&/[^\r\n]$/.test(e[l].data);let a=s(e);o(a-1)&&e.splice(a++,0,n);for(const l of t)e.splice(a++,0,l);o(a-1)&&o(a)&&e.splice(a,0,n)}function Mlt(e,t,r,i="lowp"){K1e(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function Ilt(e,t,r,i,s="lowp"){K1e(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function $lt(e,t){let r,i,s=-1;for(let n=t;n<e.length;n++){const o=e[n];if(o.type==="operator"&&(o.data==="["&&(r=n),o.data==="]")){i=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return r&&i&&e.splice(r,i-r+1),s}function Hse(e,t){if(e.startsWith("#version 300"))return e;const r=Alt(e);if(Rlt(r,"100","300 es")==="300 es")return e;let i=null,s=null;const n={},o={};for(let a=0;a<r.length;++a){const l=r[a];switch(l.type){case"keyword":t===yc.VERTEX_SHADER&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=t===yc.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),t===yc.FRAGMENT_SHADER&&l.data==="gl_FragColor"&&(i||(i=YE(r,n,"fragColor"),Mlt(r,i,"vec4")),l.data=i),t===yc.FRAGMENT_SHADER&&l.data==="gl_FragData"){const c=$lt(r,a+1),u=YE(r,n,"fragData");Ilt(r,u,"vec4",c,"mediump"),l.data=u}else t===yc.FRAGMENT_SHADER&&l.data==="gl_FragDepthEXT"&&(s||(s=YE(r,n,"gl_FragDepth")),l.data=s);break;case"ident":if(ylt.includes(l.data)){if(t===yc.VERTEX_SHADER&&Plt(r,a))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in o||(o[l.data]=YE(r,n,l.data)),l.data=o[l.data]}}}for(let a=r.length-1;a>=0;--a){const l=r[a];if(l.type==="preprocessor"){const c=l.data.match(/\#extension\s+(.*)\:/);if(c&&c[1]&&JU.includes(c[1].trim())){const p=r[a+1];r.splice(a,p&&p.type==="whitespace"?2:1)}const u=l.data.match(/\#ifdef\s+(.*)/);u&&u[1]&&JU.includes(u[1].trim())&&(l.data="#if 1");const d=l.data.match(/\#ifndef\s+(.*)/);d&&d[1]&&JU.includes(d[1].trim())&&(l.data="#if 0")}}return Llt(e,Olt(r))}function Llt(e,t){return t}const Dlt=4294967295;class Nlt{constructor(t,r,i,s,n=new Map){this._context=t,this._locations=s,this._uniformBlockBindings=n,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,t||console.error("RenderingContext isn't initialized!"),r.length===0&&console.error("Shaders source should not be empty!"),this._context.type===tr.WEBGL2&&(r=Hse(r,yc.VERTEX_SHADER),i=Hse(i,yc.FRAGMENT_SHADER)),this._vShader=Wse(this._context,yc.VERTEX_SHADER,r),this._fShader=Wse(this._context,yc.FRAGMENT_SHADER,i),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(mn.Shader,this),gz()&&(this.vertexShader=r,this.fragmentShader=i);const o=this._context.gl,a=o.createProgram();if(o.attachShader(a,this._vShader),o.attachShader(a,this._fShader),this._locations.forEach((l,c)=>o.bindAttribLocation(a,l,c)),o.linkProgram(a),gz()&&!o.getProgramParameter(a,o.LINK_STATUS)&&console.error(`Could not link shader
validated: ${o.getProgramParameter(a,o.VALIDATE_STATUS)}, gl error ${o.getError()}, vertex: ${o.getShaderParameter(this._vShader,o.COMPILE_STATUS)}, fragment: ${o.getShaderParameter(this._fShader,o.COMPILE_STATUS)}, info log: ${o.getProgramInfoLog(a)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===tr.WEBGL2){const l=o;for(const[c,u]of this._uniformBlockBindings){const d=l.getUniformBlockIndex(a,c);d<Dlt&&l.uniformBlockBinding(a,d,u)}}this._glName=a,this._context.instanceCounter.increment(mn.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get compiled(){if(this._compiled)return!0;const t=this._context.gl.getExtension("KHR_parallel_shader_compile");return t==null||this.glName==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,t.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const t=this._context.gl;this._vShader&&(t.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(mn.Shader,this)),this._fShader&&(t.deleteShader(this._fShader),this._fShader=null),this._glName&&(t.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(mn.Program,this))}ref(){++this._refCount}_getUniformLocation(t){return this._nameToUniformLocation[t]===void 0&&this.glName!=null&&(this._nameToUniformLocation[t]=this._context.gl.getUniformLocation(this.glName,t)),this._nameToUniformLocation[t]}hasUniform(t){return this._getUniformLocation(t)!==null}setUniform1i(t,r){const i=this._nameToUniform1[t];i!==void 0&&r===i||(this._context.gl.uniform1i(this._getUniformLocation(t),r),this._nameToUniform1[t]=r)}setUniform1iv(t,r){Zd(this._nameToUniform1v,t,r)&&this._context.gl.uniform1iv(this._getUniformLocation(t),r)}setUniform2iv(t,r){Zd(this._nameToUniform2,t,r)&&this._context.gl.uniform2iv(this._getUniformLocation(t),r)}setUniform3iv(t,r){Zd(this._nameToUniform3,t,r)&&this._context.gl.uniform3iv(this._getUniformLocation(t),r)}setUniform4iv(t,r){Zd(this._nameToUniform4,t,r)&&this._context.gl.uniform4iv(this._getUniformLocation(t),r)}setUniform1f(t,r){const i=this._nameToUniform1[t];i!==void 0&&r===i||(this._context.gl.uniform1f(this._getUniformLocation(t),r),this._nameToUniform1[t]=r)}setUniform1fv(t,r){Zd(this._nameToUniform1v,t,r)&&this._context.gl.uniform1fv(this._getUniformLocation(t),r)}setUniform2f(t,r,i){const s=this._nameToUniform2.get(t);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(t),r,i),this._nameToUniform2.set(t,[r,i])):r===s[0]&&i===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(t),r,i),s[0]=r,s[1]=i)}setUniform2fv(t,r){Zd(this._nameToUniform2,t,r)&&this._context.gl.uniform2fv(this._getUniformLocation(t),r)}setUniform3f(t,r,i,s){const n=this._nameToUniform3.get(t);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(t),r,i,s),this._nameToUniform3.set(t,[r,i,s])):r===n[0]&&i===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(t),r,i,s),n[0]=r,n[1]=i,n[2]=s)}setUniform3fv(t,r){Zd(this._nameToUniform3,t,r)&&this._context.gl.uniform3fv(this._getUniformLocation(t),r)}setUniform4f(t,r,i,s,n){const o=this._nameToUniform4.get(t);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(t),r,i,s,n),this._nameToUniform4.set(t,[r,i,s,n])):o!==void 0&&r===o[0]&&i===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(t),r,i,s,n),o[0]=r,o[1]=i,o[2]=s,o[3]=n)}setUniform4fv(t,r){Zd(this._nameToUniform4,t,r)&&this._context.gl.uniform4fv(this._getUniformLocation(t),r)}setUniformMatrix3fv(t,r,i=!1){Zd(this._nameToUniformMatrix3,t,r)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(t),i,r)}setUniformMatrix4fv(t,r,i=!1){Zd(this._nameToUniformMatrix4,t,r)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(t),i,r)}stop(){}}function Wse(e,t,r){const i=e.gl,s=i.createShader(t);return i.shaderSource(s,r),i.compileShader(s),gz()&&!i.getShaderParameter(s,i.COMPILE_STATUS)&&(console.error("Compile error in ".concat(t===yc.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(i.getShaderInfoLog(s)),console.error(Flt(r))),s}function Flt(e){let t=2;return e.replaceAll(`
`,()=>`
`+Ult(t++)+":")}function Ult(e){return e>=1e3?e.toString():("  "+e).slice(-3)}function Zd(e,t,r){const i=e.get(t);return i?$V(i,r):(e.set(t,Array.from(r)),!0)}class klt{constructor(t){this._rctx=t,this._store=new S2}dispose(){this._store.forEach(t=>t.forEach(r=>r.dispose())),this._store.clear()}acquire(t,r,i,s){const n=this._store.get(t,r);if(n!=null)return n.ref(),n;const o=new Nlt(this._rctx,t,r,i,s);return o.ref(),this._store.set(t,r,o),o}get test(){let t=0;return this._store.forEach(r=>r.forEach(i=>t+=i.hasGLName?2:1)),{cachedWebGLObjects:t}}}class fO{constructor(){this._result=!1}dispose(){this._program=De(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}}class zlt extends fO{constructor(t){super(),this._rctx=t,this._helperProgram=null,this._rctx.type===tr.WEBGL2&&ne("mac")&&ne("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose(),this._helperProgram?.dispose(),this._helperProgram=null}_test(t){const r=this._rctx;r.resetState();const i=new hr(1);i.wrapMode=Ct.CLAMP_TO_EDGE,i.samplingMode=xt.NEAREST;const s=new Bi(r,i),n=rr.createIndex(this._rctx,gr.STATIC_DRAW,new Uint8Array([0]));r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.useProgram(this._helperProgram),r.bindBuffer(n,gt.ELEMENT_ARRAY_BUFFER),r.drawElements(bt.POINTS,1,Ze.UNSIGNED_BYTE,0),r.useProgram(t),r.bindVAO(null),r.drawArrays(bt.TRIANGLES,0,258);const o=new Uint8Array(4);return s.readPixels(0,0,1,1,vt.RGBA,Is.UNSIGNED_BYTE,o),s.dispose(),n.dispose(),o[0]===255}_prepareProgram(){const r=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${b.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,i=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${b.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(r,i,new Map([]))}_prepareHelperProgram(){const t=O5.getShaderSources();return this._rctx.programCache.acquire(t.vertex,t.fragment,new Map([]))}}class Blt extends fO{constructor(t){super(),this._rctx=t,this._program=qse(this._rctx,!1),this._obfuscated=qse(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=De(this._obfuscated)}_test(t){if(ne("force-double-precision-obfuscation"))return!0;if(this._obfuscated==null)return!1;const r=this._runProgram(t),i=this._runProgram(this._obfuscated);return r!==0&&(i===0||r/i>5)}_runProgram(t){const r=this._rctx;r.resetState();const i=new hr(1);i.wrapMode=Ct.CLAMP_TO_EDGE,i.samplingMode=xt.NEAREST;const s=new Bi(r,i),n=rr.createVertex(r,gr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Ju(r,new Map([["position",0]]),{geometry:[new io("position",2,Ze.UNSIGNED_SHORT,0,4)]},{geometry:n}),a=Ce(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),l=Ce(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),c=new Float32Array(6);xz(a,c,3);const u=new Float32Array(6);xz(l,u,3),r.useProgram(t),t.setUniform3f("u_highA",c[0],c[2],c[4]),t.setUniform3f("u_lowA",c[1],c[3],c[5]),t.setUniform3f("u_highB",u[0],u[2],u[4]),t.setUniform3f("u_lowB",u[1],u[3],u[5]),r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(bt.TRIANGLE_STRIP,0,4);const d=new Uint8Array(4);s.readPixels(0,0,1,1,vt.RGBA,Is.UNSIGNED_BYTE,d),o.dispose(),s.dispose();const p=(a[2]-l[2])/25,g=gH(d);return Math.abs(p-g)}}function qse(e,t){const r=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,i=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `;return e.programCache.acquire(r,i,new Map([["position",0]]))}class Vlt extends fO{constructor(t){if(super(),this._rctx=t,!t.gl)return;if(t.type===tr.WEBGL1)return void(this._result=!(!t.capabilities.textureFloat?.textureFloat||!t.capabilities.colorBufferFloat?.textureFloat));if(!(t.capabilities.textureFloat?.textureFloat&&t.capabilities.colorBufferFloat?.textureFloat&&t.capabilities.colorBufferFloat?.floatBlend))return;const r=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=t.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(t){const r=this._rctx,i=new hr(1);i.wrapMode=Ct.CLAMP_TO_EDGE,i.dataType=Is.FLOAT,i.internalFormat=He.RGBA32F,i.samplingMode=xt.NEAREST;const s=new Bi(r,i),n=rr.createVertex(r,gr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Ju(r,new Map([["a_pos",0]]),{geometry:[new io("a_pos",2,Ze.UNSIGNED_SHORT,0,4)]},{geometry:n});r.useProgram(t);const a=r.getBoundFramebufferObject(),{x:l,y:c,width:u,height:d}=r.getViewport();r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(bt.TRIANGLE_STRIP,0,4);const p=Tt({blending:e0e});r.setPipelineState(p),r.drawArrays(bt.TRIANGLE_STRIP,0,4);const g=r.gl.getError();return r.setViewport(l,c,u,d),r.bindFramebuffer(a),o.dispose(),s.dispose(),g!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}}class Glt extends fO{constructor(t){super(),this._rctx=t;const r=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,i=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=t.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(t){const r=this._rctx,i=new hr(1);i.wrapMode=Ct.CLAMP_TO_EDGE,i.samplingMode=xt.NEAREST;const s=new Bi(r,i),n=new Uint8Array(4),o=rr.createVertex(r,gr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),a=new Ju(r,new Map([["a_position",0]]),{geometry:[new io("a_position",2,Ze.SHORT,0,4)]},{geometry:o});r.useProgram(t);const l=new wt(r,i,new Uint8Array([2,255,0,0]));t.setUniform1i("u_texture",0),r.bindTexture(l,0);const c=r.getBoundFramebufferObject();r.bindFramebuffer(s),r.useProgram(t);const{x:u,y:d,width:p,height:g}=r.getViewport();r.setViewport(0,0,1,1),r.bindVAO(a),r.drawArrays(bt.TRIANGLE_STRIP,0,4),r.setViewport(u,d,p,g),s.readPixels(0,0,1,1,vt.RGBA,Is.UNSIGNED_BYTE,n),a.dispose(),s.dispose();const y=n[0]!==255||n[1]!==255||n[2]!==255||n[3]!==255;return y&&K.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${n[0]}.${n[1]}.${n[2]}.${n[3]}]`),r.bindFramebuffer(c),y}}new io("a_pos",2,Ze.BYTE,0,2);new io("a_pos",2,Ze.BYTE,0,4),new io("a_tex",2,Ze.BYTE,2,4);const jlt={geometry:[new io("a_pos",2,Ze.UNSIGNED_SHORT,0,4)]};class Hlt extends fO{constructor(t){super(),this._rctx=t;const r=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=t.programCache.acquire(r,i,new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(t){const r=this._rctx;if(!r.gl)return t.dispose(),!0;const i=new hr(1);i.wrapMode=Ct.CLAMP_TO_EDGE,i.samplingMode=xt.NEAREST;const s=new Bi(r,i),n=rr.createVertex(r,gr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Ju(r,new Map([["a_pos",0]]),jlt,{geometry:n}),a=new hr;a.samplingMode=xt.LINEAR,a.wrapMode=Ct.CLAMP_TO_EDGE;const l=new wt(r,a,JE);r.useProgram(t),r.bindTexture(l,0),t.setUniform1i("u_texture",0);const c=r.getBoundFramebufferObject(),{x:u,y:d,width:p,height:g}=r.getViewport();r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.setClearColor(0,0,0,0),r.setBlendingEnabled(!1),r.clearSafe(fi.COLOR_BUFFER_BIT),r.bindVAO(o),r.drawArrays(bt.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);return s.readPixels(0,0,1,1,vt.RGBA,Is.UNSIGNED_BYTE,y),o.dispose(),s.dispose(),l.dispose(),r.setViewport(u,d,p,g),r.bindFramebuffer(c),y[0]!==255}}const JE=new Image;JE.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",JE.width=5,JE.height=5,JE.decode();class Wlt{constructor(t){this.rctx=t,this.floatBufferBlend=new Vlt(t),this.svgPremultipliesAlpha=new Hlt(t),this.doublePrecisionRequiresObfuscation=new Blt(t),this.ignoresSamplerPrecision=new Glt(t),this.drawArraysRequiresIndicesTypeReset=new zlt(t)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}}function qlt(e,t){if(t.disjointTimerQuery)return null;if(Ad(e))return{drawBuffers:e.drawBuffers.bind(e),MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS};if(t.drawBuffers)return null;const r=e.getExtension("WEBGL_draw_buffers");return r?{drawBuffers:r.drawBuffersWEBGL.bind(r),MAX_DRAW_BUFFERS:r.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:r.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function Xlt(e){if(Ad(e))return e;const t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}function Zlt(e,t){if(t.compressedTextureETC)return null;const r=e.getExtension("WEBGL_compressed_texture_etc");return r?{COMPRESSED_R11_EAC:r.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:r.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:r.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:r.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:r.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:r.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function Ylt(e,t){if(t.compressedTextureS3TC)return null;const r=e.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function Jlt(e,t){if(Ad(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;{const r=e.getExtension("EXT_blend_minmax");return r?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null}}function Klt(e,t){if(t.textureFilterAnisotropic)return null;const r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}function Qlt(e,t){if(Ad(e))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:e.HALF_FLOAT,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F};if(e instanceof WebGLRenderingContext){const r=!t.textureHalfFloat&&e.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!r,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:r?r.HALF_FLOAT_OES:void 0}}return null}function ect(e,t){if(Ad(e)){const r=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float")||!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),i=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return r||i||s?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!s,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}if(e instanceof WebGLRenderingContext){const r=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float"),i=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return r||i||s?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!s,RGBA16F:r?r.RGBA16F_EXT:void 0,RGB16F:r?r.RGB16F_EXT:void 0,RGBA32F:i?i.RGBA32F_EXT:void 0}:null}return null}function Xse(e,t,r,i,s){if(i&&Ad(e))return!0;if(t[r])return!1;for(const n of s)if(e.getExtension(n))return!0;return!1}function tct(e,t){if(!Ad(e)||t.textureNorm16)return null;const r=e.getExtension("EXT_texture_norm16");return r?{R16:r.R16_EXT,RG16:r.RG16_EXT,RGB16:r.RGB16_EXT,RGBA16:r.RGBA16_EXT,R16_SNORM:r.R16_SNORM_EXT,RG16_SNORM:r.RG16_SNORM_EXT,RGB16_SNORM:r.RGB16_SNORM_EXT,RGBA16_SNORM:r.RGBA16_SNORM_EXT}:null}function rct(e,t){const r=t.loseContext&&e.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:()=>r.loseContext()}:null}function ict(e,t){if(Ad(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;const r=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return r?{createVertexArray:r.createVertexArrayOES.bind(r),deleteVertexArray:r.deleteVertexArrayOES.bind(r),bindVertexArray:r.bindVertexArrayOES.bind(r)}:null}class sct{constructor(t,r){this._gl=t,this._instancing=null,this._vertexArrayObject=null,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._minMaxBlending=null,this._loseContext=null,this._drawBuffers=null,this._textureNorm16=null,this._depthTexture=null,this._textureFloatLinear=null,this._disabledExtensions=r.disabledExtensions||{},this._debugWebGLExtensions=r.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=qlt(this._gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=Xlt(this._gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=ict(this._gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=Zlt(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=Ylt(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=Klt(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=llt(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=Qlt(this._gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=ect(this._gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=Jlt(this._gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=Xse(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get loseContext(){return this._loseContext||(this._loseContext=rct(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=tct(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=Xse(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(t){return this[t]}}let nct=class{constructor(e,t){this.gl=e,this.instanceCounter=new mlt,this.programCache=new klt(this),this._state=new Dse,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=Ad(e)?tr.WEBGL2:tr.WEBGL1,this._loadExtensions(),this.configure(t)}get gl2(){return this.type===tr.WEBGL1?null:this.gl}configure(e){this._capabilities=new sct(this.gl,e),this._parameters=new glt(this.gl,this._capabilities,e),wt.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const t=this.gl.getParameter(this.gl.VIEWPORT);this._state=new Dse,this._state.viewport={x:t[0],y:t[1],width:t[2],height:t[3]},this._stateTracker=new d5e({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const i=r.color;this.setBlendColor(i.r,i.g,i.b,i.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const i=r.function;this.setStencilFunction(i.func,i.ref,i.mask);const s=r.operation;this.setStencilOp(s.fail,s.zFail,s.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)}}),this.enforceState(),De(this._driverTest),this._driverTest=new Wlt(this)}dispose(){De(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(gt.ARRAY_BUFFER),this.unbindBuffer(gt.ELEMENT_ARRAY_BUFFER),this.type===tr.WEBGL2&&(this.unbindBuffer(gt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(gt.PIXEL_PACK_BUFFER),this.unbindBuffer(gt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(gt.COPY_READ_BUFFER),this.unbindBuffer(gt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,yu()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop(),this._state.program=null}externalTextureUnitUpdate(e,t){for(let r=0;r<e.length;++r)this._state.textureUnitMap[e[r]]=null;t>=0&&(this._state.activeTexture=t)}externalVertexArrayObjectUpdate(){const e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,t,r,i){e===this._state.blendColor.r&&t===this._state.blendColor.g&&r===this._state.blendColor.b&&i===this._state.blendColor.a||(this.gl.blendColor(e,t,r,i),this._state.blendColor.r=e,this._state.blendColor.g=t,this._state.blendColor.b=r,this._state.blendColor.a=i,this._stateTracker.invalidateBlending())}setBlendFunction(e,t){e===this._state.blendFunction.srcRGB&&t===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,t),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=t,this._state.blendFunction.dstAlpha=t,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,t,r,i){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===t&&this._state.blendFunction.dstAlpha===i||(this.gl.blendFuncSeparate(e,t,r,i),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=t,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,t){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===t||(this.gl.blendEquationSeparate(e,t),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}setColorMask(e,t,r,i){this._state.colorMask.r===e&&this._state.colorMask.g===t&&this._state.colorMask.b===r&&this._state.colorMask.a===i||(this.gl.colorMask(e,t,r,i),this._state.colorMask.r=e,this._state.colorMask.g=t,this._state.colorMask.b=r,this._state.colorMask.a=i,this._stateTracker.invalidateColorWrite())}setClearColor(e,t,r,i){this._state.clearColor.r===e&&this._state.clearColor.g===t&&this._state.clearColor.b===r&&this._state.clearColor.a===i||(this.gl.clearColor(e,t,r,i),this._state.clearColor.r=e,this._state.clearColor.g=t,this._state.clearColor.b=r,this._state.clearColor.a=i)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,t){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===t||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=t,this.gl.polygonOffset(e,t),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,t,r,i){this._state.scissorRect.x===e&&this._state.scissorRect.y===t&&this._state.scissorRect.width===r&&this._state.scissorRect.height===i||(this.gl.scissor(e,t,r,i),this._state.scissorRect.x=e,this._state.scissorRect.y=t,this._state.scissorRect.width=r,this._state.scissorRect.height=i)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,t){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===t||(this.gl.depthRange(e,t),this._state.depthRange.zNear=e,this._state.depthRange.zFar=t,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,t,r){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===t&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(e,t,r),this._state.stencilFunction.face=sd.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=t,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,t,r,i){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===t&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===i||(this.gl.stencilFuncSeparate(e,t,r,i),this._state.stencilFunction.face=e,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,t,r){this._state.stencilOperation.face===sd.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===t&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(e,t,r),this._state.stencilOperation.face=sd.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=t,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,t,r,i){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===t&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===i||(this.gl.stencilOpSeparate(e,t,r,i),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,t=!1){const r=this._state.activeTexture;return e>=0&&(t||e!==this._state.activeTexture)&&(this.gl.activeTexture(OF+e),this._state.activeTexture=e),r}clear(e){e&&this.gl.clear(e)}clearSafe(e,t=255){e&&(e&fi.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&fi.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&fi.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(t),this.gl.clear(e))}drawArrays(e,t,r){if(yu()&&(this._numOfDrawCalls++,this._numOfTriangles+=Zse(e,r)),this.gl.drawArrays(e,t,r),yu()){const i=UY(this);i&&console.error("drawArrays:",i)}}drawElements(e,t,r,i){if(yu()&&(this._numOfDrawCalls++,this._numOfTriangles+=Zse(e,t)),this.gl.drawElements(e,t,r,i),yu()){const s=UY(this);if(s){const n=this.getBoundVAO(),o=n?.indexBuffer,a=n?.vertexBuffers,l={indexBuffer:o,vertexBuffers:a},c={mode:e,count:t,type:r,offset:i},u=o?.size??0,d=i+t,p=u<d?`. Buffer is too small. Attempted to draw index ${d} of ${u}`:"";console.error(`drawElements: ${s}${p}`,{args:c,vao:l})}}}logInfo(){yu()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){yu()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,t,r,i){r=Math.max(Math.round(r),1),i=Math.max(Math.round(i),1);const s=this._state.viewport;s.x===e&&s.y===t&&s.width===r&&s.height===i||(s.x=e,s.y=t,s.width=r,s.height=i,this.gl.viewport(e,t,r,i))}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){this._state.program!==e&&(this._state.program?.stop(),this._state.program=e,this.gl.useProgram(e?.glName??null))}bindTexture(e,t,r=!1){(t>=this.parameters.maxTextureImageUnits||t<0)&&console.error("Input texture unit is out of range of available units!");const i=this._state.textureUnitMap[t];return e==null||e.glName==null?(i!=null&&(this.setActiveTexture(t,r),this.gl.bindTexture(i.descriptor.target,null)),this._state.textureUnitMap[t]=null,i):r||i!==e?(this.setActiveTexture(t,r),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[t]=e,i):(e.isDirty&&(this.setActiveTexture(t,r),e.applyChanges()),i)}unbindTexture(e){if(e!=null)for(let t=0;t<this.parameters.maxTextureImageUnits;t++)this._state.textureUnitMap[t]===e&&(this.bindTexture(null,t),this._state.textureUnitMap[t]=null)}bindFramebuffer(e,t=!1){if(t||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(e==null)return this.gl.bindFramebuffer(Qn.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);e.initializeAndBind(Qn.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,t,r=!1){const i=t===Qn.READ_FRAMEBUFFER,s=i?this._state.readFramebuffer:this._state.drawFramebuffer;(r||s!==e)&&(e==null?this.gl.bindFramebuffer(t,null):e.initializeAndBind(t),i?this._state.readFramebuffer=e??null:this._state.drawFramebuffer=e??null)}blitFramebuffer(e,t,r=0,i=0,s=e.width,n=e.height,o=0,a=0,l=t.width,c=t.height,u=fi.COLOR_BUFFER_BIT,d=xt.NEAREST){this.bindFramebufferSeparate(e,Qn.READ_FRAMEBUFFER),this.bindFramebufferSeparate(t,Qn.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,i,s,n,o,a,l,c,u,d)}bindBuffer(e,t){if(e)switch(t??(t=e.bufferType),t){case gt.ARRAY_BUFFER:this._state.vertexBuffer=cl(this.gl,e,t,this._state.vertexBuffer);break;case gt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=cl(this.gl,e,t,this._state.indexBuffer);break;case gt.UNIFORM_BUFFER:this._state.uniformBuffer=cl(this.gl,e,t,this._state.uniformBuffer);break;case gt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=cl(this.gl,e,t,this._state.pixelPackBuffer);break;case gt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=cl(this.gl,e,t,this._state.pixelUnpackBuffer);break;case gt.COPY_READ_BUFFER:this._state.copyReadBuffer=cl(this.gl,e,t,this._state.copyReadBuffer);break;case gt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=cl(this.gl,e,t,this._state.copyWriteBuffer)}}bindRenderbuffer(e){const t=this.gl;e||(t.bindRenderbuffer(t.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(t.bindRenderbuffer(t.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,t){if(t>=this.parameters.maxUniformBufferBindings||t<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=this._state.uniformBufferBindingPoints;let i=r[t];return i==null&&(i={buffer:null,offset:0,size:0},r[t]=i),i}bindBufferBase(e,t,r){const i=this._getBufferBinding(e,t);i!=null&&(i.buffer===r&&i.offset===0&&i.size===0||(this.gl.bindBufferBase(e,t,r?r.glName:null),i.buffer=r,i.offset=0,i.size=0))}bindBufferRange(e,t,r,i,s){const n=this._getBufferBinding(e,t);if(n!=null&&!(n.buffer===r&&n.offset===i&&n.size===s)){if(i%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(e,t,r.glName,i,s),n.buffer=r,n.offset=i,n.size=s}}bindUBO(e,t,r,i){t!=null?(yu()&&(i??t.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),t.initialize(),r!==void 0&&i!==void 0?this.bindBufferRange(gt.UNIFORM_BUFFER,e,t.buffer,r,i):this.bindBufferBase(gt.UNIFORM_BUFFER,e,t.buffer)):this.bindBufferBase(gt.UNIFORM_BUFFER,e,null)}unbindUBO(e){for(let t=0,r=this._state.uniformBufferBindingPoints.length;t<r;t++){const i=this._state.uniformBufferBindingPoints[t];i!=null&&i.buffer===e.buffer&&this.bindBufferBase(gt.UNIFORM_BUFFER,t,null)}}unbindBuffer(e){switch(e){case gt.ARRAY_BUFFER:this._state.vertexBuffer=cl(this.gl,null,e,this._state.vertexBuffer);break;case gt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=cl(this.gl,null,e,this._state.indexBuffer);break;case gt.UNIFORM_BUFFER:this._state.uniformBuffer=cl(this.gl,null,e,this._state.uniformBuffer);break;case gt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=cl(this.gl,null,e,this._state.pixelPackBuffer);break;case gt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=cl(this.gl,null,e,this._state.pixelUnpackBuffer);break;case gt.COPY_READ_BUFFER:this._state.copyReadBuffer=cl(this.gl,null,e,this._state.copyReadBuffer);break;case gt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=cl(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){e!=null?this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}async clientWaitAsync(e=10){const t=this.gl,r=t.fenceSync(mz.SYNC_GPU_COMMANDS_COMPLETE,0);if(!r)throw new Error("Client wait failed, could not create sync object");let i;this.instanceCounter.increment(mn.Sync,r),t.flush();do await rA(e),i=t.clientWaitSync(r,0,0);while(i===cL.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(mn.Sync,r),t.deleteSync(r),i===cL.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=Qn.FRAMEBUFFER){return e===Qn.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(gt.ARRAY_BUFFER),this.unbindBuffer(gt.ELEMENT_ARRAY_BUFFER),this.type===tr.WEBGL2&&(this.unbindBuffer(gt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(gt.PIXEL_PACK_BUFFER),this.unbindBuffer(gt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(gt.COPY_READ_BUFFER),this.unbindBuffer(gt.COPY_WRITE_BUFFER));for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(ve.ONE,ve.ZERO),this.setBlendEquation(Jp.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(sd.BACK),this.setFrontFace(ET.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Hr.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Hr.ALWAYS,0,0),this.setStencilOp(as.KEEP,as.KEEP,as.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const e=this.capabilities.vao;e&&e.bindVertexArray(null);const{gl:t,gl2:r}=this;for(let s=0;s<this.parameters.maxVertexAttributes;s++)t.disableVertexAttribArray(s);if(this._state.vertexBuffer?t.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):t.bindBuffer(gt.ARRAY_BUFFER,null),this._state.indexBuffer?t.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):t.bindBuffer(gt.ELEMENT_ARRAY_BUFFER,null),r!=null){this._state.uniformBuffer?r.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):r.bindBuffer(gt.UNIFORM_BUFFER,null);for(let s=0;s<this._parameters.maxUniformBufferBindings;s++){const n=this._state.uniformBufferBindingPoints[s];if(n!=null){const{buffer:o,offset:a,size:l}=n;o!==null?a===0&&l===0?r.bindBufferBase(gt.UNIFORM_BUFFER,s,o.glName):r.bindBufferRange(gt.UNIFORM_BUFFER,s,o.glName,a,l):r.bindBufferBase(gt.UNIFORM_BUFFER,s,null)}}this._state.pixelPackBuffer?r.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):r.bindBuffer(gt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?r.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):r.bindBuffer(gt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?r.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):r.bindBuffer(gt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?r.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):r.bindBuffer(gt.COPY_WRITE_BUFFER,null),r.bindFramebuffer(Qn.READ_FRAMEBUFFER,null),r.readBuffer(r.BACK),this._state.readFramebuffer&&(r.bindFramebuffer(Qn.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),r.readBuffer(cc.COLOR_ATTACHMENT0)),r.bindFramebuffer(Qn.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,t.bindFramebuffer(Qn.FRAMEBUFFER,this._state.drawFramebuffer?.glName??null);if(e&&this._state.vertexArrayObject){const s=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(s)}t.useProgram(this._state.program?.glName??null),t.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),t.bindRenderbuffer(t.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?t.enable(this.gl.BLEND):t.disable(this.gl.BLEND),t.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),t.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),t.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),t.clearDepth(this._state.clearDepth),t.clearStencil(this._state.clearStencil),t.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),t.cullFace(this._state.cullFace),t.depthFunc(this._state.depthFunction),t.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),t.depthMask(this._state.depthWrite),t.frontFace(this._state.frontFace),t.lineWidth(1),this._state.faceCulling===!0?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),t.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?t.enable(t.POLYGON_OFFSET_FILL):t.disable(t.POLYGON_OFFSET_FILL),t.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),t.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),t.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),t.stencilMask(this._state.stencilWriteMask);for(let s=0;s<this.parameters.maxTextureImageUnits;s++){t.activeTexture(OF+s),t.bindTexture(Ji.TEXTURE_2D,null),t.bindTexture(Ji.TEXTURE_CUBE_MAP,null),this.type===tr.WEBGL2&&(t.bindTexture(Ji.TEXTURE_3D,null),t.bindTexture(Ji.TEXTURE_2D_ARRAY,null));const n=this._state.textureUnitMap[s];n!=null&&t.bindTexture(n.descriptor.target,n.glName)}t.activeTexture(OF+this._state.activeTexture);const i=this._state.viewport;t.viewport(i.x,i.y,i.width,i.height),this.resetInfo()}_loadExtensions(){this.type===tr.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}};function cl(e,t,r,i){return t?i!==t&&e.bindBuffer(r,t.glName):e.bindBuffer(r,null),t}function Zse(e,t){switch(e){case bt.POINTS:return 2*t;case bt.TRIANGLES:return t/3;case bt.TRIANGLE_STRIP:case bt.TRIANGLE_FAN:return t-2;default:return 0}}class oct extends nct{constructor(t,r,i){super(t,r),this.newCache=i,this._refCount=1,this._appleAmdDriverHelper=null}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){super.dispose(),this._appleAmdDriverHelper?.dispose()}bindTechnique(t,r,i,s){return this.useProgram(t.program),t.bindPipelineState(this,i?.slot,!!s),t.program.bindPass(r,i),t.program}get appleAmdDriverHelper(){return this.driverTest.drawArraysRequiresIndicesTypeReset.result?(this._appleAmdDriverHelper=this._appleAmdDriverHelper??new O5(this),this._appleAmdDriverHelper):null}get test(){return this.programCache.test}}let Ww=class extends xe{constructor(e,t,r){super({}),this._stage=e,this._techniqueRepository=t,this._rctx=r,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new cs,this._frameTask=e.view.resourceController.scheduler.registerTask(at.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(Ki.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return this._textureTechnique==null&&(this._textureTechnique=this._techniqueRepository.acquire(aO,new tW)),this._textureTechnique}acquire(e){const t=this._textures.get(e);return t?(t.ref(),t.loadingPromise??t):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(t=>{const r=t.texture.frameUpdate(t.previousToken);r>=0&&r!==t.previousToken&&(t.previousToken=r,e=!0)}),e&&this.events.emit("changed",ns.BACKGROUND)}_createNewRef(e){const t=this._stage.getObject(e);if(t==null)return Ye(t!==void 0),null;const r=t.events.on("unloaded",()=>{r.remove(),this._onTextureUnloaded(e)}),i=new act(e,()=>{this._frameTask.schedule(()=>{i.isUnreferenced&&t.unload()})});return this._textures.set(e,i),i.ref(),t.glTexture!=null?(this._updateGLTexture(i,t.glTexture),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),i):(this._loadingCount++,i.loadingPromise=this._stage.schedule(()=>{const s=t.load(this._rctx),n=a=>(this._loadingCount--,i.loadingPromise=null,this._updateGLTexture(i,a),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),i),o=a=>(this._loadingCount--,i.loadingPromise=null,$s(a)||K.getLogger(this).error(a),null);return zc(s)?s.then(n,o):n(s)}),i.loadingPromise)}_updateGLTexture(e,t){e.glTexture=t,this.events.emit("changed",ns.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};h([f()],Ww.prototype,"_loadingCount",void 0),h([f()],Ww.prototype,"_frameTask",void 0),h([f()],Ww.prototype,"updating",null),Ww=h([F("esri.views.3d.webgl-engine.lib.TextureRepository")],Ww);class act{constructor(t,r){this.id=t,this._release=r,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(K.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}}function lct(e,t){return new Cye(r=>dHe(r,e),r=>r,t)}let KE=class extends xe{constructor(){super(...arguments),this._passParameters=new cct,this._loading=0}get passParameters(){return this._passParameters}destroy(){this._passParameters.waveNormal=De(this._passParameters.waveNormal),this._passParameters.wavePertubation=De(this._passParameters.wavePertubation)}get updating(){return this._loading>0}ensureResources(e){if(this._loading>0)return _m.LOADING;if(this._passParameters.waveNormal!=null&&this._passParameters.wavePertubation!=null)return _m.LOADED;const t=new hr;return t.samplingMode=xt.LINEAR_MIPMAP_LINEAR,t.hasMipmap=!0,t.maxAnisotropy=8,++this._loading,Vm($r("esri/images/materials/water/normals.jpg")).then(r=>this._passParameters.waveNormal=new wt(e,{...t,width:r.width,height:r.height},r)).catch(r=>K.getLogger(this).error("Failed to load water material normal texture.",r)).finally(()=>--this._loading),++this._loading,Vm($r("esri/images/materials/water/perturbation.jpg")).then(r=>this._passParameters.wavePertubation=new wt(e,{...t,width:r.width,height:r.height},r)).catch(r=>K.getLogger(this).error("Failed to load water material pertubation texture.",r)).finally(()=>--this._loading),_m.LOADING}};h([f()],KE.prototype,"_loading",void 0),h([f({type:Boolean,readOnly:!0})],KE.prototype,"updating",null),KE=h([F("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],KE);class cct extends Wr{}const Yse=2048,uct=1.5,hct=8;function dct(e,t){const{format:r,quality:i,rotation:s,disableDecorations:n}=e||{},o=XW(e,t.padding),a=vct(e,{width:t.width-o.left-o.right,height:t.height-o.top-o.bottom}),{width:l,height:c}=_ct(e,a),u=xct(r),d=Act[u];return{format:u,quality:fe(i??d,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!(!e||!e.ignoreBackground),ignorePadding:!(!e||!e.ignorePadding)}}function pct(e,t){const r=dct(e,t),i=r.area,s=r.width/i.width,n=XW(r,t.padding),o=n.left+n.right,a=n.top+n.bottom,l=t.width-o,c=t.height-a,u=Math.floor(l*s+o),d=Math.floor(c*s+a),p=e&&e.layers?e.layers:[],g=r.ignoreBackground,y=r.ignorePadding;return{framebufferWidth:u,framebufferHeight:d,region:{x:Math.floor(i.x*s)+n.left,y:Math.floor(i.y*s)+n.top,width:r.width,height:r.height},format:r.format,quality:r.quality,rotation:r.rotation,pixelRatio:s,layers:p,disableDecorations:r.disableDecorations,ignoreBackground:g,ignorePadding:y,objectAndLayerIdColor:!1}}function KU(e,t,r){const{ctx:i,canvas:s}=Q1e(e,r),n=i.getImageData(0,0,e.width,e.height),o=mct(s,t);return ebe(s),{dataUrl:o,data:n}}function QU(e,t){const{ctx:r,canvas:i}=Q1e(e,t),s=r.getImageData(0,0,e.width,e.height);return ebe(i),s}function Q1e(e,t){const r=fct();t.premultipliedAlpha&&Sct(e),r.width=e.width,r.height=e.height;const i=r.getContext("2d",{willReadFrequently:!0});return i.putImageData(e,0,0),t.flipY&&Tct(i),{ctx:i,canvas:r}}function ebe(e){e.width=0,e.height=0}function fct(){return e8==null&&(e8=document.createElement("canvas")),e8}let e8=null;function mct(e,t){const r=Ect[t.format],i=t.quality/100;return e.toDataURL(r,i)}function gct(e,t,r,i=0,s=0,n=e.width-i,o=e.height-s,a=!1){const{data:l}=e,{width:c,height:u,data:d}=t,p=n/c,g=o/u,y=Math.ceil(p/2),_=Math.ceil(g/2),v=e.width;for(let w=0;w<u;w++)for(let T=0;T<c;T++){const x=4*(T+(a?u-w-1:w)*c);let S=0,O=0,A=0,$=0,P=0,U=0;const I=(w+.5)*g;for(let L=Math.floor(w*g);L<(w+1)*g;L++){const N=Math.abs(I-(L+.5))/_,Z=(T+.5)*p,W=N*N;for(let V=Math.floor(T*p);V<(T+1)*p;V++){const J=Math.abs(Z-(V+.5))/y,R=Math.sqrt(W+J*J);if(R>=1)continue;let k=2*R*R*R-3*R*R+1;const z=4*(i+V+(s+L)*v);U+=k*l[z+3],O+=k,!r&&l[z+3]<255&&(k=k*l[z+3]/255),A+=k*l[z],$+=k*l[z+1],P+=k*l[z+2],S+=k}}d[x]=A/S,d[x+1]=$/S,d[x+2]=P/S,d[x+3]=U/O}return t}function yct(e,t,r){if(!t)return e;const{framebufferWidth:i,framebufferHeight:s,pixelRatio:n,region:o}=e,a=XW(e,r),l=a.left+a.right,c=a.top+a.bottom,u=i-l,d=s-c,p=Math.min(hct,Math.min((Yse-l)/u,(Yse-c)/d));return p<uct?e:{...e,framebufferWidth:Math.round(u*p)+l,framebufferHeight:Math.round(d*p)+c,pixelRatio:n*p,resample:{region:{x:Math.round((o.x-a.left)*p)+a.left,y:Math.round((o.y-a.top)*p)+a.top,width:Math.round(o.width*p),height:Math.round(o.height*p)},width:i,height:s}}}function _ct(e,t){if(!e)return t;const r=e.width,i=e.height;if(r!=null&&i!=null)return{width:Math.floor(r),height:Math.floor(i)};if(r==null&&i==null)return t;const s=t.width/t.height;return i==null?{width:Math.floor(r),height:Math.floor(r/s)}:{width:Math.floor(i*s),height:Math.floor(i)}}function vct(e,t){const r={x:0,y:0,width:t.width,height:t.height};if(e&&e.area){e.area.x!=null&&(r.x=Math.floor(e.area.x)),e.area.y!=null&&(r.y=Math.floor(e.area.y));const i=e.area.width!=null?Math.floor(e.area.width):null,s=e.area.height!=null?Math.floor(e.area.height):null;if(r.width=t.width-r.x,r.height=t.height-r.y,i!=null&&s!=null)r.width=Math.min(r.width,i),r.height=Math.min(r.height,s);else if(i==null&&s!=null){const n=Math.min(r.width,i);r.height=n/r.width*r.height,r.width=n}else if(i!=null&&s==null){const n=Math.min(r.height,s);r.width=n/r.height*r.width,r.height=n}}return bct(wct(r,e),t)}function bct(e,t){const r=Math.floor(Math.max(e.x,0)),i=Math.floor(Math.max(e.y,0)),s={x:r,y:i,width:Math.floor(Math.min(e.width,t.width-r)),height:Math.floor(Math.min(e.height,t.height-i))},n=s.width/s.height,o=e.width/e.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),u=s.height-c;return{x:s.x,y:Math.floor(s.y+u/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function wct(e,t){if(!t||t.width==null||t.height==null)return e;const r=t.width/t.height,i=e.width/e.height;if(i===r)return e;if(i<r){const n=Math.floor(e.height*r);return e.x-=(n-e.width)/2,e.width=n,e}const s=Math.floor(e.width/r);return e.y-=(s-e.height)/2,e.height=s,e}function XW(e,t){return!t||e&&e.ignorePadding?Oct:t}function xct(e){switch(e){case"png":case"jpg":case"jpeg":return e;default:return Cct}}function Tct(e){e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore()}function Sct(e){const t=e.data,r=t.length;for(let i=0;i<r;i+=4){const s=t[i+3];if(s!==255&&s>0){const n=255/s;t[i]=t[i]*n,t[i+1]=t[i+1]*n,t[i+2]=t[i+2]*n}}}const Ect={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},Jse=98,Cct="png",Act={png:100,jpg:Jse,jpeg:Jse},Oct={top:0,right:0,bottom:0,left:0};class Rct{constructor(t,r){this.parameters=t,this.frameHasDecorations=r}}class Pct{constructor(t,r,i,s){this._rctx=t,this._renderFunctions=r,this._forceCameraHook=i,this._disposeOffscreenBuffers=s,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(t){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(ns.BACKGROUND);const r=Ys();return this._screenshotQueue.push({settings:t,resolver:r}),r.promise}update(t,r){for(const i of this._screenshotQueue){if(this._rctx==null){i.resolver.reject();continue}const s={...i.settings,pixelRatio:i.settings.pixelRatio*t.parameters.camera.pixelRatio},n=this._renderScreenshot(t,s,r);i.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(t,r,i){t.width=r.width,t.height=r.height;const s=t.getContext("2d"),n=i.pixelRatio;return s.save(),s.translate(0,r.height),s.scale(1,-1),i.region&&s.translate(-i.region.x,-i.region.y),s.scale(n,n),r=this._renderFunctions.renderOverlay(t,r),s.restore(),r}_readbackScreenshot(t,r){return t.resample?this._readbackScreenshotResampled({...t,resample:t.resample},r):this._readbackScreenshotImmediate(t,r)}_readbackScreenshotResampled(t,r){const{framebufferWidth:i,framebufferHeight:s,region:n,resample:o}=t,a=this._ensureScreenshotEncodeCanvas();let l=Q6(i,s,a);this._rctx.gl.readPixels(0,0,i,s,vt.RGBA,Ze.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),r(),l=this._renderScreenshotOverlay(a,l,{...t,region:void 0});const c=Q6(n.width,n.height,a);return gct(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(t,r){const{framebufferHeight:i,region:s}=t,n=this._ensureScreenshotEncodeCanvas(),o=Q6(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,i-(s.y+s.height),s.width,s.height,vt.RGBA,Ze.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),r(),this._renderScreenshotOverlay(n,o,t)}_renderScreenshot(t,r,i){let s=null;const n=t.parameters.camera,o={width:r.framebufferWidth,height:r.framebufferHeight};Iv(o,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let a=!1;const l=r.disableDecorations&&t.frameHasDecorations,c=o.width!==n.fullWidth||o.height!==n.fullHeight,u=r.ignorePadding&&n.pixelRatio!==r.pixelRatio,d=c||l||u||r.objectAndLayerIdColor,p=r.objectAndLayerIdColor?new Bi(this._rctx,new hr(o.width,o.height),new pL(Ns.DEPTH_STENCIL,o.width,o.height)):null;if(d){const v=n.clone();if(r.ignorePadding){const O=z3(v.padding);for(let A=0;A<4;A++)O[A]=Math.round(O[A]/v.pixelRatio*r.pixelRatio);v.padding=O}v.fullWidth=o.width,v.fullHeight=o.height,v.pixelRatio=r.pixelRatio;const w=n.fovX-v.fovX,T=n.fovY-v.fovY;w<0&&w<T?v.fovX=n.fovX:T<0&&T<w&&(v.fovY=n.fovY);const x={camera:v,contentCamera:v,mode:Er.IDLE,alignPixelEnabled:!0,contentPixelRatio:v.pixelRatio};this._forceCameraHook(x),a=!0,s=new Bi(this._rctx,new hr(o.width,o.height),new pL(Ns.DEPTH_STENCIL,o.width,o.height));const S=r.disableDecorations?S1.OFF:S1.ON;this._renderFunctions.renderScene(s,p,x,S,i),this._disposeOffscreenBuffers()}const g=()=>{this._rctx.bindFramebuffer(null),De(s)},y=this._readbackScreenshot(r,g);g();let _=null;if(r.objectAndLayerIdColor){const v=()=>{this._rctx.bindFramebuffer(null),De(p)};this._rctx.bindFramebuffer(p),_=this._readbackScreenshot(r,v),this._rctx.bindFramebuffer(null),v()}if(d&&!this._rctx.contextAttributes.alpha)for(let v=3;v<y.data.length;v+=4)y.data[v]=255;if(_&&!this._rctx.contextAttributes.alpha)for(let v=3;v<_.data.length;v+=4)_.data[v]=255;return a&&this._forceCameraHook(t.parameters),[y,_]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}}let On=class extends xe{constructor(e){super({}),this.events=new cs,this.waterTextureRepository=new KE,this._magnifierHelper=new Hw,this.objectAndLayerIdRenderHelper=ne("enable-feature:objectAndLayerId-rendering")?new Mot:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),this.addHandles([le(()=>this.waterTextureRepository?.updating,()=>this.requestRender(),Rr),le(()=>e.view.qualityProfile,i=>this.renderer?.updateRenderFeature(i),_s),this._magnifierHelper.events.on("request-render",()=>this.requestRender())]);const{memoryController:t}=e.view.resourceController;this.stippleTextureRepository=rHe(this._rctx,t),this.markerTextureRepository=lct(this._rctx,t),this._shaderTechniqueRepository=new bye({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this.stippleTextureRepository,waterTextureRepository:this.waterTextureRepository,markerTextureRepository:this.markerTextureRepository}),this._textureRepository=new Ww(e,this._shaderTechniqueRepository,this._rctx),this.addHandles(this._textureRepository.events.on("changed",i=>this.requestRender(i))),this._materialRepository=new wye(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new cot(this._rctx,this._shaderTechniqueRepository),this.renderer=new fl(e,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,i=>this.requestRender(i));const r={renderScene:(i,s,n,o,a)=>this.renderer.render(i,s,n,o,a),requestRenderScene:i=>this.requestRender(i),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(i,s)=>e.options.screenshot.renderOverlay(i,s)};this._screenshotManager=new Pct(this._rctx,r,i=>this.events.emit("force-camera-for-screenshot",i),()=>this.renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=xi(this._frameTask),this._shaderTechniqueRepository=Re(this._shaderTechniqueRepository)}requestRender(e=ns.UPDATE){this._needsRender=!0,e===ns.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(t=>t[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,t,r,i,s,n=s){const o=i.constrainWindowSize(t,r,s*i.pixelRatio,n*i.pixelRatio),a=this._ensureDepthBuffer(o);this.renderer.readDepthPixels(i,o,a);let l=Number.MAX_VALUE;for(let c=0;c<o[2]*o[3];c++){const u=fot(4*c,a,i.nearFar);l>u&&u!==i.nearFar[0]&&u!==i.nearFar[1]&&(l=u)}if(e!=null){const c=e.pickDepth(t*i.pixelRatio,r*i.pixelRatio,i);c!=null&&l>c&&c!==i.nearFar[0]&&c!==i.nearFar[1]&&(l=c)}return l===Number.MAX_VALUE?void 0:l}_ensureDepthBuffer(e){const t=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<t)&&(this._tmpDepthBuffer=new Uint8Array(t)),this._tmpDepthBuffer}async reloadShaders(){Dve(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}_registerFrameTask(e){const t=e.view.state;let r=!1,i=ns.BACKGROUND,s=!1;const n={preRender:({time:o})=>{r=this.updating,i=this._needsUpdate?ns.UPDATE:ns.BACKGROUND,e.commitSyncLayers();const a=o-this._lastAnimationUpdate;if(a>this.renderer.animationTimestep||t.forcedAnimationTime!=null||r||this._needsRender){const l=a/this.renderer.animationTimeDilation,c=new Ege(t.camera,l,t.forcedAnimationTime);this.renderer.updateAnimation(c)&&this.requestRender(ns.BACKGROUND),this._lastAnimationUpdate=o}},render:({time:o})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&t.camera.fullWidth>0&&t.camera.fullHeight>0){const a=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(null,null,t,S1.ON,o),s=!0,a&&this.renderer.hasReflections&&(this.requestRender(ns.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:o})=>{const a=new Rct(t,this.renderer.hasSlicePlane||this._magnifierHelper.enabled);this._textureRepository.update(),this._screenshotManager.update(a,o)},finish:()=>{s&&(this.renderer.finish(t.mode===Er.IDLE?i:ns.UPDATE),s=!1)}};this._frameTask=Qx(n)}_initializeContext(e){const t=e.options;this._canvas=t.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const r={alpha:t.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:t.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:t.preserveDrawingBuffer??!1},i=m5e("3d",this._canvas,r);i!=null?(this._rctx=this._newRenderingContext(i,e),this._loadShaderOnlyExtensions(),!t.alpha&&this._rctx.contextAttributes.alpha&&K.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&ne("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):K.getLogger(this).error("A WebGL2 context could not be created.")}_newRenderingContext(e,t){const r={disabledExtensions:t.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:t.options.debugWebGLExtensions||{},maxAnisotropy:8},i=(s,n)=>t.view.resourceController.memoryController.newCache(s,n);return new oct(e,r,i)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(e){return this.objectAndLayerIdRenderHelper!=null?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return this._componentObjectCollection==null&&(this._componentObjectCollection=new Ynt(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};h([f({type:Boolean,readOnly:!0})],On.prototype,"updating",null),h([f({autoDestroy:!0})],On.prototype,"_rctx",void 0),h([f({autoDestroy:!0})],On.prototype,"_container",void 0),h([f({autoDestroy:!0})],On.prototype,"_canvas",void 0),h([f({autoDestroy:!0})],On.prototype,"stippleTextureRepository",void 0),h([f({autoDestroy:!0})],On.prototype,"markerTextureRepository",void 0),h([f({autoDestroy:!0})],On.prototype,"waterTextureRepository",void 0),h([f({autoDestroy:!0})],On.prototype,"_magnifierHelper",void 0),h([f({readOnly:!0})],On.prototype,"objectAndLayerIdRenderHelper",void 0),h([f({autoDestroy:!0})],On.prototype,"_textureRepository",void 0),h([f({autoDestroy:!0})],On.prototype,"_compositingHelper",void 0),h([f({autoDestroy:!0,readOnly:!0})],On.prototype,"renderer",void 0),h([f({autoDestroy:!0})],On.prototype,"_screenshotManager",void 0),h([f()],On.prototype,"componentObjectCollection",null),h([f({autoDestroy:!0})],On.prototype,"_componentObjectCollection",void 0),h([f()],On.prototype,"_needsUpdate",void 0),h([f()],On.prototype,"_needsWaterReflectionUpdate",void 0),On=h([F("esri.views.3d.webgl-engine.parts.RenderView")],On);let oc=class extends xe{constructor(e){super(e),this._model=new MI,this._layers=new Mt,this._asyncChangeSet=new dB,this._syncChangeSet=new dB,this._layerSyncSet=new Set}initialize(){this._set("renderView",new On(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(at.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.removeAllHandles()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){return this.renderView?.renderer}add(e){this._model.add(e),WL(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e==null||this.destroyed||(this._model.remove(e),WL(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){e!=null&&(this._model?.removeMany(e),this.renderView?.requestRender())}async load(e,t){e!=null&&(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(r=>r.glTexture==null).map(r=>this.schedule(()=>this._model.has(r)?r.load(this.renderView.renderingContext):null),t)))}loadImmediate(e){return e.load(this.renderView.renderingContext)}forEachOfType(e,t){this._model.forEachOfType(e,t)}handleEvent(e,t){this.destroyed||(this._model.dirtySet[e](t),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){this._frameTask.processQueue(e),this._commit(e)}_commit(e){const t=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{if(e.done)return;const i=this._layerSyncSet.has(r.id)||r.updatePolicy===oy.SYNC,s=i?this._syncChangeSet:this._asyncChangeSet;t.commitLayer(r.id,s),this._layerSyncSet.delete(r.id),s.empty||(this.renderer.modify(s,i?_a:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,_a),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{e.done||this._layerSyncSet.has(r.id)||r.updatePolicy!==oy.ASYNC||(t.commitLayer(r.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(t=>{(this._layerSyncSet.has(t.id)||t.updatePolicy===oy.SYNC)&&(e.commitLayer(t.id,this._syncChangeSet),this._layerSyncSet.delete(t.id))});for(const t of this._layerSyncSet)e.commitLayer(t,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,_a),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,_a),this.renderView.requestRender())}schedule(e,t){return this._frameTask.schedule(e,t)}reschedule(e,t){return this._frameTask.reschedule(e,t)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,_a))}addRenderPlugin(e,t,r){const i=this.renderer.renderPlugins.add(e,t,r),s=()=>{Lte(t)&&this.view.sceneIntersectionHelper.addIntersectionHandler(t)};if(zc(i))return i.then(s);s()}removeRenderPlugin(e){this.destroyed||(Lte(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.renderPlugins.remove(e))}get performanceInfo(){return{renderer:this.renderer.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:t=>e._model.test.content.filter(r=>r.type===t).length,model:e._model}}};oc.DebugSettings={endFrameContentValidation:!1},h([f({constructOnly:!0})],oc.prototype,"view",void 0),h([f({constructOnly:!0})],oc.prototype,"options",void 0),h([f({readOnly:!0})],oc.prototype,"viewingMode",null),h([f({constructOnly:!0})],oc.prototype,"container",void 0),h([f({readOnly:!0})],oc.prototype,"updating",null),h([f({constructOnly:!0})],oc.prototype,"_model",void 0),h([f({autoDestroy:!0})],oc.prototype,"renderView",void 0),h([f({readOnly:!0})],oc.prototype,"renderer",null),h([f({readOnly:!0})],oc.prototype,"running",null),oc=h([F("esri.views.3d.webgl-engine.Stage")],oc);class fgt extends qN{constructor(t,r,i,s){super(r,i),this.point=t,this.createGraphic=s}}function tbe(e){return Cd(e)&&e.intersector===Ii.PCL&&!!e.target}class mgt extends eme{constructor(t,r,i,s,n){super(t),this.layerUid=t,this.sublayerUid=r,this.nodeIndex=i,this.componentIndex=s,this.triangleNr=n}}class ggt extends qN{constructor(t,r,i){super(r,null),this.point=t,this.createVoxelGraphic=i}}function R5(e){return Cd(e)&&e.intersector===Ii.I3S&&!!e.target}function rbe(e){return Cd(e)&&e.intersector===Ii.VOXEL&&!!e.target}function Kse(e,t){return XN(e)||ZN(e)?m3(e.target?.object,t):$He(e)?t.map?.ground:tbe(e)||R5(e)||zye(e)||rbe(e)?m3(e.target,t):null}function ygt(e,t){const r=tV(e,t);return r!=null&&r.type==="graphic"?r.graphic:null}function tV(e,t){if(e==null)return null;if(XN(e)||ZN(e))return Qse(e.target?.object,t);if(tbe(e)){const r=e.target.createGraphic();return{type:"graphic",graphic:r,layer:r.layer}}if(rbe(e)){const r=e.target.createVoxelGraphic();return{type:"graphic",graphic:r,layer:r.layer}}return zye(e)||gW(e)?Qse(e.target,t):R5(e)?Mct(e.target,t):null}function Qse(e,t){if(e==null||e.graphicUid==null)return null;const r=m3(e,t);if(r==null)return null;if(r===t.graphics)return t.graphicsView==null||typeof e.graphicUid!="number"?null:t.graphicsView.getHit(e.graphicUid);const i=t.allLayerViews.find(s=>s.layer===r);return!i||i.suspended||e.graphicUid==null?null:"getHit"in i?i.getHit(e.graphicUid):null}function Mct(e,t){const r=m3(e,t);if(r==null)return null;const i=t.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getGraphicFromIntersectorTarget"in i?$ct(i.getGraphicFromIntersectorTarget(e)):null}function Ict(e,t){const r=m3(e,t);if(r==null)return null;const i=t.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getAABBFromIntersectorTarget"in i?i.getAABBFromIntersectorTarget(e):null}function $ct(e){return e!=null?{type:"graphic",graphic:e,layer:e.layer}:null}function m3(e,t){return e&&e.layerUid!=null?t.graphicsView!=null&&e.layerUid===t.graphicsView.processor.layer.id?t.graphics:t.map.findLayerByUid(e.layerUid):null}function _gt(e,t){if(XN(e)||ZN(e))return ym(e.target.object.boundingVolumeWorldSpace.bounds);if(gW(e)){Rhe(iM,e.transformation);const r=Math.max(iM[0],iM[1],iM[2]);return e.target.baseBoundingSphere.radius*r}return R5(e)?Lu(Ict(e.target,t),r=>.5*jue(r)):null}function vgt(e){return!XN(e)&&!ZN(e)&&(gW(e)?e.target.numLodLevels>1:!!R5(e))}const iM=C();async function Lct(e,t){if(e.type==="2d")return e.hitTest(t);const r=await e.hitTest(t);if(r.results.length===0)return r;const i=(r.results[0].distance??0)*(1+Dct),s=r.results.findIndex(n=>(n.distance??0)>i);return s!==-1&&(r.results=r.results.slice(0,s)),r}const Dct=.05;function bgt(e){return e&&typeof e.highlight=="function"}function Nct(e){return e&&typeof e.maskOccludee=="function"}function wgt(e,t,r){return e==null||e>r&&(t===0||e<t)}function xgt(e,t){return e!=null&&e>0||t!=null&&t>0}function Tgt(e){const t=e.effectiveScaleRange;return{minScale:t?.minScale??0,maxScale:t?.maxScale??0}}let t8,r8;function Fct(e){const t=nfe(e);for(;t.length>1;){const r=ene(t.shift());if(r.available)return r}return ene(t.shift())}function ene(e){switch(e){case tr.WEBGL1:return Uct();case tr.WEBGL2:return kct()}}function Uct(){return t8||(t8=Vct()),t8}function kct(){return r8||(r8=Gct()),r8}class ibe{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}}class zct extends ibe{constructor(){super(...arguments),this.type=tr.WEBGL1}}class Bct extends ibe{constructor(){super(...arguments),this.type=tr.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}}function sbe(e,t){if(e===tr.WEBGL1&&typeof WebGLRenderingContext>"u"||e===tr.WEBGL2&&typeof WebGL2RenderingContext>"u")return null;const r=document.createElement("canvas");if(!r)return null;let i=yz(r,e,{failIfMajorPerformanceCaveat:!0});if(i==null&&(i=yz(r,e),i!=null&&(t.majorPerformanceCaveat=!0)),i==null)return i;if(e===tr.WEBGL1){const n=i.getParameter(i.VERSION),o=n?.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);t.available=a>=.94}}else t.available=!0;t.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const s=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return s&&(t.supportsHighPrecisionFragment=s.precision>0),i}function Vct(){const e=new zct,t=sbe(tr.WEBGL1,e);return t==null||(e.supportsElementIndexUint=t.getExtension("OES_element_index_uint")!==null,e.supportsStandardDerivatives=t.getExtension("OES_standard_derivatives")!==null,e.supportsInstancedArrays=t.getExtension("ANGLE_instanced_arrays")!==null,e.supportsTextureFloat=t.getExtension("OES_texture_float")!==null,e.supportsTextureHalfFloat=t.getExtension("OES_texture_half_float")!==null,e.supportsColorBufferFloat=t.getExtension("WEBGL_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=t.getExtension("EXT_color_buffer_half_float")!==null),e}function Gct(){const e=new Bct,t=sbe(tr.WEBGL2,e);return t==null||(e.supportsColorBufferFloat=t.getExtension("EXT_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=e.supportsColorBufferFloat||t.getExtension("EXT_color_buffer_half_float")!==null),e}function jct(e){const t=Fct(e);if(!t.available)return new G("webgl:required",e==="3d"?"WebGL2 is required but not supported.":"WebGL is required but not supported.",new Error().stack);if(e==="3d"&&t.majorPerformanceCaveat)return new G("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!t.supportsHighPrecisionFragment)return new G("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!t.supportsVertexShaderSamplers)return new G("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(t.type===tr.WEBGL1){if(!t.supportsElementIndexUint)return new G("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!t.supportsStandardDerivatives)return new G("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!t.supportsInstancedArrays)return new G("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function Hct(e){return e&&"nodeType"in e}function Wct(e){return e&&typeof e.render=="function"}const tne={component:"esri-component"};let ov=class extends xe{constructor(){super(...arguments),this.widget=null}destroy(){this.node=null,this.widget?.destroy()}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const t=this._get("node");e!==t&&(e&&e.classList.add(tne.component),t&&t.classList.remove(tne.component),this._set("node",e))}castNode(e){return this.widget?.destroy(),e?typeof e=="string"||Hct(e)?(this._set("widget",null),GD(e)):(Wct(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};h([f({dependsOn:[]})],ov.prototype,"id",null),h([f()],ov.prototype,"node",null),h([si("node")],ov.prototype,"castNode",null),h([f({readOnly:!0})],ov.prototype,"widget",void 0),ov=h([F("esri.views.ui.Component")],ov);const NI=ov,qct={left:0,top:0,bottom:0,right:0},nbe={bottom:30,top:15,right:15,left:15},$f="esri-ui",ul={ui:$f,corner:`${$f}-corner`,innerContainer:`${$f}-inner-container`,manualContainer:`${$f}-manual-container`,cornerContainer:`${$f}-corner-container`,topLeft:`${$f}-top-left`,topRight:`${$f}-top-right`,bottomLeft:`${$f}-bottom-left`,bottomRight:`${$f}-bottom-right`};function Xct(e){return e&&!e._started&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}function sM(e){return e===0?"0":`${e}px`}function i8(e){const t=typeof e=="object"&&e!==null&&Object.getPrototypeOf(e);return(t===null||t===Object.prototype)&&("component"in e||"index"in e||"position"in e)?e:null}function s8(e,{top:t,bottom:r,left:i,right:s}){e.style.top=t,e.style.bottom=r,e.style.left=i,e.style.right=s}let mp=class extends cs.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._locale=ud(),this.view=null,this._applyViewPadding=()=>{const t=this.container;t&&s8(t,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const t=this._innerContainer;t&&s8(t,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([le(()=>[this.view?.padding,this.container],this._applyViewPadding,Rr),le(()=>this.padding,this._applyUIPadding,Rr),le(()=>[this.container,this._locale],([e,t])=>{e&&e.setAttribute("lang",t)},Rr),rae(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){const t=this._get("container");e!==t&&(e&&(e.classList.add(ul.ui),H3e(e),this._attachContainers(e)),t&&(t.classList.remove(ul.ui),s8(t,{top:"",bottom:"",left:"",right:""}),lle(t)),this._set("container",e))}get height(){const e=this.view?.height??0;if(e===0)return e;const t=this._getViewPadding(),{top:r,bottom:i}=t;return Math.max(e-r-i,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...nbe,...e}}get width(){const e=this.view?.width??0;if(e===0)return e;const t=this._getViewPadding(),{left:r,right:i}=t;return Math.max(e-r-i,0)}add(e,t){let r,i,s;if(Array.isArray(e))return void e.forEach(o=>this.add(o,t));const n=i8(e);n&&({index:r,position:t,component:e,key:i}=n),t&&typeof t=="object"&&({index:r,key:i,position:t,internal:s}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,r,i,s)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map(i=>this.remove(i,t));const r=this._find(e);if(r){if(this._componentMap.has(e)&&this._componentMap.get(e)?.key!==t)return;const i=this._components.indexOf(r);return r.node.parentNode?.removeChild(r.node),this._componentMap.delete(e),this._components.splice(i,1)[0]}}empty(e,t={removeInternal:!1}){if(Array.isArray(e)){for(const s of e)this.empty(s,t);return}const r=this._positionNameToContainerLookup[e??"manual"],i=Array.prototype.slice.call(r.children).map(s=>this._findByNode(s)).filter(s=>s==null?!1:!(this._componentMap.get(s)?.internal??!1)||t.removeInternal);for(const s of i)this.remove(s)}move(e,t){if(Array.isArray(e)&&e.forEach(n=>this.move(n,t)),!e)return;let r;const i=i8(e)||i8(t);if(i&&(r=i.index,t=i.position,e=i.component||e),t&&!this._isValidPosition(t))return;const s=this.remove(e);s&&this.add(s,{position:t,index:r})}find(e){if(!e)return null;const t=this._findById(e);return t&&(t.widget||t.node)}getComponents(e,t={includeInternal:!1}){return e?Array.isArray(e)?e.map(r=>this._getComponentsAtPosition(r,t)).flat():this._getComponentsAtPosition(e,t):this._components.filter(r=>t.includeInternal||!this._componentMap.get(r)?.internal).map(({widget:r,node:i})=>r??i)}getPosition(e){for(const t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,r,i,s){e instanceof NI||(e=new NI({node:e})),this._place({component:e,position:t,index:r}),this._components.push(e),this._componentMap.set(e,{key:i,internal:s})}_find(e){return e?e instanceof NI?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.view?.padding??qct}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(ul.innerContainer,ul.cornerContainer);const t=document.createElement("div");t.classList.add(ul.innerContainer,ul.manualContainer);const r=document.createElement("div");r.classList.add(ul.topLeft,ul.corner),e.appendChild(r);const i=document.createElement("div");i.classList.add(ul.topRight,ul.corner),e.appendChild(i);const s=document.createElement("div");s.classList.add(ul.bottomLeft,ul.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(ul.bottomRight,ul.corner),e.appendChild(n),this._innerContainer=e,this._manualContainer=t;const o=UCe();this._cornerNameToContainerLookup={"top-left":r,"top-right":i,"bottom-left":s,"bottom-right":n,"top-leading":o?i:r,"top-trailing":o?r:i,"bottom-leading":o?n:s,"bottom-trailing":o?s:n},this._positionNameToContainerLookup={manual:t,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const t=e.position??"manual",{component:r,index:i}=e,s=this._positionNameToContainerLookup[t],n=i!=null&&i>-1;if(Xct(r.widget)&&r.widget.startup(),!n)return void s.appendChild(r.node);const o=Array.from(s.children);if(i===0)return void(s.firstChild?dX(r.node,s.firstChild):s.appendChild(r.node));i>=o.length?s.appendChild(r.node):dX(r.node,o[i])}_toPixelPosition(e){return{top:sM(e.top),left:sM(e.left),right:sM(e.right),bottom:sM(e.bottom)}}_findByComponent(e){return this._components.find(t=>t===e)??null}_findById(e){return this._components.find(({id:t})=>t===e)??null}_findByNode(e){return this._components.find(({node:t})=>t===e)??null}_getComponentsAtPosition(e,t){const r=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(r.children).map(i=>this._findByNode(i)).filter(v3).filter(i=>t.includeInternal||!this._componentMap.get(i)?.internal).map(({widget:i,node:s})=>i??s)}};h([f()],mp.prototype,"_locale",void 0),h([f()],mp.prototype,"container",null),h([f()],mp.prototype,"height",null),h([f({value:nbe})],mp.prototype,"padding",null),h([si("padding")],mp.prototype,"castPadding",null),h([f()],mp.prototype,"view",void 0),h([f()],mp.prototype,"width",null),mp=h([F("esri.views.ui.UI")],mp);const Zct=mp;function rne(e,t){return e&&"copyright"in e&&(!t||typeof e.originOf=="function"&&e.originOf("copyright")==="user")}function Yct(e,t){return e.length!==t.length||e.some((r,i)=>r.text!==t[i].text)}function nM(e,t,r){!r||!t||e.find(i=>i.layerView===t&&i.text===r)||e.push({text:r,layerView:t})}function Jct(e){return e.type==="bing-maps"}const Vg=[];let qw=class extends gA{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new Pt,this.view=null,this._allLayerViewsChange=t=>{this.handles.remove("suspension");const r=this.get("view.allLayerViews");r&&this.handles.add(r.map(i=>le(()=>[i.suspended,i.layer?.attributionVisible],()=>this._updateAttributionItems())),"suspension"),t&&t.removed&&t.removed.forEach(i=>{this._pendingAttributions.delete(i),this._fetchedAttributionData.delete(i)}),this._updateAttributionItems()},this.handles.add([qo(()=>this.view?.allLayerViews,"change",t=>this._allLayerViewsChange(t),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),Dc(()=>this.view?.stationary===!0,()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,t=e?.allLayerViews;Vg.length=0,e&&t?(t.forEach(r=>{if(r.suspended||!r.layer?.attributionVisible)return;const i=r.layer;if(rne(i,"user"))return void nM(Vg,r,i.copyright);if(i.hasAttributionData){if(this._fetchedAttributionData.has(r)){const n=this._fetchedAttributionData.get(r);return void(n?nM(Vg,r,this._getDynamicAttribution(n,e,i)):rne(i)&&nM(Vg,r,i.copyright))}return void this._fetchAttributionData(r)}const s=i.get("portalItem.accessInformation");nM(Vg,r,s||i.copyright)}),Yct(this.items,Vg)&&(this.items.removeAll(),this.items.addMany(Vg)),Vg.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const t=await Yu(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const r=t.ok?this._createContributionIndex(t.value,Jct(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,r)}this._updateAttributionItems()}_createContributionIndex(e,t){const r=e.contributors,i={};if(!r)return i;for(let s=0;s<r.length;s++){const n=r[s],o=n.coverageAreas;if(!o)return;for(const a of o){const l=a.bbox,c=a.zoomMin-(t&&a.zoomMin?1:0),u=a.zoomMax-(t&&a.zoomMax?1:0),d=new Pr({xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:st.WGS84}),p={extent:uC(d),attribution:n.attribution||"",score:a.score!=null?a.score:100,id:s};for(let g=c;g<=u;g++)i[g]??(i[g]=[]),i[g].push(p)}}return i.maxKey=Math.max.apply(null,Object.keys(i)),i}_getDynamicAttribution(e,t,r){const{extent:i,scale:s}=t;let n=r.tileInfo?.scaleToZoom(s)??0;if(n=Math.min(e.maxKey??0,Math.round(n)),!i||n==null||n<=-1)return"";const o=e[n],a=Y1(i.center.clone().normalize(),t.spatialReference),l=new Set;return o?o.filter(c=>{const u=c.id,d=!l.has(u)&&a&&c.extent&&U7(c.extent,a);return d&&l.add(u),d}).sort((c,u)=>u.score-c.score||c.objectId-u.objectId).map(c=>c.attribution).join(", "):""}};h([f({readOnly:!0,type:Pt})],qw.prototype,"items",void 0),h([f({readOnly:!0})],qw.prototype,"state",null),h([f()],qw.prototype,"view",void 0),qw=h([F("esri.widgets.Attribution.AttributionViewModel")],qw);const obe=qw,yw="esri-attribution",Gg={base:`${yw} esri-widget`,poweredBy:`${yw}__powered-by`,sources:`${yw}__sources`,open:`${yw}--open`,sourcesOpen:`${yw}__sources--open`,link:`${yw}__link`,widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let la=class extends Z1{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(r=>r.forEach(({target:i})=>this._checkSourceTextOverflow(i))),this.iconClass=Gg.widgetIcon,this.icon=null,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new obe}initialize(){this.addHandles(qo(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))}destroy(){this._resizeObserver?.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,t)=>(e.includes(t.text)||e.push(t.text),e),[]).join(this.itemDelimiter)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[Gg.open]:this._isOpen};return Dr("div",{bind:this,class:this.classes(Gg.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return Dr("div",{class:Gg.poweredBy},"Powered by"," ",Dr("a",{class:Gg.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,t=this._isInteractive,r=t?"0":"",{attributionText:i}=this,s={[Gg.sourcesOpen]:e,[Gg.interactive]:t};return Dr("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(Gg.sources,s),innerHTML:i,tabindex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let t=!1;const{clientHeight:r,clientWidth:i,scrollWidth:s}=e,n=s>i,o=this._attributionTextOverflowed!==n;if(this._attributionTextOverflowed=n,o&&(t=!0),this._isOpen){const a=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,a&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};h([f()],la.prototype,"_isOpen",void 0),h([f()],la.prototype,"_isInteractive",null),h([f()],la.prototype,"_attributionTextOverflowed",void 0),h([f()],la.prototype,"_prevSourceNodeHeight",void 0),h([f({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],la.prototype,"attributionText",null),h([f()],la.prototype,"iconClass",void 0),h([f()],la.prototype,"icon",void 0),h([f()],la.prototype,"itemDelimiter",void 0),h([f()],la.prototype,"label",null),h([f(),d2("esri/widgets/Attribution/t9n/Attribution")],la.prototype,"messages",void 0),h([f()],la.prototype,"view",null),h([f({type:obe})],la.prototype,"viewModel",void 0),h([ZD()],la.prototype,"_toggleState",null),la=h([F("esri.widgets.Attribution")],la);const Kct=la,Qct=e=>{let t=class extends e{constructor(...r){super(...r),this.goToOverride=null,this.view=null}callGoTo(r){const{view:i}=this;return LD(i),this.goToOverride?this.goToOverride(i,r):i.goTo(r.target,r.options)}};return h([f()],t.prototype,"goToOverride",void 0),h([f()],t.prototype,"view",void 0),t=h([F("esri.widgets.support.GoTo")],t),t},eut="esri.widgets.CompassViewModel";let av=class extends Qct(xe){constructor(e){super(e),this._handles=new gi,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(le(()=>this.view,this._updateRotationWatcher,Rr))}destroy(){xi(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){if(!this.get("view.ready"))return;const e={};this.view?.type==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const t=-e.heading;this.orientation={x:0,y:0,z:t}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?le(()=>e?.rotation,this._updateForRotation,Rr):le(()=>e?.camera,this._updateForCamera,Rr))}};h([f({readOnly:!0})],av.prototype,"canShowNorth",null),h([f()],av.prototype,"orientation",void 0),h([f({readOnly:!0})],av.prototype,"state",null),h([f()],av.prototype,"view",void 0),av=h([F(eut)],av);const abe=av,jg={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let Fh=class extends Z1{constructor(e,t){super(e,t),this.iconClass=jg.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new abe}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:t}=this.viewModel,r=t==="disabled",i=(t==="rotation"?"rotation":"compass")=="compass",s=r?-1:0,n={[jg.disabled]:r,[jg.interactive]:!r},o={[jg.northIcon]:i,[jg.rotationIcon]:!i},{messages:a}=this;return Dr("div",{bind:this,class:this.classes(jg.base,n),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":a.reset,title:a.reset},Dr("span",{"aria-hidden":"true",class:this.classes(jg.icon,o),styles:this._toRotationTransform(e)}),Dr("span",{class:jg.text},a.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};h([f()],Fh.prototype,"goToOverride",null),h([f()],Fh.prototype,"iconClass",void 0),h([f()],Fh.prototype,"icon",void 0),h([f()],Fh.prototype,"label",null),h([f(),d2("esri/widgets/Compass/t9n/Compass")],Fh.prototype,"messages",void 0),h([f()],Fh.prototype,"view",null),h([f({type:abe})],Fh.prototype,"viewModel",void 0),h([ZD()],Fh.prototype,"_reset",null),Fh=h([F("esri.widgets.Compass")],Fh);const tut=Fh,_w="esri-navigation-toggle",eu={base:`${_w} esri-widget`,button:`${_w}__button esri-widget--button`,activeButton:`${_w}__button--active`,panButton:`${_w}__button--pan`,rotateButton:`${_w}__button--rotate`,isLayoutHorizontal:`${_w}--horizontal`,rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let Xw=class extends xe{constructor(e){super(e),this.navigationMode="pan",this.view=null}initialize(){this.own(Dc(()=>this.view?.inputManager,()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){return this.get("view.ready")&&this.view?.type==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};h([f({readOnly:!0})],Xw.prototype,"state",null),h([f()],Xw.prototype,"navigationMode",void 0),h([f()],Xw.prototype,"view",void 0),Xw=h([F("esri.widgets.NavigationToggleViewModel")],Xw);const lbe=Xw;let Uh=class extends Z1{constructor(e,t){super(e,t),this.iconClass=eu.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new lbe}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",t=this.get("viewModel.navigationMode")==="pan",r={[eu.disabled]:e,[eu.isLayoutHorizontal]:this.layout==="horizontal"},i={[eu.activeButton]:t},s={[eu.activeButton]:!t},n=e?-1:0,o=this.messages.toggle;return Dr("div",{bind:this,class:this.classes(eu.base,r),onclick:this._toggle,onkeydown:this._toggle,tabIndex:n,"aria-label":o,title:o},Dr("div",{class:this.classes(eu.button,eu.panButton,i)},Dr("span",{class:eu.panIcon})),Dr("div",{class:this.classes(eu.button,eu.rotateButton,s)},Dr("span",{class:eu.rotationIcon})))}_toggle(){this.toggle()}};h([f()],Uh.prototype,"iconClass",void 0),h([f()],Uh.prototype,"icon",void 0),h([f()],Uh.prototype,"label",null),h([f({value:"vertical"})],Uh.prototype,"layout",null),h([f(),d2("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Uh.prototype,"messages",void 0),h([f()],Uh.prototype,"view",null),h([f({type:lbe})],Uh.prototype,"viewModel",void 0),h([ZD()],Uh.prototype,"_toggle",null),Uh=h([F("esri.widgets.NavigationToggle")],Uh);const rut=Uh,US={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let Jf=class extends Z1{constructor(){super(...arguments),this.enabled=!0,this.iconClass=null,this.icon=null,this.title=""}render(){const e=this.enabled?0:-1,t={[US.disabled]:!this.enabled,[US.interactive]:this.enabled};return Dr("div",{bind:this,class:this.classes(US.button,t),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},Dr("span",{"aria-hidden":"true",role:"presentation",class:this.classes(US.icon,this.iconClass??"")}),Dr("span",{class:US.iconText},this.title))}_triggerAction(){this.action.call(this)}};h([f()],Jf.prototype,"action",void 0),h([f()],Jf.prototype,"enabled",void 0),h([f()],Jf.prototype,"iconClass",void 0),h([f()],Jf.prototype,"icon",void 0),h([f()],Jf.prototype,"title",void 0),h([ZD()],Jf.prototype,"_triggerAction",null),Jf=h([F("esri.widgets.IconButton")],Jf);const ine=Jf;let Zw=class extends xe{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMaxScale");return t===0||e>t}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMinScale");return t===0||e<t}};h([f({readOnly:!0})],Zw.prototype,"canZoomIn",null),h([f({readOnly:!0})],Zw.prototype,"canZoomOut",null),h([f()],Zw.prototype,"view",void 0),Zw=h([F("esri.widgets.Zoom.ZoomConditions2D")],Zw);const iut=Zw;let Yw=class extends xe{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};h([f({readOnly:!0})],Yw.prototype,"canZoomIn",null),h([f({readOnly:!0})],Yw.prototype,"canZoomOut",null),h([f()],Yw.prototype,"view",void 0),Yw=h([F("esri.widgets.Zoom.ZoomConditions3D")],Yw);const sut=Yw;let m0=class extends xe{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){return this._zoomConditions!=null&&this._zoomConditions?.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new iut({view:e}):e.type==="3d"&&(this._zoomConditions=new sut({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():v8(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():v8(e.goTo({zoomFactor:.5}))}};h([f()],m0.prototype,"_zoomConditions",void 0),h([f()],m0.prototype,"canZoomIn",null),h([f()],m0.prototype,"canZoomOut",null),h([f({readOnly:!0})],m0.prototype,"state",null),h([f()],m0.prototype,"view",null),m0=h([F("esri.widgets.Zoom.ZoomViewModel")],m0);const cbe=m0,kS={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let gp=class extends Z1{constructor(e,t){super(e,t),this.iconClass=kS.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new cbe}initialize(){this._zoomInButton=new ine({action:this.zoomIn.bind(this),iconClass:kS.zoomInIcon}),this._zoomOutButton=new ine({action:this.zoomOut.bind(this),iconClass:kS.zoomOutIcon})}destroy(){this._zoomInButton=Re(this._zoomInButton),this._zoomOutButton=Re(this._zoomOutButton)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e=this.viewModel,t={[kS.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:r,canZoomOut:i}=e;this._zoomInButton.enabled=r,this._zoomOutButton.enabled=i;const{zoomIn:s,zoomOut:n}=this.messages;return this._zoomInButton.title=s,this._zoomOutButton.title=n,Dr("div",{class:this.classes(kS.base,t)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};h([f()],gp.prototype,"iconClass",void 0),h([f()],gp.prototype,"icon",void 0),h([f()],gp.prototype,"label",null),h([f({value:"vertical"})],gp.prototype,"layout",null),h([f(),d2("esri/widgets/Zoom/t9n/Zoom")],gp.prototype,"messages",void 0),h([f()],gp.prototype,"view",null),h([f({type:cbe})],gp.prototype,"viewModel",void 0),gp=h([F("esri.widgets.Zoom")],gp);const nut=gp;function out(e){return e?.view!==void 0}let FI=class extends Zct{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=t=>{this.components.forEach(r=>{const i=this._find(r),s=i?.widget;out(s)&&(s.view=t)})},this._componentsWatcher=(t,r)=>{this._removeComponents(r),this._addComponents(t),this._adjustPadding(t)}}initialize(){this.addHandles([le(()=>this.components,this._componentsWatcher,Rr),le(()=>this.view,this._updateViewAwareWidgets,Rr)])}_add(e,t,r,i,s){let n=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;n=this._createComponent(e)}super._add(n,t,r,i,s)}_removeComponents(e){e.forEach(t=>{const r=this._find(t);r&&(this.remove(r),r.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:t}=this.padding;this.padding=t}}_addComponents(e){this.constructed&&e.forEach(t=>this.add(this._createComponent(t),this._defaultPositionLookup[t]))}_createComponent(e){const t=this._createWidget(e);return new NI({id:e,node:t})}_createWidget(e){const{view:t}=this;switch(e){case"attribution":return new Kct({view:t});case"compass":return new tut({view:t});case"navigation-toggle":return new rut({view:t});case"zoom":return new nut({view:t})}}};h([f()],FI.prototype,"components",void 0),FI=h([F("esri.views.ui.DefaultUI")],FI);const ube=FI;let UI=class extends ube{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};h([f()],UI.prototype,"components",void 0),UI=h([F("esri.views.ui.3d.DefaultUI3D")],UI);const hbe=UI;let je=class extends HLe(ODe(YLe(ZNe))){constructor(e){super(e),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new Um({slicePlane:Vde},this),this._resourceController=Met(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new Qz({view:this}),this.labeler=new ev({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new bT,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new yv,this.environmentManager=new Ph,this.floors=new Pt,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new KNe({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new WQe,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new hbe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new TB,this.voxelWasm=null,this.voxelWasmPromise=null,vIe(),e&&e.environment||(this._defaults.environment=new Fw,this.environment=this._defaults.environment);const t=(r=null)=>{r!=null&&r.type===Zr.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async i=>{try{await i.when()}catch{}this._updatingChanged()}))};this.addHandles([qo(()=>this.map?.allLayers,"after-changes",r=>t(r),{onListenerAdd:()=>t(),onListenerRemove:()=>t(),sync:!0}),this.allLayerViews.on("after-changes",r=>this._updateUpdatingMonitors(r)),le(()=>this.map,r=>{r&&"load"in r&&r.load&&r.load().catch(()=>{})})]),this.inputManager=new rBe({view:this}),this.stateManager=new on({view:this})}initialize(){this.groundView=new hDe({view:this}),this._updateUpdatingMonitors();const e=()=>this._updateDefaultToMapOptions();this.addHandles(qo(()=>this.map?.allLayers,"after-changes",e,{onListenerAdd:e,onListenerRemove:e})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,t=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=t)},Rr),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,t=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=t)},Rr),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,t=>nxe(t>0?1e3/Math.ceil(t):0),Rr),this.updatingHandles.add(()=>this.map?.ground,e,_s),this.updatingHandles.add(()=>this.map?.ground?.opacity,()=>this._updateDefaultHitTestOptions(),_s),this.addHandles(le(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Vr))}destroy(){this.destroyed||(this.updatingHandles.removeAll(),this.removeAllHandles(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Re(this.sharedSymbolResources),this._set("labeler",Re(this.labeler)),this._set("deconflictor",Re(this.deconflictor)),this._resourceController=Re(this._resourceController),this._set("stateManager",Re(this.stateManager)),this._set("inputManager",Re(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",Re(this.environmentManager)),this.groundView=Re(this.groundView),this._exitBasemapTerrain(),this._stage?.destroy(),this.removeAllHandles(),this.updatingHandles.removeAll(),this.handles.removeAll())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){return this.basemapTerrain?.spatialReference}get animation(){return this.state?.animation}get camera(){return this.stateManager?.camera}set camera(e){this.stateManager&&(this.stateManager.camera=e)}get contentCamera(){return this.stateManager?.contentCamera}set contentCamera(e){this.stateManager&&(this.stateManager.contentCamera=e)}installContentCameraReset(e={sticky:!1}){return this.stateManager.installContentCameraReset(e)}get center(){return this.stateManager?.center}set center(e){this.stateManager&&(this.stateManager.center=e)}get clippingArea(){if(this.viewingMode==="global")return null;let e=this._userClippingArea||("clippingArea"in this.map?this.map?.clippingArea:void 0);return!this._userClippingArea&&!this.get("map.clippingEnabled")||e==null?(this._clippingArea=null,null):e instanceof Pr?this.spatialReference&&(e=oM(e,this.spatialReference),e==null)?(K.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),e.intersection(this._groundAndLayersExtent)==null&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(K.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(e){this.ready&&this.viewingMode==="global"&&e!=null?K.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=e}get renderDataExtent(){if(this.state.viewingMode===Ie.Global)return null;const e=this.renderSpatialReference,t=this.dataExtent;return t==null||e==null||t.spatialReference.equals(e)?t:oM(t,e)}get dataExtent(){let e=this._groundAndLayersExtent;const t=this.spatialReference||st.WGS84,r=oM(this.clippingArea,t);r!=null&&(e=e!=null?e.intersection(r):r);const i=this._get("dataExtent");return e!=null&&e.equals(i)?i:e}get _groundAndLayersExtent(){const e=this.spatialReference||st.WGS84;let t;const r=n=>{const o=oM(n,e);o!=null&&(t!=null?t.union(o):t=o.clone())},i=this.basemapTerrain;if(i?.spatialReference){const n=i.groundExtent;r(new Pr({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:i.spatialReference}))}if(this.map){const n=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||r(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(t==null)return null;t.hasZ?(t.zmin=Math.min(0,t.zmin??0),t.zmax=Math.max(0,t.zmax??0)):(t.zmin=0,t.zmax=0);const s=this._get("_groundAndLayersExtent");return t.equals(s)?s:t}set environment(e){e!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",e)}castEnvironment(e){return e?e instanceof Fw?e:e instanceof TT?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(e):Fw.fromWebsceneEnvironment(e):ro(Fw,e):new Fw}get extent(){return this.stateManager?.extent}set extent(e){this.stateManager&&(this.stateManager.extent=e)}get screenCenter(){return this.stateManager?.screenCenter}get frustum(){return this.stateManager?.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||(this.toolViewManager?.interacting??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state==null||this.state.stationary)}get navigating(){return this.state?.navigating??!1}get padding(){return this.stateManager?.padding}set padding(e){this.stateManager&&(this.stateManager.padding=e)}set qualityProfile(e){SI.isValidProfile(e)&&(SI.apply(e,this.qualitySettings),this._set("qualityProfile",e))}get qualityProfile(){return this._get("qualityProfile")||SI.getDefaultProfile()}set slicePlane(e){if(this._stage!=null&&this._stage.renderer.setParameters({slicePlane:e}),e==null)return void this._set("slicePlane",null);const t=this._propertiesPool.get("slicePlane");sb(e,t),this._set("slicePlane",t)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?DLe(this.scale,this.spatialReference):0}get scale(){return this.stateManager?.scale}set scale(e){this.stateManager&&(this.stateManager.scale=e)}get heightModelInfo(){const e=this.getDefaultHeightModelInfo();return e!=null?rb.deriveUnitFromSR(e,this.spatialReference):null}get updating(){if(this.destroyed)return!1;let e=0,t=this.layerViewManager.updating,r=t?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(s=>{if(s.isFulfilled()){if(s.updating){if(t=!0,s.suspended||a3(s))return;++r,e+=s.updatingProgress}}else++r});for(const s of this._updatingObjects)s!=null&&s.updating&&(r+=.1,e+=.5*.1);for(const s of this._updatingObjectsWithProgress)s!=null&&s.updating&&(++r,e+=s.updatingProgress);const i=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(t=!!(t||r>0||this.updatingHandles.updating||!this.ready||!this.stationary||i||this._createGraphicsViewController||this.inputManager?.updating||this.map?.allLayers?.some(s=>!s.isFulfilled())),t?(this._numUpdating=Math.max(r,this._numUpdating),e+=this._numUpdating-r):this._numUpdating=0,this._numUpdating>0?e/=this._numUpdating:e=t?0:1,this._get("updatingProgress")!==e){const s=performance.now();if(e<1){const n=Math.min((s-this._lastUpdateTime)/2e3,1);e=this.updatingProgress*(1-n)+e*n}this._set("updatingProgress",e),this._lastUpdateTime=t&&e<1?s:0}return t}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){const e=this._predeterminedViewingMode;if(e!=null)return TF(e);const t=this.spatialReference;return t?this.defaultsFromMap?.viewingMode!=null&&t.equals(this.defaultsFromMap.spatialReference)?TF(this.defaultsFromMap.viewingMode):WA(t,Ie.Global)?"global":"local":"global"}set viewingMode(e){this.ready?K.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",e)}get viewpoint(){return this.stateManager?.viewpoint}set viewpoint(e){this.stateManager&&(this.stateManager.viewpoint=e)}get zoom(){return this.stateManager.zoom}set zoom(e){this.stateManager&&(this.stateManager.zoom=e)}get resourceController(){return this._resourceController}get performanceInfo(){return new itt(this)}on(e,t,r,i){return this.viewEvents.on(e,t,r,i)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,t){if(!this.ready)return K.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const r=t?this.externalToInternalIntersectOptions(t):this._defaultToMapOptions,i=r.graphics!=null&&(r.graphics.include!=null||r.graphics.exclude!=null),s=yY(e)?gY(this,e):e,n=Sp(s);r.enableDraped=r.include&&!r.include.has(R0)||r.exclude&&r.exclude.has(R0);const o=this.sceneIntersectionHelper,a=eh(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=i?so.ALL:so.MIN,o.intersectIntersectorScreen(n,a,r),i){for(const l of a.results.all){const c=tV(l,this);if(c==null)return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(r.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(e){if(!this.ready)return K.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const t=(e.z==null?Mp(this.elevationProvider,e):null)??0;return no(e,vw,this.renderSpatialReference,t),this.state.camera.projectToScreen(vw,n8),Xu(n8[0],n8[1])}pixelSizeAt(e){return this.ready?e?(no(e,vw,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(vw)):0:(K.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(e){const t=this.basemapTerrain.overlayManager;return t?t.overlayPixelSizeInMapUnits(e):1}hitTest(e,t){if(!this.ready)return K.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const r=yY(e)?gY(this,e):e,i=zi(r.x,r.y),s=t?this.externalToInternalIntersectOptions(t):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=eh(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=so.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(i,n,s);const o=this._intersectResultsToHits(n.results.all,s.graphics),a=n.results.ground,l=Kse(a,this),c=l!=null&&"type"in l&&l.type==="integrated-mesh"?l:null,u={screenPoint:r,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:Cd(a)?a.distanceInRenderSpace:0,layer:c}};return Kr.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(u.intersector=n),Promise.resolve(u)}async popupHitTest(e){const{results:t,ground:r}=await Lct(this,e);let i=null;return!(t.length===0||Math.abs((t[0].distance??0)-r.distance)<1e-5)||r.layer&&r.layer.type==="integrated-mesh"||(i=r.mapPoint),{results:t,screenPoint:e,mapPoint:i}}goTo(e,t){return this.updatingHandles.addPromise(this.stateManager.goTo(e,t))}async whenAnalysisView(e){if(e.parent==null)throw new G("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});switch(e.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(e.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(e)}}whenLayerView(e){return super.whenLayerView(e)}async takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(t);return KU(r,t,this._pixelFormat())}async _takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(t);return QU(r,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(e){const t=this._completeSettings(e);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(t);return[QU(r[0],this._pixelFormat()),QU(r[1],this._pixelFormat())]}_completeSettings(e){const t=pct(e,this);return t.pixelRatio/=this.state.pixelRatio,yct(t,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:e=>this._takeScreenshot(e),takeScreenshotWithObjectAndLayerId:e=>this._takeScreenshotWithObjectAndLayerId(e)}}async takeScreenshotWithObjectAndLayerId(e){if(!ne("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const t=this._completeSettings(e);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(t),i=KU(r[0],t,this._pixelFormat()),s=this._completeSettings(e);return s.format="png",[i,KU(r[1],s,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(this._stage.renderView.objectAndLayerIdRenderHelper==null)throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return SY.importLayerView(e)}hasLayerViewModule(e){return SY.hasLayerViewModule(e)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map?.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null}async validate(){let e=jct(this.type);const t=ne("safari");if(t&&t<9&&(e=new G("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:t})),e!=null)throw K.getLogger(this).warn("#validate()",e.message),e}get _predeterminedViewingMode(){const e=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return e!=null?wY(e):null}getSpatialReferenceSupport({spatialReference:e,layer:t}){const r=this._predeterminedViewingMode;if(r!=null)return this._validateSpatialReferenceForViewingMode(e,t,r)?{constraints:this._makeSpatialReferenceConstraints(e,t,r)}:null;const i=this._validateSpatialReferenceForViewingMode(e,t,Ie.Local),s=this._validateSpatialReferenceForViewingMode(e,t,Ie.Global);return i||s?i&&s?{constraints:this._makeSpatialReferenceConstraints(e,t,null)}:i?{constraints:this._makeSpatialReferenceConstraints(e,t,Ie.Local)}:{constraints:this._makeSpatialReferenceConstraints(e,t,Ie.Global)}:null}_validateSpatialReferenceForViewingMode(e,t,r){return!!WA(e,r)&&(t==null||!!BZ(t)||(!vC(t)||t5(t,e,r)!=null)&&(!zZ(t)||r!==Ie.Global))}_makeSpatialReferenceConstraints(e,t,r){if(t==null)return[{spatialReference:e,viewingMode:r}];const i=e.isWebMercator,s=e.isWGS84;return BZ(t)&&(i||s)?!s||r===Ie.Local||AW(t.tileInfo,t.fullExtent,e,Ie.Global)===null?[{spatialReference:e,viewingMode:r},{spatialReference:st.WebMercator,viewingMode:r}]:[{spatialReference:i?st.WGS84:st.WebMercator,viewingMode:r}]:vC(t)||zZ(t)||!i&&!s?vC(t)&&i&&r!==Ie.Global?[{spatialReference:e,viewingMode:r},{spatialReference:st.WGS84,viewingMode:Ie.Local}]:[{spatialReference:e,viewingMode:r}]:[{spatialReference:e,viewingMode:r},{spatialReference:i?st.WGS84:st.WebMercator,viewingMode:r}]}_validateSpatialReference(e){const t=this.getSpatialReferenceSupport({spatialReference:e})!=null,r=this._predeterminedViewingMode;return t||(r!=null?K.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${TF(r)} viewing mode.`):e.isGeographic&&K.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),t}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}computeMapPointFromVec3d(e,t){let r=this.spatialReference||st.WGS84;return yn(e,this.renderSpatialReference,e,r)||(r=st.WGS84,yn(e,this.renderSpatialReference,e,r)),t?(t.x=e[0],t.y=e[1],t.z=e[2],t.spatialReference=r):t=new ut(e,r),t}trackGraphicState(e){if(!e.graphic)return K.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const t=this.getViewForGraphic(e.graphic);let r=null,i=!1;const s=n=>{!i&&n!=null&&"processor"in n&&n.processor?.type==="graphics-3d"&&n.processor.graphicsCore&&(r=n.processor.graphicsCore.trackGraphicState(e))};return t!=null?s(t):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{i=!0,r!=null&&(r.remove(),r=null)}}}highlight(e){if(Array.isArray(e))return Jx(e.map(r=>this.highlight(r)));if(Pt.isCollection(e))return Jx(e.toArray().map(r=>this.highlight(r)));const t=this.getViewForGraphic(e);return t&&"highlight"in t?t.highlight(e):Xo()}maskOccludee(e){if(!e)return K.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const t=this.getViewForGraphic(e);let r=null,i=!1;const s=n=>{!i&&n!=null&&Nct(n)&&(r=n.maskOccludee(e))};return t!=null?s(t):this.whenViewForGraphic(e,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{i=!0,r!=null&&(r.remove(),r=null)}}}getViewForGraphic(e){return e.layer===this.graphics?this.graphicsView:e.layer?this.allLayerViews.find(t=>t.layer===e.layer):null}graphicChanged(e){this.graphicsView!=null&&this.graphicsView.graphicChanged(e)}async whenViewForGraphic(e,t){if(e.layer===this)return await eT(()=>this.graphicsView),this.graphicsView;if(!e.layer||!this.map)throw new G("no-view-for-graphic");return t&&t.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise((r,i)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(e.layer)&&(s.remove(),this.whenLayerView(e.layer).then(r,i))})}):this.whenLayerView(e.layer)}externalToInternalIntersectOptions(e){const t=this._externalToInternalRenderItems(e.include,JC.INCLUDE),r=this._externalToInternalRenderItems(e.exclude,JC.EXCLUDE);return{include:t.layerUids,exclude:r.layerUids,graphics:{include:t.graphicUids,exclude:r.graphicUids}}}_intersectResultToMapPoint(e,t){return e.getIntersectionPoint(vw)?(t=this.computeMapPointFromVec3d(vw,t),e.intersector===Ii.TERRAIN&&this.basemapTerrain&&(t.z=Mp(this.basemapTerrain,t)??0),t):null}_intersectResultsToHits(e,t){const r=new Array;let i=null;for(let s=0;s<e.length;s++){const n=e[s],o=Kse(n,this);if(o!=null&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=tV(n,this);if(a==null)continue;if(a.type==="graphic"){if(i==null&&s!==e.length-1&&(i=new Set),i!=null){const u=this._getGraphicFilterUid(a.graphic);if(i.has(u))continue;i.add(u)}if(!this._testGraphicUidFilter(t,a.graphic))continue}const l=this._intersectResultToMapPoint(n),c=n.distanceInRenderSpace;r.push({...a,mapPoint:l,distance:c})}return r}_getGraphicFilterUid(e){const t=e.sourceLayer,r=e.layer,i=t&&"objectIdField"in t?t:r&&"objectIdField"in r?r:t;if(i){const s=i.objectIdField??FLe,n=e.attributes?.[s];if(n)return`o-${i.id}-${n}`}return`u-${e.uid}`}_testGraphicUidFilter(e,t){const r=this._getGraphicFilterUid(t);return e==null||(e.include==null||e.include.has(r))&&(e.exclude==null||!e.exclude.has(r))}_externalToInternalRenderItems(e,t,r={layerUids:void 0,graphicUids:void 0}){if(!e)return r;if(e instanceof v1)aut(r,this._getGraphicFilterUid(e)),t===JC.INCLUDE&&(this.graphicsView!=null&&e.layer===this?zS(r,this.graphicsView.processor.layer.id):e.layer&&zS(r,e.layer.uid));else if(I8(e))for(const i of e)i===this.graphics&&this.graphicsView!=null?zS(r,this.graphicsView.processor.layer.id):i===this.map.ground?zS(r,R0):this._externalToInternalRenderItems(i,t,r);else"uid"in e&&zS(r,e.uid);return r}_initBasemapTerrain(){this._set("basemapTerrain",new Ost({view:this})),this._set("elevationProvider",new VE({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new ka({view:this})),this._set("featureTiles",new Jn({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const e=()=>{const t=this.basemapTerrain?.extent;if(this.clippingArea||t)if(t&&this.basemapTerrain.spatialReference){const r=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?g2(QD(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea!=null?this.featureTiles.filterExtent=this.clippingArea.intersection(r):this.featureTiles.filterExtent=r}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>Kr.FEATURE_TILE_TREE_SHOW_TILES,t=>{t&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(ue(()=>import("./FeatureTileTree3DDebugger.55e39a48.js"),["assets/FeatureTileTree3DDebugger.55e39a48.js","assets/TileTreeDebugger.f46f3b0e.js"])).then(({FeatureTileTree3DDebugger:r})=>{!this._featureTreeDebugger&&Kr.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new r({view:this}))}):t||!this._featureTreeDebugger||Kr.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},_s),this.updatingHandles.add(()=>this.clippingArea,e,_s),this.updatingHandles.add(()=>this.basemapTerrain.extent,e,_s)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const e=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(e)||this._set("mapCoordsHelper",new pet(this.map,e));const t=this.state.isGlobal,r=LLe(t,e);r!==this.renderSpatialReference&&(this._set("renderCoordsHelper",nD.create(this.state.viewingMode,r)),t||this.addHandles(le(()=>this.basemapTerrain?.extent,i=>{const s=this.renderCoordsHelper.spatialReference;i==null||i[0]===0&&i[1]===0&&i[2]===0&&i[3]===0||!k3(i,this.basemapTerrain.spatialReference,sne,s)||(this.renderCoordsHelper.extent=sne)},Vr),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(FT/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(e=null){e!=null&&e.type===Zr.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(t=>{t.destroyed||(this.addHandles(le(()=>[t.updating,t.updatingProgress],()=>this._updatingChanged(),Vr),"updatingMonitors"),t.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(e,t){if(!this.overlay||!this.overlay.hasVisibleItems)return t;const r=e.getContext("2d");return r.putImageData(t,0,0),this.overlay.renderCanvas(e),r.getImageData(0,0,t.width,t.height)}_initStage(){const e={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(s,n)=>this._renderScreenshotOverlay(s,n)}},t=new qQe(this.state.viewingMode,s=>this._stage.layers.forAll(s),this);this._set("sceneIntersectionHelper",t);const r=GD(this.surface);this._stage=new oc({view:this,options:e,container:r}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderer.setParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),Rr),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,s=>this._stage.renderer.setParameters({highQualityTransparency:s}),Rr),le(()=>this.magnifier,s=>this._stage.renderView.magnifier=s,_s),this.on("pointer-move",()=>this._stage?.renderer.resetAnimation()),ey(this._stage.renderView.canvas,"webglcontextlost",s=>this.fatalError=new G("webgl-context-lost",s.statusMessage))],"stage");const i=()=>{this._stage.renderer.setParameters({defaultHighlightOptions:TB.toEngineOptions(this.highlightOptions)})};this.addHandles(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],i),"stage"),i(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(FT/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=Re(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(e){this._exitSurface(),this.state.init(e,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new ott({view:this,viewingMode:e,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const e=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e,e),this._updatingChanged()}async _createGraphicsViewAsync(e){const t=(await ue(()=>import("./GraphicsView3D.a72f0848.js"),["assets/GraphicsView3D.a72f0848.js","assets/GraphicsProcessor.f6fb4329.js","assets/diffUtils.f0876598.js","assets/Query.e586665e.js","assets/Graphics3DObjectStates.1983c1d0.js","assets/UniqueValueRenderer.0143139a.js","assets/ColorStop.f762bde8.js","assets/colorRamps.80cb140e.js","assets/jsonUtils.4745b876.js","assets/DictionaryLoader.90c8c47c.js","assets/FieldsIndex.09813895.js","assets/heatmapUtils.32e9a30b.js","assets/defaults.83793da7.js","assets/defaultsJSON.a416f32c.js","assets/optimizedFeatureQueryEngineAdapter.b17e3ee2.js","assets/centroid.66ea1f85.js","assets/PooledRBush.b9188fbe.js","assets/quickselect.b8e0afc3.js","assets/popupUtils.5174221c.js"])).default;Jt(e),await eT(()=>this.basemapTerrain?.ready,e),this._set("graphicsView",new t({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const e=wY(this.viewingMode);if(e===Ie.Global&&(this._clippingArea=null),this._initSurface(e),this._set("ready",!0),this.addHandles(qo(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const r=this.get("map.initialViewProperties.environment");r&&(this.environment=r)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const t=this._resolveWhenReady;this._resolveWhenReady=[],t.forEach(r=>r(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(R0);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(e.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(R0);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&e.opacity<1&&this._defaultHitTestOptions.exclude.add(e.uid)}}addVoxelLayerViewToWasm(e){return this.voxelWasm==null?(this.voxelWasmPromise==null&&(this.voxelWasmPromise=ue(()=>import("./VoxelWasmPerSceneView.303bb468.js"),[]).then(t=>(this.voxelWasm=new t.default(this),this.voxelWasm))),this.voxelWasmPromise.then(t=>t.addVoxelLayer(e))):this.voxelWasm.addVoxelLayer(e)}removeVoxelLayerViewFromWasm(e){this.voxelWasm!=null&&this.voxelWasm.removeVoxelLayer(e)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function zS(e,t){e.layerUids||(e.layerUids=new Set),e.layerUids.add(t)}function aut(e,t){e.graphicUids||(e.graphicUids=new Set),e.graphicUids.add(t)}function oM(e,t){return e!=null&&Dm(e.spatialReference,t)?g2(e,t):null}var JC;je.type="3d",h([f()],je.prototype,"_userClippingArea",void 0),h([f()],je.prototype,"_resourceController",void 0),h([f()],je.prototype,"_stage",void 0),h([f({readOnly:!0})],je.prototype,"deconflictor",void 0),h([f({readOnly:!0})],je.prototype,"labeler",void 0),h([f(Ek(bT,"analyses"))],je.prototype,"analyses",void 0),h([f({type:xT,readOnly:!0})],je.prototype,"animation",null),h([f({readOnly:!0})],je.prototype,"basemapTerrain",void 0),h([f({readOnly:!0})],je.prototype,"elevationProvider",void 0),h([f()],je.prototype,"camera",null),h([f({type:Wu})],je.prototype,"contentCamera",null),h([f({readOnly:!0})],je.prototype,"canvas",void 0),h([f({type:ut})],je.prototype,"center",null),h([f({type:Pr})],je.prototype,"clippingArea",null),h([f({type:yv})],je.prototype,"constraints",void 0),h([f({type:Pr,readOnly:!0})],je.prototype,"renderDataExtent",null),h([f({type:Pr,readOnly:!0})],je.prototype,"dataExtent",null),h([f({type:Pr,readOnly:!0})],je.prototype,"_groundAndLayersExtent",null),h([f({value:null,type:Fw})],je.prototype,"environment",null),h([si("environment")],je.prototype,"castEnvironment",null),h([f({readOnly:!0})],je.prototype,"environmentManager",void 0),h([f({type:Pr})],je.prototype,"extent",null),h([f()],je.prototype,"floors",void 0),h([f()],je.prototype,"screenCenter",null),h([f()],je.prototype,"frustum",null),h([f({type:Number,readOnly:!0})],je.prototype,"fullOpacity",void 0),h([f({readOnly:!0})],je.prototype,"graphicsView",void 0),h([f({readOnly:!0})],je.prototype,"analysisViewManager",void 0),h([f()],je.prototype,"groundView",void 0),h([f({type:Boolean})],je.prototype,"initialExtentRequired",null),h([f()],je.prototype,"_defaultsFromMapSettings",null),h([f()],je.prototype,"interacting",null),h([f()],je.prototype,"stationary",null),h([f()],je.prototype,"navigating",null),h([f()],je.prototype,"map",void 0),h([f({readOnly:!0})],je.prototype,"mapCoordsHelper",void 0),h([f()],je.prototype,"padding",null),h([f({type:ka,readOnly:!0})],je.prototype,"pointsOfInterest",void 0),h([f({type:Jn,readOnly:!0})],je.prototype,"featureTiles",void 0),h([f()],je.prototype,"_featureTreeDebugger",void 0),h([f({type:Boolean})],je.prototype,"screenSizePerspectiveEnabled",void 0),h([f({constructOnly:!0})],je.prototype,"deactivatedWebGLExtensions",void 0),h([f({constructOnly:!0})],je.prototype,"debugWebGLExtensions",void 0),h([f({constructOnly:!0})],je.prototype,"renderCanvas",void 0),h([f({constructOnly:!0})],je.prototype,"state",void 0),h([f({readOnly:!0})],je.prototype,"inputManager",void 0),h([f({readOnly:!0})],je.prototype,"stateManager",void 0),h([f({type:["low","medium","high"]})],je.prototype,"qualityProfile",null),h([f({type:Vte,get(){let e=this._get("qualitySettings");return e||(e=new Vte,SI.apply(this.qualityProfile,e)),e}})],je.prototype,"qualitySettings",void 0),h([f()],je.prototype,"slicePlane",null),h([f({readOnly:!0})],je.prototype,"typeSpecificPreconditionsReady",null),h([f({readOnly:!0})],je.prototype,"renderCoordsHelper",void 0),h([f({readOnly:!0})],je.prototype,"sceneIntersectionHelper",void 0),h([f({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],je.prototype,"resolution",null),h([f({type:Number})],je.prototype,"scale",null),h([f()],je.prototype,"heightModelInfo",null),h([f()],je.prototype,"spatialReference",void 0),h([f({type:Boolean,constructOnly:!0})],je.prototype,"alphaCompositingEnabled",void 0),h([f({constructOnly:!0})],je.prototype,"preserveDrawingBufferEnabled",void 0),h([f({type:Boolean})],je.prototype,"supersampleScreenshotsEnabled",void 0),h([f({readOnly:!0})],je.prototype,"type",void 0),h([f(),si(e=>e instanceof ube?e:Yx(hbe,e))],je.prototype,"ui",void 0),h([f({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating"]})],je.prototype,"updating",null),h([f()],je.prototype,"_updatingObjects",null),h([f()],je.prototype,"_updatingObjectsWithProgress",null),h([f({type:Number,readOnly:!0,dependsOn:["updating"]})],je.prototype,"updatingProgress",void 0),h([f({type:["global","local"]})],je.prototype,"viewingMode",null),h([f({type:zl})],je.prototype,"viewpoint",null),h([f({type:Number})],je.prototype,"zoom",null),h([f({type:TB})],je.prototype,"highlightOptions",void 0),je=h([F("esri.views.SceneView")],je),function(e){e[e.INCLUDE=0]="INCLUDE",e[e.EXCLUDE=1]="EXCLUDE"}(JC||(JC={}));const vw=C(),n8=zi(),sne=Nt(),lut=je;class ZW{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array($8),this._values=new Map,this.multipleOriginsSupported=!0}clone(t){const r=new ZW,i=this._originStores[mr.DEFAULTS];i&&i.forEach((s,n)=>{r.set(n,ye(s),mr.DEFAULTS)});for(let s=mr.SERVICE;s<$8;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{t&&t.has(a)||r.set(a,ye(o),s)})}return r}get(t,r){const i=r===void 0?this._values:this._originStores[r];return i?i.get(t):void 0}keys(t){const r=t==null?this._values:this._originStores[t];return r?[...r.keys()]:[]}set(t,r,i=mr.USER){let s=this._originStores[i];if(s||(s=new Map,this._originStores[i]=s),s.set(t,r),!this._values.has(t)||this._propertyOriginMap.get(t)<=i){const n=this._values.get(t);return this._values.set(t,r),this._propertyOriginMap.set(t,i),n!==r}return!1}delete(t,r=mr.USER){const i=this._originStores[r];if(!i)return;const s=i.get(t);if(i.delete(t),this._values.has(t)&&this._propertyOriginMap.get(t)===r){this._values.delete(t);for(let n=r-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(t)){this._values.set(t,o.get(t)),this._propertyOriginMap.set(t,n);break}}}return s}has(t,r){const i=r===void 0?this._values:this._originStores[r];return!!i&&i.has(t)}revert(t,r){for(;r>0&&!this.has(t,r);)--r;const i=this._originStores[r],s=i&&i.get(t),n=this._values.get(t);return this._values.set(t,s),this._propertyOriginMap.set(t,r),n!==s}originOf(t){return this._propertyOriginMap.get(t)||mr.DEFAULTS}forEach(t){this._values.forEach(t)}}const dbe=e=>{let t=class extends e{constructor(...r){super(...r);const i=Lc(this),s=i.store,n=new ZW;i.store=n,bce(i,s,n)}read(r,i){xce(this,r,i)}getAtOrigin(r,i){const s=o8(this),n=F0(i);if(typeof r=="string")return s.get(r,n);const o={};return r.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(r){return f$(this.originIdOf(r))}originIdOf(r){return o8(this).originOf(r)}revert(r,i){const s=o8(this),n=F0(i),o=Lc(this);let a;a=typeof r=="string"?r==="*"?s.keys(n):[r]:r,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return t=h([F("esri.core.ReadOnlyMultiOriginJSONSupport")],t),t};function o8(e){return Lc(e).store}let nne=class extends dbe(xe){};nne=h([F("esri.core.ReadOnlyMultiOriginJSONSupport")],nne);const cut=e=>{let t=class extends e{constructor(...r){super(...r)}clear(r,i="user"){return a8(this).delete(r,F0(i))}write(r,i){return Ece(this,r=r||{},i),r}setAtOrigin(r,i,s){Lc(this).setAtOrigin(r,i,F0(s))}removeOrigin(r){const i=a8(this),s=F0(r),n=i.keys(s);for(const o of n)i.originOf(o)===s&&i.set(o,i.get(o,s),mr.USER)}updateOrigin(r,i){const s=a8(this),n=F0(i),o=this.get(r);for(let a=n+1;a<$8;++a)s.delete(r,a);s.set(r,o,n)}toJSON(r){return this.write({},r)}};return t=h([F("esri.core.WriteableMultiOriginJSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function a8(e){return Lc(e).store}const pbe=e=>{let t=class extends cut(dbe(e)){constructor(...r){super(...r)}};return t=h([F("esri.core.MultiOriginJSONSupport")],t),t};let rV=class extends pbe(xe){};rV=h([F("esri.core.MultiOriginJSONSupport")],rV);function uut(e){return e&&"getAtOrigin"in e&&"originOf"in e}function one(e){e&&e.writtenProperties&&e.writtenProperties.forEach(({target:t,propName:r,newOrigin:i})=>{uut(t)&&i&&t.originOf(r)!==i&&t.updateOrigin(r,i)})}let g0=class extends Pe{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};h([f({type:String,json:{write:!0}})],g0.prototype,"facilityIdField",void 0),h([f({type:String,json:{write:!0}})],g0.prototype,"layerId",void 0),h([f({type:String,json:{write:!0}})],g0.prototype,"nameField",void 0),h([f({type:String,json:{write:!0}})],g0.prototype,"siteIdField",void 0),h([f({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],g0.prototype,"sublayerId",void 0),g0=h([F("esri.layers.support.FacilityLayerInfo")],g0);const hut=g0;let kh=class extends Pe{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};h([f({type:String,json:{write:!0}})],kh.prototype,"facilityIdField",void 0),h([f({type:String,json:{write:!0}})],kh.prototype,"layerId",void 0),h([f({type:String,json:{write:!0}})],kh.prototype,"levelIdField",void 0),h([f({type:String,json:{write:!0}})],kh.prototype,"levelNumberField",void 0),h([f({type:String,json:{write:!0}})],kh.prototype,"longNameField",void 0),h([f({type:String,json:{write:!0}})],kh.prototype,"shortNameField",void 0),h([f({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],kh.prototype,"sublayerId",void 0),h([f({type:String,json:{write:!0}})],kh.prototype,"verticalOrderField",void 0),kh=h([F("esri.layers.support.LevelLayerInfo")],kh);const dut=kh;let lv=class extends Pe{constructor(e){super(e),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};h([f({type:String,json:{write:!0}})],lv.prototype,"layerId",void 0),h([f({type:String,json:{write:!0}})],lv.prototype,"nameField",void 0),h([f({type:String,json:{write:!0}})],lv.prototype,"siteIdField",void 0),h([f({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],lv.prototype,"sublayerId",void 0),lv=h([F("esri.layers.support.SiteLayerInfo")],lv);const put=lv;let Jw=class extends Pe{constructor(e){super(e),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};h([f({type:dut,json:{write:!0}})],Jw.prototype,"levelLayer",void 0),h([f({type:hut,json:{write:!0}})],Jw.prototype,"facilityLayer",void 0),h([f({type:put,json:{write:!0}})],Jw.prototype,"siteLayer",void 0),Jw=h([F("esri.support.MapFloorInfo")],Jw);const fut=Jw,mut=Symbol("WebScene"),gut="webscene:failed-to-copy-embedded-resources",yut="webscene:schema-validation";function _ut(){return new G(gut,"Copying of embedded resources is currently not supported")}function vut(e){return new G(yut,"Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:e})}async function but(e,t={},r){await e.load(r);const i=sf(e.itemUrl,"resources"),{start:s=1,num:n=10,sortOrder:o="asc",sortField:a="created"}=t,l={query:{start:s,num:n,sortOrder:o,sortField:a,token:e.apiKey},signal:r?.signal},c=await e.portal.request(i,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:u,size:d,resource:p})=>({created:new Date(u),size:d,resource:e.resourceFromPath(p)}))}}async function wut(e,t,r,i){if(!e.hasPath())throw new G(`portal-item-resource-${t}:invalid-path`,"Resource does not have a valid path");const s=e.portalItem;await s.load(i);const n=sf(s.userItemUrl,t==="add"?"addResources":"updateResources"),[o,a]=fbe(e.path),l=await mbe(r),c=new FormData;return o&&o!=="."&&c.append("resourcesPrefix",o),i!=null&&i.compress&&c.append("compress","true"),c.append("fileName",a),c.append("file",l,a),c.append("f","json"),i!=null&&i.access&&c.append("access",i.access),await s.portal.request(n,{method:"post",body:c,signal:i?.signal}),e}async function xut(e,t,r){if(!t.hasPath())throw new G("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(r);const i=sf(e.userItemUrl,"removeResources");await e.portal.request(i,{method:"post",query:{resource:t.path},signal:r?.signal}),t.portalItem=null}async function Tut(e,t){await e.load(t);const r=sf(e.userItemUrl,"removeResources");return e.portal.request(r,{method:"post",query:{deleteAll:!0},signal:t?.signal})}function fbe(e){const t=e.lastIndexOf("/");return t===-1?[".",e]:[e.slice(0,t),e.slice(t+1)]}function YW(e){const[t,r]=Sut(e),[i,s]=fbe(t);return[i,s,r]}function Sut(e){const t=sTe(e);return t==null?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}async function mbe(e){return e instanceof Blob?e:(await ii(e.url,{responseType:"blob"})).data}function Eut(e,t){if(!e.hasPath())return null;const[r,,i]=YW(e.path);return e.portalItem.resourceFromPath(sf(r,t+i))}function gbe(e,t){if(!e.hasPath())return null;const[r,,i]=YW(e.path);return e.portalItem.resourceFromPath(sf(r,t+i))}var QE=Object.freeze(Object.defineProperty({__proto__:null,addOrUpdateResource:wut,contentToBlob:mbe,fetchResources:but,getSiblingOfSameType:Eut,getSiblingOfSameTypeI:gbe,removeAllResources:Tut,removeResource:xut,splitPrefixFileNameAndExtension:YW},Symbol.toStringTag,{value:"Module"}));async function ane(e,t,r){if(!t||!t.resources)return;const i=t.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=t.portalItem;const s=new Set(t.resources.toKeep.map(c=>c.resource.path)),n=new Set,o=[];s.forEach(c=>{i.delete(c),e.paths.push(c)});for(const c of t.resources.toUpdate)if(i.delete(c.resource.path),s.has(c.resource.path)||n.has(c.resource.path)){const{resource:u,content:d,finish:p,error:g}=c,y=gbe(u,y7());e.paths.push(y.path),o.push(lne({resource:y,content:d,compress:c.compress,finish:p,error:g},r))}else e.paths.push(c.resource.path),o.push(Cut(c,r)),n.add(c.resource.path);for(const c of t.resources.toAdd)o.push(lne(c,r)),e.paths.push(c.resource.path);if(i.forEach(c=>{if(t.portalItem){const u=t.portalItem.resourceFromPath(c);o.push(u.portalItem.removeResource(u).catch(()=>{}))}}),o.length===0)return;const a=await Sc(o);Jt(r);const l=a.filter(c=>"error"in c).map(c=>c.error);if(l.length>0)throw new G("save:resources","Failed to save one or more resources",{errors:l})}async function lne(e,t){const r={...t??{},compress:e.compress},i=await Yu(e.resource.portalItem.addResource(e.resource,e.content,r));if(i.ok!==!0)throw e.error?.(i.error),i.error;e.finish?.(e.resource)}async function Cut(e,t){const r=await Yu(e.resource.update(e.content,t));if(r.ok!==!0)throw e.error?.(r.error),r.error;e.finish?.(e.resource)}const Aut={width:600,height:400},aM=1.5;function Out(e,t){t=t||Aut;let{width:r,height:i}=t;const s=r/i;return s<aM?i=r/aM:s>aM&&(r=i*aM),r>e.width&&(i*=e.width/r,r=e.width),i>e.height&&(r*=e.height/i,i=e.height),{width:Math.round(r),height:Math.round(i)}}function cne(e){return{enabled:!!e?.length}}var iV;let Kw=iV=class extends Pe{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new iV({exactMatch:this.exactMatch,type:this.type,name:this.name})}};h([f({type:Boolean,json:{write:!0}})],Kw.prototype,"exactMatch",void 0),h([f({type:String,json:{write:!0}})],Kw.prototype,"name",void 0),h([Wt(xH)],Kw.prototype,"type",void 0),Kw=iV=h([F("esri.webdoc.applicationProperties.SearchLayerField")],Kw);const Rut=Kw;var sV;let Qw=sV=class extends Pe{constructor(e){super(e),this.field=null,this.id=null,this.subLayer=null}clone(){return new sV(ye({field:this.field,id:this.id,subLayer:this.subLayer}))}};h([f({type:Rut,json:{write:{isRequired:!0}}})],Qw.prototype,"field",void 0),h([f({type:String,json:{write:{isRequired:!0}}})],Qw.prototype,"id",void 0),h([f({type:Ps,json:{write:!0}})],Qw.prototype,"subLayer",void 0),Qw=sV=h([F("esri.webdoc.applicationProperties.SearchLayer")],Qw);const Put=Qw;var nV;let ex=nV=class extends Pe{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new nV({exactMatch:this.exactMatch,type:this.type,name:this.name})}};h([f({type:Boolean,json:{write:!0}})],ex.prototype,"exactMatch",void 0),h([f({type:String,json:{write:!0}})],ex.prototype,"name",void 0),h([Wt(xH)],ex.prototype,"type",void 0),ex=nV=h([F("esri.webdoc.applicationProperties.SearchTableField")],ex);const Mut=ex;var oV;let eC=oV=class extends Pe{constructor(e){super(e),this.field=null,this.id=null}clone(){return new oV(ye({field:this.field,id:this.id}))}};h([f({type:Mut,json:{write:{isRequired:!0}}})],eC.prototype,"field",void 0),h([f({type:String,json:{write:{isRequired:!0}}})],eC.prototype,"id",void 0),eC=oV=h([F("esri.webdoc.applicationProperties.SearchTable")],eC);const Iut=eC;var aV;const ybe=Pt.ofType(Put),_be=Pt.ofType(Iut);let yp=aV=class extends Pe{constructor(e){super(e),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new ybe,this.tables=new _be}readAddressSearchEnabled(e){return!e}writeAddressSearchEnabled(e,t,r){t[r]=!e}clone(){return new aV(ye({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};h([f({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],yp.prototype,"addressSearchEnabled",void 0),h([br("addressSearchEnabled")],yp.prototype,"readAddressSearchEnabled",null),h([Yt("addressSearchEnabled")],yp.prototype,"writeAddressSearchEnabled",null),h([f({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],yp.prototype,"enabled",void 0),h([f({type:String,json:{write:!0}})],yp.prototype,"hintText",void 0),h([f({type:ybe,json:{write:{overridePolicy:cne},origins:{"web-scene":{write:{isRequired:!0}}}}})],yp.prototype,"layers",void 0),h([f({type:_be,json:{read:!0,write:{overridePolicy:cne}}})],yp.prototype,"tables",void 0),yp=aV=h([F("esri.webdoc.applicationProperties.Search")],yp);const $ut=yp;var lV;let kI=lV=class extends Pe{constructor(e){super(e),this.search=null}clone(){return new lV(ye({search:this.search}))}};h([f({type:$ut,json:{write:!0}})],kI.prototype,"search",void 0),kI=lV=h([F("esri.webdoc.applicationProperties.Viewing")],kI);const Lut=kI;var cV;let zI=cV=class extends Pe{constructor(e){super(e),this.viewing=null}clone(){return new cV({viewing:this.viewing?this.viewing.clone():null})}};h([f({type:Lut,json:{write:!0}})],zI.prototype,"viewing",void 0),zI=cV=h([F("esri.webscene.ApplicationProperties")],zI);const Dut=zI;var uV;let cv=uV=class extends Pe{constructor(e){super(e),this.environment=new TT,this.spatialReference=null,this.viewpoint=null}set viewingMode(e){this._set("viewingMode",e)}clone(){return new uV({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})}};h([f({type:TT,json:{write:{isRequired:!0}}})],cv.prototype,"environment",void 0),h([f({type:st})],cv.prototype,"spatialReference",void 0),h([f({type:["local","global"]})],cv.prototype,"viewingMode",null),h([f({type:zl,json:{write:{isRequired:!0}}})],cv.prototype,"viewpoint",void 0),cv=uV=h([F("esri.webscene.InitialViewProperties")],cv);const wD=cv,une={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},hne={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},dne={ArcGISFeatureLayer:!0},Nut={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":une,"web-map/basemap":hne,"web-map/tables":dne,"link-chart/operational-layers":{...une,LinkChartLayer:!0},"link-chart/basemap":hne,"link-chart/tables":dne,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0,OrientedImageryLayer:!0}};function Fut(e){if(!e)return e;const{start:t,end:r}=e;return new DN({start:t!=null?Gv(t,-t.getTimezoneOffset(),"minutes"):t,end:r!=null?Gv(r,-r.getTimezoneOffset(),"minutes"):r})}function Uut(e){if(!e)return e;const{start:t,end:r}=e;return new DN({start:t!=null?Gv(t,t.getTimezoneOffset(),"minutes"):t,end:r!=null?Gv(r,r.getTimezoneOffset(),"minutes"):r})}var hV;let tC=hV=class extends Pe{constructor(e){super(e)}async collectRequiredFields(e,t){return py(e,t,this.expression)}clone(){return new hV({expression:this.expression,title:this.title})}equals(e){return this.expression===e.expression&&this.title===e.title}};h([f({type:String,json:{write:!0}})],tC.prototype,"expression",void 0),h([f({type:String,json:{write:!0}})],tC.prototype,"title",void 0),tC=hV=h([F("esri.layers.support.FeatureExpressionInfo")],tC);const pne=tC;var dV;const lM=jl()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),fne=new kl({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let Kf=dV=class extends Pe{constructor(e){super(e),this.offset=null}readFeatureExpressionInfo(e,t){return e??(t.featureExpression&&t.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(e,t,r,i){t[r]=e.write({},i),e.expression==="0"&&(t.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:t}=this;return this._isOverridden("mode")?this._get("mode"):e!=null||t?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new dV({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(e){return this.mode===e.mode&&this.offset===e.offset&&this.unit===e.unit&&Hwe(this.featureExpressionInfo,e.featureExpressionInfo)}};h([f({type:pne,json:{write:!0}})],Kf.prototype,"featureExpressionInfo",void 0),h([br("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],Kf.prototype,"readFeatureExpressionInfo",null),h([Yt("featureExpressionInfo",{featureExpressionInfo:{type:pne},"featureExpression.value":{type:[0]}})],Kf.prototype,"writeFeatureExpressionInfo",null),h([f({type:lM.apiValues,nonNullable:!0,json:{type:lM.jsonValues,read:lM.read,write:{writer:lM.write,isRequired:!0}}})],Kf.prototype,"mode",null),h([f({type:Number,json:{write:!0}})],Kf.prototype,"offset",void 0),h([f({type:nGe,json:{type:String,read:fne.read,write:fne.write}})],Kf.prototype,"unit",null),Kf=dV=h([F("esri.layers.support.ElevationInfo")],Kf);const kut=Kf,Sgt={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},Egt={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,r){t[r]=!e}}}},Cgt={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:!0}},Agt={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:fy}}},Ogt={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},Rgt={value:null,type:kut,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function Pgt(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const vbe={write:!0,read:!0},pV={type:Number,json:{origins:{"web-document":vbe,"portal-item":{write:!0}}}},Mgt={...pV,json:{...pV.json,origins:{"web-document":{...vbe,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,r)=>r&&r.origin!=="service"||!t.drawingInfo||t.drawingInfo.transparency===void 0?t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.transparency!==void 0?hA(t.layerDefinition.drawingInfo.transparency):void 0:hA(t.drawingInfo.transparency)}}},Igt={type:DN,readOnly:!0,get(){if(!this.layer?.timeInfo)return null;const{datesInUnknownTimezone:e,timeOffset:t,useViewTime:r}=this.layer,i=this.view?.timeExtent;let s=this.layer.timeExtent;e&&(s=Uut(s));let n=r?i&&s?i.intersection(s):i||s:s;if(!n||n.isEmpty||n.isAllTime)return n;t&&(n=n.offset(-t.value,t.unit)),e&&(n=Fut(n));const o=this._get("timeExtent");return n.equals(o)?o:n}},$gt={type:Pr,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(e,t)=>{const r=Pr.fromJSON(e);return t.spatialReference!=null&&typeof t.spatialReference=="object"&&(r.spatialReference=st.fromJSON(t.spatialReference)),r}}}},read:!1}},Lgt={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},Dgt={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},Ngt={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},zut={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}},Fgt=e=>{let t=class extends e{constructor(){super(...arguments),this.title=null}writeListMode(r,i,s,n){(n&&n.layerContainerType==="ground"||r&&COe(this,s,{},n))&&(i[s]=r)}writeOperationalLayerType(r,i,s,n){!r||n&&n.layerContainerType==="tables"||(i.layerType=r)}writeTitle(r,i){i.title=r??"Layer"}read(r,i){i&&(i.layer=this),Tce(this,r,s=>super.read(r,s),i)}write(r,i){if(i?.origin){const o=`${i.origin}/${i.layerContainerType||"operational-layers"}`;let l=!!Nut[o]?.[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&o==="web-scene/operational-layers"&&(l=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&o==="web-map/operational-layers"&&(l=!1),!l)return i.messages?.push(new G("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${o}'`,{layer:this})),null}const s=super.write(r,{...i,layer:this}),n=!!i&&!!i.messages&&!!i.messages.filter(o=>o instanceof G&&o.name==="web-document-write:property-required").length;return tT(s?.url)?(i?.messages?.push(new G("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return h([f({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],t.prototype,"id",void 0),h([f(zut)],t.prototype,"listMode",void 0),h([Yt("listMode")],t.prototype,"writeListMode",null),h([f({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],t.prototype,"operationalLayerType",void 0),h([Yt("operationalLayerType")],t.prototype,"writeOperationalLayerType",null),h([f(pV)],t.prototype,"opacity",void 0),h([f({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],t.prototype,"title",void 0),h([Yt("title"),Yt(["web-scene"],"title")],t.prototype,"writeTitle",null),h([f({type:Boolean,json:{name:"visibility"}})],t.prototype,"visible",void 0),t=h([F("esri.layers.mixins.OperationalLayer")],t),t};function But(e){return"operationalLayerType"in e}var fV;let mm=fV=class extends Pe{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}clone(){return new fV({url:this.url})}};h([f({type:String,json:{write:{isRequired:!0}}})],mm.prototype,"url",void 0),mm=fV=h([F("esri.webdoc.support.SlideThumbnail")],mm);var mV;let BI=mV=class extends Pe{constructor(){super(...arguments),this.text=""}clone(){return new mV({text:this.text})}};h([f({type:String,json:{write:!0}})],BI.prototype,"text",void 0),BI=mV=h([F("esri.webscene.support.Description")],BI);const VI=BI;var gV;let bx=gV=class extends Pe{constructor(){super(...arguments),this.lighting=new w1,this.weather=new oL}clone(){return new gV({lighting:ye(this.lighting),weather:ye(this.weather)})}};h([f({types:Lpe,json:{write:!0}})],bx.prototype,"lighting",void 0),h([f({types:tj,json:{write:!0}})],bx.prototype,"weather",void 0),bx=gV=h([F("esri.webscene.Environment")],bx);var GI;let jI=GI=class extends Pe{constructor(){super(...arguments),this.opacity=null}clone(){return new GI({opacity:this.opacity})}cloneAndApplyTo(e){return this.opacity==null||((e=e?.clone()??new xA).opacity=this.opacity),e}static fromGround(e){return new GI({opacity:e.opacity})}};h([f({type:Number,json:{type:Ps,read:{reader:hA,source:"transparency"},write:{writer:(e,t)=>{t.transparency=iG(e)},target:"transparency"}}})],jI.prototype,"opacity",void 0),jI=GI=h([F("esri.webscene.support.SlideGround")],jI);const bbe=jI;var yV;let wx=yV=class extends Pe{constructor(e){super(e),this.id="",this.sublayerIds=null}clone(){return new yV({id:this.id,sublayerIds:ye(this.sublayerIds)})}};h([f({type:String,json:{write:!0}})],wx.prototype,"id",void 0),h([f({type:[Ps],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],wx.prototype,"sublayerIds",void 0),wx=yV=h([F("esri.webscene.support.SlideVisibleLayer")],wx);var _V;let HI=_V=class extends Pe{constructor(){super(...arguments),this.text=""}clone(){return new _V({text:this.text})}};h([f({type:String,json:{write:{isRequired:!0}}})],HI.prototype,"text",void 0),HI=_V=h([F("esri.webscene.support.Title")],HI);const KC=HI;let Vut=0;const vV=Pt.ofType(wx);let $o=class extends Pe{constructor(e){super(e),this.id=Date.now().toString(16)+"-slide-"+Vut++,this.title=new KC,this.description=new VI,this.thumbnail=new mm,this.viewpoint=null,this.basemap=null,this.ground=null,this.environment=new bx,this.visibleLayers=new vV}destroy(){this.visibleLayers.removeAll(),this.basemap?.destroy(),this.basemap=null,this.thumbnail=Re(this.thumbnail),this.description=null,this.title=null,this.thumbnail=null}castTitle(e){return typeof e=="string"?new KC({text:e}):ro(KC,e)}castDescription(e){return typeof e=="string"?new VI({text:e}):ro(VI,e)}castThumbnail(e){return typeof e=="string"?new mm({url:e}):ro(mm,e)}castBasemap(e){return KG(e)}set visibleLayers(e){this._set("visibleLayers",$m(e,this._get("visibleLayers"),vV))}castVisibleLayers(e){return e&&typeof e.map=="function"?e.map(t=>{if(typeof t=="string")return{id:t};if(t instanceof hpe){const r=mne(t);return{id:t.id,sublayerIds:r}}return t.id?{id:t.id,sublayerIds:"sublayerIds"in t?t.sublayerIds:void 0}:(K.getLogger(this).warn('Invalid visible layer, expected { id }, Layer or "id"'),t)}):null}clone(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap&&this.basemap.clone()||null,ground:this.ground&&this.ground.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||null})}_updateVisibleLayersFrom(e){const t=[];return Sc(this._getLayers(e.map).map(r=>e.whenLayerView(r).then(i=>{if(i.visible){const s=mne(r);t.push(new wx({id:i.layer.id,sublayerIds:s}))}})).toArray()).then(()=>{this.visibleLayers.removeAll(),this.visibleLayers.addMany(t)})}updateFrom(e,t){const r={format:"png",quality:80,width:120,height:75,disableDecorations:!0,...t&&t.screenshot};return e.when(()=>(this.viewpoint=e.viewpoint.clone(),this.environment.lighting=e.environment.lighting.type==="virtual"?V3.prototype.clone.apply(e.environment.lighting):w1.prototype.clone.apply(e.environment.lighting),this.environment.weather=e.environment.weather.clone(),this.basemap=e.map.basemap&&e.map.basemap.clone()||null,this.ground=e.map.ground?bbe.fromGround(e.map.ground):null,this._updateVisibleLayersFrom(e))).then(()=>e.takeScreenshot(r)).then(i=>(this.thumbnail=new mm({url:i.dataUrl}),this))}async applyTo(e,t){this._applyToController!=null&&this._applyToController.abort();let r=new AbortController;this._applyToController=r;const i=ND(t,()=>r?.abort()),s=e.resourceController.scheduler.registerTask(at.SLIDE);let n=!1;const o={animate:!0,...t,signal:this._applyToController.signal},a=async()=>{await Promise.all([s.schedule(()=>n=this._setViewpointOfInterest(e,o)),s.schedule(()=>this._applyBasemap(e,o),o.signal)]),await Promise.all([s.schedule(()=>this._applyLayerVisibility(e),o.signal),s.schedule(()=>this._applyGround(e),o.signal),s.schedule(()=>this._applyViewpoint(e,o),o.signal)]),await s.schedule(()=>e.environment.weather=this.environment.weather.clone())},l=await Yu(e.addUpdatingPromise(a()));if(n&&(e.contentCamera=null),s.remove(),this._applyToController===r&&(this._applyToController=null),r=null,i?.remove(),l.ok===!1)throw l.error;return this}async _applyBasemap(e,t){if(this.basemap){try{await this.basemap.load(t)}catch(r){if($s(r))throw r}e.map.basemap=sNe(this.basemap,e.map.basemap)}}_applyGround(e){this.ground&&(e.map.ground=this.ground.cloneAndApplyTo(e.map.ground))}_getLayers(e){const t=new Pt;return this._collectLayers(e,t),this._collectLayers(e.ground,t),t}_collectLayers(e,t){e.layers.forEach(r=>{But(r)&&(t.add(r),"layers"in r&&this._collectLayers(r,t))})}_applyLayerVisibility(e){!this.visibleLayers||this._getLayers(e.map).forEach(t=>{const r=this.visibleLayers.find(n=>n.id===t.id);t.visible=r!=null;const i=r&&r.sublayerIds,s=wbe(t);i&&s&&s.forEach(n=>n.visible=i.includes(n.id))})}_setViewpointOfInterest(e,t){if(e.state.fixedContentCamera||!this.viewpoint||t?.ignoreViewpoint||!t?.useDestinationCamera)return!1;const r=iH(e,this.viewpoint);return e.contentCamera=r,r!=null}async _applyViewpoint(e,t){if(this._applyCachedCameraTrackingEnabled(e),this.viewpoint&&!t.ignoreViewpoint){if(this.viewpoint.camera!=null&&(this.viewpoint.camera.fov=e.camera.fov),t.animate&&this.get("environment.lighting.date"))return this._animateToLighting(e,t);t.animate&&(e.environment.applyLighting(this.environment.lighting.clone()),await e.goTo(this.viewpoint,t)),e.viewpoint=this.viewpoint}e.environment.applyLighting(this.environment.lighting.clone())}async _animateToLighting(e,t){let r=null;return e.environment.lighting.type!=="virtual"&&this.environment.lighting.type!=="virtual"&&(e.viewingMode==="global"&&(r=this._animateLightingWithCamera(e,e.environment.lighting,this.environment.lighting)),e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1),e.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled,this.environment.lighting.type==="virtual"||e.environment.lighting.type==="virtual"?(e.environment.applyLighting(this.environment.lighting.clone()),e.environment.lighting.type!=="virtual"&&(e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1)):this.environment.lighting.displayUTCOffset!=null&&(e.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset),e.goTo(this.viewpoint,t).then(()=>{this._applyCachedCameraTrackingEnabled(e),e.environment.applyLighting(this.environment.lighting.clone())}).catch(i=>{throw e.animation==null&&this._applyCachedCameraTrackingEnabled(e),i}).finally(()=>{xi(r)})}_applyCachedCameraTrackingEnabled(e){e.environment.cachedCameraTrackingEnabled!=null&&(e.environment.lighting.cameraTrackingEnabled=e.environment.cachedCameraTrackingEnabled,e.environment.cachedCameraTrackingEnabled=null)}_getTime(e){return[e.getTime(),3600*e.getUTCHours()+60*e.getUTCMinutes()+e.getUTCSeconds()]}_setTime(e,t,r){return e.setTime(t),e.setUTCHours(r/3600),e.setUTCMinutes(r%3600/60),e.setUTCSeconds(r%3600%60),e}_animateLightingWithCamera(e,t,r){const i=new Date(t.date.toString()),[s,n]=this._getTime(i),[o,a]=this._getTime(r.date),l=Gut(n,a),c=e.renderCoordsHelper,u=C();c.toRenderCoords(e.camera.position,u);const d=C(),p=C();this.viewpoint.camera!=null&&c.toRenderCoords(this.viewpoint.camera.position,d);const g=new Date;return Dc(()=>e.camera,y=>{c.toRenderCoords(y.position,p);const _=gn(u,p),v=gn(d,p);let w=0;_+v!==0&&(w=_/(_+v));const T=s+(o-s)*w,x=jut(n,l*w);t.date=this._setTime(g,T,x)})}static createFrom(e,t){return new this().updateFrom(e,t)}};function wbe(e){if(e.type==="building-scene"||e.type==="map-image")return e.allSublayers.toArray()}function mne(e){const t=wbe(e);if(t)return t.filter(r=>r.visible).map(r=>r.id)}h([f({type:String,json:{write:{isRequired:!0}}})],$o.prototype,"id",void 0),h([f({type:KC,json:{default:()=>new KC({text:""}),write:{isRequired:!0}}})],$o.prototype,"title",void 0),h([si("title")],$o.prototype,"castTitle",null),h([f({type:VI,json:{write:{overridePolicy:e=>({enabled:!(!e||!e.text)})}}})],$o.prototype,"description",void 0),h([si("description")],$o.prototype,"castDescription",null),h([f({type:mm,json:{default:()=>new mm({url:""}),write:{isRequired:!0}}})],$o.prototype,"thumbnail",void 0),h([si("thumbnail")],$o.prototype,"castThumbnail",null),h([f({type:zl,nonNullable:!0,json:{write:{isRequired:!0}}})],$o.prototype,"viewpoint",void 0),h([f({type:wA,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],$o.prototype,"basemap",void 0),h([si("basemap")],$o.prototype,"castBasemap",null),h([f({type:bbe,json:{write:!0}})],$o.prototype,"ground",void 0),h([f({type:vV,json:{write:{isRequired:!0}}})],$o.prototype,"visibleLayers",null),h([si("visibleLayers")],$o.prototype,"castVisibleLayers",null),h([f({type:bx,json:{write:!0}})],$o.prototype,"environment",void 0),$o=h([F("esri.webscene.Slide")],$o);const bV=86400,gne=43200;function Gut(e,t){let r=t-e;return r>gne&&(r-=bV),r<-gne&&(r+=bV),r}function jut(e,t){return Z$e(e+t,bV)}const Hut=$o,wV=Pt.ofType(Hut);let WI=class extends Pe{constructor(e){super(e),this.slides=new wV}destroy(){this.slides.forEach(e=>e.destroy()),this.slides.removeAll()}set slides(e){e&&(e=e.filter(t=>!!t.viewpoint)),this._set("slides",$m(e,this._get("slides"),wV))}clone(){return new this.constructor({slides:this.slides.clone()})}};h([f({type:wV,nonNullable:!0,json:{write:!0}}),si(hG)],WI.prototype,"slides",null),WI=h([F("esri.webscene.Presentation")],WI);const xbe=WI;var xV;let tx=xV=class extends Pe{constructor(e){super(e)}clone(){return new xV({name:this.name,path:this.path,title:this.title})}};h([f({type:String,json:{write:!0}})],tx.prototype,"name",void 0),h([f({type:String,json:{write:!0}})],tx.prototype,"path",void 0),h([f({type:String,json:{write:!0}})],tx.prototype,"title",void 0),tx=xV=h([F("esri.webscene.TransportationNetwork")],tx);const Wut=tx;class xD extends V1{constructor(t,r){super(t,r,"webscene")}get supportsGround(){return this.since(1,8)}get supportsVisibleElevationLayersInSlides(){return this.lessThan(1,8)}}let qut=null;function Xut(){return qut}var Tbe;const e1=new xD(1,31),Zut=()=>{const t=[],r=e1.major;for(let i=8;i<=e1.minor;i++)t.push(`${r}.${i}`);return t},l8="Web Scene",cM="ViewingMode-Local";let Xr=class extends Lm.LoadableMixin(jD(pbe(dpe))){constructor(e){super(e),this[Tbe]=!0,this._layersIdGCTimeoutId=void 0,this._updateFromPromise=null,this.applicationProperties=null,this.clippingArea=null,this.clippingEnabled=!1,this.floorInfo=null,this.heightModelInfo=void 0,this.sourceVersion=null,this.transportationNetworks=null,this.presentation=new xbe,this.initialViewProperties=new wD,this.portalItem=null,this.resourceInfo=null,this._debouncedSaveOperations=zV(async(t,r,i)=>{switch(t){case xx.SAVE:return this._saveImpl(r);case xx.SAVE_AS:return this._saveAsImpl(i,r)}}),this._resourceReferences={portalItem:null,paths:[]},this.authoringApp=null,this.authoringAppVersion=null,this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1}initialize(){if(this.when().catch(e=>{K.getLogger(this).error("#load()","Failed to load web scene",e)}),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(t){return void this.addResolvingPromise(Promise.reject(t))}this.read(e),this.addResolvingPromise(this._validateSpatialReference()),this.addResolvingPromise(this._validateHeightModelInfo())}this.addHandles([qo(()=>this.tables,"before-add",e=>{e.preventDefault(),K.getLogger(this).errorOnce("tables","Tables are not yet supported in a WebScene")}),qo(()=>this.allLayers,"change",()=>this._scheduleLayersIdGC())])}destroy(){this._unscheduleLayersIdGC(),this.presentation&&this.presentation.destroy(),this.portalItem=Re(this.portalItem),this.basemap?.destroy()}writeClippingArea(e,t){t.clippingArea||(t.clippingArea={}),t.clippingArea.geometry=e.toJSON()}readClippingEnabled(e,t){return!!t.clippingArea&&!!t.clippingArea.clip}writeClippingEnabled(e,t){this.clippingArea&&(t.clippingArea||(t.clippingArea={}),t.clippingArea.clip=e)}writeLayers(e,t,r,i){const s={...i,layerContainerType:"operational-layers"},n=e.map(o=>this.verifyWriteLayer(o,i)?o.write({},s):null).filter(o=>!!o);t[r]=n.toArray()}verifyWriteLayer(e,t){return"write"in e||(t&&t.messages&&t.messages.push(new G("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in web scenes`,{layer:e})),!1)}readSourceVersion(e,t){const[r,i]=t.version.split(".");return new xD(parseInt(r,10),parseInt(i,10))}writeSourceVersion(e,t,r){t[r]=`${e1.major}.${e1.minor}`}get thumbnailUrl(){return this.portalItem?.thumbnailUrl??null}set thumbnailUrl(e){e?this._override("thumbnailUrl",e):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,t){e&&this._isAuthoringAppSetByUser?t.authoringApp=e:t.authoringApp="ArcGIS API for JavaScript"}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,t){e&&this._isAuthoringAppVersionSetByUser?t.authoringAppVersion=e:t.authoringAppVersion=Doe}writeGround(e,t,r,i){t[r]=e?e.write({},i):{transparency:0,layers:[]}}readInitialViewProperties(e,t){const r={};return t.initialState&&t.initialState.environment&&(r.environment=TT.fromJSON(t.initialState.environment)),t.spatialReference?r.spatialReference=st.fromJSON(t.spatialReference):r.spatialReference=st.WebMercator,r.viewingMode=t.viewingMode||"global",t.initialState&&t.initialState.viewpoint&&(r.viewpoint=zl.fromJSON(t.initialState.viewpoint)),new wD(r)}get spatialReference(){return this.initialViewProperties?.spatialReference??st.WebMercator}get viewingMode(){return this.initialViewProperties?.viewingMode??"global"}load(e){const t=this.ground;return this.addResolvingPromise(this._loadFromSource().then(()=>{t&&t!==this.ground&&t.destroy()})),Promise.resolve(this)}loadAll(){return ZG(this,e=>{const t=this.presentation&&this.presentation.slides;e(this.ground,this.basemap,this.layers,t&&t.map(r=>r.basemap))})}read(e,t){t={...t,origin:"web-scene"};const r=this._isAuthoringAppVersionSetByUser,i=this._isAuthoringAppSetByUser;if(Tce(this,e,s=>super.read(e,s),t),i||(this._isAuthoringAppSetByUser=!1),r||(this._isAuthoringAppVersionSetByUser=!1),e.baseMap&&Array.isArray(e.baseMap.elevationLayers)&&this.sourceVersion?.supportsVisibleElevationLayersInSlides){const s=e.baseMap.elevationLayers.map(l=>({id:l.id})),n=this.presentation.slides,o=(l,c)=>l.visibleLayers.some(u=>u.id===c),a=s.filter(l=>!n.some(c=>o(c,l.id)));n.forEach(l=>{l.visibleLayers.addMany(a)})}}_writeBasemapElevationLayers(e){const t=e.ground&&e.ground.layers;!e.baseMap&&t&&t.length&&(e.baseMap={title:"Basemap",baseMapLayers:[]}),e.baseMap&&(e.baseMap.elevationLayers=ye(t))}write(e,t){if(this.loadStatus!=="loaded"){const s=new G("webscene:not-loaded","Web scene must be loaded before it can be serialized");throw K.getLogger(this).error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),s}this._runLayersIdGC();const r=!t?.messages;t={messages:[],...t,origin:"web-scene"};const i=super.write(e,t);if(r){const s=t.messages?.filter(n=>n.name==="web-document-write:property-required")??[];if(s.length){const n=new G("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:s});throw K.getLogger(this).error("#toJSON()","One or more properties that are required in the webscene JSON are missing",s),n}}return this._writeBasemapElevationLayers(i),i}async save(e){return this._debouncedSaveOperations(xx.SAVE,e)}async _saveImpl(e){if(!this.portalItem)throw K.getLogger(this).error("save(): requires the .portalItem property to be set"),await Promise.resolve(),new G("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene");if(this.portalItem?.type!==l8)throw await Promise.resolve(),new G("webscene:portal-item-wrong-type",`Portal item needs to have type "${l8}"`);const t=this._updateFromPromise;await this._ensureLoadBeforeSave();const r=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:this.portalItem.itemUrl?Us(this.portalItem.itemUrl):null,messages:[],portal:this.portalItem.portal??ba.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),i=this.write({},r);return await Promise.all(r.resources.pendingOperations),await this._verifySave(i,r,e),this._updateTypeKeywords(this.portalItem),await this.portalItem.update({data:i}),await ane(this._resourceReferences,r,null),one(r),t&&await t,await this._saveThumbnail(),this.portalItem}async saveAs(e,t){return this._debouncedSaveOperations(xx.SAVE_AS,t,e)}async _saveAsImpl(e,t){let r=LN.from(e);r||(K.getLogger(this).error("saveAs(portalItem): requires a portal item parameter"),await Promise.reject(new G("webscene:portal-item-required","saveAs requires a portal item to save to"))),r.id&&(r=r.clone(),r.id=null);const i=r.portal||ba.getDefault();await this._ensureLoadBeforeSave(),r.type=l8,r.portal=i;const s=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:i,portalItem:r,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),n=this.write({},s);await Promise.all(s.resources.pendingOperations),await this._verifySaveAs(n,s,t);const o=this.thumbnailUrl,a=!this._isOverridden("thumbnailUrl");return this._updateTypeKeywords(r),await i.signIn(),await i.user?.addItem({item:r,folder:t&&t.folder,data:n}),await ane(this._resourceReferences,s,null),this.portalItem=r,rV.prototype.read.call(this,{version:n.version,authoringApp:n.authoringApp,authoringAppVersion:n.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:r.itemUrl?Us(r.itemUrl):void 0}),one(s),o&&(this.thumbnailUrl=a?e7(o,"w","8192"):o),s.portalItem=r,await this._saveThumbnail(),r}async _saveThumbnail(){this._isOverridden("thumbnailUrl")&&(await this.portalItem?.updateThumbnail({thumbnail:this.thumbnailUrl}),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}_verifySave(e,t,r,i=!1){if(!nT(this.spatialReference))return Promise.reject(new G("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently."));let s,n=t.messages?.filter(l=>l.type==="error").map(l=>new G(l.name,l.message,l.details))??[];t.blockedRelativeUrls&&(n=n.concat(t.blockedRelativeUrls.map(l=>new G("url:unsupported",`Relative url '${l}' is not supported in Web Scene`)))),r&&r.ignoreUnsupported&&(n=n.filter(l=>l.name!=="layer:unsupported"&&l.name!=="symbol:unsupported"&&l.name!=="symbol-layer:unsupported"&&l.name!=="property:unsupported"&&l.name!=="url:unsupported"&&l.name!=="scenemodification:unsupported")),r?.requiredPropertyChecksDisabled&&(n=n.filter(l=>l.name!=="web-document-write:property-required"));const o=!!r?.strictSchemaValidationEnabled,a=Xut();return s=o&&a?a().then(l=>{const c=l.validate(e);if(c.length>0){const u=`webscene did not validate:
${c.join(`
`)}`;K.getLogger(this).error(`${i?"saveAs":"save"}(): ${u}`)}return c.map(u=>new G("webscene:schema-validation",u))}).then(l=>{if(l.length>0)throw vut(l.concat(n));return n}):Promise.resolve(n),s.then(l=>{if(l.length>0)throw new G("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:l})})}_verifySaveAs(e,t,r){return this.canNotSaveAs(t)?Promise.reject(_ut()):this._verifySave(e,t,r,!0)}verifySaveAs(e){const t=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),r=this.write({},t);return this._verifySaveAs(r,t,e)}canNotSaveAs(e){return e||(e=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write({},e)),(e.verifyItemRelativeUrls?.writtenUrls?.length??0)>0}async updateFrom(e,t={}){const r=this._updateFrom(e,t);this._updateFromPromise=r,await r,this._updateFromPromise===r&&(this._updateFromPromise=null)}async _updateFrom(e,t={}){if(await e.whenReady(),!t.environmentExcluded&&e.environment&&(this.initialViewProperties.environment=TT.prototype.clone.apply(e.environment)),!t.viewpointExcluded&&e.viewpoint&&(this.initialViewProperties.viewpoint=e.viewpoint.clone()),this.initialViewProperties.spatialReference=e.spatialReference.clone(),this.initialViewProperties.viewingMode=e.viewingMode,e.clippingArea!=null?e.clippingArea!==this.clippingArea&&(this.clippingArea=e.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,e.heightModelInfo&&(this.heightModelInfo=e.heightModelInfo.clone()),e.map===this)for(const r of e.allLayerViews){const i="visible";i in r&&i in r.layer&&r._isOverridden(i)&&(r.layer[i]=r[i])}(t.thumbnailExcluded===!1||t.thumbnailExcluded==null&&!t.viewpointExcluded)&&await this._updateFromThumbnail(e,t.thumbnailSize??void 0)}async _updateFromThumbnail(e,t){const r=Out(e,t),i=await e.takeScreenshot({format:"jpg",width:r.width,height:r.height,disableDecorations:!0});this.thumbnailUrl=i.dataUrl}_loadFromSource(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()}_readAndLoadFromJSON(e,t){const r=this._validateJSON(e);return this.read(r,t),this._loadFromJSON(r,t)}_extractOperationalLayers(e){const t=[];if(!this.sourceVersion?.supportsGround&&e.baseMap&&Array.isArray(e.baseMap.elevationLayers))for(const s of e.baseMap.elevationLayers)t.push(s);const r=[],i=s=>(s.layers&&(s.layers=s.layers.filter(i)),s.layerType!=="ArcGISTiledElevationServiceLayer"||(this.sourceVersion?.supportsGround||r.push(s),!1));return{operationalLayers:e.operationalLayers?e.operationalLayers.filter(i):[],operationalElevationLayers:r,basemapElevationLayers:t}}_loadFromJSON(e,t){const r=new Pt;return this._validateSpatialReference().then(()=>this._validateHeightModelInfo()).then(()=>ue(()=>import("./layersCreator.c5a200d8.js"),["assets/layersCreator.c5a200d8.js","assets/lazyLayerLoader.65116701.js","assets/portalLayers.3d66e6e8.js","assets/layersLoader.364682ca.js","assets/fetchService.1153b1df.js","assets/jsonContext.d19fd1ca.js","assets/portalItemUtils.ea6f2bf4.js","assets/styleUtils.a985c9a8.js"])).then(({populateOperationalLayers:i})=>{const{operationalLayers:s,operationalElevationLayers:n,basemapElevationLayers:o}=this._extractOperationalLayers(e),a=[],l={context:{...t,layerContainerType:"operational-layers"}};if(this.portalItem&&(l.context.portal=this.portalItem.portal||ba.getDefault()),o.length>0){const c={...l,context:{...l.context,layerContainerType:"ground"}};c.defaultLayerType="ArcGISTiledElevationServiceLayer",a.push(i(this.ground.layers,o,c))}if(n.length>0){const c={...l,context:{...l.context,layerContainerType:"ground"}};c.defaultLayerType="ArcGISTiledElevationServiceLayer",a.push(i(r,n,c))}return s&&s.length>0&&a.push(i(this.layers,s,l)),Sc(a).then(()=>{})}).then(()=>this._loadObjectsWithLayers()).then(()=>{this.ground.layers.addMany(r)})}async _ensureLoadBeforeSave(){await this.load(),await this._loadObjectsWithLayers();const e=[],t=[...this.allLayers.items];for(const{basemap:r}of this.presentation.slides.items)r&&(t.push(...r.baseLayers.items),t.push(...r.referenceLayers.items));for(const r of t)if("beforeSave"in r&&typeof r.beforeSave=="function"){const i=r.beforeSave();i&&e.push(i)}await Sc(e)}async _loadObjectsWithLayers(){const e=[];this.ground&&e.push(this.ground.load()),this.basemap&&e.push(this.basemap.load()),this.presentation.slides.forEach(t=>{t.basemap&&e.push(t.basemap.load())}),await Sc(e)}async _loadFromItem(e){if(await e.load().catch(i=>{throw new G("webscene:load-portal-item","Failed to load portal item",{error:i})}),e.type!=="Web Scene")throw new G("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:e.type});const t=await e.fetchData();this.resourceInfo=t;const r={origin:"web-scene",url:Us(e.itemUrl),portal:e.portal||ba.getDefault(),portalItem:e,readResourcePaths:[]};await this._readAndLoadFromJSON(t,r),this._resourceReferences={portalItem:e,paths:r.readResourcePaths??[]}}_validateSpatialReference(){const e=this.initialViewProperties,t=this._sceneSpatialReference;let r;if(e.viewingMode!=="local"){if(!WA(t,Ie.Global))return Promise.reject(new G("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:t,viewingMode:e.viewingMode}));r=a=>!a||Dm(a,t)}else{if(!WA(t,Ie.Local))return Promise.reject(new G("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:t,viewingMode:e.viewingMode}));r=a=>!a||a.equals(t)}const i=a=>a?.camera?.position.spatialReference??a?.targetGeometry?.spatialReference,s=e.viewpoint,n=i(s);if(n&&!r(n))return Promise.reject(new G("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:n,sceneSpatialReference:t,viewingMode:e.viewingMode}));const o=this.presentation.slides.find(a=>!r(i(a.viewpoint)));if(o){const a=i(o.viewpoint);return Promise.reject(new G("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:a,sceneSpatialReference:t,viewingMode:e.viewingMode}))}return Promise.resolve()}_validateHeightModelInfo(){const e=this._sceneSpatialReference,t=VNe(this.heightModelInfo,e);return t?Promise.reject(t):Promise.resolve()}_validateJSON(e){const t=xD.parse(e.version||"","webscene");return e1.validate(t),e.version=`${t.major}.${t.minor}`,t.major===1&&t.minor<=2&&(e.spatialReference=st.WebMercator.toJSON()),e}_updateTypeKeywords(e){this.initialViewProperties.viewingMode==="local"?e.typeKeywords?e.typeKeywords.includes(cM)||e.typeKeywords.push(cM):e.typeKeywords=[cM]:this.initialViewProperties.viewingMode==="global"&&e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(t=>t!==cM)),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((t,r,i)=>i.indexOf(t)===r))}get _sceneSpatialReference(){return this.initialViewProperties.spatialReference||st.WebMercator}get _verifyItemRelativeRootPath(){return this.portalItem?.itemUrl?Us(this.portalItem.itemUrl).path:null}_enableVerifyItemRelativeUrls(e){const t=this._verifyItemRelativeRootPath;return t&&(e.verifyItemRelativeUrls={rootPath:t,writtenUrls:[]}),e}_unscheduleLayersIdGC(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)}_scheduleLayersIdGC(){this._unscheduleLayersIdGC(),this._layersIdGCTimeoutId=setTimeout(()=>{this._layersIdGCTimeoutId=0,this._runLayersIdGC()},3e3)}_runLayersIdGC(){this._unscheduleLayersIdGC();const e=this.applicationProperties&&this.applicationProperties.viewing&&this.applicationProperties.viewing.search,t=i=>this.allLayers.some(s=>s.id===i);e&&e.layers&&(e.layers=e.layers.filter(i=>t(i.id)));const r=this.presentation&&this.presentation.slides;r&&r.forEach(i=>{i.visibleLayers&&(i.visibleLayers=i.visibleLayers.filter(s=>t(s.id)))})}static fromJSON(e){if(!e)throw new G("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:e})}};var xx;Tbe=mut,Xr.version=`${e1.major}.${e1.minor}`,h([f({type:Dut,json:{write:!0}})],Xr.prototype,"applicationProperties",void 0),h([f({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],Xr.prototype,"basemap",void 0),h([f({type:Pr,json:{read:{source:"clippingArea.geometry",reader:cT},write:{target:"clippingArea.geometry"}}})],Xr.prototype,"clippingArea",void 0),h([Yt("clippingArea")],Xr.prototype,"writeClippingArea",null),h([f({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],Xr.prototype,"clippingEnabled",void 0),h([br("clippingEnabled",["clippingArea"])],Xr.prototype,"readClippingEnabled",null),h([Yt("clippingEnabled")],Xr.prototype,"writeClippingEnabled",null),h([f({type:fut,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],Xr.prototype,"floorInfo",void 0),h([f({type:rb,json:{write:!0}})],Xr.prototype,"heightModelInfo",void 0),h([f({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],Xr.prototype,"layers",void 0),h([Yt("layers")],Xr.prototype,"writeLayers",null),h([f({readOnly:!0,type:xD,json:{type:Zut(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],Xr.prototype,"sourceVersion",void 0),h([br("sourceVersion",["version"])],Xr.prototype,"readSourceVersion",null),h([Yt("sourceVersion")],Xr.prototype,"writeSourceVersion",null),h([f({json:{read:!1,write:!1}})],Xr.prototype,"tables",void 0),h([f()],Xr.prototype,"thumbnailUrl",null),h([f({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],Xr.prototype,"authoringApp",null),h([Yt("authoringApp")],Xr.prototype,"writeAuthoringApp",null),h([f({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],Xr.prototype,"authoringAppVersion",null),h([Yt("authoringAppVersion")],Xr.prototype,"writeAuthoringAppVersion",null),h([f({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],Xr.prototype,"ground",void 0),h([Yt("ground")],Xr.prototype,"writeGround",null),h([f({type:Pt.ofType(Wut),json:{write:!0}})],Xr.prototype,"transportationNetworks",void 0),h([f({type:xbe,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:(e,t,r,i)=>{if(e.slides&&e.slides.length>0){const s={...i,isPresentation:!0};t.presentation=e.write({},s)}}}}})],Xr.prototype,"presentation",void 0),h([f({type:wD,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new wD({viewingMode:"global",spatialReference:st.WebMercator})}})],Xr.prototype,"initialViewProperties",void 0),h([br("initialViewProperties",["initialState.environment","spatialReference","viewingMode","initialState.viewpoint"])],Xr.prototype,"readInitialViewProperties",null),h([f({type:st,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],Xr.prototype,"spatialReference",null),h([f({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],Xr.prototype,"viewingMode",null),h([f({type:LN})],Xr.prototype,"portalItem",void 0),h([f()],Xr.prototype,"resourceInfo",void 0),Xr=h([F("esri.WebScene")],Xr),function(e){e[e.SAVE=0]="SAVE",e[e.SAVE_AS=1]="SAVE_AS"}(xx||(xx={}));const Yut=Xr;/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.4.2
 */const Jut='@charset "UTF-8";@keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in-down{0%{opacity:0;transform:translate3D(0, -5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;transform:translate3D(0, 5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-right{0%{opacity:0;transform:translate3D(-5px, 0, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-left{0%{opacity:0;transform:translate3D(5px, 0, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-scale{0%{opacity:0;transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;animation-fill-mode:both;animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{animation-name:in}.calcite-animate__in-down{animation-name:in-down}.calcite-animate__in-up{animation-name:in-up}.calcite-animate__in-right{animation-name:in-right}.calcite-animate__in-left{animation-name:in-left}.calcite-animate__in-scale{animation-name:in-scale}@media (prefers-reduced-motion: reduce){:root{--calcite-internal-duration-factor:0.01}}:root{--calcite-floating-ui-transition:var(--calcite-animation-timing);--calcite-floating-ui-z-index:var(--calcite-app-z-index-dropdown)}:host([hidden]){display:none}@keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in-down{0%{opacity:0;transform:translate3D(0, -5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;transform:translate3D(0, 5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-right{0%{opacity:0;transform:translate3D(-5px, 0, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-left{0%{opacity:0;transform:translate3D(5px, 0, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-scale{0%{opacity:0;transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;animation-fill-mode:both;animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{animation-name:in}.calcite-animate__in-down{animation-name:in-down}.calcite-animate__in-up{animation-name:in-up}.calcite-animate__in-right{animation-name:in-right}.calcite-animate__in-left{animation-name:in-left}.calcite-animate__in-scale{animation-name:in-scale}@media (prefers-reduced-motion: reduce){:root{--calcite-internal-duration-factor:0.01}}@media (prefers-reduced-motion: reduce){:root{--calcite-internal-duration-factor:0}}:host{position:relative;margin-inline:auto;display:none;align-items:center;justify-content:center;opacity:1;min-block-size:var(--calcite-loader-size);font-size:var(--calcite-loader-font-size);stroke:var(--calcite-ui-brand);stroke-width:3;fill:none;transform:scale(1, 1);animation:loader-color-shift calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 2 / var(--calcite-internal-duration-factor)) alternate-reverse infinite linear;padding-block:var(--calcite-loader-padding, 4rem)}:host([scale=s]){--calcite-loader-font-size:var(--calcite-font-size--2);--calcite-loader-size:2rem;--calcite-loader-size-inline:0.75rem}:host([scale=m]){--calcite-loader-font-size:var(--calcite-font-size-0);--calcite-loader-size:4rem;--calcite-loader-size-inline:1rem}:host([scale=l]){--calcite-loader-font-size:var(--calcite-font-size-2);--calcite-loader-size:6rem;--calcite-loader-size-inline:1.5rem}:host([no-padding]){padding-block:0px}:host{display:flex}.loader__text{display:block;text-align:center;font-size:var(--calcite-font-size--2);line-height:1rem;color:var(--calcite-ui-text-1);margin-block-start:calc(var(--calcite-loader-size) + 1.5rem)}.loader__percentage{position:absolute;display:block;text-align:center;color:var(--calcite-ui-text-1);font-size:var(--calcite-loader-font-size);inline-size:var(--calcite-loader-size);inset-inline-start:50%;margin-inline-start:calc(var(--calcite-loader-size) / 2 * -1);line-height:0.25;transform:scale(1, 1)}.loader__svgs{position:absolute;overflow:visible;opacity:1;inline-size:var(--calcite-loader-size);block-size:var(--calcite-loader-size);inset-inline-start:50%;margin-inline-start:calc(var(--calcite-loader-size) / 2 * -1);transform:scale(1, 1)}.loader__svg{position:absolute;inset-block-start:0px;transform-origin:center;overflow:visible;inset-inline-start:0;inline-size:var(--calcite-loader-size);block-size:var(--calcite-loader-size);animation-iteration-count:infinite;animation-timing-function:linear;animation-name:loader-clockwise}@supports (display: grid){.loader__svg--1{animation-name:loader-offset-1}.loader__svg--2{animation-name:loader-offset-2}.loader__svg--3{animation-name:loader-offset-3}}:host([type=determinate]){animation:none;stroke:var(--calcite-ui-border-3)}:host([type=determinate]) .loader__svg--3{animation:none;stroke:var(--calcite-ui-brand);stroke-dasharray:150.79632;transform:rotate(-90deg);transition:all var(--calcite-internal-animation-timing-fast) linear}:host([inline]){position:relative;margin:0px;animation:none;stroke:currentColor;stroke-width:2;padding-block:0px;block-size:var(--calcite-loader-size-inline);min-block-size:var(--calcite-loader-size-inline);inline-size:var(--calcite-loader-size-inline);margin-inline-end:calc(var(--calcite-loader-size-inline) * 0.5);vertical-align:calc(var(--calcite-loader-size-inline) * -1 * 0.2)}:host([inline]) .loader__svgs{inset-block-start:0px;margin:0px;inset-inline-start:0;inline-size:var(--calcite-loader-size-inline);block-size:var(--calcite-loader-size-inline)}:host([inline]) .loader__svg{inline-size:var(--calcite-loader-size-inline);block-size:var(--calcite-loader-size-inline)}:host([complete]){opacity:0;transform:scale(0.75, 0.75);transform-origin:center;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, transform var(--calcite-internal-animation-timing-medium) linear 1000ms}:host([complete]) .loader__svgs{opacity:0;transform:scale(0.75, 0.75);transform-origin:center;transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms}:host([complete]) .loader__percentage{color:var(--calcite-ui-brand);transform:scale(1.05, 1.05);transform-origin:center;transition:color var(--calcite-internal-animation-timing-medium) linear, transform var(--calcite-internal-animation-timing-medium) linear}.loader__svg--1{stroke-dasharray:27.9252444444% 139.6262222222%;animation-duration:calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 2.4 / var(--calcite-internal-duration-factor))}@keyframes loader-offset-1{0%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-83.7757333333%}100%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:-279.2524444444%}}.loader__svg--2{stroke-dasharray:55.8504888889% 139.6262222222%;animation-duration:calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 3.2 / var(--calcite-internal-duration-factor))}@keyframes loader-offset-2{0%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-97.7383555556%}100%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:-279.2524444444%}}.loader__svg--3{stroke-dasharray:13.9626222222% 139.6262222222%;animation-duration:calc(var(--calcite-internal-animation-timing-slow) / var(--calcite-internal-duration-factor) * 3.867 / var(--calcite-internal-duration-factor))}@keyframes loader-offset-3{0%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-76.7944222222%}100%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:-279.2524444444%}}@keyframes loader-color-shift{0%{stroke:var(--calcite-ui-brand)}33%{stroke:var(--calcite-ui-brand-press)}66%{stroke:var(--calcite-ui-brand-hover)}100%{stroke:var(--calcite-ui-brand)}}@keyframes loader-clockwise{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}',Kut=FAe(class extends HAe{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.inline=!1,this.label=void 0,this.scale="m",this.type=void 0,this.value=0,this.text=""}render(){const{el:e,inline:t,label:r,scale:i,text:s,type:n,value:o}=this,a=e.id||QAe(),l=.45,c=t?this.getInlineSize(i):this.getSize(i),u=c*l,d=`0 0 ${c} ${c}`,p=n==="determinate",g=2*u*Math.PI,y=o/100*g,_=g-y,v=Math.floor(o),w={"aria-valuenow":v,"aria-valuemin":0,"aria-valuemax":100,complete:v===100},T={r:u,cx:c/2,cy:c/2},x={"stroke-dasharray":`${y} ${_}`};return pu(Dle,{"aria-label":r,id:a,role:"progressbar",...p?w:{}},pu("div",{class:"loader__svgs"},pu("svg",{"aria-hidden":"true",class:"loader__svg loader__svg--1",viewBox:d},pu("circle",{...T})),pu("svg",{"aria-hidden":"true",class:"loader__svg loader__svg--2",viewBox:d},pu("circle",{...T})),pu("svg",{"aria-hidden":"true",class:"loader__svg loader__svg--3",viewBox:d,...p?{style:x}:{}},pu("circle",{...T}))),s&&pu("div",{class:"loader__text"},s),p&&pu("div",{class:"loader__percentage"},o))}getSize(e){return{s:32,m:56,l:80}[e]}getInlineSize(e){return{s:12,m:16,l:20}[e]}get el(){return this}static get style(){return Jut}},[1,"calcite-loader",{inline:[516],label:[1],scale:[513],type:[513],value:[2],text:[1]}]);function Qut(){if(typeof customElements>"u")return;["calcite-loader"].forEach(t=>{switch(t){case"calcite-loader":customElements.get(t)||customElements.define(t,Kut);break}})}Qut();YD.registerOAuthInfos([new t9({appId:"KojZjH6glligLidj",popup:!0,popupCallbackUrl:`${document.location.origin}${document.location.pathname}oauth-callback-api.html`})]);window.setOAuthResponseHash=e=>{YD.setOAuthResponseHash(e)};const g3=new Yut({portalItem:{id:"2f1e3813919043d08a31b2cdd85190ae"}}),JW=new lut({container:"viewDiv",map:g3,qualityProfile:"high"});g3.when().then(()=>{g3.ground.surfaceColor=new ot([220,220,220])});g3.loadAll().then(()=>{const e=g3.presentation.slides;e.getItemAt(Math.floor(Math.random()*e.length)).applyTo(JW,{animate:!1})});eT(()=>!JW.updating).then(()=>{const e=document.getElementById("loader");e?.parentElement?.removeChild(e)});window.view=JW;export{Y7 as $,_s as A,Xo as B,oy as C,Pmt as D,Lc as E,Ift as F,Wt as G,Pe as H,st as I,GRe as J,jl as K,br as L,si as M,ro as N,cy as O,Hoe as P,g7e as Q,of as R,gG as S,Ps as T,Vr as U,Pt as V,kl as W,ye as X,Pr as Y,Yt as Z,Yx as _,F as a,yn as a$,cT as a0,ut as a1,DN as a2,G as a3,KYe as a4,wS as a5,v3 as a6,uN as a7,pN as a8,hN as a9,C as aA,Uft as aB,Fft as aC,Um as aD,wT as aE,Mt as aF,Qft as aG,$n as aH,wo as aI,jmt as aJ,WH as aK,Nft as aL,Dft as aM,Dc as aN,qo as aO,_a as aP,at as aQ,xi as aR,Sye as aS,Sc as aT,_o as aU,Eo as aV,dht as aW,Ys as aX,td as aY,eT as aZ,se as a_,D3 as aa,QPe as ab,Qs as ac,cs as ad,Cft as ae,Ghe as af,Vu as ag,Gm as ah,dQe as ai,VGe as aj,Yu as ak,Jt as al,zGe as am,LV as an,ne as ao,spt as ap,eh as aq,so as ar,s9 as as,iGe as at,K as au,mi as av,aG as aw,re as ax,Zp as ay,qu as az,v1 as b,Rdt as b$,oe as b0,te as b1,mc as b2,Eft as b3,kn as b4,Dk as b5,De as b6,bft as b7,uGe as b8,cN as b9,bje as bA,emt as bB,Fo as bC,o1 as bD,sN as bE,py as bF,upt as bG,Bmt as bH,dpt as bI,Bc as bJ,yG as bK,fpt as bL,Xh as bM,ba as bN,y1 as bO,dT as bP,W_e as bQ,Mwe as bR,K1 as bS,fN as bT,X0 as bU,kdt as bV,gue as bW,oXe as bX,qne as bY,ii as bZ,V1 as b_,Dm as ba,f2 as bb,pQe as bc,CH as bd,J7 as be,xs as bf,w3 as bg,Nt as bh,yve as bi,npt as bj,ji as bk,k3 as bl,wgt as bm,Im as bn,Kce as bo,ry as bp,nZ as bq,Qce as br,IQe as bs,Mr as bt,Dwe as bu,hA as bv,iG as bw,Ms as bx,wje as by,vje as bz,Fp as c,q3e as c$,L3 as c0,_d as c1,Ho as c2,IV as c3,Ht as c4,fe as c5,yht as c6,p8 as c7,Fne as c8,Tue as c9,e$e as cA,g2 as cB,Us as cC,rN as cD,I3 as cE,MD as cF,uy as cG,BLe as cH,Zdt as cI,HS as cJ,mEe as cK,fEe as cL,pEe as cM,Ydt as cN,MPe as cO,Lpt as cP,iT as cQ,_Ee as cR,d2 as cS,Z1 as cT,edt as cU,Dr as cV,_X as cW,Lht as cX,UCe as cY,FCe as cZ,bG as c_,Gdt as ca,Pdt as cb,q3 as cc,ue as cd,$r as ce,D as cf,ae as cg,Ii as ch,tr as ci,Hr as cj,sd as ck,as as cl,We as cm,ti as cn,nD as co,Ie as cp,LLe as cq,M0 as cr,Fs as cs,ni as ct,Nj as cu,ggt as cv,LN as cw,Dpt as cx,Wpt as cy,kO as cz,ot as d,Mgt as d$,NPe as d0,Eue as d1,Smt as d2,AD as d3,Xne as d4,Xwe as d5,IPe as d6,Pht as d7,ud as d8,vEe as d9,bgt as dA,Dht as dB,ZD as dC,eL as dD,GOe as dE,mo as dF,jOe as dG,HOe as dH,WOe as dI,Lm as dJ,jD as dK,bIe as dL,Odt as dM,fue as dN,Wmt as dO,Fgt as dP,pbe as dQ,W1 as dR,i2 as dS,sf as dT,Mdt as dU,qpt as dV,ej as dW,Epe as dX,Idt as dY,Lgt as dZ,Cgt as d_,G3e as da,jwe as db,W$ as dc,X$ as dd,H$ as de,PPe as df,hht as dg,Hdt as dh,v8 as di,zV as dj,rA as dk,tdt as dl,Lu as dm,kPe as dn,zPe as dp,lq as dq,TX as dr,Rmt as ds,Emt as dt,Cmt as du,Amt as dv,rG as dw,Qct as dx,uC as dy,FLe as dz,h as e,Sa as e$,Ogt as e0,zut as e1,Egt as e2,WPe as e3,Sgt as e4,oet as e5,Z7 as e6,Hmt as e7,cet as e8,Or as e9,hpt as eA,ppt as eB,Vmt as eC,ULe as eD,Oft as eE,C0e as eF,EH as eG,Rft as eH,Pft as eI,Xpt as eJ,zdt as eK,j$ as eL,Ldt as eM,Bdt as eN,jIe as eO,omt as eP,nmt as eQ,LH as eR,kft as eS,HNe as eT,Qpt as eU,ztt as eV,Qmt as eW,AW as eX,$pt as eY,aet as eZ,net as e_,Fv as ea,fn as eb,X7 as ec,p7e as ed,f7e as ee,Iue as ef,ppe as eg,cdt as eh,udt as ei,Rgt as ej,rb as ek,Dgt as el,Ngt as em,Agt as en,Ypt as eo,Jpt as ep,Zpt as eq,cpt as er,Fpt as es,Sht as et,ar as eu,ld as ev,ihe as ew,Hxe as ex,jpt as ey,I7e as ez,V0 as f,pj as f$,DLe as f0,uA as f1,mr as f2,bc as f3,yd as f4,aft as f5,tN as f6,To as f7,Vi as f8,Cs as f9,BL as fA,df as fB,tt as fC,_r as fD,Vl as fE,ve as fF,B as fG,oi as fH,xr as fI,vr as fJ,dr as fK,Tt as fL,sg as fM,FN as fN,Uy as fO,Ka as fP,c4 as fQ,It as fR,ef as fS,My as fT,ky as fU,d4 as fV,bo as fW,ZH as fX,u4 as fY,P2 as fZ,UHe as f_,E as fa,Fe as fb,kv as fc,IN as fd,Kr as fe,$c as ff,Ws as fg,Hs as fh,Cr as fi,Fi as fj,lb as fk,Ct as fl,Si as fm,YT as fn,xgt as fo,c9 as fp,Y1 as fq,het as fr,pr as fs,Fl as ft,Xa as fu,b as fv,os as fw,kc as fx,qe as fy,Ae as fz,F3 as g,vnt as g$,pH as g0,_Ge as g1,Xs as g2,z3 as g3,$dt as g4,OPe as g5,lht as g6,b8 as g7,Jx as g8,RDe as g9,kut as gA,cht as gB,ur as gC,Ic as gD,aN as gE,hZ as gF,Tc as gG,Xue as gH,Il as gI,Nl as gJ,jne as gK,xwe as gL,rht as gM,cb as gN,Ive as gO,Sl as gP,eA as gQ,Qx as gR,u$e as gS,MIe as gT,$de as gU,$8e as gV,cgt as gW,mgt as gX,CP as gY,Ige as gZ,Wl as g_,Oc as ga,be as gb,vGe as gc,$st as gd,A1e as ge,NV as gf,FV as gg,bwe as gh,nht as gi,MN as gj,M7 as gk,Mj as gl,wj as gm,igt as gn,ugt as go,Pj as gp,Sy as gq,Ln as gr,Uu as gs,NWe as gt,$i as gu,Fn as gv,Ue as gw,z7 as gx,Pgt as gy,rV as gz,Rr as h,lgt as h$,w$e as h0,sgt as h1,t$e as h2,Nie as h3,Zx as h4,nft as h5,Vp as h6,gT as h7,Jr as h8,Ck as h9,cm as hA,vy as hB,y7 as hC,_I as hD,kmt as hE,Se as hF,yT as hG,W$e as hH,ls as hI,zc as hJ,Mi as hK,vm as hL,nW as hM,I4 as hN,Gr as hO,hgt as hP,zpt as hQ,ja as hR,ND as hS,vht as hT,OA as hU,Vc as hV,Lft as hW,Efe as hX,$u as hY,G7e as hZ,Zst as h_,Ku as ha,h$e as hb,At as hc,ws as hd,pi as he,p2 as hf,Lt as hg,pye as hh,fye as hi,$ft as hj,BS as hk,ce as hl,Bfe as hm,JD as hn,yA as ho,k7 as hp,K5 as hq,lA as hr,h1 as hs,Kt as ht,n_e as hu,I_e as hv,Foe as hw,LD as hx,Ide as hy,Go as hz,tG as i,vt as i$,Z0 as i0,N$e as i1,gn as i2,de as i3,Bo as i4,Pp as i5,TNe as i6,wY as i7,sZ as i8,Tgt as i9,_ht as iA,Bpt as iB,ty as iC,ih as iD,kWe as iE,Pc as iF,bt as iG,Wr as iH,ac as iI,hr as iJ,Bi as iK,el as iL,Is as iM,wt as iN,fi as iO,vo as iP,cH as iQ,Jp as iR,Li as iS,Fy as iT,Qt as iU,aL as iV,Ny as iW,fH as iX,fft as iY,Ne as iZ,xt as i_,_et as ia,iN as ib,Ft as ic,Umt as id,zmt as ie,kpt as ig,s0e as ih,n0e as ii,Mht as ij,o$e as ik,sft as il,F1 as im,w4 as io,b7e as ip,Tft as iq,Jce as ir,Tdt as is,aht as it,egt as iu,bdt as iv,QD as iw,Sft as ix,Pi as iy,v2 as iz,J1 as j,Nmt as j$,He as j0,o0e as j1,gft as j2,Vft as j3,no as j4,rW as j5,Ki as j6,hn as j7,Omt as j8,ix as j9,ddt as jA,Zye as jB,aWe as jC,hT as jD,nje as jE,Sdt as jF,Goe as jG,UD as jH,uG as jI,dA as jJ,uut as jK,F0 as jL,Ec as jM,CMe as jN,tT as jO,AMe as jP,sTe as jQ,lpt as jR,Ce as jS,QV as jT,ZV as jU,qX as jV,Lmt as jW,_Ze as jX,wZe as jY,Dmt as jZ,$mt as j_,cC as ja,jo as jb,Lk as jc,Zft as jd,gQ as je,Jft as jf,Adt as jg,pue as jh,q7 as ji,Pce as jj,$Oe as jk,Bft as jl,oye as jm,lye as jn,sye as jo,xQ as jp,_je as jq,jdt as jr,yft as js,hue as jt,TRe as ju,_dt as jv,uRe as jw,yRe as jx,cye as jy,U7 as jz,gA as k,pge as k$,yZe as k0,qc as k1,pe as k2,rg as k3,yJ as k4,hft as k5,Nc as k6,_J as k7,wa as k8,Iy as k9,Ddt as kA,Fdt as kB,Ndt as kC,Udt as kD,T0e as kE,Zr as kF,hM as kG,Oy as kH,rO as kI,Yft as kJ,hG as kK,$m as kL,uB as kM,fht as kN,YIe as kO,W7 as kP,H7 as kQ,gdt as kR,rgt as kS,ngt as kT,rpt as kU,hMe as kV,sv as kW,tgt as kX,bL as kY,opt as kZ,mft as k_,uft as ka,smt as kb,Vpt as kc,fa as kd,AUe as ke,jF as kf,Ts as kg,dft as kh,xL as ki,RIe as kj,Lhe as kk,rh as kl,Ks as km,wG as kn,ift as ko,XT as kp,gN as kq,YX as kr,vZe as ks,bZe as kt,Om as ku,ZDe as kv,XDe as kw,xft as kx,Igt as ky,Vdt as kz,Re as l,Ju as l$,U3 as l0,Ci as l1,QH as l2,yr as l3,Rc as l4,d8 as l5,C1 as l6,GN as l7,Hl as l8,ig as l9,gM as lA,Mrt as lB,Fct as lC,Ok as lD,ms as lE,Ak as lF,Pk as lG,Q$ as lH,Bhe as lI,Tp as lJ,Zmt as lK,Kmt as lL,f_e as lM,NB as lN,pD as lO,xv as lP,tre as lQ,Xmt as lR,Ymt as lS,wv as lT,qmt as lU,ZM as lV,WC as lW,bI as lX,rf as lY,Ya as lZ,eht as l_,io as la,Ze as lb,Sr as lc,Wo as ld,Hue as le,ogt as lf,agt as lg,oG as lh,I$e as li,Ed as lj,rr as lk,gr as ll,fgt as lm,Gmt as ln,v0e as lo,$E as lp,kde as lq,dL as lr,N0 as ls,rt as lt,TA as lu,FD as lv,Rm as lw,bN as lx,nRe as ly,oT as lz,xe as m,pde as m$,X0e as m0,Cu as m1,Qte as m2,DB as m3,Jet as m4,Ket as m5,wh as m6,XA as m7,kLe as m8,Rpt as m9,ndt as mA,ole as mB,mpt as mC,ypt as mD,gpt as mE,Ap as mF,EA as mG,xo as mH,Ss as mI,ng as mJ,mx as mK,Mmt as mL,_B as mM,ldt as mN,i9 as mO,Xu as mP,zi as mQ,Hh as mR,Pl as mS,sj as mT,ij as mU,Due as mV,Lr as mW,Le as mX,Opt as mY,Y$e as mZ,Su as m_,Zhe as ma,Yhe as mb,qT as mc,gy as md,Ll as me,c$e as mf,Cpt as mg,Apt as mh,x1 as mi,o9 as mj,eJ as mk,Ot as ml,Mp as mm,xLe as mn,Ipt as mo,Vhe as mp,Zt as mq,oo as mr,or as ms,Ei as mt,en as mu,Tx as mv,Imt as mw,rae as mx,tht as my,odt as mz,DC as n,ib as n$,Gpe as n0,ly as n1,MG as n2,JI as n3,g4e as n4,Bs as n5,kpe as n6,Hm as n7,SN as n8,B3 as n9,_Fe as nA,rft as nB,eft as nC,tft as nD,Tpt as nE,ept as nF,iy as nG,HL as nH,M0e as nI,oft as nJ,jpe as nK,fE as nL,Sx as nM,c8 as nN,Ta as nO,Kx as nP,UV as nQ,Hpt as nR,b3 as nS,tZe as nT,U1 as nU,Up as nV,lt as nW,VV as nX,Aft as nY,Sp as nZ,hme as n_,ri as na,_C as nb,AN as nc,Bde as nd,Mpt as ne,Ppt as nf,w4e as ng,S4e as nh,adt as ni,sdt as nj,idt as nk,Ev as nl,C7e as nm,ED as nn,mY as no,cft as np,fY as nq,R7 as nr,Zu as ns,uHe as nt,xa as nu,zN as nv,Sd as nw,Dn as nx,JQe as ny,Vv as nz,lZ as o,Fm as o$,LG as o0,Kdt as o1,Spt as o2,xdt as o3,uf as o4,TN as o5,EG as o6,xd as o7,zT as o8,Rt as o9,cwe as oA,Ez as oB,_H as oC,iht as oD,Hwe as oE,Ept as oF,R5 as oG,rL as oH,$He as oI,ygt as oJ,vgt as oK,_gt as oL,_3 as oM,wdt as oN,pY as oO,ap as oP,_A as oQ,NG as oR,fT as oS,Qdt as oT,Z9e as oU,FG as oV,Ahe as oW,pT as oX,Pde as oY,Xm as oZ,gLe as o_,to as oa,h4 as ob,_ge as oc,Pge as od,Ye as oe,Es as of,ipt as og,$G as oh,Lee as oi,dte as oj,SA as ok,M3 as ol,vpt as om,R0 as on,Uc as oo,P4 as op,Ja as oq,Yo as or,xc as os,Tge as ot,wpt as ou,xBe as ov,Fc as ow,P$e as ox,tVe as oy,HT as oz,$s as p,U$e as p$,RN as p0,bUe as p1,bpt as p2,rJ as p3,lft as p4,sb as p5,SIe as p6,Ott as p7,Att as p8,s1 as p9,pwe as pA,wft as pB,yQ as pC,vft as pD,QRe as pE,dMe as pF,Kft as pG,Xft as pH,aIe as pI,Tk as pJ,xu as pK,P6 as pL,M6 as pM,$B as pN,LB as pO,mht as pP,ght as pQ,zft as pR,Ol as pS,Pm as pT,E3 as pU,va as pV,gNe as pW,Hft as pX,Br as pY,Yi as pZ,pm as p_,cq as pa,oht as pb,wht as pc,rDe as pd,Btt as pe,Upt as pf,IOe as pg,_ft as ph,Aht as pi,Gnt as pj,jnt as pk,Nnt as pl,pgt as pm,gD as pn,dgt as po,Wnt as pp,qft as pq,Wft as pr,xH as ps,oje as pt,uye as pu,jft as pv,Gft as pw,qdt as px,Xdt as py,Wdt as pz,le as q,lmt as q$,nd as q0,xpt as q1,H$e as q2,Iht as q3,Zxe as q4,wl as q5,KV as q6,ETe as q7,Jmt as q8,fD as q9,vye as qA,Gje as qB,j1 as qC,vit as qD,Ant as qE,GW as qF,k1e as qG,Knt as qH,z1e as qI,tot as qJ,B1e as qK,iot as qL,V1e as qM,not as qN,G1e as qO,aot as qP,wfe as qQ,aFe as qR,bht as qS,WKe as qT,Ixe as qU,umt as qV,Tmt as qW,cmt as qX,amt as qY,sx as qZ,rXe as q_,Al as qa,UB as qb,kB as qc,FB as qd,ere as qe,qce as qf,Doe as qg,Wve as qh,Yrt as qi,BNe as qj,xC as qk,G4e as ql,O5e as qm,bfe as qn,vfe as qo,sFe as qp,Dfe as qq,GFe as qr,Ufe as qs,Cj as qt,ZFe as qu,U6e as qv,X6e as qw,AVe as qx,VL as qy,IGe as qz,rmt as r,qWe as r$,pdt as r0,zre as r1,Dre as r2,bRe as r3,Nre as r4,Kre as r5,Fre as r6,Edt as r7,Gre as r8,oie as r9,gmt as rA,Mre as rB,xre as rC,Tre as rD,Sre as rE,jre as rF,yie as rG,bie as rH,Ire as rI,_ie as rJ,lN as rK,y_e as rL,wmt as rM,bXe as rN,Yqe as rO,Jqe as rP,pmt as rQ,fmt as rR,_re as rS,g_e as rT,dmt as rU,Xqe as rV,XKe as rW,Kqe as rX,$3 as rY,nf as rZ,n1 as r_,bre as ra,aie as rb,lie as rc,ydt as rd,V7 as re,Yce as rf,fdt as rg,LRe as rh,ERe as ri,mdt as rj,cie as rk,vdt as rl,apt as rm,hmt as rn,xmt as ro,Jre as rp,tie as rq,_mt as rr,ymt as rs,jKe as rt,vmt as ru,bmt as rv,_ee as rw,bee as rx,vee as ry,mmt as rz,yt as s,Ek as s$,KWe as s0,pft as s1,gWe as s2,bWe as s3,eW as s4,vrt as s5,_rt as s6,i5 as s7,brt as s8,qL as s9,ZG as sA,$gt as sB,ane as sC,one as sD,fy as sE,zhe as sF,pV as sG,dN as sH,dNe as sI,hNe as sJ,aNe as sK,ZZ as sL,mut as sM,hdt as sN,BTe as sO,Mje as sP,mye as sQ,pht as sR,Cdt as sS,uht as sT,g1 as sU,tpt as sV,Rl as sW,kV as sX,_1 as sY,f$ as sZ,bC as s_,pHe as sa,Bot as sb,H1e as sc,jot as sd,W1e as se,Wot as sf,q1e as sg,b5 as sh,sat as si,pat as sj,Sat as sk,Cat as sl,Oat as sm,zO as sn,_Me as so,KHe as sp,X1e as sq,aat as sr,Hat as ss,QXe as st,PZe as su,uKe as sv,RKe as sw,TKe as sx,Yh as sy,Nue as sz,gi as t,_Ue as t$,h9 as t0,Qu as t1,AT as t2,$5e as t3,yj as t4,v$e as t5,nb as t6,TD as t7,Jdt as t8,Eht as t9,y3e as tA,nAe as tB,Ght as tC,qht as tD,g3e as tE,f3e as tF,zht as tG,Bht as tH,Vht as tI,Nht as tJ,Xht as tK,Hht as tL,Qht as tM,Uht as tN,x3e as tO,jht as tP,Yht as tQ,Zht as tR,kht as tS,Kht as tT,Oht as tU,$ht as tV,Gpt as tW,GLe as tX,jG as tY,gwe as tZ,Npt as t_,pRe as ta,vc as tb,qp as tc,Roe as td,um as te,kne as tf,xht as tg,_q as th,ehe as ti,Pbe as tj,XI as tk,SD as tl,Kpt as tm,Tht as tn,COe as to,M as tp,rdt as tq,FAe as tr,HAe as ts,Fht as tt,QAe as tu,pu as tv,Jht as tw,Dle as tx,Qut as ty,Wht as tz,imt as u,x$e as u0,b$e as u1,O_e as u2,Jv as u3,lUe as u4,Cht as u5,JY as u6,F_e as u7,k_e as u8,kC as u9,No as uA,bA as uB,SNe as uC,Jat as uD,f1e as uE,Cit as uF,h1e as uG,zit as uH,W_ as uI,UW as uJ,FW as uK,Tit as uL,JYe as uM,pW as uN,q_e as uO,fW as uP,X_e as uQ,WZe as uR,wB as uS,Rht as uT,STe as uU,_pt as uV,Mft as uW,tmt as uX,Fmt as uY,SYe as ua,fje as ub,dye as uc,sht as ud,gje as ue,tYe as uf,ZZe as ug,YZe as uh,iYe as ui,KZe as uj,QZe as uk,Gl as ul,JZe as um,zn as un,rYe as uo,xy as up,R1 as uq,mje as ur,eYe as us,M1 as ut,Qa as uu,bd as uv,Vx as uw,qb as ux,jde as uy,dLe as uz,hpe as v,T7e as w,km as x,f as y,tb as z};
