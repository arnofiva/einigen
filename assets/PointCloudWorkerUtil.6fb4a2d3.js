import"./index.da161cf1.js";import{a as k,b as C,d as A}from"./PointCloudUniqueValueRenderer.6a8e22b5.js";import{w as I,l as x,c as O,I as R}from"./I3SBinaryReader.f09861ac.js";function T(n,o,f,c){const{rendererJSON:d,isRGBRenderer:p}=n;let t=null,i=null;if(o&&p)t=o;else if(o&&d?.type==="pointCloudUniqueValueRenderer"){i=k.fromJSON(d);const e=i.colorUniqueValueInfos;t=new Uint8Array(3*c);const s=m(i.fieldTransformType);for(let r=0;r<c;r++){const a=(s?s(o[r]):o[r])+"";for(let l=0;l<e.length;l++)if(e[l].values.includes(a)){t[3*r]=e[l].color.r,t[3*r+1]=e[l].color.g,t[3*r+2]=e[l].color.b;break}}}else if(o&&d?.type==="pointCloudStretchRenderer"){i=C.fromJSON(d);const e=i.stops;t=new Uint8Array(3*c);const s=m(i.fieldTransformType);for(let r=0;r<c;r++){const a=s?s(o[r]):o[r],l=e.length-1;if(a<e[0].value)t[3*r]=e[0].color.r,t[3*r+1]=e[0].color.g,t[3*r+2]=e[0].color.b;else if(a>=e[l].value)t[3*r]=e[l].color.r,t[3*r+1]=e[l].color.g,t[3*r+2]=e[l].color.b;else for(let u=1;u<e.length;u++)if(a<e[u].value){const b=(a-e[u-1].value)/(e[u].value-e[u-1].value);t[3*r]=e[u].color.r*b+e[u-1].color.r*(1-b),t[3*r+1]=e[u].color.g*b+e[u-1].color.g*(1-b),t[3*r+2]=e[u].color.b*b+e[u-1].color.b*(1-b);break}}}else if(o&&d?.type==="pointCloudClassBreaksRenderer"){i=A.fromJSON(d);const e=i.colorClassBreakInfos;t=new Uint8Array(3*c);const s=m(i.fieldTransformType);for(let r=0;r<c;r++){const a=s?s(o[r]):o[r];for(let l=0;l<e.length;l++)if(a>=e[l].minValue&&a<=e[l].maxValue){t[3*r]=e[l].color.r,t[3*r+1]=e[l].color.g,t[3*r+2]=e[l].color.b;break}}}else t=new Uint8Array(3*c).fill(255);if(f&&i&&i.colorModulation){const e=i.colorModulation.minValue,s=i.colorModulation.maxValue,r=.3;for(let a=0;a<c;a++){const l=f[a],u=l>=s?1:l<=e?r:r+(1-r)*(l-e)/(s-e);t[3*a]=u*t[3*a],t[3*a+1]=u*t[3*a+1],t[3*a+2]=u*t[3*a+2]}}return t}function U(n,o){if(n.encoding==null||n.encoding===""){const f=I(o,n);if(f.vertexAttributes.position==null)return;const c=x(o,f.vertexAttributes.position),d=f.header.fields,p=[d.offsetX,d.offsetY,d.offsetZ],t=[d.scaleX,d.scaleY,d.scaleZ],i=c.length/3,e=new Float64Array(3*i);for(let s=0;s<i;s++)e[3*s]=c[3*s]*t[0]+p[0],e[3*s+1]=c[3*s+1]*t[1]+p[1],e[3*s+2]=c[3*s+2]*t[2]+p[2];return e}if(n.encoding==="lepcc-xyz")return O(o).result}function F(n,o,f){return n!=null&&n.attributeInfo.useElevation?o?S(o,f):null:n!=null&&n.attributeInfo.storageInfo?R(n.attributeInfo.storageInfo,n.buffer,f):null}function S(n,o){const f=new Float64Array(o);for(let c=0;c<o;c++)f[c]=n[3*c+2];return f}function J(n,o,f,c,d){const p=n.length/3;let t=0;for(let i=0;i<p;i++){let e=!0;for(let s=0;s<c.length&&e;s++){const{filterJSON:r}=c[s],a=d[s].values[i];switch(r.type){case"pointCloudValueFilter":{const l=r.mode==="exclude";r.values.includes(a)===l&&(e=!1);break}case"pointCloudBitfieldFilter":{const l=v(r.requiredSetBits),u=v(r.requiredClearBits);(a&l)===l&&(a&u)==0||(e=!1);break}case"pointCloudReturnFilter":{const l=15&a,u=a>>>4&15,b=u>1,w=l===1,y=l===u;let h=!1;for(const g of r.includedReturns)if(g==="last"&&y||g==="firstOfMany"&&w&&b||g==="lastOfMany"&&y&&b||g==="single"&&!b){h=!0;break}h||(e=!1);break}}}e&&(f[t]=i,n[3*t]=n[3*i],n[3*t+1]=n[3*i+1],n[3*t+2]=n[3*i+2],o[3*t]=o[3*i],o[3*t+1]=o[3*i+1],o[3*t+2]=o[3*i+2],t++)}return t}function m(n){switch(n){default:case null:case"none":return o=>o;case"low-four-bit":return o=>15&o;case"high-four-bit":return o=>(240&o)>>4;case"absolute-value":return o=>Math.abs(o);case"modulo-ten":return o=>o%10}}function v(n){let o=0;for(const f of n||[])o|=1<<f;return o}export{S as a,F as c,J as f,T as i,U as u};
