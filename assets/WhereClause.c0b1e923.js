import{gB as Fo,gC as Po,ao as Ae}from"./index.da161cf1.js";import{i as Me}from"./executionError.10e29c03.js";function _o(l,s){const o=Re[l.toLowerCase()];if(o==null)throw new Error("Function Not Recognised");if(s.length<o.minParams||s.length>o.maxParams)throw new Error(`Invalid Parameter count for call to ${l.toUpperCase()}`);return o.evaluate(s)}function Lo(l,s){const o=Re[l.toLowerCase()];return o!=null&&s>=o.minParams&&s<=o.maxParams}const Re={min:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.min.apply(Math,l[0])},max:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.max.apply(Math,l[0])},avg:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:De(l[0])},sum:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Mo(l[0])},stddev:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.sqrt(Se(l[0]))},count:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:l[0].length},var:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Se(l[0])}};function De(l){let s=0;for(let o=0;o<l.length;o++)s+=l[o];return s/l.length}function Mo(l){let s=0;for(let o=0;o<l.length;o++)s+=l[o];return s}function Se(l){const s=De(l),o=l.length;let f=0;for(const i of l)f+=(i-s)**2;return o>1?f/(o-1):0}var F;(function(l){l.InvalidFunctionParameters="InvalidFunctionParameters",l.UnsupportedSqlFunction="UnsupportedSqlFunction",l.UnsupportedOperator="UnsupportedOperator",l.UnsupportedSyntax="UnsupportedSyntax",l.UnsupportedIsRhs="UnsupportedIsRhs",l.UnsupportedIsLhs="UnsupportedIsLhs",l.InvalidDataType="InvalidDataType",l.CannotCastValue="CannotCastValue",l.MissingStatisticParameters="MissingStatisticParameters"})(F||(F={}));const Ro={[F.MissingStatisticParameters]:"Statistic does not have 1 or 0 Parameters",[F.InvalidFunctionParameters]:"Invalid parameters for call to {function}",[F.UnsupportedIsLhs]:"Unsupported left hand expression in is statement",[F.UnsupportedIsRhs]:"Unsupported right hand expression in is statement",[F.UnsupportedOperator]:"Unsupported operator - {operator}",[F.UnsupportedSyntax]:"Unsupported syntax - {node}",[F.UnsupportedSqlFunction]:"Sql function not found = {function}",[F.InvalidDataType]:"Invalid sql data type",[F.CannotCastValue]:"Cannot cast value to the required data type"};class U extends Error{constructor(s,o){super(Me(Ro[s],o)),this.declaredRootClass="esri.arcade.featureset.support.sqlerror",Error.captureStackTrace&&Error.captureStackTrace(this,U)}}var R;(function(l){l.NeverReach="NeverReach",l.NotImplemented="NotImplemented",l.Cancelled="Cancelled",l.InvalidStatResponse="InvalidStatResponse",l.InvalidRequest="InvalidRequest",l.RequestFailed="RequestFailed",l.MissingFeatures="MissingFeatures",l.AggregationFieldNotFound="AggregationFieldNotFound",l.DataElementsNotFound="DataElementsNotFound"})(R||(R={}));const Do={[R.Cancelled]:"Cancelled",[R.InvalidStatResponse]:"Invalid statistics response from service",[R.InvalidRequest]:"Invalid request",[R.RequestFailed]:"Request failed - {reason}",[R.MissingFeatures]:"Missing features",[R.AggregationFieldNotFound]:"Aggregation field not found",[R.DataElementsNotFound]:"Data elements not found on service",[R.NeverReach]:"Encountered unreachable logic",[R.NotImplemented]:"Not implemented"};class Oe extends Error{constructor(s,o){super(Me(Do[s],o)),this.declaredRootClass="esri.arcade.featureset.support.featureseterror",Error.captureStackTrace&&Error.captureStackTrace(this,Oe)}}class E{constructor(){this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0,this.millis=0}static _fixDefaults(s){if(s.precision!==null||s.secondary!==null)throw new Error("Primary and Secondary SqlInterval qualifiers not supported")}static _parseSecondsComponent(s,o){if(o.includes(".")){const f=o.split(".");s.second=parseFloat(f[0]),s.millis=parseInt(f[1],10)}else s.second=parseFloat(o)}static createFromMilliseconds(s){const o=new E;return o.second=s/1e3,o}static createFromValueAndQualifer(s,o,f){let i=null;const d=new E;if(d.op=f==="-"?"-":"+",o.type==="interval-period"){E._fixDefaults(o);const m=new RegExp("^[0-9]{1,}$");if(o.period==="year"||o.period==="month")throw new Error("Year-Month Intervals not supported");if(o.period==="second"){if(!/^[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/.test(s))throw new Error("Illegal Interval");E._parseSecondsComponent(d,s)}else{if(!m.test(s))throw new Error("Illegal Interval");d[o.period]=parseFloat(s)}}else{if(E._fixDefaults(o.start),E._fixDefaults(o.end),o.start.period==="year"||o.start.period==="month")throw new Error("Year-Month Intervals not supported");if(o.end.period==="year"||o.end.period==="month")throw new Error("Year-Month Intervals not supported");switch(o.start.period){case"day":switch(o.end.period){case"hour":if(i=new RegExp("^[0-9]{1,} [0-9]{1,}$"),!i.test(s))throw new Error("Illegal Interval");d[o.start.period]=parseFloat(s.split(" ")[0]),d[o.end.period]=parseFloat(s.split(" ")[1]);break;case"minute":if(i=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$"),!i.test(s))throw new Error("Illegal Interval");{d[o.start.period]=parseFloat(s.split(" ")[0]);const m=s.split(" ")[1].split(":");d.hour=parseFloat(m[0]),d.minute=parseFloat(m[1])}break;case"second":if(i=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!i.test(s))throw new Error("Illegal Interval");{d[o.start.period]=parseFloat(s.split(" ")[0]);const m=s.split(" ")[1].split(":");d.hour=parseFloat(m[0]),d.minute=parseFloat(m[1]),E._parseSecondsComponent(d,m[2])}break;default:throw new Error("Invalid Interval.")}break;case"hour":switch(o.end.period){case"minute":if(i=new RegExp("^[0-9]{1,}:[0-9]{1,}$"),!i.test(s))throw new Error("Illegal Interval");d.hour=parseFloat(s.split(":")[0]),d.minute=parseFloat(s.split(":")[1]);break;case"second":if(i=new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!i.test(s))throw new Error("Illegal Interval");{const m=s.split(":");d.hour=parseFloat(m[0]),d.minute=parseFloat(m[1]),E._parseSecondsComponent(d,m[2])}break;default:throw new Error("Invalid Interval.")}break;case"minute":if(o.end.period!=="second")throw new Error("Invalid Interval.");if(i=new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!i.test(s))throw new Error("Illegal Interval");{const m=s.split(":");d.minute=parseFloat(m[0]),E._parseSecondsComponent(d,m[1])}break;default:throw new Error("Invalid Interval.")}}return d}valueInMilliseconds(){return(this.op==="-"?-1:1)*(this.millis+1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)}}function Pt(l,s){const o=$e[l.toLowerCase()];if(o==null)throw new Error("Function Not Recognised");if(s.length<o.minParams||s.length>o.maxParams)throw new Error(`Invalid Parameter count for call to ${l.toUpperCase()}`);return o.evaluate(s)}function Oo(l,s){const o=$e[l.toLowerCase()];return o!=null&&s>=o.minParams&&s<=o.maxParams}function $o(l){return typeof l=="string"||l instanceof String}function Jo(l){return l instanceof Date}function Ee(l){const s=new Date(l.getTime());return s.setHours(0,0,0,0),s}function Ce(l,s){if(Jo(l))return s?Ee(l):l;if($o(l)){const o=Po.fromSQL(l);if(o.isValid)return s?Ee(o.toJSDate()):o.toJSDate()}throw new U(F.CannotCastValue)}const $e={extract:{minParams:2,maxParams:2,evaluate:([l,s])=>{if(s==null)return null;if(s instanceof Date)switch(l.toUpperCase()){case"SECOND":return s.getSeconds();case"MINUTE":return s.getMinutes();case"HOUR":return s.getHours();case"DAY":return s.getDate();case"MONTH":return s.getMonth()+1;case"YEAR":return s.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:l=>{if(l.length===2){const[s,o]=l;return s==null||o==null?null:s.toString().substring(o-1)}if(l.length===3){const[s,o,f]=l;return s==null||o==null||f==null?null:f<=0?"":s.toString().substring(o-1,o+f-1)}}},position:{minParams:2,maxParams:2,evaluate:([l,s])=>l==null||s==null?null:s.indexOf(l)+1},trim:{minParams:2,maxParams:3,evaluate:l=>{const s=l.length===3,o=s?l[1]:" ",f=s?l[2]:l[1];if(o==null||f==null)return null;const i=`(${Fo(o)})`;switch(l[0]){case"BOTH":return f.replaceAll(new RegExp(`^${i}*|${i}*$`,"g"),"");case"LEADING":return f.replaceAll(new RegExp(`^${i}*`,"g"),"");case"TRAILING":return f.replaceAll(new RegExp(`${i}*$`,"g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.abs(l[0])},ceiling:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.ceil(l[0])},floor:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.floor(l[0])},log:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.log(l[0])},log10:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.log(l[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.sin(l[0])},cos:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.cos(l[0])},tan:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.tan(l[0])},asin:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.asin(l[0])},acos:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.acos(l[0])},atan:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.atan(l[0])},sign:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:l[0]>0?1:l[1]<0?-1:0},power:{minParams:2,maxParams:2,evaluate:l=>l[0]==null||l[1]==null?null:l[0]**l[1]},mod:{minParams:2,maxParams:2,evaluate:l=>l[0]==null||l[1]==null?null:l[0]%l[1]},round:{minParams:1,maxParams:2,evaluate:l=>{const s=l[0],o=l.length===2?10**l[1]:1;return s==null?null:Math.round(s*o)/o}},truncate:{minParams:1,maxParams:2,evaluate:l=>l[0]==null?null:l.length===1?parseInt(l[0].toFixed(0),10):parseFloat(l[0].toFixed(l[1]))},char_length:{minParams:1,maxParams:1,evaluate:l=>typeof l[0]=="string"||l[0]instanceof String?l[0].length:0},concat:{minParams:1,maxParams:1/0,evaluate:l=>{let s="";for(let o=0;o<l.length;o++){if(l[o]==null)return null;s+=l[o].toString()}return s}},lower:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:l[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:l[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:1/0,evaluate:l=>{for(const s of l)if(s!==null)return s;return null}},cosh:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.cosh(l[0])},sinh:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.sinh(l[0])},tanh:{minParams:1,maxParams:1,evaluate:l=>l[0]==null?null:Math.tanh(l[0])},nullif:{minParams:2,maxParams:2,evaluate:l=>{const s=l[0],o=l[1];return(s instanceof Date?s.valueOf():s)===(o instanceof Date?o.valueOf():o)?null:s}},cast:{minParams:2,maxParams:2,evaluate:l=>{const s=l[0],o=l[1];if(s===null)return null;switch(o.type){case"integer":{const f=parseInt(s,10);if(isNaN(f))throw new U(F.CannotCastValue);return f}case"smallint":{const f=parseInt(s,10);if(isNaN(f))throw new U(F.CannotCastValue);if(f>32767||f<-32767)throw new U(F.CannotCastValue);return f}case"float":case"real":{const f=parseFloat(s);if(isNaN(f))throw new U(F.CannotCastValue);return f}case"date":return Ce(s,!0);case"timestamp":return Ce(s,!1);case"varchar":{const f=s.toString();if(f.length>o.size)throw new U(F.CannotCastValue);return f}default:throw new U(F.InvalidDataType)}}}};var Fe,Pe,At={exports:{}};At.exports,Pe=function(){function l(i,d){function m(){this.constructor=i}m.prototype=d.prototype,i.prototype=new m}function s(i,d,m,e){var N=Error.call(this,i);return Object.setPrototypeOf&&Object.setPrototypeOf(N,s.prototype),N.expected=d,N.found=m,N.location=e,N.name="SyntaxError",N}function o(i,d,m){return m=m||" ",i.length>d?i:(d-=i.length,i+(m+=m.repeat(d)).slice(0,d))}function f(i,d){var m,e={},N=(d=d!==void 0?d:{}).grammarSource,b={start:Wt},L=Wt,q="!",O="=",T=">=",S=">",M="<=",C="<>",je="<",Lt="!=",ft="+",pt="-",Mt="||",ze="*",Ge="/",We="@",Rt="'",Dt="N'",Z="''",Ye=".",Ke="null",Qe="true",Ze="false",Xe="in",tn="is",en="like",nn="escape",rn="not",an="and",sn="or",un="between",on="from",ln="for",cn="substring",fn="extract",pn="trim",dn="position",vn="timestamp",hn="date",mn="leading",gn="trailing",yn="both",wn="cast",Nn="as",In="integer",bn="smallint",Tn="float",xn="real",An="varchar",Sn="to",En="interval",Cn="year",Fn="month",Pn="day",_n="hour",Ln="minute",Mn="second",Rn="case",Dn="end",On="when",$n="then",Jn="else",Un=",",kn="(",qn=")",Ot="`",Vn=/^[A-Za-z_\x80-\uFFFF]/,Hn=/^[A-Za-z0-9_]/,Bn=/^[A-Za-z0-9_.\x80-\uFFFF]/,$t=/^[^']/,jn=/^[0-9]/,zn=/^[eE]/,Gn=/^[+\-]/,Wn=/^[ \t\n\r]/,Jt=/^[^`]/,Yn=g("!",!1),Ut=g("=",!1),Kn=g(">=",!1),Qn=g(">",!1),Zn=g("<=",!1),Xn=g("<>",!1),tr=g("<",!1),er=g("!=",!1),dt=g("+",!1),vt=g("-",!1),nr=g("||",!1),rr=g("*",!1),ar=g("/",!1),sr=$([["A","Z"],["a","z"],"_",["\x80","\uFFFF"]],!1,!1),ur=$([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),or=$([["A","Z"],["a","z"],["0","9"],"_",".",["\x80","\uFFFF"]],!1,!1),ir=g("@",!1),kt=g("'",!1),lr=g("N'",!1),qt=g("''",!1),Vt=$(["'"],!0,!1),cr=g(".",!1),fr=$([["0","9"]],!1,!1),pr=$(["e","E"],!1,!1),dr=$(["+","-"],!1,!1),vr=g("NULL",!0),hr=g("TRUE",!0),mr=g("FALSE",!0),gr=g("IN",!0),yr=g("IS",!0),wr=g("LIKE",!0),Nr=g("ESCAPE",!0),Ir=g("NOT",!0),br=g("AND",!0),Tr=g("OR",!0),xr=g("BETWEEN",!0),Ar=g("FROM",!0),Sr=g("FOR",!0),Er=g("SUBSTRING",!0),Cr=g("EXTRACT",!0),Fr=g("TRIM",!0),Pr=g("POSITION",!0),_r=g("TIMESTAMP",!0),Lr=g("DATE",!0),Mr=g("LEADING",!0),Rr=g("TRAILING",!0),Dr=g("BOTH",!0),Or=g("CAST",!0),$r=g("AS",!0),Jr=g("INTEGER",!0),Ur=g("SMALLINT",!0),kr=g("FLOAT",!0),qr=g("REAL",!0),Vr=g("VARCHAR",!0),Hr=g("TO",!0),Br=g("INTERVAL",!0),jr=g("YEAR",!0),zr=g("MONTH",!0),Gr=g("DAY",!0),Wr=g("HOUR",!0),Yr=g("MINUTE",!0),Kr=g("SECOND",!0),Qr=g("CASE",!0),Zr=g("END",!0),Xr=g("WHEN",!0),ta=g("THEN",!0),ea=g("ELSE",!0),na=g(",",!1),ra=g("(",!1),aa=g(")",!1),sa=$([" ","	",`
`,"\r"],!1,!1),Ht=g("`",!1),Bt=$(["`"],!0,!1),ua=function(t){return t},oa=function(t,r){var a={type:"expression-list"},u=Co(t,r);return a.value=u,a},ia=function(t,r){return K(t,r)},la=function(t,r){return K(t,r)},ca=function(t){return So("NOT",t)},fa=function(t,r){return r==""||r==null||r==null?t:r.type=="arithmetic"?K(t,r.tail):xe(r.op,t,r.right,r.escape)},pa=function(t){return{type:"arithmetic",tail:t}},da=function(t,r){return{op:t+"NOT",right:r}},va=function(t,r){return{op:t,right:r}},ha=function(t,r,a){return{op:"NOT"+t,right:{type:"expression-list",value:[r,a]}}},ma=function(t,r,a){return{op:t,right:{type:"expression-list",value:[r,a]}}},ga=function(t){return t[0]+" "+t[2]},ya=function(t){return t[0]+" "+t[2]},wa=function(t,r,a){return{op:t,right:r,escape:a.value}},Na=function(t,r){return{op:t,right:r,escape:""}},Ia=function(t,r){return{op:t,right:r}},ba=function(t){return{op:t,right:{type:"expression-list",value:[]}}},Ta=function(t,r){return{op:t,right:r}},xa=function(t,r){return K(t,r)},Aa=function(t,r){return K(t,r)},Sa=function(t){return t.paren=!0,t},Ea=function(t){return/^CURRENT_DATE$/i.test(t)?{type:"current-time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(t)?{type:"current-time",mode:"timestamp"}:{type:"column-reference",table:"",column:t}},Ca=function(t){return t},Fa=function(t,r){return t+r.join("")},Pa=function(t,r){return t+r.join("")},_a=function(t){return{type:"parameter",value:t[1]}},La=function(t,r){return{type:"function",name:"extract",args:{type:"expression-list",value:[{type:"string",value:t},r]}}},Ma=function(t,r,a){return{type:"function",name:"substring",args:{type:"expression-list",value:a?[t,r,a[2]]:[t,r]}}},Ra=function(t,r){return{type:"function",name:"cast",args:{type:"expression-list",value:[t,r]}}},Da=function(){return{type:"data-type",value:{type:"integer"}}},Oa=function(){return{type:"data-type",value:{type:"smallint"}}},$a=function(){return{type:"data-type",value:{type:"float"}}},Ja=function(){return{type:"data-type",value:{type:"real"}}},Ua=function(){return{type:"data-type",value:{type:"date"}}},ka=function(){return{type:"data-type",value:{type:"timestamp"}}},qa=function(t){return{type:"data-type",value:{type:"varchar",size:parseInt(t)}}},Va=function(t,r,a){return{type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:t??"BOTH"},r,a]}}},Ha=function(t,r){return{type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:t??"BOTH"},r]}}},Ba=function(t,r){return{type:"function",name:"position",args:{type:"expression-list",value:[t,r]}}},ja=function(t,r){return{type:"function",name:t,args:r||{type:"expression-list",value:[]}}},za=function(t){return{type:"timestamp",value:t.value}},Ga=function(t,r,a){return{type:"interval",value:r,qualifier:a,op:t}},Wa=function(t,r){return{type:"interval",value:t,qualifier:r,op:""}},Ya=function(t,r){return{type:"interval-qualifier",start:t,end:r}},Ka=function(t,r){return{type:"interval-period",period:t.value,precision:r,secondary:null}},Qa=function(t){return{type:"interval-period",period:t.value,precision:null,secondary:null}},Za=function(t){return{type:"interval-period",period:t.value,precision:null,secondary:null}},Xa=function(t,r){return{type:"interval-period",period:"second",precision:t,secondary:r}},ts=function(t){return{type:"interval-period",period:"second",precision:t,secondary:null}},es=function(){return{type:"interval-period",period:"second",precision:null,secondary:null}},ns=function(t,r){return{type:"interval-period",period:t.value,precision:r,secondary:null}},rs=function(t){return{type:"interval-period",period:t.value,precision:null,secondary:null}},as=function(t,r){return{type:"interval-period",period:"second",precision:t,secondary:r}},ss=function(t){return{type:"interval-period",period:"second",precision:t,secondary:null}},us=function(){return{type:"interval-period",period:"second",precision:null,secondary:null}},os=function(){return{type:"string",value:"day"}},is=function(){return{type:"string",value:"hour"}},ls=function(){return{type:"string",value:"minute"}},cs=function(){return{type:"string",value:"month"}},fs=function(){return{type:"string",value:"year"}},ps=function(t){return parseFloat(t)},ds=function(t){return parseFloat(t)},vs=function(t){return{type:"date",value:t.value}},hs=function(){return{type:"null",value:null}},ms=function(){return{type:"boolean",value:!0}},gs=function(){return{type:"boolean",value:!1}},jt=function(){return"'"},ys=function(t){return{type:"string",value:t.join("")}},ws=function(t,r){return{type:"case-expression",format:"simple",operand:t,clauses:r,else:null}},Ns=function(t,r,a){return{type:"case-expression",format:"simple",operand:t,clauses:r,else:a.value}},Is=function(t){return{type:"case-expression",format:"searched",clauses:t,else:null}},bs=function(t,r){return{type:"case-expression",format:"searched",clauses:t,else:r.value}},Ts=function(t,r){return{type:"when-clause",operand:t,value:r}},xs=function(t,r){return{type:"when-clause",operand:t,value:r}},As=function(t){return{type:"else-clause",value:t}},Ss=function(t){return{type:"number",value:t}},Es=function(t,r,a){return parseFloat(t+r+a)},Cs=function(t,r){return parseFloat(t+r)},Fs=function(t,r){return parseFloat(t+r)},Ps=function(t){return parseFloat(t)},_s=function(t,r){return t[0]+r},Ls=function(t){return"."+(t??"")},Ms=function(t,r){return t+r},Rs=function(t){return t.join("")},Ds=function(t,r){return"e"+(r===null?"":r)},Os=function(){return"IN"},$s=function(){return"IS"},Js=function(){return"LIKE"},Us=function(){return"ESCAPE"},ks=function(){return"NOT"},qs=function(){return"AND"},Vs=function(){return"OR"},Hs=function(){return"BETWEEN"},Bs=function(){return"FROM"},js=function(){return"FOR"},zs=function(){return"SUBSTRING"},Gs=function(){return"EXTRACT"},Ws=function(){return"TRIM"},Ys=function(){return"POSITION"},Ks=function(){return"TIMESTAMP"},Qs=function(){return"DATE"},Zs=function(){return"LEADING"},Xs=function(){return"TRAILING"},tu=function(){return"BOTH"},eu=function(){return"CAST"},nu=function(){return"AS"},ru=function(){return"INTEGER"},au=function(){return"SMALLINT"},su=function(){return"FLOAT"},uu=function(){return"REAL"},ou=function(){return"VARCHAR"},iu=function(){return"TO"},lu=function(){return"INTERVAL"},cu=function(){return"YEAR"},fu=function(){return"MONTH"},pu=function(){return"DAY"},du=function(){return"HOUR"},vu=function(){return"MINUTE"},hu=function(){return"SECOND"},mu=function(){return"CASE"},gu=function(){return"END"},yu=function(){return"WHEN"},wu=function(){return"THEN"},Nu=function(){return"ELSE"},Iu=function(t){return t},bu=function(t){return t.join("")},n=0,X=[{line:1,column:1}],D=0,ht=[],c=0;if("startRule"in d){if(!(d.startRule in b))throw new Error(`Can't start parsing from rule "`+d.startRule+'".');L=b[d.startRule]}function g(t,r){return{type:"literal",text:t,ignoreCase:r}}function $(t,r,a){return{type:"class",parts:t,inverted:r,ignoreCase:a}}function Tu(){return{type:"end"}}function zt(t){var r,a=X[t];if(a)return a;for(r=t-1;!X[r];)r--;for(a={line:(a=X[r]).line,column:a.column};r<t;)i.charCodeAt(r)===10?(a.line++,a.column=1):a.column++,r++;return X[t]=a,a}function Gt(t,r,a){var u=zt(t),h=zt(r),w={source:N,start:{offset:t,line:u.line,column:u.column},end:{offset:r,line:h.line,column:h.column}};return a&&N&&typeof N.offset=="function"&&(w.start=N.offset(w.start),w.end=N.offset(w.end)),w}function v(t){n<D||(n>D&&(D=n,ht=[]),ht.push(t))}function xu(t,r,a){return new s(s.buildMessage(t,r),t,r,a)}function Wt(){var t,r;return t=n,p(),(r=A())!==e?(p(),t=ua(r)):(n=t,t=e),t}function Yt(){var t,r,a,u,h,w,I,x;if(t=n,(r=A())!==e){for(a=[],u=n,h=p(),(w=lt())!==e?(I=p(),(x=A())!==e?u=h=[h,w,I,x]:(n=u,u=e)):(n=u,u=e);u!==e;)a.push(u),u=n,h=p(),(w=lt())!==e?(I=p(),(x=A())!==e?u=h=[h,w,I,x]:(n=u,u=e)):(n=u,u=e);t=oa(r,a)}else n=t,t=e;return t}function A(){var t,r,a,u,h,w,I,x;if(t=n,(r=mt())!==e){for(a=[],u=n,h=p(),(w=ce())!==e?(I=p(),(x=mt())!==e?u=h=[h,w,I,x]:(n=u,u=e)):(n=u,u=e);u!==e;)a.push(u),u=n,h=p(),(w=ce())!==e?(I=p(),(x=mt())!==e?u=h=[h,w,I,x]:(n=u,u=e)):(n=u,u=e);t=ia(r,a)}else n=t,t=e;return t}function mt(){var t,r,a,u,h,w,I,x;if(t=n,(r=tt())!==e){for(a=[],u=n,h=p(),(w=ut())!==e?(I=p(),(x=tt())!==e?u=h=[h,w,I,x]:(n=u,u=e)):(n=u,u=e);u!==e;)a.push(u),u=n,h=p(),(w=ut())!==e?(I=p(),(x=tt())!==e?u=h=[h,w,I,x]:(n=u,u=e)):(n=u,u=e);t=la(r,a)}else n=t,t=e;return t}function tt(){var t,r,a,u,h;return t=n,(r=Y())===e&&(r=n,i.charCodeAt(n)===33?(a=q,n++):(a=e,c===0&&v(Yn)),a!==e?(u=n,c++,i.charCodeAt(n)===61?(h=O,n++):(h=e,c===0&&v(Ut)),c--,h===e?u=void 0:(n=u,u=e),u!==e?r=a=[a,u]:(n=r,r=e)):(n=r,r=e)),r!==e?(a=p(),(u=tt())!==e?t=ca(u):(n=t,t=e)):(n=t,t=e),t===e&&(t=Au()),t}function Au(){var t,r,a;return t=n,(r=J())!==e?(p(),(a=Su())===e&&(a=null),t=fa(r,a)):(n=t,t=e),t}function Su(){var t;return(t=Eu())===e&&(t=_u())===e&&(t=Fu())===e&&(t=Cu())===e&&(t=Pu()),t}function Eu(){var t,r,a,u,h,w;if(t=[],r=n,a=p(),(u=Kt())!==e?(h=p(),(w=J())!==e?r=a=[a,u,h,w]:(n=r,r=e)):(n=r,r=e),r!==e)for(;r!==e;)t.push(r),r=n,a=p(),(u=Kt())!==e?(h=p(),(w=J())!==e?r=a=[a,u,h,w]:(n=r,r=e)):(n=r,r=e);else t=e;return t!==e&&(t=pa(t)),t}function Kt(){var t;return i.substr(n,2)===T?(t=T,n+=2):(t=e,c===0&&v(Kn)),t===e&&(i.charCodeAt(n)===62?(t=S,n++):(t=e,c===0&&v(Qn)),t===e&&(i.substr(n,2)===M?(t=M,n+=2):(t=e,c===0&&v(Zn)),t===e&&(i.substr(n,2)===C?(t=C,n+=2):(t=e,c===0&&v(Xn)),t===e&&(i.charCodeAt(n)===60?(t=je,n++):(t=e,c===0&&v(tr)),t===e&&(i.charCodeAt(n)===61?(t=O,n++):(t=e,c===0&&v(Ut)),t===e&&(i.substr(n,2)===Lt?(t=Lt,n+=2):(t=e,c===0&&v(er)))))))),t}function Cu(){var t,r,a,u;return t=n,(r=ie())!==e?(p(),(a=Y())!==e?(p(),(u=J())!==e?t=da(r,u):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,(r=ie())!==e?(p(),(a=J())!==e?t=va(r,a):(n=t,t=e)):(n=t,t=e)),t}function Fu(){var t,r,a,u,h,w;return t=n,(r=Y())!==e?(p(),(a=fe())!==e?(p(),(u=J())!==e?(p(),(h=ut())!==e?(p(),(w=J())!==e?t=ha(a,u,w):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,(r=fe())!==e?(p(),(a=J())!==e?(p(),(u=ut())!==e?(p(),(h=J())!==e?t=ma(r,a,h):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)),t}function Qt(){var t,r,a,u,h;return t=n,r=n,(a=Y())!==e?(u=p(),(h=le())!==e?r=a=[a,u,h]:(n=r,r=e)):(n=r,r=e),r!==e&&(r=ga(r)),(t=r)===e&&(t=le()),t}function gt(){var t,r,a,u,h;return t=n,r=n,(a=Y())!==e?(u=p(),(h=Tt())!==e?r=a=[a,u,h]:(n=r,r=e)):(n=r,r=e),r!==e&&(r=ya(r)),(t=r)===e&&(t=Tt()),t}function Pu(){var t,r,a,u;return t=n,(r=Qt())!==e?(p(),(a=G())!==e?(p(),oo()!==e?(p(),(u=bt())!==e?t=wa(r,a,u):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,(r=Qt())!==e?(p(),(a=G())!==e?t=Na(r,a):(n=t,t=e)):(n=t,t=e)),t}function _u(){var t,r,a,u;return t=n,(r=gt())!==e?(p(),(a=P())!==e?(p(),(u=Yt())!==e?(p(),_()!==e?t=Ia(r,u):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,(r=gt())!==e?(p(),(a=P())!==e?(p(),(u=_())!==e?t=ba(r):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,(r=gt())!==e?(p(),(a=It())!==e?t=Ta(r,a):(n=t,t=e)):(n=t,t=e))),t}function J(){var t,r,a,u,h,w,I,x;if(t=n,(r=yt())!==e){for(a=[],u=n,h=p(),(w=Zt())!==e?(I=p(),(x=yt())!==e?u=h=[h,w,I,x]:(n=u,u=e)):(n=u,u=e);u!==e;)a.push(u),u=n,h=p(),(w=Zt())!==e?(I=p(),(x=yt())!==e?u=h=[h,w,I,x]:(n=u,u=e)):(n=u,u=e);t=xa(r,a)}else n=t,t=e;return t}function Zt(){var t;return i.charCodeAt(n)===43?(t=ft,n++):(t=e,c===0&&v(dt)),t===e&&(i.charCodeAt(n)===45?(t=pt,n++):(t=e,c===0&&v(vt)),t===e&&(i.substr(n,2)===Mt?(t=Mt,n+=2):(t=e,c===0&&v(nr)))),t}function yt(){var t,r,a,u,h,w,I,x;if(t=n,(r=wt())!==e){for(a=[],u=n,h=p(),(w=Xt())!==e?(I=p(),(x=wt())!==e?u=h=[h,w,I,x]:(n=u,u=e)):(n=u,u=e);u!==e;)a.push(u),u=n,h=p(),(w=Xt())!==e?(I=p(),(x=wt())!==e?u=h=[h,w,I,x]:(n=u,u=e)):(n=u,u=e);t=Aa(r,a)}else n=t,t=e;return t}function Xt(){var t;return i.charCodeAt(n)===42?(t=ze,n++):(t=e,c===0&&v(rr)),t===e&&(i.charCodeAt(n)===47?(t=Ge,n++):(t=e,c===0&&v(ar))),t}function wt(){var t,r;return(t=Hu())===e&&(t=Du())===e&&(t=Ou())===e&&(t=Uu())===e&&(t=ku())===e&&(t=$u())===e&&(t=qu())===e&&(t=Zu())===e&&(t=Lu())===e&&(t=It())===e&&(t=n,P()!==e?(p(),(r=A())!==e?(p(),_()!==e?t=Sa(r):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)),t}function Lu(){var t;return(t=Mu())!==e&&(t=Ea(t)),t}function Mu(){var t;return(t=Ru())!==e&&(t=Ca(t)),t}function Ru(){var t,r,a,u;if(t=n,(r=Nt())!==e){for(a=[],u=ee();u!==e;)a.push(u),u=ee();t=Fa(r,a)}else n=t,t=e;return t}function te(){var t,r,a,u;if(t=n,(r=Nt())!==e){for(a=[],u=y();u!==e;)a.push(u),u=y();t=Pa(r,a)}else n=t,t=e;return t}function Nt(){var t;return Vn.test(i.charAt(n))?(t=i.charAt(n),n++):(t=e,c===0&&v(sr)),t}function y(){var t;return Hn.test(i.charAt(n))?(t=i.charAt(n),n++):(t=e,c===0&&v(ur)),t}function ee(){var t;return Bn.test(i.charAt(n))?(t=i.charAt(n),n++):(t=e,c===0&&v(or)),t}function It(){var t,r,a;return t=n,i.charCodeAt(n)===64?(r=We,n++):(r=e,c===0&&v(ir)),r!==e&&(a=te())!==e?t=r=[r,a]:(n=t,t=e),t!==e&&(t=_a(t)),t}function Du(){var t,r,a;return t=n,co()!==e?(p(),P()!==e?(p(),(r=Vu())!==e?(p(),xt()!==e?(p(),(a=A())!==e?(p(),_()!==e?t=La(r,a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t}function Ou(){var t,r,a,u,h,w,I;return t=n,lo()!==e?(p(),P()!==e?(p(),(r=A())!==e?(p(),xt()!==e?(p(),(a=A())!==e?(p(),u=n,(h=io())!==e?(w=p(),(I=A())!==e?u=h=[h,w,I,p()]:(n=u,u=e)):(n=u,u=e),u===e&&(u=null),(h=_())!==e?t=Ma(r,a,u):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t}function $u(){var t,r,a;return t=n,mo()!==e?(p(),P()!==e?(p(),(r=A())!==e?(p(),go()!==e?(p(),(a=Ju())!==e?(p(),_()!==e?t=Ra(r,a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t}function Ju(){var t,r,a;return t=n,(r=yo())!==e&&(r=Da()),(t=r)===e&&(t=n,(r=wo())!==e&&(r=Oa()),(t=r)===e&&(t=n,(r=No())!==e&&(r=$a()),(t=r)===e&&(t=n,(r=Io())!==e&&(r=Ja()),(t=r)===e&&(t=n,(r=ve())!==e&&(r=Ua()),(t=r)===e&&(t=n,(r=de())!==e&&(r=ka()),(t=r)===e&&(t=n,(r=bo())!==e?(p(),P()!==e?(p(),(a=V())!==e?(p(),_()!==e?t=qa(a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e))))))),t}function Uu(){var t,r,a,u;return t=n,pe()!==e?(p(),P()!==e?(p(),(r=ne())===e&&(r=null),p(),(a=A())!==e?(p(),xt()!==e?(p(),(u=A())!==e?(p(),_()!==e?t=Va(r,a,u):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,pe()!==e?(p(),P()!==e?(p(),(r=ne())===e&&(r=null),p(),(a=A())!==e?(p(),_()!==e?t=Ha(r,a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)),t}function ne(){var t;return(t=po())===e&&(t=vo())===e&&(t=ho()),t}function ku(){var t,r,a;return t=n,fo()!==e?(p(),P()!==e?(p(),(r=A())!==e?(p(),Tt()!==e?(p(),(a=A())!==e?(p(),_()!==e?t=Ba(r,a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t}function qu(){var t,r,a;return t=n,(r=Ao())!==e?(p(),P()!==e?(p(),(a=Yt())===e&&(a=null),p(),_()!==e?t=ja(r,a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t}function Vu(){var t;return(t=me())===e&&(t=ge())===e&&(t=ye())===e&&(t=we())===e&&(t=Ne())===e&&(t=H()),t}function Hu(){var t;return(t=bt())===e&&(t=eo())===e&&(t=Qu())===e&&(t=Ku())===e&&(t=Yu())===e&&(t=Bu())===e&&(t=ju()),t}function Bu(){var t,r;return t=n,de()!==e?(p(),(r=G())!==e?t=za(r):(n=t,t=e)):(n=t,t=e),t}function ju(){var t,r,a,u;return t=n,he()!==e?(p(),i.charCodeAt(n)===45?(r=pt,n++):(r=e,c===0&&v(vt)),r===e&&(i.charCodeAt(n)===43?(r=ft,n++):(r=e,c===0&&v(dt))),r!==e?(p(),(a=G())!==e?(p(),(u=re())!==e?t=Ga(r,a,u):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,he()!==e?(p(),(r=G())!==e?(p(),(a=re())!==e?t=Wa(r,a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)),t}function re(){var t,r,a;return t=n,(r=zu())!==e?(p(),To()!==e?(p(),(a=Gu())!==e?t=Ya(r,a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=Wu()),t}function zu(){var t,r,a;return t=n,(r=W())!==e?(p(),P()!==e?(p(),(a=nt())!==e?(p(),_()!==e?t=Ka(r,a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,(r=W())!==e&&(r=Qa(r)),t=r),t}function Gu(){var t,r,a,u;return t=n,(r=W())!==e&&(r=Za(r)),(t=r)===e&&(t=n,(r=H())!==e?(p(),P()!==e?(p(),(a=nt())!==e?(p(),lt()!==e?(p(),(u=et())!==e?(p(),_()!==e?t=Xa(a,u):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,(r=H())!==e?(p(),P()!==e?(p(),(a=nt())!==e?(p(),_()!==e?t=ts(a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,(r=H())!==e&&(r=es()),t=r))),t}function Wu(){var t,r,a,u;return t=n,(r=W())!==e?(p(),P()!==e?(p(),(a=et())!==e?(p(),_()!==e?t=ns(r,a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,(r=W())!==e&&(r=rs(r)),(t=r)===e&&(t=n,(r=H())!==e?(p(),P()!==e?(p(),(a=nt())!==e?(p(),lt()!==e?(p(),(u=et())!==e?(p(),_()!==e?t=as(a,u):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,(r=H())!==e?(p(),P()!==e?(p(),(a=et())!==e?(p(),_()!==e?t=ss(a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t===e&&(t=n,(r=H())!==e&&(r=us()),t=r)))),t}function W(){var t,r;return t=n,(r=ye())!==e&&(r=os()),(t=r)===e&&(t=n,(r=we())!==e&&(r=is()),(t=r)===e&&(t=n,(r=Ne())!==e&&(r=ls()),(t=r)===e&&(t=n,(r=ge())!==e&&(r=cs()),(t=r)===e&&(t=n,(r=me())!==e&&(r=fs()),t=r)))),t}function et(){var t;return(t=V())!==e&&(t=ps(t)),t}function nt(){var t;return(t=V())!==e&&(t=ds(t)),t}function Yu(){var t,r;return t=n,ve()!==e?(p(),(r=G())!==e?t=vs(r):(n=t,t=e)):(n=t,t=e),t}function Ku(){var t;return(t=ao())!==e&&(t=hs()),t}function Qu(){var t,r;return t=n,(r=so())!==e&&(r=ms()),(t=r)===e&&(t=n,(r=uo())!==e&&(r=gs()),t=r),t}function G(){var t;return(t=bt())===e&&(t=It()),t}function bt(){var t,r,a,u,h;if(t=n,i.charCodeAt(n)===39?(r=Rt,n++):(r=e,c===0&&v(kt)),r===e&&(i.substr(n,2)===Dt?(r=Dt,n+=2):(r=e,c===0&&v(lr))),r!==e){for(a=[],u=n,i.substr(n,2)===Z?(h=Z,n+=2):(h=e,c===0&&v(qt)),h!==e&&(h=jt()),(u=h)===e&&($t.test(i.charAt(n))?(u=i.charAt(n),n++):(u=e,c===0&&v(Vt)));u!==e;)a.push(u),u=n,i.substr(n,2)===Z?(h=Z,n+=2):(h=e,c===0&&v(qt)),h!==e&&(h=jt()),(u=h)===e&&($t.test(i.charAt(n))?(u=i.charAt(n),n++):(u=e,c===0&&v(Vt)));i.charCodeAt(n)===39?(u=Rt,n++):(u=e,c===0&&v(kt)),u!==e?t=ys(a):(n=t,t=e)}else n=t,t=e;return t}function Zu(){var t;return(t=Xu())===e&&(t=to()),t}function Xu(){var t,r,a,u,h;if(t=n,ot()!==e)if(p(),(r=A())!==e){for(p(),a=[],u=at();u!==e;)a.push(u),u=at();u=p(),(h=it())!==e?t=ws(r,a):(n=t,t=e)}else n=t,t=e;else n=t,t=e;if(t===e)if(t=n,ot()!==e)if(p(),(r=A())!==e){for(p(),a=[],u=at();u!==e;)a.push(u),u=at();u=p(),(h=ae())!==e?(p(),it()!==e?t=Ns(r,a,h):(n=t,t=e)):(n=t,t=e)}else n=t,t=e;else n=t,t=e;return t}function to(){var t,r,a,u;if(t=n,ot()!==e){for(p(),r=[],a=rt();a!==e;)r.push(a),a=rt();a=p(),(u=it())!==e?t=Is(r):(n=t,t=e)}else n=t,t=e;if(t===e)if(t=n,ot()!==e){for(p(),r=[],a=rt();a!==e;)r.push(a),a=rt();a=p(),(u=ae())!==e?(p(),it()!==e?t=bs(r,u):(n=t,t=e)):(n=t,t=e)}else n=t,t=e;return t}function rt(){var t,r,a;return t=n,Ie()!==e?(p(),(r=A())!==e?(p(),be()!==e?(p(),(a=A())!==e?t=Ts(r,a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t}function at(){var t,r,a;return t=n,Ie()!==e?(p(),(r=A())!==e?(p(),be()!==e?(p(),(a=A())!==e?t=xs(r,a):(n=t,t=e)):(n=t,t=e)):(n=t,t=e)):(n=t,t=e),t}function ae(){var t,r;return t=n,xo()!==e?(p(),(r=A())!==e?t=As(r):(n=t,t=e)):(n=t,t=e),t}function eo(){var t,r,a,u;return t=n,(r=no())!==e?(a=n,c++,u=Nt(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Ss(r):(n=t,t=e)):(n=t,t=e),t}function no(){var t,r,a,u;return t=n,(r=st())!==e&&(a=se())!==e&&(u=ue())!==e?t=Es(r,a,u):(n=t,t=e),t===e&&(t=n,(r=st())!==e&&(a=se())!==e?t=Cs(r,a):(n=t,t=e),t===e&&(t=n,(r=st())!==e&&(a=ue())!==e?t=Fs(r,a):(n=t,t=e),t===e&&(t=n,(r=st())!==e&&(r=Ps(r)),t=r))),t}function st(){var t,r,a;return(t=V())===e&&(t=n,i.charCodeAt(n)===45?(r=pt,n++):(r=e,c===0&&v(vt)),r===e&&(i.charCodeAt(n)===43?(r=ft,n++):(r=e,c===0&&v(dt))),r!==e&&(a=V())!==e?t=_s(r,a):(n=t,t=e)),t}function se(){var t,r,a;return t=n,i.charCodeAt(n)===46?(r=Ye,n++):(r=e,c===0&&v(cr)),r!==e?((a=V())===e&&(a=null),t=Ls(a)):(n=t,t=e),t}function ue(){var t,r,a;return t=n,(r=ro())!==e&&(a=V())!==e?t=Ms(r,a):(n=t,t=e),t}function V(){var t,r;if(t=[],(r=oe())!==e)for(;r!==e;)t.push(r),r=oe();else t=e;return t!==e&&(t=Rs(t)),t}function oe(){var t;return jn.test(i.charAt(n))?(t=i.charAt(n),n++):(t=e,c===0&&v(fr)),t}function ro(){var t,r,a;return t=n,zn.test(i.charAt(n))?(r=i.charAt(n),n++):(r=e,c===0&&v(pr)),r!==e?(Gn.test(i.charAt(n))?(a=i.charAt(n),n++):(a=e,c===0&&v(dr)),a===e&&(a=null),t=Ds(r,a)):(n=t,t=e),t}function ao(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===Ke?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(vr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=r=[r,a]:(n=t,t=e)):(n=t,t=e),t}function so(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===Qe?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(hr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=r=[r,a]:(n=t,t=e)):(n=t,t=e),t}function uo(){var t,r,a,u;return t=n,i.substr(n,5).toLowerCase()===Ze?(r=i.substr(n,5),n+=5):(r=e,c===0&&v(mr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=r=[r,a]:(n=t,t=e)):(n=t,t=e),t}function Tt(){var t,r,a,u;return t=n,i.substr(n,2).toLowerCase()===Xe?(r=i.substr(n,2),n+=2):(r=e,c===0&&v(gr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Os():(n=t,t=e)):(n=t,t=e),t}function ie(){var t,r,a,u;return t=n,i.substr(n,2).toLowerCase()===tn?(r=i.substr(n,2),n+=2):(r=e,c===0&&v(yr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=$s():(n=t,t=e)):(n=t,t=e),t}function le(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===en?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(wr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Js():(n=t,t=e)):(n=t,t=e),t}function oo(){var t,r,a,u;return t=n,i.substr(n,6).toLowerCase()===nn?(r=i.substr(n,6),n+=6):(r=e,c===0&&v(Nr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Us():(n=t,t=e)):(n=t,t=e),t}function Y(){var t,r,a,u;return t=n,i.substr(n,3).toLowerCase()===rn?(r=i.substr(n,3),n+=3):(r=e,c===0&&v(Ir)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=ks():(n=t,t=e)):(n=t,t=e),t}function ut(){var t,r,a,u;return t=n,i.substr(n,3).toLowerCase()===an?(r=i.substr(n,3),n+=3):(r=e,c===0&&v(br)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=qs():(n=t,t=e)):(n=t,t=e),t}function ce(){var t,r,a,u;return t=n,i.substr(n,2).toLowerCase()===sn?(r=i.substr(n,2),n+=2):(r=e,c===0&&v(Tr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Vs():(n=t,t=e)):(n=t,t=e),t}function fe(){var t,r,a,u;return t=n,i.substr(n,7).toLowerCase()===un?(r=i.substr(n,7),n+=7):(r=e,c===0&&v(xr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Hs():(n=t,t=e)):(n=t,t=e),t}function xt(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===on?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(Ar)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Bs():(n=t,t=e)):(n=t,t=e),t}function io(){var t,r,a,u;return t=n,i.substr(n,3).toLowerCase()===ln?(r=i.substr(n,3),n+=3):(r=e,c===0&&v(Sr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=js():(n=t,t=e)):(n=t,t=e),t}function lo(){var t,r,a,u;return t=n,i.substr(n,9).toLowerCase()===cn?(r=i.substr(n,9),n+=9):(r=e,c===0&&v(Er)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=zs():(n=t,t=e)):(n=t,t=e),t}function co(){var t,r,a,u;return t=n,i.substr(n,7).toLowerCase()===fn?(r=i.substr(n,7),n+=7):(r=e,c===0&&v(Cr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Gs():(n=t,t=e)):(n=t,t=e),t}function pe(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===pn?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(Fr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Ws():(n=t,t=e)):(n=t,t=e),t}function fo(){var t,r,a,u;return t=n,i.substr(n,8).toLowerCase()===dn?(r=i.substr(n,8),n+=8):(r=e,c===0&&v(Pr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Ys():(n=t,t=e)):(n=t,t=e),t}function de(){var t,r,a,u;return t=n,i.substr(n,9).toLowerCase()===vn?(r=i.substr(n,9),n+=9):(r=e,c===0&&v(_r)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Ks():(n=t,t=e)):(n=t,t=e),t}function ve(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===hn?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(Lr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Qs():(n=t,t=e)):(n=t,t=e),t}function po(){var t,r,a,u;return t=n,i.substr(n,7).toLowerCase()===mn?(r=i.substr(n,7),n+=7):(r=e,c===0&&v(Mr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Zs():(n=t,t=e)):(n=t,t=e),t}function vo(){var t,r,a,u;return t=n,i.substr(n,8).toLowerCase()===gn?(r=i.substr(n,8),n+=8):(r=e,c===0&&v(Rr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Xs():(n=t,t=e)):(n=t,t=e),t}function ho(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===yn?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(Dr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=tu():(n=t,t=e)):(n=t,t=e),t}function mo(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===wn?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(Or)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=eu():(n=t,t=e)):(n=t,t=e),t}function go(){var t,r,a,u;return t=n,i.substr(n,2).toLowerCase()===Nn?(r=i.substr(n,2),n+=2):(r=e,c===0&&v($r)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=nu():(n=t,t=e)):(n=t,t=e),t}function yo(){var t,r,a,u;return t=n,i.substr(n,7).toLowerCase()===In?(r=i.substr(n,7),n+=7):(r=e,c===0&&v(Jr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=ru():(n=t,t=e)):(n=t,t=e),t}function wo(){var t,r,a,u;return t=n,i.substr(n,8).toLowerCase()===bn?(r=i.substr(n,8),n+=8):(r=e,c===0&&v(Ur)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=au():(n=t,t=e)):(n=t,t=e),t}function No(){var t,r,a,u;return t=n,i.substr(n,5).toLowerCase()===Tn?(r=i.substr(n,5),n+=5):(r=e,c===0&&v(kr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=su():(n=t,t=e)):(n=t,t=e),t}function Io(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===xn?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(qr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=uu():(n=t,t=e)):(n=t,t=e),t}function bo(){var t,r,a,u;return t=n,i.substr(n,7).toLowerCase()===An?(r=i.substr(n,7),n+=7):(r=e,c===0&&v(Vr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=ou():(n=t,t=e)):(n=t,t=e),t}function To(){var t,r,a,u;return t=n,i.substr(n,2).toLowerCase()===Sn?(r=i.substr(n,2),n+=2):(r=e,c===0&&v(Hr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=iu():(n=t,t=e)):(n=t,t=e),t}function he(){var t,r,a,u;return t=n,i.substr(n,8).toLowerCase()===En?(r=i.substr(n,8),n+=8):(r=e,c===0&&v(Br)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=lu():(n=t,t=e)):(n=t,t=e),t}function me(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===Cn?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(jr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=cu():(n=t,t=e)):(n=t,t=e),t}function ge(){var t,r,a,u;return t=n,i.substr(n,5).toLowerCase()===Fn?(r=i.substr(n,5),n+=5):(r=e,c===0&&v(zr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=fu():(n=t,t=e)):(n=t,t=e),t}function ye(){var t,r,a,u;return t=n,i.substr(n,3).toLowerCase()===Pn?(r=i.substr(n,3),n+=3):(r=e,c===0&&v(Gr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=pu():(n=t,t=e)):(n=t,t=e),t}function we(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===_n?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(Wr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=du():(n=t,t=e)):(n=t,t=e),t}function Ne(){var t,r,a,u;return t=n,i.substr(n,6).toLowerCase()===Ln?(r=i.substr(n,6),n+=6):(r=e,c===0&&v(Yr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=vu():(n=t,t=e)):(n=t,t=e),t}function H(){var t,r,a,u;return t=n,i.substr(n,6).toLowerCase()===Mn?(r=i.substr(n,6),n+=6):(r=e,c===0&&v(Kr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=hu():(n=t,t=e)):(n=t,t=e),t}function ot(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===Rn?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(Qr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=mu():(n=t,t=e)):(n=t,t=e),t}function it(){var t,r,a,u;return t=n,i.substr(n,3).toLowerCase()===Dn?(r=i.substr(n,3),n+=3):(r=e,c===0&&v(Zr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=gu():(n=t,t=e)):(n=t,t=e),t}function Ie(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===On?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(Xr)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=yu():(n=t,t=e)):(n=t,t=e),t}function be(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===$n?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(ta)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=wu():(n=t,t=e)):(n=t,t=e),t}function xo(){var t,r,a,u;return t=n,i.substr(n,4).toLowerCase()===Jn?(r=i.substr(n,4),n+=4):(r=e,c===0&&v(ea)),r!==e?(a=n,c++,u=y(),c--,u===e?a=void 0:(n=a,a=e),a!==e?t=Nu():(n=t,t=e)):(n=t,t=e),t}function lt(){var t;return i.charCodeAt(n)===44?(t=Un,n++):(t=e,c===0&&v(na)),t}function P(){var t;return i.charCodeAt(n)===40?(t=kn,n++):(t=e,c===0&&v(ra)),t}function _(){var t;return i.charCodeAt(n)===41?(t=qn,n++):(t=e,c===0&&v(aa)),t}function p(){var t,r;for(t=[],r=Te();r!==e;)t.push(r),r=Te();return t}function Te(){var t;return Wn.test(i.charAt(n))?(t=i.charAt(n),n++):(t=e,c===0&&v(sa)),t}function Ao(){var t,r,a,u;if(t=n,(r=te())!==e&&(r=Iu(r)),(t=r)===e)if(t=n,i.charCodeAt(n)===96?(r=Ot,n++):(r=e,c===0&&v(Ht)),r!==e){if(a=[],Jt.test(i.charAt(n))?(u=i.charAt(n),n++):(u=e,c===0&&v(Bt)),u!==e)for(;u!==e;)a.push(u),Jt.test(i.charAt(n))?(u=i.charAt(n),n++):(u=e,c===0&&v(Bt));else a=e;a!==e?(i.charCodeAt(n)===96?(u=Ot,n++):(u=e,c===0&&v(Ht)),u!==e?t=bu(a):(n=t,t=e)):(n=t,t=e)}else n=t,t=e;return t}function So(t,r){return{type:"unary-expression",operator:t,expr:r}}function xe(t,r,a,u){var h={type:"binary-expression",operator:t,left:r,right:a};return u!==void 0&&(h.escape=u),h}function Eo(t,r){for(var a=[t],u=0;u<r.length;u++)a.push(r[u][3]);return a}function Co(t,r,a){return Eo(t,r)}function K(t,r){for(var a=t,u=0;u<r.length;u++)a=xe(r[u][1],a,r[u][3]);return a}if((m=L())!==e&&n===i.length)return m;throw m!==e&&n<i.length&&v(Tu()),xu(ht,D<i.length?i.charAt(D):null,D<i.length?Gt(D,D+1):Gt(D,D))}return l(s,Error),s.prototype.format=function(i){var d="Error: "+this.message;if(this.location){var m,e=null;for(m=0;m<i.length;m++)if(i[m].source===this.location.source){e=i[m].text.split(/\r\n|\n|\r/g);break}var N=this.location.start,b=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(N):N,L=this.location.source+":"+b.line+":"+b.column;if(e){var q=this.location.end,O=o("",b.line.toString().length," "),T=e[N.line-1],S=(N.line===q.line?q.column:T.length+1)-N.column||1;d+=`
 --> `+L+`
`+O+` |
`+b.line+" | "+T+`
`+O+" | "+o("",N.column-1," ")+o("",S,"^")}else d+=`
 at `+L}return d},s.buildMessage=function(i,d){var m={literal:function(T){return'"'+N(T.text)+'"'},class:function(T){var S=T.parts.map(function(M){return Array.isArray(M)?b(M[0])+"-"+b(M[1]):b(M)});return"["+(T.inverted?"^":"")+S.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(T){return T.description}};function e(T){return T.charCodeAt(0).toString(16).toUpperCase()}function N(T){return T.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(S){return"\\x0"+e(S)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(S){return"\\x"+e(S)})}function b(T){return T.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(S){return"\\x0"+e(S)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(S){return"\\x"+e(S)})}function L(T){return m[T.type](T)}function q(T){var S,M,C=T.map(L);if(C.sort(),C.length>0){for(S=1,M=1;S<C.length;S++)C[S-1]!==C[S]&&(C[M]=C[S],M++);C.length=M}switch(C.length){case 1:return C[0];case 2:return C[0]+" or "+C[1];default:return C.slice(0,-1).join(", ")+", or "+C[C.length-1]}}function O(T){return T?'"'+N(T)+'"':"end of input"}return"Expected "+q(i)+" but "+O(d)+" found."},{SyntaxError:s,parse:f}},(Fe=At).exports&&(Fe.exports=Pe());var Uo=At.exports;class ko{static parse(s){return Uo.parse(s)}}const Je=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,qo=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,Vo=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,Ho=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,Bo=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,jo=new Set(["current_timestamp","current_date","current_time"]);function B(l,s){return(l+="").length>=s?l:new Array(s-l.length+1).join("0")+l}function Q(l,s,o="0",f="0",i="0",d="0",m="",e="0",N="0"){if(m==="+"||m==="-"){const b=`${B(parseInt(l,10),4)}-${B(parseInt(s,10),2)}-${B(parseInt(o,10),2)}`;let L="";parseFloat(d)<10&&(L="0");const q=`${B(parseInt(f,10),2)}:${B(parseInt(i,10),2)}:${L+parseFloat(d).toString()}`,O=`${m}${B(parseInt(e,10),2)}:${B(parseInt(N,10),2)}`;return new Date(b+"T"+q+O)}return new Date(parseInt(l,10),parseInt(s,10)-1,parseInt(o,10),parseInt(f,10),parseInt(i,10),parseFloat(d))}class zo{static makeBool(s){return Ue(s)}static featureValue(s,o,f,i){return Be(s,o,f,i)}static equalsNull(s){return s===null}static applyLike(s,o,f){return Ft(s,o,f)}static ensureArray(s){return Et(s)}static applyIn(s,o){return Ct(s,o)}static currentDate(){const s=new Date;return s.setHours(0,0,0,0),s}static makeSqlInterval(s,o,f){return E.createFromValueAndQualifer(s,o,f)}static convertInterval(s){return s instanceof E?s.valueInMilliseconds():s}static currentTimestamp(){return new Date}static compare(s,o,f){return Ve(s,o,f)}static calculate(s,o,f){return He(s,o,f)}static makeComparable(s){return k(s)}static evaluateFunction(s,o){return Pt(s,o)}static lookup(s,o){const f=o[s];return f===void 0?null:f}static between(s,o){return s==null||o[0]==null||o[1]==null?null:s>=o[0]&&s<=o[1]}static notbetween(s,o){return s==null||o[0]==null||o[1]==null?null:s<o[0]||s>o[1]}static ternaryNot(s){return ct(s)}static ternaryAnd(s,o){return ke(s,o)}static ternaryOr(s,o){return qe(s,o)}}class _t{constructor(s,o){this.fieldsIndex=o,this._datefields={},this.parameters={},this._hasDateFunctions=void 0,this.parseTree=ko.parse(s);const{isStandardized:f,isAggregate:i,referencedFieldNames:d}=this._extractExpressionInfo(o);this._referencedFieldNames=d,this.isStandardized=f,this.isAggregate=i}static create(s,o){return new _t(s,o)}get fieldNames(){return this._referencedFieldNames}testSet(s,o=j){const f={};for(const i of this.fieldNames)f[i]=s.map(d=>o.getAttribute(d,i));return!!this._evaluateNode(this.parseTree,{attributes:f},j)}calculateValue(s,o=j){const f=this._evaluateNode(this.parseTree,s,o);return f instanceof E?f.valueInMilliseconds()/864e5:f}calculateValueCompiled(s,o=j){return this.parseTree._compiledVersion!=null?this.parseTree._compiledVersion(s,this.parameters,o,this._datefields):Ae("esri-csp-restrictions")?this.calculateValue(s,o):(this._compileMe(),this.parseTree._compiledVersion(s,this.parameters,o,this._datefields))}testFeature(s,o=j){return!!this._evaluateNode(this.parseTree,s,o)}testFeatureCompiled(s,o=j){return this.parseTree._compiledVersion!=null?!!this.parseTree._compiledVersion(s,this.parameters,o,this._datefields):Ae("esri-csp-restrictions")?this.testFeature(s,o):(this._compileMe(),!!this.parseTree._compiledVersion(s,this.parameters,o,this._datefields))}get hasDateFunctions(){return this._hasDateFunctions!=null||(this._hasDateFunctions=!1,this._visitAll(this.parseTree,s=>{s.type==="current-time"?this._hasDateFunctions=!0:s.type==="function"&&(this._hasDateFunctions=this._hasDateFunctions||jo.has(s.name.toLowerCase()))})),this._hasDateFunctions}getFunctions(){const s=new Set;return this._visitAll(this.parseTree,o=>{o.type==="function"&&s.add(o.name.toLowerCase())}),Array.from(s)}getExpressions(){const s=new Map;return this._visitAll(this.parseTree,o=>{if(o.type==="function"){const f=o.name.toLowerCase(),i=o.args.value[0];if(i.type==="column-reference"){const d=i.column,m=`${f}-${d}`;s.has(m)||s.set(m,{aggregateType:f,field:d})}}}),[...s.values()]}getVariables(){const s=new Set;return this._visitAll(this.parseTree,o=>{o.type==="parameter"&&s.add(o.value.toLowerCase())}),Array.from(s)}_compileMe(){const s="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=new Function("feature","lookups","attributeAdapter","datefields",s).bind(zo)}_extractExpressionInfo(s){const o=[],f=new Set;let i=!0,d=!0;return this._visitAll(this.parseTree,m=>{switch(m.type){case"column-reference":{const e=s?.get(m.column);let N,b;e?N=b=e.name??"":(b=m.column,N=b.toLowerCase()),e&&e.name&&(e.type==="date"||e.type==="esriFieldTypeDate")&&(this._datefields[e.name]=1),f.has(N)||(f.add(N),o.push(b)),m.column=b;break}case"function":{const{name:e,args:N}=m,b=N.value.length;i&&(i=Oo(e,b)),d&&(d=Lo(e,b));break}}}),{referencedFieldNames:Array.from(o),isStandardized:i,isAggregate:d}}_visitAll(s,o){if(s!=null)switch(o(s),s.type){case"when-clause":this._visitAll(s.operand,o),this._visitAll(s.value,o);break;case"case-expression":for(const f of s.clauses)this._visitAll(f,o);s.format==="simple"&&this._visitAll(s.operand,o),s.else!==null&&this._visitAll(s.else,o);break;case"expression-list":for(const f of s.value)this._visitAll(f,o);break;case"unary-expression":this._visitAll(s.expr,o);break;case"binary-expression":this._visitAll(s.left,o),this._visitAll(s.right,o);break;case"function":this._visitAll(s.args,o)}}evaluateNodeToJavaScript(s){switch(s.type){case"interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(s.value)+", "+JSON.stringify(s.qualifier)+","+JSON.stringify(s.op)+")";case"case-expression":{let o="";if(s.format==="simple"){const f="this.makeComparable("+this.evaluateNodeToJavaScript(s.operand)+")";o="( ";for(let i=0;i<s.clauses.length;i++)o+=" ("+f+" === this.makeComparable("+this.evaluateNodeToJavaScript(s.clauses[i].operand)+")) ? ("+this.evaluateNodeToJavaScript(s.clauses[i].value)+") : ";s.else!==null?o+=this.evaluateNodeToJavaScript(s.else):o+="null",o+=" )"}else{o="( ";for(let f=0;f<s.clauses.length;f++)o+=" this.makeBool("+this.evaluateNodeToJavaScript(s.clauses[f].operand)+")===true ? ("+this.evaluateNodeToJavaScript(s.clauses[f].value)+") : ";s.else!==null?o+=this.evaluateNodeToJavaScript(s.else):o+="null",o+=" )"}return o}case"parameter":return"this.lookup("+JSON.stringify(s.value.toLowerCase())+",lookups)";case"expression-list":{let o="[";for(const f of s.value)o!=="["&&(o+=","),o+=this.evaluateNodeToJavaScript(f);return o+="]",o}case"unary-expression":return"this.ternaryNot("+this.evaluateNodeToJavaScript(s.expr)+")";case"binary-expression":switch(s.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+" )";case"IS":if(s.right.type!=="null")throw new Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(s.left)+")";case"ISNOT":if(s.right.type!=="null")throw new Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(s.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(s.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(s.right)+"))";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(s.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(s.right)+")))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+")";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+")";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+","+JSON.stringify(s.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+","+JSON.stringify(s.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(s.operator)+","+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+")";case"*":case"-":case"+":case"/":case"||":return"this.calculate("+JSON.stringify(s.operator)+","+this.evaluateNodeToJavaScript(s.left)+","+this.evaluateNodeToJavaScript(s.right)+")"}throw new Error("Not Supported Operator "+s.operator);case"null":case"boolean":case"string":case"number":return JSON.stringify(s.value);case"date":return"(new Date("+_e(s.value).getTime().toString()+"))";case"timestamp":return"(new Date("+St(s.value).getTime().toString()+"))";case"current-time":return s.mode==="date"?"this.currentDate()":"this.currentTimestamp()";case"column-reference":return"this.featureValue(feature,"+JSON.stringify(s.column)+",datefields,attributeAdapter)";case"function":return"this.evaluateFunction("+JSON.stringify(s.name)+","+this.evaluateNodeToJavaScript(s.args)+")"}throw new Error("Unsupported sql syntax "+s.type)}_evaluateNode(s,o,f){switch(s.type){case"interval":{const i=this._evaluateNode(s.value,o,f);return E.createFromValueAndQualifer(i,s.qualifier,s.op)}case"case-expression":if(s.format==="simple"){const i=k(this._evaluateNode(s.operand,o,f));for(let d=0;d<s.clauses.length;d++)if(i===k(this._evaluateNode(s.clauses[d].operand,o,f)))return this._evaluateNode(s.clauses[d].value,o,f);if(s.else!==null)return this._evaluateNode(s.else,o,f)}else{for(let i=0;i<s.clauses.length;i++)if(Ue(this._evaluateNode(s.clauses[i].operand,o,f)))return this._evaluateNode(s.clauses[i].value,o,f);if(s.else!==null)return this._evaluateNode(s.else,o,f)}return null;case"parameter":return this.parameters[s.value.toLowerCase()];case"expression-list":{const i=[];for(const d of s.value)i.push(this._evaluateNode(d,o,f));return i}case"unary-expression":return ct(this._evaluateNode(s.expr,o,f));case"binary-expression":switch(s.operator){case"AND":return ke(this._evaluateNode(s.left,o,f),this._evaluateNode(s.right,o,f));case"OR":return qe(this._evaluateNode(s.left,o,f),this._evaluateNode(s.right,o,f));case"IS":if(s.right.type!=="null")throw new Error("Unsupported RHS for IS");return this._evaluateNode(s.left,o,f)===null;case"ISNOT":if(s.right.type!=="null")throw new Error("Unsupported RHS for IS");return this._evaluateNode(s.left,o,f)!==null;case"IN":{const i=Et(this._evaluateNode(s.right,o,f));return Ct(this._evaluateNode(s.left,o,f),i)}case"NOT IN":{const i=Et(this._evaluateNode(s.right,o,f));return ct(Ct(this._evaluateNode(s.left,o,f),i))}case"BETWEEN":{const i=this._evaluateNode(s.left,o,f),d=this._evaluateNode(s.right,o,f);return i==null||d[0]==null||d[1]==null?null:i>=k(d[0])&&i<=k(d[1])}case"NOTBETWEEN":{const i=this._evaluateNode(s.left,o,f),d=this._evaluateNode(s.right,o,f);return i==null||d[0]==null||d[1]==null?null:i<k(d[0])||i>k(d[1])}case"LIKE":return Ft(this._evaluateNode(s.left,o,f),this._evaluateNode(s.right,o,f),s.escape);case"NOT LIKE":return ct(Ft(this._evaluateNode(s.left,o,f),this._evaluateNode(s.right,o,f),s.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return Ve(s.operator,this._evaluateNode(s.left,o,f),this._evaluateNode(s.right,o,f));case"-":case"+":case"*":case"/":case"||":return He(s.operator,this._evaluateNode(s.left,o,f),this._evaluateNode(s.right,o,f))}case"null":case"boolean":case"string":case"number":return s.value;case"date":return _e(s.value);case"timestamp":return St(s.value);case"current-time":{const i=new Date;return s.mode==="date"&&i.setHours(0,0,0,0),i}case"column-reference":return Be(o,s.column,this._datefields,f);case"data-type":return s.value;case"function":{const i=this._evaluateNode(s.args,o,f);return this.isAggregate?_o(s.name,i):Pt(s.name,i)}}throw new Error("Unsupported sql syntax "+s.type)}}function St(l){let s=qo.exec(l);if(s!==null){const[,o,f,i,d,m,e]=s;return Q(o,f,i,d,m,e)}if(s=Vo.exec(l),s!==null){const[,o,f,i,d,m,e,N,b,L]=s;return Q(o,f,i,d,m,e,N,b,L)}if(s=Ho.exec(l),s!==null){const[,o,f,i,d,m,e,N,b]=s;return Q(o,f,i,d,m,"0",e,N,b)}if(s=Bo.exec(l),s!==null){const[,o,f,i,d,m]=s;return Q(o,f,i,d,m)}if(s=Je.exec(l),s!==null){const[,o,f,i]=s;return Q(o,f,i)}throw new Error("SQL Invalid Timestamp")}function _e(l){const s=Je.exec(l);if(s===null)try{return St(l)}catch{throw new Error("SQL Invalid Date")}const[,o,f,i]=s;return new Date(parseInt(o,10),parseInt(f,10)-1,parseInt(i,10))}function Ue(l){return l===!0}function Et(l){return Array.isArray(l)?l:[l]}function ct(l){return l!==null?l!==!0:null}function ke(l,s){return l!=null&&s!=null?l===!0&&s===!0:l!==!1&&s!==!1&&null}function qe(l,s){return l!=null&&s!=null?l===!0||s===!0:l===!0||s===!0||null}function Ct(l,s){if(l==null)return null;let o=!1;for(const f of s)if(f==null)o=null;else if(l===f){o=!0;break}return o}const Le="-[]/{}()*+?.\\^$|";var z;function Go(l,s){const o=s;let f="",i=z.Normal;for(let d=0;d<l.length;d++){const m=l.charAt(d);switch(i){case z.Normal:m===o?i=z.Escaped:Le.includes(m)?f+="\\"+m:f+=m==="%"?".*":m==="_"?".":m;break;case z.Escaped:Le.includes(m)?f+="\\"+m:f+=m,i=z.Normal}}return new RegExp("^"+f+"$","m")}function Ft(l,s,o){return l==null?null:Go(s,o).test(l)}function k(l){return l instanceof Date?l.valueOf():l}function Ve(l,s,o){if(s==null||o==null)return null;const f=k(s),i=k(o);switch(l){case"<>":return f!==i;case"=":return f===i;case">":return f>i;case"<":return f<i;case">=":return f>=i;case"<=":return f<=i}}function He(l,s,o){if(l==="||")return Pt("concat",[s,o]);if(s instanceof E)if(o instanceof Date)switch(l){case"+":return new Date(s.valueInMilliseconds()+o.getTime());case"-":return s.valueInMilliseconds()-o.getTime();case"*":return s.valueInMilliseconds()*o.getTime();case"/":return s.valueInMilliseconds()/o.getTime()}else if(o instanceof E)switch(l){case"+":return E.createFromMilliseconds(s.valueInMilliseconds()+o.valueInMilliseconds());case"-":return E.createFromMilliseconds(s.valueInMilliseconds()-o.valueInMilliseconds());case"*":return s.valueInMilliseconds()*o.valueInMilliseconds();case"/":return s.valueInMilliseconds()/o.valueInMilliseconds()}else s=s.valueInMilliseconds();else if(o instanceof E)if(s instanceof Date)switch(l){case"+":return new Date(o.valueInMilliseconds()+s.getTime());case"-":return new Date(s.getTime()-o.valueInMilliseconds());case"*":return s.getTime()*o.valueInMilliseconds();case"/":return s.getTime()/o.valueInMilliseconds()}else o=o.valueInMilliseconds();else if(s instanceof Date&&typeof o=="number")switch(o=24*o*60*60*1e3,s=s.getTime(),l){case"+":return new Date(s+o);case"-":return new Date(s-o);case"*":return new Date(s*o);case"/":return new Date(s/o)}else if(o instanceof Date&&typeof s=="number")switch(s=24*s*60*60*1e3,o=o.getTime(),l){case"+":return new Date(s+o);case"-":return new Date(s-o);case"*":return new Date(s*o);case"/":return new Date(s/o)}switch(l){case"+":return s+o;case"-":return s-o;case"*":return s*o;case"/":return s/o}}function Wo(l){return l&&typeof l.attributes=="object"}function Be(l,s,o,f){const i=f.getAttribute(l,s);return i!=null&&o[s]===1?new Date(i):i}(function(l){l[l.Normal=0]="Normal",l[l.Escaped=1]="Escaped"})(z||(z={}));const j={getAttribute:(l,s)=>(Wo(l)?l.attributes:l)[s]};var Qo=Object.freeze(Object.defineProperty({__proto__:null,WhereClause:_t,defaultAttributeAdapter:j},Symbol.toStringTag,{value:"Module"}));export{Qo as W,_t as f,R as n,Oe as o,U as s,F as t};
